!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n=i();for(var e in n)("object"==typeof exports?exports:t)[e]=n[e]}}("undefined"!=typeof self?self:this,(()=>(()=>{var __webpack_modules__={45:t=>{"use strict";t.exports=function(t,i){var n=new Array(arguments.length-1),e=0,s=2,r=!0;for(;s<arguments.length;)n[e++]=arguments[s++];return new Promise((function(s,o){n[e]=function(t){if(r)if(r=!1,t)o(t);else{for(var i=new Array(arguments.length-1),n=0;n<i.length;)i[n++]=arguments[n];s.apply(null,i)}};try{t.apply(i||null,n)}catch(t){r&&(r=!1,o(t))}}))}},839:(t,i)=>{"use strict";var n=i;n.length=function(t){var i=t.length;if(!i)return 0;for(var n=0;--i%4>1&&"="===t.charAt(i);)++n;return Math.ceil(3*t.length)/4-n};for(var e=new Array(64),s=new Array(123),r=0;r<64;)s[e[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;n.encode=function(t,i,n){for(var s,r=null,o=[],u=0,h=0;i<n;){var a=t[i++];switch(h){case 0:o[u++]=e[a>>2],s=(3&a)<<4,h=1;break;case 1:o[u++]=e[s|a>>4],s=(15&a)<<2,h=2;break;case 2:o[u++]=e[s|a>>6],o[u++]=e[63&a],h=0}u>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),u=0)}return h&&(o[u++]=e[s],o[u++]=61,1===h&&(o[u++]=61)),r?(u&&r.push(String.fromCharCode.apply(String,o.slice(0,u))),r.join("")):String.fromCharCode.apply(String,o.slice(0,u))};var o="invalid encoding";n.decode=function(t,i,n){for(var e,r=n,u=0,h=0;h<t.length;){var a=t.charCodeAt(h++);if(61===a&&u>1)break;if(void 0===(a=s[a]))throw Error(o);switch(u){case 0:e=a,u=1;break;case 1:i[n++]=e<<2|(48&a)>>4,e=a,u=2;break;case 2:i[n++]=(15&e)<<4|(60&a)>>2,e=a,u=3;break;case 3:i[n++]=(3&e)<<6|a,u=0}}if(1===u)throw Error(o);return n-r},n.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},358:t=>{"use strict";function i(){this._listeners={}}t.exports=i,i.prototype.on=function(t,i,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:i,ctx:n||this}),this},i.prototype.off=function(t,i){if(void 0===t)this._listeners={};else if(void 0===i)this._listeners[t]=[];else for(var n=this._listeners[t],e=0;e<n.length;)n[e].fn===i?n.splice(e,1):++e;return this},i.prototype.emit=function(t){var i=this._listeners[t];if(i){for(var n=[],e=1;e<arguments.length;)n.push(arguments[e++]);for(e=0;e<i.length;)i[e].fn.apply(i[e++].ctx,n)}return this}},410:t=>{"use strict";function i(t){return"undefined"!=typeof Float32Array?function(){var i=new Float32Array([-0]),n=new Uint8Array(i.buffer),e=128===n[3];function s(t,e,s){i[0]=t,e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2],e[s+3]=n[3]}function r(t,e,s){i[0]=t,e[s]=n[3],e[s+1]=n[2],e[s+2]=n[1],e[s+3]=n[0]}function o(t,e){return n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],i[0]}function u(t,e){return n[3]=t[e],n[2]=t[e+1],n[1]=t[e+2],n[0]=t[e+3],i[0]}t.writeFloatLE=e?s:r,t.writeFloatBE=e?r:s,t.readFloatLE=e?o:u,t.readFloatBE=e?u:o}():function(){function i(t,i,n,e){var s=i<0?1:0;if(s&&(i=-i),0===i)t(1/i>0?0:2147483648,n,e);else if(isNaN(i))t(2143289344,n,e);else if(i>34028234663852886e22)t((s<<31|2139095040)>>>0,n,e);else if(i<11754943508222875e-54)t((s<<31|Math.round(i/1401298464324817e-60))>>>0,n,e);else{var r=Math.floor(Math.log(i)/Math.LN2);t((s<<31|r+127<<23|8388607&Math.round(i*Math.pow(2,-r)*8388608))>>>0,n,e)}}function o(t,i,n){var e=t(i,n),s=2*(e>>31)+1,r=e>>>23&255,o=8388607&e;return 255===r?o?NaN:s*(1/0):0===r?1401298464324817e-60*s*o:s*Math.pow(2,r-150)*(o+8388608)}t.writeFloatLE=i.bind(null,n),t.writeFloatBE=i.bind(null,e),t.readFloatLE=o.bind(null,s),t.readFloatBE=o.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var i=new Float64Array([-0]),n=new Uint8Array(i.buffer),e=128===n[7];function s(t,e,s){i[0]=t,e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2],e[s+3]=n[3],e[s+4]=n[4],e[s+5]=n[5],e[s+6]=n[6],e[s+7]=n[7]}function r(t,e,s){i[0]=t,e[s]=n[7],e[s+1]=n[6],e[s+2]=n[5],e[s+3]=n[4],e[s+4]=n[3],e[s+5]=n[2],e[s+6]=n[1],e[s+7]=n[0]}function o(t,e){return n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],n[4]=t[e+4],n[5]=t[e+5],n[6]=t[e+6],n[7]=t[e+7],i[0]}function u(t,e){return n[7]=t[e],n[6]=t[e+1],n[5]=t[e+2],n[4]=t[e+3],n[3]=t[e+4],n[2]=t[e+5],n[1]=t[e+6],n[0]=t[e+7],i[0]}t.writeDoubleLE=e?s:r,t.writeDoubleBE=e?r:s,t.readDoubleLE=e?o:u,t.readDoubleBE=e?u:o}():function(){function i(t,i,n,e,s,r){var o=e<0?1:0;if(o&&(e=-e),0===e)t(0,s,r+i),t(1/e>0?0:2147483648,s,r+n);else if(isNaN(e))t(0,s,r+i),t(2146959360,s,r+n);else if(e>17976931348623157e292)t(0,s,r+i),t((o<<31|2146435072)>>>0,s,r+n);else{var u;if(e<22250738585072014e-324)t((u=e/5e-324)>>>0,s,r+i),t((o<<31|u/4294967296)>>>0,s,r+n);else{var h=Math.floor(Math.log(e)/Math.LN2);1024===h&&(h=1023),t(4503599627370496*(u=e*Math.pow(2,-h))>>>0,s,r+i),t((o<<31|h+1023<<20|1048576*u&1048575)>>>0,s,r+n)}}}function o(t,i,n,e,s){var r=t(e,s+i),o=t(e,s+n),u=2*(o>>31)+1,h=o>>>20&2047,a=4294967296*(1048575&o)+r;return 2047===h?a?NaN:u*(1/0):0===h?5e-324*u*a:u*Math.pow(2,h-1075)*(a+4503599627370496)}t.writeDoubleLE=i.bind(null,n,0,4),t.writeDoubleBE=i.bind(null,e,4,0),t.readDoubleLE=o.bind(null,s,0,4),t.readDoubleBE=o.bind(null,r,4,0)}(),t}function n(t,i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}function e(t,i,n){i[n]=t>>>24,i[n+1]=t>>>16&255,i[n+2]=t>>>8&255,i[n+3]=255&t}function s(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16|t[i+3]<<24)>>>0}function r(t,i){return(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])>>>0}t.exports=i(i)},153:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},390:t=>{"use strict";t.exports=function(t,i,n){var e=n||8192,s=e>>>1,r=null,o=e;return function(n){if(n<1||n>s)return t(n);o+n>e&&(r=t(e),o=0);var u=i.call(r,o,o+=n);return 7&o&&(o=1+(7|o)),u}}},447:(t,i)=>{"use strict";var n=i;n.length=function(t){for(var i=0,n=0,e=0;e<t.length;++e)(n=t.charCodeAt(e))<128?i+=1:n<2048?i+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(e+1))?(++e,i+=4):i+=3;return i},n.read=function(t,i,n){if(n-i<1)return"";for(var e,s=null,r=[],o=0;i<n;)(e=t[i++])<128?r[o++]=e:e>191&&e<224?r[o++]=(31&e)<<6|63&t[i++]:e>239&&e<365?(e=((7&e)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536,r[o++]=55296+(e>>10),r[o++]=56320+(1023&e)):r[o++]=(15&e)<<12|(63&t[i++])<<6|63&t[i++],o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,r)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,r.slice(0,o))),s.join("")):String.fromCharCode.apply(String,r.slice(0,o))},n.write=function(t,i,n){for(var e,s,r=n,o=0;o<t.length;++o)(e=t.charCodeAt(o))<128?i[n++]=e:e<2048?(i[n++]=e>>6|192,i[n++]=63&e|128):55296==(64512&e)&&56320==(64512&(s=t.charCodeAt(o+1)))?(++o,i[n++]=(e=65536+((1023&e)<<10)+(1023&s))>>18|240,i[n++]=e>>12&63|128,i[n++]=e>>6&63|128,i[n++]=63&e|128):(i[n++]=e>>12|224,i[n++]=e>>6&63|128,i[n++]=63&e|128);return n-r}},21:function(t,i,n){var e;t.exports=(e=e||function(t,i){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(e=globalThis.crypto),!e&&"undefined"!=typeof window&&window.msCrypto&&(e=window.msCrypto),!e&&void 0!==n.g&&n.g.crypto&&(e=n.g.crypto),!e)try{e=n(477)}catch(t){}var s=function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function t(){}return function(i){var n;return t.prototype=i,n=new t,t.prototype=null,n}}(),o={},u=o.lib={},h=u.Base={extend:function(t){var i=r(this);return t&&i.mixIn(t),i.hasOwnProperty("init")&&this.init!==i.init||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},a=u.WordArray=h.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=i?n:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var i=this.words,n=t.words,e=this.sigBytes,s=t.sigBytes;if(this.clamp(),e%4)for(var r=0;r<s;r++)i[e+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(e+r)%4*8;else for(var o=0;o<s;o+=4)i[e+o>>>2]=n[o>>>2];return this.sigBytes+=s,this},clamp:function(){var i=this.words,n=this.sigBytes;i[n>>>2]&=4294967295<<32-n%4*8,i.length=t.ceil(n/4)},clone:function(){var t=h.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(s());return new a.init(i,t)}}),c=o.enc={},l=c.Hex={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++){var r=i[s>>>2]>>>24-s%4*8&255;e.push((r>>>4).toString(16)),e.push((15&r).toString(16))}return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e+=2)n[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new a.init(n,i/2)}},f=c.Latin1={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++)e.push(String.fromCharCode(i[s>>>2]>>>24-s%4*8&255));return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new a.init(n,i)}},d=c.Utf8={stringify:function(t){try{return decodeURIComponent(escape(f.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return f.parse(unescape(encodeURIComponent(t)))}},_=u.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new a.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=d.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(i){var n,e=this._data,s=e.words,r=e.sigBytes,o=this.blockSize,u=r/(4*o),h=(u=i?t.ceil(u):t.max((0|u)-this._minBufferSize,0))*o,c=t.min(4*h,r);if(h){for(var l=0;l<h;l+=o)this._doProcessBlock(s,l);n=s.splice(0,h),e.sigBytes-=c}return new a.init(n,c)},clone:function(){var t=h.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),v=(u.Hasher=_.extend({cfg:h.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(i,n){return new t.init(n).finalize(i)}},_createHmacHelper:function(t){return function(i,n){return new v.HMAC.init(t,n).finalize(i)}}}),o.algo={});return o}(Math),e)},440:function(t,i,n){var e;t.exports=(e=n(21),function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,i=t.init,n=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,e=[],s=0;s<n;s++)e[s>>>2]|=t[s]<<24-s%4*8;i.call(this,e,n)}else i.apply(this,arguments)};n.prototype=t}}(),e.lib.WordArray)},636:function(t,i,n){var e;t.exports=(e=n(21),function(t){var i=e,n=i.lib,s=n.WordArray,r=n.Hasher,o=i.algo,u=[];!function(){for(var i=0;i<64;i++)u[i]=4294967296*t.abs(t.sin(i+1))|0}();var h=o.MD5=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,i){for(var n=0;n<16;n++){var e=i+n,s=t[e];t[e]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var r=this._hash.words,o=t[i+0],h=t[i+1],d=t[i+2],_=t[i+3],v=t[i+4],m=t[i+5],p=t[i+6],g=t[i+7],b=t[i+8],E=t[i+9],S=t[i+10],y=t[i+11],T=t[i+12],R=t[i+13],w=t[i+14],O=t[i+15],I=r[0],N=r[1],C=r[2],k=r[3];I=a(I,N,C,k,o,7,u[0]),k=a(k,I,N,C,h,12,u[1]),C=a(C,k,I,N,d,17,u[2]),N=a(N,C,k,I,_,22,u[3]),I=a(I,N,C,k,v,7,u[4]),k=a(k,I,N,C,m,12,u[5]),C=a(C,k,I,N,p,17,u[6]),N=a(N,C,k,I,g,22,u[7]),I=a(I,N,C,k,b,7,u[8]),k=a(k,I,N,C,E,12,u[9]),C=a(C,k,I,N,S,17,u[10]),N=a(N,C,k,I,y,22,u[11]),I=a(I,N,C,k,T,7,u[12]),k=a(k,I,N,C,R,12,u[13]),C=a(C,k,I,N,w,17,u[14]),I=c(I,N=a(N,C,k,I,O,22,u[15]),C,k,h,5,u[16]),k=c(k,I,N,C,p,9,u[17]),C=c(C,k,I,N,y,14,u[18]),N=c(N,C,k,I,o,20,u[19]),I=c(I,N,C,k,m,5,u[20]),k=c(k,I,N,C,S,9,u[21]),C=c(C,k,I,N,O,14,u[22]),N=c(N,C,k,I,v,20,u[23]),I=c(I,N,C,k,E,5,u[24]),k=c(k,I,N,C,w,9,u[25]),C=c(C,k,I,N,_,14,u[26]),N=c(N,C,k,I,b,20,u[27]),I=c(I,N,C,k,R,5,u[28]),k=c(k,I,N,C,d,9,u[29]),C=c(C,k,I,N,g,14,u[30]),I=l(I,N=c(N,C,k,I,T,20,u[31]),C,k,m,4,u[32]),k=l(k,I,N,C,b,11,u[33]),C=l(C,k,I,N,y,16,u[34]),N=l(N,C,k,I,w,23,u[35]),I=l(I,N,C,k,h,4,u[36]),k=l(k,I,N,C,v,11,u[37]),C=l(C,k,I,N,g,16,u[38]),N=l(N,C,k,I,S,23,u[39]),I=l(I,N,C,k,R,4,u[40]),k=l(k,I,N,C,o,11,u[41]),C=l(C,k,I,N,_,16,u[42]),N=l(N,C,k,I,p,23,u[43]),I=l(I,N,C,k,E,4,u[44]),k=l(k,I,N,C,T,11,u[45]),C=l(C,k,I,N,O,16,u[46]),I=f(I,N=l(N,C,k,I,d,23,u[47]),C,k,o,6,u[48]),k=f(k,I,N,C,g,10,u[49]),C=f(C,k,I,N,w,15,u[50]),N=f(N,C,k,I,m,21,u[51]),I=f(I,N,C,k,T,6,u[52]),k=f(k,I,N,C,_,10,u[53]),C=f(C,k,I,N,S,15,u[54]),N=f(N,C,k,I,h,21,u[55]),I=f(I,N,C,k,b,6,u[56]),k=f(k,I,N,C,O,10,u[57]),C=f(C,k,I,N,p,15,u[58]),N=f(N,C,k,I,R,21,u[59]),I=f(I,N,C,k,v,6,u[60]),k=f(k,I,N,C,y,10,u[61]),C=f(C,k,I,N,d,15,u[62]),N=f(N,C,k,I,E,21,u[63]),r[0]=r[0]+I|0,r[1]=r[1]+N|0,r[2]=r[2]+C|0,r[3]=r[3]+k|0},_doFinalize:function(){var i=this._data,n=i.words,e=8*this._nDataBytes,s=8*i.sigBytes;n[s>>>5]|=128<<24-s%32;var r=t.floor(e/4294967296),o=e;n[15+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(s+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),i.sigBytes=4*(n.length+1),this._process();for(var u=this._hash,h=u.words,a=0;a<4;a++){var c=h[a];h[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return u},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});function a(t,i,n,e,s,r,o){var u=t+(i&n|~i&e)+s+o;return(u<<r|u>>>32-r)+i}function c(t,i,n,e,s,r,o){var u=t+(i&e|n&~e)+s+o;return(u<<r|u>>>32-r)+i}function l(t,i,n,e,s,r,o){var u=t+(i^n^e)+s+o;return(u<<r|u>>>32-r)+i}function f(t,i,n,e,s,r,o){var u=t+(n^(i|~e))+s+o;return(u<<r|u>>>32-r)+i}i.MD5=r._createHelper(h),i.HmacMD5=r._createHmacHelper(h)}(Math),e.MD5)},570:t=>{t.exports=n;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=e;var s={},r={};function o(t,i){var n,e,o;return i?(o=0<=(t>>>=0)&&t<256)&&(e=r[t])?e:(n=h(t,(0|t)<0?-1:0,!0),o&&(r[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(e=s[t])?e:(n=h(t,t<0?-1:0,!1),o&&(s[t]=n),n)}function u(t,i){if(isNaN(t))return i?p:m;if(i){if(t<0)return p;if(t>=d)return y}else{if(t<=-_)return T;if(t+1>=_)return S}return t<0?u(-t,i).neg():h(t%f|0,t/f|0,i)}function h(t,i,e){return new n(t,i,e)}n.fromInt=o,n.fromNumber=u,n.fromBits=h;var a=Math.pow;function c(t,i,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return m;if("number"==typeof i?(n=i,i=!1):i=!!i,(n=n||10)<2||36<n)throw RangeError("radix");var e;if((e=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return c(t.substring(1),i,n).neg();for(var s=u(a(n,8)),r=m,o=0;o<t.length;o+=8){var h=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+h),n);if(h<8){var f=u(a(n,h));r=r.mul(f).add(u(l))}else r=(r=r.mul(s)).add(u(l))}return r.unsigned=i,r}function l(t,i){return"number"==typeof t?u(t,i):"string"==typeof t?c(t,i):h(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=c,n.fromValue=l;var f=4294967296,d=f*f,_=d/2,v=o(1<<24),m=o(0);n.ZERO=m;var p=o(0,!0);n.UZERO=p;var g=o(1);n.ONE=g;var b=o(1,!0);n.UONE=b;var E=o(-1);n.NEG_ONE=E;var S=h(-1,2147483647,!1);n.MAX_VALUE=S;var y=h(-1,-1,!0);n.MAX_UNSIGNED_VALUE=y;var T=h(0,-2147483648,!1);n.MIN_VALUE=T;var R=n.prototype;R.toInt=function(){return this.unsigned?this.low>>>0:this.low},R.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},R.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(T)){var i=u(t),n=this.div(i),e=n.mul(i).sub(this);return n.toString(t)+e.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=u(a(t,6),this.unsigned),r=this,o="";;){var h=r.div(s),c=(r.sub(h.mul(s)).toInt()>>>0).toString(t);if((r=h).isZero())return c+o;for(;c.length<6;)c="0"+c;o=""+c+o}},R.getHighBits=function(){return this.high},R.getHighBitsUnsigned=function(){return this.high>>>0},R.getLowBits=function(){return this.low},R.getLowBitsUnsigned=function(){return this.low>>>0},R.getNumBitsAbs=function(){if(this.isNegative())return this.eq(T)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;i>0&&!(t&1<<i);i--);return 0!=this.high?i+33:i+1},R.isZero=function(){return 0===this.high&&0===this.low},R.eqz=R.isZero,R.isNegative=function(){return!this.unsigned&&this.high<0},R.isPositive=function(){return this.unsigned||this.high>=0},R.isOdd=function(){return!(1&~this.low)},R.isEven=function(){return!(1&this.low)},R.equals=function(t){return e(t)||(t=l(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},R.eq=R.equals,R.notEquals=function(t){return!this.eq(t)},R.neq=R.notEquals,R.ne=R.notEquals,R.lessThan=function(t){return this.comp(t)<0},R.lt=R.lessThan,R.lessThanOrEqual=function(t){return this.comp(t)<=0},R.lte=R.lessThanOrEqual,R.le=R.lessThanOrEqual,R.greaterThan=function(t){return this.comp(t)>0},R.gt=R.greaterThan,R.greaterThanOrEqual=function(t){return this.comp(t)>=0},R.gte=R.greaterThanOrEqual,R.ge=R.greaterThanOrEqual,R.compare=function(t){if(e(t)||(t=l(t)),this.eq(t))return 0;var i=this.isNegative(),n=t.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},R.comp=R.compare,R.negate=function(){return!this.unsigned&&this.eq(T)?T:this.not().add(g)},R.neg=R.negate,R.add=function(t){e(t)||(t=l(t));var i=0,n=0,s=0,r=0;return s+=(r+=(65535&this.low)+(65535&t.low))>>>16,n+=(s+=(this.low>>>16)+(t.low>>>16))>>>16,i+=(n+=(65535&this.high)+(65535&t.high))>>>16,i+=(this.high>>>16)+(t.high>>>16),h((s&=65535)<<16|(r&=65535),(i&=65535)<<16|(n&=65535),this.unsigned)},R.subtract=function(t){return e(t)||(t=l(t)),this.add(t.neg())},R.sub=R.subtract,R.multiply=function(t){if(this.isZero())return m;if(e(t)||(t=l(t)),i)return h(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return m;if(this.eq(T))return t.isOdd()?T:m;if(t.eq(T))return this.isOdd()?T:m;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(v)&&t.lt(v))return u(this.toNumber()*t.toNumber(),this.unsigned);var n=65535&this.high,s=this.low>>>16,r=65535&this.low,o=65535&t.high,a=t.low>>>16,c=65535&t.low,f=0,d=0,_=0,p=0;return _+=(p+=r*c)>>>16,d+=(_+=s*c)>>>16,_&=65535,d+=(_+=r*a)>>>16,f+=(d+=n*c)>>>16,d&=65535,f+=(d+=s*a)>>>16,d&=65535,f+=(d+=r*o)>>>16,f+=(this.high>>>16)*c+n*a+s*o+r*(t.high>>>16),h((_&=65535)<<16|(p&=65535),(f&=65535)<<16|(d&=65535),this.unsigned)},R.mul=R.multiply,R.divide=function(t){if(e(t)||(t=l(t)),t.isZero())throw Error("division by zero");var n,s,r;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?h((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?p:m;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return p;if(t.gt(this.shru(1)))return b;r=p}else{if(this.eq(T))return t.eq(g)||t.eq(E)?T:t.eq(T)?g:(n=this.shr(1).div(t).shl(1)).eq(m)?t.isNegative()?g:E:(s=this.sub(t.mul(n)),r=n.add(s.div(t)));if(t.eq(T))return this.unsigned?p:m;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=m}for(s=this;s.gte(t);){n=Math.max(1,Math.floor(s.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),c=o<=48?1:a(2,o-48),f=u(n),d=f.mul(t);d.isNegative()||d.gt(s);)d=(f=u(n-=c,this.unsigned)).mul(t);f.isZero()&&(f=g),r=r.add(f),s=s.sub(d)}return r},R.div=R.divide,R.modulo=function(t){return e(t)||(t=l(t)),i?h((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},R.mod=R.modulo,R.rem=R.modulo,R.not=function(){return h(~this.low,~this.high,this.unsigned)},R.and=function(t){return e(t)||(t=l(t)),h(this.low&t.low,this.high&t.high,this.unsigned)},R.or=function(t){return e(t)||(t=l(t)),h(this.low|t.low,this.high|t.high,this.unsigned)},R.xor=function(t){return e(t)||(t=l(t)),h(this.low^t.low,this.high^t.high,this.unsigned)},R.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):h(0,this.low<<t-32,this.unsigned)},R.shl=R.shiftLeft,R.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):h(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},R.shr=R.shiftRight,R.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0===(t&=63))return this;var i=this.high;return t<32?h(this.low>>>t|i<<32-t,i>>>t,this.unsigned):h(32===t?i:i>>>t-32,0,this.unsigned)},R.shru=R.shiftRightUnsigned,R.shr_u=R.shiftRightUnsigned,R.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},R.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},R.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},R.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},R.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,e){return e?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)}},946:(t,i,n)=>{"use strict";t.exports=n(394)},394:(t,i,n)=>{"use strict";var e=i;function s(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}e.build="minimal",e.Writer=n(449),e.BufferWriter=n(818),e.Reader=n(237),e.BufferReader=n(158),e.util=n(610),e.rpc=n(47),e.roots=n(529),e.configure=s,s()},237:(t,i,n)=>{"use strict";t.exports=h;var e,s=n(610),r=s.LongBits,o=s.utf8;function u(t,i){return RangeError("index out of range: "+t.pos+" + "+(i||1)+" > "+t.len)}function h(t){this.buf=t,this.pos=0,this.len=t.length}var a,c="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new h(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new h(t);throw Error("illegal buffer")},l=function(){return s.Buffer?function(t){return(h.create=function(t){return s.Buffer.isBuffer(t)?new e(t):c(t)})(t)}:c};function f(){var t=new r(0,0),i=0;if(!(this.len-this.pos>4)){for(;i<3;++i){if(this.pos>=this.len)throw u(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*i)>>>0,t}for(;i<4;++i)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(i=0,this.len-this.pos>4){for(;i<5;++i)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}else for(;i<5;++i){if(this.pos>=this.len)throw u(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,i){return(t[i-4]|t[i-3]<<8|t[i-2]<<16|t[i-1]<<24)>>>0}function _(){if(this.pos+8>this.len)throw u(this,8);return new r(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}h.create=l(),h.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,h.prototype.uint32=(a=4294967295,function(){if(a=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return a;if(a=(a|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return a;if((this.pos+=5)>this.len)throw this.pos=this.len,u(this,10);return a}),h.prototype.int32=function(){return 0|this.uint32()},h.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)},h.prototype.bool=function(){return 0!==this.uint32()},h.prototype.fixed32=function(){if(this.pos+4>this.len)throw u(this,4);return d(this.buf,this.pos+=4)},h.prototype.sfixed32=function(){if(this.pos+4>this.len)throw u(this,4);return 0|d(this.buf,this.pos+=4)},h.prototype.float=function(){if(this.pos+4>this.len)throw u(this,4);var t=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},h.prototype.double=function(){if(this.pos+8>this.len)throw u(this,4);var t=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},h.prototype.bytes=function(){var t=this.uint32(),i=this.pos,n=this.pos+t;if(n>this.len)throw u(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(i,n):i===n?new this.buf.constructor(0):this._slice.call(this.buf,i,n)},h.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},h.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw u(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw u(this)}while(128&this.buf[this.pos++]);return this},h.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},h._configure=function(t){e=t,h.create=l(),e._configure();var i=s.Long?"toLong":"toNumber";s.merge(h.prototype,{int64:function(){return f.call(this)[i](!1)},uint64:function(){return f.call(this)[i](!0)},sint64:function(){return f.call(this).zzDecode()[i](!1)},fixed64:function(){return _.call(this)[i](!0)},sfixed64:function(){return _.call(this)[i](!1)}})}},158:(t,i,n)=>{"use strict";t.exports=r;var e=n(237);(r.prototype=Object.create(e.prototype)).constructor=r;var s=n(610);function r(t){e.call(this,t)}r._configure=function(){s.Buffer&&(r.prototype._slice=s.Buffer.prototype.slice)},r.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},r._configure()},529:t=>{"use strict";t.exports={}},47:(t,i,n)=>{"use strict";i.Service=n(595)},595:(t,i,n)=>{"use strict";t.exports=s;var e=n(610);function s(t,i,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");e.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(i),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(e.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function t(i,n,s,r,o){if(!r)throw TypeError("request must be specified");var u=this;if(!o)return e.asPromise(t,u,i,n,s,r);if(u.rpcImpl)try{return u.rpcImpl(i,n[u.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(t,n){if(t)return u.emit("error",t,i),o(t);if(null!==n){if(!(n instanceof s))try{n=s[u.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return u.emit("error",t,i),o(t)}return u.emit("data",n,i),o(null,n)}u.end(!0)}))}catch(t){return u.emit("error",t,i),void setTimeout((function(){o(t)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},239:(t,i,n)=>{"use strict";t.exports=s;var e=n(610);function s(t,i){this.lo=t>>>0,this.hi=i>>>0}var r=s.zero=new s(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(t){if(0===t)return r;var i=t<0;i&&(t=-t);var n=t>>>0,e=(t-n)/4294967296>>>0;return i&&(e=~e>>>0,n=~n>>>0,++n>4294967295&&(n=0,++e>4294967295&&(e=0))),new s(n,e)},s.from=function(t){if("number"==typeof t)return s.fromNumber(t);if(e.isString(t)){if(!e.Long)return s.fromNumber(parseInt(t,10));t=e.Long.fromString(t)}return t.low||t.high?new s(t.low>>>0,t.high>>>0):r},s.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var i=1+~this.lo>>>0,n=~this.hi>>>0;return i||(n=n+1>>>0),-(i+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var u=String.prototype.charCodeAt;s.fromHash=function(t){return t===o?r:new s((u.call(t,0)|u.call(t,1)<<8|u.call(t,2)<<16|u.call(t,3)<<24)>>>0,(u.call(t,4)|u.call(t,5)<<8|u.call(t,6)<<16|u.call(t,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},s.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},s.prototype.length=function(){var t=this.lo,i=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===i?t<16384?t<128?1:2:t<2097152?3:4:i<16384?i<128?5:6:i<2097152?7:8:n<128?9:10}},610:function(t,i,n){"use strict";var e=i;function s(t,i,n){for(var e=Object.keys(i),s=0;s<e.length;++s)void 0!==t[e[s]]&&n||(t[e[s]]=i[e[s]]);return t}function r(t){function i(t,n){if(!(this instanceof i))return new i(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return(i.prototype=Object.create(Error.prototype)).constructor=i,Object.defineProperty(i.prototype,"name",{get:function(){return t}}),i.prototype.toString=function(){return this.name+": "+this.message},i}e.asPromise=n(45),e.base64=n(839),e.EventEmitter=n(358),e.float=n(410),e.inquire=n(153),e.utf8=n(447),e.pool=n(390),e.LongBits=n(239),e.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),e.global=e.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"==typeof t},e.isset=e.isSet=function(t,i){var n=t[i];return!(null==n||!t.hasOwnProperty(i))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,i){var n=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(n.lo,n.hi,i):n.toNumber(Boolean(i))},e.merge=s,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=r,e.ProtocolError=r("ProtocolError"),e.oneOfGetter=function(t){for(var i={},n=0;n<t.length;++n)i[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===i[t[n]]&&null!=this[t[n]])return t[n]}},e.oneOfSetter=function(t){return function(i){for(var n=0;n<t.length;++n)t[n]!==i&&delete this[t[n]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(i,n){return new t(i,n)},e._Buffer_allocUnsafe=t.allocUnsafe||function(i){return new t(i)}):e._Buffer_from=e._Buffer_allocUnsafe=null}},449:(t,i,n)=>{"use strict";t.exports=l;var e,s=n(610),r=s.LongBits,o=s.base64,u=s.utf8;function h(t,i,n){this.fn=t,this.len=i,this.next=void 0,this.val=n}function a(){}function c(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function l(){this.len=0,this.head=new h(a,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(l.create=function(){return new e})()}:function(){return new l}};function d(t,i,n){i[n]=255&t}function _(t,i){this.len=t,this.next=void 0,this.val=i}function v(t,i,n){for(;t.hi;)i[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)i[n++]=127&t.lo|128,t.lo=t.lo>>>7;i[n++]=t.lo}function m(t,i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}l.create=f(),l.alloc=function(t){return new s.Array(t)},s.Array!==Array&&(l.alloc=s.pool(l.alloc,s.Array.prototype.subarray)),l.prototype._push=function(t,i,n){return this.tail=this.tail.next=new h(t,i,n),this.len+=i,this},(_.prototype=Object.create(h.prototype)).fn=function(t,i,n){for(;t>127;)i[n++]=127&t|128,t>>>=7;i[n]=t},l.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new _((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},l.prototype.int32=function(t){return t<0?this._push(v,10,r.fromNumber(t)):this.uint32(t)},l.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},l.prototype.int64=l.prototype.uint64=function(t){var i=r.from(t);return this._push(v,i.length(),i)},l.prototype.sint64=function(t){var i=r.from(t).zzEncode();return this._push(v,i.length(),i)},l.prototype.bool=function(t){return this._push(d,1,t?1:0)},l.prototype.sfixed32=l.prototype.fixed32=function(t){return this._push(m,4,t>>>0)},l.prototype.sfixed64=l.prototype.fixed64=function(t){var i=r.from(t);return this._push(m,4,i.lo)._push(m,4,i.hi)},l.prototype.float=function(t){return this._push(s.float.writeFloatLE,4,t)},l.prototype.double=function(t){return this._push(s.float.writeDoubleLE,8,t)};var p=s.Array.prototype.set?function(t,i,n){i.set(t,n)}:function(t,i,n){for(var e=0;e<t.length;++e)i[n+e]=t[e]};l.prototype.bytes=function(t){var i=t.length>>>0;if(!i)return this._push(d,1,0);if(s.isString(t)){var n=l.alloc(i=o.length(t));o.decode(t,n,0),t=n}return this.uint32(i)._push(p,i,t)},l.prototype.string=function(t){var i=u.length(t);return i?this.uint32(i)._push(u.write,i,t):this._push(d,1,0)},l.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new h(a,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new h(a,0,0),this.len=0),this},l.prototype.ldelim=function(){var t=this.head,i=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=i,this.len+=n),this},l.prototype.finish=function(){for(var t=this.head.next,i=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,i,n),n+=t.len,t=t.next;return i},l._configure=function(t){e=t,l.create=f(),e._configure()}},818:(t,i,n)=>{"use strict";t.exports=r;var e=n(449);(r.prototype=Object.create(e.prototype)).constructor=r;var s=n(610);function r(){e.call(this)}function o(t,i,n){t.length<40?s.utf8.write(t,i,n):i.utf8Write?i.utf8Write(t,n):i.write(t,n)}r._configure=function(){r.alloc=s._Buffer_allocUnsafe,r.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(t,i,n){i.set(t,n)}:function(t,i,n){if(t.copy)t.copy(i,n,0,t.length);else for(var e=0;e<t.length;)i[n++]=t[e++]}},r.prototype.bytes=function(t){s.isString(t)&&(t=s._Buffer_from(t,"base64"));var i=t.length>>>0;return this.uint32(i),i&&this._push(r.writeBytesBuffer,i,t),this},r.prototype.string=function(t){var i=s.Buffer.byteLength(t);return this.uint32(i),i&&this._push(o,i,t),this},r._configure()},783:function(t){"undefined"!=typeof self&&self,t.exports=function(){return i=[function(t,i,n){n.r(i),n.d(i,"ZegoLogger",(function(){return rt})),n.d(i,"ZegoDataReport",(function(){return d})),n.d(i,"createZegoWebSocket",(function(){return l})),n.d(i,"LoggerStateCenter",(function(){return o})),u.getInstance=function(){return u.instance||(u.instance=new u).u(),u.instance},u.prototype.u=function(){},Object.defineProperty(u.prototype,"testEnvironment",{get:function(){return this.h},set:function(t){this.h=t},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"ENV",{get:function(){return this.v},set:function(t){this.v=t},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"debug",{get:function(){return this.g},set:function(t){this.g=t},enumerable:!1,configurable:!0}),u.instance=new u;var e,s,r,o=u;function u(){this.h=!0,this.v=0,this.g=!0}(n=W=W||{})[n.IE=0]="IE",n[n.FIREFOX=1]="FIREFOX",n[n.CHROME=2]="CHROME",n[n.SAFARI=3]="SAFARI",n[n.OPERA=4]="OPERA",n[n.WEIXIN=5]="WEIXIN",n[n.WEIXINMINI=6]="WEIXINMINI",n[n.UNKOWN=7]="UNKOWN",(i=e=e||{})[i.BROWSER=0]="BROWSER",i[i.WEIXINMINI=1]="WEIXINMINI",(s=s||{})[s.DEFAULT=0]="DEFAULT",(W=r=r||{})[W.DISABLE=0]="DISABLE",W[W.WEBSOCKET=1]="WEBSOCKET",W[W.HTTPS=2]="HTTPS";var h={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},a=(c.prototype.init=function(){var t=this;this.O&&(this.readyState=0,this.O.onOpen((function(i){t.readyState=t.O.readyState,"function"==typeof t.onopen&&(t.onopen(i),t.O.onClose((function(i){t.readyState=t.O.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t.O.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this.O.onError((function(i){t.readyState=t.O.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},c.prototype.onopen=function(t){},c.prototype.onerror=function(t){},c.prototype.onclose=function(t){},c.prototype.onmessage=function(t){},c.prototype.send=function(t){this.O&&this.O.send({data:t})},c.prototype.close=function(){this.O&&this.O.close()},c);function c(t,i){this.url=t,this.readyState=3,this.O=wx.connectSocket({url:t}),this.init()}function l(t,i,n){return i%2===e.BROWSER?(i=t,n?n.createSocket(i,1):new WebSocket(i)):new a(t)}var f=function(){return(f=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},d=(_.prototype.newReport=function(t,i){this.dataStatistics[t]={event_time:Date.now(),time_consumed:0,seq:t,error:0,message:"success",event:i,events:[]}},_.prototype.addMsgExt=function(t,i){this.dataStatistics[t]?this.dataStatistics[t].msg_ext=i:console.warn("".concat(t," not exist"))},_.prototype.addMsgInfo=function(t,i){this.dataStatistics[t]?Object.assign(this.dataStatistics[t],i):console.warn("".concat(t," not exist"))},_.prototype.eventStart=function(t,i){this.dataStatistics[t]?null==this.dataStatistics[t].events?this.logger.warn("zd.es.0 no events"):this.dataStatistics[t].events.push({event:i,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no seq match")},_.prototype.eventEnd=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e&&0!==e.length){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},_.prototype.eventEndWithMsg=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time,null==e[s].msg_ext&&(e[s].msg_ext={}),e[s].msg_ext=f({},n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},_.prototype.eventEndWithMsgInfo=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time,Object.assign(e[s],n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},_.prototype.addEventInfo=function(t,i,n,e){if(this.dataStatistics[t]){var s=this.dataStatistics[t].events;if(null==s)this.logger.warn("zd.aei.0 no events");else for(var r=s.length-1;0<=r;r--)if(s[r].event==i&&null!=s[r].time_consumed){null==s[r].msg_ext?s[r].msg_ext={}:s[r].msg_ext&&(s[r].msg_ext[n]=e);break}}else this.logger.warn("zd.aei.0 no seq match")},_.prototype.addEventMsg=function(t,i,n,e){if(this.dataStatistics[t]){var s=this.dataStatistics[t].events;if(null==s)this.logger.warn("zd.aem.0 no events");else for(var r=s.length-1;0<=r;r--)if(s[r].event==i){s[r][n]=e;break}}else this.logger.warn("zd.aem.0 no seq match")},_.prototype.addEvent=function(t,i,n){this.dataStatistics[t]?this.dataStatistics[t].events&&this.dataStatistics[t].events.push(n?{event:i,event_time:Date.now(),msg_ext:n}:{event:i,event_time:Date.now()}):this.logger.warn("zd.ae.0 no seq match")},_.prototype.uploadReport=function(t,i,n,e){var s=this.dataStatistics[t];null!=s&&(i&&(s.event=i),s.time_consumed=Date.now()-s.event_time,n&&this.addMsgInfo(t,{error:n.code,message:n.message||n.msg+" "+(e||"")}),this.logger.report(s),delete this.dataStatistics[t])},_);function _(t){this.dataStatistics={},this.logger=t}var v,m=["00","01","02","03","04","05","06","07","08","09"];function p(){var t=new Date;return[t.getFullYear()+"/",(m[t.getMonth()+1]||t.getMonth()+1)+"/",(m[t.getDate()]||t.getDate())+" ",(m[t.getHours()]||t.getHours())+":",(m[t.getMinutes()]||t.getMinutes())+":",m[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")}(n=v=v||{}).WEBSOCKET_STATE_CHANGE="zl.net.wsc",n.OPEN_WS="zl.net.opws";var g=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},b=(Object.defineProperty(E.prototype,"url",{get:function(){return this.j.url},set:function(t){this.j.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(E.prototype,"strategy",{get:function(){return this._.strategy},enumerable:!1,configurable:!0}),E.prototype.setStrategy=function(t){this._.setStrategy(t),this.S=this._.build()},E.prototype.addRemoteWsLog=function(t){var i;if(this.j.env!=e.BROWSER)throw new Error("cannot use net strategy on wx mini program");this.closed()&&(i=this.url,this.url="",this.openWebSocketLogServer(i)),this.N.push(t),this.connected()&&this.S&&this.S.active()},E.prototype.stopWebSocketServer=function(){this.O&&(this.O.onclose=null,this.O.onerror=null,this.O.close(),this.O=null)},E.prototype.I=function(){this.O&&this.j.useStrategy&&(this._.setWs(this.O),this._.setCache(this.N),this.S=this._.build())},E.prototype.T=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var e=this.A=this.D,s="";switch(t){case"onconnecting":this.D="never_opened"===this.D?"first_connecting":"reconnecting";break;case"onopen":this.D="connected";break;case"onclosed":this.D="closed";var r=i[0];r&&(s+=" close code=".concat(r.code));break;case"onerror":this.D="error"}t=v.WEBSOCKET_STATE_CHANGE+" log ws state change: ".concat(e," -> ").concat(this.D),s&&(t+=s),"error"===this.D?this.k.warn(t):this.k.info(t)},E.prototype.openWebSocketLogServer=function(t,i){var n,e=this;void 0===i&&(i=!1),this.url!=t&&((this.url&&""!==this.url||"never_opened"===this.D)&&this.k.info(v.OPEN_WS+" log url change to: ".concat(t)),this.url=t)&&(n=function(){e.R&&(clearTimeout(e.R),e.R=null),e.stopWebSocketServer(),e.O=l(t,e.j.env,e.C),e.I(),e.T("onconnecting"),e.O.onopen=function(){var t;e.j.useStrategy&&null!=(t=e.S)&&t.active(),e.T("onopen")},e.O.onclose=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];e.T.apply(e,g(["onclosed"],t,!1))},e.O.onmessage=function(){},e.O.onerror=function(){for(var t=0;t<arguments.length;t++);e.T("onerror")}},i||"error"!==this.D&&"error"!==this.A?n():this.R||(this.R=setTimeout(n,5e3)))},E.prototype.closed=function(){return null==this.O||2==this.O.readyState||3==this.O.readyState},E.prototype.connected=function(){return null!==this.O&&1==this.O.readyState},E.prototype.connecting=function(){return null!==this.O&&0==this.O.readyState},E.prototype.wsSend=function(t){this.O&&this.O.send(t)},E.prototype.destroy=function(){this.O=null},E);function E(t,i,n,e){this.N=t,this.j=i,this.k=n,this.C=e,this.O=null,this.D="never_opened",this.A="never_opened",this._=new B,this.S=null,this.R=null}y.prototype.active=function(){var t=this;this.J&&1===this.J.readyState&&0!==this.N.size()&&this.W.canSendLog()&&(this.W.getLog().forEach((function(i){t.J.send(i)})),this.W.onSendLog())};var S=y;function y(t,i,n){this.J=t,this.N=i,this.W=n,this.W.onCanSendActive=this.active.bind(this)}function T(t){this.cache=t}R=function(t,i){return(R=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}R(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(C,w=T),C.prototype.getLog=function(){return this.cache.clear()},C.prototype.canSendLog=function(){return 0<this.cache.size()},C.prototype.onSendLog=function(){};var R,w,O,I,N=C;function C(t){return w.call(this,t)||this}function k(){var t=null!==I&&I.apply(this,arguments)||this;return t.maxDelay=10,t.maxPacketLen=20480,t.locked=!1,t}O=function(t,i){return(O=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}O(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(k,I=T),k.prototype.canSendLog=function(){return!this.locked&&0<this.cache.size()},k.prototype.getLog=function(){for(var t=[],i=0;i<this.maxPacketLen-4e3;){var n=this.cache.getOneLogPacket();if(!n||n.length<=0)break;i+=n.length||0,t.push(n)}return t},k.prototype.onSendLog=function(){var t=this;this.locked=!0,setTimeout((function(){t.locked=!1,t.onCanSendActive&&t.onCanSendActive()}),this.maxDelay)},D=function(t,i){return(D=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}D(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(G,z=i=k);var D,z,A,P,M,x,U,q,L=G;function G(t){return(t=z.call(this,t)||this).maxDelay=10,t.maxPacketLen=20480,t}function H(){return null!==P&&P.apply(this,arguments)||this}function j(){return null!==x&&x.apply(this,arguments)||this}function $(){return null!==q&&q.apply(this,arguments)||this}A=function(t,i){return(A=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}A(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(H,P=i),M=function(t,i){return(M=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}M(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(j,x=i),U=function(t,i){return(U=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}U(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}($,q=i),Object.defineProperty(V.prototype,"strategy",{get:function(){return this.W},enumerable:!1,configurable:!0}),V.prototype.setWs=function(t){this.J=t},V.prototype.setCache=function(t){this.N=t},V.prototype.setStrategy=function(t){t&&(this.W=t)},V.prototype.build=function(){if(this.J&&this.N)return new S(this.J,this.N,this.W!==s.DEFAULT?new N(this.N):new L(this.N));throw new Error("cannot build log sender")};var B=V;function V(){this.W=s.DEFAULT}F.q=function(){return!1},F.id=function(){return F.q(),""},F.B="z_deviceID";var J=F;function F(){}var Y=function(){this.url="",this.env=e.BROWSER,this.useStrategy=!0,this.token="",this.deviceid=J.id()};Object.defineProperty(X.prototype,"buffer",{get:function(){return this.queue},set:function(t){this.queue=t},enumerable:!1,configurable:!0}),X.prototype.push=function(t){if(!t)throw new Error("item null!");t&&this.queue.push(t)},X.prototype.pop=function(){return this.queue.shift()},X.prototype.front=function(){return this.queue[0]};var W=X;function X(){this.queue=[]}Z=function(t,i){return(Z=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};var Z,K,Q=function(){return(Q=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},tt=(function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}Z(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(it,K=W),it.prototype.size=function(){return this.queue.length},it.prototype.getOneLogPacket=function(){var t="";if(this.size()){var i=JSON.parse(this.queue[this.queue.length-1]).userid,n=this.j.userid||i;if(n){for(;0<this.queue.length;){if(4e3<(t+this.queue[0]).length)return t;var e=JSON.parse(this.queue[0]);e=Q(Q({},e),{userid:e.userid||n,roomid:e.roomid||this.j.roomid,userName:e.userName||this.j.userName}),t=t+JSON.stringify(e)+"\n",this.queue.shift()}return""===t?void 0:t}}},it.prototype.clear=function(){for(var t=[];0<this.queue.length;){var i=this.getOneLogPacket();if(!i)break;t.push(i)}return t},it);function it(t){var i=K.call(this)||this;return i.j=t,i}var nt=function(){return(nt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},et=function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},st=function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var a=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&a[o=0]?0:r;)try{if(n=1,e&&(s=2&a[0]?e.return:a[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,a[1])).done)return s;switch(e=0,(a=s?[2&a[0],s.value]:a)[0]){case 0:case 1:s=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,e=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3]))r.label=a[1];else if(6===a[0]&&r.label<s[1])r.label=s[1],s=a;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(a)}}a=i.call(t,r)}catch(h){a=[6,h],e=0}finally{n=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}}},rt=(Object.defineProperty(ot.prototype,"url",{get:function(){return this.j.url||""},set:function(t){this.j.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"logType",{get:function(){return this.j.logType||r.DISABLE},set:function(t){this.j.logType=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"env",{get:function(){return this.j.env},set:function(t){this.j.env=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"appid",{get:function(){return this.j.appid},set:function(t){this.j.appid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"roomid",{get:function(){return this.j.roomid},set:function(t){this.j.roomid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"sessionid",{get:function(){return this.j.sessionid},set:function(t){this.j.sessionid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"userid",{get:function(){return this.j.userid},set:function(t){this.j.userid=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"userName",{get:function(){return this.j.userName},set:function(t){this.j.userName=t},enumerable:!1,configurable:!0}),Object.defineProperty(ot.prototype,"version",{get:function(){return this.j.version},set:function(t){this.j.version=t},enumerable:!1,configurable:!0}),ot.prototype.setLogLevel=function(t){return void 0!==(t=h[t])&&(this.logLevel=t,!0)},ot.prototype.setRemoteLogLevel=function(t){return void 0!==(t=h[t])&&(this.logRemoteLevel=t,!0)},ot.prototype.setSessionInfo=function(t,i,n,e,s,r){this.appid=t,this.roomid=i,this.sessionid=n,this.userid=e,this.userName=s,this.version=r},ot.prototype.setTokenInfo=function(t,i,n){this.j.token=t||"",i&&(this.j.userid=i),n&&(this.j.userName=n)},ot.prototype.setZipLogConfig=function(t,i){},ot.prototype.setZipLogUploadUrl=function(t){},ot.prototype.makeZipLogSpaceUpload=function(){return et(this,void 0,void 0,(function(){return st(this,(function(t){return[2]}))}))},ot.prototype.uploadStorageLog=function(){return et(this,void 0,void 0,(function(){return st(this,(function(t){return[2]}))}))},ot.prototype.report=function(t){t=this.F(h.REPORT,t),this.logLevel!==h.DISABLE&&this.logLevel<=h.REPORT&&!this.isDestroy&&console.debug(t),this.L(h.REPORT,t,!0)},ot.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.M(h.DEBUG,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.DEBUG&&!this.isDestroy&&console.debug(n),this.P(h.DEBUG,n)},ot.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.M(h.INFO,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.INFO&&!this.isDestroy&&console.info(n),this.P(h.INFO,n)},ot.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.M(h.WARN,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.WARN&&!this.isDestroy&&console.warn(n),this.P(h.WARN,n)},ot.prototype.remoteReport=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.M(h.INFO,t.join(""));this.P(h.INFO,n)},ot.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=wx,s=this.M(h.ERROR,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.ERROR&&!this.isDestroy&&(console.error(s),this.env%2===e.BROWSER&&window?this.stateCenter.debug&&window.alert(t.join("").substr(t.join("").indexOf(" ")+1,4500)):this.env%2===e.WEIXINMINI&&n&&this.stateCenter.debug&&wx.showModal({title:"",content:t.join("").substr(t.join("").indexOf(" ")+1,4500)})),this.P(h.ERROR,s)},ot.prototype.P=function(t,i){this.logRemoteLevel!==h.DISABLE&&this.logRemoteLevel<=t&&(this.L(t,i),this._zipLogContext)&&this._zipLogContext.saveLog(i)},ot.prototype.setLogServer=function(t){if(this.isDestroy)return!1;try{return t.startsWith("wss:")?(this.logType=r.WEBSOCKET,this.X.openWebSocketLogServer(t,!0)):t.startsWith("https:")?(this.logType=r.HTTPS,this.U(t)):this.logType=r.DISABLE,!0}catch(t){return this.error(JSON.stringify(t)),!1}},ot.prototype.Z=function(){this.logType==r.WEBSOCKET?this.G():this.logType==r.HTTPS&&(this.H(),this.K()),this.logType=r.DISABLE},ot.prototype.G=function(){this.X.stopWebSocketServer()},ot.prototype.U=function(t){var i=this;(this.url=t)&&(this.K(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){i.H()}),this.logUploadInterval)))},ot.prototype.K=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},ot.prototype.L=function(t,i,n){return void 0===n&&(n=!1),et(this,void 0,void 0,(function(){return st(this,(function(e){if(!this.isDestroy)if(this.logType==r.WEBSOCKET)this.V(t,i);else if(this.logType==r.HTTPS)this.Y(t,i,n);else if(this.logLevel!==h.DISABLE&&this.logLevel<=t)for(this.$.push(i);this.$.size()>this.tt;)this.$.pop();return[2]}))}))},ot.prototype.nt=function(){var t=this;this.X.connected()&&this.$.clear().forEach((function(i){t.X.wsSend(i)}))},ot.prototype.clearCache=function(){0!==this.$.size()&&this.nt()},ot.prototype.it=function(t){this.$.size()<this.tt&&this.$.push(t)},ot.prototype.et=function(t){this.X.connected()?this.X.wsSend(t):this.it(t)},ot.prototype.V=function(t,i){return et(this,void 0,void 0,(function(){var t;return st(this,(function(n){return"string"==typeof i&&4e3<i.length?console.info("log over maximum, ignore"):this.j.useStrategy&&this.env==e.BROWSER?this.X.addRemoteWsLog(i):this.X.closed()?(t=this.url,this.url="",this.setLogServer(t),this.it(i)):this.X.connecting()?this.it(i):this.X.connected()&&(this.clearCache(),this.et(i)),[2]}))}))},ot.prototype.Y=function(t,i,n){this.$.push(i),(this.$.size()>=this.tt||!0===n)&&this.H()},ot.prototype.M=function(t,i){var n={time:n=p(),level:t,action:(i=[i.substr(0,i.indexOf(" "))||i,i.substr(i.indexOf(" ")+1,4500)||i])[0],content:i[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(n)},ot.prototype.F=function(t,i){var n=p(),s="";return s=this.env%2===e.BROWSER?"rtc":"xcx",i=nt(nt({},i),{time:n,level:t,console:s,appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+i.event_time+"_"+i.seq}),JSON.stringify(i)},ot.prototype.H=function(){0!=this.$.size()&&(this.env%2===e.BROWSER?this.st():this.SendHttpsLogWeChatMini())},ot.prototype.st=function(){},ot.prototype.SendHttpsLogWeChatMini=function(){var t=this;if(!this.existUserID){if(!this.userid)return void console.log("no userid");this.$.buffer.forEach((function(i,n){(i=JSON.parse(i))&&""==i.userid?(i.userid=t.userid,i.id_name=i.id_name||t.userid,i.roomid=i.roomid||t.roomid,i.userName=i.userName||t.userName,t.$.buffer[n]=JSON.stringify(i)):t.existUserID=!0}))}var i=this.$.buffer.join("\n"),n=this.$.buffer;i=1==this.env?i:JSON.stringify({user_id:this.userid,log:i}),(0,wx.request)({url:this.url,data:i,method:"POST",success:function(i){0!=i.data.length&&("number"==typeof(i=i&&i.data&&i.data.interval)&&t.logUploadInterval!==i&&(t.timeInterval=i,t.U(t.url)),n=null)},fail:function(i){t.$.buffer=n.concat(t.$.buffer),console.log("send failed "+i.statusCode),n=null}}),this.$.buffer=[]},ot.prototype.destroy=function(){this.Z(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),o.instance=void 0,this.X.destroy(),this._zipLogContext&&this._zipLogContext.destroy(),this.url="",this.isDestroy=!0},ot.logVersion="1.4.7",ot);function ot(t,i){var n=this;this.proxyCtrl=i,this.logLevel=h.INFO,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.existUserID=!1,this.isDestroy=!1,this.tt=8192,this.k={debug:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.debug.apply(n,t)},info:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.info.apply(n,t)},warn:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.warn.apply(n,t)},error:function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];n.error.apply(n,t)}},this.stateCenter=o.getInstance(),this.j=new Y,this.j.env=t,this.$=new tt(this.j),this.X=new b(this.$,this.j,this.k,this.proxyCtrl)}}],n={},t.m=i,t.c=n,t.d=function(i,n,e){t.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:e})},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"rt",{value:!0})},t.t=function(i,n){if(1&n&&(i=t(i)),8&n)return i;if(4&n&&"object"==typeof i&&i&&i.rt)return i;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:i}),2&n&&"string"!=typeof i)for(var s in i)t.d(e,s,function(t){return i[t]}.bind(null,s));return e},t.n=function(i){var n=i&&i.rt?function(){return i.default}:function(){return i};return t.d(n,"a",n),n},t.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},t.p="",t(t.s=0);function t(e){var s;return(n[e]||(s=n[e]={i:e,l:!1,exports:{}},i[e].call(s.exports,s,s.exports,t),s.l=!0,s)).exports}var i,n}()},423:(t,i,n)=>{"use strict";n.d(i,{A:()=>f});var e=n(946);const s=n(570);e.util.Long=s,e.util.Long.fromBits=e.util.Long?e.util.Long.fromBits:function(){return 0};for(var r=e.roots,o=e.types?e.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},u=e.types?e.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},h=Object.keys(o),a={$:function(t){return a[t]?a[t].call(this):r[t].decode?r[t].decode(this,this.uint32()):a.$.call(this,"int32")}},c={$:function(t,i,n){var e=o[t];return void 0===e?r[t].encode?(this.uint32(n<<3|2).fork(),r[t].encode(i,this).ldelim()):c.$.call(this,"int32",i,n):c[t].call(this.uint32(n<<3|e),i)}},l=0;l<h.length;l++)a[h[l]]=e.Reader.prototype[h[l]],c[h[l]]=e.Writer.prototype[h[l]];!function t(i,n,s,h){for(var l=0,f=Object.keys(i);l<f.length;l++){var d=f[l];if(i[d].$m&&Object.keys(i[d].$m).every((function(t){return Number(t)}))){if(s[d])throw Error(`nested type ${s}.${d} has already exist`);s[d]=function(i,s){function h(t){for(var n in i){var e=i[n];"{"===e[1].charAt(0)?this[e[0]]={}:"["!==e[1].charAt(0)&&"<"!==e[1].charAt(0)||(this[e[0]]=[])}if(t)for(var s=Object.keys(t),r=0;r<s.length;++r)null!=t[s[r]]&&(this[s[r]]=t[s[r]])}var l={};for(var f in i){var d=i[f],_=d[1];"{"===_.charAt(0)?(h.prototype[d[0]]=e.util.emptyObject,l[_]={$m:_.substring(1).split(",").map((function(t,i){return[`$${i+1}`,t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):h.prototype[d[0]]="["===_.charAt(0)||"<"===_.charAt(0)?e.util.emptyArray:"bytes"===_?e.util.newBuffer([]):d[2]&&d[2].hasOwnProperty("low")&&d[2].hasOwnProperty("high")?e.util.Long.fromBits(d[2].low,d[2].high,d[2].unsigned):d[2]}return h.create=function(t){return new h(t)},h.decode=function(t,n){t instanceof e.Reader||(t=e.Reader.create(t));for(var s=void 0===n?t.len:t.pos+n,o=new h;t.pos<s;){var c=t.uint32(),l=c>>>3;if(l>0&&i[l]){var f=i[l][0],d=i[l][1];if("{"===d.charAt(0)){o[f]===e.util.emptyObject&&(o[f]={});var _=h.$namespace[d].decode(t,t.uint32());o[f][_.$1]=_.$2}else if("["===d.charAt(0)||"<"===d.charAt(0)){d=d.substring(1),o[f]&&o[f].length||(o[f]=[]);if(void 0!==u[d=!a[d]&&!r[d].decode?"int32":d]&&2==(7&c))for(var v=t.uint32()+t.pos;t.pos<v;)o[f].push(a.$.call(t,d));else o[f].push(a.$.call(t,d))}else o[f]=a.$.call(t,d)}else t.skipType(7&c)}return o},h.encode=function(t,n){for(var s in n||(n=e.Writer.create()),i){var a=i[s][0],l=i[s][1];if("{"===l.charAt(0)){if(null!=t[a]&&t.hasOwnProperty(a))for(var f=0,d=Object.keys(t[a]);f<d.length;++f)n.uint32(s<<3|2).fork(),h.$namespace[l].encode({$1:d[f],$2:t[a][d[f]]},n).ldelim()}else if("["===l.charAt(0)||"<"===l.charAt(0)){var _="<"===l.charAt(0);l=l.substring(1);var v=t[a];if(null!=v&&v.length){if(l=void 0===o[l]&&!r[l].encode?"int32":l,_&&void 0!==u[l]){n.uint32(s<<3|2).fork();for(f=0;f<v.length;f++)c[l].call(n,v[f]);n.ldelim()}else for(f=0;f<v.length;f++)c.$.call(n,l,v[f],s)}}else null!=t[a]&&t.hasOwnProperty(a)&&c.$.call(n,l,t[a],s)}return n},Object.keys(l).length&&(h.$namespace=t(l,n+"."+s,h.$namespace||{},!0)),h}(i[d].$m,d)}else i[d].$s?s[d]=function(t,i){function s(t,i,n){e.rpc.Service.call(this,t,i,n)}return(s.prototype=Object.create(e.rpc.Service.prototype)).constructor=s,s.create=function(t,i,n){return new s(t,i,n)},Object.keys(t).forEach((function(e){var o=t[e];function u(t,i){return this.rpcCall(u,r[o[0]],r[o[1]],t,i)}Object.defineProperty(u,"name",{value:e}),Object.defineProperty(u,"path",{value:`${n}.${i}`}),s.prototype[e]=u})),s}(i[d].$s,d):i[d].$e&&Object.values(i[d].$e).every((function(t){return Number(t)===t}))&&(s[d]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[d].$e));s[d]&&!h&&(r[`${n}.${d}`]=s[d]),delete i[d].$m,delete i[d].$s,delete i[d].$e,s[d]=t(i[d],n?`${n}.${d}`:d,s[d]||{})}return s}({mixstream:{proto_mixstream:{AutoRoomMixOutputStream:{$m:{1:["stream_out_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["audio_channel_cnt","int32",0]}},AutoRoomMixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],3:["mix_source","string",""],4:["room_id","string",""],5:["task_id","string",""],6:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],7:["output_stream","<mixstream.proto_mixstream.AutoRoomMixOutputStream",null],8:["extra_params","<mixstream.proto_mixstream.MixAdvanceConfig",null],9:["has_recv_buffer_level","bool",!1],10:["recv_buffer_level","sint32",0]}},AutoRoomMixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},AutoRoomMixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""]}},AutoRoomMixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},GetMixStreamStatusRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},GetMixStreamStatusResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["push_url","<mixstream.proto_mixstream.PushUrl",null],4:["version","int32",0],5:["task_id","string",""]}},MixAdvanceConfig:{$m:{1:["key","string",""],2:["value","string",""]}},MixImage:{$m:{1:["url","string",""],2:["display_mode","int32",0]}},MixInputStream:{$m:{1:["stream_input_common","mixstream.proto_mixstream.MixInputStreamCommon",null],2:["volume","int32",0],3:["audio_focus","int32",0],4:["audio_h_angle","int32",0],5:["render_mode","int32",0],6:["corner_radius","uint32",0],7:["label","mixstream.proto_mixstream.MixLabel",null],8:["image","mixstream.proto_mixstream.MixImage",null]}},MixInputStreamCommon:{$m:{1:["stream_id","string",""],2:["sound_level_id","uint32",0],3:["content_control","int32",0],4:["layer_rect","mixstream.proto_mixstream.MixRect",null],5:["stream_url","string",""]}},MixLabel:{$m:{1:["text","string",""],2:["text_left","int32",0],3:["text_top","int32",0],4:["font","mixstream.proto_mixstream.MixLableFont",null]}},MixLableFont:{$m:{1:["font_type","int32",0],2:["font_size","int32",0],3:["font_color","int32",0],4:["font_transparency","int32",0],5:["font_border_color","sint32",0]}},MixOutputStream:{$m:{1:["output_stream_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["video_enc_id","int32",0],3:["video_encode_latency","int32",0],4:["video_encode_profile","int32",0],5:["low_bitrate_hd","int32",0]}},MixOutputStreamCommon:{$m:{1:["is_url","int32",0],2:["target","string",""],3:["video_fps","int32",0],4:["rate_control_mode","int32",0],5:["video_bitrate","int32",0],6:["video_width","int32",0],7:["video_height","int32",0],8:["output_quality","int32",0],9:["audio_bitrate","int32",0],10:["audio_enc_id","int32",0]}},MixRect:{$m:{1:["top","int32",0],2:["left","int32",0],3:["bottom","int32",0],4:["right","int32",0],5:["layer","int32",0]}},MixStartReplyData:{$m:{1:["request_id","string",""],2:["play_infos","<mixstream.proto_mixstream.PlayInfo",null]}},MixStreamCommon:{$m:{1:["user_data","string",""],2:["output_bg_color","int32",0],3:["output_bg_image","string",""],4:["with_sound_level","int32",0],5:["single_stream_pass_through","int32",0],6:["alignment_type","int32",0]}},MixstreamServerCommonResponse:{$m:{1:["code","uint32",0],2:["message","string",""]}},MixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_protocol_version","int32",0],3:["task_id","string",""],4:["room_id","string",""],5:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],6:["audio_channel_cnt","int32",0],7:["audio_mix_mode","int32",0],8:["recv_buffer_level","sint32",0],9:["input_stream","<mixstream.proto_mixstream.MixInputStream",null],10:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],11:["advance_config","<mixstream.proto_mixstream.MixAdvanceConfig",null],12:["output_stream","<mixstream.proto_mixstream.MixOutputStream",null],13:["white_board","mixstream.proto_mixstream.MixWhiteBoard",null],14:["timestamp","int64",{low:0,high:0,unsigned:!1}],15:["check_image_mode","int32",0]}},MixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["data","mixstream.proto_mixstream.MixStartReplyData",null],4:["error_streamid_list","<string",null]}},MixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""],4:["is_url","int32",0],5:["target","string",""],6:["timestamp","int64",{low:0,high:0,unsigned:!1}]}},MixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},MixStreamTaskHbRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""]}},MixStreamTaskHbResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["status","uint32",0],4:["hb_interval","uint32",0]}},MixWaterMark:{$m:{1:["image","string",""],2:["layout_rect","mixstream.proto_mixstream.MixRect",null]}},MixWhiteBoard:{$m:{1:["whiteboard_id","uint64",{low:0,high:0,unsigned:!0}],2:["horizontal_ratio","int32",0],3:["vertical_ratio","int32",0],4:["is_ppt_animation","int32",0],5:["layout_rect","mixstream.proto_mixstream.MixRect",null],6:["background_color","int32",0]}},PlayInfo:{$m:{1:["stream_alias","string",""],2:["rtmp_url","string",""],3:["hls_url","string",""],4:["hdl_url","string",""]}},PushUrl:{$m:{1:["status","int32",0],2:["url","string",""],3:["mod_time","int64",{low:0,high:0,unsigned:!1}],4:["reason","int32",0]}}}}},"",r,!1);const f=r.mixstream},960:(t,i,n)=>{"use strict";var e,s=n(946),r=s.Reader,o=s.Writer,u=s.util,h=s.roots.default||(s.roots.default={});h.proto_media=((e={}).MediaServerCommonResponse=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.code=0,t.prototype.message="",t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&i.uint32(8).uint32(t.code),null!=t.message&&Object.hasOwnProperty.call(t,"message")&&i.uint32(18).string(t.message),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.MediaServerCommonResponse;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.code=t.uint32();break;case 2:e.message=t.string();break;default:t.skipType(7&s)}}return e},t}(),e.RelayPublishCdnRequest=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.request_seq=0,t.prototype.request_cmd=0,t.prototype.streamid="",t.prototype.cdn_server="",t.prototype.publish_timeout=0,t.prototype.request_seq_v2=u.Long?u.Long.fromBits(0,0,!0):0,t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.request_seq&&Object.hasOwnProperty.call(t,"request_seq")&&i.uint32(8).uint32(t.request_seq),null!=t.request_cmd&&Object.hasOwnProperty.call(t,"request_cmd")&&i.uint32(16).int32(t.request_cmd),null!=t.streamid&&Object.hasOwnProperty.call(t,"streamid")&&i.uint32(26).string(t.streamid),null!=t.cdn_server&&Object.hasOwnProperty.call(t,"cdn_server")&&i.uint32(34).string(t.cdn_server),null!=t.publish_timeout&&Object.hasOwnProperty.call(t,"publish_timeout")&&i.uint32(40).uint32(t.publish_timeout),null!=t.request_seq_v2&&Object.hasOwnProperty.call(t,"request_seq_v2")&&i.uint32(48).uint64(t.request_seq_v2),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.RelayPublishCdnRequest;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.request_seq=t.uint32();break;case 2:e.request_cmd=t.int32();break;case 3:e.streamid=t.string();break;case 4:e.cdn_server=t.string();break;case 5:e.publish_timeout=t.uint32();break;case 6:e.request_seq_v2=t.uint64();break;default:t.skipType(7&s)}}return e},t}(),e.RelayPublishCdnResponse=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.request_seq=0,t.prototype.response=null,t.prototype.request_seq_v2=u.Long?u.Long.fromBits(0,0,!0):0,t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.request_seq&&Object.hasOwnProperty.call(t,"request_seq")&&i.uint32(8).uint32(t.request_seq),null!=t.response&&Object.hasOwnProperty.call(t,"response")&&h.proto_media.MediaServerCommonResponse.encode(t.response,i.uint32(18).fork()).ldelim(),null!=t.request_seq_v2&&Object.hasOwnProperty.call(t,"request_seq_v2")&&i.uint32(24).uint64(t.request_seq_v2),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.RelayPublishCdnResponse;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.request_seq=t.uint32();break;case 2:e.response=h.proto_media.MediaServerCommonResponse.decode(t,t.uint32());break;case 3:e.request_seq_v2=t.uint64();break;default:t.skipType(7&s)}}return e},t}(),e),t.exports=h},799:function(t,i,n){var e,s;"undefined"!=typeof self&&self,t.exports=(e=n(570),s=n(946),function(t){var i={};function n(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=i,n.d=function(t,i,e){n.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},n.t=function(t,i){if(1&i&&(t=n(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)n.d(e,s,function(i){return t[i]}.bind(null,s));return e},n.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return n.d(i,"a",i),i},n.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},n.p="",n(n.s=13)}([function(t,i,n){(function(i){var e;t.exports=(e=e||function(t,e){var s;if("undefined"!=typeof window&&window.crypto&&(s=window.crypto),"undefined"!=typeof self&&self.crypto&&(s=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(s=globalThis.crypto),!s&&"undefined"!=typeof window&&window.msCrypto&&(s=window.msCrypto),!s&&void 0!==i&&i.crypto&&(s=i.crypto),!s)try{s=n(7)}catch(t){}var r=function(){if(s){if("function"==typeof s.getRandomValues)try{return s.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof s.randomBytes)try{return s.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(i){var n;return t.prototype=i,n=new t,t.prototype=null,n}}(),u={},h=u.lib={},a=h.Base={extend:function(t){var i=o(this);return t&&i.mixIn(t),i.hasOwnProperty("init")&&this.init!==i.init||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=h.WordArray=a.extend({init:function(t,i){t=this.words=t||[],this.sigBytes=i!=e?i:4*t.length},toString:function(t){return(t||f).stringify(this)},concat:function(t){var i=this.words,n=t.words,e=this.sigBytes,s=t.sigBytes;if(this.clamp(),e%4)for(var r=0;r<s;r++)i[e+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(e+r)%4*8;else for(var o=0;o<s;o+=4)i[e+o>>>2]=n[o>>>2];return this.sigBytes+=s,this},clamp:function(){var i=this.words,n=this.sigBytes;i[n>>>2]&=4294967295<<32-n%4*8,i.length=t.ceil(n/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(r());return new c.init(i,t)}}),l=u.enc={},f=l.Hex={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++){var r=i[s>>>2]>>>24-s%4*8&255;e.push((r>>>4).toString(16)),e.push((15&r).toString(16))}return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e+=2)n[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new c.init(n,i/2)}},d=l.Latin1={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++)e.push(String.fromCharCode(i[s>>>2]>>>24-s%4*8&255));return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new c.init(n,i)}},_=l.Utf8={stringify:function(t){try{return decodeURIComponent(escape(d.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return d.parse(unescape(encodeURIComponent(t)))}},v=h.BufferedBlockAlgorithm=a.extend({reset:function(){this.h=new c.init,this._=0},v:function(t){"string"==typeof t&&(t=_.parse(t)),this.h.concat(t),this._+=t.sigBytes},S:function(i){var n,e=this.h,s=e.words,r=e.sigBytes,o=this.blockSize,u=r/(4*o),h=(u=i?t.ceil(u):t.max((0|u)-this.T,0))*o,a=t.min(4*h,r);if(h){for(var l=0;l<h;l+=o)this.C(s,l);n=s.splice(0,h),e.sigBytes-=a}return new c.init(n,a)},clone:function(){var t=a.clone.call(this);return t.h=this.h.clone(),t},T:0}),m=(h.Hasher=v.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){v.reset.call(this),this.R()},update:function(t){return this.v(t),this.S(),this},finalize:function(t){return t&&this.v(t),this.O()},blockSize:16,A:function(t){return function(i,n){return new t.init(n).finalize(i)}},P:function(t){return function(i,n){return new m.HMAC.init(t,n).finalize(i)}}}),u.algo={});return u}(Math),e)}).call(this,n(6))},function(t,i){t.exports=e},function(t,i){t.exports=s},function(t,i,n){var e;t.exports=(e=n(0),n(8),n(9),n(4),n(12),function(){var t=e,i=t.lib.BlockCipher,n=t.algo,s=[],r=[],o=[],u=[],h=[],a=[],c=[],l=[],f=[],d=[];!function(){for(var t=[],i=0;i<256;i++)t[i]=i<128?i<<1:i<<1^283;var n=0,e=0;for(i=0;i<256;i++){var _=e^e<<1^e<<2^e<<3^e<<4;s[n]=_=_>>>8^255&_^99,r[_]=n;var v=t[n],m=t[v],p=t[m],g=257*t[_]^16843008*_;o[n]=g<<24|g>>>8,u[n]=g<<16|g>>>16,h[n]=g<<8|g>>>24,a[n]=g,c[_]=(g=16843009*p^65537*m^257*v^16843008*n)<<24|g>>>8,l[_]=g<<16|g>>>16,f[_]=g<<8|g>>>24,d[_]=g,n?(n=v^t[t[t[p^v]]],e^=t[t[e]]):n=e=1}}();var _=[0,1,2,4,8,16,32,64,128,27,54],v=n.AES=i.extend({R:function(){if(!this.I||this.N!==this.D){for(var t=this.N=this.D,i=t.words,n=t.sigBytes/4,e=4*((this.I=n+6)+1),r=this.M=[],o=0;o<e;o++)o<n?r[o]=i[o]:(a=r[o-1],o%n?n>6&&o%n==4&&(a=s[a>>>24]<<24|s[a>>>16&255]<<16|s[a>>>8&255]<<8|s[255&a]):(a=s[(a=a<<8|a>>>24)>>>24]<<24|s[a>>>16&255]<<16|s[a>>>8&255]<<8|s[255&a],a^=_[o/n|0]<<24),r[o]=r[o-n]^a);for(var u=this.U=[],h=0;h<e;h++){if(o=e-h,h%4)var a=r[o];else a=r[o-4];u[h]=h<4||o<=4?a:c[s[a>>>24]]^l[s[a>>>16&255]]^f[s[a>>>8&255]]^d[s[255&a]]}}},encryptBlock:function(t,i){this.H(t,i,this.M,o,u,h,a,s)},decryptBlock:function(t,i){var n=t[i+1];t[i+1]=t[i+3],t[i+3]=n,this.H(t,i,this.U,c,l,f,d,r),n=t[i+1],t[i+1]=t[i+3],t[i+3]=n},H:function(t,i,n,e,s,r,o,u){for(var h=this.I,a=t[i]^n[0],c=t[i+1]^n[1],l=t[i+2]^n[2],f=t[i+3]^n[3],d=4,_=1;_<h;_++){var v=e[a>>>24]^s[c>>>16&255]^r[l>>>8&255]^o[255&f]^n[d++],m=e[c>>>24]^s[l>>>16&255]^r[f>>>8&255]^o[255&a]^n[d++],p=e[l>>>24]^s[f>>>16&255]^r[a>>>8&255]^o[255&c]^n[d++],g=e[f>>>24]^s[a>>>16&255]^r[c>>>8&255]^o[255&l]^n[d++];a=v,c=m,l=p,f=g}v=(u[a>>>24]<<24|u[c>>>16&255]<<16|u[l>>>8&255]<<8|u[255&f])^n[d++],m=(u[c>>>24]<<24|u[l>>>16&255]<<16|u[f>>>8&255]<<8|u[255&a])^n[d++],p=(u[l>>>24]<<24|u[f>>>16&255]<<16|u[a>>>8&255]<<8|u[255&c])^n[d++],g=(u[f>>>24]<<24|u[a>>>16&255]<<16|u[c>>>8&255]<<8|u[255&l])^n[d++],t[i]=v,t[i+1]=m,t[i+2]=p,t[i+3]=g},keySize:8});t.AES=i.A(v)}(),e.AES)},function(t,i,n){var e,s,r,o,u,h,a;t.exports=(a=n(0),n(10),n(11),s=(e=a).lib,o=s.WordArray,h=(u=e.algo).EvpKDF=(r=s.Base).extend({cfg:r.extend({keySize:4,hasher:u.MD5,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,i){for(var n,e=this.cfg,s=e.hasher.create(),r=o.create(),u=r.words,h=e.keySize,a=e.iterations;u.length<h;){n&&s.update(n),n=s.update(t).finalize(i),s.reset();for(var c=1;c<a;c++)n=s.finalize(n),s.reset();r.concat(n)}return r.sigBytes=4*h,r}}),e.EvpKDF=function(t,i,n){return h.create(n).compute(t,i)},a.EvpKDF)},function(t,i,n){t.exports=n(0).enc.Utf8},function(t,i){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,i){},function(t,i,n){var e;t.exports=(e=n(0),function(){var t=e.lib.WordArray;function i(i,n,e){for(var s=[],r=0,o=0;o<n;o++)if(o%4){var u=e[i.charCodeAt(o-1)]<<o%4*2|e[i.charCodeAt(o)]>>>6-o%4*2;s[r>>>2]|=u<<24-r%4*8,r++}return t.create(s,r)}e.enc.Base64={stringify:function(t){var i=t.words,n=t.sigBytes,e=this.G;t.clamp();for(var s=[],r=0;r<n;r+=3)for(var o=(i[r>>>2]>>>24-r%4*8&255)<<16|(i[r+1>>>2]>>>24-(r+1)%4*8&255)<<8|i[r+2>>>2]>>>24-(r+2)%4*8&255,u=0;u<4&&r+.75*u<n;u++)s.push(e.charAt(o>>>6*(3-u)&63));var h=e.charAt(64);if(h)for(;s.length%4;)s.push(h);return s.join("")},parse:function(t){var n=t.length,e=this.G,s=this.k;if(!s){s=this.k=[];for(var r=0;r<e.length;r++)s[e.charCodeAt(r)]=r}var o=e.charAt(64);if(o){var u=t.indexOf(o);-1!==u&&(n=u)}return i(t,n,s)},G:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64)},function(t,i,n){var e;t.exports=(e=n(0),function(t){var i=e,n=i.lib,s=n.WordArray,r=n.Hasher,o=i.algo,u=[];!function(){for(var i=0;i<64;i++)u[i]=4294967296*t.abs(t.sin(i+1))|0}();var h=o.MD5=r.extend({R:function(){this.B=new s.init([1732584193,4023233417,2562383102,271733878])},C:function(t,i){for(var n=0;n<16;n++){var e=i+n,s=t[e];t[e]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var r=this.B.words,o=t[i+0],h=t[i+1],d=t[i+2],_=t[i+3],v=t[i+4],m=t[i+5],p=t[i+6],g=t[i+7],b=t[i+8],E=t[i+9],S=t[i+10],y=t[i+11],T=t[i+12],R=t[i+13],w=t[i+14],O=t[i+15],I=r[0],N=r[1],C=r[2],k=r[3];I=a(I,N,C,k,o,7,u[0]),k=a(k,I,N,C,h,12,u[1]),C=a(C,k,I,N,d,17,u[2]),N=a(N,C,k,I,_,22,u[3]),I=a(I,N,C,k,v,7,u[4]),k=a(k,I,N,C,m,12,u[5]),C=a(C,k,I,N,p,17,u[6]),N=a(N,C,k,I,g,22,u[7]),I=a(I,N,C,k,b,7,u[8]),k=a(k,I,N,C,E,12,u[9]),C=a(C,k,I,N,S,17,u[10]),N=a(N,C,k,I,y,22,u[11]),I=a(I,N,C,k,T,7,u[12]),k=a(k,I,N,C,R,12,u[13]),C=a(C,k,I,N,w,17,u[14]),I=c(I,N=a(N,C,k,I,O,22,u[15]),C,k,h,5,u[16]),k=c(k,I,N,C,p,9,u[17]),C=c(C,k,I,N,y,14,u[18]),N=c(N,C,k,I,o,20,u[19]),I=c(I,N,C,k,m,5,u[20]),k=c(k,I,N,C,S,9,u[21]),C=c(C,k,I,N,O,14,u[22]),N=c(N,C,k,I,v,20,u[23]),I=c(I,N,C,k,E,5,u[24]),k=c(k,I,N,C,w,9,u[25]),C=c(C,k,I,N,_,14,u[26]),N=c(N,C,k,I,b,20,u[27]),I=c(I,N,C,k,R,5,u[28]),k=c(k,I,N,C,d,9,u[29]),C=c(C,k,I,N,g,14,u[30]),I=l(I,N=c(N,C,k,I,T,20,u[31]),C,k,m,4,u[32]),k=l(k,I,N,C,b,11,u[33]),C=l(C,k,I,N,y,16,u[34]),N=l(N,C,k,I,w,23,u[35]),I=l(I,N,C,k,h,4,u[36]),k=l(k,I,N,C,v,11,u[37]),C=l(C,k,I,N,g,16,u[38]),N=l(N,C,k,I,S,23,u[39]),I=l(I,N,C,k,R,4,u[40]),k=l(k,I,N,C,o,11,u[41]),C=l(C,k,I,N,_,16,u[42]),N=l(N,C,k,I,p,23,u[43]),I=l(I,N,C,k,E,4,u[44]),k=l(k,I,N,C,T,11,u[45]),C=l(C,k,I,N,O,16,u[46]),I=f(I,N=l(N,C,k,I,d,23,u[47]),C,k,o,6,u[48]),k=f(k,I,N,C,g,10,u[49]),C=f(C,k,I,N,w,15,u[50]),N=f(N,C,k,I,m,21,u[51]),I=f(I,N,C,k,T,6,u[52]),k=f(k,I,N,C,_,10,u[53]),C=f(C,k,I,N,S,15,u[54]),N=f(N,C,k,I,h,21,u[55]),I=f(I,N,C,k,b,6,u[56]),k=f(k,I,N,C,O,10,u[57]),C=f(C,k,I,N,p,15,u[58]),N=f(N,C,k,I,R,21,u[59]),I=f(I,N,C,k,v,6,u[60]),k=f(k,I,N,C,y,10,u[61]),C=f(C,k,I,N,d,15,u[62]),N=f(N,C,k,I,E,21,u[63]),r[0]=r[0]+I|0,r[1]=r[1]+N|0,r[2]=r[2]+C|0,r[3]=r[3]+k|0},O:function(){var i=this.h,n=i.words,e=8*this._,s=8*i.sigBytes;n[s>>>5]|=128<<24-s%32;var r=t.floor(e/4294967296),o=e;n[15+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(s+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),i.sigBytes=4*(n.length+1),this.S();for(var u=this.B,h=u.words,a=0;a<4;a++){var c=h[a];h[a]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return u},clone:function(){var t=r.clone.call(this);return t.B=this.B.clone(),t}});function a(t,i,n,e,s,r,o){var u=t+(i&n|~i&e)+s+o;return(u<<r|u>>>32-r)+i}function c(t,i,n,e,s,r,o){var u=t+(i&e|n&~e)+s+o;return(u<<r|u>>>32-r)+i}function l(t,i,n,e,s,r,o){var u=t+(i^n^e)+s+o;return(u<<r|u>>>32-r)+i}function f(t,i,n,e,s,r,o){var u=t+(n^(i|~e))+s+o;return(u<<r|u>>>32-r)+i}i.MD5=r.A(h),i.HmacMD5=r.P(h)}(Math),e.MD5)},function(t,i,n){var e,s,r,o,u,h,a;t.exports=(s=(e=a=n(0)).lib,r=s.WordArray,u=[],h=e.algo.SHA1=(o=s.Hasher).extend({R:function(){this.B=new r.init([1732584193,4023233417,2562383102,271733878,3285377520])},C:function(t,i){for(var n=this.B.words,e=n[0],s=n[1],r=n[2],o=n[3],h=n[4],a=0;a<80;a++){if(a<16)u[a]=0|t[i+a];else{var c=u[a-3]^u[a-8]^u[a-14]^u[a-16];u[a]=c<<1|c>>>31}var l=(e<<5|e>>>27)+h+u[a];l+=a<20?1518500249+(s&r|~s&o):a<40?1859775393+(s^r^o):a<60?(s&r|s&o|r&o)-1894007588:(s^r^o)-899497514,h=o,o=r,r=s<<30|s>>>2,s=e,e=l}n[0]=n[0]+e|0,n[1]=n[1]+s|0,n[2]=n[2]+r|0,n[3]=n[3]+o|0,n[4]=n[4]+h|0},O:function(){var t=this.h,i=t.words,n=8*this._,e=8*t.sigBytes;return i[e>>>5]|=128<<24-e%32,i[14+(e+64>>>9<<4)]=Math.floor(n/4294967296),i[15+(e+64>>>9<<4)]=n,t.sigBytes=4*i.length,this.S(),this.B},clone:function(){var t=o.clone.call(this);return t.B=this.B.clone(),t}}),e.SHA1=o.A(h),e.HmacSHA1=o.P(h),a.SHA1)},function(t,i,n){var e,s,r;t.exports=(s=(e=n(0)).lib.Base,r=e.enc.Utf8,void(e.algo.HMAC=s.extend({init:function(t,i){t=this.V=new t.init,"string"==typeof i&&(i=r.parse(i));var n=t.blockSize,e=4*n;i.sigBytes>e&&(i=t.finalize(i)),i.clamp();for(var s=this.Y=i.clone(),o=this.L=i.clone(),u=s.words,h=o.words,a=0;a<n;a++)u[a]^=1549556828,h[a]^=909522486;s.sigBytes=o.sigBytes=e,this.reset()},reset:function(){var t=this.V;t.reset(),t.update(this.L)},update:function(t){return this.V.update(t),this},finalize:function(t){var i=this.V,n=i.finalize(t);return i.reset(),i.finalize(this.Y.clone().concat(n))}})))},function(t,i,n){var e;t.exports=(e=n(0),n(4),void(e.lib.Cipher||function(t){var i=e,n=i.lib,s=n.Base,r=n.WordArray,o=n.BufferedBlockAlgorithm,u=i.enc,h=u.Base64,a=i.algo.EvpKDF,c=n.Cipher=o.extend({cfg:s.extend(),createEncryptor:function(t,i){return this.create(this.q,t,i)},createDecryptor:function(t,i){return this.create(this.j,t,i)},init:function(t,i,n){this.cfg=this.cfg.extend(n),this.F=t,this.D=i,this.reset()},reset:function(){o.reset.call(this),this.R()},process:function(t){return this.v(t),this.S()},finalize:function(t){return t&&this.v(t),this.O()},keySize:4,ivSize:4,q:1,j:2,A:function(){function t(t){return"string"==typeof t?b:p}return function(i){return{encrypt:function(n,e,s){return t(e).encrypt(i,n,e,s)},decrypt:function(n,e,s){return t(e).decrypt(i,n,e,s)}}}}()}),l=(n.StreamCipher=c.extend({O:function(){return this.S(!0)},blockSize:1}),i.mode={}),f=n.BlockCipherMode=s.extend({createEncryptor:function(t,i){return this.Encryptor.create(t,i)},createDecryptor:function(t,i){return this.Decryptor.create(t,i)},init:function(t,i){this.W=t,this.J=i}}),d=l.CBC=function(){var i=f.extend();function n(i,n,e){var s,r=this.J;r?(s=r,this.J=t):s=this.K;for(var o=0;o<e;o++)i[n+o]^=s[o]}return i.Encryptor=i.extend({processBlock:function(t,i){var e=this.W,s=e.blockSize;n.call(this,t,i,s),e.encryptBlock(t,i),this.K=t.slice(i,i+s)}}),i.Decryptor=i.extend({processBlock:function(t,i){var e=this.W,s=e.blockSize,r=t.slice(i,i+s);e.decryptBlock(t,i),n.call(this,t,i,s),this.K=r}}),i}(),_=(i.pad={}).Pkcs7={pad:function(t,i){for(var n=4*i,e=n-t.sigBytes%n,s=e<<24|e<<16|e<<8|e,o=[],u=0;u<e;u+=4)o.push(s);var h=r.create(o,e);t.concat(h)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},v=(n.BlockCipher=c.extend({cfg:c.cfg.extend({mode:d,padding:_}),reset:function(){var t;c.reset.call(this);var i=this.cfg,n=i.iv,e=i.mode;this.F==this.q?t=e.createEncryptor:(t=e.createDecryptor,this.T=1),this.Z&&this.Z.X==t?this.Z.init(this,n&&n.words):(this.Z=t.call(e,this,n&&n.words),this.Z.X=t)},C:function(t,i){this.Z.processBlock(t,i)},O:function(){var t,i=this.cfg.padding;return this.F==this.q?(i.pad(this.h,this.blockSize),t=this.S(!0)):(t=this.S(!0),i.unpad(t)),t},blockSize:4}),n.CipherParams=s.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}})),m=(i.format={}).OpenSSL={stringify:function(t){var i=t.ciphertext,n=t.salt;return(n?r.create([1398893684,1701076831]).concat(n).concat(i):i).toString(h)},parse:function(t){var i,n=h.parse(t),e=n.words;return 1398893684==e[0]&&1701076831==e[1]&&(i=r.create(e.slice(2,4)),e.splice(0,4),n.sigBytes-=16),v.create({ciphertext:n,salt:i})}},p=n.SerializableCipher=s.extend({cfg:s.extend({format:m}),encrypt:function(t,i,n,e){e=this.cfg.extend(e);var s=t.createEncryptor(n,e),r=s.finalize(i),o=s.cfg;return v.create({ciphertext:r,key:n,iv:o.iv,algorithm:t,mode:o.mode,padding:o.padding,blockSize:t.blockSize,formatter:e.format})},decrypt:function(t,i,n,e){return e=this.cfg.extend(e),i=this.tt(i,e.format),t.createDecryptor(n,e).finalize(i.ciphertext)},tt:function(t,i){return"string"==typeof t?i.parse(t,this):t}}),g=(i.kdf={}).OpenSSL={execute:function(t,i,n,e){e||(e=r.random(8));var s=a.create({keySize:i+n}).compute(t,e),o=r.create(s.words.slice(i),4*n);return s.sigBytes=4*i,v.create({key:s,iv:o,salt:e})}},b=n.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:g}),encrypt:function(t,i,n,e){var s=(e=this.cfg.extend(e)).kdf.execute(n,t.keySize,t.ivSize);e.iv=s.iv;var r=p.encrypt.call(this,t,i,s.key,e);return r.mixIn(s),r},decrypt:function(t,i,n,e){e=this.cfg.extend(e),i=this.tt(i,e.format);var s=e.kdf.execute(n,t.keySize,t.ivSize,i.salt);return e.iv=s.iv,p.decrypt.call(this,t,i,s.key,e)}})}()))},function(t,i,n){"use strict";var e,s,r,o,u,h,a,c,l,f,d,_;n.r(i),n.d(i,"ZegoConnectionAgent",(function(){return ui})),n.d(i,"NetAgentPCRequest",(function(){return Yt})),n.d(i,"NetAgentHttpRequest",(function(){return ti})),n.d(i,"BusinessService",(function(){return c})),n.d(i,"BrokenType",(function(){return R})),n.d(i,"NET_ACCESS_CONFIG",(function(){return It})),n.d(i,"ConnectedType",(function(){return T})),n.d(i,"DisconnectedType",(function(){return y})),n.d(i,"Mode",(function(){return f})),n.d(i,"Method",(function(){return S})),function(t){t[t.Normal=0]="Normal",t[t.Private=1]="Private"}(e||(e={})),function(t){t[t.WebSocket=0]="WebSocket",t[t.WebTransport=1]="WebTransport"}(s||(s={})),function(t){t[t.CONNECTING=0]="CONNECTING",t[t.OPEN=1]="OPEN",t[t.CLOSING=2]="CLOSING",t[t.CLOSED=3]="CLOSED"}(r||(r={})),function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(o||(o={})),function(t){t[t.PB=0]="PB",t[t.JSON=1]="JSON"}(u||(u={})),function(t){t[t.MSG_TYPE_STREAM_CLOSED=2]="MSG_TYPE_STREAM_CLOSED",t[t.MSG_TYPE_CLOSE_CONNECTION=3]="MSG_TYPE_CLOSE_CONNECTION",t[t.MSG_TYPE_HTTP_REQUEST=4]="MSG_TYPE_HTTP_REQUEST",t[t.MSG_TYPE_HTTP_RESPONSE=5]="MSG_TYPE_HTTP_RESPONSE",t[t.MSG_TYPE_HB_REQUEST=12]="MSG_TYPE_HB_REQUEST",t[t.MSG_TYPE_HB_RESPONSE=13]="MSG_TYPE_HB_RESPONSE",t[t.MSG_TYPE_GET_CONFIG_REQUEST=14]="MSG_TYPE_GET_CONFIG_REQUEST",t[t.MSG_TYPE_GET_CONFIG_RESPONSE=15]="MSG_TYPE_GET_CONFIG_RESPONSE",t[t.MSG_TYPE_HTTP_REQUEST_ACK=16]="MSG_TYPE_HTTP_REQUEST_ACK",t[t.MSG_TYPE_PC_UPWARD_MESSAGE=17]="MSG_TYPE_PC_UPWARD_MESSAGE",t[t.MSG_TYPE_PC_UPWARD_MESSAGE_ACK=18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK",t[t.MSG_TYPE_PC_ESTABLISHED=19]="MSG_TYPE_PC_ESTABLISHED",t[t.MSG_TYPE_PC_BROKEN=20]="MSG_TYPE_PC_BROKEN",t[t.MSG_TYPE_PC_DOWNWARD_MESSAGE=21]="MSG_TYPE_PC_DOWNWARD_MESSAGE",t[t.MSG_TYPE_REDIRECT=22]="MSG_TYPE_REDIRECT",t[t.MSG_TYPE_GET_APPCONFIG_REQUEST=23]="MSG_TYPE_GET_APPCONFIG_REQUEST",t[t.MSG_TYPE_GET_APPCONFIG_RESPONSE=24]="MSG_TYPE_GET_APPCONFIG_RESPONSE",t[t.MSG_TYPE_PUSH_APPCONFIG=25]="MSG_TYPE_PUSH_APPCONFIG",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST=26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE=27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE",t[t.MSG_TYPE_PUSH_EXCEPTION=30]="MSG_TYPE_PUSH_EXCEPTION",t[t.MSG_TYPE_HTTP_REQUEST2=33]="MSG_TYPE_HTTP_REQUEST2",t[t.MSG_TYPE_REDIRECT2=34]="MSG_TYPE_REDIRECT2",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2=35]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2",t[t.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2=36]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2",t[t.MSG_TYPE_GET_SVRADDR_REQUEST=39]="MSG_TYPE_GET_SVRADDR_REQUEST",t[t.MSG_TYPE_GET_SVRADDR_RESPONSE=40]="MSG_TYPE_GET_SVRADDR_RESPONSE"}(h||(h={})),function(t){t[t.ACCESSHUB_INVALID_FRAME=2e4]="ACCESSHUB_INVALID_FRAME",t[t.ACCESSHUB_NEED_ENCRYPT=20001]="ACCESSHUB_NEED_ENCRYPT",t[t.ACCESSHUB_DECRYPT=20002]="ACCESSHUB_DECRYPT",t[t.ACCESSHUB_MSGTYPE=20003]="ACCESSHUB_MSGTYPE",t[t.ACCESSHUB_UNMARSHAL=20004]="ACCESSHUB_UNMARSHAL",t[t.ACCESSHUB_TIMEOUT=20005]="ACCESSHUB_TIMEOUT",t[t.ACCESSHUB_CONNECT=20006]="ACCESSHUB_CONNECT",t[t.ACCESSHUB_BROKEN=20007]="ACCESSHUB_BROKEN",t[t.ACCESSHUB_INTERNAL_ERROR=20008]="ACCESSHUB_INTERNAL_ERROR",t[t.ACCESSHUB_MARSHAL=20009]="ACCESSHUB_MARSHAL",t[t.ACCESSHUB_UNSUPPORTED_SERVICE=20010]="ACCESSHUB_UNSUPPORTED_SERVICE",t[t.ACCESSHUB_TOO_FREQUENTLY=20011]="ACCESSHUB_TOO_FREQUENTLY",t[t.ACCESSHUB_INVALID_APPID=20012]="ACCESSHUB_INVALID_APPID",t[t.ACCESSHUB_HB_TIMEOUT=20013]="ACCESSHUB_HB_TIMEOUT",t[t.ACCESSHUB_INVALID_SIGNATURE=20014]="ACCESSHUB_INVALID_SIGNATURE"}(a||(a={})),function(t){t[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR"}(c||(c={})),function(t){t[t.ZEGOCONN_RUN_ENV_UNSET=0]="ZEGOCONN_RUN_ENV_UNSET",t[t.ZEGOCONN_RUN_ENV_BROWSER=1]="ZEGOCONN_RUN_ENV_BROWSER",t[t.ZEGOCONN_RUN_ENV_APPLET=2]="ZEGOCONN_RUN_ENV_APPLET"}(l||(l={})),function(t){t[t.Mode_UNSET=0]="Mode_UNSET",t[t.MODE_ONLINE=1]="MODE_ONLINE",t[t.MODE_TEST=2]="MODE_TEST",t[t.MODE_ALPHA=3]="MODE_ALPHA"}(f||(f={})),function(t){t[t.HTTP=0]="HTTP",t[t.PC=1]="PC",t[t.OTHER=2]="OTHER"}(d||(d={})),function(t){t[t.NONE=0]="NONE",t[t.BROKEN=1]="BROKEN",t[t.DISCONNECT=2]="DISCONNECT"}(_||(_={}));var v,m=0,p=1,g=2;!function(t){t[t.CONNECTED=0]="CONNECTED",t[t.DISCONNECT=1]="DISCONNECT",t[t.BROKEN=2]="BROKEN"}(v||(v={}));var b,E,S,y,T,R,w=[a.ACCESSHUB_INVALID_APPID,a.ACCESSHUB_INVALID_SIGNATURE];!function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(b||(b={})),function(t){t[t.ACTION_RESERVED=0]="ACTION_RESERVED",t[t.ACTION_DISPATCH=1]="ACTION_DISPATCH",t[t.ACTION_RETRY=2]="ACTION_RETRY",t[t.ACTION_NEXT_NODE=3]="ACTION_NEXT_NODE",t[t.ACTION_ABORT=4]="ACTION_ABORT",t[t.ACTION_NEXT_GROUP=5]="ACTION_NEXT_GROUP",t[t.ACTION_IDLE=6]="ACTION_IDLE"}(E||(E={})),function(t){t[t.METHOD_UNSET=0]="METHOD_UNSET",t[t.METHOD_GET=1]="METHOD_GET",t[t.METHOD_POST=2]="METHOD_POST",t[t.METHOD_PUT=3]="METHOD_PUT",t[t.METHOD_PATCH=4]="METHOD_PATCH",t[t.METHOD_DELETE=5]="METHOD_DELETE",t[t.METHOD_HEAD=6]="METHOD_HEAD",t[t.METHOD_OPTIONS=7]="METHOD_OPTIONS"}(S||(S={})),function(t){t[t.CLOSE=0]="CLOSE",t[t.TEMP=1]="TEMP",t[t.TIMEOUT=2]="TIMEOUT"}(y||(y={})),function(t){t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL"}(T||(T={})),function(t){t[t.EMPTY=0]="EMPTY",t[t.CLOSE=1]="CLOSE"}(R||(R={}));var O={2:"stream_closed",3:"close_connection",4:"http_request",5:"http_response",12:"hb_request",13:"hb_response",14:"get_config_request",15:"get_config_response",16:"http_request_ack",17:"pc_upward_message",18:"pc_upward_message_ack",19:"pc_established",20:"pc_broken",21:"pc_downward_message",22:"redirect",23:"get_appconfig_request",24:"get_appconfig_response",25:"push_appconfig",26:"accesshub_dispatch_request",27:"accesshub_dispatch_response",30:"push_exception",33:"http_request2",34:"redirect2",35:"accesshub_dispatch_request2",36:"accesshub_dispatch_response2",39:"get_svraddr_request",40:"get_svraddr_response"},I=n(1),N=n.n(I),C=n(2),k=n(2);const D=n(1);k.util.Long=D,k.util.Long.fromBits=k.util.Long?k.util.Long.fromBits:function(){return 0};for(var z=k.roots,A=k.types?k.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},P=k.types?k.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},M=Object.keys(A),x={$:function(t){return x[t]?x[t].call(this):z[t].decode?z[t].decode(this,this.uint32()):x.$.call(this,"int32")}},U={$:function(t,i,n){var e=A[t];return void 0===e?z[t].encode?(this.uint32(n<<3|2).fork(),z[t].encode(i,this).ldelim()):U.$.call(this,"int32",i,n):U[t].call(this.uint32(n<<3|e),i)}},q=0;q<M.length;q++)x[M[q]]=k.Reader.prototype[M[q]],U[M[q]]=k.Writer.prototype[M[q]];!function t(i,n,e,s){for(var r=0,o=Object.keys(i);r<o.length;r++){var u=o[r];i[u].$m&&Object.keys(i[u].$m).every((function(t){return Number(t)}))?e[u]=function(i,e){function s(t){for(var n in i){var e=i[n];"{"===e[1].charAt(0)?this[e[0]]={}:"["!==e[1].charAt(0)&&"<"!==e[1].charAt(0)||(this[e[0]]=[])}if(t)for(var s=Object.keys(t),r=0;r<s.length;++r)null!=t[s[r]]&&(this[s[r]]=t[s[r]])}var r={};for(var o in i){var u=i[o],h=u[1];"{"===h.charAt(0)?(s.prototype[u[0]]=k.util.emptyObject,r[h]={$m:h.substring(1).split(",").map((function(t,i){return[`$${i+1}`,t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):s.prototype[u[0]]="["===h.charAt(0)||"<"===h.charAt(0)?k.util.emptyArray:"bytes"===h?k.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?k.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof k.Reader||(t=k.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32(),u=o>>>3;if(u>0&&i[u]){var h=i[u][0],a=i[u][1];if("{"===a.charAt(0)){r[h]===k.util.emptyObject&&(r[h]={});var c=s.$namespace[a].decode(t,t.uint32());r[h][c.$1]=c.$2}else if("["===a.charAt(0)||"<"===a.charAt(0))if(a=a.substring(1),r[h]&&r[h].length||(r[h]=[]),void 0!==P[a=x[a]||z[a].decode?a:"int32"]&&2==(7&o))for(var l=t.uint32()+t.pos;t.pos<l;)r[h].push(x.$.call(t,a));else r[h].push(x.$.call(t,a));else r[h]=x.$.call(t,a)}else t.skipType(7&o)}return r},s.encode=function(t,n){for(var e in n||(n=k.Writer.create()),i){var r=i[e][0],o=i[e][1];if("{"===o.charAt(0)){if(null!=t[r]&&t.hasOwnProperty(r))for(var u=0,h=Object.keys(t[r]);u<h.length;++u)n.uint32(e<<3|2).fork(),s.$namespace[o].encode({$1:h[u],$2:t[r][h[u]]},n).ldelim()}else if("["===o.charAt(0)||"<"===o.charAt(0)){var a="<"===o.charAt(0);o=o.substring(1);var c=t[r];if(null!=c&&c.length)if(o=void 0!==A[o]||z[o].encode?o:"int32",a&&void 0!==P[o]){for(n.uint32(e<<3|2).fork(),u=0;u<c.length;u++)U[o].call(n,c[u]);n.ldelim()}else for(u=0;u<c.length;u++)U.$.call(n,o,c[u],e)}else null!=t[r]&&t.hasOwnProperty(r)&&U.$.call(n,o,t[r],e)}return n},Object.keys(r).length&&(s.$namespace=t(r,n+"."+e,s.$namespace||{},!0)),s}(i[u].$m,u):i[u].$s?e[u]=function(t,i){function e(t,i,n){k.rpc.Service.call(this,t,i,n)}return(e.prototype=Object.create(k.rpc.Service.prototype)).constructor=e,e.create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){var r=t[s];function o(t,i){return this.rpcCall(o,z[r[0]],z[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:`${n}.${i}`}),e.prototype[s]=o})),e}(i[u].$s,u):i[u].$e&&Object.values(i[u].$e).every((function(t){return Number(t)===t}))&&(e[u]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[u].$e)),e[u]&&!s&&(z[`${n}.${u}`]=e[u]),delete i[u].$m,delete i[u].$s,delete i[u].$e,e[u]=t(i[u],n?`${n}.${u}`:u,e[u]||{})}return e}({zego_connection:{proto_accesshub:{AccesshubAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","zego_connection.proto_accesshub.IPV6Addr",null],3:["quic_port","uint32",0],4:["wss_port","uint32",0]}},AccesshubDispatchGroup:{$m:{1:["group","string",""],2:["quic_nodes","<string",null],3:["mtcp_nodes","<string",null],4:["wss_nodes","<string",null]}},AccesshubDispatchGroup2:{$m:{1:["group","string",""],2:["nodes","<zego_connection.proto_accesshub.AccesshubAddr",null],3:["nodes_dual","<zego_connection.proto_accesshub.AccesshubAddr",null],4:["weight","uint32",0]}},AccesshubDispatchRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_version","uint32",0],8:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],9:["device_id","string",""],10:["client_ip","string",""],11:["geofencing_type","uint32",0],12:["geofencings","[uint32",null],13:["addr_type","uint32",0],14:["net_mode","uint32",0]}},AccesshubDispatchResponse2:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.AccesshubDispatchResponseData2",null]}},AccesshubDispatchResponseData2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["rand","string",""],3:["secret","string",""],4:["groups","<zego_connection.proto_accesshub.AccesshubDispatchGroup2",null],5:["wss_groups","<zego_connection.proto_accesshub.WssAccesshubDispatchGroup",null],6:["ttl","uint32",0],7:["http3_groups","<zego_connection.proto_accesshub.Http3AccesshubDispatchGroup",null]}},BackendConnType:{$e:{BACKEND_CONN_TYPE_UNSET:0,BACKEND_CONN_TYPE_TCP:1,BACKEND_CONN_TYPE_WSS:2}},CheckServiceAreaRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["device_id","string",""],10:["user_agent","string",""],11:["language","string",""],12:["timezone","string",""],13:["carrier","string",""],14:["dns_result","zego_connection.proto_accesshub.IPAddr",null]}},CheckServiceAreaResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.CheckServiceAreaResponseData",null]}},CheckServiceAreaResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},CloseConnection:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["action","int32",0]},Action:{$e:{ACTION_RESERVED:0,ACTION_DISPATCH:1,ACTION_RETRY:2,ACTION_NEXT_NODE:3,ACTION_ABORT:4,ACTION_NEXT_GROUP:5,ACTION_IDLE:6}}},ConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},ErrorCode:{$e:{OK:0,DISPATCH_NO_AVAILABLE_NODE:1e4,DISPATCH_INTERNAL_ERROR:10001,DISPATCH_INVALID_FRAME:10002,DISPATCH_UNMARSHAL:10003,DISPATCH_MSGTYPE:10004,DISPATCH_MARSHAL:10005,DISPATCH_TOO_FREQUENTLY:10006,DISPATCH_EMPTY_GEOFENCING:10007,ACCESSHUB_INVALID_FRAME:2e4,ACCESSHUB_NEED_ENCRYPT:20001,ACCESSHUB_DECRYPT:20002,ACCESSHUB_MSGTYPE:20003,ACCESSHUB_UNMARSHAL:20004,ACCESSHUB_TIMEOUT:20005,ACCESSHUB_CONNECT:20006,ACCESSHUB_BROKEN:20007,ACCESSHUB_INTERNAL_ERROR:20008,ACCESSHUB_MARSHAL:20009,ACCESSHUB_UNSUPPORTED_SERVICE:20010,ACCESSHUB_TOO_FREQUENTLY:20011,ACCESSHUB_INVALID_APPID:20012,ACCESSHUB_HB_TIMEOUT:20013,ACCESSHUB_INVALID_SIGNATURE:20014,ACCESSHUB_AUTH_FAILED:20015,ACCESSHUB_UNSUPPORTED_INTERFACE:20016,ACCESSHUB_EMPTY_GEOFENCING:20017,ACCESSHUB_ACCESS_DENIED:20018,ACCESSHUB_SPECIAL_CUSTOMER:20019,ACCESSHUB_IDLE_CONNECTION:20020,ACCESSHUB_APPID_OFFLINE:20021,ACCESSHUB_GET_STREAM_FAILED:3e4,ACCESSHUB_GET_CONN_FAILED:30001,ACCESSHUB_DO_HTTP_REQUEST_FAILED:30002,ACCESSHUB_UNMARSHAL_HB_FAILED:30003,ACCESSHUB_DO_BACKEND_DISPATCH_FAILED:30004}},GeoFencing:{$e:{CN:2,NA:3,EU:4,AS:5,IN:6,NCN:7}},GeoFencingType:{$e:{NONE:0,UNION:1,EXCLUDE:2}},GetAppConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["config_key","string",""],7:["ts","uint64",{low:0,high:0,unsigned:!0}],8:["signature","bytes",[]],9:["lite_sign","string",""],10:["token","string",""],11:["sdk_type","zego_connection.proto_accesshub.SdkType",0],12:["zegoconn_version","uint32",0],13:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],14:["device_id","string",""],15:["etag","uint32",0],16:["is_special_customer","uint32",0]}},GetAppConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.GetAppConfigResponseData",null]}},GetAppConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["data","bytes",[]],3:["ts","uint64",{low:0,high:0,unsigned:!0}],4:["etag","uint32",0]}},GetConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["zegoconn_version","uint32",0],8:["sdk_type","zego_connection.proto_accesshub.SdkType",0],9:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],10:["device_id","string",""],11:["mode_no","zego_connection.proto_accesshub.Mode",0],12:["geofencing_type","uint32",0],13:["geofencings","[uint32",null]}},GetConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","zego_connection.proto_accesshub.GetConfigResponseData",null]}},GetConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["quic_hb_interval","uint32",0],3:["quic_hb_timeout","uint32",0],4:["logic_hb_interval","uint32",0],5:["logic_hb_timeout","uint32",0],6:["pc_establish_timeout","uint32",0],7:["sdk_link_detect_interval","uint32",0],8:["sdk_link_detect_duration","uint32",0],9:["client_outer_ip","string",""],10:["ntp_time","uint64",{low:0,high:0,unsigned:!0}],11:["root_rsa_certs_ver","uint32",0],12:["geofencing_id","uint32",0],13:["svraddr_ver","uint32",0],14:["root_ecc_certs_ver","uint32",0]}},GetSvraddrRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["device_id","string",""],10:["geofencing_type","uint32",0],11:["geofencings","[uint32",null],12:["addr_type","uint32",0]}},GetSvraddrResponse:{$m:{1:["code","int32",0],2:["msg","string",""],3:["data","zego_connection.proto_accesshub.GetSvraddrResponseData",null]}},GetSvraddrResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["geofencing_id","uint32",0],3:["svraddr_ver","uint32",0],4:["anycast_ips","<zego_connection.proto_accesshub.IPAddr",null],5:["zegons_domain","string",""],6:["zegons_ips","<zego_connection.proto_accesshub.IPAddr",null],7:["accesshub_domain","string",""],8:["accesshub_ips","<zego_connection.proto_accesshub.IPAddr",null],9:["logreport_domain","string",""],10:["logreport_ips","<zego_connection.proto_accesshub.IPAddr",null],11:["detaillog_domain","string",""],12:["detaillog_ips","<zego_connection.proto_accesshub.IPAddr",null],13:["stunsvr_domain","string",""],14:["stunsvr_ips","<zego_connection.proto_accesshub.IPAddr",null],15:["zimfile_domain","string",""],16:["zimfile_ips","<zego_connection.proto_accesshub.IPAddr",null],17:["accesshub_sni","string",""],18:["detectsvr_domain","string",""],19:["accesscube_domain","string",""],20:["wslog_domain","string",""],21:["wslog_ips","<zego_connection.proto_accesshub.IPAddr",null],22:["http3_domain","string",""]}},HBRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}]}},HBResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}],3:["ntp_time","uint64",{low:0,high:0,unsigned:!0}]}},Http3AccesshubDispatchGroup:{$m:{1:["group","string",""],2:["host","string",""]}},HTTPRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["stick","string",""],8:["service","string",""],9:["location","string",""],10:["method","string",""],11:["headers","<zego_connection.proto_accesshub.HTTPRequest.HTTPHeader",null],12:["body","bytes",[]],13:["ack","bool",!1],14:["mode_no","zego_connection.proto_accesshub.Mode",0],15:["service_no","zego_connection.proto_accesshub.Service",0],16:["method_no","zego_connection.proto_accesshub.Method",0],17:["sdk_type","zego_connection.proto_accesshub.SdkType",0],18:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],19:["zegoconn_version","uint32",0],20:["device_id","string",""],21:["reduce_resp_header","uint32",0]},HTTPHeader:{$m:{1:["name","string",""],2:["val","string",""]}}},HTTPRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","zego_connection.proto_accesshub.SdkType",0],7:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["headers","<zego_connection.proto_accesshub.HTTPRequest.HTTPHeader",null],10:["method","zego_connection.proto_accesshub.Method",0],11:["interface_id","uint32",0],12:["res_id","string",""],13:["params","string",""],14:["body","bytes",[]],15:["ack","bool",!1],16:["device_id","string",""],17:["ts","uint64",{low:0,high:0,unsigned:!0}],18:["signature","bytes",[]],19:["token","string",""],20:["lite_sign","string",""],21:["reduce_resp_header","uint32",0]}},HTTPRequestAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequestDroped:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["reason","int32",0],3:["msg","string",""]}},HTTPResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["headers","<zego_connection.proto_accesshub.HTTPRequest.HTTPHeader",null],3:["status_code","int32",0],4:["body","bytes",[]]}},IPAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","zego_connection.proto_accesshub.IPV6Addr",null]}},IPV6Addr:{$m:{1:["high","fixed64",{low:0,high:0,unsigned:!1}],2:["low","fixed64",{low:0,high:0,unsigned:!1}]}},MessageType:{$e:{MSG_TYPE_EMPTY:0,MSG_TYPE_CONNECTION_CLOSED:1,MSG_TYPE_STREAM_CLOSED:2,MSG_TYPE_CLOSE_CONNECTION:3,MSG_TYPE_HTTP_REQUEST:4,MSG_TYPE_HTTP_RESPONSE:5,MSG_TYPE_HTTP_REQUEST_DROPED:6,MSG_TYPE_PROXY_CONNECT:7,MSG_TYPE_PROXY_CONNECTED:8,MSG_TYPE_PROXY_CONNECTION_CLOSED:9,MSG_TYPE_PROXY_SEND_DATA:10,MSG_TYPE_PROXY_RECV_DATA:11,MSG_TYPE_HB_REQUEST:12,MSG_TYPE_HB_RESPONSE:13,MSG_TYPE_GET_CONFIG_REQUEST:14,MSG_TYPE_GET_CONFIG_RESPONSE:15,MSG_TYPE_HTTP_REQUEST_ACK:16,MSG_TYPE_PC_UPWARD_MESSAGE:17,MSG_TYPE_PC_UPWARD_MESSAGE_ACK:18,MSG_TYPE_PC_ESTABLISHED:19,MSG_TYPE_PC_BROKEN:20,MSG_TYPE_PC_DOWNWARD_MESSAGE:21,MSG_TYPE_REDIRECT:22,MSG_TYPE_GET_APPCONFIG_REQUEST:23,MSG_TYPE_GET_APPCONFIG_RESPONSE:24,MSG_TYPE_PUSH_APPCONFIG:25,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST:26,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE:27,MSG_TYPE_GET_IM_CONFIG_REQUEST:28,MSG_TYPE_GET_IM_CONFIG_RESPONSE:29,MSG_TYPE_PUSH_EXCEPTION:30,MSG_TYPE_RESOLVE_DOMAIN_REQUEST:31,MSG_TYPE_RESOLVE_DOMAIN_RESPONSE:32,MSG_TYPE_HTTP_REQUEST2:33,MSG_TYPE_REDIRECT2:34,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2:35,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2:36,MSG_TYPE_GET_ROOTCERTS_REQUEST:37,MSG_TYPE_GET_ROOTCERTS_RESPONSE:38,MSG_TYPE_GET_SVRADDR_REQUEST:39,MSG_TYPE_GET_SVRADDR_RESPONSE:40,MSG_TYPE_CHECK_SERVICEAREA_REQUEST:41,MSG_TYPE_CHECK_SERVICEAREA_RESPONSE:42,MSG_TYPE_UA_DISPATCH_REQUEST:50,MSG_TYPE_UA_DISPATCH_RESPONSE:51,MSG_TYPE_UA_ECHO_REQUEST:52,MSG_TYPE_UA_ECHO_RESPONSE:53,MSG_TYPE_NODE_REGISTER_REQUEST:100,MSG_TYPE_NODE_REGISTER_RESPONSE:101,MSG_TYPE_NODE_HB_REQUEST:102,MSG_TYPE_NODE_HB_RESPONSE:103}},Method:{$e:{METHOD_UNSET:0,METHOD_GET:1,METHOD_POST:2,METHOD_PUT:3,METHOD_PATCH:4,METHOD_DELETE:5,METHOD_HEAD:6,METHOD_OPTIONS:7}},Mode:{$e:{Mode_UNSET:0,MODE_ONLINE:1,MODE_TEST:2,MODE_ALPHA:3}},PCBroken:{$m:{}},PCDownwardMessage:{$m:{1:["payload","bytes",[]],2:["wss_message_type","uint32",0],3:["ts","uint64",{low:0,high:0,unsigned:!0}]}},PCEstablished:{$m:{1:["elapse","uint32",0],2:["from","uint32",0]}},PCUpwardMessage:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","zego_connection.proto_accesshub.Mode",0],5:["id_name","string",""],6:["service_no","zego_connection.proto_accesshub.Service",0],7:["ack","bool",!1],8:["payload","bytes",[]],9:["sdk_type","zego_connection.proto_accesshub.SdkType",0],10:["wss_message_type","uint32",0],11:["wss_path","string",""],12:["wss_raw_query","string",""],13:["zegoconn_version","uint32",0],14:["zegoconn_run_env","zego_connection.proto_accesshub.ZegoconnRunEnv",0],15:["backend_conn_type","zego_connection.proto_accesshub.BackendConnType",0],16:["device_id","string",""],17:["geofencing_type","uint32",0],18:["geofencings","[uint32",null],19:["addr_type","uint32",0],20:["net_mode","uint32",0]}},PCUpwardMessageAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},ProxyConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""],3:["connected","int32",0]}},PushAppConfig:{$m:{1:["config_key","string",""],2:["data","bytes",[]]}},PushException:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["txid","uint64",{low:0,high:0,unsigned:!0}]}},Redirect2:{$m:{1:["rand","string",""],2:["secret","string",""],3:["groups","<zego_connection.proto_accesshub.AccesshubDispatchGroup2",null],4:["wss_groups","<zego_connection.proto_accesshub.WssAccesshubDispatchGroup",null],5:["ttl","uint32",0],6:["http3_groups","<zego_connection.proto_accesshub.Http3AccesshubDispatchGroup",null]}},SdkType:{$e:{SDK_TYPE_UNSET:0,SDK_TYPE_NATIVE:1,SDK_TYPE_WSS_WEB:3,SDK_TYPE_ZIM_WEB:4}},Service:{$e:{SERVICE_UNSET:0,SERVICE_MEDIAGW:1,SERVICE_LIVEROOM:2,SERVICE_MIX:3,SERVICE_ZEUS:4,SERVICE_ZPUSH:5,SERVICE_L3:6,SERVICE_TALKLINE:7,SERVICE_EDUSUITE:8,SERVICE_ZIM:9,SERVICE_ClOUD_SETTING:10,SERVICE_ZEUSHB:11,SERVICE_USER_LOGIC:12,SERVICE_UNIFYDISPATCH:13,SERVICE_QUALITY:14,SERVICE_SECURITY:15,SERVICE_KTVCPR:16,SERVICE_SWITCH4LIVEROOM:17,SERVICE_WEBRTC_SIGNAL:18,SERVICE_L3_WEBRTC_SIGNAL:19,SERVICE_VIDEOCPR:20,SERVICE_CDN:21,SERVICE_CLOUDRECORD:22,SERVICE_INNER_ECHO:23,SERVICE_OUTER_ECHO:24,SERVICE_LOCALHOST_ECHO:25,SERVICE_ECHO:26,SERVICE_DOCSERVICE:27,SERVICE_AUTHSVR:28,SERVICE_WEBLIVEROOM:29,SERVICE_WHITEBOARD:30,SERVICE_METAWORLD:31,SERVICE_ZEGOLAND:32}},StreamClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},WssAccesshubDispatchGroup:{$m:{1:["group","string",""],2:["host","string",""],3:["main_domain","string",""]}},ZegoconnRunEnv:{$e:{ZEGOCONN_RUN_ENV_UNSET:0,ZEGOCONN_RUN_ENV_BROWSER:1,ZEGOCONN_RUN_ENV_APPLET:2}}},proto_initconfig:{AppConfig:{$m:{1:["test_id","int32",0],2:["domain","string",""],3:["flexible_domain","string",""],4:["replace_flexible_domain","string",""]}},InitConfig:{$m:{1:["app_config","zego_connection.proto_initconfig.AppConfig",null],4:["speedlog_config","zego_connection.proto_initconfig.SpeedlogConfig",null],5:["media_config","zego_connection.proto_initconfig.MediaConfig",null]}},MediaConfig:{$m:{1:["play_config","zego_connection.proto_initconfig.MediaPlayConfig",null],2:["publish_config","zego_connection.proto_initconfig.MediaPublishConfig",null]}},MediaPlayConfig:{$m:{5:["resource_info","<zego_connection.proto_initconfig.MediaResourceInfo",null]}},MediaPublishConfig:{$m:{2:["resource_info","<zego_connection.proto_initconfig.MediaResourceInfo",null],5:["enable_subject_segmentation","int32",0],6:["object_segmentation_platform","int32",0]}},MediaResourceInfo:{$m:{1:["resource_type","zego_connection.proto_initconfig.ResourceType",0],2:["service_info","<zego_connection.proto_initconfig.MediaServiceProtocolInfo",null]}},MediaServiceProtocolInfo:{$m:{1:["config_id","string",""],2:["protocol","zego_connection.proto_initconfig.ProtocolType",0],3:["url_template","string",""],4:["resolve_type","zego_connection.proto_initconfig.ResolveType",0],5:["push_cdn_authentication","int32",0],6:["cdn_quic_version","<int32",null]}},ProtocolType:{$e:{UDP:0,RTMP:1,FLV:2,HLS:3,WEBRTC:4}},ResolveType:{$e:{LOCAL_DNS:0,DISPATCH:1}},ResourceType:{$e:{CDN:0,RTC:1,L3:2,CDN_PLUS:3,CDN_PLUS_BACKUP:4}},SpeedlogConfig:{$m:{1:["report_count","int32",0],2:["report_retry_interval","int32",0],3:["push_quality_sample_count","int32",0],4:["pull_quality_sample_count","int32",0],5:["hardware_report_cycle","int32",0],6:["room_user_max_count","int32",0],7:["room_stream_max_count","int32",0],8:["charge_info_report_cycle","int32",0],9:["charge_info_report_mode","int32",0],10:["disable_report_pull","<zego_connection.proto_initconfig.ResourceType",null],11:["report_max_bytes","int32",0],12:["push_quality_report_freq","int32",0],13:["pull_quality_report_freq","int32",0],14:["charge_info_report_no_playing","int32",0]}}}}},"",z,!1);var L=z.zego_connection,G=function(){return G=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},G.apply(this,arguments)};C.util.Long=N.a,C.configure();var H,j=function(){function t(t){var i;this.stateCenter=t,this.nt=L,this.it=((i={})[h.MSG_TYPE_STREAM_CLOSED]=["proto_accesshub","ConnectionClosed"],i[h.MSG_TYPE_CLOSE_CONNECTION]=["proto_accesshub","CloseConnection"],i[h.MSG_TYPE_HTTP_REQUEST]=["proto_accesshub","HTTPRequest"],i[h.MSG_TYPE_HTTP_RESPONSE]=["proto_accesshub","HTTPResponse"],i[h.MSG_TYPE_HTTP_REQUEST2]=["proto_accesshub","HTTPRequest2"],i[h.MSG_TYPE_HB_REQUEST]=["proto_accesshub","HBRequest"],i[h.MSG_TYPE_HB_RESPONSE]=["proto_accesshub","HBResponse"],i[h.MSG_TYPE_GET_CONFIG_REQUEST]=["proto_accesshub","GetConfigRequest"],i[h.MSG_TYPE_GET_CONFIG_RESPONSE]=["proto_accesshub","GetConfigResponse"],i[h.MSG_TYPE_GET_SVRADDR_REQUEST]=["proto_accesshub","GetSvraddrRequest"],i[h.MSG_TYPE_GET_SVRADDR_RESPONSE]=["proto_accesshub","GetSvraddrResponse"],i[h.MSG_TYPE_HTTP_REQUEST_ACK]=["proto_accesshub","HTTPRequestAck"],i[h.MSG_TYPE_PC_UPWARD_MESSAGE]=["proto_accesshub","PCUpwardMessage"],i[h.MSG_TYPE_PC_UPWARD_MESSAGE_ACK]=["proto_accesshub","PCUpwardMessageAck"],i[h.MSG_TYPE_PC_ESTABLISHED]=["proto_accesshub","PCEstablished"],i[h.MSG_TYPE_PC_BROKEN]=["proto_accesshub","PCBroken"],i[h.MSG_TYPE_PC_DOWNWARD_MESSAGE]=["proto_accesshub","PCDownwardMessage"],i[h.MSG_TYPE_REDIRECT]=["proto_accesshub","Redirect"],i[h.MSG_TYPE_REDIRECT2]=["proto_accesshub","Redirect2"],i[h.MSG_TYPE_GET_APPCONFIG_REQUEST]=["proto_accesshub","GetAppConfigRequest"],i[h.MSG_TYPE_GET_APPCONFIG_RESPONSE]=["proto_accesshub","GetAppConfigResponse"],i[h.MSG_TYPE_PUSH_APPCONFIG]=["proto_accesshub","PushAppConfig"],i[h.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST]=["proto_accesshub","AccesshubDispatchRequest"],i[h.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE]=["proto_accesshub","AccesshubDispatchResponse"],i[h.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2]=["proto_accesshub","AccesshubDispatchRequest2"],i[h.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2]=["proto_accesshub","AccesshubDispatchResponse2"],i[h.MSG_TYPE_PUSH_EXCEPTION]=["proto_accesshub","PushException"],i)}return t.prototype.encodeRequest=function(t,i,n,r){var o,u=this.it[t],h=this.et(this.nt[u[0]][u[1]],i),a=h.length,c=13;return this.stateCenter.appInfo.model===e.Private?((o=new Uint8Array(13+a))[0]=172,o[1]=0,o[2]=0,o.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),3),o[7]=t>>8,o[8]=t-(o[2]<<8),o.set(new Uint8Array(Int32Array.from([a]).buffer).reverse(),9)):r===s.WebTransport?((o=new Uint8Array(9+a))[0]=175,o[1]=0,o[2]=t>>8,o[3]=t-(o[2]<<8),o.set(new Uint8Array(Int32Array.from([a]).buffer).reverse(),4),o[8]=0,c=9):((o=new Uint8Array(13+a))[0]=175,o[1]=0,o[2]=t>>8,o[3]=t-(o[2]<<8),o.set(new Uint8Array(Int32Array.from([a]).buffer).reverse(),4),o.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),8),o[12]=0),o.set(h,c),o},t.prototype.decodeResponse=function(t,i){var n,r,o,u=13,h=0,a=0;if(this.stateCenter.appInfo.model===e.Private?(n=(t[7]<<8)+t[8],r=new DataView(t.buffer).getUint32(3)):i===s.WebTransport?(n=(t[2]<<8)+t[3],new DataView(t.buffer),r=0,u=9,h=t[4]*Math.pow(256,3)+t[5]*Math.pow(256,2)+256*t[6]+t[7]):(n=(t[2]<<8)+t[3],r=new DataView(t.buffer).getUint32(8)),i===s.WebTransport)if((a=t.length-u-h)>0)o=t.slice(u,t.length-a);else{if(a<0)return[r,n,null,a];o=t.slice(u)}else o=t.slice(u);return[r,n,this.decodeBody(o,n),a]},t.prototype.decodeBody=function(t,i){try{var n=this.it[i];return this.st(this.nt[n[0]][n[1]],t)}catch(t){return{code:1}}},t.prototype.decodeConfigMessage=function(t){return this.st(this.nt.proto_initconfig.InitConfig,t)},t.prototype.et=function(t,i){return t.encode(new t(i)).finish()},t.prototype.st=function(t,i){return G({},t.decode(i))},t}(),$=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this.ot=t,this.h=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this.ot?this.ot:null},set:function(t){this.ot=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this.h},set:function(t){this.h=t},enumerable:!1,configurable:!0}),t.prototype.hasNext=function(){return this.next&&this.next.id},t.prototype.hasPrev=function(){return this.prev&&this.prev.id},t}(),B=function(){function t(){this.start=new $,this.end=new $,this.rt=1,this.ct=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return t.prototype.insertBefore=function(t,i){var n=new $(this.rt,i);return n.next=t,n.prev=t.prev,t.prev&&(t.prev.next=n),t.prev=n,++this.rt,++this.ct,n},t.prototype.addLast=function(t){return this.insertBefore(this.end,t)},t.prototype.add=function(t){return this.addLast(t)},t.prototype.getFirst=function(){return 0===this.ct?null:this.start.next},t.prototype.getLast=function(){return 0===this.ct?null:this.end.prev},t.prototype.size=function(){return this.ct},t.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(t>=0)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},t.prototype.get=function(t){return 0===t?this.getFirst():t===this.ct-1?this.getLast():this.getFromFirst(t)},t.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this.ct,t},t.prototype.removeFirst=function(){var t=null;return this.ct>0&&this.start.next&&(t=this.remove(this.start.next)),t},t.prototype.removeLast=function(){var t=null;return this.ct>0&&this.end.prev&&(t=this.remove(this.end.prev)),t},t.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this.ct=0,this.rt=1},t.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},t.prototype.forEach=function(t){for(var i=this.start;i.hasNext()&&!t(i=i.next););},t.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},t.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},t.prototype.push=function(t){return this.addLast(t)},t.prototype.unshift=function(t){this.insertBefore(this.ct>0?this.start.next:this.end,t)},t.prototype.pop=function(){return this.removeLast()},t.prototype.shift=function(){return this.removeFirst()},t}(),V=function(){function t(){this.txid=0,this.linkRetryTime=60,this.updatedMsgTime=0,this.connectServer=""}return t.prototype.createSocket=function(t){},t.prototype.setState=function(t){},t.prototype.initEvent=function(t,i,n,e,s){},t.prototype.sendMessage=function(t,i,n,e,s,r,o,u,h){void 0===e&&(e=!0),void 0===s&&(s=null),void 0===r&&(r=null),void 0===o&&(o=null),void 0===u&&(u={timeout:5e3,isInSendMap:!0})},t}();!function(t){t[t.BROWSER=0]="BROWSER",t[t.WEIXINMINI=1]="WEIXINMINI"}(H||(H={}));var J,F=function(){function t(t,i){this.url=t,this.readyState=r.CLOSED,this.ut=wx.connectSocket({url:t}),this.init()}return t.prototype.init=function(){var t=this;this.ut&&(this.readyState=r.CONNECTING,this.ut.onOpen((function(i){t.readyState=t.ut.readyState,"function"==typeof t.onopen&&(t.onopen(i),t.ut.onClose((function(i){t.readyState=t.ut.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t.ut.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this.ut.onError((function(i){t.readyState=t.ut.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},t.prototype.onopen=function(t){},t.prototype.onerror=function(t){},t.prototype.onclose=function(t){},t.prototype.onmessage=function(t){},t.prototype.send=function(t,i,n){t instanceof Uint8Array&&(t=new Uint8Array(t).buffer),this.ut&&this.ut.send({data:t})},t.prototype.close=function(){this.ut&&this.ut.close()},t}();function Y(t,i,n){return i%2===H.BROWSER?function(t,i){return i?i.createSocket(t,0):new WebSocket(t)}(t,n):new F(t)}!function(t){t[t.NotSupport=0]="NotSupport",t[t.LinkFailed=1]="LinkFailed",t[t.CreateStreamFailed=2]="CreateStreamFailed",t[t.WriteDataFailed=3]="WriteDataFailed",t[t.ReadDataFailed=4]="ReadDataFailed",t[t.GetConfigFailed=5]="GetConfigFailed",t[t.NoUseableHttp3Server=6]="NoUseableHttp3Server",t[t.ClosedTooOften=7]="ClosedTooOften",t[t.LinkTimeout=8]="LinkTimeout"}(J||(J={}));var W=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},X=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},Z=function(){function t(){this.readyState=r.CLOSED,this.ht=null,this.ft=[],this._t=[]}return t.isSupport=function(){var t,i;return window&&!!window.WebTransport&&!!(null===(i=null===(t=window.WebTransport)||void 0===t?void 0:t.prototype)||void 0===i?void 0:i.createBidirectionalStream)},t.prototype.getStreamByID=function(t){return this.ft.find((function(i){return i.streamID===t}))||null},t.prototype.startConnect=function(t){var i=this;try{this.ht=new WebTransport(t),this.readyState=r.CONNECTING,this.ht.ready.then((function(t){i.readyState=r.OPEN,i.onopen(t),i.onTransportClosed()})).catch((function(t){i.readyState=r.CLOSED,i.lt(J.LinkFailed,t),i.close()}))}catch(t){this.readyState=r.CLOSED,this.lt(J.NotSupport,t)}},t.prototype.onTransportClosed=function(){return W(this,void 0,void 0,(function(){var t;return X(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.ht.closed];case 1:return i.sent(),this.readyState!==r.CLOSED&&this.onclose&&this.onclose({code:0,message:"server-side h3 closed"}),[3,3];case 2:return t=i.sent(),this.readyState!==r.CLOSED&&this.onclose&&this.onclose(t),[3,3];case 3:return this.readyState=r.CLOSED,this.ht=null,this.ft=[],this._t=[],[2]}}))}))},t.prototype.onopen=function(t){},t.prototype.onerror=function(t){},t.prototype.onclose=function(t){},t.prototype.onmessage=function(t,i){},t.prototype.onBackToWebSocket=function(t,i){},t.prototype.lt=function(t,i){this.ht&&this.onBackToWebSocket(t,i)},t.prototype.send=function(t,i,n,e){var s;return W(this,void 0,void 0,(function(){var r,o=this;return X(this,(function(u){switch(u.label){case 0:return this.ht&&i?(null==(r=this.getStreamByID(i))?void 0:r.stream)?[3,2]:(null==r?void 0:r.isCreating)?(this._t.push({msg:t,streamID:i,type:n,streamType:e}),[2]):[4,this.createStream(e,i)]:[2];case 1:r=u.sent(),u.label=2;case 2:if(null==r?void 0:r.stream)try{null===(s=r.writer)||void 0===s||s.write(t),n===h.MSG_TYPE_STREAM_CLOSED&&this.closeStream(r.streamID),this._t=this._t.filter((function(t){var e;return t.streamID!==i||(null===(e=null==r?void 0:r.writer)||void 0===e||e.write(t.msg),n===h.MSG_TYPE_STREAM_CLOSED&&o.closeStream(t.streamID),!1)}))}catch(t){this.lt(J.WriteDataFailed,t),this.close()}return[2]}}))}))},t.prototype.close=function(){return W(this,void 0,void 0,(function(){return X(this,(function(t){return this.readyState=r.CLOSED,this.ht&&(this.ht.close(),this.ht=null),this.ft=[],this._t=[],[2]}))}))},t.prototype.createStream=function(t,i){return W(this,void 0,void 0,(function(){var n,e,s;return X(this,(function(r){switch(r.label){case 0:if(!this.ht)return[2,null];(n=this.getStreamByID(i))||this.ft.push(n={streamID:i,streamType:t,stream:null,writer:null,reader:null,isCreating:!0}),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.ht.createBidirectionalStream()];case 2:return e=r.sent(),n.stream=e,n.writer=e.writable.getWriter(),n.reader=e.readable.getReader(),n.isCreating=!1,this.initReader(n.reader,n.streamID),[2,n];case 3:return s=r.sent(),this.lt(J.CreateStreamFailed,s),this.close(),[3,4];case 4:return[2,null]}}))}))},t.prototype.closeStream=function(t){var i;return W(this,void 0,void 0,(function(){var n;return X(this,(function(e){switch(e.label){case 0:if(n=this.getStreamByID(t),this.ft=this.ft.filter((function(i){return i.streamID!==t})),!(null==n?void 0:n.stream))return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),n.stream.writable.locked&&(null===(i=n.writer)||void 0===i||i.releaseLock()),[4,n.stream.writable.close()];case 2:case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},t.prototype.initReader=function(t,i){var n,e;return W(this,void 0,void 0,(function(){var s,r,o,u,h;return X(this,(function(a){switch(a.label){case 0:a.label=1;case 1:return a.trys.push([1,3,,4]),[4,t.read()];case 2:return s=a.sent(),r=s.value,o=s.done,u=this.getStreamByID(i),o||!u?(this.closeStream(i),t.releaseLock(),[2]):(this.onmessage&&this.onmessage(r,u.streamID),[3,4]);case 3:return h=a.sent(),-1!==(null===(n=null==h?void 0:h.message)||void 0===n?void 0:n.indexOf("RESET_STREAM"))?(this.ft=this.ft.filter((function(t){return t.streamID!==i})),[2]):(-1===(null===(e=null==h?void 0:h.message)||void 0===e?void 0:e.indexOf("closed"))&&(this.lt(J.ReadDataFailed,h),this.close()),[2]);case 4:return[3,0];case 5:return[2]}}))}))},t}(),K=function(){function t(t,i){this.proxyCtrl=i,this.dt=null,this.server="",this.type=s.WebSocket,this.ENV=t}return t.prototype.createSocket=function(t,i){var n=this;this.server=t,this.type=i,this.type===s.WebTransport?(this.dt=new Z,this.dt.onBackToWebSocket=function(t,i){n.type===s.WebTransport&&n.onBackToWebSocket&&n.onBackToWebSocket(t,i)},this.dt.startConnect(t)):(this.type=s.WebSocket,this.dt=Y(t,this.ENV%2,this.proxyCtrl))},t.prototype.openHandler=function(t){var i=this;this.dt&&(this.dt.onopen=function(n){i.type===s.WebSocket&&(i.dt.binaryType="arraybuffer"),i.responseHandler(),t(n)})},t.prototype.responseHandler=function(){var t=this;this.dt&&(this.dt.onmessage=function(i,n,e){var r=i;t.type===s.WebSocket&&(r="string"==typeof i.data?JSON.parse(i.data):i.data),t.onMessage(r,n,e)})},t.prototype.onMessage=function(t,i,n){},t.prototype.closeHandler=function(t){this.dt&&(this.dt.onclose=t)},t.prototype.errorHandler=function(t){this.dt&&(this.dt.onerror=t)},t.prototype.closeSocket=function(){this.dt&&(this.dt.onclose=null,this.dt.onerror=null,this.dt.close(),this.dt=null)},t.prototype.isDisConnect=function(){return!this.dt||this.dt.readyState!==r.OPEN},t.prototype.sendMessage=function(t,i,n,e){this.isDisConnect()||this.dt&&this.dt.send(t,i,n,e)},t.prototype.onBackToWebSocket=function(t,i){},t.prototype.closeStream=function(t){var i;this.type===s.WebTransport&&(null===(i=this.dt)||void 0===i||i.closeStream(t))},t.prototype.hasStream=function(t){var i,n;return this.type===s.WebTransport&&!!(null===(n=null===(i=this.dt)||void 0===i?void 0:i.getStreamByID(t))||void 0===n?void 0:n.stream)},t}(),Q={code:1100002,msg:"network timeout."},tt={code:1100004,msg:"net agent timeout"},it={code:1100006,msg:"net connect timeout"},nt={code:1100007,msg:"the user breaks the network connection"},et="zn.zca.gc",st="zn.zca.oce",rt="zn.zca.gac",ot="zn.zca.rd",ut="zn.zca.cc",ht="zn.zca.ir.0",at="zn.sai.0",ct="zn.shq.0",lt="zn.nab.gsa",ft="zn.nab.du",dt="zn.nab.gac",_t="zn.nhb.s",vt="zn.rlh.at",mt="zn.rlh.sm",pt="zn.wl.cs.0",gt="zn.wl.bse.wss",bt="zn.wl.bse.h3",Et="zn.wl.h3.g",St="zn.wl.h3.t.2",yt="zn.wl.h3.s",Tt="zn.napr.sr",Rt="zn.napr.ope",wt="zn.nahr.sr",Ot="zn.nahr.sr2",It={domains:["accesshub-wss.zego.im"],mode:"online",modeNo:f.MODE_ONLINE,sdkType:3,connectVer:32,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1,model:e.Normal},Nt="z_net_http3_servers_status",Ct="0c9e6e0f8c0a8f4e",kt=n(3),Dt=n.n(kt),zt=n(5),At=n.n(zt),Pt=function(t){var i=unescape||window.unescape;return Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})))},Mt=function(t){var i=escape||window.escape;return decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))))};function xt(t,i){var n=function(t,i){try{return 0===t?localStorage.getItem(i):wx.getStorageSync(i)}catch(t){}}(t,"".concat(Nt,"_").concat(i,"_").concat(t));if(!n)return null;var e=function(t,i){try{return Dt.a.decrypt(t,i).toString(At.a)}catch(t){return""}}(n,Ct);return e&&JSON.parse(e)||null}function Ut(t,i,n,e){var s=n;if(e){var r=xt(t,i);r&&(s=Object.assign(r,n))}var o,u=JSON.stringify(s);0===t&&(o=JSON.stringify(s),u=Dt.a.encrypt(o,Ct).toString()),function(t,i,n){try{0===t?localStorage.setItem(i,n):wx.setStorageSync(i,n)}catch(t){}}(t,"".concat(Nt,"_").concat(i,"_").concat(t),u)}var qt,Lt,Gt=(qt=function(t,i){return qt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},qt(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}qt(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),Ht=function(){return Ht=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},Ht.apply(this,arguments)},jt=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},$t=function(t){function i(i,n,e,s){var r=t.call(this)||this;return r.Et=i,r.vt=n,r.St=e,r.proxyCtrl=s,r.urlIndex=0,r.http3Index=0,r.http3Servers=[],r.updatedMsgTime=0,r.unUpdateMsgTimeTypes=[h.MSG_TYPE_HB_REQUEST,h.MSG_TYPE_HB_RESPONSE,h.MSG_TYPE_GET_CONFIG_REQUEST,h.MSG_TYPE_GET_CONFIG_RESPONSE,h.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,h.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2,h.MSG_TYPE_GET_SVRADDR_REQUEST,h.MSG_TYPE_GET_SVRADDR_RESPONSE,h.MSG_TYPE_GET_APPCONFIG_REQUEST,h.MSG_TYPE_GET_APPCONFIG_RESPONSE,h.MSG_TYPE_CLOSE_CONNECTION],r.netLinkState=m,r.sendCommandList=new B,r.unSendCommandList=new B,r.sendCommandMap={},r.unSendCommandMap={},r.gt=100,r.Tt=15e3,r.Ct=1e3,r.bt=5e3,r.connectInterval=1e4,r.connectTimer=null,r.connectRsp={},r.unlogTypes=[12,13],r.tryServers=[],r.tryConnectEvents=[],r.connectStartTime=0,r.isTestedWebTransport=!1,r.msgCache={},r.Rt=0,r.updatedMsgTime=Date.now(),r}return Gt(i,t),i.prototype.initSocketService=function(){var t=this;this.socketService=new K(this.St.env,this.proxyCtrl),this.socketService.onBackToWebSocket=function(i,n){var e;if(t.St.networkState===o.online)if(n&&JSON.stringify(n).includes("Connection lost"))t.closeCallback("error",n);else{if(!t.St.enableHttp3)return;t.vt.info(yt+" reason:"+i+" error:"+JSON.stringify(n)),t.St.enableHttp3=!1,Ut(t.St.env,t.St.appID,((e={})[t.connectServer]={status:!1,time:i===J.LinkTimeout?0:Date.now()},e),!0),t.socketService.closeSocket(),t.netLinkState=m,t.clearMessageList(t.sendCommandList,t.sendCommandMap),t.clearMessageList(t.unSendCommandList,t.unSendCommandMap),t.lt&&t.lt(i,n)}else t.closeCallback("error",n)}},Object.defineProperty(i.prototype,"HBHandler",{set:function(t){this.Ot=t},enumerable:!1,configurable:!0}),i.prototype.setLogger=function(t){this.vt=t},i.prototype.initEvent=function(t,i,n,e,s){this.At=t,this.Pt=i,this.It=n,this.Nt=e,this.lt=s},i.prototype.createSocket=function(t){},i.prototype.setServers=function(t,i){void 0===i&&(i=[]),this.servers=t,this.urlIndex=0,this.setHttp3Servers(i)},i.prototype.setHttp3Servers=function(t){this.http3Servers=t,this.http3Index=0},i.prototype.isNeedTestWebTransport=function(){return!!this.isEnableHttp3()&&0!==this.http3Servers.length&&!this.isTestedWebTransport},i.prototype.destroySocket=function(t,i){var n;this.vt.info("zn.wl.ds.0 call "+t),null===(n=this.socketService)||void 0===n||n.closeSocket(),this.netLinkState=m,t!==_.NONE&&(i&&this.Dt(this.connectServer||"",i.code,!0),this.Pt&&this.Pt(t===_.BROKEN,this.tryServers,this.tryConnectEvents)),this.resetConnect()},i.prototype.refreshServers=function(t){this.servers=jt(jt([],t,!0),this.servers,!0)},i.prototype.isEnableHttp3=function(){return!!this.St.enableHttp3&&!!this.St.customConfig.enableHttp3&&this.St.appInfo.model!==e.Private&&!this.proxyCtrl},i.prototype.connectSocket=function(t,i,n){var e,r=this;void 0===t&&(t=!0),this.vt.info(pt+" call"),this.connectRsp.suc=i;var u,h,a=!1;this.connectRsp.fail=function(){n&&(a?r.vt.info(pt+" fail cb has exec"):(n(),a=!0))},t&&(this.urlIndex=(this.urlIndex+1)%this.servers.length),this.vt.info(pt+" enableHttp3:"+this.isEnableHttp3());var c=this.isEnableHttp3()?this.getUseableHttp3Server(this.http3Servers):"";return c.length>0?(h=s.WebTransport,this.vt.info("zn.wl.cs.h3 connect server:"+(u=c))):(h=s.WebSocket,this.vt.info("zn.wl.cs.wss connect server:"+(u=this.servers[this.urlIndex]))),this.tryServers.push(u),this.connectStartTime=Date.now(),this.closeSocket(),this.netLinkState=p,this.Rt=Date.now(),null===(e=this.socketService)||void 0===e||e.createSocket(u,h),this.connectServer=u,this.It&&this.It(!0),this.bindSocketEvent(),this.connectTimer=setTimeout((function(){var t,i;r.vt.info(pt+" timeout"),r.Dt(u,it.code),null===(t=r.Pt)||void 0===t||t.call(r,!0),r.netLinkState=m,h===s.WebTransport&&r.St.networkState===o.online?null===(i=r.socketService)||void 0===i||i.onBackToWebSocket(J.LinkTimeout,"connect timeout"):r.connectRsp.fail&&r.connectRsp.fail()}),this.connectInterval),!0},i.prototype.closeCallback=function(t,i){var n,e=(null===(n=this.socketService)||void 0===n?void 0:n.type)===s.WebTransport?bt:gt;this.vt.warn("".concat(e," ").concat(t," ").concat(JSON.stringify(i.code?i.code:i))),this.resetConnect(),this.Dt(this.connectServer,(null==i?void 0:i.code)||it.code),this.Pt&&this.Pt(!0),this.netLinkState=m,this.connectRsp.fail&&this.connectRsp.fail()},i.prototype.bindSocketEvent=function(){var t,i=this,n=(null===(t=this.socketService)||void 0===t?void 0:t.type)===s.WebTransport?bt:gt;this.openHandler((function(){i.vt.info(n+" open  time:"+(Date.now()-i.Rt)),i.resetConnect(),i.connectRsp.suc&&i.connectRsp.suc(),i.netLinkState=g,i.Dt(i.connectServer,0),i.At&&i.At(i.tryServers,i.tryConnectEvents),i.tryConnectEvents=[],i.checkUnSendMsgs(i.unSendCommandList,i.unSendCommandMap)})),this.closeHandler((function(t){i.closeCallback("close",t)})),this.errorHandler((function(t){i.closeCallback("error",t)})),this.onMessage()},i.prototype.closeSocket=function(){var t;this.vt.info("zn.wl.cs.1 call"),null===(t=this.socketService)||void 0===t||t.closeSocket(),this.netLinkState=m},i.prototype.Dt=function(t,i,n){if(this.connectStartTime||n){var e=this.connectStartTime?Date.now()-this.connectStartTime:0,s=t.includes("https")?1:3;this.tryConnectEvents.push({url:t,time_consumed:e,connect_type:s,error:i})}},i.prototype.resetConnect=function(){this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=null)},i.prototype.release=function(){this.stopCheck(),this.sendCommandList=new B,this.unSendCommandList=new B,this.sendCommandMap={},this.unSendCommandMap={},this.msgCache={}},i.prototype.isConnect=function(){return this.netLinkState===g},i.prototype.isDisConnect=function(){return!this.socketService||this.socketService.isDisConnect()},i.prototype.isConnecting=function(){return this.netLinkState===p},i.prototype.setState=function(t){this.netLinkState=t},i.prototype.closeHandler=function(t){var i;null===(i=this.socketService)||void 0===i||i.closeHandler(t)},i.prototype.openHandler=function(t){var i;null===(i=this.socketService)||void 0===i||i.openHandler(t)},i.prototype.errorHandler=function(t){var i;null===(i=this.socketService)||void 0===i||i.errorHandler(t)},i.prototype.sendMessage=function(t,i,n,e,r,o,u,a,c){var f,d,_;void 0===e&&(e=!0),void 0===r&&(r=null),void 0===o&&(o=null),void 0===u&&(u=null),void 0===a&&(a={}),(void 0===a.timeout||a.timeout<=0)&&(a.timeout=this.bt),void 0===a.isInSendMap&&(a.isInSendMap=!0),void 0===a.isMsgCache&&(a.isMsgCache=!0),this.txid++;var v={appid:this.St.appID,biz_type:0,mode_no:this.St.appInfo.mode,sdk_type:It.sdkType,zegoconn_run_env:0===this.St.env?l.ZEGOCONN_RUN_ENV_BROWSER:l.ZEGOCONN_RUN_ENV_APPLET,zegoconn_version:this.St.appInfo.connVer};(null===(f=this.St.appInfo)||void 0===f?void 0:f.deviceID)&&(v.device_id=this.St.appInfo.deviceID),(null===(d=this.socketService)||void 0===d?void 0:d.type)===s.WebTransport&&((null===(_=this.socketService)||void 0===_?void 0:_.hasStream(i))||(e=!0));var m=Ht({id_name:this.St.userId},e?v:{}),p=Ht(Ht({txid:this.txid},m),n),g=Date.now(),b={data:p,txid:this.txid,sendTime:g,streamID:i,type:t,timeOut:g+a.timeout,ack:n.ack,success:r,error:o,ackFunc:u,isSend:!0,isCheck:t!==h.MSG_TYPE_PC_UPWARD_MESSAGE,extras:a.extras,streamType:c};if(a.isInSendMap){var E=this.sendCommandList.push(b);this.sendCommandMap[this.txid]=E,!this.yt&&this.startCheck()}if(!(10===p.service||14===p.interface_id)&&this.unUpdateMsgTimeTypes.includes(t)||(this.updatedMsgTime=Date.now()),-1===this.unlogTypes.indexOf(t)&&this.vt.info("zn.wl.sm type: "+t+"-"+O[t]+" streamID: "+i+" txid: "+this.txid),this.isConnect())this.sendUint8Data(t,p,i,c);else if(a.isMsgCache){b.isSend=!1;var S=this.unSendCommandList.push(b);this.unSendCommandMap[this.txid]=S}},i.prototype.checkUnSendMsgs=function(t,i){var n=this;t.forEach((function(e){return!e||(t.remove(e),!!e.h&&(delete i[e.h.txid],!1===e.h.isSend&&e.h.type&&e.h.streamID&&e.h.data&&(n.sendUint8Data(e.h.type,e.h.data,e.h.streamID,e.h.streamType),e.h.isSend=!0),!1))}))},i.prototype.clearUnsentMsgs=function(t){var i=this;this.unSendCommandList.forEach((function(n){var e;(null===(e=null==n?void 0:n.h)||void 0===e?void 0:e.streamID)===t&&(i.unSendCommandList.remove(n),delete i.unSendCommandMap[n.h.txid])}))},i.prototype.wt=function(t){return t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset)},i.prototype.sendUint8Data=function(t,i,n,e){var s,r,o,u=this.Et.encodeRequest(t,i,n,null===(s=this.socketService)||void 0===s?void 0:s.type);null===(r=this.socketService)||void 0===r||r.sendMessage(this.wt(u),n,t,e),null===(o=this.Ot)||void 0===o||o.startHB()},i.prototype.onMessage=function(){var t=this;this.msgCache={},this.socketService&&(this.socketService.onMessage=function(i,n){var e;t.St.lastRecvMsgTime=Date.now();var r,o,u=new Uint8Array(i);if(t.socketService.type===s.WebTransport){var a=t.msgCache[n];if(a&&a.undecodedDataLen<0){var c=u.byteLength,l=Math.abs(a.undecodedDataLen),f=u.slice(0,l),d=new Uint8Array(a.data.byteLength+f.byteLength);if(d.set(a.data,0),d.set(f,a.data.byteLength),c>l)r=a.streamID,o=u.slice(l);else if(c<l)return a.undecodedDataLen-=c,void(a.data=d);delete t.msgCache[n],u=d}}var _=t.Et.decodeResponse(u,t.socketService.type),v=_[0],m=_[1],p=_[2],g=_[3];if(t.socketService.type===s.WebTransport){if(r=n,g<0)return void(t.msgCache[n]={streamID:n,data:u,undecodedDataLen:g})}else m===h.MSG_TYPE_GET_CONFIG_RESPONSE&&t.isNeedTestWebTransport()&&t.testWebTransport(t.http3Servers),r=v;(null==p?void 0:p.txid)&&N.a.isLong(p.txid)&&p.txid.toNumber&&(p.txid=p.txid.toNumber()),t.unUpdateMsgTimeTypes.includes(m)||(t.updatedMsgTime=Date.now());var b=(null==p?void 0:p.txid)||(null===(e=null==p?void 0:p.data)||void 0===e?void 0:e.txid);if(-1===t.unlogTypes.indexOf(m)){var E=b?", txid: ".concat(b):"";t.vt.info("zn.wl.om"+" streamID: ".concat(r,", msgType: ").concat(m,"-").concat(O[m])+E)}b&&t.isRspMsg(b)?t.handleSendCommandMsgRsp(m,b,p,{size:u.length}):t.Nt(r,m,p,{size:u.length}),g>0&&(f=u.slice(u.byteLength-g,u.byteLength),t.socketService.onMessage(t.wt(f),n)),o&&t.socketService.onMessage(t.wt(o),n)})},i.prototype.isRspMsg=function(t){return void 0!==this.sendCommandMap[t]},i.prototype.startCheck=function(){var t=this;this.Mt(this.sendCommandList,this.sendCommandMap,this.unSendCommandList,this.unSendCommandMap),this.yt=setTimeout((function(){t.startCheck()}),this.Ct)},i.prototype.stopCheck=function(){this.zt(this.sendCommandList),this.yt&&(clearTimeout(this.yt),this.yt=null)},i.prototype.Mt=function(t,i,n,e){var s=this,r=Date.now(),o=0;t.forEach((function(u){if(!u)return!0;if(!u.h)return!1;if(u.h.timeOut<=r){t.remove(u),delete i[u.h.txid];var h=e[u.h.txid];if(h&&(n.remove(h),delete e[u.h.txid]),null==u.h.error||u.h.sendTime+s.Tt<r);else{var a=u.h.error;u.h.isCheck&&a&&a({},u.h.txid,Q)}if(++o>=s.gt)return!0}return!1}))},i.prototype.zt=function(t){t.forEach((function(i){if(!i)return!0;if(t.remove(i),!i.h)return!1;if(i.h.isSend&&i.h.error){var n=i.h.error,e=i.h.txid;i.h.isCheck&&setTimeout((function(){n({},e,Q)}),0)}return!1}))},i.prototype.clearMessageList=function(t,i){t.forEach((function(n){if(!n)return!0;if(t.remove(n),!n.h)return!1;if(n.h.error){var e=n.h.error,s=n.h.txid;n.h.isCheck&&setTimeout((function(){i[n.h.txid]&&delete i[n.h.txid],e({},s,Q)}),0)}return!1}))},i.prototype.handleSendCommandMsgRsp=function(t,i,n,e){var s=this.sendCommandMap[i];if(null!=s){var r=s.h;(null==r?void 0:r.ack)||(delete this.sendCommandMap[i],this.sendCommandList.remove(s)),n.code&&0!==n.code?r&&null!=r.error&&(r.error(n,i),r.success=null,r.error=null):t===h.MSG_TYPE_PUSH_EXCEPTION?(n.code=n.reason,n.message=n.msg,delete n.reason,delete n.msg,r&&null!=r.error&&(r.error(n,i),r.success=null,r.error=null)):t===h.MSG_TYPE_HTTP_REQUEST_ACK?r&&null!=r.ackFunc&&r.ackFunc(n,i):r&&null!=r.success&&(r.success(n,i,e),r.success=null,r.error=null)}},i.prototype.lt=function(t,i){},i.prototype.getUseableHttp3Server=function(t){var i="",n=xt(this.St.env,this.St.appID);if(this.vt.info(Et+" cache:"+JSON.stringify(n)),n)for(var e=0,s=Object.keys(n);e<s.length;e++){var r=s[e];if(n[r].status&&t.includes(r)){i=r;break}}return this.vt.info(Et+" "+i),i},i.prototype.Ut=function(t){if(!t.length)return[];var i=t,n=xt(this.St.env,this.St.appID);if(n){for(var e=0,s=Object.keys(n);e<s.length;e++){var r=s[e];if(t.includes(r)){var o=n[r].time;Date.now()-o>864e5&&delete n[r]}else delete n[r]}Ut(this.St.env,this.St.appID,n),i=t.filter((function(t){return!n[t]}))}return Array.from(new Set(i))},i.prototype.testWebTransport=function(t){this.isTestedWebTransport=!0;var i=this.Ut(t);this.vt.info("zn.wl.h3.t servers:"+JSON.stringify(i)),this.startTestHttp3Server(i)},i.prototype.startTestHttp3Server=function(t){var i=this;if(t.length){var n=t.shift();this.vt.info("zn.wl.h3.t.0 start:"+n);var e=new Z,r=Date.now();e.onBackToWebSocket=function(e){var s;i.vt.info("".concat(St," failed:").concat(n," reason:").concat(e," time:").concat(Date.now()-r,"ms")),Ut(i.St.env,i.St.appID,((s={})[n]={status:!1,time:Date.now()},s),!0),i.startTestHttp3Server(t)},e.onopen=function(t){var n,r;i.txid++;var o={appid:i.St.appID,biz_type:0,mode_no:i.St.appInfo.mode,sdk_type:It.sdkType,zegoconn_run_env:0===i.St.env?l.ZEGOCONN_RUN_ENV_BROWSER:l.ZEGOCONN_RUN_ENV_APPLET,zegoconn_version:i.St.appInfo.connVer};(null===(n=i.St.appInfo)||void 0===n?void 0:n.deviceID)&&(o.device_id=null===(r=i.St.appInfo)||void 0===r?void 0:r.deviceID);var u=Ht({id_name:i.St.userId},o),a=i.St.appInfo.geoFencing,c=Ht(Ht({txid:i.txid},u),{geofencing_type:null==a?void 0:a.type,geofencings:null==a?void 0:a.list}),f=h.MSG_TYPE_GET_CONFIG_REQUEST,_=Date.now(),v=i.Et.encodeRequest(f,c,_,s.WebTransport);e.send(i.wt(v),_,f,d.OTHER)},e.onmessage=function(o){var u,a;try{if(Date.now()-r>i.connectInterval)i.vt.info("".concat(St," failed:").concat(n," reason:").concat(J.LinkTimeout," time:").concat(Date.now()-r,"ms"));else{var c=new Uint8Array(o),l=i.Et.decodeResponse(c,s.WebTransport);if(l[1]===h.MSG_TYPE_GET_CONFIG_RESPONSE&&0===l[2].code)return i.vt.info("".concat("zn.wl.h3.t.1"," success:").concat(n," time: ").concat(Date.now()-r,"ms")),Ut(i.St.env,i.St.appID,((u={})[n]={status:!0,time:Date.now()},u),!0),void e.close()}}catch(t){i.vt.info("".concat(St," failed:").concat(n," reason:").concat(J.GetConfigFailed," error:").concat(JSON.stringify(t),"  time:").concat(Date.now()-r,"ms"))}e.close(),e=null,Ut(i.St.env,i.St.appID,((a={})[n]={status:!1,time:Date.now()},a),!0),i.startTestHttp3Server(t)},e.startConnect(n)}},i}(V),Bt=function(){function t(t,i,n,e){this.Ht=t,this.Et=i,this.vt=n,this.stateCenter=e}return Object.defineProperty(t.prototype,"appInfo",{get:function(){return this.stateCenter.appInfo},enumerable:!1,configurable:!0}),t.prototype.setLogger=function(t){this.vt=t},t.prototype.getConfig=function(t,i){this.vt.info("zn.nab.gc call");var n=this.Ht.getFreeStream(d.OTHER),e=this.appInfo.geoFencing;n.sendMessage(h.MSG_TYPE_GET_CONFIG_REQUEST,{geofencing_type:null==e?void 0:e.type,geofencings:null==e?void 0:e.list},t,i)},t.prototype.dispatchURL=function(t,i){var n=this;this.vt.info(ft+" call");var e=this.Ht.getFreeStream(d.OTHER),s=this.appInfo.geoFencing;e.sendMessage(h.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,{geofencing_type:null==s?void 0:s.type,geofencings:null==s?void 0:s.list},(function(i){n.vt.info(ft+" suc "),t&&t(i)}),(function(t,e,s){n.vt.info(ft+" fail"),i&&i(s||t)}))},t.prototype.getAppConfig=function(t,i,n,e,s,r){var o=this;return new Promise((function(u,a){o.vt.info(dt+" call");var c={id_name:i,config_key:t,token:n,mode_no:o.appInfo.mode,etag:s,is_special_customer:(null==r?void 0:r.isSpecial)?1:0},l=function(t,i,n){if(n)return o.vt.error(dt+" fail "+JSON.stringify(n)),void a(n);if(0===t.code){o.vt.info(dt+" suc");var e=o.decodeConfigMessage(t.data.data);u({code:0,data:e,etag:t.data.etag})}else o.vt.error(dt+" fail "+t.code),a({code:t.code})};o.Ht.getFreeStream(d.OTHER).sendMessage(h.MSG_TYPE_GET_APPCONFIG_REQUEST,c,l,l,null,{timeout:e})}))},t.prototype.decodeConfigMessage=function(t){return this.Et.decodeConfigMessage(t)},t.prototype.getSvrAddr=function(){var t=this;return new Promise((function(i,n){t.vt.info("".concat(lt," call"));var e=t.Ht.getFreeStream(d.OTHER),s=t.appInfo.geoFencing;e.sendMessage(h.MSG_TYPE_GET_SVRADDR_REQUEST,{geofencing_type:null==s?void 0:s.type,geofencings:null==s?void 0:s.list},(function(n){t.vt.info("".concat(lt," suc")),i(n)}),(function(i,e,s){t.vt.info("".concat(lt," fail")),n(s||i)}))}))},t}();!function(t){t.Lazy="lazy",t.Periodic="periodic"}(Lt||(Lt={}));var Vt=function(){function t(t,i,n){this.Ht=t,this.vt=i,this.St=n,this.Gt=null,this.kt=5,this.Bt=10,this.Vt=0,this.Yt=0,this.Lt=0,this.mode=Lt.Lazy}return Object.defineProperty(t.prototype,"xt",{get:function(){return this.Ht.getHbStream()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$t",{get:function(){var t=this.St.lastRecvMsgTime;return!!t&&Date.now()-t>1e3*this.kt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"qt",{get:function(){var t=this.Lt;return!!t&&Date.now()-t>1e3*this.Bt},enumerable:!1,configurable:!0}),t.prototype.setLogger=function(t){this.vt=t},t.prototype.init=function(t){this.vt.info("zn.nhb.ii call. "),t.data.logic_hb_interval>=1&&t.data.logic_hb_interval<=10&&(this.kt=t.data.logic_hb_interval),t.data.logic_hb_timeout>=3&&t.data.logic_hb_timeout<=30&&(this.Bt=t.data.logic_hb_timeout),this.Yt=0,this.Vt=this.Bt/this.kt,this.startHB()},t.prototype.startHB=function(){var t=this;if(this.xt){var i=this.$t;if(this.vt.debug("zn.nhb.rs call . "+i),!i&&this.Lt&&(this.vt.info(_t+" stop check."),this.Lt=0),null!==this.Gt){if(i||this.mode===Lt.Periodic)return;clearTimeout(this.Gt)}var n=this.Gt=setTimeout((function(){t.Gt===n&&(t.Gt=null),t.$t&&!t.Lt&&(t.vt.info(_t+" start check."),t.Lt=Date.now()),t.qt&&(t.vt.warn(_t+" over max hb timeout. "),t.onHBTimeout&&t.onHBTimeout()),t.jt()}),1e3*this.kt)}},t.prototype.jt=function(){var t=this;if(this.xt){this.vt.debug(_t+" call ."+this.Yt++);var i=(new Date).getTime(),n=function(n,e,s){var r=(new Date).getTime()-i;if(t.vt.debug(_t+" hb callback "+r),s&&0!==(null==s?void 0:s.code))t.vt.warn(_t+" fail "+JSON.stringify(s));else{if(null==n?void 0:n.ntp_time){var o=n.ntp_time,u="number"==typeof o?o:o.toNumber(),h=(new Date).getTime();0===t.St.appInfo.env&&t.St.updateNTP(i,u,h)}t.Yt=0}},e={ts:Date.now()};this.xt.sendMessage(h.MSG_TYPE_HB_REQUEST,e,n,n,null)}},t.prototype.onHBTimeout=function(){},t.prototype.stop=function(){this.Gt&&(clearTimeout(this.Gt),this.Gt=null),this.Yt=0},t}(),Jt=function(){function t(){this.Ft={}}return t.prototype.addEventHandler=function(t,i){if(this.Ft[t]||(this.Ft[t]=[]),"function"!=typeof i)throw new Error("Params callBack is not a Function");return this.Ft[t]&&-1==this.Ft[t].indexOf(i)&&this.Ft[t].push(i),!0},t.prototype.removeEventHandler=function(t,i){return!!this.Ft[t]&&(this.Ft[t]=i?this.Ft[t].filter((function(t){return t!==i})):[],!0)},t.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.Ft[t]&&this.Ft[t].forEach((function(n){try{n.apply(void 0,i)}catch(i){console.error('Fail to execute callback of event "'.concat(t,'" : ').concat(i))}}))},t}(),Ft=function(){return Ft=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},Ft.apply(this,arguments)},Yt=function(){function t(t,i,n,e,s){this.vt=t,this.Wt=i,this.Ht=n,this.Qt=e,this.Jt=s,this.connectState=v.DISCONNECT,this.lastConnectState=v.DISCONNECT,this.brokenTimer=null,this.listenerList={connected:[],broken:[]},this.Kt=null,this.eventManager=new Jt,this.Jt&&(this.Jt.isMsgCache=!1)}return Object.defineProperty(t.prototype,"netPcStream",{get:function(){return this.Kt||this.createPcStream()},enumerable:!1,configurable:!0}),t.prototype.createPcStream=function(){var t=this.Ht.createStream(d.PC);return this.Kt=t,t.onPushEvent=this.onPushEvent.bind(this),t},t.prototype.sendRequest=function(t,i,n,e){var s,r,o,u,a,c,l=this,f=t.payload;(null===(s=this.Jt)||void 0===s?void 0:s.encode)&&(f=Pt(t.payload));var d={service_no:this.Wt,ack:t.ack,payload:f,wss_message_type:null!==(o=null===(r=this.Jt)||void 0===r?void 0:r.messageType)&&void 0!==o?o:It.wssMessageType,wss_path:null===(u=this.Jt)||void 0===u?void 0:u.path,wss_raw_query:null===(a=this.Jt)||void 0===a?void 0:a.query,zegoconn_version:It.connectVer};this.netPcStream.isConnect()||(this.vt.info(Tt+" pc is not connect"),this.eventManager.emit("connectStart")),this.netPcStream.sendMessage(h.MSG_TYPE_PC_UPWARD_MESSAGE,d,(function(){l.vt.info(Tt+" suc"),n&&n()}),(function(t){l.vt.error(Tt+" fail"),i&&i(t)}),null,{isInSendMap:"boolean"==typeof t.isInSendMap&&t.isInSendMap,extras:e,isMsgCache:null===(c=this.Jt)||void 0===c?void 0:c.isMsgCache})},t.prototype.onPushEvent=function(t,i,n){var e;switch(this.vt.info(Rt+" msgType: ".concat(t)),t){case h.MSG_TYPE_PC_ESTABLISHED:this.netPcStream.isFirst=!1,this.pcEstablished(i,this.netPcStream.StreamID);break;case h.MSG_TYPE_PC_BROKEN:this.pcBroken();break;case h.MSG_TYPE_PC_DOWNWARD_MESSAGE:this.vt.info(Rt+" ".concat(this.Wt," down ").concat((null==i?void 0:i.ts)&&i.ts.toNumber&&i.ts.toNumber()||i.ts));var s=i.payload;(null===(e=this.Jt)||void 0===e?void 0:e.encode)&&(s=Mt(i.payload)),this.eventManager.emit("downLoadMessage",s,n);break;case h.MSG_TYPE_PUSH_EXCEPTION:this.vt.info(Rt+" ".concat(this.Wt," exception ").concat(JSON.stringify(i))),this.eventManager.emit("exception",i,n)}},t.prototype.on=function(t,i){return this.eventManager.addEventHandler(t,i)},t.prototype.off=function(t,i){this.eventManager.removeEventHandler(t,i)},t.prototype.pcEstablished=function(t,i){this.vt.info("zn.napr.pe call "+JSON.stringify(t)),this.setConnectState(v.CONNECTED);var n=T.MANUAL;this.lastConnectState===v.BROKEN&&this.connectState===v.CONNECTED&&(n=T.AUTO),this.eventManager.emit("connected",n),this.reportEvent("pcConnectedEvent",{proxy_link_sources:null==t?void 0:t.from,connect_stream:i}),this.brokenTimer&&clearTimeout(this.brokenTimer)},t.prototype.pcBroken=function(){var t=this;this.vt.info("zn.napr.pb call"),this.setConnectState(v.BROKEN),this.eventManager.emit("broken"),this.reportEvent("pcBrokenEvent"),this.brokenTimer=setTimeout((function(){t.eventManager.emit("disconnected",y.TEMP),t.reportEvent("pcDisconnectedEvent")}),1e3*this.Qt)},t.prototype.resetBrokenTimer=function(){this.brokenTimer&&clearTimeout(this.brokenTimer)},t.prototype.Zt=function(t,i){var n;if(this.vt.info("zn.napr.cr call "+this.Wt+" "+this.connectState),this.connectState!==v.DISCONNECT){this.netPcStream.closeStream(0,""),null===(n=this.Kt)||void 0===n||n.destroyed(),this.Kt=null,this.resetBrokenTimer(),this.eventManager.emit(t,i);var e="";"broken"===t?e="pcBrokenEvent":"disconnected"===t&&(e="pcDisconnectedEvent"),e&&this.reportEvent(e)}this.setConnectState(v.DISCONNECT)},t.prototype.closePc=function(){this.Zt("broken")},t.prototype.closeRequest=function(){this.Zt("disconnected",y.CLOSE)},t.prototype.setConnectState=function(t){this.connectState!==t&&(this.lastConnectState=this.connectState,this.connectState=t)},t.prototype.reportEvent=function(t,i){this.eventManager.emit(t,Ft({service_no:this.Wt},i))},t}(),Wt=function(){function t(t,i){this.Ht=t,this.vt=i,this.pcStreamRequests=[],this.pcEstablishTimeout=It.pcEstablishTimeout}return t.prototype.setLogger=function(t){this.vt=t},t.prototype.getRequest=function(t,i){var n=new Yt(this.vt,t,this.Ht,this.pcEstablishTimeout,i);return this.pcStreamRequests.push(n),n},t.prototype.updateConnectState=function(t,i,n){this.vt.info("zn.naprm.ucs call "+t+" "+i),this.pcStreamRequests.forEach((function(e){t===v.BROKEN?(e.eventManager.emit("broken"),e.reportEvent("pcBrokenEvent")):t===v.DISCONNECT&&(e.eventManager.emit("disconnected",i,n),e.reportEvent("pcDisconnectedEvent"))}))},t.prototype.closePCs=function(){this.pcStreamRequests.forEach((function(t){t.closePc()}))},t.prototype.setEstablishTimeout=function(t){this.pcEstablishTimeout=t},t}(),Xt=function(){function t(t,i){this.vt=t,this.St=i,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.Xt=1,this.tn=0,this.nn=3,this.isOverTime=!1,this.RETRY_MAX_TIME=90,this.h3ClosedTimes=[]}return t.prototype.initLink=function(t){this.link=t},t.prototype.startMaxTime=function(){var t=this;this.vt.info(mt+" call"),this.maxTimer||(this.vt.info(mt+" start max timer"),this.maxTimer=setTimeout((function(){t.vt.warn(mt+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.link.destroySocket(_.NONE),t.stopMaxTime(),t.invalid(),t.onactive(!1,tt)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.vt.info("zn.rlh.sm.1 call"),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.active=function(t,i,n){var e=this;if(void 0===i&&(i=!1),void 0===n&&(n=!1),this.vt.info(vt+" call "+t+" "+i),this.St.isDestroyed)return!1;if(this.retryTimer)return this.vt.info(vt+" has actived, ignore"),!1;var r=this.St.networkState==o.offline;if(r){if(this.vt.info(vt+"  check if really offline. "+this.tn),this.tn>=this.nn)return this.vt.warn(vt+" network is broken, stop retry"),!1}else this.tn=0;if(this.link.isConnecting()&&!n)return this.vt.info(vt+" link is connecting, ignore"),!1;if(this.isOverTime)return this.vt.info(vt+" retry over time, stop retry"),!1;if(1==this.Xt)this.en=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var u=Math.pow(2,Math.round(this.Xt/this.RETRY_CONTINUE_COUNT+1));this.en=u>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:u}return this.vt.info(vt+" interval "+this.en),this.retryTimer=setTimeout((function(){i||e.link.destroySocket(_.BROKEN),e.link.connectSocket(t,(function(){e.vt.info(vt+" suc"),e.St.networkState=o.online,e.stopMaxTime(),e.invalid(),e.onactive(!0)}),(function(){var t;if(e.link.socketService.type===s.WebTransport&&e.St.networkState===o.online&&(e.h3ClosedTimes.push(Date.now()),3===e.h3ClosedTimes.length)){if(e.h3ClosedTimes[2]-e.h3ClosedTimes[0]<=15e3)return e.h3ClosedTimes=[],e.vt.info(yt+" reason:"+J.ClosedTooOften+" error:Links break too often"),Ut(e.St.env,e.St.appID,((t={})[e.link.connectServer]={status:!1,time:Date.now()},t),!0),e.St.enableHttp3=!1,!e.maxTimer&&e.startMaxTime(),void e.active(!1,!0);e.h3ClosedTimes.shift()}e.vt.info(vt+" fail"),!e.maxTimer&&e.startMaxTime(),e.active(!0,!1,!0)})),e.retryTimer&&clearTimeout(e.retryTimer),e.retryTimer=null,r?e.tn++:e.Xt++}),i?0:1e3*this.en),!0},t.prototype.onactive=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i]},t.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof t&&t<3600&&(this.RETRY_MAX_TIME=t),"number"==typeof i&&(this.RETRY_START_TIME_INTERVAL=i),"number"==typeof n&&(this.RETRY_CONTINUE_COUNT=n),"number"==typeof e&&(this.RETRY_MAX_TIME_INTERVAL=e)},t.prototype.invalid=function(){this.vt.info("zn.rlh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.Xt=1,this.tn=0},t}(),Zt=function(){function t(){this.networkState=o.online,this.appInfo={appID:0,env:0,mode:It.modeNo,model:It.model,connVer:It.connectVer},this.useNetAgent=!0,this.specified=!1,this.clientIP="",this.timeOffset=0,this.networkRTT=0,this.isDestroyed=!1,this.customConfig={enableHttp3:!1},this.lastRecvMsgTime=0,this.enableHttp3=Z.isSupport()}return Object.defineProperty(t.prototype,"appID",{get:function(){return this.appInfo.appID},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"env",{get:function(){return this.appInfo.env},enumerable:!1,configurable:!0}),t.prototype.updateNTP=function(t,i,n){if(!(t>n)){var e=n-t;this.timeOffset=Math.round((i-t+(i-n))/2);var s=Math.round(i+e/2);(!this.networkRTT||e<this.networkRTT)&&(this.networkRTT=e,this.ntpTimeInfo={performanceTime:Math.round(performance.now()),ntp:s})}},t}(),Kt=function(){function t(){}return t.prototype.log=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.log(n)},t.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.debug(n)},t.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.info(n)},t.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.warn(n)},t.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.error(n)},t}(),Qt=function(){return Qt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},Qt.apply(this,arguments)},ti=function(){function t(t,i,n){this.vt=t,this.Ht=i,this.Wt=n}return Object.defineProperty(t.prototype,"netHttpStream",{get:function(){return this.Ht.getFreeStream(d.HTTP)},enumerable:!1,configurable:!0}),t.prototype.sendRequest=function(t,i,n,e,s){var r=this,o=t.disableLog,u={service_no:this.Wt,ack:t.ack,headers:t.headers,body:Pt(JSON.stringify(t.body)),id_name:t.idName,method_no:t.method_no,stick:t.stick,location:t.location,reduce_resp_header:t.reduceRspHeaders?1:0};this.netHttpStream.sendMessage(h.MSG_TYPE_HTTP_REQUEST,u,(function(t){var n=(null==t?void 0:t.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)}));if("gzip"===(null==n?void 0:n.val))!o&&r.vt.info(wt+" gzip");else if(t.body){var e=Mt(t.body);t.body=e}var s=Qt(Qt({},t),{body:void 0});!o&&r.vt.info(wt+" suc "+JSON.stringify(s)),i&&i(t)}),(function(t,i,e){!o&&r.vt.error(wt+" fail"),n&&n(e||t)}),(function(t){!o&&r.vt.error(wt+" ack"),e&&e(t)}),s)},t.prototype.sendRequest2=function(t,i,n,e,s){var r=this,o=1===t.format?Pt(JSON.stringify(t.body)):t.body,u={ack:t.ack,body:o,id_name:t.idName,method:t.method,interface_id:t.interfaceID,token:t.token,reduce_resp_header:t.reduceRspHeaders?1:0};t.headers&&(u.headers=t.headers),t.resID&&(u.res_id=t.resID),t.urlParams&&(u.params=t.urlParams),t.mode&&(u.mode=t.mode),this.netHttpStream.sendMessage(h.MSG_TYPE_HTTP_REQUEST2,u,(function(e,s){var o=(null==e?void 0:e.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)}));if(200===e.status_code){if("gzip"===(null==o?void 0:o.val))r.vt.info(Ot+" gzip");else if(e.body&&1===t.format)try{h=Mt(e.body),e.body=h}catch(t){r.vt.info(Ot+" decode "+JSON.stringify(t))}var u=Qt(Qt({},e),{body:void 0});r.vt.info(Ot+" suc "+JSON.stringify(u)),i&&i(e,s)}else{try{var h=Mt(e.body);e.body=h}catch(t){r.vt.info(Ot+" status "+e.status_code+" "+JSON.stringify(t))}n&&n(e)}}),(function(t,i,e){r.vt.error(Ot+" fail"),n&&n(e||t)}),(function(t){r.vt.error(Ot+" ack"),e&&e(t)}),s)},t}(),ii=function(){function t(t,i,n){this.type=t,this.sn=i,this.rn=n,this.isFree=!1,this.isFirst=!0,this.timestamp=0}return Object.defineProperty(t.prototype,"StreamID",{get:function(){return this.sn},enumerable:!1,configurable:!0}),t.prototype.cn=function(){this.timestamp=Date.now()},t.prototype.refresh=function(t){this.sn=t,this.isFirst=!0,this.cn()},t.prototype.sendMessage=function(t,i,n,e,s,r){var o=this;void 0===n&&(n=null),void 0===e&&(e=null),void 0===s&&(s=null),void 0===r&&(r={timeout:5e3,isInSendMap:!0}),this.isFree=!1,this.cn(),this.rn.sendMessage(t,this.sn,i,this.isFirst,(function(t,i,e){o.type!==d.PC&&(o.isFree=!0,o.cn()),o.isFirst=!1,n&&n(t,e)}),(function(t,i,n){o.type!==d.PC&&(o.isFree=!0,o.cn()),1100002===(null==n?void 0:n.code)?o.destroyed():o.isFirst=!1,e&&e(t,i,n)}),s,r,this.type)},t.prototype.onPushEvent=function(t,i,n){},t.prototype.closeStream=function(t,i){this.rn.sendMessage(h.MSG_TYPE_STREAM_CLOSED,this.sn,{code:t,msg:i},void 0,void 0,void 0,void 0,{isInSendMap:!1},this.type)},t.prototype.destroyed=function(){var t,i;(null===(i=null===(t=this.rn)||void 0===t?void 0:t.socketService)||void 0===i?void 0:i.type)===s.WebTransport&&this.rn.socketService.closeStream(this.sn),this.onDestroyed()},t.prototype.isConnect=function(){return this.rn.isConnect()},t.prototype.onDestroyed=function(){},t}(),ni=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},ei=function(){function t(t){this.rn=t,this.streamID=1,this.pcStreams=[],this.streams=[]}return t.prototype.destroy=function(){this.clearStreams()},t.prototype.createStream=function(t){var i=this,n=this.getNextStreamID(),e=new ii(t,n,this.rn);return t===d.PC?this.pcStreams.push(e):this.streams.push(e),e.onDestroyed=function(){t===d.PC?i.pcStreams=i.pcStreams.filter((function(t){return t.StreamID!==n})):i.streams=i.streams.filter((function(t){return t.StreamID!==n}))},e},t.prototype.getHbStream=function(){var t=this;if(this.hbStream)return this.hbStream;var i=new ii(d.OTHER,this.getNextStreamID(),this.rn);return i.onDestroyed=function(){t.hbStream=void 0},this.hbStream=i,i},t.prototype.getFreeStream=function(t){if(t!==d.PC){var i=this.streams.find((function(t){return t.isFree&&t.type!==d.PC}));if(i)return i.isFree=!1,i}return this.createStream(t)},t.prototype.onPushEvent=function(t,i,n,e){var s=this.pcStreams.find((function(i){return i.StreamID===t}));s&&s.onPushEvent(i,n,e)},t.prototype.getNextStreamID=function(){return this.streamID=this.streamID+2,this.streamID},t.prototype.refreshAllStream=function(){var t=this;ni(ni(ni([],this.streams,!0),this.pcStreams,!0),[this.hbStream],!1).forEach((function(i){return null==i?void 0:i.refresh(t.getNextStreamID())}))},t.prototype.clearStreams=function(){this.streams=[],this.pcStreams=[],this.hbStream=void 0},t}(),si=function(){return si=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},si.apply(this,arguments)},ri=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))};function oi(t,i){return void 0===i&&(i="setAppInfo"),Error("Failed to execute ".concat(t," before ").concat(i,"."))}var ui=function(){function t(t){var i=this;this.proxyCtrl=t,this.un=null,this.connectServers=[],this.http3Servers=[],this.specifiedServers=[],this.getAppConfigFailCount=0,this.getAppConfigTime=0,this.linkMsgMaxInterval=90,this.linkMsgCheckInterval=5,this.connectedTime=0,this.connectid="",this.reportSeq=0,this.connectSeq=0,this.defaultConnectServers=[],this.hn=m,this.lastLinkConnectState=m,this.lt=function(t,n){i.Pt(!0),i.an()},this.At=function(t,n){if(i.linkConnectState=g,i.fn(),0===i.appInfo.env){var e=i.reportSeq++;i.eventManager.emit("dispatchEvent",e,"start"),i._n().then((function(t){var n,s=t.servers,r=t.http3Servers,o=t.http3Domains,u=t.domains.map((function(t){return t.host})),h=o.map((function(t){return t.host}));i.http3Servers&&i.http3Servers.length||(i.http3Servers=r,null===(n=i.zegoLink)||void 0===n||n.setHttp3Servers(r)),i.eventManager.emit("dispatchEvent",e,"end",{servers:s,domains:u,http3Servers:r,http3Domains:h}),s.length>0&&i.eventManager.emit("dispatchResultUpdate",{servers:s,http3Servers:r,domains:u,http3Domains:h})})).catch((function(t){})),i.ln().then((function(t){i.eventManager.emit("svrAddrResultUpdate",{accesshub_domain:t.accesshub_domain,logreport_domain:t.logreport_domain,detaillog_domain:t.detaillog_domain,geofencing_id:t.geofencing_id})})).catch((function(t){}))}i.eventManager.emit("connected"),i.dn(t,n)},this.It=function(){i.logger.info(st+" call"),i.linkConnectState=p},this.Pt=function(t,n,e){i.logger.info("zn.zca.ode"+" ".concat(t));var s=i.linkConnectState;i.linkConnectState=m,t?(i.En(),i.netAgentPCRequestMgr.updateConnectState(v.BROKEN,y.TEMP)):(s===p&&n&&e&&i.dn(n,e),s!==m&&(i.eventManager.emit("disconnected"),i.netAgentPCRequestMgr.updateConnectState(v.DISCONNECT,y.CLOSE),i.vn())),i.streamManager.refreshAllStream()},this.Nt=function(t,n,e,s){switch(n){case h.MSG_TYPE_REDIRECT:case h.MSG_TYPE_REDIRECT2:i.pn(e);break;case h.MSG_TYPE_CLOSE_CONNECTION:i.Sn(e);break;case h.MSG_TYPE_PC_BROKEN:case h.MSG_TYPE_PC_ESTABLISHED:case h.MSG_TYPE_PC_DOWNWARD_MESSAGE:case h.MSG_TYPE_PUSH_EXCEPTION:i.streamManager.onPushEvent(t,n,e,s);break;case h.MSG_TYPE_PUSH_APPCONFIG:i.businessRequestMgr.decodeConfigMessage(e.data)}},this.logger=new Kt,this.stateCenter=new Zt,this.protobuf=new j(this.stateCenter),this.eventManager=new Jt,this.zegoLink=new $t(this.protobuf,this.logger,this.stateCenter,this.proxyCtrl),this.streamManager=new ei(this.zegoLink),this.businessRequestMgr=new Bt(this.streamManager,this.protobuf,this.logger,this.stateCenter),this.zegoLink.HBHandler=this.netHeartBeatHandler=new Vt(this.streamManager,this.logger,this.stateCenter),this.netAgentPCRequestMgr=new Wt(this.streamManager,this.logger),this.zegoLink.initEvent(this.At,this.Pt,this.It,this.Nt,this.lt),this.gn(),this.Tn()}return Object.defineProperty(t.prototype,"isDestroy",{get:function(){return this.stateCenter.isDestroyed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cn",{get:function(){return this.stateCenter.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clientIP",{get:function(){return this.stateCenter.clientIP},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"timeOffset",{get:function(){return this.stateCenter.timeOffset},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"linkConnectState",{get:function(){return this.hn},set:function(t){this.lastLinkConnectState=this.hn,this.hn=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appInfo",{get:function(){return this.stateCenter.appInfo},enumerable:!1,configurable:!0}),t.prototype.init=function(){if(this.isDestroy)throw Error("instance have destroyed, invalid call")},t.prototype.unInit=function(){this.zegoLink.release()},t.prototype.setAppInfo=function(t){if(this.logger.info(at+" "+JSON.stringify(t)),this.stateCenter.appID>0)this.logger.warn(at+" appInfo has exist, appID: ".concat(this.stateCenter.appID));else{if(t.appID<=0)throw Error("setAppInfo, invalid appID: ".concat(t.appID));this.stateCenter.appInfo=si(si({},this.stateCenter.appInfo),t),console.log("appInfo :"+JSON.stringify(this.stateCenter.appInfo)),navigator&&(this.stateCenter.networkState=navigator.onLine?o.online:o.offline),this.zegoLink.initSocketService(),0===t.env?this.bn():1===t.env&&this.mn()}},t.prototype.checkAndConnect=function(t){if(!this.stateCenter.appID)throw oi(t,"setAppInfo");if(this.connectServers.length<=0)throw oi(t,"setNetAgentDefaultServers or setDispatchConnectServers");if(this.isDestroy)throw Error("instance have destroyed, invalid call");this.retryLinkHandler||this.an()},t.prototype.setUserInfo=function(t){this.stateCenter.userId=t},t.prototype.setSettingConfig=function(t){if(void 0!==t.enableHttp3){this.stateCenter.customConfig.enableHttp3=t.enableHttp3;var i=Z.isSupport();this.logger.info("zn.zca.ssc.h3"+" http3:".concat(t.enableHttp3," support:").concat(i))}},t.prototype.setNetAgentDefaultServers=function(t){0===this.connectServers.length&&(this.connectServers=ri([],t,!0))},t.prototype.setNetAgentSpecifiedServers=function(t){throw Error("not support")},t.prototype.setBackupDomains=function(t){throw Error("not support")},t.prototype.setDispatchConnectServers=function(t,i){void 0===i&&(i=[]),t.length>0&&(this.connectServers=ri([],t,!0)),i.length>0&&(this.http3Servers=ri([],i,!0)),this.stateCenter.appID>0&&this.an()},t.prototype.startHttpRequest=function(t,i,n,e,s){var r=this;if(this.checkAndConnect("startHttpRequest"),s&&"number"==typeof(null==s?void 0:s.timeout)&&((null==s?void 0:s.timeout)<1e3||(null==s?void 0:s.timeout)>1e4))throw Error("timeout must between 1 and 10 second");var o=this.reportSeq++;this.eventManager.emit("requestEvent",o,"start"),this.isConnect()||(this.logger.info(ct+" link is not connect"),this.innerReconnect()),new ti(this.logger,this.streamManager,t.service).sendRequest(t,(function(n){r.eventManager.emit("requestEvent",o,"end",{na_req_location:t.location,status_code:n.status_code,err_code:0}),i&&i(n)}),(function(i){r.eventManager.emit("requestEvent",o,"end",{na_req_location:t.location,err_code:i.code||0}),n&&n(i)}),e,s)},t.prototype.startHttpRequest2=function(t,i,n,e,s){var r=this;this.checkAndConnect("startHttpRequest2");var o=this.reportSeq++;this.eventManager.emit("requestEvent",o,"start"),this.isConnect()||(this.logger.info(ct+" link is not connect"),this.innerReconnect()),new ti(this.logger,this.streamManager).sendRequest2(t,(function(n,e){r.eventManager.emit("requestEvent",o,"end",{na_req_interface:t.interfaceID,status_code:n.status_code,err_code:0}),i&&i(n,e)}),(function(i){r.eventManager.emit("requestEvent",o,"end",{na_req_interface:t.interfaceID,err_code:i.code||0}),n&&n(i)}),e,s)},t.prototype.getAppConfigByAgent=function(t,i,n,e,s){if(this.checkAndConnect("getAppConfigByAgent"),!this.stateCenter.userId)throw oi("getAppConfigByAgent","setUserInfo");return this.isConnect()||(this.logger.info("zn.gab.0 link is not connect"),this.innerReconnect()),this.Rn(t,this.stateCenter.userId,i,n,e,s)},t.prototype.getPCRequest=function(t,i){var n=this;if(!this.stateCenter.appInfo)throw oi("getPCRequest");var e=this.netAgentPCRequestMgr.getRequest(t,i);return e.on("disconnected",(function(i){n.logger.warn("zn.zca.gpr "+t+" disconnect "+i),i===y.TEMP&&(n.En(),n.On())})),e.on("connectStart",(function(){n.innerReconnect()})),e},t.prototype.connectUa=function(){this.checkAndConnect("connectUa"),this.logger.info("zn.zca.cua call"),this.retryLinkHandler&&(this.retryLinkHandler.init(),this.On(!1,!0))},t.prototype.destroyConnect=function(t){this.logger.info("zn.zca.dc.0 call"),this.An(t)},t.prototype.destroy=function(){this.logger.info("zn.zca.dy.0 call"),this.destroyConnect(this.linkConnectState===p?nt:void 0),this.un&&clearTimeout(this.un),this.retryLinkHandler&&this.retryLinkHandler.invalid(),this.retryLinkHandler&&this.retryLinkHandler.stopMaxTime(),this.stateCenter.isDestroyed=!0,this.streamManager.destroy(),this.zegoLink.release()},t.prototype.isConnect=function(){return this.zegoLink.isConnect()},t.prototype.isDisConnect=function(){return this.zegoLink.isDisConnect()},t.prototype.on=function(t,i){return this.logger.info("zn.zca.o.0 "+t),!!this.eventManager.addEventHandler(t,i)},t.prototype.off=function(t,i){this.logger.info("zn.zca.o.1 "+t),this.eventManager.removeEventHandler(t,i)},t.prototype.setLogger=function(t){this.logger=t,this.zegoLink.setLogger(t),this.netHeartBeatHandler.setLogger(t),this.businessRequestMgr.setLogger(t),this.netAgentPCRequestMgr.setLogger(t)},t.prototype.setAccess=function(t){this.stateCenter.useNetAgent=t},t.prototype.getVersion=function(){return"1.2.1"},t.prototype.reconnectUA=function(){this.retryLinkHandler&&(this.retryLinkHandler.startMaxTime(),this.En(),this.On())},t.prototype.Tn=function(){var t=this;this.netHeartBeatHandler.onHBTimeout=function(){t.eventManager.emit("heartBeatTimeout")}},t.prototype.bn=function(){var t=this;window.addEventListener("offline",(function(){t.Pn()})),window.addEventListener("online",(function(){t.In()}))},t.prototype.mn=function(){var t=this;wx.onNetworkStatusChange((function(i){i.isConnected?t.In():t.Pn()}))},t.prototype.In=function(){this.logger.info("zn.zca.noh.0 network is online"),this.stateCenter.networkState=o.online,this.Cn&&this.Nn()},t.prototype.Pn=function(){this.logger.info("zn.zca.noh.1 network is broken"),this.stateCenter.networkState=o.offline,this.Cn&&this.Dn()},t.prototype.gn=function(){var t=this;if(this.stateCenter.useNetAgent){if(this.isConnect()){var i=Date.now()-this.zegoLink.updatedMsgTime;if(i>1e3*this.linkMsgMaxInterval)return this.logger.info("zn.zca.clm interval: "+i),void this.An()}this.un&&clearTimeout(this.un),this.un=setTimeout((function(){t.gn()}),1e3*this.linkMsgCheckInterval)}},t.prototype.an=function(){var t=this;this.connectServers.length<=0?this.logger.error(st+" #### not server url"):(this.zegoLink.setServers(this.connectServers,this.http3Servers),this.retryLinkHandler||(this.retryLinkHandler=new Xt(this.logger,this.stateCenter)),this.retryLinkHandler.init(),this.retryLinkHandler.initLink(this.zegoLink),this.retryLinkHandler.onactive=function(i,n){n===tt&&(t.eventManager.emit("disconnected",n),t.vn(),t.netAgentPCRequestMgr.updateConnectState(v.DISCONNECT,y.TIMEOUT,n))},this.On(!1,!0))},t.prototype.An=function(t){var i;this.netHeartBeatHandler&&this.netHeartBeatHandler.stop(),null===(i=this.retryLinkHandler)||void 0===i||i.invalid(),this.zegoLink&&this.zegoLink.destroySocket(_.DISCONNECT,t)},t.prototype.fn=function(){var t=this,i=(new Date).getTime(),n=function(n,e,r){var u;if(r)return t.logger.info(et+" fail "+JSON.stringify(r)),void(t.zegoLink.socketService.type===s.WebTransport&&t.stateCenter.networkState===o.online&&(t.logger.info(yt+" reason:"+J.GetConfigFailed+" error: get config error "),t.stateCenter.enableHttp3=!1,Ut(t.stateCenter.env,t.stateCenter.appID,((u={})[t.zegoLink.connectServer]={status:!1,time:Date.now()},u),!0),t.lt(J.GetConfigFailed,"get config error")));0===n.code?(t.logger.info(et+" suc "+JSON.stringify(n)),t.yn(n,i)):t.logger.info(et+" fail "+JSON.stringify(n))};this.businessRequestMgr.getConfig(n,n)},t.prototype.yn=function(t,i){var n,e;if(this.netHeartBeatHandler.init(t),this.netAgentPCRequestMgr.setEstablishTimeout(t.data.pc_establish_timeout),(null===(n=null==t?void 0:t.data)||void 0===n?void 0:n.client_outer_ip)&&(this.stateCenter.clientIP=t.data.client_outer_ip),null===(e=null==t?void 0:t.data)||void 0===e?void 0:e.ntp_time){var s=t.data.ntp_time,r="number"==typeof s?s:s.toNumber(),o=(new Date).getTime();0===this.stateCenter.appInfo.env&&this.stateCenter.updateNTP(i,r,o)}this.eventManager.emit("clientInfo",{clientIP:this.clientIP,timeOffset:this.timeOffset,geofencingID:t.data.geofencing_id})},t.prototype._n=function(){var t=this;return new Promise((function(i,n){t.businessRequestMgr.dispatchURL((function(n){var e,s=n.data,r=s.wss_groups,o=s.http3_groups;t.logger.info("".concat(ft," wss_groups: ").concat(JSON.stringify(r)," http3_groups:").concat(JSON.stringify(o)));var u=r.some((function(t){return t.host.includes("geo")})),h=o.some((function(t){return t.host.includes("geo")})),a=null===(e=t.appInfo)||void 0===e?void 0:e.geoFencing,c=a||u?r:t.wn(r),l=a||h?o:t.wn(o),f=t.Mn(c),d=t.Mn(l,"https");i({servers:f,http3Servers:d,domains:c,http3Domains:l})}),(function(t){n(t)}))}))},t.prototype.ln=function(){var t=this;return new Promise((function(i,n){t.businessRequestMgr.getSvrAddr().then((function(e){var s=e.code,r=e.msg,o=e.data;if(0===s){var u=o.accesshub_domain,h=o.logreport_domain,a=o.detaillog_domain,c=o.geofencing_id;t.logger.info("".concat(lt," domains: ").concat(u," ").concat(h," ").concat(a)),i({accesshub_domain:u,logreport_domain:h,detaillog_domain:a,geofencing_id:c})}else n({code:s,msg:r})})).catch((function(t){n(t)}))}))},t.prototype.Mn=function(t,i){return void 0===i&&(i=It.scheme),Array.isArray(t)&&t.length>0?t.map((function(t){return i+"://"+t.host+"/"+It.location})):[]},t.prototype.wn=function(t){var i=ri([],t,!0);return i.filter((function(t){return!!t.host}))},t.prototype.Rn=function(t,i,n,e,s,r){var o=this;return new Promise((function(u,h){"string"==typeof i&&"string"==typeof n?o.businessRequestMgr.getAppConfig(t,i,n,e,s,r).then((function(t){u(si(si({},t),{retryCount:o.getAppConfigFailCount}))})).catch((function(e){if(o.logger.error(rt+" "+JSON.stringify(e)),w.indexOf(e.code)>-1){var r=o.getAppConfigFailCount;return o.getAppConfigFailCount=0,void h(si(si({},e),{retryCount:r}))}o.getAppConfigFailCount++,(20008===e.code||1100002===e.code)&&o.getAppConfigFailCount<3?o.Rn(t,i,n,s).then((function(t){return u(t)})).catch((function(t){return h(t)})):(r=o.getAppConfigFailCount,o.getAppConfigFailCount=0,h(si(si({},e),{retryCount:r})))})):o.logger.error(rt+" userID or token must be string")}))},t.prototype.vn=function(){var t=(new Date).getTime()-this.connectedTime;this.connectid&&this.eventManager.emit("disConnectedEvent",{duration:t,server:this.zegoLink.connectServer,connectid:this.connectid})},t.prototype.pn=function(t){var i=t.wss_groups,n=t.http3_groups;this.logger.info("".concat(ot," wss_groups: ").concat(JSON.stringify(i)," http3_groups:").concat(JSON.stringify(n)));var e=this.Mn(i),s=this.Mn(n,"https");e&&Array.isArray(e)&&e.length>0?(this.En(),this.stateCenter.specified&&(this.logger.info(ot+" specified"),e=this.specifiedServers),this.zegoLink.setServers(e,s),this.On(!1,!0)):this.logger.warn(ot+" wss_groups null")},t.prototype.Sn=function(t){var i=this;switch(this.logger.info(ut+" ".concat(t.reason," ").concat(t.msg," ").concat(t.action)),t.action){case E.ACTION_DISPATCH:var n=this.reportSeq++;this.eventManager.emit("dispatchEvent",n,"start"),this._n().then((function(t){var e=t.servers,s=t.http3Servers,r=t.domains,o=t.http3Domains;if(i.eventManager.emit("dispatchEvent",n,"end",{domains:r,http3Domains:o,reason:"ConnectClosed"}),Array.isArray(e)&&e.length>0){i.eventManager.emit("dispatchResultUpdate",{servers:e,http3Servers:s,domains:r,http3Domains:o});var u=i.stateCenter.specified?i.specifiedServers:e;i.En(),i.zegoLink.setServers(u,s),i.On(!1,!0)}})).catch((function(t){i.logger.info(ut+" dispatch fail")}));break;case E.ACTION_IDLE:case E.ACTION_RETRY:this.En(),this.On(!1);break;case E.ACTION_NEXT_GROUP:this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken",R.CLOSE),this.On()}},t.prototype.Nn=function(){this.retryLinkHandler&&(this.zegoLink.isConnect()?this.retryLinkHandler.stopMaxTime():this.On())},t.prototype.Dn=function(){this.En(),this.retryLinkHandler&&(this.retryLinkHandler.invalid(),this.retryLinkHandler.startMaxTime(),this.zegoLink.setState(m))},t.prototype.innerReconnect=function(){this.logger.info(ht+" call ".concat(!!this.retryLinkHandler)),this.isDestroy?this.logger.info(ht+" destroy"):this.retryLinkHandler&&(this.retryLinkHandler.startMaxTime(),this.On())},t.prototype.On=function(t,i){var n;(null===(n=this.retryLinkHandler)||void 0===n?void 0:n.active(t,i))&&this.zn()},t.prototype.zn=function(){var t=this.reportSeq++;this.connectSeq=t,this.eventManager.emit("connectedEvent",t,"start")},t.prototype.dn=function(t,i){this.connectedTime=(new Date).getTime(),this.connectid=function(t,i){var n,e="0123456789".split(""),s=[];if(i=e.length,t)for(n=0;n<t;n++)s[n]=e[0|Math.random()*i];else{var r=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",n=0;n<36;n++)s[n]||(r=0|16*Math.random(),s[n]=e[19==n?3&r|8:r])}return s.join("")}(16),this.eventManager.emit("connectedEvent",this.connectSeq,"end",{servers:t,count:t.length,connectid:this.connectid,connectEvents:i})},t.prototype.En=function(){this.logger.info("zn.zca.dc.1 call"),this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken"),this.lastLinkConnectState===g&&this.linkConnectState===m&&this.vn()},t.prototype.getNetworkTimeInfo=function(){var t=Date.now()+this.stateCenter.timeOffset,i=Math.round(this.stateCenter.networkRTT/2),n=this.stateCenter.ntpTimeInfo;if(n){var e=performance.now()-n.performanceTime;t=Math.round(n.ntp+e)}return{timestamp:t,maxDeviation:i}},t.prototype.setHeartBeatMode=function(t){var i=this.netHeartBeatHandler.mode;i!==t&&(this.logger.info("zn.shbm"+" change mode from ".concat(i," to ").concat(t)),this.netHeartBeatHandler.mode=t)},t}()}]))},477:()=>{}},__webpack_module_cache__={};function __webpack_require__(t){var i=__webpack_module_cache__[t];if(void 0!==i)return i.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(i,{a:i}),i},__webpack_require__.d=(t,i)=>{for(var n in i)__webpack_require__.o(i,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ZegoExpressEngine:()=>ka});var t,i,n="zw.w.opsuh",e="zw.w.sppst.1",s="zw.w.bl",r="zw.w.dl",o="zw.w.scsu",u="zw.pu.sppst.0",h="zw.pu.sps.0",a="zw.pu.sps.0.0",c="zw.pu.fpsu.0",l="zw.pu.hfspur.0",f="zw.pu.dps.0",d="zw.pl.sps.1",_="zw.pl.sps.1.0",v="zw.pl.spsfc",m="zw.pl.fpsu",p="zw.pl.hfsur",g="zw.scw.r.0",b="zw.scw.sps.0",E="zw.scw.sps.1",S="zw.scw.sp.0",y="zw.scw.ups.0",T="zw.scw.upns",R="zw.scw.ups.0.0",w="zw.scw.ups.1.0",O="zw.scw.gnu",I="zw.scw.sp.1",N="zw.scw.ops.1",C="zw.pw.tsp.0",k="zw.pw.ue",D="zw.pw.gpu",z="zw.drh.a.0";!function(t){t[t.SWITCH_ONE=1]="SWITCH_ONE",t[t.SWITCH_TWO=2]="SWITCH_TWO"}(t||(t={})),function(t){t[t.ZegoGeoFenceTypeNone=0]="ZegoGeoFenceTypeNone",t[t.ZegoGeoFenceTypeInclude=1]="ZegoGeoFenceTypeInclude",t[t.ZegoGeoFenceTypeExclude=2]="ZegoGeoFenceTypeExclude"}(i||(i={}));var A,P,M=1000000152;!function(t){t[t.TT_NONE=0]="TT_NONE",t[t.TT_PC=1]="TT_PC",t[t.TT_IOS=2]="TT_IOS",t[t.TT_ANDROID=3]="TT_ANDROID",t[t.TT_MAC=4]="TT_MAC",t[t.TT_LINUX=5]="TT_LINUX",t[t.TT_WEB=6]="TT_WEB",t[t.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",t[t.TT_UNKNOWN=32]="TT_UNKNOWN"}(A||(A={})),function(t){t[t.disconnected=0]="disconnected",t[t.connecting=1]="connecting",t[t.connected=2]="connected"}(P||(P={}));var x,U,q,L;!function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login"}(x||(x={})),function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(U||(U={})),function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(q||(q={})),function(t){t[t.NT_NONE=0]="NT_NONE",t[t.NT_LINE=1]="NT_LINE",t[t.NT_WIFI=2]="NT_WIFI",t[t.NT_2G=3]="NT_2G",t[t.NT_3G=4]="NT_3G",t[t.NT_4G=5]="NT_4G",t[t.NT_UNKNOWN=32]="NT_UNKNOWN"}(L||(L={}));var G,H=3e3;!function(t){t[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallProgram=2]="ClientType_SmallProgram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc"}(G||(G={}));var j,$,B="",V=__webpack_require__(799),J={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},SDK_NOT_SPECIAL:{code:1001005,msg:"sdk require special"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},GEO_SET_ERROR:{code:1000018,msg:"geo set error"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_EXTRA_INFO_KEY_LIMIT:{code:1002017,msg:"room extra info key exceed the limit"},DIFFERENT_USER_ID:{code:1002018,msg:"In multi-room mode, only the same user id can be used."},NO_PUBLISH_AUTH:{code:1002082,msg:"Token does not have the permission to publish current stream."},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},FORBID_BLACK_USER:{code:1002066,msg:"forbid black user"},WHITE_BOARD_VERSION_ERROR:{code:1002098,msg:"Mismatch with RTC SDK version, please upgrade ZegoSuperBoard or ZegoWhiteboardView SDK to the latest version"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},UPLOAD_LOG_ERROR:{code:1102025,msg:"upload zip logs failed"}},F=function(t){return t},Y=function(t){return t},W=function(t){return t},X=function(t){return t},Z={event:"/sdk/init",error:{kInvalidParamError:J.INPUT_PARAM},system_info:Y,servers:function(t){return t},is_from_cache:X,project:Y,liveroom_version:Y,biz_type:W,lua_md5:Y,sev_env:Y,use_na:W},K="listener",Q="/sdk/set_debug",tt=Y,it={event:"/sdk/set_log_config",error:{kInvalidParamError:J.INPUT_PARAM},log_level:function(t){return t},remote_log_level:Y,log_url:Y},nt={event:"/sdk/on_listener",listener:Y,error:{INPUT_PARAM:J.INPUT_PARAM}},et="/sdk/off_listener",st=Y,rt={event:"/sdk/login",room_id:Y,room_sid_string:Y,user_state_update:W,max_member_cnt:W,message:Y,token:Y,svr_env:Y,server:Y,try_cnt:W,room_mode:W,role:W,audience_create_room:W,liveroom_sid_string:Y,error:{ROOM_ID_NULL:J.ROOM_ID_NULL,INPUT_PARAM:J.INPUT_PARAM,ROOM_ID_TOO_LONG:J.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:J.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:J.USER_ID_NULL,USER_ID_TOO_LONG:J.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:J.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:J.USER_NAME_NULL,USER_NAME_TOO_LONG:J.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:J.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:J.LOGIN_TIMEOUT,INNER_ERROR:J.ROOM_INNER_ERROR,NETWORK_BROKEN:J.NETWORK_BROKEN,ROOM_COUNT_EXCEED:J.ROOM_COUNT_EXCEED,DIFFERENT_USER_ID:J.DIFFERENT_USER_ID}},ot="/sdk/sublogin",ut={event:"/zpush/login",sdk_zpush_sessionid_string:Y},ht={event:"/liveroom/enter"},at={event:"/sdk/renew_token",error:{INPUT_PARAM:J.INPUT_PARAM,NOT_LOGIN:J.NOT_LOGIN},token:Y},ct="/zpush/hb_timeout",lt={event:"/sdk/logout",error:{INPUT_PARAM:J.INPUT_PARAM,ROOM_NOT_EXIST:J.ROOM_NOT_EXIST},room_id:Y,room_sid_string:Y,is_multi:X,is_send_cmd_net:X,liveroom_sid_string:Y},ft="/switch/logout_user",dt="/liveroom/quit",_t=Y,vt=Y,mt="/zpush/multi_logout_user",pt="/sdk/relogin",gt={event:"/liveroom/tempbroken"},bt={event:"/sdk/reconnect",room_broken_time:W},Et={event:"/sdk/disconnect",valid_d:W,total_d:W,tempbroken_cnt:W},St="/sdk/kickout",yt=W,Tt=W,Rt={event:"/liveroom/hb",room_id:Y,room_sid_string:Y,interval:W,stream_seq:W,server_user_seq:W,error:{NOT_LOGIN:J.NOT_LOGIN,HB_TIMEOUT:J.TIMEOUT}},wt="/liveroom/recv_user_update_info",Ot="/sdk/listener",It={event:"/sdk/enable_multi_room",is_multi:X,error:{kInvalidParamError:J.INPUT_PARAM,kAlreadyLoginError:J.ALREADY_LOGIN}},Nt={event:"/liveroom/get_current_user_list",user_index:W,is_time_ascend:X,use_na:W},Ct="/zegoconn/connect",kt=Y,Dt=W,zt=F,At="/zegoconn/disconnect",Pt=Y,Mt=Y,xt=W,Ut="/zegoconn/auto_dispatch",qt=function(t){return t},Lt="/zegoconn/request",Gt=F,Ht="/sdk_config/init",jt=F,$t=W,Bt={event:"/zegoconn/proxy_connect",service_no:W,proxy_link_sources:W,recv_time:W,connect_stream:W},Vt={event:"/zegoconn/proxy_broken",service_no:W},Jt={event:"/zegoconn/proxy_disconnect",service_no:W},Ft=function(){function t(t){this.ti=-1,this.ii=3e4,this.ni=0,this.ii=t}return t.prototype.trigger=function(){var t,i=performance.now();(this.ni++,-1===this.ti)?(t={toReport:!0,failCount:this.ni},this.ti=i,this.ni=0):i-this.ti>this.ii?(t={toReport:!0,failCount:this.ni},this.ti=i,this.ni=0):t={toReport:!1};return t},t}(),Yt=function(){return Yt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},Yt.apply(this,arguments)},Wt=function(){function t(t,i){this._dataReport=t,this._seq=i}return t.prototype.setAttributes=function(t){this._dataReport.addMsgInfo(this._seq,t)},t.prototype.setAttribute=function(t,i){this._dataReport.addMsgInfo(this._seq,{key:i})},t.prototype.end=function(t){this._dataReport.uploadReport(this._seq)},t}(),Xt=function(){function t(t){this.ei=t,this.si={},this.ri={},this.oi={},this.ui=new Map,this.dataReport=new Zt.ZegoDataReport(t)}return t.setReportCustomerContext=function(t){},t.prototype.init=function(t,i,n){},t.prototype.setConfig=function(t){},t.prototype.loadScript=function(t,i,n,e){return Promise.resolve()},t.prototype.setReporterInfo=function(t,i){},t.prototype.flush=function(t){},t.prototype.destroy=function(){},t.prototype.setCommonStates=function(t){},t.prototype.setResource=function(t){},t.prototype.setCommonAttributes=function(t){},t.prototype.deleteCommonAttributes=function(t){},t.prototype.clearRoomSpans=function(t){},t.prototype.setPublicPros=function(t){},t.prototype.createSpan=function(t,i,n,e,s){var r,o,u,h;if(i&&i.key&&i.par){var a=i.par1?"_"+i.par1:"";!(u=null===(r=this.si[i.key])||void 0===r?void 0:r[i.par+a])&&i.bak_key&&(u=null===(o=this.si[i.bak_key])||void 0===o?void 0:o[i.par+a])}else i&&!(u=this.si[i.key])&&i.bak_key&&(u=this.si[i.bak_key]);u||(u=this.si[Z.event]);var c=fn();(this.dataReport.newReport(c,e),h=new Wt(this.dataReport,c),s)&&(n.par?(!this.si[n.key]&&(this.si[n.key]={}),this.si[n.key][n.par+(a=n.par1?"_"+n.par1:"")]=h):this.si[n.key]=h);return h},t.prototype.setSpanInMap=function(t,i){i.par?(!this.si[i.key]&&(this.si[i.key]={}),this.si[i.key][i.par+(i.par2?"_"+i.par2:"")]=t):this.si[i.key]=t},t.prototype.spanEnd=function(t,i,n){var e;t.par?(e=this.si[t.key]&&this.si[t.key][t.par+(t.par1?"_"+t.par1:"")],this.si[t.key]&&!n&&delete this.si[t.key][t.par]):(e=this.si[t.key],!n&&delete this.si[t.key]);e&&(this.dataReport.addMsgInfo(e.seq,i),this.dataReport.uploadReport(e.seq))},t.prototype.spanSetAttributes=function(t,i){var n;if(t.par){var e=t.par1?"_"+t.par1:"";!(n=this.si[t.key]&&this.si[t.key][t.par+e])&&t.bak_key&&(n=this.si[t.bak_key]&&this.si[t.bak_key][t.par+e])}else!(n=this.si[t.key])&&t.bak_key&&(n=this.si[t.key]);n&&(this.dataReport.addMsgInfo(n.seq,i),this.dataReport.uploadReport(n.seq))},t.prototype.spanAppendAttribute=function(t,i,n){if(t.par){var e=t.par1?"_"+t.par1:"";!(this.si[t.key]&&this.si[t.key][t.par+e])&&t.bak_key&&(this.si[t.bak_key]&&this.si[t.bak_key][t.par+e])}else!this.si[t.key]&&t.bak_key&&this.si[t.key];this.ei.warn("zm.zr.saa not support this func "+(null==t?void 0:t.key))},t.prototype.setError=function(t,i,n){this.dataReport.uploadReport(t.seq,void 0,i,n)},t.prototype.setLogger=function(t){},t.prototype.setTimeOffset=function(t){},t.prototype.setUnloadState=function(t){},t.prototype.setNetStateCheck=function(){},t.prototype.setAPIErrorReport=function(t,i){this.oi[t]=i},t.prototype.getAPIErrorReport=function(t){return this.oi[t]},t.prototype.takeAPIErrorReport=function(t,i,n,e){if(n){var s=this.ui.get(t);s||(s=new Ft(n),this.ui.set(t,s));var r=s.trigger(),o=r.failCount;if(r.toReport){var u=this.createSpan(U.I,{key:Z.event},{key:""},t);u.setAttributes(Yt({api_fail_count:o},e)),this.setError(u,i)}}},t}(),Zt=__webpack_require__(783),Kt="3.6.0";!function(t){t[t.debug=0]="debug",t[t.info=1]="info",t[t.warn=2]="warn",t[t.error=3]="error",t[t.report=99]="report",t[t.disable=100]="disable"}(j||(j={})),function(t){t[t.CN=2]="CN",t[t.NA=3]="NA",t[t.EU=4]="EU",t[t.AS=5]="AS",t[t.IN=6]="IN",t[t.NCN=7]="NCN"}($||($={}));var Qt,ti;!function(t){t[t.disable=0]="disable",t[t.websocket=1]="websocket",t[t.https=2]="https"}(Qt||(Qt={})),function(t){t[t.SDKProject_ZegoWebRTC=6]="SDKProject_ZegoWebRTC",t[t.SDKProject_ZegoMiniProgram=7]="SDKProject_ZegoMiniProgram"}(ti||(ti={}));var ii;!function(t){t[t.disconnected=0]="disconnected",t[t.connecting=1]="connecting",t[t.connected=2]="connected"}(ii||(ii={}));var ni,ei,si,ri,oi=6,ui=7,hi=0,ai=1,ci=2;!function(t){t[t.tryProbe=0]="tryProbe",t[t.probed=2]="probed"}(ni||(ni={})),function(t){t[t.CDN=0]="CDN",t[t.RTC=1]="RTC",t[t.L3=2]="L3",t[t.DG=3]="DG"}(ei||(ei={})),function(t){t[t.UDP=0]="UDP",t[t.RTMP=1]="RTMP",t[t.FLV=2]="FLV",t[t.HLS=3]="HLS",t[t.WEBRTC=4]="WEBRTC"}(si||(si={})),function(t){t[t.replaceNew=0]="replaceNew",t[t.changeResolution=1]="changeResolution"}(ri||(ri={}));var li,fi,di,_i=1,vi=2,mi=3,pi=4,gi=2001,bi=2002,Ei=2003,Si=1,yi=0;!function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login"}(li||(li={})),function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login",t[t.reconnect=3]="reconnect"}(fi||(fi={})),function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(di||(di={}));var Ti;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.CDN=1]="CDN",t[t.RTC=2]="RTC",t[t.L3=3]="L3"}(Ti||(Ti={}));var Ri,wi,Oi=12001,Ii=12002,Ni=12003;!function(t){t[t.publish_quality=0]="publish_quality",t[t.play_quality=1]="play_quality",t[t.charge=2]="charge"}(Ri||(Ri={})),function(t){t[t.low=1]="low",t[t.stantard=2]="stantard",t[t.hight=3]="hight",t[t.custome=4]="custome"}(wi||(wi={}));var Ci,ki,Di,zi,Ai,Pi,Mi,xi;!function(t){t[t.enable=0]="enable",t[t.disable=2]="disable"}(Ci||(Ci={})),function(t){t[t.Delete=0]="Delete",t[t.Add=1]="Add"}(ki||(ki={})),function(t){t[t.captureFpsToLow=1001]="captureFpsToLow",t[t.captureVolumeToLow=1002]="captureVolumeToLow",t[t.sendVideoBitrateToLow=1003]="sendVideoBitrateToLow",t[t.sendFpsToLow=1004]="sendFpsToLow",t[t.sendAudioBitrateToLow=1005]="sendAudioBitrateToLow",t[t.receiveVolumeToLow=1006]="receiveVolumeToLow",t[t.receiveAudioDecodedFail=1007]="receiveAudioDecodedFail",t[t.receiveVideoDecodedFail=1008]="receiveVideoDecodedFail",t[t.receiveVideoFpsDecodedToLow=1009]="receiveVideoFpsDecodedToLow",t[t.renderVideoFpsToLow=1010]="renderVideoFpsToLow",t[t.captureFpsNormal=2001]="captureFpsNormal",t[t.captureVolumeNormal=2002]="captureVolumeNormal",t[t.sendVideoBitrateNormal=2003]="sendVideoBitrateNormal",t[t.sendFpsNormal=2004]="sendFpsNormal",t[t.sendAudioBitrateNormal=2005]="sendAudioBitrateNormal",t[t.receiveVolumeNormal=2006]="receiveVolumeNormal",t[t.receiveAudioDecodedNormal=2007]="receiveAudioDecodedNormal",t[t.receiveVideoDecodedNormal=2008]="receiveVideoDecodedNormal",t[t.receiveVideoFpsDecodedNormal=2009]="receiveVideoFpsDecodedNormal",t[t.renderVideoFpsNormal=2010]="renderVideoFpsNormal"}(Di||(Di={})),function(t){t[t.cdn=0]="cdn",t[t.ultra=1]="ultra"}(zi||(zi={})),function(t){t[t.stop=0]="stop",t[t.start=1]="start"}(Ai||(Ai={})),function(t){t[t.cdn=0]="cdn",t[t.ultra=1]="ultra",t[t.customUrl=2]="customUrl"}(Pi||(Pi={})),function(t){t[t.CDN=0]="CDN",t[t.BGP=1]="BGP"}(Mi||(Mi={})),function(t){t[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallPragram=2]="ClientType_SmallPragram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc"}(xi||(xi={}));var Ui,qi,Li,Gi,Hi,ji,$i,Bi,Vi,Ji,Fi,Yi,Wi,Xi,Zi=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this._id=t,this._data=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id?this._id:null},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),t.prototype.hasNext=function(){return this.next&&this.next.id},t.prototype.hasPrev=function(){return this.prev&&this.prev.id},t}(),Ki=function(){function t(){this.start=new Zi,this.end=new Zi,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return t.prototype.insertBefore=function(t,i){var n=new Zi(this._idCounter,i);return n.next=t,n.prev=t.prev,t.prev&&(t.prev.next=n),t.prev=n,++this._idCounter,++this._numNodes,n},t.prototype.addLast=function(t){return this.insertBefore(this.end,t)},t.prototype.add=function(t){return this.addLast(t)},t.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},t.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},t.prototype.size=function(){return this._numNodes},t.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(t>=0)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},t.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},t.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._numNodes,t},t.prototype.removeFirst=function(){var t=null;return this._numNodes>0&&this.start.next&&(t=this.remove(this.start.next)),t},t.prototype.removeLast=function(){var t=null;return this._numNodes>0&&this.end.prev&&(t=this.remove(this.end.prev)),t},t.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},t.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},t.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},t.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},t.prototype.push=function(t){return this.addLast(t)},t.prototype.unshift=function(t){this.insertBefore(this._numNodes>0?this.start.next:this.end,t)},t.prototype.pop=function(){return this.removeLast()},t.prototype.shift=function(){return this.removeFirst()},t}(),Qi=0,tn=1,nn=2,en=1,sn=2,rn="eventStart",on="addEventMsg",un="eventEnd",hn="addMsgInfo";!function(t){t[t.Unknown=-1]="Unknown",t[t.Excellent=0]="Excellent",t[t.Good=1]="Good",t[t.Middle=2]="Middle",t[t.Poor=3]="Poor",t[t.Die=4]="Die"}(Ui||(Ui={})),function(t){t[t.MinQuality=0]="MinQuality",t[t.DieQuality=0]="DieQuality",t[t.PoorMinQuality=1]="PoorMinQuality",t[t.MiddleMinQuality=30]="MiddleMinQuality",t[t.GoodMinQuality=60]="GoodMinQuality",t[t.ExcellentMinQuality=85]="ExcellentMinQuality",t[t.MaxQuality=100]="MaxQuality"}(qi||(qi={})),function(t){t[t.ZegoDefined=0]="ZegoDefined",t[t.UserUnregister=1]="UserUnregister"}(Li||(Li={})),function(t){t[t.CDN=0]="CDN",t[t.L3=1]="L3"}(Gi||(Gi={})),function(t){t[t.RTC=0]="RTC",t[t.CDN=1]="CDN",t[t.L3=2]="L3",t[t.DG=3]="DG"}(Hi||(Hi={})),function(t){t[t.PortraitSegmentation=0]="PortraitSegmentation"}(ji||(ji={})),function(t){t[t.Default=3]="Default",t[t.StandardVideoCall=4]="StandardVideoCall",t[t.HighVideoCall=5]="HighVideoCall",t[t.StandardChatroom=6]="StandardChatroom",t[t.HighQualityChatroom=7]="HighQualityChatroom",t[t.Broadcast=8]="Broadcast",t[t.UNKNOWN=100]="UNKNOWN"}($i||($i={})),function(t){t[t.BASE_LINE=1]="BASE_LINE",t[t.MAIN=2]="MAIN",t[t.HIGH=3]="HIGH"}(Bi||(Bi={})),function(t){t.ONLY_BASELINE="only_baseline",t.HARD_SOFT_ENCODEC_FIRST="hard_or_soft_encodec_first",t.HIGH_PROFILE_FIRST="high_profile_first"}(Vi||(Vi={})),function(t){t[t.useAnalyzer=0]="useAnalyzer",t[t.useWorklet=1]="useWorklet"}(Ji||(Ji={})),function(t){t[t.None=0]="None",t[t.Vocalist=1]="Vocalist",t[t.BackingSinging=2]="BackingSinging"}(Fi||(Fi={})),function(t){t[t.METHOD_UNSET=0]="METHOD_UNSET",t[t.METHOD_GET=1]="METHOD_GET",t[t.METHOD_POST=2]="METHOD_POST",t[t.METHOD_PUT=3]="METHOD_PUT",t[t.METHOD_PATCH=4]="METHOD_PATCH",t[t.METHOD_DELETE=5]="METHOD_DELETE",t[t.METHOD_HEAD=6]="METHOD_HEAD",t[t.METHOD_OPTIONS=7]="METHOD_OPTIONS"}(Yi||(Yi={})),function(t){t[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR"}(Wi||(Wi={})),function(t){t[t.Default=0]="Default",t[t.Extranet=1]="Extranet",t[t.Intranet=2]="Intranet"}(Xi||(Xi={}));var an,cn,ln=(an=1,function(){return an++}),fn=function(){var t=1;return function(){return t++}}();function dn(t){return"number"==typeof t}function _n(t){return"string"==typeof t}function vn(t){return"boolean"==typeof t}function mn(t){return void 0===t}function pn(t){return null!==t&&t instanceof Object}function gn(t){return"function"==typeof t}function bn(t){return t instanceof Array}function En(t){return(t.startsWith("preset-id://")||t.startsWith("http")||t.startsWith("https"))&&(t.endsWith(".jpg")||t.endsWith(".jpeg")||t.endsWith(".png"))}!function(t){t.WIN32="WIN32",t.MAC="Mac",t.ANDROID="Android",t.LINUX="Linux",t.IOS="iOS",t.Harmony="Harmony",t.UNKNOWN="WTF"}(cn||(cn={}));__webpack_require__(570);var Sn=Promise;function yn(t,i,n){void 0===n&&(n=""),t.info("".concat(i," call ").concat(n))}function Tn(t,i,n){void 0===n&&(n=""),t.info("".concat(i," end ").concat(n))}function Rn(t,i,n){void 0===n&&(n=""),t.info("".concat(i," success ").concat(n))}function wn(t,i){return new Sn((function(n,e){e(function(t,i){var n=function(t){var i=t.reduce((function(i,n,e){var s="".concat(n," module");return 0==e?s:e==t.length-1?"".concat(i," and ").concat(s):"".concat(i,", ").concat(s)}),"");return"should install ".concat(i)}(t);return console.error(n),{errorCode:i||$n.code,extendedData:n}}(t,i))}))}function On(t){for(var i in t)pn(t[i])?On(t[i]):t.hasOwnProperty(i)||(dn(t[i])&&(t[i]=0),_n(t[i])&&(t[i]=""))}function In(t){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(t)&&/^[^:/]*$/g.test(t)}function Nn(t){return!!(t.startsWith("rtmp://")||t.startsWith("avertp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))}function Cn(t,i){return 0==i?dn(t)&&t%1==0&&t>=0:dn(t)&&t%1==0&&t>0}var kn="room not exist",Dn="input param error",zn="network is broken";var An="the user cancels the stream request.",Pn={code:1000002,message:"not login room"},Mn={code:1000014,message:"stream ID is too long"},xn={code:1000015,message:"streamID is empty"},Un={code:1000016,message:"stream ID contains illegal characters"},qn={code:1000017,message:zn},Ln={code:1100001,message:Dn},Gn={code:1100002,message:"network timeout."},Hn={code:1100999,message:"unknown server error"},jn={code:1101002,message:"get app config fail"},$n={code:1101003,message:"Module not imported"},Bn=1002011,Vn="room ID is empty",Jn=1002012,Fn="room ID contains illegal characters",Yn=1002013,Wn="room ID is too long",Xn={code:1102017,message:"dispatch error"},Zn={code:1102018,message:"token expired"},Kn={code:1102022,message:"dispatch request timeout"},Qn={code:1103001,message:Dn},te={code:1103049,message:"repeated pull same stream"},ie={code:1103051,message:"publisher retry timeout"},ne={code:1103055,message:"publish stream no found"},ee={code:1103056,message:"publish is publishing"},se={code:1103089,message:An},re={code:1104001,message:"input parm error"},oe={code:1104031,message:"player retry timeout"},ue={code:1104032,message:"player is playing"},he={code:1104039,message:"play stream not found"},ae={code:1104042,message:An},ce={code:1103052,message:"publisher cdn push error"},le={code:1000055,message:"cdn url is invalid"},fe=function(t){return t},de=function(t){return t},_e=function(t){return t},ve="/sdk/init",me="/sdk/login",pe="listener",ge=ve,be="/sdk/start_publish",Ee="/liveroom/send_stream_update_info",Se=de,ye=de,Te=de,Re={event:"/liveroom/get_current_stream_list",room_id:de,room_sid_string:de,stream_seq:_e,stream_size:_e,stream_list:fe,use_ua:_e,error:{ai:Qn,NOT_LOGIN:Pn}},we="/sdk/listener",Oe={event:"/sdk/publish_target",error:{ai:Ln,ci:ne,li:Pn,fi:{code:1103063,message:"publish target no response"},di:{code:1102021,message:"biz channel error."},_i:{code:1102024,message:"invalid channel"},mi:Hn}},Ie="/mss/pushadd",Ne="/mss/pushdel",Ce=de,ke={event:"/liveroom/send_stream_extra_info",error:{ai:Ln,pi:{code:1003050,message:"extra info of publishing stream is null"},li:Pn,ci:ne,gi:{code:1103062,message:"update stream info fail"}},stream_id:de,stream_extra_info:de,room_sid_string:de,room_id:de,send_seq:_e},De=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];var ze="TOKEN_ERROR",Ae="MULTIPLE_LOGIN_KICKOUT",Pe="TOKEN_EXPIRED",Me="ROOM_INNER_ERROR";function xe(t,i){return i[t+"SuccessCallback"]}function Ue(t,i,n,e){!function(t,i,n){i.success&&(n[t+"SuccessCallback"]=i.success),i.error&&(n[t+"ErrorCallback"]=i.error)}(t,{success:function(t,e){for(var s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];!function(t,i,n,e,s){switch(n){case"eventStart":t.eventStart(i,e);break;case"eventEndWithMsgInfo":t.eventEndWithMsgInfo(i,e,s[0]);break;case"addEventMsg":t.addEventMsg(i,e,s[0],s[1]);break;case"addEvent":t.addEvent(i,e);break;case"eventEnd":t.eventEnd(i,e);break;case"addMsgInfo":t.addMsgInfo(i,s[0])}}(i,n,t,e,s)}},e)}function qe(t,i,n,e,s){xe(t,i)&&xe(t,i)(n,e)}function Le(t,i){return{code:t,message:i||"liveroom error"}}function Ge(t,i){delete i[t+"SuccessCallback"],delete i[t+"ErrorCallback"]}function He(t,i){var n={code:t,message:"server error"};return n.code=t>1e9?t-1e9+52e6:t+2002e6,i&&(n.message=i),n}function je(t){var i={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:ze,2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:ze,5022:"ROOM_COUNT_EXCEED",5030:"FORBID_BLACK_USER"};return t>2e5&&t<3e5?i[t-2e5]:t<2e5?{50013:Ae,50116:ze,50117:Pe,50118:ze,50119:ze,50120:ze,50121:ze,50122:ze,50123:Pe,50124:ze,50125:ze,50126:ze,50127:ze,50128:ze}[t]||i[t]||Me:i[t]||Me}function $e(t,i,n,e){var s,r=[],o=[],u=[],h=[];n||(n=[]);for(var a=0;a<n.length;a++)if(n[a].anchor_id_name!=t&&n[a].id_name!=t&&n[a].user_id!=t){s=!1;for(var c=0;c<i.length;c++)if(n[a].stream_id===i[c].stream_id){n[a].extra_info!==i[c].extra_info&&u.push(n[a]),JSON.stringify(n[a].stream_attr_opts)!==JSON.stringify(i[c].stream_attr_opts)&&h.push(n[a]),s=!0;break}s||r.push(n[a])}for(var l=0;l<i.length;l++)if(i[l].anchor_id_name!=t&&i[l].id_name!=t&&i[l].user_id!=t){s=!1;for(var f=0;f<n.length;f++)if(i[l].stream_id===n[f].stream_id){s=!0;break}s||o.push(i[l])}i.splice(0);for(a=0;a<n.length;a++)i.push(n[a]);e(r,o,u,h)}function Be(t,i,n){return i=null!=i?i:1,n=null!=n?n:1e4,dn(t)&&t%1==0&&t>=i&&t<=n}function Ve(t){return 0==t||1==t?0==t?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"}function Je(t){return 0==t||1==t?0==t?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"}function Fe(t){return null!=t&&""!==t}function Ye(t,i){return!(t.length>=i)}function We(t){for(var i,n=0,e=t.length,s="";n<e;)i=t.subarray(n,Math.min(n+32768,e)),s+=String.fromCharCode.apply(null,Array.from(i)),n+=32768;return btoa(s)}function Xe(t,i){try{wx.setStorageSync(t,i)}catch(t){}}function Ze(t){try{return wx.getStorageSync(t)}catch(t){}}function Ke(t,i,n,e){return{interResolve:function(e){t.uploadReport(i),n(e)},interReject:function(n,s){var r;void 0===s&&(s=""),(r=n.code<2e9&&n.code>1e9?He(n.code,n.msg):{code:n.code,message:n.msg})&&t.addMsgInfo(i,{error:r.code,message:r.message+s}),t.uploadReport(i),e({errorCode:n.code||n.errorCode})}}}function Qe(t){return!(!t.startsWith("wss")||-1===t.indexOf("test")||!t.endsWith("ws"))}function ts(t){try{var i=Uint8Array.from(function(t){var i,n,e,s,r,o,u;for(o=t.length,r=0,u="";r<o;){do{i=De[255&t.charCodeAt(r++)]}while(r<o&&-1==i);if(-1==i)break;do{n=De[255&t.charCodeAt(r++)]}while(r<o&&-1==n);if(-1==n)break;u+=String.fromCharCode(i<<2|(48&n)>>4);do{if(61==(e=255&t.charCodeAt(r++)))return u;e=De[e]}while(r<o&&-1==e);if(-1==e)break;u+=String.fromCharCode((15&n)<<4|(60&e)>>2);do{if(61==(s=255&t.charCodeAt(r++)))return u;s=De[s]}while(r<o&&-1==s);if(-1==s)break;u+=String.fromCharCode((3&e)<<6|s)}return u}(t),(function(t){return t.charCodeAt(0)})),n=new DataView(i.buffer),e=void 0;return e=gn(n.getBigInt64)?n.getBigUint64(0):function(t,i,n){var e=n.getUint32(t,i),s=n.getUint32(t+4,i),r=i?e+Math.pow(2,32)*s:Math.pow(2,32)*e+s;return Number.isSafeInteger(r)||console.warn(r,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),r}(0,!1,n),Number(e>0?e:n.getBigUint64(0,!0))}catch(t){console.error("token error")}return-1}function is(t){var i=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(i+16*Math.random())%16|0;return i=Math.floor(i/16),("x"==t?n:3&n|8).toString(36)}))}var ns="zc.1",es="zc.sh.msbss",ss="zc.sh.ms",rs="zc.sh.psl",os="zc.crh.a.0",us="zc.hrh.smt.0";function hs(t,i,n,e){var s=t.version,r=t.name.toLowerCase(),o=function(t){return _n(t)&&Number(t.split(".")[0])||0}(s);return r===i&&(0===e&&o<n||(1===e&&o===n||2===e&&o>n))}var as,cs=function(){function t(t,i){this.ei=t,this.bi=i,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.useNetAgent=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.netMode=Xi.Default,this.callbackList={},this.experimentalAPIList={onRecvRoomMuteVideoStream:0,onRecvRoomMuteAudioStream:0},this.publishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnToTcp=!1,this.turnOverTcpOnly=void 0,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.engineDestroy=!1,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[],beautyEffectOverload:[],playerRecvSEI:[],beautyEffectError:[],_engineConfigUpdate:[],backgroundEffectError:[],exceptionUpdate:[],networkQuality:[],mixerSoundLevelUpdate:[],autoMixerSoundLevelUpdate:[],mixerRelayCDNStateUpdate:[],_engineDestroy:[],recvExperimentalAPI:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.customUa=!1,this.testNetPackageSize=!1,this.testSignalConnectCount=0,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.defaultConnTime=5,this.clientIP="",this.accessClientIp="",this.isMultiOuter=!1,this.roomList=[],this.isMultiRoom=!1,this.browser="",this.unregisterSeiFilter="",this.isTestMode=!1,this.debugLog=!1,this.netAppConfigDelay=0,this.seiConfig={emulationPreventionByte:!1},this.playAccelerate=!0,this.autoSwitchDeviceSetting={camera:!1,microphone:!1},this.unSendMessageList=[],this.scenario=$i.Default,this.testStreamRetryMode=0,this.testStreamRetryCount=10,this.supportDispatchByPass=!1,this.testStreamStatusSeq=0,this.engineConfig={keepAudioTrack:!0,playClearLastFrame:!0,previewClearLastFrame:!0,mixingAudioDelay:0,baseMixingAudioDelay:0,adaptCustomUA:!1,allowReplaceEmptyTrack:!1,publishQualityInterval:0,playQualityInterval:0,enableMiniSDP:!1,keepRtcWhenSignalDisconnected:!0,autoRecaptureOnShow:!1,datachannelOption:{ordered:!0}},this.Ei=!0,this.Si=!1,this.player265Validated=!1,this.player265ReceiverList=[],this.logReportCallback=Ue,this.unregisterCallback=Ge,this.decodeServerError=He,this.getLiveRoomError=je,this.getServerError=Le,this.mergeStreamList=$e,this.actionSuccessCallback=xe,this.checkValidNumber=Be,this.uint8arrayToBase64=We,this.getSeq=ln,this.getReportSeq=fn,this.cdnSeqV2=(new Date).getTime()}return Object.defineProperty(t.prototype,"networkState",{get:function(){var t;return null===(t=this.rtm)||void 0===t?void 0:t.stateCenter.networkState},set:function(t){var i;(null===(i=this.rtm)||void 0===i?void 0:i.stateCenter)&&!mn(t)&&(this.rtm.stateCenter.networkState=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMiniSdp",{get:function(){if(!this.Ei&&!this.Si)return!1;if(!window.WebAssembly||!window.Worker)return!1;if(hs(this.browserInfo,"chrome",78,0))return!1;var t=this.settingConfig.getSetting("open_mini_sdp");return!!vn(t)&&(this.ei.info("zc.c.ims setting: "+t),t)},enumerable:!1,configurable:!0}),t.prototype.setIsMiniSdp=function(t){this.settingConfig.setUserValue("open_mini_sdp",t)},Object.defineProperty(t.prototype,"streamCenter",{get:function(){return this.yi},set:function(t){this.yi=t},enumerable:!1,configurable:!0}),t.prototype.getRequestId=function(){return this.idName+"-"+ln()},t.prototype.actionListener=function(t){for(var i=this,n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate","playerRecvSEI","_remoteCameraStatusUpdate","_remoteMicStatusUpdate","_streamUpdated","_deviceError","networkQuality","exceptionUpdate","mixerSoundLevelUpdate","autoMixerSoundLevelUpdate","mixerRelayCDNStateUpdate"].includes(t)&&this.listenerList[t]){var s=this.reporter.createSpan(U.H,{key:pe},{key:""},we);s.setAttributes({listener:t,listener_params:JSON.stringify(n)}),["deviceError","streamExtraInfoUpdate","publisherStateUpdate","playerStateUpdate","roomStreamUpdate"].includes(t)&&this.ei.info("zc.al ".concat(t," ").concat(JSON.stringify(n))),s.end()}this.listenerList[t]&&this.listenerList[t].forEach((function(e){try{setTimeout((function(){e.apply(void 0,n)}),0)}catch(n){i.ei.error("zc.sc.al "+t+" "+n)}}))},t.prototype.getRoomByRoomID=function(t){return this.roomList.find((function(i){return i.roomID==t}))},t.prototype.getPlayRoom=function(t){return this.roomList.find((function(i){return!!i.streamList.find((function(i){return i.stream_id==t}))}))},t.prototype.callExperimentalAPI=function(t){return new Promise((function(t,i){t(void 0)}))},t.prototype.onExperimentalAPICallback=function(t,i){this.experimentalAPIList[t]&&this.actionListener("recvExperimentalAPI",i)},t.prototype.destroy=function(){this.yi=null},t}();!function(t){t.Logining="LOGINING",t.Logined="LOGINED",t.LoginFailed="LOGIN_FAILED",t.Reconnecting="RECONNECTING",t.Reconnected="RECONNECTED",t.ReconnectFailed="RECONNECT_FAILED",t.Kickout="KICKOUT",t.Logout="LOGOUT",t.LogoutFailed="LOGOUT_FAILED"}(as||(as={}));var ls,fs,ds="rtc_web",_s=["accesshub-wss.zego.im","accesshub-wss.coolzcloud.com","accesshub-wss.zegocloud.com"],vs="weblogger-wss.coolfcloud.com",ms="zm.0",ps="zm.wl",gs="zm.slf",bs="zm.lg",Es="zm.lo",Ss="zm.fac",ys="zm.hlu",Ts="zm.cna",Rs="zm.on",ws="zm.off",Os="zm.rntk",Is="zm.emr",Ns="zm.rm.lg",Cs="zm.rm.tl",ks="zm.rm.lgr",Ds="zm.rm.lo",zs="zm.rm.rr",As="zm.rm.kco",Ps="zm.hhl",Ms="zm.hb.st",xs="zm.hb.rsp",Us="zm.rrh.hlf",qs="zm.us.ftu",Ls="zm.us.urp",Gs="zm.us.uph",Hs="zm.us.mg",js="zm.st.at",$s="ON_LISTENER",Bs="zm.st.ofls",Vs="zm.lrh.sm",Js="zm.lrh.hp",Fs="zm.lrh.hsp",Ys="zm.lrh.gs",Ws="zm.lrh.lgi",Xs="zm.lrh.ful",Zs="zm.lrh.lgo",Ks="zm.lrh.sru",Qs="zm.lrh.hd",tr="zm.lrh.hb",ir="zm.nt.od",nr=[50116,50118,50119,50120,50121,50122,50124,50125,50126,50127,50128],er=function(){function t(){this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryStartTime=0,this.retryActiveCount=1,this.retryNetCount=0,this.retryNetMaxTimes=3,this.isOverTime=!1}return t.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,dn(t)&&t<3600&&(this.RETRY_MAX_TIME=t),dn(i)&&(this.RETRY_START_TIME_INTERVAL=i),dn(n)&&(this.RETRY_CONTINUE_COUNT=n),dn(e)&&(this.RETRY_MAX_TIME_INTERVAL=e)},t.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.startRetryTimer&&clearTimeout(this.startRetryTimer),this.startRetryTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.retryNetCount=0},t.prototype.isRetrying=function(){return null!==this.retryTimer||null!==this.startRetryTimer||null!==this.maxTimer},t}(),sr=(ls=function(t,i){return ls=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},ls(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}ls(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),rr=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},or=function(t){function i(i,n,e){var s=t.call(this)||this;return s.ei=i,s.Ti=n,s.Ri=e,s.wi=0,s.Oi=0,s.Ii=3,s.Ni="",s.loginRoomCallback={},s}return sr(i,t),Object.defineProperty(i.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),i.prototype.renewLocalToken=function(t,i){this.token=t,this.Ri.token=this.token;var n=(new Date).getTime(),e=void 0;if(i&&dn(i))e=1e3*i;else if(_n(t)&&["03","04"].includes(t.substring(0,2))){var s=1e3*ts(t.substring(2));this.ei.info("zm.rm.rlt time "+s+" "+n+" "+this.Ti.local_time_deviation),e=s-(n-this.Ti.local_time_deviation)}e&&this.roomHandler.resetTokenTimer(e),this.ei.setTokenInfo(t),this.Ti.actionListener("_tokenRenewed",t,this.Ri.roomID)},i.prototype.initRoom=function(t,i,n,e,s){this.roomHandler=t,this.roomID=i,this.renewLocalToken(n),this.user=e,this.config=s},i.prototype.active=function(t){var i,n,e,s=this;void 0===t&&(t=!1),this.ei.info(Ns+" retry call "+(null===(i=this.Ri)||void 0===i?void 0:i.roomID)+" "+t);var r=(null===(n=this.loginRoomCallback)||void 0===n?void 0:n.success)?ot:pt;if(this.ki||(this.ki=this.Ci.createSpan(U.H,{key:rt.event,par:this.roomID},{key:r,par:this.roomID},r,!0),this.Ni=r),this.roomHandler.setRunState(x.trylogin),this.Ri.isMulti&&(null===(e=this.Ti.roomModulesList.find((function(t){return!t.isMulti})))||void 0===e?void 0:e.runState)!==x.login)this.ei.info(Ns+" service is disconnected, multi room stop retry");else if(this.retryTimer)this.ei.info(Ns+" has actived, ignore");else{var o=this.Ti.networkState==q.offline;if(o){if(this.ei.info(Ns+" check if really offline. "+this.Oi),this.Oi>=this.Ii)return void this.ei.warn(Ns+" network is broken, stop retry")}else this.Oi=0;if(this.isOverTime)this.ei.info(Ns+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var u=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=u>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:u}this.ei.info(Ns+" interval "+this.retryActiveInterval),wx.getNetworkType({success:function(t){Xe("netType",t.networkType.toLowerCase())}}),this.retryTimer=setTimeout((function(){s.roomHandler.login(s.roomID,s.token,s.user,s.config,(function(t){s.Ti.networkState=q.online,s.handleLoginFinish(t)}),(function(t,i){s.handleLoginFinish(!1,t,i)})),s.retryTimer&&clearTimeout(s.retryTimer),s.retryTimer=null,o?s.Oi++:s.retryActiveCount++}),t?0:1e3*this.retryActiveInterval)}}},i.prototype.startMaxTime=function(){var t=this;this.maxTimer||(this.ei.info(Ns+" start max timer"),0===this.wi&&(this.wi=(new Date).getTime()),this.maxTimer=setTimeout((function(){var i;t.ei.info(Ns+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.roomHandler.resetRoom(),0!==t.wi&&(i=(i=(new Date).getTime()-t.wi)>0?i:void 0),t.Di(!1,J.LOGIN_TIMEOUT),t.ki&&(t.Ci.spanEnd({key:t.Ni,par:t.roomID},{error:J.LOGIN_TIMEOUT.code,message:J.LOGIN_TIMEOUT.msg,try_time:i}),t.ki=null),t.loginRoomCallback.fail&&(t.loginRoomCallback.fail(J.LOGIN_TIMEOUT),t.roomHandler.disconnectedHandle(J.LOGIN_TIMEOUT),t.resetCallBack())}),1e3*this.RETRY_MAX_TIME))},i.prototype.stopMaxTime=function(){this.ei.info(Ns+" stop max timer"),0!==this.wi&&(this.wi=0),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},i.prototype.onactive=function(t,i){},i.prototype.retryLoginRoom=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),!this.maxTimer&&this.startMaxTime(),i&&this.Ri.resetSessionInfo(),this.active(t)},i.prototype.handleError=function(t,i){if(this.RETRY_MAX_TIME<3)return!1;var n=t.code;if(i){var e=[200207,200208];if(n>=40001&&n<=40100||n>=50200&&n<=50299||[201002,30019].includes(n))return this.Ri.resetSessionInfo(),!0;var s=rr(rr([202002,205030,205035],nr,!0),[50013],!1);return 10015===n?(this.Ri.retryConnect(),!0):!(null==s?void 0:s.includes(n))&&(!!e.includes(n)||this.Ri.lastRunState==x.login&&(this.ei.warn("zm.rrh.he reset"),this.Ri.resetUserSession(),this.invalid(),!0))}return!0},i.prototype.setLoginRoomCallback=function(t,i){this.loginRoomCallback.success=t,this.loginRoomCallback.fail=i},i.prototype.loginFail=function(t){this.roomHandler.resetRoom(),this.Di(!1,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.roomHandler.disconnectedHandle(t),this.resetCallBack())},i.prototype.handleLoginFinish=function(t,i,n){var e;if(this.ei.info(Us+" "+t+" "+JSON.stringify(i)),i){if(this.ki){var s=void 0;0!==this.wi&&(s=(s=(new Date).getTime()-this.wi)>0?s:void 0),this.Ci.spanEnd({key:this.Ni,par:this.roomID},{error:i.code,message:i.msg,try_time:s}),this.ki=null}this.handleError(i,n)?(this.ei.info(Us+" retry"),this.retryLoginRoom()):(this.ei.info(Us+" reset"),this.roomHandler.resetRoom(),this.Di(t,i),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(i),this.roomHandler.disconnectedHandle(i),this.resetCallBack()))}else{s=void 0;0!==this.wi&&(s=(s=(new Date).getTime()-this.wi)>0?s:void 0),this.Di(t,{code:0,msg:""}),this.ki&&(this.Ci.spanEnd({key:this.Ni,par:this.roomID},{room_id:this.roomID,room_sid_string:null===(e=this.Ri)||void 0===e?void 0:e.roomSidString,try_time:s}),this.ki=null),this.loginRoomCallback.success&&(this.loginRoomCallback.success(t),this.resetCallBack())}},i.prototype.invalid=function(){this.ei.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this.Oi=0},i.prototype.Di=function(t,i){this.stopMaxTime(),this.invalid(),this.onactive(t,i)},i.prototype.resetCallBack=function(){this.loginRoomCallback.success=void 0,this.loginRoomCallback.fail=void 0},i}(er);!function(t){t.NOT_EMPTY="NOT_EMPTY",t.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",t.TYPE_STRING="TYPE_STRING",t.TYPE_INTEGER="TYPE_INTEGER",t.TYPE_OBJECT="TYPE_OBJECT",t.MAX_LENGTH_10="MAX_LENGTH_10",t.MAX_LENGTH_64="MAX_LENGTH_64",t.MAX_LENGTH_100="MAX_LENGTH_100",t.MAX_LENGTH_128="MAX_LENGTH_128",t.MAX_LENGTH_256="MAX_LENGTH_256",t.MAX_LENGTH_1024="MAX_LENGTH_1024"}(fs||(fs={}));var ur={error:{code:0,msg:"suc"}},hr={NOT_EMPTY:function(t,i,n,e,s){return void 0===i||""===i||null===i?(e.error("".concat(n," ").concat(t," is empty")),s):ur},ILLEGAL_CHARACTERS:function(t,i,n,e,s){return In(i)?ur:(e.error("".concat(n," ").concat(t," contains illegal characters")),s)},TYPE_STRING:function(t,i,n,e,s){return _n(i)?ur:(e.error("".concat(n," ").concat(t," must be string")),s)},TYPE_INTEGER:function(t,i,n,e,s){return Cn(i,!1)?ur:(e.error("".concat(n," ").concat(t,"  must be integer number")),s)},TYPE_OBJECT:function(t,i,n,e,s){return i&&pn(i)?ur:(e.error("".concat(n," ").concat(t,"  must be object")),s)},MAX_LENGTH_10:function(t,i,n,e,s){return i.length>10?(e.error("".concat(n," ").concat(t," is too long")),s):ur},MAX_LENGTH_64:function(t,i,n,e,s){return i.length>64?(e.error("".concat(n," ").concat(t," is too long")),s):ur},MAX_LENGTH_100:function(t,i,n,e,s){return i.length>100?(e.error("".concat(n," ").concat(t," is too long")),s):ur},MAX_LENGTH_128:function(t,i,n,e,s){return i.length>128?(e.error("".concat(n," ").concat(t," is too long")),s):ur},MAX_LENGTH_256:function(t,i,n,e,s){return i.length>256?(e.error("".concat(n," ").concat(t," is too long")),s):ur},MAX_LENGTH_1024:function(t,i,n,e,s){return i.length>1024?(e.error("".concat(n," ").concat(t," is too long")),s):ur}};var ar=function(){function t(t,i){this.ei=t,this._dataReport=i,this.id="",this._debug=!1,this.appConfigEtag=-1,this.appConfigFetched=!1,this.requestList={},this.mode=V.Mode.MODE_ONLINE,this.connectState="connected",this.testNetPackageSize=!1,this.netGeoFencing={},this.advanceConfig={},this.svrDomains={},this.userListenerList=["roomUserUpdate","roomOnlineUserCountUpdate","IMRecvCustomCommand","IMRecvBroadcastMessage","roomExtraInfoUpdate","IMRecvBarrageMessage","roomStateUpdate","tokenWillExpire","roomStateChanged"],this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],_netAppConfigRsp:[],_connectChanged:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_stopStream:[],roomStateChanged:[],_userTransUpdate:[],_uaHeartBeatTimeout:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=q.online,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown"}return Object.defineProperty(t.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t,Zt.LoggerStateCenter.getInstance().debug=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(t){this._testEnvironment=t,Zt.LoggerStateCenter.getInstance().testEnvironment=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ENV",{get:function(){return this._env},set:function(t){this._env=t,Zt.LoggerStateCenter.getInstance().ENV=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),t.prototype.getRequestId=function(){return this.idName+"-"+ln()},t.prototype.actionListener=function(t){for(var i=this,n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];if(!["getAnchorInfo","HBResponse","roomOnlineUserCountUpdate","roomLoginResponse"].includes(t)&&!t.startsWith("_")&&this.listenerList[t]){var s=this.reporter.createSpan(U.H,{key:K},{key:""},Ot);s.setAttributes({listener:t,listener_params:JSON.stringify(n)}),s.end()}["roomStateChanged","tokenWillExpire"].includes(t)&&this.ei.info("zm.al ".concat(t," ").concat(JSON.stringify(n),". pageID: ").concat(No.pageID," , instID: ").concat(this.id)),this.listenerList[t]&&this.listenerList[t].forEach((function(e){if(i.userListenerList.includes(t))setTimeout((function(){try{e.apply(void 0,n)}catch(n){throw i.ei.error(js+" ",t," ",JSON.stringify(n)),n}}),0);else try{e.apply(void 0,n)}catch(n){i.ei.error(js+" ",t," ",JSON.stringify(n))}}))},t.prototype.onListener=function(t,i){return this.listenerList[t]?gn(i)?(-1==this.listenerList[t].indexOf(i)&&this.listenerList[t].push(i),!0):(this.ei.error($s+" listener callBack must be funciton"),!1):(this.ei.error($s+" event "+t+" no found"),!1)},t.prototype.offListener=function(t,i){return this.listenerList[t]?gn(i)?(-1!==this.listenerList[t].indexOf(i)&&(this.listenerList[t]=this.listenerList[t].filter((function(t){return t!==i}))),!0):(this.ei.error(Bs+" listener callBack must be funciton"),!1):(this.ei.error(Bs+" event "+t+" no found"),!1)},Object.defineProperty(t.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(t){this._sdkVersion=t},enumerable:!1,configurable:!0}),t.prototype.proxyRes=function(t,i,n){return{interResolve:function(n){i(n),t.end()},interReject:function(i,e){var s;void 0===e&&(e=""),!i.code&&i.errorCode&&(i.code=i.errorCode),(s=i.code<2e9&&i.code>1e9?He(i.code,i.msg):{code:i.code,message:i.msg})&&t.setAttributes({error:s.code,message:s.message+e}),t.end(),n({errorCode:i.code})}}},t}(),cr=function(){function t(t,i,n,e,s){this.ei=t,this.Ti=i,this._dataReport=n,this.zi=e,this.Ri=s,this.Ai=null,this.Pi=1e5,this.Mi=null,this.xi=0}return Object.defineProperty(t.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),t.prototype.Ui=function(){var t=this;this.qi(),this.Mi=setTimeout((function(){t.ei.warn("zm.hb.to call. "+t.Pi),t.hbLogout(J.HEARTBEAT_TIMEOUT),t.Ci.createSpan(U.H,{key:rt.event,par:t.Ri.roomID},{key:""},ct).end()}),this.Pi)},t.prototype.qi=function(){this.Mi&&clearTimeout(this.Mi)},t.prototype.init=function(t){var i=this,n=t.body.hearbeat_interval<H?H:t.body.hearbeat_interval;this.qi(),this.Ai&&clearTimeout(this.Ai),this.Ai=setTimeout((function(){i.start(n)}),n),this.xi++},t.prototype.start=function(t){var i=this;this.ei.info(Ms+" call");var n=this.Ci.createSpan(U.H,{key:rt.event,par:this.Ri.roomID},{key:""},Rt.event);if(!this.Ri.isLogin())return this.ei.error(Ms+" state error"),void this.Ci.setError(n,Rt.error.NOT_LOGIN);var e=function(t,e){var s,r,o,u;if(t.header&&t.body){if(0!==(t.body&&t.body.err_code)){var h=He(t.body.err_code||t.body.code,t.body.err_message||t.body.message);n.setAttributes({error:h.code,message:h.message+t.body.err_code})}}else n.setAttributes({error:t.code>0?t.code:J.ROOM_INNER_ERROR.code,message:t.msg?t.msg:J.ROOM_INNER_ERROR});i.Li(t,e),0===(null===(s=null==t?void 0:t.body)||void 0===s?void 0:s.err_code)&&n.setAttributes({interval:Rt.interval(null===(r=null==t?void 0:t.body)||void 0===r?void 0:r.hearbeat_interval),stream_seq:Rt.stream_seq(null===(o=null==t?void 0:t.body)||void 0===o?void 0:o.stream_seq),server_user_seq:Rt.server_user_seq(null===(u=null==t?void 0:t.body)||void 0===u?void 0:u.server_user_seq)}),n.end()};this.zi.heartBeat(e,e,this.Ri,this.Gi),this.Gi=t;var s=this.Gi;this.xi>=2?(s=Math.round(Math.random()*(this.Gi+1)),this.xi=1):s=this.Gi,this.Mi||this.Ui(),this.Ai=setTimeout((function(){i.start(i.Gi)}),s),this.ei.info(Ms+" call success")},t.prototype.Li=function(t,i){return t.body&&t.body.err_code&&0!==t.body.err_code?(this.ei.error(xs+" disconnect, server error=",t.body.err_code),t.body.err_code==M?void this.hbLogout(J.HEARTBEAT_TIMEOUT):void this.hbLogout(Le(t.body.err_code))):t.header&&t.body?(0!==t.body.hearbeat_interval&&(this.Gi=t.body.hearbeat_interval,this.Gi<H&&(this.Gi=H)),0!==t.body.hearbeat_timeout&&(this.Pi=t.body.hearbeat_timeout),this.Ui(),this.heartbeatRspNotiFy(t,this.Ri.roomID),void this.ei.info(xs+" call success "+i)):(this.ei.error(xs+" disconnect, error=",JSON.stringify(t)+", seq = "+i),void this.hbLogout(t))},t.prototype.heartbeatRspNotiFy=function(t,i){},t.prototype.hbLogout=function(t){},t.prototype.resetHeartbeat=function(){clearTimeout(this.Ai),this.Ai=null,this.qi(),this.xi=0,this.ei.info("zm.hb.rst call success")},t}(),lr={code:1102026,msg:"cancel login"};function fr(t){return window=window||globalThis,function(t){var i=unescape||window.unescape;return Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})))}(t)}function dr(t){return window=window||globalThis,function(t){var i=escape||window.escape;return decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))))}(t)}var _r=function(t){return fr(t=null!=t?t:"")},vr=function(t){return dr(t)},mr="DISCONNECTED",pr="CONNECTED",gr="CONNECTING",br=function(){function t(t,i,n,e,s){this.ei=t,this.Ti=i,this._dataReport=n,this.Ri=e,this.zi=s,this.Hi=null,this.ji=1e4,this.$i=null,this.Bi=0,this.Vi=0,this.validTime=0,this.totalTime=0,this.brokenCounts=0,this.Ji=0,this.Fi=0,this.Yi=!1,this.loginCallback={}}return Object.defineProperty(t.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Wi",{get:function(){return this.Ri.roomID},enumerable:!1,configurable:!0}),t.prototype.resetTokenTimer=function(t){var i=this;this.ei.info("zm.rm.rst  call: "+(t=(t=(t-=3e4)<0?0:t)>2147483647?2147483647:t)),this.$i&&clearTimeout(this.$i),this.$i=setTimeout((function(){i.Ti.actionListener("tokenWillExpire",i.Wi),i.Ti.actionListener("roomTokenWillExpire",i.Wi)}),t)},t.prototype.Xi=function(){this.$i&&clearTimeout(this.$i),this.$i=null},t.prototype.setRunState=function(t){this.Ri.runState!==t&&(this.Ri.lastRunState=this.Ri.runState,this.Ri.runState=t)},t.prototype.Zi=function(){this.Hi&&clearTimeout(this.Hi),this.Hi=null},t.prototype.Ki=function(t){var i,n,e,s,r,o,u,h,a=this.Ci.createSpan(U.H,{key:lt.event,par:this.Wi},{key:""},this.Ti.isMultiRoom?dt:ft);t&&"0"===this.zi.zPushSid&&(this.zi.zPushSid=null===(n=null===(i=this.zi)||void 0===i?void 0:i.switchSessionID)||void 0===n?void 0:n.toString()),this.updateTimes();var c=t?null===(e=this.zi)||void 0===e?void 0:e.zPushSid:null===(r=null===(s=this.zi)||void 0===s?void 0:s.switchSessionID)||void 0===r?void 0:r.toString();a.setAttributes({room_id:lt.room_id(null===(o=this.Ri)||void 0===o?void 0:o.roomID),room_sid_string:lt.room_sid_string(null===(u=this.Ri)||void 0===u?void 0:u.roomSidString),liveroom_sid_string:_t(null===(h=this.Ri)||void 0===h?void 0:h.userSidString),sdk_zpush_sessionid_string:vt(c),valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),a.end()},t.prototype.resetRoom=function(t){var i,n=this;if(this.ei.info(zs+" call"),this.Ti.roomModulesList.length>1&&!t&&(this.Ri.isMulti=!0),this.Zi(),this.Ri.sessionExist&&this.Ri.runState!==x.logout&&!this.Ri.isDisConnect()){var e=function(t){n.Qi(t,!n.Ri.isMulti)};this.zi.logout(this.Ri,e,e)}this.Ki(t),this.setRunState(x.logout),this.Ri.resetRoomSession(),this.Ri.resetUserSession(),this.Ri.isMulti||(this.Ti.userid="",this.ei.setSessionInfo(this.Ti.appid,this.Wi,this.Ri.userSidString,this.Ti.idName,this.Ti.nickName,this.Ti.sdKVersion),null===(i=this.zi)||void 0===i||i.reset()),this.resetRoomCallBack(),this.Ti.roomModulesList=this.Ti.roomModulesList.filter((function(t){return t!==n.Ri}));var s=this.Ti.roomModulesList[0];(s&&(s.isMulti=!1,s.runState!==x.login&&s&&s.retryRoom()),this.Ti.isMultiRoom&&0===this.Ti.roomModulesList.length)&&(this.Ci.createSpan(U.H,{key:lt.event,par:this.Wi},{key:""},mt).end(),this.zi.zPushSid="0");this.ei.info(zs+" call success")},t.prototype.resetRoomCallBack=function(){},t.prototype.loginSuccessCallBack=function(t,i){},t.prototype.handlePushKickout=function(t,i,n){var e,s,r,o,u,h=this;this.ei.info(As+"  call "+JSON.stringify(t));var a=function(t){var i={code:t,message:"kickout reason = "+t},n={code:63000005,message:"zpush token expired",name:Pe};switch(t){case 1:return{code:63000001,message:"zpush multiple login kickout",name:Ae};case 2:return{code:63000002,message:"zpush manual kickout",name:"MANUAL_KICKOUT"};case 4:return n;default:i.code=t,i.message="kickout reason = "+t}return i}(t.body.reason||(null===(e=t.body)||void 0===e?void 0:e.kickout_reason)),c=this.Ci.createSpan(U.H,{key:rt.event,par:this.Wi},{key:""},St);this.updateTimes(),c.setAttributes({error:null===(s=J[a.name||"ROOM_INNER_ERROR"])||void 0===s?void 0:s.code,message:a.message,kickout_reason:yt((null===(r=t.body)||void 0===r?void 0:r.reason)||(null===(o=t.body)||void 0===o?void 0:o.kickout_reason)),need_relogin:Tt(null===(u=null==t?void 0:t.body)||void 0===u?void 0:u.need_relogin),valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),c.end();var l=this.Ri.roomTryHandler;if(l)if(l.onactive=function(t,i){h.ei.info(As+" onactive"),h.disconnectedHandle(i),h.Ti.actionListener("_kickout",i)},t.body.need_relogin&&1==t.body.need_relogin)this.Ri.retryRoom(!1,!0);else{this.setRunState(x.logout),this.resetRoom(i);var f={};if(t&&t.body.custom_reason)f.custom_kickout_message=t.body.custom_reason;else if(a.name&&J[a.name]){f.custom_kickout_message=J[a.name].msg+"; kickout reason: "+(t.body.reason||t.body.kickout_reason)}this.disconnectedHandle(a.name&&J[a.name]?J[a.name]:J.ROOM_INNER_ERROR,{extendedData:JSON.stringify(f),isKickout:!0}),this.Ti.actionListener("_kickout",{code:J.MANUAL_KICKOUT.code,msg:J.MANUAL_KICKOUT.msg+t.body.reason||t.body.kickout_reason})}else this.ei.info(As+" try handler no found")},t.prototype.handleHbLogout=function(t){var i=this,n=this.Ri.roomTryHandler;n&&(n.onactive=function(t,n){i.ei.warn(Ps+" onactive"),i.transError(n),i.disconnectedHandle(n)},[J.HEARTBEAT_TIMEOUT,J.SOCKET_CLOSE].includes(t)||[105,152,2001].includes(null==t?void 0:t.code)||t.msg.endsWith("1000002001")||t.msg.endsWith("1000000152")||t.msg.endsWith("1000000105")?this.Ri.retryRoom():[J.TIMEOUT].includes(t)?this.ei.warn(Ps+" timeout"):(this.ei.warn(Ps+" unexpected error: ".concat(JSON.stringify(t))),this.logoutByError(t)))},t.prototype.logoutByError=function(t){var i=this.Ri.roomTryHandler;i&&(i.stopMaxTime(),i.invalid(),this.resetRoom(),this.disconnectedHandle(t))},t.prototype.onConnecting=function(t){this._roomStateHandle(gr,as.Logining,t)},t.prototype.disconnectedHandle=function(t,i){if(t&&0!==t.code){this.Xi();var n=(null==i?void 0:i.isKickout)?as.Kickout:as.ReconnectFailed;this.transError(t),this._roomStateHandle(mr,n,t,(null==i?void 0:i.extendedData)||t.msg)}else this._roomStateHandle(pr,as.Reconnected,t,null==i?void 0:i.extendedData)},t.prototype.updateTimes=function(){this.updateValidTime(),this.updateTotalTime()},t.prototype.updateValidTime=function(){this.Ji&&(this.validTime=this.validTime+Date.now()-this.Ji,this.Ji=0)},t.prototype.updateTotalTime=function(){this.Fi&&(this.totalTime=Date.now()-this.Fi)},t.prototype._roomStateHandle=function(t,i,n,e){var s,r,o,u=this.Ri.roomID,h=Date.now();if(!i||i!=as.Reconnecting||(this.Vi++,1!=this.Vi)){var a;this.ei.info("zm.rm.scb "+t+" "+JSON.stringify(n)),[pr,mr].includes(t)&&(this.Vi=0,this.Yi&&this.brokenCounts++),t!==pr&&this.updateTimes(),i&&[as.LoginFailed,as.ReconnectFailed].includes(i)&&(i=(null===(s=this.Ri.roomTryHandler)||void 0===s?void 0:s.loginRoomCallback.fail)?as.LoginFailed:as.ReconnectFailed),i&&[as.Logined,as.Reconnected].includes(i)&&((null===(r=this.Ri.roomTryHandler)||void 0===r?void 0:r.loginRoomCallback.success)?(i=as.Logined,this.Fi=this.Fi||h):i=as.Reconnected,this.Yi=!1,this.Ji=h),i&&[as.Logining,as.Reconnecting].includes(i)&&(i=(null===(o=this.Ri.roomTryHandler)||void 0===o?void 0:o.loginRoomCallback.success)?as.Logining:as.Reconnecting,this.Fi&&(this.Yi=!0));var c=0;switch(i){case as.Reconnecting:a=gt,this.Bi=(new Date).getTime();break;case as.ReconnectFailed:a=Et;break;case as.Reconnected:a=bt,c=(new Date).getTime()-this.Bi}if(this.Ri.lastRoomState=this.Ri.roomState,this.Ri.roomState=t,this.Ri.roomReasonState=i,this.Ri.roomState!==this.Ri.lastRoomState){this.Ti.actionListener("_roomStateUpdate",u,t,n?n.code:0,e,i);var l=(null==n?void 0:n.code)||0;if(l==lr.code&&(l=0),this.Ti.actionListener("roomStateUpdate",u,t,l,e),this.Ti.actionListener("roomStateChanged",u,i,l,e),a){var f=this.Ci.createSpan(U.H,{key:rt.event,par:u},{key:""},a.event);f.setAttributes(i===as.Reconnected?{room_broken_time:bt.room_broken_time(c)}:{error:(null==n?void 0:n.code)||0,message:e||""}),a==Et&&f.setAttributes({valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),f.end()}}t===mr&&(this.Fi=0,this.totalTime=0,this.validTime=0,this.brokenCounts=0)}},t.prototype.transError=function(t){if(this.ei.info("zm.rm.te "+JSON.stringify(t)),0!==t.code&&(t.code<2e9&&t.code>1e9||t.code<1e6)){var i=je(t.code);i&&J[i]&&(t.code=J[i].code,t.msg=J[i].msg)}},t.prototype.login=function(t,i,n,e,s,r){if(this.ei.info(Ns+" call:"+t),this.ei.remoteReport(Ns+" call:"+i),!this.Ri.isMulti&&this.ei.setSessionInfo(this.Ti.appid,t,"",n.userID,"",this.Ti.sdKVersion),e){var o=e.userUpdate,u=e.maxMemberCount;o&&vn(o)&&(this.Ri.userStateUpdate=o),u&&dn(u)&&(this.Ri.maxMemberCount=u)}if(!this.Ti.configOK)return this.ei.error(Ns+" init sdk wrong"),void r(J.INIT);this.Ri.runState!==x.trylogin&&this.setRunState(x.trylogin),this.Ri.isCancelLogin=!1,this.Ri.roomID=t,this.Ri.token=i,this.Ri.thirdToken=i,this.Ti.idName=n.userID,this.Ti.nickName=n.userName||n.userID,this.loginCallback.success=s,this.loginCallback.fail=r,this.kn=this.Ri.isMulti?ht:ut,this.Ci.createSpan(U.H,{key:ot,bak_key:pt,par:this.Wi},{key:this.kn.event,par:this.Wi},this.kn.event,!0),this.Zi(),this.onConnecting({code:0,msg:""}),this.xn(),this.ei.info(Ns+" call success")},t.prototype.xn=function(){var t,i,n,e,s=this;if(this.Ri.runState===x.trylogin)if(this.Ri.isMulti&&this.Ri.isDisConnect())this.ei.warn(Cs+" liveroom is not connected");else{var r=function(t,i){s.Un(t,i)};(null===(t=this.zi)||void 0===t?void 0:t.isUaConnect)?(this.Ci.spanSetAttributes({key:this.kn.event,par:null===(i=this.Ri)||void 0===i?void 0:i.roomID},{sdk_zpush_sessionid_string:null===(e=null===(n=this.zi)||void 0===n?void 0:n.switchSessionID)||void 0===e?void 0:e.toString()}),this.zi.login(this.Ri,r,r)):(this.Hi=setTimeout((function(){s.ei.info(Cs+" over time no response, login timeout"),s.loginCallback.fail&&s.loginCallback.fail(rt.error.LOGIN_TIMEOUT)}),this.ji),this.ei.warn(Cs+" ua is not connected")),this.ei.info(Cs+" call success")}else this.ei.error("zb.rh.tl state error")},t.prototype.Un=function(t,i){if(this.ei.info(ks+" seq: "+i+" "+JSON.stringify(t)),this.Ri.runState===x.trylogin)if(t.header&&t.body){if(t.header.seq!==i&&0==this.Ri.isMulti)return void this.ei.error(ks+" in wrong seq, local=",i+"",",recv=",t.header.seq);0!==t.body.err_code?(this.ei.error(ks+" server error=",t.body.err_code),this.qn(t)):(this.ei.info(ks+" call success."),this.Ln(t))}else this.ei.error(ks+" "+JSON.stringify(t)),this.qn(t);else this.Ri.isCancelLogin?(this.qn(lr),this.Ri.isCancelLogin=!1):this.ei.error(ks+" state error")},t.prototype.qn=function(t){this.Zi();var i=rt.error.INNER_ERROR;t.header&&t.body?i=Le(t.body.err_code):t.code&&t.msg&&(i=t),this.Ci.spanEnd({key:this.kn.event,par:this.Wi},{error:i.code,message:i.msg}),this.loginCallback.fail&&this.loginCallback.fail(i,!0)},t.prototype.Ln=function(t){var i,n,e,s,r,o,u,h=this;this.Ri.checkRoomSession(t.body.room_session_id)&&(this.Ri.loginTime=Date.now());var a=this.Ri.lastRunState;this.setRunState(x.login),this.Ti.userid=t.body.user_id,this.Ri.longRoomSid=t.body.room_session_id,this.Ri.longSid=t.body.session_id;var c=((i={})[this.Wi]={room_sid_string:this.Ri.roomSidString},i);this.Ci.setPublicPros(c);var l=null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.token_remain_time;if(this.Ti.configRoomAuth=l>0,t.body.ret_timestamp&&["03","04"].includes(this.Ri.token.substring(0,2))){var f=(new Date).getTime(),d=f-t.body.ret_timestamp;this.Ti.local_time_deviation=d<5e3?0:d;var _=l>0?1e3*l:1e3*ts(this.Ri.token.substring(2))-(f-this.Ti.local_time_deviation);this.resetTokenTimer(_)}!this.Ri.isMulti&&this.ei.setSessionInfo(this.Ti.appid,this.Wi,this.Ri.userSidString,this.Ti.idName,this.Ti.nickName,this.Ti.sdKVersion),this.Ci.spanEnd({key:this.kn.event,par:this.Wi},{room_id:null===(e=this.Ri)||void 0===e?void 0:e.roomID,room_sid_string:null===(s=this.Ri)||void 0===s?void 0:s.roomSidString,zpush_sessionid_string:null===(o=null===(r=null==t?void 0:t.header)||void 0===r?void 0:r.session_id)||void 0===o?void 0:o.toString(),liveroom_sid_string:null===(u=this.Ri)||void 0===u?void 0:u.userSidString}),this.Zi(),this.loginSuccessCallBack(a,t),this._roomStateHandle(pr,as.Logined,{code:0,msg:""}),this.ei.makeZipLogSpaceUpload().catch((function(t){h.ei.error("zm.rm.lgsuc zip log upload error: "+JSON.stringify(t))})),this.loginCallback.success&&this.loginCallback.success(!0)},t.prototype.logout=function(t){this.ei.info(Ds+" call");var i={code:0,msg:""};this.Ri.runState!==x.logout?(this.Ri.runState===x.trylogin&&(this.Ri.isCancelLogin=!0,i=lr),this.resetRoom(t),this._roomStateHandle(mr,as.Logout,i,void 0),this.Xi(),this.ei.info(Ds+" call success")):this.ei.warn("zb.rh.lo at logout")},t.prototype.Qi=function(t,i){var n;this.ei.info(Ds+" result=",t.body&&t.body.err_code?t.body.err_code:"-1"),i&&(null===(n=this.zi)||void 0===n||n.closeRequest())},t}(),Er=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},Sr=function(){function t(t,i,n,e,s){this.ei=t,this.Ti=i,this._dataReport=n,this.zi=e,this.Ri=s,this.Gn=!1,this.Hn=[],this.jn=0,this.$n=0,this.Bn=[],this.Vn=null,this.Jn=3e4,this.Fn=5e3,this.Yn={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return t.prototype.loginRsp=function(t,i){this.Yn=t.body.anchor_info||this.Yn,this.Jn=t.body.userlist_interval||this.Jn,this.Fn=t.body.userlist_merge_timeout||this.Fn,t.body.anchor_info&&(this.Ti.actionListener("getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name),this.Ti.actionListener("_getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name)),t.body.online_count&&this.Ti.actionListener("roomOnlineUserCountUpdate",this.Ri.roomID,t.body.online_count),this.ei.info("zm.us.lgr  userStateUpdate "+this.Ri.userStateUpdate),this.Ri.userStateUpdate&&this.Wn(i)},t.prototype.patchUserList=function(t){var i=this;t.body.server_user_seq!==this.jn&&this.Ri.userStateUpdate&&!this.Vn&&(this.ei.info("zm.us.pt call update user "+this.jn+" server "+t.body.server_user_seq),this.Vn||(this.Vn={}),this.Xn&&clearTimeout(this.Xn),this.Xn=setTimeout((function(){i.Zn()}),this.Fn)),this.$n=t.body.server_user_seq,null!=t.body.online_count&&0!=t.body.online_count&&this.Ti.actionListener("roomOnlineUserCountUpdate",this.Ri.roomID,t.body.online_count)},t.prototype.resetUserHandler=function(){this.Gn=!1,this.Kn=0,this.Hn=[],this.jn=0,this.$n=0,this.Bn=void 0,this.Vn={},this.Xn=void 0,this.Qn=void 0,this.Jn=3e4,this.Fn=5e3,this.Yn={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},t.prototype.Wn=function(t){this.Gn?this.ei.warn(qs+" is already querying"):(this.Gn=!0,this.Hn=[],this.te(0,t||0),this.ei.info(qs+" the first time call"))},t.prototype.te=function(t,i){var n,e=this,s=function(t){e.ie(t,i)},r={user_index:t,sort_type:0},o=Nt;this.Ti.reporter.createSpan(U.H,{key:rt.event,par:this.Ri.roomID},{key:o.event,par:this.Ri.roomID},o.event,!0).setAttribute("user_index",o.user_index(t)),null===(n=this.zi)||void 0===n||n.fetchUserList(r,s,s,this.Ri)},t.prototype.ie=function(t,i){var n,e,s=this;if(this.Ti.reporter.spanEnd({key:Nt.event,par:this.Ri.roomID},{error:(null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.err_code)||(null==t?void 0:t.code),message:(null===(e=null==t?void 0:t.body)||void 0===e?void 0:e.err_message)||(null==t?void 0:t.msg)}),t.body&&0!=t.body.err_code)return this.Gn=!1,this.Kn=Date.now()+this.Jn,void this.ei.info(Ls+" fetch error "+t.body.err_code);if(!t.header||!t.body)return this.Gn=!1,this.Kn=Date.now()+this.Jn,void this.ei.info(Ls+" fetch error "+t);if(this.Ri.userStateUpdate){this.Hn=Er(Er([],this.Hn,!0),t.body.user_baseinfos,!0);var r=t.body.ret_user_index;if(r!=t.body.server_user_index)return this.ei.info(Ls+" fetch another page"),void this.te(r+1,i);this.jn=t.body.server_user_seq;for(var o=[],u=[],h=0;h<this.Hn.length;h++){var a={userID:this.Hn[h].id_name,userName:this.Hn[h].nick_name,role:this.Hn[h].role};4!==a.role&&(o.push(a),u.push({idName:this.Hn[h].id_name,nickName:this.Hn[h].nick_name,role:this.Hn[h].role}))}this.Ti.actionListener("_getTotalUserList",this.Ri.roomID,u),i==x.login?(this.Bn&&function(t,i,n,e){t.debug("msl.0 call");var s,r=[],o=[];n||(n=[]);for(var u=0;u<n.length;u++){s=!1;for(var h=0;h<i.length;h++)if(n[u].userID===i[h].userID){s=!0;break}s||r.push(n[u])}for(var a=0;a<i.length;a++){s=!1;for(var c=0;c<n.length;c++)if(i[a].userID===n[c].userID){s=!0;break}s||o.push(i[a])}for(i.splice(0),u=0;u<n.length;u++)i.push(i[u]);e(r,o),t.debug("msl.0 call success")}(this.ei,this.Bn,o,(function(t,i){0!==t.length&&s.onUserStateUpdate(s.Ri.roomID,"ADD",t),0!==i.length&&s.onUserStateUpdate(s.Ri.roomID,"DELETE",i)})),this.Bn=o):(this.Bn=o,0!==o.length&&this.onUserStateUpdate(this.Ri.roomID,"ADD",o)),this.Gn=!1,this.Kn=Date.now()+this.Jn,this.Hn=[],this.ei.info(Ls+" call success user_list "+o+", count: "+o.length+", seq: "+this.jn)}else this.ei.info(Ls+" not update")},t.prototype.handlePushUserStateUpdateMsg=function(t){if(this.ei.info(Gs+" call"),this.Ri.userStateUpdate)if(this.jn!==t.body.user_list_seq)if(this.jn+t.body.user_actions.length===t.body.user_list_seq){this.jn=t.body.user_list_seq;for(var i=[],n=0;n<t.body.user_actions.length;n++){var e={action:t.body.user_actions[n].Action,idName:t.body.user_actions[n].IdName,nickName:t.body.user_actions[n].NickName,role:t.body.user_actions[n].Role,loginTime:t.body.user_actions[n].LoginTime};4===e.role||i.push(e)}this.Ti.actionListener("_userStateUpdate",t.body.room_id,i);var s=[],r=[];i.forEach((function(t){1==t.action?s.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&r.push({userID:t.idName,userName:t.nickName,role:t.role})})),this.Bn&&(this.Bn=this.Bn.concat(s).filter((function(t){return!r.some((function(i){return i.userID==t.userID}))}))),0!==s.length&&this.onUserStateUpdate(t.body.room_id,"ADD",s),0!==r.length&&this.onUserStateUpdate(t.body.room_id,"DELETE",r),this.ei.info(Gs+" call success")}else this.ee(t.body.user_list_seq,t.body.user_actions);else this.ei.warn(Gs+" user_list_seq is the same with local seq");else this.ei.info(Gs+" userStateUpdate is false")},t.prototype.onUserStateUpdate=function(t,i,n){var e=this,s=n.filter((function(t){return t.userID!==e.Ti.idName}));0!=s.length&&(s=s.map((function(t){return{userID:t.userID,userName:t.userName}})),this.Ti.actionListener("roomUserUpdate",t,i,s))},t.prototype.ee=function(t,i){var n=this;this.Vn||(this.ei.warn(Hs+" new merge userlist "+this.jn+" server "+t),this.Vn={},this.Xn&&clearTimeout(this.Xn),this.Xn=setTimeout((function(){n.Zn()}),this.Fn)),this.Vn[t]=i,this.ei.warn(Hs+"  merge userlist "+this.jn+" server "+t+" userlist "+i.length)},t.prototype.se=function(t){var i=this;this.ei.info("zm.us.mg merge userlist "+this.jn+" userSeqList "+t.join(",")),this.jn=t[t.length-1],this.Kn=Date.now()+this.Jn;var n={};t.forEach((function(t){i.Vn&&i.Vn[t].forEach((function(t){n[t.IdName]=t}))})),this.Vn=null;var e=Object.values(n).map((function(t){return{action:t.Action,idName:t.IdName,nickName:t.NickName,role:t.Role,loginTime:t.LoginTime?String(t.LoginTime):""}})).filter((function(t){return 4!==t.role}));e.sort((function(t,i){return t.loginTime.localeCompare(i.loginTime)}));var s=[],r=[];e.forEach((function(t){1==t.action?s.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&r.push({userID:t.idName,userName:t.nickName,role:t.role})})),this.Bn=this.Bn&&this.Bn.concat(s).filter((function(t){return!r.some((function(i){return i.userID==t.userID}))})),0!==s.length&&this.onUserStateUpdate(this.Ri.roomID,"ADD",s),0!==r.length&&this.onUserStateUpdate(this.Ri.roomID,"DELETE",r),this.Ti.actionListener("_userStateUpdate",this.Ri.roomID,e)},t.prototype.Zn=function(){var t=this,i=Object.keys(this.Vn).map((function(t){return+t})).sort((function(t,i){return t-i}));if(i[i.length-1]-i[0]+1===i.length||i[i.length-1]>=this.$n)this.se(i);else{this.Vn=null;var n=this.Kn-Date.now();this.ei.info("zm.us.mto  fetch merge userlist "+this.jn+" userSeqList "+i.join(",")+" wait "+n),n>0?(this.Qn&&clearTimeout(this.Qn),this.Qn=setTimeout((function(){t.Wn()}),n)):this.Wn()}},t}(),yr=function(){function t(t,i,n,e,s,r){this.roomID=t,this.Ti=i,this.ei=n,this.dataReport=e,this.rtm=s,this.zi=r,this.runState=x.logout,this.lastRunState=x.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomReasonState=as.Logout,this.roomSessionID="0",this.sessionID="0",this.longSid=null,this.longRoomSid=null,this.isMulti=!1,this.token="",this.thirdToken="",this.loginTime=0,this.userStateUpdate=!1,this.maxMemberCount=0,this.roomName="",this.isCancelLogin=!1,this.roomHandler=new br(this.ei,this.Ti,this.dataReport,this,r),this.heartBeatHandler=new cr(this.ei,this.Ti,this.dataReport,this.zi,this),this.userHandler=new Sr(this.ei,this.Ti,this.dataReport,this.zi,this),this.initMessageHandler(),this.initLiveHandler(),this.init()}return Object.defineProperty(t.prototype,"logger",{get:function(){return this.ei},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateCenter",{get:function(){return this.Ti},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"liveRoomHandler",{get:function(){return this.zi},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sessionExist",{get:function(){return null!==this.longSid||"0"!==this.sessionID},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roomSidString",{get:function(){return this.longRoomSid?this.longRoomSid.toString():"0"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userSidString",{get:function(){return this.longSid?this.longSid.toString():"0"},enumerable:!1,configurable:!0}),t.prototype.initMessageHandler=function(){},t.prototype.initLiveHandler=function(){},t.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},t.prototype.bindHeatBeatHandler=function(){var t=this;this.heartBeatHandler.hbLogout=function(i){t.roomHandler.handleHbLogout(i)},this.heartBeatHandler.heartbeatRspNotiFy=function(i,n){t.messageHandler&&t.messageHandler.loginRsp(i),t.userHandler.patchUserList(i),t._HBResponse(i,n)}},t.prototype.bindRoomHandler=function(){var t=this;this.roomHandler.loginSuccessCallBack=function(i,n){t.ei.info("zm.lrm.brh login suc "+i),t.heartBeatHandler.init(n),t.zi.startCheck(),t.userHandler.loginRsp(n,i),t.messageHandler&&t.messageHandler.loginRsp(n),t.isMulti||t.re(),t.oe(n)},this.roomHandler.resetRoomCallBack=function(){t.heartBeatHandler.resetHeartbeat(),t.liveHandler&&t.liveHandler.resetLiveHandler(),t.messageHandler&&t.messageHandler.resetMessageInfo(),t.zi&&t.zi.stopCheck(),t.userHandler.resetUserHandler(),t.roomTryHandler&&(t.roomTryHandler.invalid(),t.roomTryHandler.stopMaxTime())}},t.prototype.bindUserHandler=function(){},t.prototype.bindMessageHandler=function(){},t.prototype.bindLiveHandler=function(){},t.prototype._HBResponse=function(t,i){this.Ti.actionListener("HBResponse",t,i)},t.prototype.oe=function(t){this.Ti.actionListener("roomLoginResponse",t)},t.prototype.checkRoomSession=function(t){return null!==this.longRoomSid&&this.longRoomSid.eq(t)},t.prototype.re=function(){this.Ti.roomModulesList.forEach((function(t){var i=t.roomTryHandler;t.runState!==x.login&&i&&1==t.isMulti&&(i.onactive=function(i,n){if(n&&0!==n.code){var e=je(n.code);e&&J[e]&&(n=J[e]),t.roomHandler._roomStateHandle("DISCONNECTED",as.ReconnectFailed,n,n.msg)}else t.roomHandler._roomStateHandle("CONNECTED",as.Reconnected,n)},i.retryLoginRoom())}))},t.prototype.isLogin=function(){return this.runState===x.login},t.prototype.isLogout=function(){return this.runState===x.logout},t.prototype.isTryLogin=function(){return this.runState===x.trylogin},t.prototype.isDisConnect=function(){return this.zi.isDisConnect()},t.prototype.retryConnect=function(){this.ei.info("zm.lrm.rc call"),this.resetSessionInfo(),this.zi.closeRequest()},t.prototype.retryRoom=function(t,i){void 0===t&&(t=!1),void 0===i&&(i=!1),this.ei.info("zm.lrm.rr.0 call retryNow:".concat(t,", resetSession:").concat(i));var n=this.roomTryHandler;n&&this.rtm.isUaConnect&&n.retryLoginRoom(t,i)},t.prototype.resetSessionInfo=function(){var t;this.ei.info("zm.lrm.rsi call"),this.resetRoomSession(),this.resetUserSession(),null===(t=this.zi)||void 0===t||t.reset()},t.prototype.resetRoomSession=function(){this.roomSessionID="0",this.longRoomSid=null},t.prototype.resetUserSession=function(){this.sessionID="0",this.longSid=null},t}(),Tr=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},Rr=["relogin_token"],wr=["id_name","nick_name"],Or=Tr(Tr(["stream_id"],wr,!0),["extra_info","title","stream_attr","stream_title"],!1),Ir=["trans_type"],Nr=["trans_channel"],Cr=Tr([],wr,!0),kr=Tr(["trans_type"],Nr,!0),Dr=Tr([],Nr,!0),zr=Tr(["trans_type","trans_data"],wr,!0),Ar=Tr([],Nr,!0),Pr=Tr([],zr,!0),Mr=Tr([],wr,!0),xr=["id_name","custom_reason"],Ur=["stream_id_list"],qr=Tr([],Or,!0),Lr=Tr(Tr([],wr,!0),["msg_content"],!1),Gr=Tr(Tr([],wr,!0),["msg_id","msg_content"],!1),Hr=Tr(Tr([],wr,!0),["trans_type","trans_data","trans_channel"],!1),jr=Tr(Tr([],wr,!0),Nr,!0),$r=["trans_type","trans_data"],Br=__webpack_require__(946);const Vr=__webpack_require__(570);Br.util.Long=Vr,Br.util.Long.fromBits=Br.util.Long?Br.util.Long.fromBits:function(){return 0};for(var Jr=Br.roots,Fr=Br.types?Br.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},Yr=Br.types?Br.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},Wr=Object.keys(Fr),Xr={$:function(t){return Xr[t]?Xr[t].call(this):Jr[t].decode?Jr[t].decode(this,this.uint32()):Xr.$.call(this,"int32")}},Zr={$:function(t,i,n){var e=Fr[t];return void 0===e?Jr[t].encode?(this.uint32(n<<3|2).fork(),Jr[t].encode(i,this).ldelim()):Zr.$.call(this,"int32",i,n):Zr[t].call(this.uint32(n<<3|e),i)}},Kr=0;Kr<Wr.length;Kr++)Xr[Wr[Kr]]=Br.Reader.prototype[Wr[Kr]],Zr[Wr[Kr]]=Br.Writer.prototype[Wr[Kr]];!function t(i,n,e,s){for(var r=0,o=Object.keys(i);r<o.length;r++){var u=o[r];if(i[u].$m&&Object.keys(i[u].$m).every((function(t){return Number(t)}))){if(e[u])throw Error(`nested type ${e}.${u} has already exist`);e[u]=function(i,e){function s(t){for(var n in i){var e=i[n];"{"===e[1].charAt(0)?this[e[0]]={}:"["!==e[1].charAt(0)&&"<"!==e[1].charAt(0)||(this[e[0]]=[])}if(t)for(var s=Object.keys(t),r=0;r<s.length;++r)null!=t[s[r]]&&(this[s[r]]=t[s[r]])}var r={};for(var o in i){var u=i[o],h=u[1];"{"===h.charAt(0)?(s.prototype[u[0]]=Br.util.emptyObject,r[h]={$m:h.substring(1).split(",").map((function(t,i){return[`$${i+1}`,t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):s.prototype[u[0]]="["===h.charAt(0)||"<"===h.charAt(0)?Br.util.emptyArray:"bytes"===h?Br.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?Br.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof Br.Reader||(t=Br.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32(),u=o>>>3;if(u>0&&i[u]){var h=i[u][0],a=i[u][1];if("{"===a.charAt(0)){r[h]===Br.util.emptyObject&&(r[h]={});var c=s.$namespace[a].decode(t,t.uint32());r[h][c.$1]=c.$2}else if("["===a.charAt(0)||"<"===a.charAt(0)){a=a.substring(1),r[h]&&r[h].length||(r[h]=[]);if(void 0!==Yr[a=!Xr[a]&&!Jr[a].decode?"int32":a]&&2==(7&o))for(var l=t.uint32()+t.pos;t.pos<l;)r[h].push(Xr.$.call(t,a));else r[h].push(Xr.$.call(t,a))}else r[h]=Xr.$.call(t,a)}else t.skipType(7&o)}return r},s.encode=function(t,n){for(var e in n||(n=Br.Writer.create()),i){var r=i[e][0],o=i[e][1];if("{"===o.charAt(0)){if(null!=t[r]&&t.hasOwnProperty(r))for(var u=0,h=Object.keys(t[r]);u<h.length;++u)n.uint32(e<<3|2).fork(),s.$namespace[o].encode({$1:h[u],$2:t[r][h[u]]},n).ldelim()}else if("["===o.charAt(0)||"<"===o.charAt(0)){var a="<"===o.charAt(0);o=o.substring(1);var c=t[r];if(null!=c&&c.length){if(o=void 0===Fr[o]&&!Jr[o].encode?"int32":o,a&&void 0!==Yr[o]){n.uint32(e<<3|2).fork();for(u=0;u<c.length;u++)Zr[o].call(n,c[u]);n.ldelim()}else for(u=0;u<c.length;u++)Zr.$.call(n,o,c[u],e)}}else null!=t[r]&&t.hasOwnProperty(r)&&Zr.$.call(n,o,t[r],e)}return n},Object.keys(r).length&&(s.$namespace=t(r,n+"."+e,s.$namespace||{},!0)),s}(i[u].$m,u)}else i[u].$s?e[u]=function(t,i){function e(t,i,n){Br.rpc.Service.call(this,t,i,n)}return(e.prototype=Object.create(Br.rpc.Service.prototype)).constructor=e,e.create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){var r=t[s];function o(t,i){return this.rpcCall(o,Jr[r[0]],Jr[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:`${n}.${i}`}),e.prototype[s]=o})),e}(i[u].$s,u):i[u].$e&&Object.values(i[u].$e).every((function(t){return Number(t)===t}))&&(e[u]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[u].$e));e[u]&&!s&&(Jr[`${n}.${u}`]=e[u]),delete i[u].$m,delete i[u].$s,delete i[u].$e,e[u]=t(i[u],n?`${n}.${u}`:u,e[u]||{})}return e}({mini:{liveroom_cs_v3:{AddStreamReq:{$m:{1:["stream_id","bytes",[]],2:["stream_title","bytes",[]],3:["stream_type","uint32",0],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["third_token","bytes",[]],8:["censor_mode","uint32",0],9:["need_gather","uint32",0],10:["sdk_custom_info","bytes",[]],11:["stream_attr_opts","mini.liveroom_cs_v3.StreamAttrOptions",null]}},AddStreamRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_sid","string",""],4:["stream_ver","uint32",0],5:["stream_nid","uint32",0],6:["token_remain_time","uint32",0]}},AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},BigImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","bytes",[]],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}]}},Capabilities:{$m:{1:["video_codec","uint32",0],2:["gop_mode","uint32",0]}},CommonRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},DeleteStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["client_req_seq","uint32",0]}},DeleteStreamRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},EnterRoomReq:{$m:{1:["net_type","uint32",0],2:["conn_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["third_token","bytes",[]],7:["room_create_flag","uint32",0],8:["user_state_flag","uint32",0],9:["user_count_limit","uint32",0],10:["relate_service","string",""],11:["need_gather_stream","uint32",0],12:["callback_data","bytes",[]],13:["service_flags","uint32",0],14:["license_token","bytes",[]],15:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],16:["capabilities","mini.liveroom_cs_v3.Capabilities",null]}},EnterRoomRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["user_id","uint64",{low:0,high:0,unsigned:!0}],5:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],6:["big_im_time_window","uint32",0],7:["liveroom_hb_interval","uint32",0],8:["liveroom_hb_timeout","uint32",0],9:["online_count","uint32",0],10:["anchor_info","mini.liveroom_cs_v3.AnchorInfo",null],11:["userlist_merge_timeout","uint32",0],12:["userlist_interval","uint32",0],13:["token_remain_time","uint32",0],14:["trans_list_seq","uint32",0],15:["trans_channel_list","<mini.liveroom_cs_v3.TransChannel",null],16:["stream_count","uint32",0],17:["stream_list_seq","uint32",0],18:["stream_info_list","<mini.liveroom_cs_v3.StreamInfo",null],19:["stream_fetch_flag","uint32",0],20:["stream_list_push_merge_timeout","uint32",0],21:["stream_list_hb_merge_timeout","uint32",0],22:["relate_result_list","<mini.liveroom_cs_v3.RelateResult",null],23:["gather_list_seq","uint32",0],24:["gather_info_list","<mini.liveroom_cs_v3.GatherInfo",null]}},EnumSignalTransmitResult:{$e:{ok:0,version_err:1}},EnumSignalTransparentMsgType:{$e:{SignalTransparentMsgTypeSDK:0,SignalTransparentMsgTypeServer:1,SignalTransparentMsgTypeBoth:2}},GatherInfo:{$m:{1:["gather_id","string",""]}},GetCapabilityReq:{$m:{}},GetCapabilityRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["capability_seq","int64",{low:0,high:0,unsigned:!1}],3:["capabilities","mini.liveroom_cs_v3.Capabilities",null]}},GetGatherListReq:{$m:{}},GetGatherListRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["gather_list_seq","uint32",0],3:["gather_info_list","<mini.liveroom_cs_v3.GatherInfo",null]}},GetImReq:{$m:{1:["msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["sort_type","uint32",0],3:["msg_count","uint32",0]}},GetImRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],3:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<mini.liveroom_cs_v3.GetImRspImData",null]}},GetImRspImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},GetStreamListReq:{$m:{}},GetStreamListRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["stream_list_seq","uint32",0],3:["stream_info_list","<mini.liveroom_cs_v3.StreamInfo",null],4:["stream_refresh","uint32",0]}},GetTransReq:{$m:{1:["trans_channel","bytes",[]],2:["trans_list","<mini.liveroom_cs_v3.GetTransReqTransData",null]}},GetTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetTransRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["trans_list_seq","uint32",0],4:["trans_list","<mini.liveroom_cs_v3.GetTransRspTransData",null]}},GetTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},GetUserlistReq:{$m:{1:["sort_type","uint32",0],2:["user_index","uint32",0]}},GetUserlistRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["server_user_seq","uint64",{low:0,high:0,unsigned:!0}],3:["server_user_index","int64",{low:0,high:0,unsigned:!1}],4:["ret_user_index","int64",{low:0,high:0,unsigned:!1}],5:["user_base_info_list","<mini.liveroom_cs_v3.UserBaseInfo",null]}},GetUserTransReq:{$m:{1:["trans_channel","bytes",[]],2:["user_trans_list","<mini.liveroom_cs_v3.GetUserTransReqTransData",null]}},GetUserTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetUserTransRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["user_trans_list","<mini.liveroom_cs_v3.GetUserTransRspTransData",null]}},GetUserTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},HbReq:{$m:{}},HbRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],3:["hb_interval","uint32",0],4:["hb_timeout","uint32",0],5:["stream_seq","uint32",0],6:["user_seq","int64",{low:0,high:0,unsigned:!1}],7:["online_count","uint32",0],8:["big_im_time_window","uint32",0],9:["trans_channel_list","<mini.liveroom_cs_v3.TransChannel",null],10:["user_trans_channel_list","<mini.liveroom_cs_v3.TransChannel",null],11:["stream_refresh","uint32",0],12:["trans_list_seq","uint32",0],13:["gather_list_seq","uint32",0],14:["capability_seq","int64",{low:0,high:0,unsigned:!1}]}},ImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},LiveroomSessionInfo:{$m:{1:["RoomId","bytes",[]],2:["UserSessionId","uint64",{low:0,high:0,unsigned:!0}],3:["RoomSessionId","uint64",{low:0,high:0,unsigned:!0}],4:["Role","uint32",0]}},PushBigIm:{$m:{1:["msg_list","<mini.liveroom_cs_v3.BigImData",null]}},PushCapabilityChange:{$m:{1:["capability_seq","int64",{low:0,high:0,unsigned:!1}],2:["capabilities","mini.liveroom_cs_v3.Capabilities",null]}},PushIm:{$m:{1:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<mini.liveroom_cs_v3.ImData",null]}},PushStartGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStopGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStream:{$m:{1:["stream_seq","uint32",0],2:["stream_info_list","<mini.liveroom_cs_v3.PushStreamInfo",null]}},PushStreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["stream_src","uint32",0],9:["stream_state","uint32",0],10:["stream_type","uint32",0],11:["stream_nid","uint32",0],12:["extra_info","bytes",[]],13:["create_time","int64",{low:0,high:0,unsigned:!1}],14:["close_type","uint32",0],15:["need_gather","uint32",0],16:["sdk_custom_info","bytes",[]],17:["stream_attr_opts","mini.liveroom_cs_v3.StreamAttrOptions",null]}},PushTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_type","bytes",[]],5:["trans_data","bytes",[]],6:["trans_seq","uint32",0],7:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],8:["trans_channel","bytes",[]],9:["trans_list_seq","uint32",0]}},PushTransparentMsg:{$m:{1:["msg_data","bytes",[]],2:["client_seq","uint64",{low:0,high:0,unsigned:!0}],3:["sender_idname","bytes",[]],4:["sender_nickname","bytes",[]]}},PushUserInfoUpdated:{$m:{1:["server_user_seq","int64",{low:0,high:0,unsigned:!1}],2:["user_action_list","<mini.liveroom_cs_v3.UserAction",null]}},PushUserKickout:{$m:{1:["id_name","bytes",[]],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["kickout_reason","int32",0],4:["custom_reason","bytes",[]]}},PushUserLogReport:{$m:{}},PushUserTokenExpire:{$m:{1:["token","string",""],2:["stop_stream_info","mini.liveroom_cs_v3.StopStream",null]}},PushUserTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_channel","bytes",[]],6:["trans_seq_list","<mini.liveroom_cs_v3.PushUserTransInfo",null]}},PushUserTransInfo:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_seq","uint32",0]}},QuitRoomReq:{$m:{}},QuitRoomRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RenewTokenReq:{$m:{1:["token","string",""]}},RenewTokenRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["token_remain_time","uint32",0],3:["stop_stream_id_list","<bytes",null]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SendBigImReq:{$m:{1:["msg_list","<mini.liveroom_cs_v3.SendBigImReqMsgData",null]}},SendBigImReqMsgData:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}],5:["msg_client_id","bytes",[]]}},SendBigImRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["big_im_time_window","uint32",0],3:["msg_list","<mini.liveroom_cs_v3.SendBigImRspMsgData",null]}},SendBigImRspMsgData:{$m:{1:["msg_id","bytes",[]],2:["msg_client_id","bytes",[]]}},SendImReq:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["to_user_list","<mini.liveroom_cs_v3.ToUser",null]}},SendImRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["msg_id","uint64",{low:0,high:0,unsigned:!0}]}},SetTransReq:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_local_seq","uint32",0],4:["trans_channel","bytes",[]]}},SetTransRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["trans_type","bytes",[]],3:["trans_seq","uint32",0],4:["trans_list_seq","uint32",0],5:["trans_channel","bytes",[]]}},SetUserAttrReq:{$m:{1:["use_data_channel","uint32",0],2:["is_modify_use_data_channel","bool",!1],3:["user_type","uint32",0],4:["is_modify_user_type","bool",!1]}},SetUserAttrRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},SignalLiveCustomReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<mini.liveroom_cs_v3.ToUser",null]}},SignalLiveCustomRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},SignalLiveInviteReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<mini.liveroom_cs_v3.ToUser",null]}},SignalLiveInviteRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},SignalLiveRequestReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<mini.liveroom_cs_v3.ToUser",null]}},SignalLiveRequestRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},SignalLiveResultReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<mini.liveroom_cs_v3.ToUser",null]}},SignalLiveResultRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},SignalLiveStopReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<mini.liveroom_cs_v3.ToUser",null]}},SignalLiveStopRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},SignalTransmitReq:{$m:{1:["to_user_list","<bytes",null],2:["transmit_data","bytes",[]]}},SignalTransmitResult:{$m:{1:["to_user","bytes",[]],2:["result","mini.liveroom_cs_v3.EnumSignalTransmitResult",0]}},SignalTransmitRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["result","<mini.liveroom_cs_v3.SignalTransmitResult",null]}},SignalTransparentMsgReq:{$m:{1:["msg_type","mini.liveroom_cs_v3.EnumSignalTransparentMsgType",0],2:["msg_data","bytes",[]],3:["to_user_list","<bytes",null],4:["client_seq","uint64",{low:0,high:0,unsigned:!0}]}},SignalTransparentMsgRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null]}},StopStream:{$m:{1:["stream_id_list","<bytes",null]}},StreamAttrOptions:{$m:{1:["stream_resource","sint32",0],2:["stream_codec","sint32",0],3:["play_mode","uint32",0],4:["forbid_play_expire_time","int64",{low:0,high:0,unsigned:!1}],5:["censor_flag","int32",0]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["create_time","int64",{low:0,high:0,unsigned:!1}],9:["stream_src","uint32",0],10:["stream_state","uint32",0],11:["stream_type","uint32",0],12:["stream_nid","uint32",0],13:["extra_info","bytes",[]],14:["need_gather","uint32",0],15:["sdk_custom_info","bytes",[]],16:["stream_attr_opts","mini.liveroom_cs_v3.StreamAttrOptions",null]}},ToUser:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}]}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<mini.liveroom_cs_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}},UpdateStreamAttrReq:{$m:{1:["stream_id","bytes",[]],2:["client_req_seq","uint32",0],3:["update_flag","uint32",0],4:["sdk_custom_info","bytes",[]],5:["stream_attr_opts","mini.liveroom_cs_v3.StreamAttrOptions",null]}},UpdateStreamAttrRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0]}},UpdateStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["stream_title","bytes",[]],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["nick_name","bytes",[]]}},UpdateStreamRsp:{$m:{1:["rsp_head","mini.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},UserAction:{$m:{1:["action","uint32",0],2:["id_name","bytes",[]],3:["nick_name","bytes",[]],4:["role","uint32",0],5:["login_time","int64",{low:0,high:0,unsigned:!1}]}},UserBaseInfo:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0]}}},proto_switch_v3:{AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},Capabilities:{$m:{1:["video_codec","uint32",0],2:["gop_mode","uint32",0]}},CommonRsp:{$m:{1:["rsp_head","mini.proto_switch_v3.RspHead",null]}},GatherInfo:{$m:{1:["gather_id","string",""]}},Header:{$m:{1:["cmd","uint32",0],2:["seq","uint32",0],3:["timestamp","int64",{low:0,high:0,unsigned:!1}],4:["controls","bytes",[]],5:["flags","bytes",[]],6:["context_key","uint32",0],101:["dev_traffic_label","bytes",[]]}},LiveroomProtoVersion:{$e:{PROTO_VERSION_NONE:0,RPOTO_V020000:131072}},LoginRoomReq:{$m:{1:["app_id","uint32",0],2:["biz_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["device_id","string",""],9:["term_type","mini.proto_switch_v3.TermType",0],10:["net_type","mini.proto_switch_v3.NetType",0],11:["sdk_conn_type","mini.proto_switch_v3.SdkConnType",0],12:["sdk_version","uint32",0],13:["biz_version","string",""],14:["client_stamp","bytes",[]],15:["login_logic","uint32",0],16:["third_token","bytes",[]],17:["login_token","bytes",[]],18:["relogin_token","bytes",[]],19:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],20:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],21:["room_create_flag","uint32",0],22:["user_state_flag","uint32",0],23:["user_count_limit","uint32",0],24:["relate_service","string",""],25:["need_gather_stream","uint32",0],26:["callback_data","bytes",[]],27:["service_flags","uint32",0],28:["license_token","bytes",[]],29:["relogin_type","mini.proto_switch_v3.ReloginType",0],30:["Capabilities","mini.proto_switch_v3.Capabilities",null]}},LoginRoomRsp:{$m:{1:["rsp_head","mini.proto_switch_v3.RspHead",null],2:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],5:["user_id","uint64",{low:0,high:0,unsigned:!0}],6:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],7:["big_im_time_window","uint32",0],8:["liveroom_hb_interval","uint32",0],9:["liveroom_hb_timeout","uint32",0],10:["online_count","uint32",0],11:["anchor_info","mini.proto_switch_v3.AnchorInfo",null],12:["relogin_token","bytes",[]],13:["userlist_merge_timeout","uint32",0],14:["userlist_interval","uint32",0],15:["token_remain_time","uint32",0],16:["trans_list_seq","uint32",0],17:["trans_channel_list","<mini.proto_switch_v3.TransChannel",null],18:["stream_count","uint32",0],19:["stream_list_seq","uint32",0],20:["stream_info_list","<mini.proto_switch_v3.StreamInfo",null],21:["stream_fetch_flag","uint32",0],22:["stream_list_push_merge_timeout","uint32",0],23:["stream_list_hb_merge_timeout","uint32",0],24:["relate_result_list","<mini.proto_switch_v3.RelateResult",null],25:["gather_list_seq","uint32",0],26:["gather_info_list","<mini.proto_switch_v3.GatherInfo",null]}},LogoutRoomReq:{$m:{2:["logout_check","bytes",[]]}},LogoutRoomRsp:{$m:{1:["rsp_head","mini.proto_switch_v3.RspHead",null]}},MergePushHead:{$m:{1:["qos_flag","uint32",0],2:["send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0],3:["msg_body","bytes",[]]}},MergePushReq:{$m:{1:["head","mini.proto_switch_v3.MergePushHead",null],2:["message_list","<mini.proto_switch_v3.MergePushInfo",null]}},MergePushRsp:{$m:{1:["message_list","<mini.proto_switch_v3.MergePushRspInfo",null],2:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushRspInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0]}},NetType:{$e:{NT_NONE:0,NT_LINE:1,NT_WIFI:2,NT_2G:3,NT_3G:4,NT_4G:5,NT_UNKNOWN:32}},PushKickout:{$m:{1:["reason","uint32",0],2:["message","string",""],3:["is_need_relogin","uint32",0]}},PushReq:{$m:{1:["head","mini.proto_switch_v3.PushReqHead",null],2:["msg_body","bytes",[]]}},PushReqHead:{$m:{1:["sub_cmd","uint32",0],2:["qos_flag","uint32",0],3:["send_time","int64",{low:0,high:0,unsigned:!1}]}},PushRsp:{$m:{1:["code","uint32",0],2:["message","string",""],3:["sub_cmd","uint32",0],4:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},ReloginType:{$e:{ReloginType_None:0,ReloginType_SdkAuto:1}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SdkConnType:{$e:{SdkConnType_None:0,SdkConnType_Tcp:1,SdkConnType_Websocket:2}},StreamAttrOptions:{$m:{1:["stream_resource","sint32",0],2:["stream_codec","sint32",0],3:["play_mode","uint32",0],4:["forbid_play_expire_time","int64",{low:0,high:0,unsigned:!1}],5:["censor_flag","int32",0]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["create_time","int64",{low:0,high:0,unsigned:!1}],6:["extra_info","bytes",[]],7:["title","bytes",[]],8:["stream_ver","uint32",0],9:["stream_attr","bytes",[]],10:["stream_src","uint32",0],11:["stream_state","uint32",0],12:["stream_type","uint32",0],13:["stream_nid","uint32",0],14:["need_gather","uint32",0],15:["sdk_custom_info","bytes",[]],16:["stream_attr_opts","mini.proto_switch_v3.StreamAttrOptions",null]}},TermType:{$e:{TT_NONE:0,TT_PC:1,TT_IOS:2,TT_ANDROID:3,TT_MAC:4,TT_LINUX:5,TT_WEB:6,TT_MINI_PROGRAM:7,TT_UNKNOWN:32}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<mini.proto_switch_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}}}}},"",Jr,!1);const Qr=Jr.mini;var to,io,no,eo=[[1001,"LoginRoomReq"],[1002,"LoginRoomRsp"],[1003,"LogoutRoomReq"],[1004,"LogoutRoomRsp"],[1101,"PushReq"],[1102,"PushRsp"],[1103,"MergePushReq"],[1104,"MergePushRsp"],[1105,"PushKickout"],[10001,"PushUserInfoUpdated"],[10002,"PushUserKickout"],[10003,"PushUserLogReport"],[10004,"PushUserTokenExpire"],[11005,"PushSignalCustom"],[11001,"PushJoinliveRequest"],[11002,"PushJoinliveResult"],[11003,"PushJoinliveInvite"],[11004,"PushJoinliveStop"],[12001,"PushStreamAdd"],[12002,"PushStreamDelete"],[12003,"PushStreamUpdate"],[13001,"PushIm"],[14001,"PushBigIm"],[15001,"PushTrans"],[15002,"PushUserTrans"],[301001,"EnterRoomReq"],[301002,"EnterRoomRsp"],[301003,"QuitRoomReq"],[301004,"QuitRoomRsp"],[301005,"HbReq"],[301006,"HbRsp"],[301007,"RenewTokenReq"],[301008,"RenewTokenRsp"],[301009,"SetUserAttrReq"],[301010,"SetUserAttrRsp"],[301011,"SetTransReq"],[301012,"SetTransRsp"],[301013,"GetTransReq"],[301014,"GetTransRsp"],[301015,"GetUserTransReq"],[301016,"GetUserTransRsp"],[302001,"AddStreamReq"],[302002,"AddStreamRsp"],[302003,"DeleteStreamReq"],[302004,"DeleteStreamRsp"],[302005,"UpdateStreamReq"],[302006,"UpdateStreamRsp"],[302007,"GetStreamListReq"],[302008,"GetStreamListRsp"],[303001,"SendImReq"],[303002,"SendImRsp"],[303003,"GetImReq"],[303004,"GetImRsp"],[303005,"SendBigImReq"],[303006,"SendBigImRsp"],[303009,"SignalLiveRequestReq"],[303010,"SignalLiveRequestRsp"],[303011,"SignalLiveResultReq"],[303012,"SignalLiveResultRsp"],[303013,"SignalLiveInviteReq"],[303014,"SignalLiveInviteRsp"],[303015,"SignalLiveStopReq"],[303016,"SignalLiveStopRsp"],[303017,"SignalLiveCustomReq"],[303018,"SignalLiveCustomRsp"],[303019,"SignalTransmitReq"],[303020,"SignalTransmitRsp"],[304001,"GetUserlistReq"],[304002,"GetUserlistRsp"]],so=eo.reduce((function(t,i){var n=i[0];return t[n]=[12001,12002,12003].includes(n)?"PushStream":i[1],t}),{}),ro=eo.reduce((function(t,i){return t[i[1]]=i[0],t}),{}),oo=__webpack_require__(946),uo=__webpack_require__(440),ho=__webpack_require__.n(uo),ao=__webpack_require__(636),co=__webpack_require__.n(ao),lo=function(){function t(){}return t.prototype.md5Bytes=function(t){return this.wordArray2Uint8Array(co()(this.uint8Array2WordArray(t)))},t.prototype.wordArray2Uint8Array=function(t){for(var i=t.words,n=t.sigBytes,e=new Uint8Array(n),s=0;s<n;s++){e[s]=i[s>>>2]>>>24-s%4*8&255}return e},t.prototype.uint8Array2WordArray=function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t[e])<<24-e%4*8;return ho().create(n,i)},t}(),fo=function(){return fo=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},fo.apply(this,arguments)},_o=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},vo=__webpack_require__(570);oo.util.Long=vo,oo.configure(),to=Qr,io=Qr.liveroom_cs_v3,no=Qr.proto_switch_v3;var mo,po=1001,go=1002,bo=1003,Eo=1004;!function(t){t[t.disconnected=0]="disconnected",t[t.broken=1]="broken",t[t.connected=2]="connected"}(mo||(mo={}));var So=function(){function t(t,i,n,e,s){var r,o,u,h,a,c,l,f,d=this;this.ei=t,this.Ti=i,this._ua=n,this._dataReport=e,this.rtm=s,this.seq=0,this.ue=new Ki,this.he={},this.ae="",this.zPushSid="0",this.ce=[["user_session_id","session_id"],["liveroom_hb_interval","hearbeat_interval"],["liveroom_hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"],["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]],this.fe=100,this.de=1e4,this._e=2e3,this.ve=to,this.me={},this.pe={},this.be={},this.Ee=[ro.PushReq,ro.MergePushReq,ro.PushKickout],this.Se=[ro.LoginRoomRsp,ro.LogoutRoomRsp,ro.PushKickout,ro.PushReq,ro.MergePushReq],this.ye=[1105],this.Te=mo.disconnected,this.Re=[11001,11002,11003,11004],this.we="",this.Oe=new lo,this.Ie=this._ua.getPCRequest(V.BusinessService.SERVICE_SWITCH4LIVEROOM),this.switchSessionID=vo.fromInt(0),null===(r=this.Ie)||void 0===r||r.on("connected",(function(t){d.Ne(t)})),null===(o=this.Ie)||void 0===o||o.on("broken",(function(t){d.Ce()})),null===(u=this.Ie)||void 0===u||u.on("disconnected",(function(t,i){d.ke(t,i)})),null===(h=this.Ie)||void 0===h||h.on("downLoadMessage",(function(t,i){d.handlePush(t,i)})),null===(a=this.Ie)||void 0===a||a.on("exception",(function(t,i){d.ei.info("zm.lrh.o.0 except "+JSON.stringify(t))})),null===(c=this.Ie)||void 0===c||c.on("pcBrokenEvent",(function(t){var i=Vt,n=d.Ci.createSpan(U.H,{key:Ct},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null===(l=this.Ie)||void 0===l||l.on("pcDisconnectedEvent",(function(t){var i=Jt,n=d.Ci.createSpan(U.H,{key:Ct},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null===(f=this.Ie)||void 0===f||f.on("pcConnectedEvent",(function(t){var i=Bt,n=d.Ci.createSpan(U.H,{key:Ct},{key:""},i.event);n.setAttributes({service_no:i.service_no(t.service_no),recv_time:i.recv_time((new Date).getTime()),proxy_link_sources:i.proxy_link_sources(t.proxy_link_sources),connect_stream:i.connect_stream(t.connect_stream)}),n.end()}))}return Object.defineProperty(t.prototype,"nickName",{get:function(){return _r(this.Ti.nickName)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TermType",{get:function(){return this.Ti.ENV%2==0?A.TT_WEB:A.TT_MINIPROGRAM},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),t.prototype.isDisConnect=function(){return this.Te!==mo.connected},t.prototype.getHeader=function(t,i){var n={cmd:t,seq:++this.seq,timestamp:(new Date).getTime()};this.De&&(n.controls=this.De),(null==i?void 0:i.contextKey)&&(n.context_key=null==i?void 0:i.contextKey);var e=no.Header.create(n),s=no.Header.encode(e).finish();return[n.seq,s]},Object.defineProperty(t.prototype,"isUaConnect",{get:function(){return this._ua.isConnect()},enumerable:!1,configurable:!0}),t.prototype.sendMessage=function(t,i,n,e,s,r,o){var u,h,a,c=this;if(void 0===r&&(r={timeout:6e3}),void 0===o&&(o=!0),this.ei.info(Vs+" call"),"LoginRoomReq"!==t&&this.Te!==mo.connected)return this.ei.warn(Vs+" state "+this.Te),e&&e(J.SOCKET_CLOSE),-1;if(dn(t))a=t;else if(mn(a=ro[t]))return this.ei.warn(Vs+" cmd not found "+t+" "+JSON.stringify(ro)),-1;var l,f=0;l=mn(null==s?void 0:s.roomID)?null===(u=this.Ti.roomModulesList[0])||void 0===u?void 0:u.roomID:null==s?void 0:s.roomID,"LoginRoomReq"!==t&&l&&(f=this.pe[l]);var d=this.getHeader(a,{contextKey:f}),_=d[1],v=i,m=this.getHead(_.length,v.length),p=new Uint8Array(Array.from(m).concat(Array.from(_)).concat(Array.from(v)));if(o){var g={seq:this.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeout:r.timeout,success:n,error:function(t,i,n){var s;c.ei.info(Vs+" error "+i+" "+JSON.stringify(t)+" "+JSON.stringify(n));var r=null==t?void 0:t.body,o=null==r?void 0:r.err_code,u=null===(s=null==t?void 0:t.header)||void 0===s?void 0:s.cmd,h=null==n?void 0:n.roomID;if(u!==ro.LoginRoomRsp){var a=c.Ti.roomModulesList.find((function(t){return t.roomID==h}));if([1002,105].indexOf(o)>-1)return u===ro.EnterRoomRsp&&a?a?void a.retryRoom(!1,!0):void c.ei.error(Vs+" room no found ignore "):void c.rtm.retryRoom(!1,void 0,!0);if([141].includes(o)&&a)return void a.roomHandler.logoutByError({code:o,msg:null==r?void 0:r.err_message})}e&&e(t,i)},params:s},b=this.ue.push(g);this.he[g.seq]=b}this.ei.info(Vs+" seq: "+d[0]+" cmd: "+t);return null===(h=this.Ie)||void 0===h||h.sendRequest({payload:p,ack:"LoginRoomReq"===t},(function(t){c.ei.info(Vs+" fail")}),(function(){c.ei.info(Vs+" ack")}),{}),d[0]},t.prototype.getHead=function(t,i){var n=new Uint8Array(7);return n[0]=49,n[1]=t>>8,n[2]=t-(n[1]<<8),n.set(new Uint8Array(Int32Array.from([i]).buffer).reverse(),3),n},t.prototype.handlePush=function(t,i){if(!(49!==t[0]||t.length<7)){var n=(t[1]<<8)+t[2],e=no.Header.decode(t.slice(7,7+n)),s=t.slice(7+n),r=s,o=(t[3]<<24)+(t[4]<<16)+(t[5]<<8)+t[6];if(o!=s.length&&this.ei.warn(Fs+" body len ".concat(o," != ").concat(s.length)),!so[e.cmd])return this.ei.info(Js+" cmd is not rtc"),void this.onSwitchMessage(e,r);var u=this.decodeResponseBody(e,r);if(this.Ee.includes(e.cmd))this.handleSwitchPush(e,u);else{this.ei.info(Js+" down "+(so[e.cmd]||e.cmd)+" "+JSON.stringify(this.ze(u)));var h={header:this.transHeader(e),body:this.transRsp(u)},a=this.me[e.context_key];mn(a)||(h.header.room_id=a),this.handleSendCommandMsgRsp(h)}}},t.prototype.handleSwitchPush=function(t,i){var n,e,s,r,o=this,u=t.context_key,h=this.me[u];if(h||this.ye.includes(t.cmd)){if(t.cmd===ro.PushReq){if((f=this.transRsp(i.head)).room_id=h,!this.Ti.roomModulesList.find((function(t){return t.roomID==h})))return void this.ei.warn(Fs+" room no found ignore ");var a={header:f,body:this.Re.includes(i.head.sub_cmd)?{signal_msg:vr(i.msg_body),sub_cmd:i.head.sub_cmd}:i.head.sub_cmd===ro.PushSignalCustom?{custommsg:vr(i.msg_body)}:so[i.head.sub_cmd]?this.transRsp(this.Ae(io[so[i.head.sub_cmd]],i.msg_body)):{}};switch(i.head.sub_cmd){case ro.PushUserInfoUpdated:null===(n=a.body.user_action_list)||void 0===n||n.forEach((function(t){o.Pe(t,Mr)}));break;case ro.PushUserKickout:this.Pe(a.body,xr);break;case ro.PushTrans:this.Pe(a.body,Hr);break;case ro.PushUserTrans:this.Pe(a.body,jr),null===(e=a.body.trans_seq_list)||void 0===e||e.forEach((function(t){o.Pe(t,$r)}));break;case ro.PushIm:null===(s=a.body.msg_list)||void 0===s||s.forEach((function(t){o.Pe(t,Lr)}));break;case ro.PushStreamAdd:case ro.PushStreamDelete:case ro.PushStreamUpdate:null===(r=a.body.stream_info_list)||void 0===r||r.forEach((function(t){o.Pe(t,qr)}));break;case ro.PushUserTokenExpire:this.Pe(a.body.stop_stream_info,Ur)}switch(this.ei.info(Fs+" push "+JSON.stringify(this.ze(a))),i.head.sub_cmd){case ro.PushUserInfoUpdated:this.handlePushUserStateUpdateMsg(a);break;case ro.PushUserKickout:this.transKeysName(a.body,this.ce),this.handlePushKickout(a,!1);break;case ro.PushTrans:this.handlePushTransMsg(a);break;case ro.PushUserTrans:this.handlePushUserTransMsg(a);break;case ro.PushIm:this.handlePushRoomMsg(a);break;case ro.PushSignalCustom:this.handlePushCustomMsg(a);break;case ro.PushStreamAdd:case ro.PushStreamDelete:case ro.PushStreamUpdate:this.handlePushStreamMsg(a);break;case ro.PushJoinliveRequest:case ro.PushJoinliveResult:case ro.PushJoinliveInvite:case ro.PushJoinliveStop:this.handlePushSignalMsg(a);break;case ro.PushUserTokenExpire:this.handlePushTokenExpire(a);break;default:this.ei.info(Fs+" white "),this.onSwitchMessage(t,i)}if(1==i.head.qos_flag){var c=no.PushRsp.create({code:0,message:"",sub_cmd:i.head.sub_cmd,server_send_time:i.head.send_time}),l=no.PushRsp.encode(c).finish();this.sendMessage("PushRsp",l,void 0,void 0)}}else if(t.cmd===ro.MergePushReq){var f;if((f=this.transRsp(i.head)).room_id=h,!this.Ti.roomModulesList.find((function(t){return t.roomID==h})))return void this.ei.warn(Fs+" room no found ignore ");var d=[];i.message_list.forEach((function(t){var i,n;d.push({sub_cmd:t.sub_cmd,sub_seq:t.sub_seq}),t.sub_cmd===ro.PushBigIm&&(null===(i=(n=io.PushBigIm.decode(t.msg_body)).msg_list)||void 0===i||i.forEach((function(t){o.Pe(t,Gr)})),t.msg_body=n)}));var _={header:f,body:this.transRsp(i)};if(delete _.body.head,this.handlePushMergeMsg(_),1==i.head.qos_flag){c=no.MergePushRsp.create({messages:d,server_send_time:i.head.send_time}),l=no.MergePushRsp.encode(c).finish();this.sendMessage("MergePushRsp",l,void 0,void 0)}}else if(t.cmd===ro.PushKickout){this.handlePushKickout({header:t,body:{reason:i.reason>900?i.reason-900:i.reason,msg:i.message,need_relogin:void 0!==i.is_need_relogin?i.is_need_relogin:0}},!0)}}else{this.ei.warn(Fs+" ctx key ".concat(u," not found"));var v={header:t,body:i};this.be[u]?this.be[u].push(v):this.be[u]=[v]}},t.prototype.handlePushTokenExpire=function(t){var i,n,e=(null===(n=null===(i=null==t?void 0:t.body)||void 0===i?void 0:i.stop_stream_info)||void 0===n?void 0:n.stream_id_list)||[];e.length>0&&this.Ti.actionListener("_stopStream",e,{code:J.TOKEN_EXPIRED.code,message:J.TOKEN_EXPIRED.msg})},t.prototype.handlePushKickout=function(t,i){var n,e;if(i)_o([],this.Ti.roomModulesList,!0).forEach((function(i){i.roomHandler.handlePushKickout(t,!0,!0)}));else{var s=null===(n=null==t?void 0:t.header)||void 0===n?void 0:n.room_id,r=this.Ti.roomModulesList.find((function(t){return t.roomID==s}));if(this.longToStringNumber(t.body,["session_id"],"toString"),!r)return void this.ei.error("zm.lrh.pk room no found ignore "+JSON.stringify(null===(e=t.header)||void 0===e?void 0:e.room_id));r.roomHandler.handlePushKickout(t)}},t.prototype.handlePushUserStateUpdateMsg=function(t){var i,n,e,s=null===(i=null==t?void 0:t.header)||void 0===i?void 0:i.room_id,r=this.Ti.roomModulesList.find((function(t){return t.roomID==s}));if(r){var o=t.body.user_action_list.map((function(t){return{Action:t.action,IdName:t.id_name,NickName:t.nick_name,Role:t.role,LoginTime:t.login_time.toString()}})),u=this.Ti.reporter.createSpan(U.H,{key:rt.event,par:s},{key:""},wt),h={body:{user_actions:o,user_list_seq:t.body.server_user_seq.toNumber(),room_id:s}};u.setAttributes({user_list_seq:null===(n=null==h?void 0:h.body)||void 0===n?void 0:n.user_list_seq,update_user:null===(e=null==h?void 0:h.body)||void 0===e?void 0:e.user_actions}),u.end(),r.userHandler.handlePushUserStateUpdateMsg(h)}else this.ei.error("zm.lrh.puu room no found ignore "+JSON.stringify(t))},t.prototype.handlePushStreamMsg=function(t){},t.prototype.handlePushSignalMsg=function(t){},t.prototype.handlePushMergeMsg=function(t){},t.prototype.handlePushCustomMsg=function(t){},t.prototype.handlePushRoomMsg=function(t){},t.prototype.handlePushTransMsg=function(t){},t.prototype.handlePushUserTransMsg=function(t){},t.prototype.onSwitchMessage=function(t,i){},t.prototype.decodeResponseBody=function(t,i){var n=this.Se.includes(t.cmd)?"proto_switch_v3":"liveroom_cs_v3";return this.Ae(this.ve[n][so[t.cmd]],i)},t.prototype.login=function(t,i,n){var e,s,r=this;this.Te==mo.disconnected&&(this.ei.info(Ws+" state disconnect"),this.closeRequest());var o,u,h=(new Date).getTime()+"",a={user_session_id:null!==(e=t.longSid)&&void 0!==e?e:vo.fromInt(0),net_type:(o=L.NT_UNKNOWN,u="",(u=(u=Ze("netType")||"").toLocaleUpperCase()).indexOf("4G")>-1?o=L.NT_4G:u.indexOf("2G")>-1?o=L.NT_2G:u.indexOf("3G")>-1?o=L.NT_3G:u.indexOf("WIFI")>-1?o=L.NT_WIFI:u.indexOf("LINE")>-1?o=L.NT_LINE:u.indexOf("NONE")>-1&&(o=L.NT_NONE),o),room_id:_r(t.roomID),room_name:_r(t.roomName),nick_name:this.nickName,role:this.Ti.role,third_token:_r(t.token),room_create_flag:this.Ti.roomCreateFlag,user_state_flag:t.userStateUpdate?1:0,user_count_limit:t.maxMemberCount,relate_service:this.Ti.relateService.join()||""};if(t.isMulti){var c=fo(fo({},a),{conn_type:2});delete(d=fo(fo({},c),{room_id:t.roomID,room_name:t.roomName})).third_token,this.ei.info(Ws+" enter "+JSON.stringify(d));var l=io.EnterRoomReq.create(c),f=io.EnterRoomReq.encode(l).finish();this.sendMessage("EnterRoomReq",f,(function(n,e){var s;r.Me(n,t),i&&i(n,e),(null===(s=n.header)||void 0===s?void 0:s.context_key)&&r.processPushMsgCache(n.header.context_key)}),(function(t,i){r.clearAllPushMsgCache(),n&&n(t,i)}),{roomID:t.roomID})}else{var d,_=fo(fo({},a),{app_id:this.Ti.appid,id_name:_r(this.Ti.idName),device_id:this.Ti.deviceID,term_type:this.TermType,sdk_version:this.Ti.sdkVerNum,client_stamp:_r(h),relogin_token:this.switchSessionID.notEquals(vo.fromInt(0))?_r(this.we):"",switch_session_id:this.switchSessionID,user_session_id:null!==(s=t.longSid)&&void 0!==s?s:vo.fromInt(0),biz_type:0,biz_version:this.Ti.bizVersion||"",login_logic:this.Ti.isMultiRoom?3:1,sdk_conn_type:2});t.roomReasonState===as.Reconnecting&&(_.relogin_type=1),delete(d=fo(fo({},_),{id_name:this.Ti.idName,nick_name:this.Ti.nickName,client_stamp:h,k1_sign:void 0,relogin_token:this.we,room_id:t.roomID,room_name:t.roomName,user_session_id:t.longSid})).third_token,this.ae=t.token,this.ei.info(Ws+" login "+JSON.stringify(d)),this.ei.remoteReport(Ws+" token "+t.token);l=no.LoginRoomReq.create(_),f=no.LoginRoomReq.encode(l).finish();this.sendMessage("LoginRoomReq",f,(function(n,e){var s,o,u;r.ei.info(Ws+" login rsp"),r.switchSessionID=n.body.switch_session_id,r.we=n.body.relogin_token,(null===(s=null==n?void 0:n.header)||void 0===s?void 0:s.controls)&&(r.De=null===(o=null==n?void 0:n.header)||void 0===o?void 0:o.controls),r.Me(n,t),i&&i(n,e),(null===(u=n.header)||void 0===u?void 0:u.context_key)&&r.processPushMsgCache(n.header.context_key)}),(function(t,i){r.clearAllPushMsgCache(),n&&n(t,i)}))}},t.prototype.Me=function(t,i){var n,e,s,r,o,u,h=this;(null===(n=t.header)||void 0===n?void 0:n.context_key)&&(this.pe[i.roomID]=t.header.context_key,this.me[t.header.context_key]=i.roomID,t.header.room_id=i.roomID),this.Pe(t.body,Rr),this.Pe(null===(e=t.body)||void 0===e?void 0:e.anchor_info,wr),null===(r=null===(s=t.body)||void 0===s?void 0:s.trans_channel_list)||void 0===r||r.forEach((function(t,i){var n;h.Pe(t,Nr),null===(n=t.trans_seq_list)||void 0===n||n.forEach((function(t){h.Pe(t,Ir)}))})),null===(u=null===(o=t.body)||void 0===o?void 0:o.stream_info_list)||void 0===u||u.forEach((function(i,n){h.Pe(t.body.stream_info_list[n],Or)})),this.longToStringNumber(t.body,["ret_timestamp"],"toString"),this.transKeysName(t.body,this.ce),this.keysExist(t.body,["token_remain_time","stream_seq"]),t.body.anchor_info={anchor_id_name:t.body.anchor_info.id_name,anchor_id:t.body.anchor_info.user_id,anchor_nick_name:t.body.anchor_info.nick_name}},t.prototype.transKeysName=function(t,i){i.forEach((function(i){mn(t[i[0]])||(t[i[1]]=t[i[0]],delete t[i[0]])}))},t.prototype.keysExist=function(t,i){i.forEach((function(i){void 0===t[i]&&(t[i]=0)}))},t.prototype.longToStringNumber=function(t,i,n){i.forEach((function(i){vo.isLong(t[i])&&(t[i]=t[i][n]())}))},t.prototype.Pe=function(t,i){var n=this;pn(t)&&i.forEach((function(i){if("[object Uint8Array]"===Object.prototype.toString.call(t[i]))try{t[i]=vr(t[i])}catch(t){n.ei.error("zm.lrh.bts "+i+" "+t)}else if("[object Array]"===Object.prototype.toString.call(t[i])){!t[i].some((function(t){return"[object Uint8Array]"!==Object.prototype.toString.call(t)}))&&(t[i]=t[i].map((function(t,e){try{return vr(t)}catch(s){return n.ei.error("zm.lrh.bts  "+" ".concat(e," ").concat(i," ").concat(s)),t}})))}}))},t.prototype.logout=function(t,i,n){var e=this;if(t.isMulti){this.ei.info(Zs+" quit "+t.roomID),this.clearPushMsgCacheByRoomID(t.roomID);var s=io.QuitRoomReq.create(o={}),r=io.QuitRoomReq.encode(s).finish();return this.sendMessage("QuitRoomReq",r,(function(n,s){e.handleLogoutRsp(t.roomID),i&&i(n,s)}),(function(i,s){e.handleLogoutRsp(t.roomID),n&&n(i,s)}),{roomID:t.roomID})}this.clearAllPushMsgCache();var o={logout_code:0,logout_check:this.Oe.md5Bytes(_r(this.ae)),user_session_id:t.longSid,logout_logic:this.Ti.isMultiRoom?3:1},u=this.ze(o);this.ei.info(Zs+" logout "+JSON.stringify(u));s=no.LogoutRoomReq.create(o),r=no.LogoutRoomReq.encode(s).finish();return this.sendMessage("LogoutRoomReq",r,(function(n,s){e.handleLogoutRsp(t.roomID),i&&i(n,s)}),(function(i,s){e.handleLogoutRsp(t.roomID),n&&n(i,s)}),{roomID:t.roomID})},t.prototype.xe=function(t){for(var i=t.getFirst();null!=i;)t.remove(i),i._data&&i._data.error&&setTimeout((function(){i&&i._data&&i._data.error&&i._data.error(J.TIMEOUT,i._data.seq)}),0),i=t.getFirst()},t.prototype.Ue=function(t,i){for(var n=t.getFirst(),e=Date.parse(new Date+""),s=0,r=function(){if(n._data&&n._data.sendTime+n._data.timeout>e)return"break";if(n._data&&delete i[n._data.seq],t.remove(n),n._data&&null==n._data.error||n._data&&n._data.sendTime+o.de<e)0;else{var r=n&&n._data&&n._data.error,u=n&&n._data&&n._data.seq;setTimeout((function(){r&&r(J.TIMEOUT,u)}),0)}if(++s>=o.fe)return"break";n=t.getFirst()},o=this;null!=n;){if("break"===r())break}},t.prototype.startCheck=function(){var t=this;this.Ue(this.ue,this.he),this.qe=setTimeout((function(){t.startCheck()}),this._e)},t.prototype.stopCheck=function(){this.xe(this.ue),clearTimeout(this.qe)},t.prototype.handleSendCommandMsgRsp=function(t){var i=this.he[t.header.seq];if(null!=i){var n=i._data,e=null==n?void 0:n.params;delete this.he[t.header.seq],this.ue.remove(i),0===t.body.err_code?setTimeout((function(){n&&null!=n.success&&n.success(t,t.header.seq)}),0):setTimeout((function(){n&&null!=n.error&&n.error(t,t.header.seq,e)}),0)}},t.prototype.getReqHead=function(t){return{}},t.prototype.heartBeat=function(t,i,n,e){var s=this,r=io.HbReq.create({}),o=io.HbReq.encode(r).finish();this.sendMessage("HbReq",o,(function(i,n){var e,r;null===(e=i.body.trans_channel_list)||void 0===e||e.forEach((function(t,i){var n;s.Pe(t,Nr),null===(n=t.trans_seq_list)||void 0===n||n.forEach((function(t){s.Pe(t,Ir)}))})),null===(r=i.body.user_trans_channel_list)||void 0===r||r.forEach((function(t,i){var n;s.Pe(t,Nr),null===(n=t.trans_seq_list)||void 0===n||n.forEach((function(t){s.Pe(t,Ir)}))})),s.transKeysName(i.body,[["hb_interval","hearbeat_interval"],["hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"]]),i.body.server_user_seq=i.body.user_seq.toNumber(),s.longToStringNumber(i.body,["ret_timestamp"],"toNumber"),t&&t(i,n)}),i,{roomID:null==n?void 0:n.roomID},{timeout:e})},t.prototype.fetchUserList=function(t,i,n,e){var s=this,r=fo({},t),o=this.ze(r);this.ei.info(Xs+" "+JSON.stringify(o));var u=io.GetUserlistReq.create(r),h=io.GetUserlistReq.encode(u).finish();return this.sendMessage("GetUserlistReq",h,(function(t,n){var e,r;s.ei.info(Xs+" suc "+n),null===(r=null===(e=t.body)||void 0===e?void 0:e.user_base_info_list)||void 0===r||r.forEach((function(i,n){s.Pe(t.body.user_base_info_list[n],Cr)})),s.transKeysName(t.body,[["user_base_info_list","user_baseinfos"]]),s.longToStringNumber(t.body,["server_user_seq","server_user_index","ret_user_index"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},t.prototype.sendRoomMsg=function(t,i,n,e){var s=this,r={msg_category:t.msg_category,msg_type:t.msg_type,msg_content:_r(t.msg_content)},o=this.ze(r);this.ei.info("zm.lrh.srm.1 "+JSON.stringify(o));var u=io.SendImReq.create(r),h=io.SendImReq.encode(u).finish();return this.sendMessage("SendImReq",h,(function(t,n){s.longToStringNumber(t.body,["msg_id"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},t.prototype.sendReliableMessage=function(t,i,n,e){var s=this,r={trans_type:_r(t.trans_type),trans_data:_r(t.trans_data),trans_local_seq:t.trans_local_seq,trans_channel:_r(t.trans_channel)},o=this.ze(r);this.ei.info("zm.lrh.srm.0 "+JSON.stringify(o));var u=io.SetTransReq.create(r),h=io.SetTransReq.encode(u).finish();return this.sendMessage("SetTransReq",h,(function(t,n){s.Pe(t.body,kr),i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},t.prototype.fetchReliableMessage=function(t,i,n,e){var s=this,r=t.fetch_array.map((function(t){return{trans_type:_r(t.trans_type),trans_local_seq:t.trans_seq}})),o={trans_channel:_r(t.trans_channel),trans_list:r},u=this.ze(o);this.ei.info("zm.lrh.frm "+JSON.stringify(u));var h=io.GetTransReq.create(o),a=io.GetTransReq.encode(h).finish();return this.sendMessage("GetTransReq",a,(function(t,n){var e;s.Pe(t.body,Dr),null===(e=t.body.trans_list)||void 0===e||e.forEach((function(t){s.Pe(t,zr)})),i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},t.prototype.fetchUserTransInfo=function(t,i,n,e){var s=this,r=t.fetch_array.map((function(t){return{trans_type:_r(t.trans_type),trans_local_seq:t.trans_seq}})),o={trans_channel:_r(t.trans_channel),user_trans_list:r},u=this.ze(o);this.ei.info("zm.lrh.futi "+JSON.stringify(u));var h=io.GetUserTransReq.create(o),a=io.GetUserTransReq.encode(h).finish();return this.sendMessage("GetUserTransReq",a,(function(t,n){var e;s.Pe(t.body,Ar),null===(e=t.body.user_trans_list)||void 0===e||e.forEach((function(t){s.Pe(t,Pr)})),i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},t.prototype.sendCustomCommand=function(t,i,n,e){var s=this,r=t.dest_id_name.map((function(t){return{id_name:_r(t)}})),o=fo({to_user_list:r,push_message:_r(t.custom_msg)},t),u=this.ze(o);this.ei.info("zm.lrh.scc "+JSON.stringify(u));var h=io.SignalLiveCustomReq.create(o),a=io.SignalLiveCustomReq.encode(h).finish();return this.sendMessage("SignalLiveCustomReq",a,(function(t,n){i&&i(s.transRsp(t),n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},t.prototype.sendBigRoomMessage=function(t,i,n,e){var s={msg_list:t.msgs.map((function(t){return{msg_category:t.msg_category,msg_type:t.msg_type,msg_timestamp:vo.fromNumber(Date.now()),msg_content:_r(t.msg_content),msg_client_id:_r(t.bigmsg_client_id)}}))},r=this.ze(s);this.ei.info("zm.lrh.sbrm "+JSON.stringify(r));var o=io.SendBigImReq.create(s),u=io.SendBigImReq.encode(o).finish();return this.sendMessage("SendBigImReq",u,i,n,{roomID:null==e?void 0:e.roomID})},t.prototype.sendSignalCmd=function(t,i,n,e){var s="";switch(t.sub_cmd){case bo:s="SignalLiveInviteReq";break;case po:s="SignalLiveRequestReq";break;case go:s="SignalLiveResultReq";break;case Eo:s="SignalLiveStopReq"}var r=t.dest_id_name.map((function(t){return{id_name:_r(t)}})),o={push_message:_r(t.signal_msg),to_user_list:r},u=this.ze(o);this.ei.info("zm.lrh.ssc "+JSON.stringify(u));var h=io[s].create(o),a=io[s].encode(h).finish();return this.sendMessage(s,a,i,n,{roomID:null==e?void 0:e.roomID})},t.prototype.sendStreamUpdate=function(t,i,n,e){var s,r=this;try{s=JSON.parse(t.stream_msg)}catch(t){}var o,u="";this.ei.info(Ks+" "+JSON.stringify(fo(fo({},t),{third_token:void 0}))),this.ei.remoteReport(Ks+" token "+t.third_token);var h=this.Ti.roomModulesList.find((function(t){return t.roomID==e.roomID}));if(!h)return this.ei.error(Ks+" room no found ignore "),-1;switch(t.sub_cmd){case 2001:u="AddStreamReq",o={stream_id:_r(s.stream_id),extra_info:_r(s.extra_info),client_req_seq:this.seq+1,third_token:_r(t.third_token||""),stream_attr_opts:{censor_flag:s.inspect_flag||0}};break;case 2002:u="DeleteStreamReq",o={stream_id:_r(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1};break;case 2003:u="UpdateStreamReq",o={stream_id:_r(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1,extra_info:_r(s.extra_info)}}var a=this.ze(o);this.ei.info(Ks+" "+JSON.stringify(a));var c=io[u].create(o),l=io[u].encode(c).finish();return this.sendMessage(u,l,(function(t,n){r.ei.info(Ks+" suc "+u+" "+JSON.stringify(t)),t.header.room_id=h.roomID,i&&i(t,n)}),(function(t,i){r.ei.info(Ks+" fail "+u+" "+JSON.stringify(t)),n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},t.prototype.getStreamList=function(t,i,n,e){var s=this;if(this.Ti.roomModulesList.find((function(t){return t.roomID==e.roomID}))){var r={},o=this.ze(r);this.ei.info(Ys+" "+JSON.stringify(o));var u=io.GetStreamListReq.create(r),h=io.GetStreamListReq.encode(u).finish();this.sendMessage("GetStreamListReq",h,(function(t,n){var e;null===(e=t.body)||void 0===e||e.stream_info_list.forEach((function(t){t.create_time=t.create_time.toNumber()})),s.transKeysName(t.body,[["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]]),i&&i(t,n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})}else this.ei.error(Ys+" room no found ignore "+e.roomID)},t.prototype.ze=function(t){var i=this,n={};return Object.keys(t).forEach((function(e){["logout_check"].includes(e)?n[e]=t[e]:i.Le(n,t,e,!0)})),n},t.prototype.Le=function(t,i,n,e){var s=this;if(void 0===e&&(e=!1),vo.isLong(i[n]))t[n]=e?i[n].toString():i[n];else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(r){return s.Le(t[n],i[n],r,e)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var r=function(r){var o={};Object.keys(i[n][r]).forEach((function(t){s.Le(o,i[n][r],t,e)})),t[n].push(o)},o=0;o<i[n].length;o++)r(o)}else if(e&&"[object Uint8Array]"===Object.prototype.toString.call(i[n]))try{t[n]=vr(i[n])}catch(s){t[n]=e?"~":i[n]}else t[n]=i[n]},t.prototype.transHeader=function(t){return t.timestamp=vo.isLong(t.timestamp)?t.timestamp.toString():t.timestamp,t},t.prototype.transRsp=function(t){var i=this,n=t&&t.rsp_head?this.transRspHead(t.rsp_head):{},e=fo(fo({},t),n);delete e.rsp_head;var s={};return Object.keys(e).forEach((function(t){"k2_sign"===t?s[t]=e[t]:i.transBytes(s,e,t)})),s},t.prototype.transBytes=function(t,i,n){var e=this;if(vo.isLong(i[n]))t[n]=i[n];else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(s){return e.transBytes(t[n],i[n],s)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var s=function(s){var r={};Object.keys(i[n][s]).forEach((function(t){e.transBytes(r,i[n][s],t)})),t[n].push(r)},r=0;r<i[n].length;r++)s(r)}else t[n]="[object Uint8Array]"===Object.prototype.toString.call(i[n])?vr(i[n]):i[n]},t.prototype.transRspHead=function(t){return t?{err_code:t.code||0,err_message:t.message}:{}},t.prototype.Ae=function(t,i){return fo({},t.decode(i))},t.prototype.ke=function(t,i){var n=this;this.ei.info(Qs+" call"),this.Te=mo.disconnected,t===V.DisconnectedType.TIMEOUT&&this.Ti.roomModulesList.forEach((function(t){var i=t.roomTryHandler;i&&(n.isUaConnect?(n.ei.info(Qs+" ua is connect"),i.retryLoginRoom()):(n.ei.info(Qs+" ua is disconnect"),n._ua.connectUa()))}))},t.prototype.Ce=function(){this.ei.info(tr+" call"),this.Te=mo.broken,this.clearAllPushMsgCache(),this.Ge(tr)},t.prototype.Ge=function(t){var i=this;this.Ti.roomModulesList.forEach((function(n){var e=n.roomTryHandler,s=n.roomHandler;e&&(e.invalid(),e.onactive=function(n,e){i.ei.info(t+" onactive"),s.transError(e),s.disconnectedHandle(e)},e.startMaxTime(),s._roomStateHandle("CONNECTING",as.Reconnecting,J.NETWORK_BROKEN))}))},t.prototype.Ne=function(t){this.ei.info("zm.lrh.hc call "+t),this.Te=mo.connected,t===V.ConnectedType.AUTO&&this.rtm.retryRoom()},t.prototype.renewToken=function(t,i,n,e){var s=this,r={token:t.token},o=io.RenewTokenReq.create(r),u=io.RenewTokenReq.encode(o).finish(),h=this.ze(r);this.ei.info("zm.lrh.rt "+JSON.stringify(h)),this.sendMessage("RenewTokenReq",u,(function(t,n){s.keysExist(t.body,["token_remain_time"]),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},t.prototype.reset=function(){this.ei.info("zm.lrh.r.0 call "),this.Te=mo.disconnected,this.switchSessionID=vo.fromInt(0),this.qe&&clearTimeout(this.qe)},t.prototype.closeRequest=function(){var t;null===(t=this.Ie)||void 0===t||t.closeRequest()},t.prototype.resetSessionInfo=function(){this.switchSessionID=vo.fromInt(0)},t.prototype.processPushMsgCache=function(t){var i=this.be[t];if(i){this.ei.info(Js+" processPushMsgCache ".concat(t,", msg len: ").concat(i.length));for(var n=0;n<i.length;n++){var e=i[n];this.handleSwitchPush(e.header,e.body)}delete this.be[t]}},t.prototype.clearAllPushMsgCache=function(){var t=this;Object.keys(this.be).forEach((function(i){var n=parseInt(i);delete t.be[n]}))},t.prototype.clearPushMsgCacheByRoomID=function(t){var i=this.pe[t];i&&this.be[i]&&delete this.be[i]},t.prototype.handleLogoutRsp=function(t){var i=this.pe[t];i&&(delete this.me[i],delete this.pe[t],this.be[i]&&delete this.be[i])},t}();const yo=V.ZegoConnectionAgent;var To,Ro=function(){return Ro=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},Ro.apply(this,arguments)},wo=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},Oo=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},Io=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||(e||(e=Array.prototype.slice.call(i,0,s)),e[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},No=function(){function i(t,n,e,s,r,o,u){var h,a,c,l,f,d;this.ei=e,this._dataReport=s,this.Ci=r,this.He=u,this.dispatchServers=[],this.dispatchHttp3Servers=[],this.je=null,this.Be=1e3,this.version=Kt,this.id="",this._roomLoginResponseListener=function(){},this.Ti=new ar(this.ei,this._dataReport),this.Ti.ENV=o,this.Ti.product=ds,this.Ti.advanceConfig=Ro(Ro({},this.Ti.advanceConfig),{customDomain:i.customDomain}),this.Ve();var _=i.engineOptions;this.getReportSeq=fn,this.getSeq=ln,this.Je(),this.Ti.deviceID=function(t){void 0===t&&(t=0);var i=Ze("z_deviceID");if(i)return i;(new Date).getTime();var n=is();return Xe("z_deviceID",n),n}(o),i.pageID||(i.pageID=is());var v=this.Ti.id=is();this.logger.info("".concat(ms," deviceID: ").concat(this.Ti.deviceID,", pageID: ").concat(i.pageID,", instID: ").concat(v)),this.Ci.init(t,o,this.Ti.deviceID),this.Ci.setLogger(this.ei),this.Ti.reporter=this.Ci;var m,p=Z,g=this.Ci.createSpan(U.H,{key:""},{key:p.event},p.event,!0);(0==o||1==o)&&this.Fe(n);var b="Express";if((null===(h=this.He)||void 0===h?void 0:h.reportData)&&(m=null===(c=null===(a=this.He)||void 0===a?void 0:a.reportData)||void 0===c?void 0:c.version,b=(null===(f=null===(l=this.He)||void 0===l?void 0:l.reportData)||void 0===f?void 0:f.project)||b),g.setAttributes({biz_type:p.biz_type(0),project:p.project(b),servers:p.servers(_n(n)?[n]:n),liveroom_version:p.liveroom_version(m),is_from_cache:p.is_from_cache(!1),sev_env:p.sev_env(this.Ti.testEnvironment?"test":"online")}),function(t,i,n){return t&&dn(t)&&Cn(t)?!(!i||!_n(i)&&!Array.isArray(i)||""==i)||(n.error("ccp.0 server must be string or string array and not empty"),!1):(n.error("ccp.0 appid must be positive integer number and not empty"),!1)}(t,n,this.ei)){this.Ti.appid=t,this.Ti.configOK=!0,this.Ti.sdKVersion=this.version,this.netAgent=new yo,this.ei.setSessionInfo(this.Ti.appid,"","","","",this.version),this.netAgent.init(),this.netAgent.setLogger(this.ei);var E={appID:this.Ti.appid,env:this.Ti.ENV,mode:this.Ti.mode};_&&_.pri&&(E.model=1),this.netAgent.setAppInfo(E),this.liveRoomHandler=new So(this.ei,this.Ti,this.netAgent,this._dataReport,this);0===o?"rtc":1===o&&"xcx",this.Ye(),g.setAttributes({use_na:p.use_na(1)}),g.end(),_n(n)?(this.Ti.server=n,this.Ti.serverBak=n):Array.isArray(n)&&n.length>0&&(this.Ti.server=n[0],this.Ti.serverBak=n[1]||n[0]),this.ei.info("".concat(ms," ").concat(null!==(d=null===navigator||void 0===navigator?void 0:navigator.appVersion)&&void 0!==d?d:""," ").concat(this.version,"  logVersion:").concat(Zt.ZegoLogger.logVersion)),this._bindWxListener();try{var S,y={brand:(S=wx.getSystemInfoSync()).brand,model:S.model,system:S.system,platform:S.platform,version:S.version,SDKVersion:S.SDKVersion};this.ei.info(ms+" "+JSON.stringify(y)),g.setAttribute("mini_sys_infos",y),g.end()}catch(t){this.ei.warn(ms+" get system info error")}this.ei.setSessionInfo(this.Ti.appid,"","","","",this.version)}else this.ei.error("".concat(ms," init sdk error")),this.Ci.setError(g,p.error.kInvalidParamError);this.Ti.onListener("roomLoginResponse",this._roomLoginResponseListener)}return Object.defineProperty(i.prototype,"logger",{get:function(){return this.ei},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"stateCenter",{get:function(){return this.Ti},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"modules",{get:function(){return{service:{sendMessage:function(t){},on:function(t,i){},registerRouter:function(t,i){}}}},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUseNetAgent",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isUaConnect",{get:function(){return this.netAgent.isConnect()},enumerable:!1,configurable:!0}),i.prototype.We=function(t,i){var n;return void 0===i&&(i=!1),null===(n=this.Ti.settingConfig)||void 0===n?void 0:n.getSetting(t,i)},i.prototype.Xe=function(t,i){var n;return null===(n=this.Ti.settingConfig)||void 0===n?void 0:n.setSetting(t,i)},Object.defineProperty(i.prototype,"reporter",{get:function(){return this.Ci},enumerable:!1,configurable:!0}),i.prototype.destroyRTM=function(){this.Ti.roomModulesList.some((function(t){return!((null==t?void 0:t.isLogout())||t.roomState===mr)}))&&this.logoutRoom(),this.Ci.setUnloadState(U.I),this.Ci.destroy(),this.Ze()},i.prototype.Je=function(){this.proxyRes=Ke,this.getServerError=Le},i.prototype.Ve=function(){var t=this.version.split(".").map((function(t){return parseInt(t)}));this.Ti.sdkVerNum=(0===this.Ti.ENV?ti.SDKProject_ZegoWebRTC:ti.SDKProject_ZegoMiniProgram)<<28|t[0]<<20|t[1]<<8|t[2]},i.prototype.Ye=function(){var t,n=this;this.ei.info(Ts+" call"),this.netAgent.on("disconnected",(function(t){n.ei.info("".concat(Ts," netAgent disconnect"))})),this.netAgent.on("connected",(function(){n.ei.info("".concat(Ts," netAgent connect")),n.Ci.setNetStateCheck(),n.fetchAppConfig(),n.retryRoom(!0)})),this.netAgent.on("broken",(function(t){n.ei.info("".concat(Ts," netAgent broken")),t===V.BrokenType.CLOSE&&n.Ti.roomModulesList.forEach((function(t){t.resetSessionInfo()}))})),this.netAgent.on("dispatchEvent",(function(t,i,e){if(n.ei.info("".concat(Ts," dispatch")),"start"===i){var s=n.Ci.createSpan(U.H,{key:Ct},{key:""},Ut);n.Ti.requestList[t]=s}else if("end"===i){(s=n.Ti.requestList[t])&&(s.setAttributes({domain_list:qt(e.domains),http3_domain_list:qt(e.http3Domains)}),s.end())}})),this.netAgent.on("connectedEvent",(function(t,i,e){var s;if(n.ei.info("".concat(Ts," connect")),"start"===i){var r=n.Ci.createSpan(U.H,{key:Z.event},{key:Ct},Ct,!0);n.Ti.requestList[t]=r}else if("end"===i){if(r=n.Ti.requestList[t]){var o=e.connectEvents||[];r.setAttributes({request_count:Dt(e.count),connect_id:kt(e.connectid),events:zt(o),error:(null===(s=o[0])||void 0===s?void 0:s.error)||0}),r.end()}}})),this.netAgent.on("requestEvent",(function(t,i,e){if(n.ei.info("".concat(Ts," request")),"start"===i){var s=n.Ci.createSpan(U.H,{key:Z.event},{key:Lt},Lt,!0);n.Ti.requestList[t]=s}else if("end"===i){(s=n.Ti.requestList[t])&&(s.setAttributes({req_location:Gt(e.na_req_location),http_code:e.status_code,error:e.err_code}),s.end())}})),this.netAgent.on("disConnectedEvent",(function(t){var i=t.duration,e=t.server,s=t.connectid;n.ei.info("".concat(Ts," disconnect"));var r=n.Ci.createSpan(U.H,{key:Z.event},{key:""},At);r.setAttributes({url:Mt(e),connect_duration:xt(i),connect_id:Pt(s)}),r.end()})),this.netAgent.on("clientInfo",(function(t){var i=t.timeOffset;dn(i)&&n.Ci.setTimeOffset(i),n.Ke()})),this.netAgent.on("heartBeatTimeout",(function(){n.Ti.actionListener("_uaHeartBeatTimeout")})),this.netAgent.setSettingConfig({enableHttp3:void 0!==(null===(t=i.engineOptions)||void 0===t?void 0:t.http3)?!!i.engineOptions.http3:1===this.We("http3")});var e=[];e=_s;var s=this.Qe(),r=s.accesshub,o=s.logreport,u=s.detaillog;r&&""!==r&&(e=[r],this.stateCenter.svrDomains.accesshub=r),o&&""!==o&&(this.stateCenter.svrDomains.logreport=o),u&&""!==u&&(this.stateCenter.svrDomains.detaillog=u),this.ei.info("".concat(Ts," advance config domains: ").concat(JSON.stringify(s),", set domains ").concat(JSON.stringify(e),", ")),this.ei.info("".concat(Ts," domains ").concat(JSON.stringify(e)));var h=e.map((function(t){return"wss://".concat(t,"/accesshub")}));[].map((function(t){return"https://".concat(t,"/accesshub")}));this.netAgent.setNetAgentDefaultServers(h),this.dispatchServers=[],this.netAgent.setDispatchConnectServers(this.dispatchServers,this.dispatchHttp3Servers)},i.prototype.ns=function(t){var i=t.split(".");return i[i.length-2]+"."+i[i.length-1]},i.prototype.Qe=function(){var t={},i=this.stateCenter.advanceConfig.customDomain;if(!i)return t;var n=i.accesshub,e=i.logreport,s=i.detaillog;return n&&(t.accesshub=n),e&&(t.logreport=e),s&&(t.detaillog=s),t},i.prototype._bindWxListener=function(){var t=this;wx.onNetworkStatusChange.bind(this)((function(i){i.isConnected?t.es():t.ss()}))},i.prototype.retryRoom=function(t,i,n){if(void 0===t&&(t=!1),void 0===n&&(n=!1),this.logger.info("".concat("zm.rr"," retryNow:").concat(t," roomid:").concat(i,", resetSession:").concat(n)),i){var e=this.Ti.roomModulesList.find((function(t){return t.roomID==i}));e&&e.retryRoom(t,n)}else this.Ti.roomModulesList.forEach((function(i){null==i||i.retryRoom(t,n)}))},i.prototype.es=function(){this.ei.info(ps+" network is online"),this.Ti.networkState!==q.online&&(this.Ti.networkState=q.online,this.Ze())},i.prototype.Ze=function(){this.je&&(clearInterval(this.je),this.je=null)},i.prototype.rs=function(){var t=this;this.Ze(),this.ei.info(ir+" start network online detection.."),this.je=setInterval((function(){t.Ti.networkState!==q.offline&&t.Ze(),t.isUaConnect&&(t.ei.info(ir+" detected network online"),t.es(),t.Ze())}),this.Be)},i.prototype.ss=function(){this.ei.info(ps+" network is broken"),this.Ti.networkState!==q.offline&&(this.Ti.networkState=q.offline,this.rs())},i.prototype.setLogConfig=function(t){var i,n;this.ei.info(gs+" call");var e=this.Ci.createSpan(U.H,{key:Z.event},{key:it.event},it.event);if(t.logLevel&&["debug","info","warn","error","report","disable"].includes(t.logLevel)&&(this.ei.setLogLevel(t.logLevel),e.setAttributes({log_level:it.log_level(t.logLevel)})),t.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(t.remoteLogLevel)&&e.setAttributes({remote_log_level:it.remote_log_level(t.remoteLogLevel)}),_n(t.logURL)&&(t.logURL.startsWith("wss://")||t.logURL.startsWith("https://")))(null===(i=this.Ti.geoFencing)||void 0===i?void 0:i.logreport)?this.ei.info(gs+" geo exist"):(this.ei.setLogServer(t.logURL),0===this.Ti.ENV&&(this.Ti.logDomain=null===(n=this.ei.url)||void 0===n?void 0:n.split("/")[2],this.Ci.setConfig({serverUrl:"wss://"+this.Ti.logDomain+"/zglog/tlog"}))),e.setAttributes({log_url:it.log_url(t.logURL)}),e.end();else if(t.logURL)return this.ei.error(gs+"log url must be a wss or https url"),this.Ci.setError(e,it.error.kInvalidParamError),!1;return this.ei.info(gs+" call success"),e.end(),!0},i.prototype.setDebugVerbose=function(t){var i=this.Ci.createSpan(U.H,{key:Z.event},{key:Q},Q);vn(t)&&(this.Ti.debug=t,this.Ti.debugCustom=!0,i.setAttributes({debug:tt(t?"true":"false")})),i.end(),this.ei.info("zm.sdv call success")},i.prototype.Fe=function(t){_n(t)&&t.indexOf("wss")>-1?this.Ti.debug=Qe(t):Array.isArray(t)&&t.length>0&&t.every((function(t){return _n(t)&&t.indexOf("wss")>-1}))?this.Ti.debug=Qe(t[0]):this.ei.info(ms+" server wrong"),this.Ti.testEnvironment=this.Ti.debug},i.prototype.renewToken=function(t,i){var n,e,s=this,r=this.Ci.createSpan(U.H,{key:rt.event,par:i},{key:""},at.event);if(!(mn(i)||_n(i)&&""!=i))return this.ei.error(Os+" roomID must be string and no empty"),!1;var o=this.getRoomModules(i)||this.Ti.roomModulesList[0];if(!o)return this.ei.error(Os+" calling must after loginRoom"),this.Ci.setError(r,at.error.NOT_LOGIN),!1;if(_n(t)&&o.roomTryHandler){if(t===o.roomTryHandler.token)this.ei.info(Os+" token has not changed"),r.setAttributes({error:at.error.INPUT_PARAM.code,message:"token has not changed"}),r.end();else if(r.setAttributes({token:at.token(t)}),this.Ti.configRoomAuth){null===(n=this.liveRoomHandler)||void 0===n||n.renewToken({token:t},(function(i){var n,e,u,h,a;null===(n=o.roomTryHandler)||void 0===n||n.renewLocalToken(t,null===(e=null==i?void 0:i.body)||void 0===e?void 0:e.token_remain_time);var c=(null===(u=null==i?void 0:i.body)||void 0===u?void 0:u.stop_stream_id_list)||(null===(a=null===(h=null==i?void 0:i.body)||void 0===h?void 0:h.stop_stream)||void 0===a?void 0:a.stream_id_list)||[];c.length>0&&s.Ti.actionListener("_stopStream",c,J.NO_PUBLISH_AUTH),s.Ci.setReporterInfo(s.Ti.idName||"",t),s.Ti.configCheckToken=!0,r.end(),s.ei.info(Os+" "+JSON.stringify(i))}),(function(i){var n,e,u=null===(n=null==i?void 0:i.body)||void 0===n?void 0:n.err_code;s.Ci.setError(r,i),!u||1000002014!==u&&2014!==u?s.ei.error(Os+" "+JSON.stringify(i)):(s.Ti.configCheckToken=!1,null===(e=o.roomTryHandler)||void 0===e||e.renewLocalToken(t),s.ei.warn(Os+" "+JSON.stringify(i)))}),o)}else null===(e=o.roomTryHandler)||void 0===e||e.renewLocalToken(t),this.Ci.setReporterInfo(this.Ti.idName||"",t),r.end();return!0}return _n(t)&&!o.roomTryHandler?(this.ei.error(Os+" calling must after loginRoom"),this.Ci.setError(r,at.error.NOT_LOGIN),!1):(this.ei.error(Os+" token must be string and not empty"),this.Ci.setError(r,at.error.INPUT_PARAM),!1)},i.prototype.loginRoom=function(t,i,n,e){var s=this;return this.ei.info(bs+" call by user "+(null==n?void 0:n.userID)+" "+t+" "+this.version),new Promise((function(r,o){return wo(s,void 0,void 0,(function(){var s,u,h,a,c,l,f,d,_,v,m,p,g,b=this;return Oo(this,(function(E){switch(E.label){case 0:return 1!==this.Ti.ENV?[3,2]:[4,new Promise((function(t){wx.getNetworkType({success:function(i){b.Ti.networkState="none"===i.networkType?q.offline:q.online,t()},fail:function(i){b.ei.error(ms+" network "+JSON.stringify(i)),b.Ti.networkState=q.online,t()}})}))];case 1:E.sent(),E.label=2;case 2:if(s=function(t,i){void 0===i&&(i="");var e=b.Ci.getAPIErrorReport(rt.event);b.Ci.takeAPIErrorReport(rt.event,t,e,(null==n?void 0:n.userID)?{id_name:n.userID+""}:{}),o(t.code&&t.msg&&""!==i?{code:t.code,msg:t.msg+i}:t)},!(e=e||{}).maxMemberCount&&(e.maxMemberCount=0),a=(u=this.Ti).roomModulesList,c=rt.error,!(h=u.isMultiRoom)&&a.length>0)return s(c.ROOM_COUNT_EXCEED),[2];for(l=0;l<a.length;l++){if((f=a[l]).roomID===t)return s(c.REPEATEDLY_LOGIN),[2];if(d=f.roomTryHandler,h&&d&&d.user.userID!==n.userID)return s(c.DIFFERENT_USER_ID),[2]}return _=new yr(t,this.Ti,this.ei,this._dataReport,this,this.liveRoomHandler),(v=_.roomTryHandler)||(v=new or(this.ei,this.Ti,_),_.roomTryHandler=v),v.init(this.Ti.roomRetryTime),v.initRoom(_.roomHandler,t,i,n,e),_.roomHandler._roomStateHandle(gr,as.Logining,{code:0,msg:""}),m=function(t,i){var n=[],e={};for(var s in t)e[t[s].order]=t[s],t[s].key=s;for(var r in e)n.push(e[r]);for(var o=0;o<n.length;o++)for(var u=n[o].rules,h=0;h<u.length;h++){var a={key:n[o].key,value:n[o].value,action:i.action,logger:i.logger},c=a.value,l=u[h].name?""+u[h].name:"";if((void 0===c&&l===fs.NOT_EMPTY||void 0!==c)&&hr[l]){var f=hr[l](a.key,c,a.action,a.logger,u[h]);if(f!=ur)return f}}return ur}({roomID:{order:0,value:t,rules:[{name:fs.NOT_EMPTY,error:c.ROOM_ID_NULL},{name:fs.TYPE_STRING,error:c.INPUT_PARAM,extMsg:"roomID must be string"},{name:fs.MAX_LENGTH_128,error:c.ROOM_ID_TOO_LONG},{name:fs.ILLEGAL_CHARACTERS,error:c.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:i,rules:[{name:fs.NOT_EMPTY,error:c.INPUT_PARAM},{name:fs.TYPE_STRING,error:c.INPUT_PARAM}]},user:{order:2,value:n,rules:[{name:fs.NOT_EMPTY,error:c.INPUT_PARAM,extMsg:" param user error."},{name:fs.TYPE_OBJECT,error:c.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:n.userID,rules:[{name:fs.NOT_EMPTY,error:c.USER_ID_NULL,extMsg:" param user error."},{name:fs.TYPE_STRING,error:c.INPUT_PARAM,extMsg:" param userID error."},{name:fs.MAX_LENGTH_64,error:c.USER_ID_TOO_LONG},{name:fs.ILLEGAL_CHARACTERS,error:c.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:n.userName,rules:[{name:fs.TYPE_STRING,error:c.INPUT_PARAM,extMsg:" userName must be string."},{name:fs.MAX_LENGTH_256,error:c.USER_NAME_TOO_LONG}]},config:{order:5,value:e,rules:[]},"config.maxMemberCount":{order:6,value:e.maxMemberCount,rules:[{name:fs.TYPE_INTEGER,error:c.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:bs,logger:this.ei}),m!==ur?(_.roomHandler._roomStateHandle(mr,as.LoginFailed,m.error,m.extMsg),s(m.error,m.extMsg),[2]):(p=this.os(r,o,t,i,e),g=p.loginSpan,v.setLoginRoomCallback(p.interResolve,p.interReject),this.ei.setSessionInfo(this.Ti.appid,"","",n.userID,"",this.version),this.Ti.roomModulesList.length>0&&1==this.Ti.isMultiRoom?_.isMulti=!0:Io([],this.Ti.roomModulesList,!0).forEach((function(t){return t.roomHandler.logout()})),e&&(_.config=e),this.Ti.roomModulesList.push(_),this.netAgent&&(this.Ti.idName=n.userID,this.netAgent.setUserInfo(n.userID),this.Ti.actionListener("_roomLogin",t,i),this.isUaConnect&&this.fetchAppConfig(i)),g.setAttributes({id_name:n.userID}),this.Ci.setCommonAttributes({id_name:n.userID}),this.Ci.setReporterInfo(n.userID,i),this.ei.setTokenInfo(i,n.userID),this.Ci.setSpanInMap(g,{key:rt.event,par:t}),this.Ti.setMultiRoom=!0,this.isUaConnect?(this.Ti.networkState=q.online,v.retryLoginRoom(!0),[2]):(this.ei.info(bs," us is not connected"),_.roomHandler.setRunState(x.trylogin),this.dispatchServers.length>0&&this.netAgent.connectUa(),[2]))}}))}))}))},i.prototype.handleLogUpload=function(){var t,i;if(this.ei.info(ys+" call"),this.ei.url)this.ei.info(ys+" log is connected");else{var n=this.Ti.advanceConfig.customDomain;if(n&&n.logreport)this.Ti.logDomain=n.logreport;else(null===(t=this.Ti.geoFencing)||void 0===t?void 0:t.logreport)?this.Ti.logDomain=null===(i=this.Ti.geoFencing)||void 0===i?void 0:i.logreport:this.Ti.testEnvironment?this.Ti.logDomain="weblogger-hk-test.zegocloud.com":0===this.stateCenter.ENV?this.Ti.svrDomains.logreport&&(this.Ti.logDomain=this.Ti.svrDomains.logreport):1===this.stateCenter.ENV&&(this.Ti.logDomain=vs);var e="";0===this.Ti.ENV?(e="wss://".concat(this.Ti.logDomain,"/log"),this.Ci.setConfig({serverUrl:"wss://".concat(this.Ti.logDomain,"/zglog/tlog")})):e="https://".concat(this.Ti.logDomain,"/httplog"),this.ei.setLogServer(e)}},i.prototype.fetchAppConfigByTargetToken=function(t,i){return wo(this,void 0,void 0,(function(){return Oo(this,(function(t){return[2,null]}))}))},i.prototype.fetchAppConfig=function(t){return wo(this,void 0,void 0,(function(){var i,n,e,s,r,o,u,h,a,c,l,f;return Oo(this,(function(d){switch(d.label){case 0:if(this.Ti.appConfigFetched)return this.ei.warn(Ss+" config fetched"),[2];if(!this.getUserID())return this.ei.warn(Ss+" user not exist"),[2];if(i="",t)i=t;else{if(!(this.Ti.roomModulesList.length>0))return this.ei.warn(Ss+" token not exist"),[2];i=this.getToken()}n=this.Ci.createSpan(U.H,{key:Z.event},{key:""},Ht),this.ei.info(bs+" initConfig etag: "+this.Ti.appConfigEtag),-1!==this.Ti.appConfigEtag&&this.Ti.appConfig.speedlog_config&&void 0===this.Ti.appConfig.speedlog_config.charge_info_report_cycle&&(this.Ti.appConfigEtag=-1,this.ei.warn(bs+" reset etag")),e=!!this.Ti.appConfig,d.label=1;case 1:return d.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",i,5e3,this.Ti.appConfigEtag,{isSpecial:!1})];case 2:if(s=d.sent(),r=s.code,o=s.data,u=s.etag,h=s.retryCount,n.setAttributes({trigger_reason:jt(this.Ti.appConfig?"refresh":"normal"),try_count:$t(h||0)}),n.end(),this.Ti.appConfigFetched=!0,this.ei.info(bs+" initConfig code:"+r+" data: "+JSON.stringify(o)+" etag: "+u),this.Ti.appConfigEtag!==u){if(0==Object.keys(o).length)return this.ei.info(bs+" initConfig data null"),[2];this.Ti.appConfig={app_config:o.app_config,media_config:{publish_config:(a=o.media_config).publish_config,play_config:a.play_config},speedlog_config:Ro(Ro({},c=o.speedlog_config),{charge_info_report_no_playing:c.charge_info_report_no_playing||0})},this.Ti.appConfigEtag=u}return this.handleLogUpload(),!e&&this.Ti.appConfig&&this.Ti.actionListener("_appConfigRsp"),!this.Ti.netAppConfig&&this.Ti.appConfig&&(this.Ti.netAppConfig=Object.assign(this.Ti.appConfig),this.Ti.actionListener("_netAppConfigRsp",this.Ti.netAppConfig),this._onAppConfigUpdate&&this._onAppConfigUpdate(this.Ti.netAppConfig)),[3,4];case 3:return l=d.sent(),this.ei.error(bs+" fail "+JSON.stringify(l)),n.setAttributes({error:null==l?void 0:l.code}),n.end(),[20012,20008,20019].includes(null==l?void 0:l.code)&&(f=20019===(null==l?void 0:l.code)?JSON.parse(JSON.stringify(J.SDK_NOT_SPECIAL)):JSON.parse(JSON.stringify(J.APPID_INVALID)),this.Ti.roomModulesList.forEach((function(t){t.roomTryHandler&&t.roomTryHandler.loginFail(f)}))),[3,4];case 4:return[2]}}))}))},i.prototype.us=function(t,i,n){},i.prototype.os=function(t,i,n,e,s){var r=this,o=rt,u=this.Ci.createSpan(U.I,{key:Z.event},{key:""},o.event);u.setAttributes({svr_env:o.svr_env(this.Ti.testEnvironment?"test":"online"),token:o.token(e)}),s&&(vn(s.userUpdate)&&u.setAttribute("user_state_update",o.user_state_update(s.userUpdate?1:0)),dn(s.maxMemberCount)&&u.setAttributes({max_member_cnt:o.max_member_cnt(s.maxMemberCount)}));return{interResolve:function(i){var e,s=r.getRoomSessionID(n),h=r.getRoomModules(n),a=r.getSessionId(n);u.setAttributes({room_id:o.room_id(n),room_sid_string:o.room_sid_string(s),liveroom_sid_string:o.liveroom_sid_string(a),try_cnt:o.try_cnt(null===(e=null==h?void 0:h.roomTryHandler)||void 0===e?void 0:e.retryActiveCount),room_mode:o.room_mode(r.Ti.isMultiRoom?1:0),role:o.role(r.Ti.role),audience_create_room:o.audience_create_room(r.Ti.roomCreateFlag?1:0),max_member_cnt:o.max_member_cnt((null==h?void 0:h.maxMemberCount)||0)}),u.end(),t(i)},interReject:function(t,e){var s,h,a;void 0===e&&(e=""),u.setAttributes({room_id:o.room_id(n)}),t.code<2e9&&t.code>1e9||t.code<1e6?(h=He(t.code,t.msg),a=je(t.code)):h={code:t.code,message:t.msg},h&&r.Ci.setError(u,{code:h.code,msg:h.message+e}),a&&J[a]&&(t.code=J[a].code,console.error("login error",JSON.stringify(t)),(null===(s=t.msg)||void 0===s?void 0:s.includes("unknown"))&&(t.msg=J[a].msg)),i(t.code&&t.msg&&""!==e?{code:t.code,msg:t.msg+e}:t)},loginSpan:u}},i.prototype.logoutRoom=function(t){var i=this;this.ei.info(Es+" call by user "+t);var n=[];if(this.Ti.roomModulesList.length){if(void 0===t)Io([],this.Ti.roomModulesList,!0).forEach((function(t){i.hs(t),n.push(t.roomID),t.roomHandler.logout(!0)}));else{if(!_n(t)||""==t)return this.ei.error(Es+" roomID must be string and not empty"),void this.hs(void 0,lt.error.INPUT_PARAM);var e=this.getRoomModules(t);e?(this.hs(e),n.push(t),e.roomHandler.logout()):(this.ei.error(Es+" room not exist"),this.hs(void 0,lt.error.ROOM_NOT_EXIST,t))}this.Ci.deleteCommonAttributes(["id_name"]),this.Ci.clearRoomSpans(n)}else this.ei.warn(Es+" no room")},i.prototype.uploadLog=function(){var t=this;return new Promise((function(i,n){t.ei.info("zm.zip.udlg call"),t.ei.uploadStorageLog().then((function(){t.ei.info("zm.zip.udlg call success"),i({errorCode:0,extendedData:"upload logs success!"})})).catch((function(i){t.ei.error("zm.zip.udlg upload zip log failed, result: "+((null==i?void 0:i.message)||"unknown")),n({errorCode:J.UPLOAD_LOG_ERROR.code,extendedData:J.UPLOAD_LOG_ERROR.msg+", result: "+((null==i?void 0:i.message)||"unknown")})}))}))},i.prototype.sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(B),i()}))},i.prototype._sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(B),i()}))},i.prototype.sendBroadcastMessage=function(t,i){return new Promise((function(t,i){console.error(B),i()}))},i.prototype._sendBroadcastMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(B),i()}))},i.prototype.setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(B),i()}))},i.prototype._setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(B),i()}))},i.prototype.sendBarrageMessage=function(t,i){return new Promise((function(t,i){console.error(B),i()}))},i.prototype._sendBarrageMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(B),i()}))},i.prototype.sendRelayMessage=function(t,i,n,e,s){console.error("not support")},i.prototype.requestJoinLive=function(t,i,n,e,s){return console.error(B),!1},i.prototype.inviteJoinLive=function(t,i,n,e,s){return console.error(B),!1},i.prototype.endJoinLive=function(t,i,n,e){return console.error(B),!1},i.prototype.respondJoinLive=function(t,i,n,e,s){return console.error(B),!1},i.prototype.getVersion=function(){return this.version},i.prototype.setSdkBizVersion=function(t){_n(t)&&""!==t&&(this.Ti.bizVersion=t)},i.prototype.on=function(t,i){var n=this.Ci.createSpan(U.H,{key:K},{key:""},nt.event);return n.setAttributes({listener:nt.listener(t)}),this.Ti.listenerList[t]?gn(i)?(-1==this.Ti.listenerList[t].indexOf(i)&&this.Ti.listenerList[t].push(i),n.end(),!0):(this.ei.error(Rs+" listener callBack must be funciton"),this.Ci.setError(n,nt.error.INPUT_PARAM," listener callBack must be function"),!1):(this.ei.error(Rs+" event "+t+" no found"),this.Ci.setError(n,nt.error.INPUT_PARAM," event "+t+" no found"),!1)},i.prototype.off=function(t,i){var n=this.Ci.createSpan(U.H,{key:K},{key:""},et);if(n.setAttributes({listener:st(t)}),!this.Ti.listenerList[t])return this.ei.error(ws+" listener no found"),this.Ci.setError(n,nt.error.INPUT_PARAM," event "+t+" no found"),!1;var e=this.Ti.listenerList[t];if(i){var s=e.indexOf(i);s>=0&&e.splice(s,1)}else this.Ti.listenerList[t]=[];return n.end(),!0},i.prototype._on=function(t,i){return this.Ti.listenerList[t]?gn(i)?(-1==this.Ti.listenerList[t].indexOf(i)&&this.Ti.listenerList[t].push(i),!0):(this.ei.error(Rs+" listener callBack must be funciton"),!1):(this.ei.error(Rs+" event "+t+" no found"),!1)},i.prototype._off=function(t,i){if(!this.Ti.listenerList[t])return this.ei.error(ws+" listener no found"),!1;var n=this.Ti.listenerList[t];return i?n.splice(n.indexOf(i),1):this.Ti.listenerList[t]=[],!0},i.prototype.isTestEnvironment=function(){return this.Ti.testEnvironment},i.prototype.isLogin=function(t){var i=this.getRoomModules(t)||this.Ti.roomModulesList[0];return!!i&&i.isLogin()},i.prototype.getMultiRoom=function(){return this.Ti.isMultiRoom},i.prototype.getAppID=function(){return this.Ti.appid},i.prototype.getUserID=function(){return this.Ti.idName},i.prototype.getUserName=function(){return this.Ti.nickName},i.prototype.getToken=function(t){return(this.getRoomModules(t)||this.Ti.roomModulesList[0]).token},i.prototype.setRoomCreateFlag=function(t){this.Ti.roomCreateFlag=t},i.prototype.setRole=function(t){this.Ti.role=t},i.prototype.getSessionId=function(t){var i=this.getRoomModules(t)||this.Ti.roomModulesList[0];return i?i.userSidString:"0"},i.prototype.getRoomSessionID=function(t){var i=this.getRoomModules(t)||this.Ti.roomModulesList[0];return i?i.roomSidString:"0"},i.prototype.getAppConfig=function(){return this.Ti.appConfig},i.prototype.setTestPackageSize=function(t){this.stateCenter.configOK&&(this.Ti.testNetPackageSize=t)},i.prototype.setAccess=function(t){},i.prototype.enableMultiRoom=function(t){var i=this.Ci.createSpan(U.H,{key:Z.event},{key:""},It.event);return vn(t)?(i.setAttribute("is_multi",It.is_multi(t)),this.Ti.roomModulesList.length>0||this.Ti.setMultiRoom?(this.ei.error(Is+" multi room can only be set once before first login"),this.Ci.setError(i,It.error.kInvalidParamError),!1):(i.end(),this.Ti.isMultiRoom=t,this.Ti.setMultiRoom=!0,!0)):(this.ei.error(Is+" param must be boolean"),this.Ci.setError(i,It.error.kAlreadyLoginError),!1)},i.prototype.getRoomModules=function(t){return this.Ti.roomModulesList.find((function(i){return i.roomID==t}))},i.prototype._onAppConfigUpdate=function(t){},i.prototype._onBeforePageUnload=function(){},i.use=function(t){switch(t.type){case"Message":case"Live":t.install(i,yr,So)}},i.setEngineOptions=function(t){if(t.customDomain&&t.customDomain&&"object"==typeof t.customDomain){if(t.customDomain.accesshub&&"string"!=typeof t.customDomain.accesshub)throw new Error("config of customDomain.accesshub should be a string.");if(t.customDomain.logreport&&"string"!=typeof t.customDomain.logreport)throw new Error("config of customDomain.logreport should be a string.");if(t.customDomain.detaillog&&"string"!=typeof t.customDomain.detaillog)throw new Error("config of customDomain.detaillog should be a string.");i.customDomain=t.customDomain}i.engineOptions=t},i.prototype.resetRoomTokenTimer=function(t,i){var n=this.getRoomModules(t)||this.Ti.roomModulesList[0];n&&i&&i>0&&n.roomHandler.resetTokenTimer(1e3*i)},i.prototype.isDisConnect=function(){return this.liveRoomHandler.isDisConnect()},i.prototype.sendMessage=function(t,i,n,e){this.liveRoomHandler.sendMessage(t,i,n,e)},i.prototype.getNetworkInfo=function(){return{timestamp:0,maxDeviation:0}},i.prototype.setProtoFormat=function(t){if(void 0===t&&(t="json"),!["json","pb"].includes(t))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.Ti.protoFormat=t},i.prototype.setSdkLoginRelateService=function(t){Array.isArray(t)&&t.every((function(t){return _n(t)}))&&(this.Ti.relateService=t)},i.prototype.getRoomID=function(){return this.Ti.roomid},i.prototype.getServerTimeOffset=function(){return this.Ti.serverTimeOffset},i.prototype.getReqHead=function(t){var i;return i=_n(t)&&""!==t&&this.getRoomModules(t)||this.Ti.roomModulesList[0],this.liveRoomHandler.getReqHead(i)},i.prototype.sendSwitchMessage=function(t,i){throw this.ei.error("".concat("zm.ssm"," ").concat(J.WHITE_BOARD_VERSION_ERROR.msg)),J.WHITE_BOARD_VERSION_ERROR},i.prototype.onSwitchMessage=function(t){t&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=t)},i.prototype.onAppConfigUpdate=function(t){t&&(this._onAppConfigUpdate=t)},i.prototype.onBeforePageUnload=function(t){t&&(this._onBeforePageUnload=t)},i.prototype.getProtoVer=function(){return t.SWITCH_TWO},i.prototype.sendBusinessMessage=function(t,i,n){return dn(t)&&i?this.liveRoomHandler.sendMessage(t,i,void 0,void 0,n,void 0,!1):-1},i.prototype.hs=function(t,i,n){var e=this,s=lt.event,r=this.Ci.getAPIErrorReport(s);if(i)r&&this.Ci.takeAPIErrorReport(s,i,r);else{var o=this.Ci.createSpan(U.I,{key:Z.event},{key:s,par:null==t?void 0:t.roomID},s,!0);if(o.setAttributes({is_multi:lt.is_multi(this.Ti.isMultiRoom),is_send_cmd_net:lt.is_send_cmd_net(!0)}),t){var u=t.roomHandler;u.updateTimes(),o.setAttributes({room_id:lt.room_id(null==t?void 0:t.roomID),room_sid_string:lt.room_sid_string(null==t?void 0:t.roomSidString),liveroom_sid_string:lt.liveroom_sid_string(null==t?void 0:t.userSidString),valid_d:u.validTime,total_d:u.totalTime,tempbroken_cnt:u.brokenCounts})}else _n(n)&&o.setAttributes({room_id:lt.room_id(n),valid_d:0,total_d:0,tempbroken_cnt:0});i?this.Ci.setError(o,i):o.end(),setTimeout((function(){e.Ci.flush()}),200)}},i.prototype.getMsgSpan=function(t,i,n){return void 0===n&&(n=!1),this.Ci.createSpan(U.H,{key:rt.event,par:i},{key:t,par:i},t,n)},i.prototype.Ke=function(){var t=this;dn(this.netAgent.timeOffset)&&this.Ci.setTimeOffset(this.netAgent.timeOffset),this.cs=setTimeout((function(){t.Ke()}),9e5)},i.prototype.setNetAgentHBMode=function(t){this.netAgent.setHeartBeatMode(t)},i.customDomain={},i.proxyCtrl=null,i.pageID="",i}(),Co=Re,ko="zb.sh.usi",Do=function(){function t(t,i,n,e,s){this.ei=t,this.Ti=i,this.rtm=n,this.yi=e,this.Wi=s,this.ls=0,this.fs=0,this.ds=0,this._s=!1,this.vs=null,this.ps=2e3,this.gs=5e3,this.mixStreamTaskList={},this.mixRequestIdList=[],this.mixStreamHbList={},this.roomID=s,this.logger=t,this.stateCenter=i}return Object.defineProperty(t.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reporter",{get:function(){return this.Ci},enumerable:!1,configurable:!0}),t.prototype._setCDNInfo=function(t,i){var n=i.urls_flv,e=i.urls_m3u8,s=i.urls_flv_plus,r=i.urls_m3u8_plus,o=i.urls_https_flv,u=i.urls_https_m3u8,h=i.urls_rtmp;t.urlFlv=bn(n)?n[0]||"":_n(n)?n:"",t.urlHls=bn(e)?e[0]||"":_n(e)?e:"",t.urlFlvPlus=bn(s)?s[0]||"":_n(s)?s:"",t.urlHlsPlus=bn(r)?r[0]||"":_n(r)?r:"",t.urlHttpsFlv=bn(o)?o[0]||"":_n(o)?o:"",t.urlHttpsHls=bn(u)?u[0]||"":_n(u)?u:"",t.urlRtmp=bn(h)?h[0]||"":_n(h)?h:""},t.prototype.onStreamUpdated=function(t,i,n){},t.prototype.onStreamExtraInfoUpdated=function(t,i){},t.prototype.onStreamAttrUpdated=function(t,i){},t.prototype.handleStreamStart=function(t,i){var n="zb.sh.hss";yn(this.ei,n,"stream update"),this.room=i,t.body?(this.ps=t.body.stream_list_hb_wait_merge_time||2e3,this.gs=t.body.stream_list_push_merge_timeout||5e3,this._s=!1,this.handleFullUpdateStream(t.body.stream_seq,t.body.stream_info||[]),this._handleReconnectStream(t.body.stream_info),Tn(this.ei,n)):this.ei.error(n+" server response wrong")},t.prototype.onFullUpdateStream=function(t){},t.prototype.onPublishStateUpdate=function(t,i,n){},t.prototype._updateStreamInfo=function(t,i,n,e,s){var r,o,u=this;void 0===n&&(n=""),yn(this.ei,ko);var h=n,a=null===(r=this.room)||void 0===r?void 0:r.streamList.find((function(i){return i.stream_id===t}));a||this.ei.info(ko+" stream not in room cmd "+i);var c={stream_id:t,extra_info:h};if(2002!==i&&2003!==i||(c.stream_sid=(null==a?void 0:a.stream_sid)||""),2001===i&&this.yi.publisherList[t]){var l=this.yi.publisherList[t].publishOption;c.inspect_flag=(null==l?void 0:l.inspectFlag)||0}var f=JSON.stringify(c),d={sub_cmd:i,stream_msg:f,third_token:null===(o=this.room)||void 0===o?void 0:o.token},_=this.room,v=this.rtm.liveRoomHandler.sendStreamUpdate(d,(function(n,s){u.handleStreamUpdateRsp(n,t,i),e&&e(n,s)}),(function(r,o){var h=u.room,a=u.rtm.stateCenter.roomModulesList.find((function(t){return t.roomID===(null==h?void 0:h.roomID)})),c=function(){return(null==a?void 0:a.isTryLogin())||"CONNECTING"===(null==a?void 0:a.roomState)},l=function(){u.ei.warn(ko+" resend stream update "+i),u._updateStreamInfo(t,i,n,e,s)};if(h&&((null==a?void 0:a.isLogin())||c())&&r.code&&r.code==Gn.code&&h.streamInfoList[t].seq==o){setTimeout((function(){if(2001==i&&u.Ti.publishStreamList[t]&&u.Ti.publishStreamList[t].state==mi||2002==i)if(c()){var n=function(t,i){var e=function(){u.rtm.stateCenter.offListener("_roomStateUpdate",n)};t===(null==h?void 0:h.roomID)&&"CONNECTED"===i?(l(),e()):t===(null==h?void 0:h.roomID)&&"DISCONNECTED"===i&&e()};u.rtm.stateCenter.onListener("_roomStateUpdate",n)}else l();else s&&s(Gn)}),0)}else if(r.body&&r.body.err_code){var f=u.Ti.getServerError(r.body.err_code,r.body.err_message);[1011,1000002002].includes(f.code)&&(f=Zn),s&&s(f,o),i===gi&&u.onPublishStateUpdate(tn,t,f)}}),{sessionID:null==_?void 0:_.sessionID,roomID:null==_?void 0:_.roomID,roomSessionID:null==_?void 0:_.roomSessionID});[2001,2002].includes(i)&&(this.room.streamInfoList[t]={seq:v}),Rn(this.ei,ko,"cmd: "+i+", roomid: ".concat(null==_?void 0:_.roomID,", stream: ").concat(t))},t.prototype.updateStreamInfo=function(t,i,n,e,s){var r=this;if(void 0===n&&(n=""),this.room){var o;if(2001===i||2002===i)(o=this.Ci.createSpan(U.H,{key:me,par:this.Wi},{key:""},Ee)).setAttributes({stream_update_type:Se(2001===i?"stream added":2002===i?"stream deleted":""),stream_extra_info:ye(n),stream_id:Te(t)});this._updateStreamInfo(t,i,n,(function(t,n){[2001,2002].includes(i)&&(o.setAttributes({send_seq:n}),o&&o.end()),e&&e(t,n)}),(function(t,n){[2001,2002].includes(i)&&(o.setAttributes({send_seq:n}),r.Ci.setError(o,t)),s&&s(t,n)}))}else this.ei.warn(ko+" "+kn)},t.prototype.handleStreamUpdateRsp=function(t,i,n){var e,s,r,o;if(this.rtm.isDisConnect())this.ei.warn("zb.sh.hsur not login");else if(0==t.body.err_code){this.ei.info("zb.sh.hsur stream seq "+this.fs+" server seq "+t.body.stream_seq);var u=this.room;if(u){if(null===(e=null==t?void 0:t.body)||void 0===e?void 0:e.token_remain_time)this.Ti.getRoomByRoomID(null===(s=null==t?void 0:t.header)||void 0===s?void 0:s.room_id)?this.rtm.resetRoomTokenTimer(t.header.room_id,t.body.token_remain_time):this.ei.error("zb.sh.hsur room no found ignore "+JSON.stringify(null===(r=t.header)||void 0===r?void 0:r.room_id));this.handleStreamSync(t,i,n);var h=u.streamInfoList[i],a=null===(o=t.header)||void 0===o?void 0:o.seq;h&&h.seq===a?delete u.streamInfoList[i]:this.ei.info("zb.sh.hsur ".concat(JSON.stringify(i)," udp stream info; rsp seq: ").concat(a,", cur seq: ").concat(null==h?void 0:h.seq," "))}else this.ei.info("hsur.0 room no found")}else this.ei.error("zb.sh.hsur stream update error "+t.body.err_code)},t.prototype.handleStreamSync=function(t,i,n){if(this.handleStreamRsp(this.room,i,{stream_id:i,stream_sid:t.body.stream_sid,stream_ver:t.body.stream_ver,stream_nid:t.body.stream_nid,id_name:this.Ti.idName,nick_name:this.Ti.nickName},n),t.body.stream_seq>this.fs+1)return this.ei.info("zb.sh.hss.1 seq diff server: "+t.body.stream_seq+" client "+this.fs),void this.fetchStreamList();this.fs=t.body.stream_seq;var e=this.room.streamList.find((function(t){return t.stream_id==i}));e&&t.body.stream_ver>e.stream_ver&&this.fetchStreamList(i)},t.prototype.handleStreamRsp=function(t,i,n,e){var s=this.Ti.publishStreamList[i],r=t.streamList.find((function(t){return t.stream_id==i}));if(this.ei.info("hsur.0 cmd "+e+" "+!!r),r&&2002===e){var o=t.streamList.findIndex((function(t){return t.stream_id==i}));this.ei.info("hsur.0 stream index "+o),o>-1&&t.streamList.splice(o,1)}s?(s.state==mi&&(s.state=pi,2001!==e||r||t.streamList.push(n),this.onPublishStateUpdate(Qi,i,{code:0,message:""})),r&&r.stream_sid!==n.stream_sid&&(this.ei.info("hsur.0 update sid. "+i+" origin:"+r.stream_sid+", new:"+n.stream_sid),r.stream_sid=n.stream_sid)):this.ei.info("hsur.0 stream is not exist")},t.prototype.handleFetchStreamListRsp=function(t,i){var n,e,s,r,o,u,h="zb.sh.hfslr";if(yn(this.ei,h,i),this._s=!1,this.Ci.spanEnd({key:Co.event,par:this.Wi},{stream_seq:Co.stream_seq(null===(n=t.body)||void 0===n?void 0:n.stream_seq),stream_size:Co.stream_size(null===(s=null===(e=t.body)||void 0===e?void 0:e.stream_info)||void 0===s?void 0:s.length),stream_list:Co.stream_list(null===(r=t.body)||void 0===r?void 0:r.stream_info),error:(null===(o=null==t?void 0:t.body)||void 0===o?void 0:o.err_code)||(null==t?void 0:t.code),message:(null===(u=null==t?void 0:t.body)||void 0===u?void 0:u.err_message)||(null==t?void 0:t.msg)}),0===t.body.err_code)if(this.fs!==t.body.stream_seq){if(this.fs>t.body.stream_seq)return this.ei.error(h+" less seq"),void this.fetchStreamList(i);if(this.ds>t.body.stream_seq)this.ei.info(h+" less than max fetch stream seq ");else{var a=t.body.stream_info;i&&(a=t.body.stream_info.filter((function(t){return t.stream_id===i}))),this.handleFullUpdateStream(t.body.stream_seq,a),Rn(this.ei,h)}}else this.ei.info(h+" same seq");else this.ei.info(h+" server error=",t.body.err_code)},t.prototype.syncPublishStreamList=function(){var t="zb.sh.spsl";yn(this.ei,t);var i=function(t){var i=n.Ti.publishStreamList[t];if(i.state===pi){var e=n.room.streamList.findIndex((function(i){return i.stream_id===t}));if(i.roomID===n.room.roomID&&-1===e)i.state=mi,n.updateStreamInfo(t,gi,i.extra_info,(function(t){}))}},n=this;for(var e in this.Ti.publishStreamList)i(e);Rn(this.ei,t)},t.prototype.handleFullUpdateStream=function(t,i){var n=this,e="zb.sh.hfus";yn(this.ei,e),this.fs=t,this.ds<t&&(this.ds=t),this.ei.debug(e+" server seq "+this.fs),i=i.filter((function(t){return 1!==t.stream_type})),this.Ti.mergeStreamList(this.Ti.idName,this.room.streamList,i,(function(t,i,s,r){0!==t.length&&(n.ei.debug(e+" callback addstream"),n.onStreamUpdated(n.Wi,Si,n.makeCallbackStreamList(t))),0!==i.length&&(n.ei.debug(e+" callback delstream"),n.onStreamUpdated(n.Wi,yi,n.makeCallbackStreamList(i))),0!==s.length&&(n.ei.debug(e+" callback updatestream"),n.onStreamExtraInfoUpdated(n.Wi,n.makeCallbackStreamList(s))),0!==r.length&&(n.ei.warn(e+" callback updateAttrstream"),n.onStreamAttrUpdated(n.Wi,n.makeCallbackStreamList(r)))})),this.syncPublishStreamList(),Rn(this.ei,e)},t.prototype.handlePushStreamUpdateMsg=function(t){var i="zb.sh.hpsum";yn(this.ei,i,JSON.stringify(t));var n=t.body.stream_info;if(n&&0!==n.length){if(n=n.filter((function(t){return 1!==t.stream_type})),this.fs+1!==t.body.stream_seq)return yn(this.ei,i,"updatestream 1"),void this.fetchStreamList();if(t.body.stream_seq<this.ds)return yn(this.ei,i,"updatestream 2"),void this.fetchStreamList();switch(this.fs=t.body.stream_seq,t.body.stream_cmd){case Oi:this.bs(n);break;case Ii:this.Es(n);break;case Ni:this._handleUpdatedStreamList(n)}Rn(this.ei,i)}else this.ei.info(i+", emtpy list")},t.prototype.bs=function(t){var i="zb.sh.hasl";yn(this.ei,i);for(var n,e=[],s=0;s<t.length;s++)if(t[s].anchor_id_name!=this.Ti.idName&&t[s].id_name!=this.Ti.idName&&t[s].user_id!==this.Ti.idName){n=!1;for(var r=0;r<this.room.streamList.length;r++)if(t[s].stream_id===this.room.streamList[r].stream_id){n=!0;break}n||e.push(t[s])}else this.ei.debug("hdsl.0 have self stream added");if(0!==e.length){this.ei.debug(i+" callback addstream");for(var o=0;o<e.length;o++){this.room.streamList.push(e[o]);var u=this.yi.playerList[e[o].stream_id];null==u||u.player.setStreamAdd()}this.onStreamUpdated(this.Wi,Si,this.makeCallbackStreamList(e))}Rn(this.ei,i)},t.prototype.Es=function(t){var i="zb.sh.hdsl";yn(this.ei,i);for(var n=[],e=0;e<t.length;e++)if(t[e].anchor_id_name!=this.Ti.idName&&t[e].id_name!=this.Ti.idName&&t[e].user_id!==this.Ti.idName){for(var s=this.room.streamList.length-1;s>=0;s--)if(t[e].stream_id===this.room.streamList[s].stream_id){this.room.streamList.splice(s--,1),n.push(t[e]);break}}else this.ei.debug(i+" have self stream deleted");0!==n.length&&(this.ei.debug(i+" callback delstream"),this.onStreamUpdated(this.Wi,yi,this.makeCallbackStreamList(n))),Tn(this.ei,i)},t.prototype._handleUpdatedStreamList=function(t){var i="zb.sh.husl";yn(this.ei,i);for(var n=[],e=[],s=0;s<t.length;s++)if(t[s].anchor_id_name!=this.Ti.idName&&t[s].id_name!=this.Ti.idName&&t[s].user_id!==this.Ti.idName){for(var r=0;r<this.room.streamList.length;r++)if(t[s].stream_id===this.room.streamList[r].stream_id){t[s].extra_info!==this.room.streamList[r].extra_info&&(this.room.streamList[r]=t[s],n.push(t[s])),t[s].stream_attr_opts&&JSON.stringify(t[s].stream_attr_opts)!==JSON.stringify(this.room.streamList[r].stream_attr_opts)&&(this.room.streamList[r]=t[s],e.push(t[s]));break}}else this.ei.debug("hsul.0 have self stream updated");0!==n.length&&(this.ei.debug(i+" callback updatestream"),this.onStreamExtraInfoUpdated(this.Wi,this.makeCallbackStreamList(n))),0!==e.length&&(this.ei.warn(i+" callback updateAttrStream"),this.onStreamAttrUpdated(this.Wi,this.makeCallbackStreamList(e))),Rn(this.ei,i)},t.prototype.fetchStreamList=function(t){var i,n,e,s=this,r="zb.sh.fsl";yn(this.ei,r);var o=this.Ci.createSpan(U.H,{key:me,par:this.Wi},{key:Co.event,par:this.Wi},Co.event,!0);return this.rtm.isDisConnect()?(this.ei.info(r+" state error"),void this.Ci.setError(o,Co.error.NOT_LOGIN)):this._s?(this.ei.info(r+" already doing"),void this.Ci.setError(o,Co.error.ai," already doing")):(this._s=!0,this.ei.info(r+" send fetch request"),this.rtm.liveRoomHandler.getStreamList({},(function(i){s.handleFetchStreamListRsp(i,t)}),(function(t){}),{roomID:null===(i=this.room)||void 0===i?void 0:i.roomID,sessionID:null===(n=this.room)||void 0===n?void 0:n.sessionID,roomSessionID:null===(e=this.room)||void 0===e?void 0:e.roomSessionID}),void Rn(this.ei,r))},t.prototype._handleReconnectStream=function(t){var i,n,e,s,r,o,u,h="zb.sh.hrs";yn(this.ei,h);var a=this.yi.publisherList;this.ei.info(h+" publish "+Object.keys(this.yi.publisherList));var c=function(h){if((null===(n=null===(i=a[h])||void 0===i?void 0:i.room)||void 0===n?void 0:n.roomID)!==l.Wi)return"continue";var c=t.find((function(t){return t.stream_id==h})),f=c&&!(c.anchor_id_name===l.Ti.idName||c.id_name===l.Ti.idName||c.user_id===l.Ti.idName);if(l.ei.info("zb.sh.hrs stream ".concat(h," ").concat(!!c," ").concat(f," ").concat(null===(e=a[h].publisher)||void 0===e?void 0:e.state)),(null===(s=a[h].publisher)||void 0===s?void 0:s.state)!=oi&&a[h].state!==ai||c&&!f){if(((null===(r=a[h].publisher)||void 0===r?void 0:r.state)==ui||a[h].state===ci)&&!(null===(u=null===(o=a[h])||void 0===o?void 0:o.retryStreamHandler)||void 0===u?void 0:u.maxTimer)&&t.find((function(t){return t.stream_id==h}))){l.updateStreamInfo(h,bi);for(var d=0;d<l.room.streamList.length;d++)if(l.room.streamList[d].stream_id==h){l.room.streamList.splice(d--,1);break}}}else l.updateStreamInfo(h,gi,l.Ti.publishStreamList[h].extra_info)},l=this;for(var f in a)c(f);Tn(this.ei,h)},t.prototype.makeCallbackStreamList=function(t){var i,n=[];this.Ti.appConfig&&(i=this.Ti.appConfig.media_config.play_config.resource_info.filter((function(t){return[ei.CDN,ei.DG].includes(t.resource_type)})));if(t&&t.length>0)for(var e=0;e<t.length;e++){var s=t[e].stream_id;if(i&&i.length)for(var r=0;r<i.length;r++){for(var o=i[r].resource_type==ei.DG?"_plus":"",u=[],h=[],a=[],c=0;c<i[r].service_info.length;c++){var l=i[r].service_info[c],f=l.protocol,d=l.url_template.replace("{STREAM_NAME}",s);switch(f){case si.FLV:u.push(d);break;case si.HLS:h.push(d);break;case si.RTMP:a.push(d)}}t[e]["urls_flv"+o]=u,t[e]["urls_m3u8"+o]=h,t[e]["urls_rtmp"+o]=a}var _={user:{userID:t[e].anchor_id_name||t[e].id_name,userName:t[e].anchor_nick_name||t[e].nick_name},extraInfo:t[e].extra_info,streamID:t[e].stream_id,roomID:"",urlFlv:"",urlFlvPlus:"",urlRtmp:"",urlHls:"",urlHlsPlus:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:t[e].stream_gid,closeType:t[e].close_type,stream_attr_opts:t[e].stream_attr_opts};this._setCDNInfo(_,t[e]),n.push(_)}return n},t.prototype.sendHttpPBRequest=function(t,i,n,e,s){var r,o;null===(r=this.rtm.netAgent)||void 0===r||r.startHttpRequest2({interfaceID:t.interfaceID,resID:t.resID||"",body:i,ack:!1,idName:this.Ti.idName,method:2,token:(null===(o=this.room)||void 0===o?void 0:o.token)||"",mode:this.Ti.testEnvironment?2:1,reduceRspHeaders:!0},(function(t,i){n&&n(t,i)}),(function(t){e&&e(t)}),null,{timeout:(null==s?void 0:s.timeout)||4e3,extras:{protoCmd:t.protoCmd}})},t.prototype.sendMixRequest=function(t,i,n,e,s){var r=this;void 0===s&&(s=2);var o=function(o,u){var h=o.status_code,a=o.body,c=o.code,l=o.message;return mn(c)||0===c?h&&200!==h?(s--,void(502===h&&s>0?r.sendMixRequest(t,i,n,e,s):e&&e(h,a))):void(n&&n(a,u)):c===Gn.code&&s>0?(s--,void r.sendMixRequest(t,i,n,e,s)):void(e&&e(-1,{},{code:c,message:l}))};this.sendHttpPBRequest(t,i,(function(t,i){o(t,i)}),(function(t){o(t)}))},t.prototype.sendRTMPRequest=function(t,i,n,e){var s=this.rtm.netAgent,r=this.Ti.appid,o=i.streamID,u="/v1/jsrtmp/dispatch/".concat(t,"/").concat(o,"/").concat(i.actionType,"/").concat(s.clientIP),h=this.room;s.startHttpRequest({service:1,headers:[{name:"Token-Appid",val:r+""},{name:"Token-Str",val:(null==h?void 0:h.token)||""},{name:"Token-Userid",val:this.Ti.idName},{name:"Token-Biztype",val:"2"},{name:"Net-Mode",val:this.Ti.netMode+""}],body:{},idName:this.Ti.idName,method_no:1,ack:!1,location:u},(function(t){n(t)}),(function(t,i,n){e(t)}))},t.prototype._publishTarget=function(t,i,n){},t.prototype.updateStreamExtraInfo=function(t,i,n,e){yn(this.ei,"zb.sh.usei");var s=Ei;this.Ti.publishStreamList[t]&&this.Ti.publishStreamList[t].state>=mi?(this.Ti.publishStreamList[t].extra_info=i,this.updateStreamInfo(t,s,i,n,e)):this.Ti.publishStreamList[t]&&this.Ti.publishStreamList[t].state===vi?(this.Ti.publishStreamList[t].extra_info=i,n({errorCode:0})):e(ke.error.gi)},t.prototype.getMixStreamStatus=function(t){},t.prototype.setStreamExtraInfo=function(t,i,n,e){this.updateStreamExtraInfo(t,i,n,e)},t.prototype._publishTargetWeb=function(t,i,n){},t.prototype.patchStreamList=function(t){var i=this;if(dn(t.body.stream_refresh)&&0!==t.body.stream_refresh)return this.ei.info(rs+" stream refresh "),void this.fetchStreamList();this.ei.info(rs+" stream seq "+this.fs+" "+JSON.stringify(this.vs)),t.body.stream_seq>this.fs&&!this.vs&&(this.vs={},yn(this.ei,rs,"update stream "+this.fs+" server "+t.body.stream_seq),this.Ss&&clearTimeout(this.Ss),this.Ss=setTimeout((function(){i.handleMergeTimeout()}),this.ps)),this.ls=t.body.stream_seq},t.prototype.getStreamSeq=function(){return this.fs},t.prototype.mergeStreamByStreamSeq=function(t,i,n){var e=this;this.vs||(this.ei.warn(es+" new merge stream list "+this.fs+" server "+i),this.vs={},this.Ss&&clearTimeout(this.Ss),this.Ss=setTimeout((function(){e.handleMergeTimeout()}),this.gs)),this.ei.info(es+" ".concat(this.vs," ").concat(t," ").concat(i," ").concat(n)),this.vs[i]={cmd:t,streamList:n}},t.prototype.handleMergeTimeout=function(){if(this.vs){var t=Object.keys(this.vs).map((function(t){return+t})).sort((function(t,i){return t-i}));t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.ls?this.mergeStream(t):(this.vs=null,this.fetchStreamList())}},t.prototype.mergeStream=function(t){var i=this;this.ei.info(ss+" merge streamList "+this.fs+" streamSeqList "+t.join(","));var n=t[t.length-1],e=[];t.forEach((function(t){if(i.vs&&i.vs[t])switch(i.vs[t].cmd){case Oi:i.vs[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i),e.push(t)}));break;case Ii:i.vs[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i)}));break;case Ni:i.vs[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i),e.push(t)}))}})),this.vs=null,this.ei.info(ss+" "+e),this.handleFullUpdateStream(n,e)},t.prototype.reset=function(){this.ls=0,this.vs=null,this.mixStreamTaskList={},this.mixRequestIdList=[],this.mixStreamHbList={},this.Ss&&(clearTimeout(this.Ss),this.Ss=void 0),this.ps=2e3,this.gs=5e3},t}(),zo="/sdk/init",Ao="/sdk/check_system",Po={kCheckSystemGetSettingFailError:{code:1101001,message:"wx get setting fail"}},Mo=fe,xo={event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:xn,ys:Qn,kPublishStreamIDTooLongError:Mn,kPublishStreamIDInvalidCharacterError:Un,Ts:Gn,Rs:Kn,ws:Xn,Os:qn,Is:Pn,Ns:ie,Cs:ee},publishOption:fe,stream:fe,message:fe},Uo="/sdk/api/play_request",qo={kPlayStreamIDNullError:xn,ks:re,kPlayStreamIDTooLongError:Mn,Ds:Un,zs:Pn,As:te,Ps:he,Ms:Gn,xs:Kn,Us:Xn,qs:qn,Ls:oe,Gs:ue},Lo=fe,Go=fe,Ho="/sdk/stop_publish",jo="/sdk/stop_play",$o="/liveroom/get_stream_update_info",Bo=fe,Vo=fe,Jo="/liveroom/get_stream_extra_info",Fo=fe,Yo=function(){return Yo=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},Yo.apply(this,arguments)},Wo=function(){function t(t,i,n,e,s){this.ei=t,this.dataReport=i,this.Ti=n,this.yi=e,this.rtm=s,this.preferPublishSourceType=Pi.ultra,this.ultraPlaySourceType="rtmp_v2"}return t.prototype.startPublishingStream=function(t,i){var n=this;return new Promise((function(e,s){var r;n.ei.info(h+" call");var o=fn();n.Ti.reportSeqList.startPublish[t]=o,n.dataReport.newReport(o,xo.event);var u=function(i,e){n.ei.error(h+" "+(e||i.message)),n.dataReport.uploadReport(o,void 0,i,e),delete n.Ti.reportSeqList.startPublish[t],s(Yo(Yo({},i),{errorCode:i.code,extendedData:i.message+(e?" "+e:"")}))};if(Fe(t))if(_n(t)){if(!Ye(t,256))return u(xo.error.kPublishStreamIDTooLongError),!1;if(!In(t))return u(xo.error.kPublishStreamIDInvalidCharacterError),!1;if(n.Ti.isMultiRoom&&(!i||!_n(i.roomID)||""==i.roomID))return u(xo.error.ys,"  roomID is need if set multi room"),!1;if(i&&!mn(i.inspectFlag)){if(!dn(i.inspectFlag))return u(xo.error.ys,"  inspectFlag must be number"),!1;if(![0,1].includes(i.inspectFlag))return u(xo.error.ys,"  inspectFlag is not in range"),!1}var a=(null==i?void 0:i.roomID)?i.roomID:null===(r=n.Ti.roomList[0])||void 0===r?void 0:r.roomID,c=n.Ti.getRoomByRoomID(a);if(n.dataReport.addMsgInfo(o,{stream:xo.stream(t),publish_room_id:a}),c){if(n.Ti.customUrl&&0!=n.Ti.customUrl.length){n.Ti.publishStreamList[t]={state:_i,extra_info:i&&i.extraInfo?i.extraInfo:null,roomID:a};var l=n.yi.updatePublishingState(c,t,i||void 0,!0);if(!0!==l){var f=JSON.parse(JSON.stringify(l));return void u(f,"cannot start publish")}return n.yi.publishSuccessCallBackList[t]=function(t,i){e({streamID:t,url:i})},n.yi.startPublishingStream(t,n.Ti.customUrl,1)}if(n.rtm.isDisConnect())u(xo.error.Is);else{var d=n.yi.updatePublishingState(c,t,i||void 0,!0);if(!0===d)Ue("kZegoTaskPublishStart"+t,n.dataReport,o,n.Ti.reportList),c.streamHandler.onPublishStateUpdate(nn,t,{code:0,message:""}),n.dataReport.addMsgInfo(o,{publishOption:xo.publishOption(i),mini_sys_infos:n.yi.systemInfo}),!i||"CDN"!=i.sourceType&&"BGP"!=i.sourceType||n.setPreferPublishSourceType(Mi[i.sourceType]),n.Ti.publishStreamList[t]={state:_i,extra_info:i&&i.extraInfo?i.extraInfo:null,roomID:null==c?void 0:c.roomID},n.ei.info(h+" fetch stream url"),qe("kZegoTaskPublishStart"+t,n.Ti.reportList,rn,"get_publish_url"),n.yi.publishSuccessCallBackList[t]=function(t,i){qe("kZegoTaskPublishStart"+t,n.Ti.reportList,un,"get_publish_url"),e({streamID:t,url:i})},n.yi.publishErrorCallBackList[t]=function(t){u(t)},n.fetchPublishStreamUrl(t,c);else{f=JSON.parse(JSON.stringify(d));u(f,"cannot start publish")}}}else u(xo.error.ys,"room no found")}else u(xo.error.ys);else u(xo.error.kPublishStreamIDNullError)}))},t.prototype.setPreferPublishSourceType=function(t,i){return this.ei.info(u+" call"),t!==Pi.cdn&&t!==Pi.ultra&&t!==Pi.customUrl?(this.ei.error(u+" sourceType only can be number 0 1 2"),!1):t!==Pi.customUrl||_n(i)&&""!=i?(this.preferPublishSourceType=t,this.customCdnUrl=i,this.ei.info(u+" call success"),!0):(this.ei.error(u+" customUrl must be string and not empty"),!1)},t.prototype.fetchPublishStreamUrl=function(t,i){var n=this;if(this.ei.info(c+" call"),this.ei.info(c+" send fetch publish request"),this.preferPublishSourceType==Pi.cdn){var e=this.yi.getCDNUrl(t,1).rtmps;e&&e.length?this.doPublishStream(t,e,i):this.handleStreamPublishFail(t,i,"the cdn url is empty from app config")}else{this.yi.eventSeq+=1;var s=this.yi.eventSeq,r=this.yi.publisherList[t],o=r.dispatchRetryHandler;o.initRequestInfo({actionType:"push",streamID:t},i),o.initCallback((function(e){e.seq=s,n.handleFetchStreamPublishUrlRsp(e,t,i.roomID)}),(function(e){var s=void 0;(null==e?void 0:e.code)&&"message"in e&&(s=e),n.handleStreamPublishFail(t,i,void 0,s)})),r.dispatchRetryHandler.startMaxTime(),r.dispatchRetryHandler.active(!0),this.Ti.streamUrlMap[s]=t}this.ei.info(c+" call success")},t.prototype.handleFetchStreamPublishUrlRsp=function(t,i,n){this.ei.info(l+" call");var e=this.Ti.getRoomByRoomID(n);if(e){this.Ti.streamUrlMap[null==t?void 0:t.seq]&&delete this.Ti.streamUrlMap[null==t?void 0:t.seq];var s=t.code;if(0!==s)return this.ei.info(l+" server error= "+s),void(this.Ti.publishStreamList[i]&&(this.ei.error(l+" liveRoom cmd error"),this.handleStreamPublishFail(i,e,"server error="+s)));t.hosts&&this.doPublishStream(i,t.hosts||[],e)}else this.ei.error(l+" room no found")},t.prototype.handleStreamPublishFail=function(t,i,n,e){var s=e||xo.error.ws;this.ei.error("zw.pu.hspf.0 "+(n=n||s.message)),this.yi.publishErrorCallBackList[t](s),this.yi.stopPublishingStream(t,{code:s.code,message:n})},t.prototype.doPublishStream=function(t,i,n){return this.ei.info(f+" call "+t+"streamUrl: "+JSON.stringify(i)),this.Ti.publishStreamList[t]?(this.Ti.publishStreamList[t].state=vi,!i||i.length<=0?(this.handleStreamPublishFail(t,n),!1):(this.yi.startPublishingStream(t,i,this.preferPublishSourceType),this.ei.info(f+" call success"),!0)):(this.ei.error(f+" cannot find stream"),!1)},t.prototype.stopPublishingStream=function(t,i){var n,e,s=this;this.ei.info(a+" call "+t);var r=fn();this.dataReport.newReport(r,Ho),this.dataReport.addMsgInfo(r,{stream_id:t,room_id:null===(e=null===(n=this.yi.publisherList[t])||void 0===n?void 0:n.room)||void 0===e?void 0:e.roomID});var o=function(i,n){s.ei.error(a+" "+(n||i.message)),s.dataReport.uploadReport(r,void 0,i,n),delete s.Ti.reportSeqList.startPublish[t]};if(!Fe(t))return o(xo.error.kPublishStreamIDNullError),!1;if(!_n(t))return this.ei.error(a+" param error"),o(xo.error.ys),!1;var u=this.yi.publisherList[t];return(null==u?void 0:u.room)?(this.yi.stopPublishingStream(t,void 0,i),this.dataReport.uploadReport(r),this.ei.info(a+" call success"),!0):(o(xo.error.ys," room no found"),!1)},t}(),Xo=function(){return Xo=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},Xo.apply(this,arguments)},Zo=function(){function t(t,i,n,e,s){this.ei=t,this.dataReport=i,this.Ti=n,this.yi=e,this.rtm=s,this.mixStreamList={},this.streamUrlRspList={},this.preferPlaySourceType=zi.ultra,this.ultraPlaySourceType="rtmp_v2"}return Object.defineProperty(t.prototype,"isDisConnect",{get:function(){return this.rtm.isDisConnect()},enumerable:!1,configurable:!0}),t.prototype.startPlayingStream=function(t,i){var n=this;return new Promise((function(e,s){n.ei.info(d+" call "+t);var r=fn();n.Ti.reportSeqList.startPlay[t]=r,n.dataReport.newReport(r,Uo);var o=function(i,e){n.ei.error(d+" "+(e||i.message)),n.dataReport.uploadReport(r,void 0,i,e),delete n.Ti.reportSeqList.startPlay[t],s(Xo(Xo({},i),{errorCode:i.code,extendedData:i.message+(e?" "+e:"")}))};if(Fe(t))if(_n(t))if(Ye(t,256))if(In(t)){if(n.Ti.customPlayUrl&&0!=n.Ti.customPlayUrl.length){var u=n.yi.updatePlayingState(t,i?i.streamParams:void 0,!0);if(!0!==u){var h=JSON.parse(JSON.stringify(u));return void o(h,"cannot start play")}return n.yi.playErrorCallBackList[t]=function(t){o(t)},n.yi.startPlayingStream(t,n.Ti.customPlayUrl,1)}if(n.isDisConnect)o(qo.zs);else{var a=n.yi.updatePlayingState(t,i?i.streamParams:void 0,!0);if(!0===a){if(n.yi.onPlayStateUpdate(sn,t,{code:0,message:""}),Ue("kZegoTaskPlayStart"+t,n.dataReport,r,n.Ti.reportList),n.dataReport.addMsgInfo(r,{stream:Go(t),playOption:Lo(i),mini_sys_infos:n.yi.systemInfo}),n.yi.playSuccessCallBackList[t]=function(t,i){qe("kZegoTaskPlayStart"+t,n.Ti.reportList,un,"get_play_url"),e({streamID:t,url:i})},n.yi.playErrorCallBackList[t]=function(i){qe("kZegoTaskPlayStart"+t,n.Ti.reportList,un,"get_play_url"),o(i)},i&&i.isMix){n.mixStreamList[t]={ultra_url_rtmp:null};var c="BGP"==i.sourceType,l=c?"rtmp_v2":"rtmp_cdn",f=c?Pi.ultra:Pi.cdn;return n.ei.info(d+" play mix: "+"".concat(l,", ").concat(f)),void n.fetchPlayStreamUrl(t,l,f)}qe("kZegoTaskPlayStart"+t,n.Ti.reportList,rn,"get_play_url"),i&&"CDN"==i.sourceType||n.preferPlaySourceType===zi.cdn?n.startPlayingStreamFromCDN(t):n.startPlayingStreamFromBGP(t)}else{h=JSON.parse(JSON.stringify(a));o(h)}}}else o(qo.Ds);else o(qo.kPlayStreamIDTooLongError);else o(qo.ks);else o(qo.kPlayStreamIDNullError)}))},t.prototype.stopPlayingStream=function(t,i){var n;this.ei.info(_+" call "+t);var e=fn();if(this.dataReport.newReport(e,jo),this.dataReport.addMsgInfo(e,{stream_id:t,room_id:null===(n=this.yi.playerList[t])||void 0===n?void 0:n.room.roomID}),!_n(t)||""==t)return this.ei.error(_+" stream ID must be string and not empty"),this.dataReport.addMsgInfo(e,qo.ks),void this.dataReport.uploadReport(e);var s=this.yi.playerList[t],r=s&&s.state!==ci;for(var o in this.yi.stopPlayingStream(t,void 0,i),r&&this.yi.onPlayStateUpdate(en,t,{code:0,message:""}),this.Ti.streamUrlMap)if(this.Ti.streamUrlMap[o]===t){delete this.Ti.streamUrlMap[o];break}this.mixStreamList[t]&&delete this.mixStreamList[t],this.dataReport.uploadReport(e),this.ei.info(_+" call success")},t.prototype.startPlayingStreamFromCDN=function(t){this.ei.info(v+" call "+t);var i=this.Ti.getPlayRoom(t)||this.Ti.roomList[0];if(!i)return this.ei.error(v+" room no found"),!1;for(var n=null,e=0;e<i.streamList.length;e++)if(i.streamList[e].stream_id===t){n=i.streamList[e].urls_rtmp||[];break}if(!n||n.length<=0){var s;if(!(s=this.yi.getCDNUrl(t,0).rtmps)||!s.length)return this.ei.error(v+" cannot find stream url,Please check if CDN is configured "),this.yi.onPlayStateUpdate(en,t,qo.Us),!1;this.ei.info(v+"from app config"),n=s}return this.ei.info(v+" play stream"),this.doPlayStream(t,n,Pi.cdn)},t.prototype.startPlayingStreamFromBGP=function(t){return this.ei.info("zw.pl.spsfb fetch stream url"),this.fetchPlayStreamUrl(t,this.ultraPlaySourceType,Pi.ultra),!0},t.prototype.doPlayStream=function(t,i,n){return this.ei.info("zw.pl.dps call"),this.yi.startPlayingStream(t,i,n),!0},t.prototype.fetchPlayStreamUrl=function(t,i,n){var e=this;if(this.ei.info(m+" call "+t),this.isDisConnect)this.ei.info(m+" state error");else{this.ei.info(m+" send fetch request");var s=this.Ti.roomList[0].roomID,r=this.Ti.getRoomByRoomID(s);if(this.yi.eventSeq+=1,r){if(n==Pi.cdn){var o=this.yi.getCDNUrl(t,0).rtmps;o&&o.length?this.doPlayStream(t,o,n):this.handleStreamUrlFail(t,qo.Us.code)}else{var u=this.yi.eventSeq,h=this.yi.playerList[t],a=h.dispatchRetryHandler;a.initRequestInfo({actionType:"pull",streamID:t},r),a.initCallback((function(i){i.seq=u,e.handleFetchStreamUrlRsp(i,n,t,s)}),(function(i){e.handleStreamUrlFail(t,i.code)})),h.dispatchRetryHandler.startMaxTime(),h.dispatchRetryHandler.active(!0),this.Ti.streamUrlMap[u]=t,this.yi.playerList[t]&&(this.yi.playerList[t].seq=u)}this.ei.info(m+" call success")}else this.ei.error(m+" room no found")}},t.prototype.handleFetchStreamUrlRsp=function(t,i,n,e){var s,r;this.ei.info(p+" call ");var o;if(r=t.code,this.Ti.streamUrlMap[o=t.seq]&&delete this.Ti.streamUrlMap[o],0!==r)return this.ei.error(p+" server error= "+r),void this.handleStreamUrlFail(n,r);var u=[];t.hosts&&t.hosts.length>0&&(u=t.hosts);var h=!1,a=this.Ti.getRoomByRoomID(e);if(a)if(o===(null===(s=this.yi.playerList[n])||void 0===s?void 0:s.seq)){for(var c=0;c<a.streamList.length;c++)if(a.streamList[c].stream_id==n){a.streamList[c].urltra_url_rtmp=u,h=!0;break}!h&&this.mixStreamList[n]&&(this.mixStreamList[n].urltra_url_rtmp=u,i=Pi.cdn,h=!0),h||(this.ei.info(p+"cannot find streamInfo in existing stream list"),this.streamUrlRspList[n]=u),this.doPlayStream(n,u,i),this.ei.info(p+" call success")}else this.ei.info(p+" seq is not match, ignore "+n);else this.ei.error(p+" room no found")},t.prototype.handleStreamUrlFail=function(t,i){var n=qo.Us;switch(i){case 1900001004:n=qo.Ps;break;case jn.code:n=jn}this.yi.onPlayStateUpdate(en,t,n)},t.prototype.setPreferPlaySourceType=function(t){return this.ei.info(e+" call"),t!==zi.cdn&&t!==zi.ultra?(this.ei.error(e+" sourceType can be number 0 or 1, which can be represented auto or ultra"),!1):(this.preferPlaySourceType=t,this.ei.info(e+" call success"),!0)},t}(),Ko=function(t,i){var n,e={10001:"",10002:""};n=wx.getSystemInfoSync().SDKVersion;var s={code:0,msg:""};(function(t,i){t=t.split("."),i=i.split(".");for(var n=Math.max(t.length,i.length);t.length<n;)t.push("0");for(;i.length<n;)i.push("0");for(var e=0;e<n;e++){var s=parseInt(t[e]),r=parseInt(i[e]);if(s>r)return 1;if(s<r)return-1}return 0})(n,"1.7.0")<0&&(s={code:10001,msg:e[10001]},t&&t(s)),wx.getSetting({success:function(i){var n=i.authSetting;n["scope.camera"]&&n["scope.record"]||(s={code:10002,msg:e[10002]}),t&&t(s)},fail:function(t){console.error("get setting error",t),i&&i(t)}})},Qo=function(){function t(t,i,n,e){this.yi=t,this.Ti=i,this.ei=n,this.rtm=e}return Object.defineProperty(t.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),t.prototype.setStreamExtraInfo=function(t,i){var n=this;return new Sn((function(e,s){var r=n.yi.getRoomByStreamID(t),o=ke,u=n.Ci.createSpan(U.H,r?{key:me,par:null==r?void 0:r.roomID}:{key:ge},{key:""},o.event);u.setAttributes({stream_id:o.stream_id(t),stream_extra_info:o.stream_extra_info(i)});var h=function(t,i){void 0===i&&(i=""),n.ei.error("zb.ssei "+i),n.Ci.setError(u,t,i),s({errorCode:t.code,extendedData:t.message+" "+i})};_n(t)&&""!=t?_n(i)&&""!=i?n.rtm.isDisConnect()?h(o.error.li,"not login"):n.Ti.publishStreamList[t]?r?r.streamHandler.setStreamExtraInfo(t,i,(function(t,i){var r,h,a,c;if(0===(null===(r=null==t?void 0:t.body)||void 0===r?void 0:r.err_code)||0===(null==t?void 0:t.errorCode))u.setAttributes({send_seq:o.send_seq(i)}),u.end(),e({errorCode:0===(null===(h=null==t?void 0:t.body)||void 0===h?void 0:h.err_code)?null===(a=null==t?void 0:t.body)||void 0===a?void 0:a.err_code:null==t?void 0:t.errorCode,extendedData:""});else{var l={errorCode:(null===(c=null==t?void 0:t.body)||void 0===c?void 0:c.err_code)||(null==t?void 0:t.code)};n.Ci.setError(u,l),s(l)}}),h):h(o.error.li,"not login"):h(o.error.ci):h(o.error.ai,"extraInfo must be string and no empty"):h(o.error.ai,"streamID must be string and not empty")}))},t}(),tu=function(){function t(t,i,n,e,s,r){this.ei=t,this.dataReport=i,this.reporter=n,this.Ti=e,this.rtm=r,this.currentPlaySourceType=Pi.cdn,this.mixStreamList={},this.ultraPlaySourceType="rtmp_v2",this.yi=s,this.publishModule=new Wo(this.ei,this.dataReport,this.Ti,this.yi,this.rtm),this.playModule=new Zo(this.ei,this.dataReport,this.Ti,this.yi,this.rtm),this.streamCommon=new Qo(s,e,t,r),this.init(),this.initStreamCDN()}return Object.defineProperty(t.prototype,"logger",{get:function(){return this.ei},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateCenter",{get:function(){return this.Ti},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamCenter",{get:function(){return this.yi},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.bindRTMListener(),this.bindStreamCenterHandler()},t.prototype.initStreamCDN=function(){},t.prototype.bindRTMListener=function(){var t=this;this.rtm._on("roomLoginResponse",(function(i){t.ei.info("zc.rlr call "+JSON.stringify(i));var n=i.header.room_id;t.Ti.appid=t.rtm.getAppID(),t.Ti.idName=t.rtm.getUserID(),t.Ti.testEnvironment=t.rtm.isTestEnvironment(),t.Ti.isMultiRoom=t.rtm.getMultiRoom();var e=t.rtm.getToken(n),s=t.rtm.getSessionId(n),r=t.rtm.getRoomSessionID(n),o=t.Ti.getRoomByRoomID(n);if(!o){var u=new Do(t.ei,t.Ti,t.rtm,t.yi,n);t.bindStreamHandler(u),t.Ti.roomList.push(o={roomID:n,streamHandler:u,sessionID:s,roomSessionID:r,token:e,isResetRoom:!1,streamList:[],streamInfoList:[],dataChannelManager:null})}if(o.sessionID=s,o.roomSessionID=r,o.token=o.token,o.streamHandler.handleStreamStart(i,o),t.ei.info("zc.rlr unsendmsg "+JSON.stringify(t.Ti.unSendMessageList)),t.Ti.unSendMessageList.length>0)for(var h=function(i){var e=t.Ti.unSendMessageList[i],s=e.streamid,r=e.cmd,u=e.stream_extra_info;if(n===e.roomID){var h=o.streamList.findIndex((function(t){return t.stream_id===s}));t.ei.warn("zc.rlr stream index "+h),2002===r&&h>=0&&(t.ei.warn("zc.rlr resend "+r+" "+s),o.streamHandler.updateStreamInfo(s,r,u),o.streamList.splice(h,1)),t.Ti.unSendMessageList.splice(i,1)}},a=t.Ti.unSendMessageList.length-1;a>=0;a--)h(a);t.ei.info("zc.rlr end "+n)})),this.rtm._on("_appConfigRsp",(function(){t.ei.info("zw.acr call "),t.Ti.appConfig=t.rtm.getAppConfig()})),this.rtm._on("_userTransUpdate",(function(i,n,e){var s=t.Ti.getRoomByRoomID(i);s?"pushstatus"===n||"mixpushstatus"===n&&s.streamHandler.getMixStreamStatus(e):t.ei.error("zw.opur room no found")})),this.rtm._on("HBResponse",(function(i){var n,e=null===(n=null==i?void 0:i.header)||void 0===n?void 0:n.room_id,s=t.Ti.getRoomByRoomID(e);null==s||s.streamHandler.patchStreamList(i)})),this.rtm._on("_roomStateUpdate",(function(i,n,e,s){if("DISCONNECTED"==n){t.ei.info("zw.w.brl _roomStateUpdate "+i+" disconnected "+(e?e+" ":"")+(s||""));var r=t.Ti.getRoomByRoomID(i);if(r){var o=t.Ti.roomList.findIndex((function(t){return t.roomID==i}));r.isResetRoom=!0,r.streamHandler.reset(),t.yi.reset(i,e,0===e),t.Ti.roomList.splice(o,1)}}else t.ei.info("zc.rsu "+i+" state: "+n)})),this.rtm.liveRoomHandler.handlePushStreamMsg=function(i){var n,e=(null===(n=null==i?void 0:i.header)||void 0===n?void 0:n.room_id)||"",s=t.Ti.getRoomByRoomID(e);i.body.stream_cmd=i.header.sub_cmd,i.body.stream_info=i.body.stream_info_list,delete i.body.stream_info_list,null==s||s.streamHandler.handlePushStreamUpdateMsg(i)}},t.prototype.bindStreamHandler=function(t){var i=this;t.onStreamUpdated=function(t,n,e){var s=e.map((function(e){var s=i.playModule.streamUrlRspList[e.streamID];if(s&&1===n){var r=i.Ti.getRoomByRoomID(t),o=r.streamList.findIndex((function(t){return t.stream_id==e.streamID}));-1!==o&&r.streamList[o]&&(r.streamList[o].urltra_url_rtmp=s)}else 1!==n&&delete i.playModule.streamUrlRspList[e.streamID];return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),r=fn();if(i.dataReport.newReport(r,$o),i.dataReport.addMsgInfo(r,{stream_update_type:Bo(1===n?"added":"deleted"),update_stream:Vo(e)}),i.dataReport.uploadReport(r),i.Ti.actionListener("roomStreamUpdate",t,function(t){return 0==t?"DELETE":"ADD"}(n),s),1===n){var o=[];s.forEach((function(t){t.extraInfo&&o.push({streamID:t.streamID,user:t.user,extraInfo:t.extraInfo})})),o.length>0&&i.Ti.actionListener("streamExtraInfoUpdate",t,o)}},t.onPublishStateUpdate=function(t,n,e){i.ei.info("zw.w.opsu "+n);var s=i.Ti.reportSeqList.startPublish[n];i.yi.publishingList[n]&&(0==t||1==t)&&s&&(i.dataReport.eventEndWithMsgInfo(s,"PublishState",{type:t}),1==t&&i.dataReport.addMsgInfo(s,e),i.dataReport.uploadReport(s),1012===e.code&&i.yi.stopPublishingStream(n),delete i.Ti.reportSeqList.startPublish[n]),i.Ti.actionListener("publisherStateUpdate",{state:Ve(t),streamID:n,errorCode:e.code,extendedData:e.message})},t.onStreamExtraInfoUpdated=function(t,n){var e=n.map((function(t){return{streamID:t.streamID,user:t.user,extraInfo:t.extraInfo}})),s=fn();i.dataReport.newReport(s,Jo),i.dataReport.addMsgInfo(s,{update_stream:Fo(e)}),i.dataReport.uploadReport(s),i.Ti.actionListener("streamExtraInfoUpdate",t,e)}},t.prototype.bindStreamCenterHandler=function(){var t=this;this.yi.onPlayStateUpdate=function(i,n,e){var s=t.Ti.reportSeqList.startPlay[n];t.yi.playingList.find((function(t){return t.streamID===n}))&&(0==i||1==i)&&s&&(t.dataReport.eventEndWithMsgInfo(s,"PlayState",{type:i}),t.dataReport.uploadReport(s,void 0,1==i&&e?e:void 0),delete t.Ti.reportSeqList.startPlay[n]),t.Ti.actionListener("playerStateUpdate",{state:Je(i),streamID:n,errorCode:e&&e.code,extendedData:e&&e.message}),1===i&&t.yi.playErrorCallBackList[n]&&(t.yi.playErrorCallBackList[n](e),delete t.yi.playErrorCallBackList[n])},this.yi.onPublishStateUpdate=function(i,n,e){t.onPublishStateUpdateHandle(i,n,e)},this.yi.onPublishQualityUpdate=function(i,n){t.Ti.actionListener("publishQualityUpdate",i,n)},this.yi.onPlayQualityUpdate=function(i,n){t.Ti.actionListener("playQualityUpdate",i,n)}},t.prototype.onPublishStateUpdateHandle=function(t,i,e){var s=this;this.ei.info(n+" call");var r=this.yi.publisherList[i].room;if(r)if(0==t){if(this.Ti.publishStreamList[i]){var o=!r.streamList.find((function(t){return t.stream_id==i&&(t.anchor_id_name==s.Ti.idName||t.id_name==s.Ti.idName||t.user_id===s.Ti.idName)})),u=this.Ti.publishStreamList[i].state;if(this.ei.info("zc.opsuh.0  state: ".concat(u,", in room: ").concat(o)),u==vi&&o)this.Ti.publishStreamList[i].state=mi,r.streamHandler.updateStreamInfo(i,gi,this.Ti.publishStreamList[i].extra_info,(function(t){})),this.dataReport.uploadReport(this.Ti.reportSeqList.startPublish[i]),delete this.Ti.reportSeqList.startPublish[i],Ge("kZegoTaskPublishStart"+i,this.Ti.reportList);else this.Ti.publishStreamList[i].state=pi,r.streamHandler.onPublishStateUpdate(t,i,e),this.dataReport.uploadReport(this.Ti.reportSeqList.startPublish[i]),delete this.Ti.reportSeqList.startPublish[i],Ge("kZegoTaskPublishStart"+i,this.Ti.reportList)}}else r.streamHandler.onPublishStateUpdate(t,i,e),1==t&&(this.ei.info(n+" stop publish called by sdk"),this.publishModule.stopPublishingStream(i));else this.ei.error("zc.opsuh.0 "+kn)},t.prototype.bindListener=function(t,i){return this.ei.info(s+" call"),this.Ti.listenerList[t]?gn(i)?(-1==this.Ti.listenerList[t].indexOf(i)&&this.Ti.listenerList[t].push(i),!0):(this.ei.error(s+" listener callBack must be function"),!1):(this.ei.error(s+" event "+t+" no found"),!1)},t.prototype.deleteListener=function(t,i){if(this.ei.info(r+" call"),!this.Ti.listenerList[t])return this.ei.error(r+" listener no found"),!1;var n=this.Ti.listenerList[t];return i?n.splice(n.indexOf(i),1):this.Ti.listenerList[t]=[],!0},t.prototype.checkSystemRequirements=function(){var t=this;return new Sn((function(i,n){var e=t.Ti.reporter.createSpan(U.H,{key:zo},{key:""},Ao);Ko((function(t){e.setAttributes({capability:Mo(t)}),e.end(),i(t)}),(function(i){t.Ti.reporter.setError(e,Po.kCheckSystemGetSettingFailError),n(i)}))}))},t.prototype.updatePlayerState=function(t,i){this.ei.info("zw.w.ups call "+t),this.yi.updatePlayerState(t,i)},t.prototype.updatePlayerNetStatus=function(t,i){this.ei.info("zw.w.upns call "+t),this.yi.updatePlayerNetStatus(t,i)},t.prototype.updateAudioVolumeNotify=function(t,i){this.yi.updateAudioVolumeNotify(t,i)},t.prototype.getNextUrl=function(t){return _n(t)&&""!=t?this.yi.getNextUrl(t):(this.ei.error("zw.w.gnu stream ID must be string and not empty"),"")},t.prototype.setCustomSignalUrl=function(t,i){if(void 0===i&&(i=!0),this.ei.info(o+" call: "+JSON.stringify(t)),!t||0==t.length)return this.ei.error(o+" param error"),!1;var n=!0;t.forEach((function(t){return 0!=t.indexOf("rtmp://")&&(n=!1)})),n?i?this.Ti.customUrl=t:this.Ti.customPlayUrl=t:this.ei.error(o+" url is not correct")},t.prototype.destroy=function(){},t}(),iu=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},nu=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},eu=function(){function t(t,i,n,e){this.wxContext=t,this.dataAtr=i,this.zegoWechatMini=n,this.defaultAttributes={enableCamera:!0,enableMic:!0},this.attributes={},this.isPublishing=!1,this.ei=this.zegoWechatMini.ei,this.context=wx.createLivePusherContext(),Object.assign(this.attributes,this.defaultAttributes),Object.assign(this.attributes,e)}return t.prototype.setWXData=function(t){if(this.wxContext&&this.dataAtr)if(void 0===t||gn(t)){var i={};i[this.dataAtr]=this.attributes,this.wxContext.setData(i,t)}else this.ei.info("zw.p.0.swd callBack is not function");else this.ei.error("zw.p.0.swd context wrong")},t.prototype.iswxContext=function(){return!!this.wxContext},t.prototype.setPusherAttributes=function(t,i){this.ei.info("zw.p.0.spa call "+JSON.stringify(t)),Object.assign(this.attributes,t),this.setWXData(i),this.ei.info("zw.p.0.spa call success "+JSON.stringify(this.attributes))},t.prototype.startPreview=function(t){this.ei.info("zw.p.0.sp.0 call");try{this.context.startPreview(t)}catch(t){this.ei.error("zw.p.0.sp.0 error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.sp.0 call success")},t.prototype.stopPreview=function(t){this.ei.info("zw.p.0.sp.1 call");try{this.context.stopPreview(t)}catch(t){this.ei.error("zw.p.0.sp.1 error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.sp.1 call success")},t.prototype.start=function(t,i){var n=this;return new Promise((function(e,s){return iu(n,void 0,void 0,(function(){var n,r,o=this;return nu(this,(function(u){switch(u.label){case 0:if(!_n(t))return this.ei.error("zw.p.0.s.0 streamID type error"),[2];this.ei.info("zw.p.0.s.0 call "+t),this.attributes.id=t,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.zegoWechatMini.startPublishingStream(t,i)];case 2:return n=u.sent(),this.attributes.url=n.url,this.isPublishing=!0,this.setWXData((function(){o.ei.info("zw.p.0.s.0 set url")})),this.context.start({success:function(){o.ei.info("zw.p.0.s.0 publish success"),e()},fail:function(t){o.ei.error(JSON.stringify(t)),s(t)}}),[3,4];case 3:return r=u.sent(),this.ei.error("zw.p.0.s.0 "+JSON.stringify(r)),s(r),[3,4];case 4:return[2]}}))}))}))},t.prototype.pause=function(t){this.ei.info("zw.p.0.p call");try{this.context.pause(t)}catch(t){this.ei.error("zw.p.0.p error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.p call success")},t.prototype.resume=function(t){this.ei.info("zw.p.0.r call");try{this.context.resume(t)}catch(t){this.ei.error("zw.p.0.r error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.r call success")},t.prototype.stop=function(){this.ei.info("zw.p.0.s.1 call"),this.attributes.id||this.ei.error("zw.p.0.s.1 publish id no found");try{this.context&&this.context.stop(),this.attributes.id&&this.zegoWechatMini.stopPublishingStream(this.attributes.id),this.attributes={},Object.assign(this.attributes,this.defaultAttributes),this.isPublishing=!1,this.setWXData()}catch(t){return void this.ei.error("zw.p.0.s.1 "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.s.1 call success")},t.prototype.snapshot=function(t){this.ei.info("zw.p.0.ss call");try{this.context.snapshot(t)}catch(t){this.ei.error("zw.p.0.ss error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.ss call success")},t.prototype.playBGM=function(t){this.ei.info("zw.p.0.pb.0 call");try{this.context.playBGM(t)}catch(t){this.ei.error("zw.p.0.pb.0 error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.pb.0 call success")},t.prototype.pauseBGM=function(t){this.ei.info("zw.p.0.pb.1 call");try{this.context.pauseBGM(t)}catch(t){this.ei.error("zw.p.0.pb.1 error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.pb.1 call success")},t.prototype.resumeBGM=function(t){this.ei.info("zw.p.0.rb call");try{this.context.resumeBGM(t)}catch(t){this.ei.error("zw.p.0.rb error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.rb call success")},t.prototype.stopBGM=function(t){this.ei.info("zw.p.0.sb call");try{this.context.stopBGM(t)}catch(t){this.ei.error("zw.p.0.sb error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.sb call success")},t.prototype.setBGMVolume=function(t){this.ei.info("zw.p.0.sbv call");try{this.context.setBGMVolume(t)}catch(t){this.ei.error("zw.p.0.sbv error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.sbv call success")},t.prototype.setMICVolume=function(t){this.ei.info("zw.p.0.smv call");try{this.context.setMICVolume(t)}catch(t){this.ei.error("zw.p.0.smv error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.smv call success")},t.prototype.switchCamera=function(t){this.ei.info("zw.p.0.sc call");try{this.context.switchCamera(t)}catch(t){this.ei.error("zw.p.0.sc error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.sc call success")},t.prototype.toggleTorch=function(t){this.ei.info("zw.p.0.tt call");try{this.context.toggleTorch(t)}catch(t){this.ei.error("zw.p.0.tt error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.0.tt call success")},t}(),su=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},ru=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},ou=function(){function t(t,i,n,e){this.wxContext=t,this.streamID=i,this.zegoWechatMini=n,this.attributes={},this.isPlaying=!1,this.ei=this.zegoWechatMini.ei,this.attributes.id=i,this.context=wx.createLivePlayerContext(this.attributes.id,e||this.wxContext)}return t.prototype.setPlayerAttributes=function(t,i){this.ei.info("zw.p.1.spa call "+this.streamID+" "+JSON.stringify(t)),Object.assign(this.attributes,t),this.zegoWechatMini.setPlayData(i),this.ei.info("zw.p.1.spa call success "+this.streamID+" "+JSON.stringify(this.attributes))},t.prototype.play=function(t){var i=this;return new Promise((function(n,e){return su(i,void 0,void 0,(function(){var i,s,r=this;return ru(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),this.ei.info("zw.p.1.p.0 call "+this.streamID),[4,this.zegoWechatMini.startPlayingStream(this.streamID,t)];case 1:return i=o.sent().url,this.attributes.url=i,this.isPlaying=!0,this.zegoWechatMini.setPlayData((function(){r.ei.info("zw.p.1.p.0 start play url")})),this.context.play({success:function(){r.ei.info("zw.p.1.p.0 start play success"),n(!0)},fail:function(){r.ei.error("zw.p.1.p.0 start play fail"),e()},complete:function(){r.ei.info("zw.p.1.p.0 start play complete")}}),n(!0),[3,3];case 2:return s=o.sent(),this.ei.error("zw.p.1.p.0 start play catch fail "+JSON.stringify(s)),e(s),[3,3];case 3:return[2]}}))}))}))},t.prototype.stop=function(){var t=this;this.ei.info("zw.p.1.s call stop "+this.streamID),this.isPlaying||this.ei.info("zw.p.1.s stream is not playing"),this.context&&this.context.stop(),this.streamID&&(this.zegoWechatMini.stopPlayingStream(this.streamID),this.zegoWechatMini.wechatMiniModules.yi.livePlayerList=this.zegoWechatMini.wechatMiniModules.yi.livePlayerList.filter((function(i){return i.streamID!==t.streamID}))),this.isPlaying=!1,this.zegoWechatMini.setPlayData(),this.ei.info("zw.p.1.s call success")},t.prototype.pause=function(t){this.ei.info("zw.p.1.p.1 pull pause call "+this.streamID);try{this.context.pause(t)}catch(t){this.ei.error("zw.p.1.p.1 pull pause error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.p.1 pull pause success")},t.prototype.resume=function(t){this.ei.info("zw.p.1.r call "+this.streamID);try{this.context.resume(t)}catch(t){this.ei.error("zw.p.1.r error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.r call success")},t.prototype.mute=function(t){this.ei.info("zw.p.1.m mute call "+this.streamID);try{this.context.mute(t)}catch(t){this.ei.error("zw.p.1.m pull mute error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.m mute success")},t.prototype.requestFullScreen=function(t){this.ei.info("zw.p.1.rfs call "+this.streamID);try{this.context.requestFullScreen(t)}catch(t){this.ei.error("zw.p.1.rfs error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.rfs call success")},t.prototype.exitFullScreen=function(t){this.ei.info("zw.p.1.efs call "+this.streamID);try{this.context.exitFullScreen(t)}catch(t){this.ei.error("zw.p.1.efs error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.efs call success")},t.prototype.requestPictureInPicture=function(t){this.ei.info("zw.p.1.rpip call "+this.streamID);try{this.context.requestPictureInPicture(t)}catch(t){this.ei.error("zw.p.1.rpip error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.rpip call success")},t.prototype.exitPictureInPicture=function(t){this.ei.info("zw.p.1.epip call "+this.streamID);try{this.context.exitPictureInPicture(t)}catch(t){this.ei.error("zw.p.1.epip error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.epip call success")},t.prototype.snapshot=function(t){this.ei.info("zw.p.1.ss call "+this.streamID);try{this.context.snapshot(t)}catch(t){this.ei.error("zw.p.1.ss error "+(t?JSON.stringify(t):""))}this.ei.info("zw.p.1.ss call success")},t}(),uu=function(){this.publisherList={},this.playerList={}},hu=function(){function t(t,i){this.ei=t,this.Ti=i,this.attempt=0,this.Hs=.3,this.js=4.8,this.Bs=0,this.retryTimer=null,this.maxTimer=null,this.isOverTime=!1,this.RETRY_MAX_TIME=60}return t.prototype.setRetryRule=function(t){switch(this.Bs=t,t){case 1:this.Hs=.3,this.js=32;break;case 0:this.Hs=.3,this.js=4.8}},t.prototype.getRetryDelayByCount=function(t){var i;i=1===this.Bs?t+2:t<2?0:t;var n,e,s=Math.min(this.js,this.Hs*Math.pow(2,i)),r=(n=0,e=1e3*s,Math.floor(Math.random()*(e-n+1))+n);return this.ei.info("".concat("zc.hrh.grdbc"," ").concat(this.attempt," ").concat(s," ").concat(r)),r},t.prototype.initCallback=function(t,i){this.sucCallBack=t,this.failCallBack=i},t.prototype.startMaxTime=function(){var t,i=this;this.ei.info("".concat(us," ").concat(null===(t=this.requestInfo)||void 0===t?void 0:t.streamID," call")),this.maxTimer?this.ei.warn("".concat(us," max timer")):(this.maxTimer=setTimeout((function(){var t;i.ei.warn("".concat(us," ").concat(null===(t=i.requestInfo)||void 0===t?void 0:t.streamID," over max time ").concat(i.RETRY_MAX_TIME,"s, stop retry")),i.isOverTime=!0,i.requestFail(i._err)}),1e3*this.RETRY_MAX_TIME),this.ei.info("".concat(us," maxTimer=").concat(this.maxTimer)))},t.prototype.invalid=function(){this.clearRetryTimer(),this.attempt=0},t.prototype.clearRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},t.prototype.requestFail=function(t){this.invalid(),this.stopMaxTime(),this.failCallBack&&(this.failCallBack(t),this.resetCallback())},t.prototype.stopMaxTime=function(){this.ei.info("".concat("zc.hrh.smt.1"," stop max timer")),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.resetCallback=function(){this.sucCallBack=void 0,this.failCallBack=void 0},t}(),au=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),cu=function(t){function i(i,n){var e=t.call(this,i,n)||this;return e.ei=i,e.Ti=n,e.RETRY_MAX_TIME=300,e}return au(i,t),i.prototype.initRequestInfo=function(t,i){this.requestInfo=t,this.room=i},Object.defineProperty(i.prototype,"Vs",{get:function(){var t;if(this.Ti.appConfig){var i=this.Ti.appConfig.media_config.publish_config.resource_info.find((function(t){return t.resource_type===ei.RTC}));if(i){var n=null===(t=null==i?void 0:i.service_info)||void 0===t?void 0:t.find((function(t){return[si.RTMP].includes(t.protocol)}));if(n){var e=n.url_template.match(/[^\/]*\:\/\/[^\/]*\/([^\/]*)\/.*/);return e&&e[1]||void 0}}}},enumerable:!1,configurable:!0}),i.prototype.active=function(t){var i=this;if(void 0===t&&(t=!1),this.retryTimer)this.ei.warn("".concat(z," was actived, ignore"));else if(this.isOverTime)this.ei.warn("".concat(z," retry over time, stop retry"));else{var n=function(){i.clearRetryTimer();var n=i.Vs;n?i.room.streamHandler.sendRTMPRequest(n,i.requestInfo,(function(t){if(200===t.status_code){var e=JSON.parse(t.body);e.hosts=e.hosts&&e.hosts.map((function(t){return"rtmp://".concat(t,"/").concat(n,"/").concat(i.requestInfo.streamID)})),i.invalid(),i.stopMaxTime(),i.sucCallBack&&(i.sucCallBack(e),i.resetCallback())}else i.handleRequestFail(t)}),(function(t){i.handleRequestFail(t)})):i.handleRequestFail(jn),t||i.attempt++};if(t)n();else{var e=this.getRetryDelayByCount(this.attempt);this.retryTimer=setTimeout(n,e)}}},i.prototype.handleRequestFail=function(t){if(this._err=t,this.isOverTime)this.requestFail(t);else if(t.code===jn.code)this.requestFail(t);else{var i=t.status_code;(429===i||i>=500&&i<600)&&this.setRetryRule(1),this.active()}},i}(hu),lu=function(){return lu=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},lu.apply(this,arguments)},fu=function(){function t(t,i,n,e,s,r,o){this.ei=t,this.streamId=i,this.yi=n,this.dataReport=e,this.Ti=s,this.room=r,this.publishOption=o,this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=ci,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=Date.now(),this.seq=-1,this.netStatusUpdateTime=0,this.cacheQualityInfo={},this.isDoubledQuality=!1,this.dispatchRetryHandler=new cu(this.ei,this.Ti)}return t.prototype.resetPlayer=function(){this.state=ci},t.prototype.newPlayer=function(){this.resetPlayer();var t=this.getCurrentPlayerUrl(),i=t;0!=this.params.length&&(i=t+"?"+this.params);var n=Date.now();return i=i.indexOf("?")>-1?i+"&zgseq="+n+"&zgdid="+this.room.sessionID:i+"?zgseq="+n+"&zgdid="+this.room.sessionID,t!==this.currentUrl?(this.currentUrl=t,this.yi.onStreamUrlUpdate(this.streamId,i,this.playerType)):this.yi.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,"PlayBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PlayBegin","url",i),this.tryUrls.push(i)):(this.dataReport.eventStart(this.playerReportSeq,"PublishBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PublishBegin","url",i),this.tryUrls.push(i)):this.dataReport.addEventInfo(this.playerSeq,0==this.playerType?"PlayRetry":"PublishRetry","url",i),this.state=hi,!0},t.prototype.stopPlayer=function(){this.isDoubledQuality=!1,0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,"PlayStat",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,"PublishStat","quality",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,"PublishStat",{quality:this.playerInfo}))},t.prototype.tryStartPlayer=function(t){for(this.ei.info(C+" call");this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.ei.info(C+" index: "+this.playUrlIndex+", url: "+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.ei.info(C+" stream: "+this.streamId),this.resetPlayer();var i="";0==this.playerType?i="PlayEnd":1==this.playerType&&(i="PublishEnd",this.reportQualityStatics()),this.dataReport.addEvent(this.playerSeq,i,{error:t,reason:"no url to retry"}),this.yi.onPlayerStop(this.streamId,this.playerType,t)}},t.prototype.getPlayerUrl=function(){this.ei.info(D+" call "+this.streamId);var t=this.urls[++this.retryIndex%this.urls.length],i=t;0!=this.params.length&&(i=t+"?"+this.params);var n=Date.now();return i=i.indexOf("?")>-1?i+"&zgseq="+n+"&zgdid="+this.room.sessionID:i+"?zgseq="+n+"&zgdid="+this.room.sessionID,this.tryUrls.push(i),this.ei.info(D+" call streamId: "+this.streamId+" url: "+i),i},t.prototype.shouldRetryPlay=function(t){return 3001==t||3002==t||3003==t||3005==t},t.prototype.isPlayFailed=function(t){return[-2301,2101,2102].includes(t)},t.prototype.isPlaySuccess=function(t){return 2004===t},t.prototype.shouldRetryPublish=function(t){return 3001==t||3002==t||3003==t||3004==t||3005==t},t.prototype.isPublishFailed=function(t){return t<=-1301&&t>=-1311},t.prototype.isPublishSuccess=function(t){return 1002==t},t.prototype.updateEvent=function(t){var i=t.detail.code;if(this.ei.info(k+" ".concat(this.streamId," state code: ").concat(JSON.stringify(i))),0==this.playerType){if(this.playBegin||(this.playBegin=!0,xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)&&xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(rn,"play_begin")),this.isPlaySuccess(i))this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PlayRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PlayStat"),xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)&&(xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(on,"play_begin","try_urls",this.tryUrls),xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(un,"play_begin"),xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(rn,"play_state"))),this.ei.info(k+" play suc: "+this.streamId),this.state=ai,this.yi.onPlayerStart(this.streamId,this.playerType);else if(this.shouldRetryPlay(i));else if(this.isPlayFailed(i)){this.ei.info(k+" play error: "+this.streamId),this.resetPlayer();xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)&&(xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(on,"play_begin","error_code",i),xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(on,"play_begin","try_urls",this.tryUrls),xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(un,"play_begin"),xe("kZegoTaskPlayStart"+this.streamId,this.Ti.reportList)(hn,void 0,{})),this.playBegin=!1,this.yi.onPlayerStop(this.streamId,this.playerType,{code:i,msg:"play fail"})}this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PlayBegin")}else 1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)&&xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(rn,"push_begin")),this.isPublishSuccess(i)?this.handlePublisherSuccess():this.shouldRetryPublish(i)||this.isPublishFailed(i)&&(this.ei.info(k+" publish error: "+this.streamId),this.resetPlayer(),xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)&&(xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(on,"push_begin","error_code",i),xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(on,"push_begin","try_urls",this.tryUrls),xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(un,"push_begin"),xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(hn,void 0,{})),this.pushBegin=!1,this.yi.onPlayerStop(this.streamId,this.playerType,{code:i,msg:"publish fail"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PublishBegin"))},t.prototype.updatePlayerNetStatus=function(t){var i,n,e,s=this,r=lu({},t.detail.info),o=null===(i=this.yi.systemInfo)||void 0===i?void 0:i.platform,u=Date.now(),h=u-this.netStatusUpdateTime;if(this.netStatusUpdateTime=u,!this.isDoubledQuality&&"ios"===o&&this.netStatusUpdateTime&&h<200)this.isDoubledQuality=!0;else{if(this.isDoubledQuality){if(h>200)return void(this.cacheQualityInfo=lu({},r));Object.keys(this.cacheQualityInfo).forEach((function(t){void 0===r[t]&&void 0!==s.cacheQualityInfo[t]&&(r[t]=s.cacheQualityInfo[t])}))}var a={videoBitrate:r.videoBitrate,audioBitrate:r.audioBitrate,videoFPS:r.videoFPS,videoHeight:r.videoHeight,videoWidth:r.videoWidth,videoGOP:r.videoGOP,netSpeed:r.netSpeed,netJitter:r.netJitter};if(this.playerInfo=a,1==this.playerType){if(!this.everSuccess)"8.0.16"==wx.getSystemInfoSync().version&&this.handlePublisherSuccess();var c=lu({},r||{}),l=null===(e=null===(n=this.yi.pusherInstance)||void 0===n?void 0:n.attributes)||void 0===e?void 0:e.enableCamera;if("ios"!==o||!1!==l||0===c.videoWidth&&0===c.videoHeight||(c.videoWidth=0,c.videoHeight=0,this.playerInfo.videoWidth=0,this.playerInfo.videoHeight=0),0==this.publishQualitySeq&&(this.publishQualitySeq=fn(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,"PublishQuality",c),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportQualityStatics()}else if(0==this.playerType){c=lu({},r||{});if(0==this.playQualitySeq&&(this.playQualitySeq=fn(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,"PlayQuality",c),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportPlayQualityStatics()}this.yi.onPlayerQuality(this.streamId,a,this.playerType)}},t.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},t.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:"WXPublishStateUpdate"}),this.dataReport.uploadReport(this.publishQualitySeq,"/sdk/publish_stat_report"),this.publishQualityCount=0,this.publishQualitySeq=0,this.playerLogUploadTime=Date.now()},t.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:"WXPlayStateUpdate"}),this.dataReport.uploadReport(this.playQualitySeq,"/sdk/play_stat_report"),this.playQualityCount=0,this.playQualitySeq=0,this.playerLogUploadTime=Date.now()},t.prototype.handlePublisherSuccess=function(){this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PublishRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PublishStat"),xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)&&(xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(on,"push_begin","try_urls",this.tryUrls),xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(un,"push_begin"),this.Ti.publishStreamList[this.streamId]&&this.Ti.publishStreamList[this.streamId].state==vi&&xe("kZegoTaskPublishStart"+this.streamId,this.Ti.reportList)(rn,"publish_state"))),this.ei.info(k+" play suc: "+this.streamId),this.state=ai,this.yi.onPlayerStart(this.streamId,this.playerType)},t}(),du=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),_u=0,vu=1,mu=2,pu=0,gu=1,bu=function(t){function i(i,n,e){var s,r=t.call(this)||this;return r.playerList={},r.publisherList={},r.playerCount=0,r.playingList=[],r.publishingList=[],r.eventSeq=0,r.streamEventMap={},r.streamReportMap={},r.livePlayerList=[],r.playerContextMap={},r.publishSuccessCallBackList={},r.publishErrorCallBackList={},r.playSuccessCallBackList={},r.playErrorCallBackList={},r.ei=i,r.dataReport=e,r.Ti=n,s=wx.getSystemInfoSync(),r.systemInfo={brand:s.brand,model:s.model,system:s.system,platform:s.platform,version:s.version,SDKVersion:s.SDKVersion},r}return du(i,t),i.prototype.updatePlayingState=function(t,i,n,e){if(this.ei.info(w+" "+t),null==t)return qo.kPlayStreamIDNullError;if(n){var s=this.playerList[t],r=this.Ti.reportSeqList.startPlay[t];if(this.dataReport.eventStart(r,"updatePlayingState"),s)return this.ei.error(w+" player already exist"),this.dataReport.eventEndWithMsgInfo(r,"updatePlayingState",{message:"player already exist"}),this.dataReport.uploadReport(r,void 0),delete this.Ti.reportSeqList.startPlay[t],qo.As;var o=this.Ti.getPlayRoom(t)||this.Ti.roomList[0];if(!o)return this.ei.error(w+" room no found"),qo.zs;this.playerList[t]=new fu(this.ei,t,this,this.dataReport,this.Ti,o)}return this.updateStreamState(t,n,i,this.playingList),n?(this.streamEventMap[t]=this.Ti.reportSeqList.startPlay[t],this.eventSeq+=1,this.streamReportMap[t]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPlayInfo")):this.reportPlayEvent(t,e),!0},i.prototype.updatePublishingState=function(t,i,n,e,s){if(void 0===n&&(n={}),void 0===e&&(e=!1),this.ei.info(R+" "+i),null==i)return xo.error.kPublishStreamIDNullError;if(e){var r=this.publisherList[i],o=this.Ti.reportSeqList.startPublish[i];if(this.dataReport.eventStart(o,"updatePublishingState"),this.dataReport.addMsgInfo(o,{error:(null==s?void 0:s.code)||0}),r)return this.ei.error(R+" publisher already exist"),this.dataReport.eventEndWithMsgInfo(o,"updatePublishingState",{message:"publisher already exist"}),this.dataReport.uploadReport(o,void 0),delete this.Ti.reportSeqList.startPublish[i],xo.error.Cs;this.publisherList[i]=new fu(this.ei,i,this,this.dataReport,this.Ti,t,n)}return this.updateStreamState(i,e,(null==n?void 0:n.streamParams)||"",this.publishingList),e?(this.streamEventMap[i]=this.Ti.reportSeqList.startPublish[i],this.eventSeq+=1,this.streamReportMap[i]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPublishInfo")):this.reportPublishEvent(i,s),!0},i.prototype.updateAudioVolumeNotify=function(t,i){var n;this.ei.info("zw.w.upvn "+t+" volume: "+(null===(n=null==i?void 0:i.detail)||void 0===n?void 0:n.volume))},i.prototype.updateStreamState=function(t,i,n,e){if(t)if(n&&_n(n)||(n=""),1==i)e.push({streamID:t,params:n});else for(var s=0;s<e.length;s++)if(e[s].streamID==t){e.splice(s--,1);break}},i.prototype.isPlaying=function(){return 0!=this.playingList.length},i.prototype.isPublishing=function(){return 0!=this.publishingList.length},i.prototype.startPlayingStream=function(t,i,n){if(this.ei.info(E+" call "+t),this.streamEventMap[t]){0==n?"cdn":1==n&&"ultra_src",qe("kZegoTaskPlayStart"+t,this.Ti.reportList,on,"get_play_url"),qe("kZegoTaskPlayStart"+t,this.Ti.reportList,on,"get_play_url")}var e=this.streamReportMap[t];return e&&this.dataReport.eventEndWithMsg(e,"GotPlayInfo",{type:0==n?"cdn":"ultra_src",urls:i}),this.ei.info("".concat(E," call ").concat(t,", urls:").concat(JSON.stringify(i),", type:").concat(n)),this.startPlayer(t,i,n,pu)},i.prototype.startPlayer=function(t,i,n,e){var s=this.playerList[t];if(e==gu&&(s=this.publisherList[t]),!s)return this.ei.error(S+" player don't exist"),!1;var r=[];e==pu?r=this.playingList:e==gu&&(r=this.publishingList);for(var o=!1,u="",h=0;h<r.length;h++)if(r[h].streamID==t){o=!0,u=r[h].params;break}if(!o)return this.ei.warn(S+" should not start"),!1;if(s.urls=i,s.params=u,s.reconnectLimit=this.getReconnectLimit(n),s.dispatchType=n,s.playerType=e,s.playerSeq=this.streamEventMap[t],s.playerReportSeq=this.streamReportMap[t],!s)return this.ei.info(S+" new player failed"),!1;++this.playerCount;var a=s.tryStartPlayer(0);return this.ei.info(S+" call result: "+a),!0},i.prototype.getNextUrl=function(t){this.ei.info(O+" call "+t);var i,n=this.publisherList[t]||this.playerList[t];if(!n)return this.ei.error(O+" player don't exist"),"";this.publishingList.find((function(i){return i.streamID===t}))?(i=!0,this.onPublishStateUpdate(nn,t,{code:0,message:""})):(i=!1,this.onPlayStateUpdate(mu,t,{code:0,message:""}));var e=n.getPlayerUrl();if(i){if(!this.Ti.reportSeqList.startPublish[t]){var s=fn();this.Ti.reportSeqList.startPublish[t]=s,this.dataReport.newReport(s,"/sdk/republish"),n.pushBegin=!1,Ue("kZegoTaskPublishStart"+t,this.dataReport,s,this.Ti.reportList)}}else if(!this.Ti.reportSeqList.startPlay[t]){s=fn();this.Ti.reportSeqList.startPlay[t]=s,this.dataReport.newReport(s,"/sdk/replay"),n.playBegin=!1,Ue("kZegoTaskPlayStart"+t,this.dataReport,s,this.Ti.reportList)}return e},i.prototype.stopPlayingStream=function(t,i,n){var e;if(this.ei.info("zw.scw.sps.1.0 call "+t),null!=t){var s=null===(e=this.playerList[t])||void 0===e?void 0:e.dispatchRetryHandler;s&&(s.invalid(),s.stopMaxTime());var r=this.playerList[t];if(n&&(null==r?void 0:r.state)==hi){var o=this.Ti.reportSeqList.startPlay[t];this.dataReport.addMsgInfo(o,{error:ae.code,message:ae.message}),this.dataReport.uploadReport(o)}this.stopPlayer(t),delete this.streamEventMap[t],this.updatePlayingState(t,void 0,void 0,i),delete this.streamReportMap[t],delete this.playSuccessCallBackList[t],delete this.playErrorCallBackList[t]}},i.prototype.stopPlayer=function(t){this.ei.info(I+" call "+t);var i=this.playerList[t],n=this.publisherList[t];i||n?(i&&(i.stopPlayer(),i.reportPlayQualityStatics(),delete this.playerList[t]),n&&(n.stopPlayer(),n.reportQualityStatics(),delete this.publisherList[t]),--this.playerCount):this.ei.info(I+" play not exist "+t),this.ei.info(I+" call success")},i.prototype.startPublishingStream=function(t,i,n){if(this.ei.info(b+" call "+t),this.streamEventMap[t]){0==n?"cdn":1==n&&"ultra_src",qe("kZegoTaskPublishStart"+t,this.Ti.reportList,on,"type"),qe("kZegoTaskPublishStart"+t,this.Ti.reportList,on,"urls")}var e=this.streamReportMap[t];return e&&this.dataReport.eventEndWithMsg(e,"GotPublishInfo",{type:0==n?"cdn":"ultra_src",urls:i}),this.ei.info("".concat(b," call ").concat(t,", urls:").concat(JSON.stringify(i),", type:").concat(n)),this.startPlayer(t,i,n,gu)},i.prototype.stopPublishingStream=function(t,i,n){if(void 0===i&&(i={code:0,message:""}),this.ei.info("zw.scw.sps.0.0 call "+t),null!=t){var e=this.publisherList[t].room,s=this.publisherList[t],r=null==s?void 0:s.dispatchRetryHandler;if(r&&(r.invalid(),r.stopMaxTime()),n&&(null==s?void 0:s.state)==hi){var o=this.Ti.reportSeqList.startPublish[t];this.dataReport.addMsgInfo(o,{error:se.code,message:se.message}),this.dataReport.uploadReport(o)}if((s&&s.state!==ci||0!==i.code)&&e.streamHandler.onPublishStateUpdate(tn,t,i),this.stopPlayer(t),delete this.streamEventMap[t],this.updatePublishingState(e,t,void 0,!1,i),delete this.streamReportMap[t],this.Ti.publishStreamList[t]){if(this.Ti.publishStreamList[t].state>=mi){e.streamHandler.updateStreamInfo(t,bi);for(var u=0;u<e.streamList.length;u++)if(e.streamList[u].stream_id==t){e.streamList.splice(u--,1);break}}delete this.Ti.publishStreamList[t]}this.Ti.streamUrlMap[t]&&delete this.Ti.streamUrlMap[t]}},i.prototype.updatePlayerState=function(t,i){var n=this.playerList[t],e=this.publisherList[t];n||e?(n&&n.updateEvent(i),e&&e.updateEvent(i)):this.ei.error(y+" no player "+t),this.ei.info(y+" updatePlayerEvent success")},i.prototype.updatePlayerNetStatus=function(t,i){var n=this.playerList[t],e=this.publisherList[t];n||e?(n&&n.updatePlayerNetStatus(i),e&&e.updatePlayerNetStatus(i)):this.ei.error(T+" no player "+t),this.ei.info(T+" updatePlayerNetStatus success"+t)},i.prototype.reset=function(t,i,n){var e,s;for(var r in this.ei.info(g+" call"),this.publisherList){this.publisherList[r].room.roomID!=t&&t||(this.stopPublishingStream(r,{code:i||0,message:""},n),this.pusherInstance&&this.pusherInstance.stop())}this.pusherInstance=void 0;var o=function(r){var o=u.playerList[r].room;if(o.roomID!=t||!o.streamList.find((function(t){return t.stream_id==r}))&&1!=u.Ti.roomList.length){if(o.roomID==t&&u.Ti.roomList.length>1){var h=u.Ti.roomList.find((function(i){return i.roomID!==t}));h?u.playerList[r].room=h:(u.stopPlayingStream(r,{code:i||0,message:""},n),null===(s=u.livePlayerList.find((function(t){return t.attributes.id==r})))||void 0===s||s.stop())}}else u.stopPlayingStream(r,{code:i||0,message:""},n),null===(e=u.livePlayerList.find((function(t){return t.attributes.id==r})))||void 0===e||e.stop()},u=this;for(var h in this.playerList)o(h);this.livePlayerList=[],this.playerContextMap={},this.ei.info(g+" call success")},i.prototype.reportPublishEvent=function(t,i){if(this.streamReportMap[t]){var n=this.streamReportMap[t];this.dataReport.addMsgExt(n,{stream:t}),i&&i.code&&this.dataReport.addMsgInfo(n,{error:i.code}),this.dataReport.addMsgInfo(n,{itemtype:"WXPublishStream"}),this.dataReport.uploadReport(n,"WXPublishStream"),delete this.streamReportMap[t]}},i.prototype.reportPlayEvent=function(t,i){if(this.streamReportMap[t]){var n=this.streamReportMap[t];this.dataReport.addMsgExt(n,{stream:t}),i&&i.code&&this.dataReport.addMsgInfo(n,{error:i.code}),this.dataReport.addMsgInfo(n,{itemtype:"WXPlayStream"}),this.dataReport.uploadReport(n,"WXPlayStream"),delete this.streamReportMap[t]}},i.prototype.onPlayStateUpdate=function(t,i,n){},i.prototype.onPlayQualityUpdate=function(t,i){},i.prototype.onPublishStateUpdate=function(t,i,n){},i.prototype.onPublishQualityUpdate=function(t,i){},i.prototype.onPublisherStreamUrlUpdate=function(t,i){},i.prototype.onPublisherStreamUrlFail=function(t,i){},i.prototype.onPlayerStreamUrlUpdate=function(t,i){},i.prototype.getReconnectLimit=function(t){return 1},i.prototype.onPlayerStart=function(t,i){this.ei.info("zw.scw.ops.0 call "+t),i==pu?this.onPlayStateUpdate(_u,t,{code:0,message:""}):i==gu&&this.onPublishStateUpdate(_u,t,{code:0,message:""})},i.prototype.onPlayerStop=function(t,i,n){this.ei.info(N+" call "+t),i==pu?(this.reportPlayEvent(t,n),this.ei.warn(N+" play error"),this.onPlayStateUpdate(vu,t,n)):i==gu&&(this.reportPublishEvent(t,n),this.ei.warn(N+" publish error"),this.onPublishStateUpdate(vu,t,n))},i.prototype.onPlayerRetry=function(t,i){this.ei.info("zw.scw.opr call "+t),i==pu?this.onPlayStateUpdate(mu,t,{code:0,message:""}):i==gu&&this.onPublishStateUpdate(mu,t,{code:0,message:""})},i.prototype.onPlayerQuality=function(t,i,n){var e={video:{videoBitrate:i.videoBitrate,videoFPS:i.videoFPS,videoWidth:i.videoWidth,videoHeight:i.videoHeight},audio:{audioBitrate:i.audioBitrate}};n==pu?this.onPlayQualityUpdate(t,e):n==gu&&this.onPublishQualityUpdate(t,e)},i.prototype.onStreamUrlUpdate=function(t,i,n){this.ei.info("zw.scw.opuu.0 call "+t),0==n?this.playSuccessCallBackList[t](t,i):this.publishSuccessCallBackList[t](t,i)},i.prototype.getTotalStreamId=function(t){return t},i.prototype.getRealStreamId=function(t){return t},i.prototype.getRoomByStreamID=function(t){return this.publisherList[t]?this.publisherList[t].room:this.playerList[t]?this.playerList[t].room:void 0},i.prototype.startDispatch=function(){},i.prototype.destroy=function(){this.publishSuccessCallBackList={},this.publishErrorCallBackList={},this.playSuccessCallBackList={},this.playErrorCallBackList={}},i.prototype.getCDNUrl=function(t,i){this.ei.info("zw.scw.gcu call");var n=[],e=this.Ti.appConfig.media_config.play_config.resource_info;if(1==i&&(e=this.Ti.appConfig.media_config.publish_config.resource_info),e.length){var s=e.find((function(t){return 0==t.resource_type}));if(s)for(var r=0;r<s.service_info.length;r++){var o=s.service_info[r],u=o.protocol,h=o.url_template.replace("{STREAM_NAME}",t);if(u===si.RTMP)n.push(h)}}return this.ei.info("zw.scw.gcu rtmps:"+JSON.stringify(n)),{rtmps:n}},i}(uu),Eu=function(){function t(t,i,n,e,s){var r;if(void 0===s&&(s=1),this.reporter=n,this.logCount=0,this.ei=t,this.dataReport=i,this.RTM=e,this.Ti=new cs(this.ei,this.dataReport),this.Ti.clientType="wxMini",!0===(null===(r=No.engineOptions)||void 0===r?void 0:r.pri)){var o=No.engineOptions.netMode;o!==Xi.Extranet&&o!==Xi.Intranet||(this.Ti.netMode=No.engineOptions.netMode)}this.yi=new bu(this.ei,this.Ti,this.dataReport),this.wechatMiniModules=new tu(this.ei,this.dataReport,n,this.Ti,this.yi,this.RTM),this.initTracer(n)}return Object.defineProperty(t.prototype,"stateCenter",{get:function(){return this.Ti},set:function(t){this.Ti=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamCenter",{get:function(){return this.yi},set:function(t){this.yi=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"logger",{get:function(){return this.ei},enumerable:!1,configurable:!0}),t.prototype.checkSystemRequirements=function(){return this.wechatMiniModules.checkSystemRequirements()},t.prototype.getVersion=function(){return Kt},t.prototype.on=function(t,i){return this.wechatMiniModules.bindListener(t,i)},t.prototype.off=function(t,i){return this.wechatMiniModules.deleteListener(t,i)},t.prototype.startPublishingStream=function(t,i){return this.wechatMiniModules.publishModule.startPublishingStream(t,i)},t.prototype.stopPublishingStream=function(t){return this.wechatMiniModules.publishModule.stopPublishingStream(t,!0)},t.prototype.getNextUrl=function(t){return this.wechatMiniModules.getNextUrl(t)},t.prototype.setCustomSignalUrl=function(t,i){if(void 0===i&&(i=!0),this.ei.info(o+" call: "+JSON.stringify(t)),!t||0==t.length)return this.ei.error(o+" param error"),!1;var n=!0;return t.forEach((function(t){return 0!=t.indexOf("rtmp://")&&(n=!1)})),n?(i?this.Ti.customUrl=t:this.Ti.customPlayUrl=t,!0):(this.ei.error(o+" url is not correct"),!1)},t.prototype.addPublishCdnUrl=function(t,i){return this.ei.info("zw.apcu call "+t+" "+i),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"addpush",streamID:t,pushUrl:i}):new Sn((function(t,i){console.error("should install advanced module"),t({errorCode:-1,extendedData:"should install advanced module"})}))},t.prototype.removePublishCdnUrl=function(t,i){return this.ei.info("zw.rpcu call "+t+" "+i),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"delpush",streamID:t,pushUrl:i}):new Sn((function(t,i){console.error("should install advanced module"),t({errorCode:-1,extendedData:"should install advanced module"})}))},t.prototype.startMixerTask=function(t){return new Sn((function(t,i){console.error(""),i()}))},t.prototype.setMixerTaskConfig=function(t){return new Sn((function(t,i){console.error(""),i()}))},t.prototype.stopMixerTask=function(t){return new Sn((function(t,i){console.error(""),i()}))},t.prototype.startAutoMixerTask=function(t){return wn(["mix stream"])},t.prototype.stopAutoMixerTask=function(t){return wn(["mix stream"])},t.prototype.setStreamExtraInfo=function(t,i){return this.wechatMiniModules.streamCommon.setStreamExtraInfo(t,i)},t.prototype.startPlayingStream=function(t,i){return this.wechatMiniModules.playModule.startPlayingStream(t,i)},t.prototype.stopPlayingStream=function(t){this.wechatMiniModules.playModule.stopPlayingStream(t,!0)},t.prototype.updatePlayerState=function(t,i){this.wechatMiniModules.updatePlayerState(t,i)},t.prototype.updatePlayerNetStatus=function(t,i){this.wechatMiniModules.updatePlayerNetStatus(t,i)},t.use=function(i){switch(i.type){case"MixStream":i.install(t,Do,tu);break;case"StreamCDN":i.install(t,tu,Do)}},t.prototype.updateAudioVolumeNotify=function(t,i){this.wechatMiniModules.updateAudioVolumeNotify(t,i)},t.prototype.initContext=function(t){t.wxContext&&(this.wxContext=t.wxContext),t.pushAtr&&(this.pushAtr=t.pushAtr),t.playAtr&&(this.playAtr=t.playAtr)},t.prototype.createPusher=function(t){return this.ei.info("zw.cp call"),this.wxContext&&this.wxContext.setData&&this.pushAtr?(this.yi.pusherInstance||(this.yi.pusherInstance=new eu(this.wxContext,this.pushAtr,this,t)),this.ei.info("zw.cp call success"),this.yi.pusherInstance):(this.ei.error("zw.cp init context wrong"),null)},t.prototype.setPusherAttributes=function(t,i){var n;this.ei.info("zw.spa.0 call"),this.yi.pusherInstance?(null===(n=this.yi.pusherInstance)||void 0===n||n.setPusherAttributes(t,i),this.ei.info("zw.spa.0 call success")):this.ei.error("zw.spa.0 publisher no found")},t.prototype.setPlayerAttributes=function(t,i,n){if(this.ei.info("zw.spa.1 call"),_n(t)&&_n(this.playAtr)){var e=this.yi.livePlayerList.find((function(i){return i.attributes.id==t}));e?(e.setPlayerAttributes(i,n),this.ei.info("zw.spa.1 call success")):this.ei.error("zw.spa.1 player no found")}else this.ei.error("zw.spa.1 stream no found")},t.prototype.getPusherInstance=function(){return this.yi.pusherInstance?this.yi.pusherInstance:null},t.prototype.getPlayerInstance=function(t,i){if(this.ei.info("zw.gpi call"),!_n(t)||!_n(this.playAtr))return this.ei.error("zw.gpi param error"),null;var n=this.yi.livePlayerList.find((function(i){return i.attributes.id==t}));return i&&(this.yi.playerContextMap[t]=i),n||(n=new ou(this.wxContext,t,this,this.yi.playerContextMap[t]),this.yi.livePlayerList.push(n)),this.setPlayData(),this.ei.info("zw.gpi call success"),n},t.prototype.getPlayerList=function(t){if(this.ei.info("zw.gpl call"),!mn(t)&&!_n(t)||!_n(this.playAtr))return this.ei.error("zw.gpl param error"),[];if(t){var i=this.yi.livePlayerList.find((function(i){return i.attributes.id==t}));return i?[i.attributes]:[]}return this.ei.info("zw.gpl call success"),this.yi.livePlayerList.map((function(t){return t.attributes}))},t.prototype.mutePublishStreamVideo=function(t){this.setPusherAttributes({enableCamera:!t})},t.prototype.mutePublishStreamAudio=function(t){this.setPusherAttributes({enableMic:!t})},t.prototype.mutePlayStreamVideo=function(t,i){this.setPlayerAttributes(t,{muteVideo:i})},t.prototype.mutePlayStreamAudio=function(t,i){this.setPlayerAttributes(t,{muteAudio:i})},t.prototype.setPlayData=function(t){if(this.ei.info("zw.spd call"),this.wxContext&&this.playAtr){void 0===t||gn(t)||this.ei.error("zw.spd callBack is not function");var i={};i[this.playAtr]=this.yi.livePlayerList.map((function(t){return t.attributes})),this.wxContext.setData(i,t),this.ei.info("zw.spd call success")}else this.ei.error("zw.spd init context wrong")},t.prototype.initTracer=function(t){this.Ti.reporter=t},t.prototype.destroyEngine=function(){if(this.Ti.engineDestroy)throw new Error("ZegoExpressEngine has been destroyed.");this.Js(),this.Ti.engineDestroy=!0},t.prototype.Js=function(){var t=this;this.ei.info(ns+" call");var i=function(){return!t.RTM.stateCenter.roomModulesList.some((function(t){return!(t.isLogout()||"DISCONNECTED"===t.roomState)}))},n=function(){t.RTM.destroyRTM(),t.RTM.netAgent.destroy(),t.Ti.actionListener("_engineDestroy"),t.yi.destroy(),t.wechatMiniModules.destroy(),t.Ti.destroy(),t.ei.info(ns+" call success"),t.ei.destroy()};i()?n():(this.RTM.stateCenter.onListener("_roomStateUpdate",(function(t,e){"DISCONNECTED"===e&&i()&&n()})),this.RTM.logoutRoom())},t}(),Su=function(){function t(t,i,n,e){void 0===n&&(n=0),this.logger=new Zt.ZegoLogger(n),this.dataReport=new Zt.ZegoDataReport(this.logger),this.reporter=new Xt(this.logger),this.zegoWebRTM=new No(t,i,this.logger,this.dataReport,this.reporter,n,e)}return t.prototype.enableMultiRoom=function(t){return this.zegoWebRTM.enableMultiRoom(t)},t.prototype.loginRoom=function(t,i,n,e){return this.zegoWebRTM.loginRoom(t,i,n,e)},t.prototype.logoutRoom=function(t){return this.zegoWebRTM.logoutRoom(t)},t.prototype.renewToken=function(t,i){return this.zegoWebRTM.renewToken(t,i)},t.prototype.sendBarrageMessage=function(t,i){return this.zegoWebRTM.sendBarrageMessage(t,i)},t.prototype.sendBroadcastMessage=function(t,i){return this.zegoWebRTM.sendBroadcastMessage(t,i)},t.prototype.sendCustomCommand=function(t,i,n){return this.zegoWebRTM.sendCustomCommand(t,i,n)},t.prototype.setRoomExtraInfo=function(t,i,n){return this.zegoWebRTM.setRoomExtraInfo(t,i,n)},t.prototype.setLogConfig=function(t){return this.zegoWebRTM.setLogConfig(t)},t.prototype.setDebugVerbose=function(t){return this.zegoWebRTM.setDebugVerbose(t)},t.prototype.on=function(t,i){return this.zegoWebRTM.on(t,i)},t.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},t.prototype.off=function(t,i){return this.zegoWebRTM.off(t,i)},t.use=function(t){No.use(t)},t.setGeoFence=function(t,i){},t.setEngineOptions=function(t){No.setEngineOptions(t)},t.setCloudProxyConfig=function(t,i,n){},t.setLocalProxyConfig=function(t,i){},t}(),yu=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),Tu=function(t){function i(i,n){var e=t.call(this,i,n,1)||this;return e.zegoWechatMini=new Eu(e.logger,e.dataReport,e.reporter,e.zegoWebRTM),e}return yu(i,t),i.prototype.getNextUrl=function(t){return this.zegoWechatMini.getNextUrl(t)},i.prototype.startPlayingStream=function(t,i){return this.zegoWechatMini.startPlayingStream(t,i)},i.prototype.stopPlayingStream=function(t){return this.zegoWechatMini.stopPlayingStream(t)},i.prototype.updatePlayerNetStatus=function(t,i){return this.zegoWechatMini.updatePlayerNetStatus(t,i)},i.prototype.updatePlayerState=function(t,i){return this.zegoWechatMini.updatePlayerState(t,i)},i.prototype.updateAudioVolumeNotify=function(t,i){return this.zegoWechatMini.updateAudioVolumeNotify(t,i)},i.prototype.checkSystemRequirements=function(){return this.zegoWechatMini.checkSystemRequirements()},i.prototype.setMixerTaskConfig=function(t){return this.zegoWechatMini.setMixerTaskConfig(t)},i.prototype.startMixerTask=function(t){return this.zegoWechatMini.startMixerTask(t)},i.prototype.startAutoMixerTask=function(t){return this.zegoWechatMini.startAutoMixerTask(t)},i.prototype.stopAutoMixerTask=function(t){return this.zegoWechatMini.stopAutoMixerTask(t)},i.prototype.off=function(t,i){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.off(t,i):!!this.zegoWechatMini.stateCenter.listenerList[t]&&this.zegoWechatMini.off(t,i)},i.prototype.stopMixerTask=function(t){return this.zegoWechatMini.stopMixerTask(t)},i.prototype.on=function(t,i){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.on(t,i):!!this.zegoWechatMini.stateCenter.listenerList[t]&&this.zegoWechatMini.on(t,i)},i.prototype.startPublishingStream=function(t,i){return this.zegoWechatMini.startPublishingStream(t,i)},i.prototype.stopPublishingStream=function(t){return this.zegoWechatMini.stopPublishingStream(t)},i.prototype.addPublishCdnUrl=function(t,i){return 3===arguments.length?this.zegoWechatMini.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.addPublishCdnUrl(t,i)},i.prototype.removePublishCdnUrl=function(t,i){return 3===arguments.length?this.zegoWechatMini.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.removePublishCdnUrl(t,i)},i.prototype.setStreamExtraInfo=function(t,i){return this.zegoWechatMini.setStreamExtraInfo(t,i)},i.use=function(t){Su.use(t),Eu.use(t)},i.prototype.initContext=function(t){this.zegoWechatMini.initContext(t)},i.prototype.createPusher=function(t){return this.zegoWechatMini.createPusher(t)},i.prototype.getPusherInstance=function(){return this.zegoWechatMini.getPusherInstance()},i.prototype.getPlayerInstance=function(t,i){return this.zegoWechatMini.getPlayerInstance(t,i)},i.prototype.mutePublishStreamVideo=function(t){this.zegoWechatMini.mutePublishStreamVideo(t)},i.prototype.mutePublishStreamAudio=function(t){this.zegoWechatMini.mutePublishStreamAudio(t)},i.prototype.mutePlayStreamVideo=function(t,i){this.zegoWechatMini.mutePlayStreamVideo(t,i)},i.prototype.mutePlayStreamAudio=function(t,i){this.zegoWechatMini.mutePlayStreamAudio(t,i)},i.prototype.setPusherAttributes=function(t){this.zegoWechatMini.setPusherAttributes(t)},i.prototype.setPlayerAttributes=function(t,i){this.zegoWechatMini.setPlayerAttributes(t,i)},i.prototype.getPlayerList=function(t){return this.zegoWechatMini.getPlayerList(t)},i.prototype.destroyEngine=function(){return this.zegoWechatMini.destroyEngine()},i}(Su),Ru="zm.scc",wu="zm.sbcm",Ou="zm.srlm",Iu="zm.sbrm",Nu="zm.msg.sdr",Cu="zm.msg.rlr",ku="zm.msg.rps",Du="zm.msg.srm",zu="zm.msg.scm",Au="zm.msg.sbm",Pu="zm.msg.bps",Mu="zm.sv.ps",xu={code:1100001,msg:"input parm error."},Uu={code:1100002,msg:"network timeout."},qu={code:1000002,msg:"not login"},Lu={code:1009001,msg:"message content is empty"},Gu={code:1009002,msg:"message content is too long"},Hu={code:1009010,msg:"failed to send message"},ju={code:1002014,msg:"room not exist"},$u={code:1002017,msg:"room extra info key exceed the limit"},Bu={code:1002099,msg:"room inner error"},Vu={code:1102022,msg:"trans send frequently"},Ju={code:1109001,msg:"frequency limited."},Fu=function(t){return t},Yu=function(t){return t},Wu=function(t){return t},Xu="/sdk/login",Zu={event:"/liveroom/send_big_room_message",room_sid_string:Fu,error:{INPUT_PARAM:xu,IM_CONTENT_NULL:Lu,IM_CONTENT_TOO_LONG:Gu,ROOM_NOT_EXIST:ju}},Ku={event:"/liveroom/send_custom_command",room_sid_string:Fu,request_id:Yu,error:{INPUT_PARAM:xu,IM_CONTENT_NULL:Lu,IM_CONTENT_TOO_LONG:Gu,ROOM_NOT_EXIST:ju}},Qu={event:"/liveroom/send_room_message",room_id:Yu,room_sid_string:Yu,msg_content_size:Wu,send_seq:Wu,msg_id:Wu,error:{INPUT_PARAM:xu,IM_CONTENT_NULL:Lu,IM_CONTENT_TOO_LONG:Gu,ROOM_NOT_EXIST:ju}},th={event:"/liveroom/set_room_extrainfo",room_id:Yu,room_sid_string:Fu,key:Yu,value:Yu,error:{INPUT_PARAM:xu,TRANS_FREQUENTLY:Vu,ROOM_NOT_EXIST:ju}},ih="/liveroom/get_room_extrainfo",nh=Fu,eh=Fu,sh="/liveroom/recv_room_extrainfo",rh=Yu,oh=Wu,uh=1000001109,hh=1000001110,ah=128,ch=4096,lh=1024;!function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(To||(To={}));var fh=__webpack_require__(570);var dh=function(){function t(t,i,n,e,s,r){var o=this;this.ei=t,this.Ti=i,this._dataReport=n,this.zi=e,this._rtm=s,this.Ri=r,this.Fs=0,this.Ys=500,this.Ws={},this.Xs=0,this.Zs=[],this.Ks=null,this.Qs=null,this.tr=0,this.ir=0,this.nr=!1,this.er={},this.sr={},this.roomExtraInfo={},this.rr=function(t,i){void 0===i&&(i=!1);var n=t.map((function(t){var i={key:t.trans_type,value:t.trans_data,updateUser:{userID:t.id_name||t.trans_idname,userName:t.nick_name||t.trans_nickname},updateTime:fh.isLong(t.trans_send_time)?t.trans_send_time.toNumber():t.trans_send_time};return o.roomExtraInfo[t.trans_type]=i,i}));i?o.ei.warn(ku+" id name same"):(n.length>0&&o.Ti.actionListener("roomExtraInfoUpdate",o.Ri.roomID,Object.values(o.roomExtraInfo)),t.forEach((function(t){o.Ti.actionListener("recvReliableMessage",t.trans_type,t.trans_seq,t.trans_data)})))}}return Object.defineProperty(t.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),t.prototype.loginRsp=function(t){var i,n,e=this,s=t.body,r=s.ret_timestamp,o=s.bigim_time_window,u=s.trans_seqs;if(null!=r&&_n(r)){var h=parseFloat(r);this.tr=0==h?0:+r-(new Date).getTime()}if(o&&dn(o)&&(this.ir=o),u)for(var a=0;a<u.length;a++){var c=u[a].trans_channel,l=u[a].trans_seq_list||u[a].trans_seq_array;(l=(l=l.filter((function(t){var i=t.trans_type;return!e.er[i]||e.er[i].seq<t.trans_seq}))).map((function(t){return{trans_type:t.trans_type,trans_local_seq:t.trans_seq}}))).length>0&&this.ur(c,l)}(null===(i=t.body)||void 0===i?void 0:i.user_trans_channel_list)&&this.userTransMessageHandler(null===(n=t.body)||void 0===n?void 0:n.user_trans_channel_list)},t.prototype.fetchUserTransMessage=function(t,i){var n=this;this.ei.info("zb.mh.futm.0 call");var e=function(t){n.hr(t)};this.zi.fetchUserTransInfo({trans_channel:t,fetch_array:i},e,e,this.Ri),this.ei.info("zb.mh.futm.0 call success")},t.prototype.userTransMessageHandler=function(t){var i=this;if(t)for(var n=function(n){var s=t[n].trans_channel,r=t[n].trans_seq_list;r=r.filter((function(t){var n=t.trans_type,e=t.trans_seq;return i.sr[s]||(i.sr[s]={}),!i.sr[s][n]||i.sr[s][n].seq<e})),r.length>0&&e.fetchUserTransMessage(s,r)},e=this,s=0;s<t.length;s++)n(s)},t.prototype.hr=function(t){if(t.body&&0!=t.body.err_code)this.ei.error("zb.mh.hfutr user trans send error "+t.body.err_code);else if(t.header&&t.body){var i=t.body.user_trans_list,n=t.body.trans_channel,e=[];if(Array.isArray(i)&&i.length>0){for(var s=0;s<i.length;s++){var r=i[s],o=r.trans_type,u=r.trans_seq;this.sr[n]||(this.sr[n]={}),!this.sr[n][o]||this.sr[n][o].seq<u?(this.sr[n][o]={seq:u},e.push(r)):this.ei.warn("zb.mh.hfutr fetch trans seq wrong"),this.ei.info("zb.mh.hfutr trans "+o+" seq "+u)}e.length>0&&this.Ti.actionListener("_userTransUpdate",this.Ri.roomID,n,e),this.ei.info("zb.mh.hfutr call success")}}else this.ei.error("zb.mh.hfutr user trans send error "+JSON.stringify(t))},t.prototype.sendReliableMessage=function(t,i,n,e){var s=this;if(this.ei.info(Nu+" call"),!this.Ri.isLogin())return this.ei.error(Nu+" state error"),void(e&&e(qu));if(this.nr)return this.ei.error(Nu+" send too often"),void e(th.error.TRANS_FREQUENTLY);this.er[t]||(this.er[t]={seq:0});var r={trans_type:t,trans_data:i,trans_local_seq:this.er[t].seq,trans_channel:"clt"};this.nr=!0;this.zi.sendReliableMessage(r,(function(e){s.er[t].seq=e.body.trans_seq,s.ei.info(Nu+" trans "+t+" seq "+e.body.trans_seq),s.nr=!1,s.roomExtraInfo[t]={key:t,value:i,updateUser:{userID:s.Ri.userID,userName:s.Ri.userName},updateTime:Date.now()},n({seq:e.header.seq,errorCode:0})}),(function(t){var i=Bu;t.body&&t.body.err_code?(i=s._rtm.getServerError(t.body.err_code),s.ei.error(Du+"  "+i.msg)):i=t,s.nr=!1,e(i)}),this.Ri)},t.prototype.ur=function(t,i){var n=this,e={trans_channel:t,fetch_array:i},s=this.Ci.createSpan(To.H,{key:Xu,par:this.Ri.roomID},{key:""},ih);s.setAttributes({fetch_array:nh(i)});var r=function(t){n.ar(t,s)};this.zi.fetchReliableMessage(e,r,r,this.Ri),this.ei.info("zm.msg.frm call success")},t.prototype.ar=function(t,i){if(t.body&&0!=t.body.err_code)return this.ei.error(Cu+" trans send error "+t.body.err_code),void this.Ti.tracer.setError(i,{code:t.body.err_code});if(!t.header||!t.body)return this.ei.error(Cu+" trans send error "+t),void this.Ti.tracer.setError(i,Uu);var n=t.body.trans_list||t.body.trans_fetch_results,e=[],s=[];if(Array.isArray(n)&&n.length>0){for(var r=0;r<n.length;r++){var o=n[r];if(o.err_code!==uh){var u=o.trans_type,h=o.trans_seq;s.push({trans_type:u,trans_seq:h}),o.err_code!==hh?!this.er[u]||this.er[u].seq<h?(this.er[u]={seq:h},e.push(o)):this.ei.warn(Cu+" fetch trans seq wrong"):(this.ei.warn(Cu+" fetch trans seq is wrong "+o.err_code),this.er[u]={seq:h})}else this.ei.warn(Cu+" fetch trans unknown type "+o.err_code)}this.roomExtraInfo={},e.length>0&&this.rr(e)}i.setAttributes({result_array:eh(s)}),i.end()},t.prototype.handlePushTransMsg=function(t){var i,n,e=t.body.trans_type,s=t.body.trans_seq;!this.er[e]||this.er[e].seq<s?(this.er[e]={seq:s},this.rr([t.body],(null===(i=null==t?void 0:t.body)||void 0===i?void 0:i.trans_idname)===this.Ti.idName||(null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.id_name)===this.Ti.idName)):this.ei.warn(ku+" trans seq wrong"),this.ei.info(ku+" trans "+e+" seq "+s)},t.prototype.handlePushUserTransMsg=function(t){this.ei.info("zb.mh.hputr.0 call");var i=t.body.trans_seq_list,n=t.body.trans_channel,e=[];if(n&&Array.isArray(i)&&i.length>0){for(var s=0;s<i.length;s++){var r=i[s].trans_type,o=i[s].trans_seq;this.sr[n]||(this.sr[n]={}),(!this.sr[n][r]||this.sr[n][r].seq<o)&&(this.sr[n][r]={seq:o},e.push(i[s]))}e.length>0?this.Ti.actionListener("_userTransUpdate",this.Ri.roomID,n,e):this.ei.warn("zb.mh.hputr.0 no fetch user trans")}else this.ei.warn("zb.mh.hputr.0 no push user trans")},t.prototype.sendRoomMsg=function(t,i,n,e,s,r){var o,u=this;if(!this.Ri.isLogin())return this.ei.error(Du+" state error"),r(qu),!1;var h=Date.parse(new Date+"");if(this.Fs>0&&this.Fs+this.Ys>h)return this.ei.info(Du+" freq error"),r&&r(Ju,0,t,e),!1;this.Fs=h;var a=this.zi.sendRoomMsg({msg_category:t,msg_type:1,msg_priority:1,msg_content:e},(function(t){s({seq:t.header.seq,errorCode:0,messageID:t.body.msg_id})}),(function(t){var i,n,e=Bu;if(!t.header||!t.body)return t.code&&t.msg&&(e=t),void r({seq:0,errorCode:e.code,messageID:0});n=(i=[u._rtm.getServerError(t.body.err_code),t.body.msg_id])[1],u.ei.error(Du+"  "+(e=i[0]).msg),e==Uu&&(e=Hu),r({seq:t.header.seq,errorCode:e.code,messageID:n})}),this.Ri);return this.Ci.spanSetAttributes({key:Qu.event,par:null===(o=this.Ri)||void 0===o?void 0:o.roomID},{send_seq:Qu.send_seq(a)}),this.ei.info(Du+"  call success"),!0},t.prototype.handlePushRoomMsg=function(t){var i=[],n=t.body.msg_list;t.body.msg_list.forEach((function(t){var n={fromUser:{userID:t.id_name,userName:t.nick_name},message:t.msg_content,sendTime:t.send_time.toNumber(),messageID:t.msg_id.toNumber()};i.push(n)})),t.body.server_msg_id=t.body.server_msg_id.toNumber(),t.body.ret_msg_id=t.body.ret_msg_id.toNumber(),this.Ti.actionListener("IMRecvBroadcastMessage",this.Ri.roomID,i),this.Ti.actionListener("_recvRoomMsg",n,t.body.server_msg_id,t.body.ret_msg_id)},t.prototype.sendCustomCommand=function(t,i,n,e){var s,r=this;if(!this.Ri.isLogin())return this.ei.error(zu+" state error"),e(qu),!1;var o={from_userid:this.Ti.idName,from_username:this.Ti.nickName,request_id:this.Ti.getRequestId(),custom_content:i||"",room_id:this.Ri.roomID};this.Ci.spanSetAttributes({key:Ku.event,par:null===(s=this.Ri)||void 0===s?void 0:s.roomID},{request_id:Ku.request_id(o.request_id)});var u={dest_id_name:t,custom_msg:JSON.stringify(o)};return this.zi.sendCustomCommand(u,(function(t){n({seq:t.header.seq,errorCode:0})}),(function(t){var i,n,s,o=r._rtm.getServerError(t.body.err_code);r.ei.error(zu+" "+o.msg),s=2===(null===(i=t.body)||void 0===i?void 0:i.err_code)||1000000002===(null===(n=t.body)||void 0===n?void 0:n.err_code)?xu:o==Uu?Hu:o,e({seq:t.header.seq,errorCode:s.code,code:s.code})}),this.Ri),this.ei.info(zu+" call success"),!0},t.prototype.handlePushCustomMsg=function(t){var i,n=JSON.parse(t.body.custommsg);this.Ti.actionListener("IMRecvCustomCommand",(i=[n.from_userid,n.from_username,n.room_id,n.custom_content])[2],{userID:i[0],userName:i[1]},i[3])},t.prototype.sendBigRoomMessage=function(t,i,n,e,s,r){var o=this;if(!this.Ri.isLogin())return this.ei.error(Au+" state error"),void(r&&r(qu));var u=this.ir,h=this.tr,a=(new Date).getTime()+h,c=this._rtm.getSeq().toString();if(this.Ws[c]={success:s,error:r},0==u){this.sendBigRoomMessageInternal([{msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:c}],(function(t){o.handleBigImMsgRsp(t)}),(function(t){r&&r(t)}))}else{var l=Math.floor(a/u);if(this.Xs<l&&0==this.Zs.length)this.Xs=l,this.sendBigRoomMessageInternal([{msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:c}],(function(t){o.handleBigImMsgRsp(t)}),(function(t){r&&r(t)}));else this.Zs.push({msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:c}),1==this.Zs.length&&this.setBigImTimer(h,u)}},t.prototype.sendBigRoomMessageInternal=function(t,i,n){this.zi.sendBigRoomMessage({msgs:t},(function(t){i(t)}),(function(t){var i=Bu;t.header&&t.body||(t.code&&t.msg&&(i=t),n(i)),n(i)}),this.Ri),this.ei.info(Au+" sendBigRoomMessage called")},t.prototype.handleBigImMsgRsp=function(t){this.ir=t.body.bigim_time_window;for(var i=t.body.msg_list||t.body.msgs,n=0;n<i.length;n++){var e=i[n].msg_client_id||i[n].bigmsg_client_id;if(this.Ws[e]){var s=this.Ws[e].success;null!=s&&s({seq:t.header.seq,errorCode:0,messageID:i[n].msg_id||i[n].bigmsg_id}),delete this.Ws[e]}}},t.prototype.setBigImTimer=function(t,i){var n,e=this,s=i-((new Date).getTime()+t)%i,r=(n=i,parseInt(Math.random()*(n+1)+"",10)+s);this.Ks=setTimeout((function(){e.onBigImTimer()}),r)},t.prototype.onBigImTimer=function(){var t=this,i=(new Date).getTime()+this.tr;this.Xs=Math.floor(i/this.ir);for(var n=[],e=[],s=0;s<this.Zs.length&&!(s>=20);s++){var r=this.Zs[s];n.push({msg_category:r.msg_category,msg_type:r.msg_type,msg_content:r.msg_content,bigmsg_client_id:r.bigmsg_client_id}),e.push(r.bigmsg_client_id)}this.Zs.length>20?this.Zs.splice(0,20):this.Zs=[],this.sendBigRoomMessageInternal(n,(function(i){t.handleBigImMsgRsp(i)}),(function(i,n){for(var s=0;s<e.length;s++){var r=e[s],o=t.Ws[r];o&&(null!=o.error&&o.error(i,n),delete t.Ws[r])}})),this.Ks&&clearTimeout(this.Ks),this.Ks=null,this.Zs.length>0&&this.setBigImTimer(this.tr,this.ir)},t.prototype.handlePushMergeMsg=function(t){for(var i=t.body.message_list||t.body.messages,n=0;n<i.length;n++)14001===i[n].sub_cmd&&this.handlePushBigRooMsg(i[n].msg_body)},t.prototype.handlePushBigRooMsg=function(t){var i;if(_n(t))try{i=JSON.parse(t)}catch(t){return void this.ei.warn(Pu+"parse json error")}else i=t;if(i){for(var n=i.room_id||this.Ri.roomID,e=[],s=i.msg_list||i.msg_data,r=0;r<s.length;r++){var o=s[r];o.id_name!=this.Ti.idName?e.push({idName:o.id_name,nickName:o.nick_name,messageId:o.msg_id||o.bigmsg_id,category:o.msg_category,type:o.msg_type,content:o.msg_content,time:o.send_time||fh.isLong(o.msg_timestamp)&&o.msg_timestamp.toNumber()}):this.ei.info(Pu+" self message")}0==e.length?this.ei.info(Pu+" no other pushData except self"):this.onRecvBigRoomMessage(e,n),this.ei.info(Pu+"call success")}else this.ei.warn(Pu+" cann't find message body")},t.prototype.onRecvBigRoomMessage=function(t,i){var n=[];t.forEach((function(t){n.push({fromUser:{userID:t.idName,userName:t.nickName},message:t.content,sendTime:t.time,messageID:t.messageId})})),this.Ti.actionListener("IMRecvBarrageMessage",i,n),this.Ti.actionListener("_recvBigRoomMessage",t,i)},t.prototype.resetMessageInfo=function(){this.er={},this.Qs&&(clearTimeout(this.Qs),this.Qs=null),this.Xs=0,this.Zs=[],this.Ws={},this.Ks&&(clearTimeout(this.Ks),this.Ks=null),this.tr=0,this.ir=0},t}();function _h(t,i,n,e){var s=this;return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(r,o){var u=s.getMsgSpan(Qu.event,t,!0),h=s.stateCenter.proxyRes(u,(function(t){u.setAttributes({msg_id:Qu.msg_id(t.messageID)}),r(t)}),o),a=h.interResolve,c=h.interReject;if(!_n(t)||""==t)return s.logger.error(wu+" roomid must be string and not empty"),void c(Qu.error.INPUT_PARAM," param roomID error");if(void 0===i||""==i)return s.logger.error(wu+" message is empty"),void c(Qu.error.IM_CONTENT_NULL);if(!_n(i))return s.logger.error(wu+" message must be string"),void c(Qu.error.INPUT_PARAM," param message error");if(i.length>lh)return s.logger.error(wu+" message too long"),void c(Qu.error.IM_CONTENT_TOO_LONG);var l=s.getRoomModules(t);u.setAttributes({msg_content:i}),l?l.messageHandler.sendRoomMsg(n,e,t,i,(function(t){t.messageID&&u.setAttributes({msg_id:t.messageID}),a(t)}),c):c(Qu.error.ROOM_NOT_EXIST)}))}function vh(t,i,n){var e=this;return new Promise((function(s,r){var o=e.getMsgSpan(Ku.event,t,!0),u=e.stateCenter.proxyRes(o,s,r),h=u.interResolve,a=u.interReject;if(!_n(t)||""==t)return e.logger.error(Ru+" roomid must be string and not empty"),void a(xu," param roomID error");if(!bn(n)||n.find((function(t){return!_n(t)})))return e.logger.error(Ru+" dstMembers must be string array"),void a(Ku.error.INPUT_PARAM," param toUserList error");if(!_n(i)&&!pn(i))return e.logger.error(Ru+" custom content must be a non empty string or object"),void a(Ku.error.INPUT_PARAM," param command error");if(_n(i)&&i.length>lh)return e.logger.error(Ru+" command too long"),void a(Ku.error.IM_CONTENT_TOO_LONG);var c=e.getRoomModules(t),l=_n(i)?i:JSON.stringify(i);o.setAttributes({msg_content:l}),c?c.messageHandler.sendCustomCommand(n,i,h,a):a(Ku.error.ROOM_NOT_EXIST)}))}function mh(t,i,n,e){var s=this;return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(r,o){var u=s.getMsgSpan(Zu.event,t),h=s.stateCenter.proxyRes(u,r,o),a=h.interResolve,c=h.interReject;if(!_n(t)||""==t)return s.logger.error(Iu+" roomid must be string and not empty"),void c(Zu.error.INPUT_PARAM," param roomID error");if(void 0===i||""==i)return s.logger.error(Iu+" message is empty"),void c(Zu.error.IM_CONTENT_NULL);if(!_n(i))return s.logger.error(Iu+" message must be string"),void c(Zu.error.INPUT_PARAM," param message error");if(i.length>lh)return s.logger.error(Iu+" message too long"),void c(Zu.error.IM_CONTENT_TOO_LONG);u.setAttributes({msg_content:i});var l=s.getRoomModules(t);l?l.messageHandler.sendBigRoomMessage(n,e,t,i,a,c):c(Zu.error.ROOM_NOT_EXIST)}))}function ph(t,i,n){var e=this;return new Promise((function(s,r){var o=e.getMsgSpan(th.event,t),u=e.stateCenter.proxyRes(o,s,(function(t){1015===t.errorCode&&(t.errorCode=$u.code),r(t)})),h=u.interResolve,a=u.interReject;if(!_n(t)||""==t)return e.logger.error(wu+" roomid must be string and not empty"),void a(Qu.error.INPUT_PARAM," param roomID error");if(!i||!_n(i))return e.logger.error(Ou+" type must be string"),void a({errorCode:th.error.INPUT_PARAM.code});if(i.length>ah)return e.logger.error(Ou+" type is too long"),void a({errorCode:th.error.INPUT_PARAM.code});if(!n||!_n(n))return e.logger.error(Ou+" data must be string"),void a({errorCode:th.error.INPUT_PARAM.code});if(n.length>ch)return e.logger.error(Ou+" type is too long"),void a({errorCode:th.error.INPUT_PARAM.code});o.setAttributes({key:th.key(i),value:th.value(n)});var c=e.getRoomModules(t);c?c.messageHandler.sendReliableMessage(i,n,h,a):a(th.error.ROOM_NOT_EXIST)}))}var gh={_sendBroadcastMessage:_h,sendBroadcastMessage:function(t,i){var n=this;return new Promise((function(e,s){_h.call(n,t,i).then((function(t){e({errorCode:t.errorCode,messageID:t.messageID,extendedData:t.extendedData})})).catch((function(t){s(t)}))}))},_sendCustomCommand:vh,sendCustomCommand:function(t,i,n){var e=this;return new Promise((function(s,r){vh.call(e,t,i,n).then((function(t){s({errorCode:t.errorCode,extendedData:t.extendedData})})).catch((function(t){r(t)}))}))},_sendBarrageMessage:mh,sendBarrageMessage:function(t,i){var n=this;return new Promise((function(e,s){mh.call(n,t,i).then((function(t){e({errorCode:t.errorCode,messageID:t.messageID,extendedData:t.extendedData})})).catch((function(t){s(t)}))}))},_setRoomExtraInfo:ph,setRoomExtraInfo:function(t,i,n){return ph.call(this,t,i,n)}};var bh={handlePushRoomMsg:function(t){var i=this.handlePushMsg(t);i[0].messageHandler.handlePushRoomMsg(i[1])},handlePushCustomMsg:function(t){var i=this.handlePushMsg(t);i[0].messageHandler.handlePushCustomMsg(i[1])},handlePushMergeMsg:function(t){var i,n=null===(i=null==t?void 0:t.header)||void 0===i?void 0:i.room_id,e=this.rtm.getRoomModules(n);e?e.messageHandler.handlePushMergeMsg(t):this.logger.error(Mu+" room no found ignore "+JSON.stringify(t))},handlePushTransMsg:function(t){var i,n,e,s=this.handlePushMsg(t),r=s[0],o=s[1],u=null===(i=null==t?void 0:t.header)||void 0===i?void 0:i.room_id,h=this.rtm.getMsgSpan(sh,u);h.setAttributes({trans_type:rh(null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.trans_type),trans_seq:oh(null===(e=null==t?void 0:t.body)||void 0===e?void 0:e.trans_seq)}),h.end(),r.messageHandler.handlePushTransMsg(o)},handlePushUserTransMsg:function(t){var i=this.handlePushMsg(t);i[0].messageHandler.handlePushUserTransMsg(i[1])},handleBigImMsgRsp:function(t){var i,n=null===(i=null==t?void 0:t.header)||void 0===i?void 0:i.room_id,e=this.rtm.getRoomModules(n);e?e.messageHandler.handleBigImMsgRsp(t):this.logger.error(Mu+" room no found ignore "+JSON.stringify(t))},handlePushMsg:function(t){var i,n=null===(i=null==t?void 0:t.header)||void 0===i?void 0:i.room_id,e=this.rtm.getRoomModules(n);if(e)return[e,t];this.logger.error(Mu+" room no found ignore "+JSON.stringify(t))}};var Eh,Sh,yh,Th={initMessageHandler:function(){this.messageHandler=new dh(this.logger,this.stateCenter,this.dataReport,this.liveRoomHandler,this.rtm,this)}},Rh={type:"Message",install:function(t,i,n){for(var e in gh)Object.defineProperty(t.prototype,e,{value:gh[e],writable:!1});for(var e in bh)Object.defineProperty(n.prototype,e,{value:bh[e],writable:!1});for(var e in Th)Object.defineProperty(i.prototype,e,{value:Th[e],writable:!1})}},wh=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),Oh=function(t){function i(i,n,e){var s=t.call(this,i,n)||this;return s.ei=i,s.Ti=n,s.cr=e,s.RETRY_MAX_TIME=8,s}return wh(i,t),i.prototype.initReqParams=function(t,i){this.streamId=t,this.cdnPushConfig=i},i.prototype.active=function(t){var i=this;if(void 0===t&&(t=!1),this.retryTimer)this.ei.warn("".concat(os," was actived, ignore"));else if(this.isOverTime)this.ei.warn("".concat(os," retry over time, stop retry"));else{var n=function(){i.clearRetryTimer(),i.cr.sendCDNRequest(i.streamId,i.cdnPushConfig,(function(t,n){var e=t.body;i.invalid(),i.stopMaxTime(),i.sucCallBack&&(i.sucCallBack&&i.sucCallBack(e,n),i.resetCallback())}),(function(t){i._err=t;var n=t.status_code;i.isOverTime?i.requestFail(t):((429===n||n>=500&&n<600)&&i.setRetryRule(1),i.active())})),t||i.attempt++};if(t)n();else{var e=this.getRetryDelayByCount(this.attempt);this.retryTimer=setTimeout(n,e)}}},i}(hu);Eh=__webpack_require__(960).proto_media,Sh=__webpack_require__(946),yh=__webpack_require__(570),Sh.util.Long=yh,Sh.configure();var Ih,Nh=function(){function t(){}return t.prototype.encodeRelayPublishCdnReq=function(t){var i=Eh.RelayPublishCdnRequest.create(t);return Eh.RelayPublishCdnRequest.encode(i).finish()},t.prototype.decodeRelayPublishCdnRsp=function(t){var i=Eh.RelayPublishCdnResponse.decode(t);return i.request_seq_v2&&yh.isLong(i.request_seq_v2)&&(i.request_seq_v2=i.request_seq_v2.toNumber()),i},t}();!function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(Ih||(Ih={}));var Ch,kh,Dh,zh,Ah,Ph,Mh,xh,Uh,qh,Lh,Gh,Hh,jh,$h,Bh,Vh,Jh,Fh,Yh,Wh,Xh,Zh,Kh,Qh,ta,ia={},na={_sendCDNPublishByAccessHub:function(t,i,n,e){var s=this;this.mediaProtoBuf||(this.mediaProtoBuf=new Nh);var r=new Oh(this.logger,this.stateCenter,this);r.initReqParams(t,i);var o=function(t,i){try{var n=s.mediaProtoBuf.decodeRelayPublishCdnRsp(t);s.logger.info("zb.sh.pt rsp decode ".concat(JSON.stringify(n)));var e=(null==n?void 0:n.response)||{};return{code:e.code,msg:e.message}}catch(t){return{code:-1}}};r.initCallback((function(t,r){var u=o(t),h=u.code,a=u.msg;h&&0!=h?(s.logger.error("zb.sh.pt "+i.type+" error code: "+h+" "+a),e(5004===h?le:Hn," cmd: ".concat(i.type," ").concat(h," ").concat(a))):(s.logger.info("zb.sh.pt "+i.type+" success"),n&&n({errorCode:0,extendedData:""}))}),(function(t){var n=t.status_code,r=t.body,u=t.code,h=t.msg,a=JSON.parse(JSON.stringify(Oe.error.mi)),c="";if(u)a={code:u,msg:h},c=h;else if(200===n)s.logger.info("zb.sh.pt error: "),a=Oe.error.mi,c="cmd: ".concat(i.type);else{var l="";if(_n(r))l=r;else{var f=o(r);l=f.code+" "+f.msg}c="request media server fail, error: "+n+" "+l}s.logger.error("zb.sh.pt "+c),e&&e(a,c)})),r.startMaxTime(),r.active(!0)},sendCDNRequest:function(t,i,n,e){var s=this,r="addpush"===i.type?1:2,o={request_seq:this.stateCenter.cdnSeq++,request_cmd:r,streamid:t,cdn_server:i.pushUrl,request_seq_v2:this.stateCenter.cdnSeqV2++};this.logger.info("zb.sh.scpba "+JSON.stringify(o));var u=this.mediaProtoBuf.encodeRelayPublishCdnReq(o);this.sendHttpPBRequest({interfaceID:6,resID:this.stateCenter.appid+"/"+t},u,(function(t,i){s.logger.info("zb.sh.pt receive message "+(null==t?void 0:t.status_code)),n&&n(t,i)}),(function(t){e&&e(t)}),{timeout:4e3})},_publishTarget:function(t,i,n){this.logger.info("zb.sh.pt call");var e=t.streamID;this.stateCenter.testEnvironment&&(e="zegotest-"+this.stateCenter.appid+"-"+t.streamID),this._sendCDNPublishByAccessHub(e,t,i,n)}},ea=function(){function t(t,i,n,e){this.ei=t,this.dataReport=i,this.yi=n,this.Ti=e,this.screenShotReady=!1}return Object.defineProperty(t.prototype,"Ci",{get:function(){return this.Ti.reporter},enumerable:!1,configurable:!0}),t.prototype.publishTarget=function(t){var i=this,n="";switch(t.type){case"addpush":n=Ie;break;case"delpush":case"clearpush":n=Ne}var e=this.Ci.createSpan(Ih.H,{key:be,par:t.streamID},{key:""},n);return e.setAttributes({url:Ce(t.pushUrl)}),new Sn((function(n,s){var r=function(t,n){i.ei.error("zb.pt "+(n||t.message)),i.Ci.setError(e,t,n),s({errorCode:t.code,extendedData:t.message+(n?" "+n:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(t.type))return i.ei.error("zb.sh.pt cdn push type error"),void r(ce,"type error");if(t.streamID&&_n(t.streamID))if(t.pushUrl&&_n(t.pushUrl))if(i.Ti.publishStreamList[t.streamID]){var o=i.yi.getRoomByStreamID(t.streamID);if(o){o.streamHandler._publishTarget(t,(function(t){e.end(),n(t)}),r)}else r(Oe.error.li)}else r(Oe.error.ci);else r(Oe.error.ai,"push url error");else r(Oe.error.ai,"stream id type error")}))},t}(),sa={type:"StreamCDN",install:function(t,i,n){for(var e in Object.defineProperty(i.prototype,"initStreamCDN",{value:function(){this.streamCDNModule=new ea(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),ia)Object.defineProperty(t.prototype,e,{value:ia[e],writable:!1});for(var e in na)Object.defineProperty(n.prototype,e,{value:na[e],writable:!1})}},ra={NOT_LOGIN:Pn,INPUT_PARAM:Ln,TIMEOUT:Gn,MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_INPUT_LABEL_TOO_LONG:{code:1005028,message:"Input stream label text is too long"},MIXER_OUTPUT_TARGET_TOO_LONG:{code:1005029,message:"Output stream target is too long"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_INPUT_IMAGE_URL_TOO_LONG:{code:1005034,message:"Input stream image url too long"},MIXER_INPUT_IMAGE_FORMAT_WRONG:{code:1005035,message:"Input stream image format wrong"},MIXER_INPUT_IMAGE_GET_FAIL:{code:1005036,message:"Input stream image get fail"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}};!function(t){t[t.Off=0]="Off",t[t.TurningOn=1]="TurningOn",t[t.On=2]="On"}(Ch||(Ch={})),function(t){t[t.World=0]="World",t[t.Team=1]="Team",t[t.SecretTeam=2]="SecretTeam"}(kh||(kh={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(Dh||(Dh={})),function(t){t[t.All=0]="All",t[t.World=1]="World",t[t.Team=2]="Team"}(zh||(zh={})),function(t){t[t.Song=0]="Song",t[t.Accompaniment=1]="Accompaniment",t[t.AccompanimentClip=2]="AccompanimentClip",t[t.AccompanimentSegment=3]="AccompanimentSegment"}(Ah||(Ah={})),function(t){t[t.Count=0]="Count",t[t.User=1]="User",t[t.Room=2]="Room",t[t.Master=3]="Master"}(Ph||(Ph={})),function(t){t[t.VendorDefault=0]="VendorDefault",t[t.Vendor1=1]="Vendor1",t[t.Vendor2=2]="Vendor2",t[t.Vendor3=4]="Vendor3"}(Mh||(Mh={})),function(t){t[t.PortraitSegmentation=0]="PortraitSegmentation"}(xh||(xh={})),function(t){t[t.NONE=0]="NONE",t[t.MEN_TO_CHILD=1]="MEN_TO_CHILD",t[t.MEN_TO_WOMEN=2]="MEN_TO_WOMEN",t[t.WOMEN_TO_CHILD=3]="WOMEN_TO_CHILD",t[t.WOMEN_TO_MEN=4]="WOMEN_TO_MEN",t[t.FOREIGNER=5]="FOREIGNER",t[t.OPTIMUS_PRIME=6]="OPTIMUS_PRIME",t[t.ANDROID=7]="ANDROID",t[t.ETHEREAL=8]="ETHEREAL",t[t.MALE_MAGNETIC=9]="MALE_MAGNETIC",t[t.FEMALE_FRESH=10]="FEMALE_FRESH",t[t.MAJOR_C=11]="MAJOR_C",t[t.MINOR_A=12]="MINOR_A",t[t.HARMONIC_MINOR=13]="HARMONIC_MINOR",t[t.FEMALE_ENERGETIC=14]="FEMALE_ENERGETIC",t[t.RICHNESS=15]="RICHNESS",t[t.MUFFLED=16]="MUFFLED",t[t.ROUNDNESS=17]="ROUNDNESS",t[t.FALSETTO=18]="FALSETTO",t[t.FULLNESS=19]="FULLNESS",t[t.CLEAR=20]="CLEAR",t[t.HIGHLY_RESONANT=21]="HIGHLY_RESONANT",t[t.LOUD_CLEAR=22]="LOUD_CLEAR"}(Uh||(Uh={})),function(t){t[t.None=0]="None",t[t.SoftRoom=1]="SoftRoom",t[t.LargeRoom=2]="LargeRoom",t[t.ConcertHall=3]="ConcertHall",t[t.Valley=4]="Valley",t[t.RecordingStudio=5]="RecordingStudio",t[t.Basement=6]="Basement",t[t.KTV=7]="KTV",t[t.Popular=8]="Popular",t[t.Rock=9]="Rock",t[t.VocalConcert=10]="VocalConcert",t[t.GramoPhone=11]="GramoPhone",t[t.EnhancedKTV=12]="EnhancedKTV"}(qh||(qh={})),function(t){t[t.None=0]="None",t[t.Local=1]="Local",t[t.Publish=2]="Publish",t[t.All=3]="All"}(Lh||(Lh={})),function(t){t[t.AI=0]="AI",t[t.AIBalanced=1]="AIBalanced"}(Gh||(Gh={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On"}(Hh||(Hh={})),function(t){t[t.PortraitSegmentation=0]="PortraitSegmentation"}(jh||(jh={})),function(t){t[t.ZegoGeoFenceTypeNone=0]="ZegoGeoFenceTypeNone",t[t.ZegoGeoFenceTypeInclude=1]="ZegoGeoFenceTypeInclude",t[t.ZegoGeoFenceTypeExclude=2]="ZegoGeoFenceTypeExclude"}($h||($h={})),function(t){t[t.AspectFill=0]="AspectFill",t[t.AspectFit=1]="AspectFit"}(Bh||(Bh={})),function(t){t[t.ZegoFontTypeSourceHanSans=0]="ZegoFontTypeSourceHanSans",t[t.ZegoFontTypeAlibabaSans=1]="ZegoFontTypeAlibabaSans",t[t.ZegoFontTypePangMenZhengDaoTitle=2]="ZegoFontTypePangMenZhengDaoTitle",t[t.ZegoFontTypeHappyZcool=3]="ZegoFontTypeHappyZcool"}(Vh||(Vh={})),function(t){t[t.ZegoDefined=0]="ZegoDefined",t[t.UserUnregister=1]="UserUnregister"}(Jh||(Jh={})),function(t){t[t.ZegoAudioCodecIDNormal=1]="ZegoAudioCodecIDNormal",t[t.ZegoAudioCodecIDNormal2=2]="ZegoAudioCodecIDNormal2",t[t.ZegoAudioCodecIDLow3=6]="ZegoAudioCodecIDLow3"}(Fh||(Fh={})),function(t){t[t.ZegoAudioMixModeRaw=0]="ZegoAudioMixModeRaw",t[t.ZegoAudioMixModeFocused=1]="ZegoAudioMixModeFocused"}(Yh||(Yh={})),function(t){t[t.ZegoEncodeProfileDefault=0]="ZegoEncodeProfileDefault",t[t.ZegoEncodeProfileBaseline=1]="ZegoEncodeProfileBaseline",t[t.ZegoEncodeProfileMain=2]="ZegoEncodeProfileMain",t[t.ZegoEncodeProfileHigh=3]="ZegoEncodeProfileHigh"}(Wh||(Wh={})),function(t){t[t.Allow=0]="Allow",t[t.NotAllow=1]="NotAllow"}(Xh||(Xh={})),function(t){t[t.video=0]="video",t[t.audio=1]="audio",t[t.videoAndAudio=2]="videoAndAudio"}(Zh||(Zh={})),Kh=__webpack_require__(423).A.proto_mixstream,Qh=__webpack_require__(946),ta=__webpack_require__(570),Qh.util.Long=ta,Qh.configure();var oa,ua=function(){function t(){}return t.prototype.encodeMixStreamStartReq=function(t){var i=Kh.MixStreamStartRequest.create(t);return Kh.MixStreamStartRequest.encode(i).finish()},t.prototype.decodeMixStreamStartRsp=function(t){return Kh.MixStreamStartResponse.decode(t)},t.prototype.encodeMixStreamStopReq=function(t){var i=Kh.MixStreamStopRequest.create(t);return Kh.MixStreamStopRequest.encode(i).finish()},t.prototype.decodeMixStreamStopRsp=function(t){return Kh.MixStreamStopResponse.decode(t)},t.prototype.encodeGetMixStreamStatusReq=function(t){var i=Kh.GetMixStreamStatusRequest.create(t);return Kh.GetMixStreamStatusRequest.encode(i).finish()},t.prototype.decodeGetMixStreamStatusRsp=function(t){return Kh.GetMixStreamStatusResponse.decode(t)},t.prototype.encodeAutoRoomMixStreamStartReq=function(t){var i=Kh.AutoRoomMixStreamStartRequest.create(t);return Kh.AutoRoomMixStreamStartRequest.encode(i).finish()},t.prototype.decodeAutoRoomMixStreamStartRsp=function(t){return Kh.AutoRoomMixStreamStartResponse.decode(t)},t.prototype.encodeAutoRoomMixStreamStopReq=function(t){var i=Kh.AutoRoomMixStreamStopRequest.create(t);return Kh.AutoRoomMixStreamStopRequest.encode(i).finish()},t.prototype.decodeAutoRoomMixStreamStopRsp=function(t){return Kh.AutoRoomMixStreamStopResponse.decode(t)},t.prototype.encodeMixStreamTaskHbReq=function(t){var i=Kh.MixStreamTaskHbRequest.create(t);return Kh.MixStreamTaskHbRequest.encode(i).finish()},t.prototype.decodeMixStreamTaskHbRsp=function(t){return Kh.MixStreamTaskHbResponse.decode(t)},t}(),ha={event:"/mix/start_mix",error:{ai:ra.INPUT_PARAM,lr:ra.MIXER_TASK_ID_NULL,dr:ra.MIXER_TASK_ID_TOO_LONG,_r:ra.MIXER_TASK_ID_INVALID_CHARACTER,vr:ra.MIXER_INPUTLIST_NULL,mr:ra.MIXER_OUTPUTLIST_NULL,pr:ra.MIXER_OUTPUT_TARGET_INVALID,gr:ra.MIXER_NO_OUTPUT_TARGET,br:ra.MIXER_OUTPUT_TARGET_TOO_LONG,Er:ra.MIXER_START_REQUEST_ERROR,Sr:ra.MIXER_INNER_ERROR,yr:ra.MIXER_INPUT_LABEL_TOO_LONG,Tr:ra.MIXER_INPUT_IMAGE_URL_TOO_LONG,Rr:ra.MIXER_INPUT_IMAGE_FORMAT_WRONG,wr:ra.MIXER_WATERMARK_URL_INVALID,Or:ra.MIXER_WATERMARK_PARAMETERS_ERROR,li:ra.NOT_LOGIN},mix_stream_conf:fe,stop_reason:de},aa={event:"/mix/stop_mix",error:{ai:ra.INPUT_PARAM,lr:ra.MIXER_TASK_ID_NULL,Er:ra.MIXER_STOP_REQUEST_ERROR,Sr:ra.MIXER_INNER_ERROR,li:ra.NOT_LOGIN}},ca={event:"/mix/config_mix",error:{ai:ra.INPUT_PARAM,Ir:ra.MIXER_VIDEO_CONFIG_INVALID,Nr:ra.MIXER_BACKGROUND_IMAGE_URL_INVALID,li:ra.NOT_LOGIN},mix_params:fe},la="/automix/start",fa="/automix/stop",da=function(){return da=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},da.apply(this,arguments)},_a=256,va=1024,ma=1e4;oa=__webpack_require__(570);var pa,ga=["NO_RELAY","RELAYING","RELAY_REQUESTING","NO_RELAY"],ba={0:"NONE",8:"SERVER_ERROR",9:"HANDSHAKE_FAILED",10:"ACCESS_POINT_ERROR",11:"CREATE_STREAM_FAILED",12:"BAD_NAME",13:"CDN_SERVER_DISCONNECTED",14:"DISCONNECTED",1214:"ALL_INPUT_STREAM_CLOSED",1215:"ALL_INPUT_STREAM_NO_DATA",1230:"SERVER_INTERNAL_ERROR"};function Ea(t,i){var n,e,s,r,o="",u=ra;return i.errorCode<2e9&&i.errorCode>1e9?(s={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",141:"MIXER_INPUT_IMAGE_FORMAT_WRONG",142:"MIXER_INPUT_IMAGE_GET_FAIL",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",179:"MIXER_INPUT_LABEL_TOO_LONG",190:"MIXER_START_REQUEST_ERROR"},r="MIXER_INNER_ERROR",(e=i.errorCode-ma)>1e9&&s[e-1e9]&&(r=s[e-1e9]),n=u[o=r]):i.errorCode<1e6&&(n=t.decodeServerError(i.errorCode,i.extendedData),o=t.getLiveRoomError(i.errorCode)),{reportErr:n,actualError:u[o]}}!function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(pa||(pa={}));var Sa,ya={VIDEO:0,AUDIO:1,VIDEO_ONLY:2},Ta={"H.264":0,"H.265":3};function Ra(t){var i=Sa.AUDIO_ENC_HE_AAC;switch(t){case Fh.ZegoAudioCodecIDNormal2:i=Sa.AUDIO_ENC_AAC_LC;break;case Fh.ZegoAudioCodecIDLow3:i=Sa.AUDIO_ENC_OPUS;break;default:i=Sa.AUDIO_ENC_HE_AAC}return i}!function(t){t[t.AUDIO_ENC_HE_AAC=0]="AUDIO_ENC_HE_AAC",t[t.AUDIO_ENC_AAC_LC=1]="AUDIO_ENC_AAC_LC",t[t.AUDIO_ENC_MP3=2]="AUDIO_ENC_MP3",t[t.AUDIO_ENC_OPUS=3]="AUDIO_ENC_OPUS",t[t.AUDIO_ENC_SILK=4]="AUDIO_ENC_SILK",t[t.AUDIO_ENC_EVS=5]="AUDIO_ENC_EVS"}(Sa||(Sa={}));var wa={},Oa={startMixerTask:function(t){var i=this;return new Sn((function(n,e){var s,r,o,u,h,a,c,l,f,d,_,v,m,p,g=i.reporter.createSpan(pa.H,{key:ge},{key:ha.event,par:t.taskID},ha.event,!0),b={errorCode:ra.MIXER_INPUT_PARAMETERS_ERROR.code,extendedData:ra.MIXER_INPUT_PARAMETERS_ERROR.message};if(!!(null==t?void 0:t.inputList.find((function(t){return null==t.streamID&&(b.extendedData=b.extendedData+". streamID should be of string type",!0)}))))return i.reporter.setError(g,ra.MIXER_INPUT_PARAMETERS_ERROR),void e(b);var E=t.outputConfig;E&&E.outputFps&&(E.outputFPS=E.outputFps);var S=function(n){var s=Ea(i.stateCenter,n),r=s.reportErr,o=s.actualError;1000010150===n.errorCode&&g.setAttributes({stop_reason:"UnmatchStreamId"}),i.reporter.setError(g,r||n),i.reporter.spanEnd({key:ha.event,par:t.taskID}),o&&(n.errorCode=null==o?void 0:o.code,n.extendedData=(null==o?void 0:o.message)||""),e(n)},y=i.stateCenter.roomList[0];if(y){var T=[];if(!t.noTaskID&&!t.taskID)return i.logger.error("zb.sh.ums no taskId found"),void S({errorCode:ha.error.lr.code,extendedData:ha.error.lr.message});if(!t.noTaskID&&!_n(t.taskID))return i.logger.error("zb.rh.lg taskId must be string"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!t.noTaskID&&t.taskID.length>_a)return i.logger.error("zb.sh.ums taskId is too long"),void S({errorCode:ha.error.dr.code,extendedData:ha.error.dr.message});if(!t.noTaskID&&!In(t.taskID))return i.logger.error("zb.sh.ums task ID contains illegal characters"),void S({errorCode:ha.error._r.code,extendedData:ha.error._r.message});if(!t.inputList||0==t.inputList.length)return i.logger.error("zb.sh.ums input list wrong"),void S({errorCode:ha.error.vr.code,extendedData:ha.error.vr.message});if(t.inputList.some((function(t){return pn(t)&&!t.streamID})))return i.logger.error("zb.sh.ums input stream is null"),void S({errorCode:ha.error.vr.code,extendedData:ha.error.vr.message});for(var R=0;R<t.inputList.length;R++){var w=t.inputList[R],O={errorCode:ha.error.ai.code,extendedData:ha.error.ai.message};if(!pn(w.layout))return i.logger.error("zb.sh.ums input layout must be object"),void S(O);var I=w.layout,N=I.bottom,C=I.left,k=I.right;if(!(Cn(I.top,!1)&&Cn(N,!1)&&Cn(C,!1)&&Cn(k,!1)))return i.logger.error("zb.sh.ums topleftbottomright must be integer number"),void S(O);if(void 0!==w.renderMode&&![0,1].includes(w.renderMode))return i.logger.error("zb.sh.ums render_mode is wrong"),void S(O);if(void 0!==w.imageInfo){if(!_n(w.imageInfo.url))return i.logger.error("zb.sh.ums image url is require string"),void S(O);if(w.imageInfo.url.length>1024)return i.logger.error("zb.sh.ums input image url length too long"),void S({errorCode:ha.error.Tr.code,extendedData:ha.error.Tr.message})}if(!mn(w.label)){if(!_n(null===(s=w.label)||void 0===s?void 0:s.text))return i.logger.error("zb.sh.ums input label text is not string"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message+" label text is not string"});if((null===(o=null===(r=w.label)||void 0===r?void 0:r.text)||void 0===o?void 0:o.length)>=300)return i.logger.error("zb.sh.ums input label text is  too long"),void S({errorCode:ha.error.yr.code,extendedData:ha.error.yr.message});var D=w.label,z=D.left,A=D.top;if(void 0!==z&&!Cn(z,!1)||void 0!==A&&!Cn(A,!1))return i.logger.error("zb.sh.ums input label left and top should be integer"),void S(O)}if(void 0!==w.cornerRadius&&!dn(w.cornerRadius))return i.logger.error("zb.sh.ums cornerRadius is wrong"),void S(O);if(void 0!==w.soundLevelID&&!Cn(w.soundLevelID,!1))return i.logger.error("zb.sh.ums soundLevelID is wrong"),void S(O);if(void 0!==w.volume&&!Cn(w.volume,!1))return i.logger.error("zb.sh.ums volume is wrong"),void S(O)}if(!t.outputList||0==t.outputList.length)return i.logger.error("zb.sh.ums no output list found"),void S({errorCode:ha.error.mr.code,extendedData:ha.error.mr.message});if(t.outputList.some((function(t){return _n(t)&&!Nn(t)&&""===t||pn(t)&&!t.target})))return i.logger.error("zb.sh.ums stream output target is nul"),void S({errorCode:ha.error.mr.code,extendedData:ha.error.mr.message});if(t.outputList.some((function(t){return _n(t)&&!Nn(t)&&t.length>va||pn(t)&&_n(t.target)&&t.target.length>va})))return i.logger.error("zb.sh.ums stream output target is too long"),void S({errorCode:ha.error.br.code,extendedData:ha.error.br.message});if(t.outputList.some((function(t){return _n(t)&&!Nn(t)&&!In(t)||pn(t)&&t.target&&!Nn(t.target)&&!In(t.target)})))return i.logger.error("zb.sh.ums stream output target is incorrect"),void S({errorCode:ha.error.pr.code,extendedData:ha.error.pr.message});if(!E||!pn(E))return i.logger.error("zb.sh.ums no output config found"),void S({errorCode:ha.error.gr.code,extendedData:ha.error.gr.message});if(!E.outputBitrate||!Cn(E.outputBitrate))return i.logger.error("zb.sh.ums bitrate param is required and must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!E.outputFPS||!Cn(E.outputFPS))return i.logger.error("zb.sh.ums fps param is required and must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!E.outputWidth||!Cn(E.outputWidth))return i.logger.error("zb.sh.ums width param is required and must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!E.outputHeight||!Cn(E.outputHeight))return i.logger.error("zb.sh.ums height param is required and must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(void 0!==E.outputAudioCodecID&&!Cn(E.outputAudioCodecID,!1))return i.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(void 0!==E.outputAudioBitrate&&!Cn(E.outputAudioBitrate))return i.logger.error("zb.sh.ums AudioBitrate param must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(void 0!==E.outputAudioChannels&&!Cn(E.outputAudioChannels,!1))return i.logger.error("zb.sh.ums AudioChannels param must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!mn(t.watermark)){if(!_n(null===(u=t.watermark)||void 0===u?void 0:u.imageURL))return i.logger.error("zb.sh.ums watermark image type error"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!En(null===(h=t.watermark)||void 0===h?void 0:h.imageURL))return i.logger.error("zb.sh.ums watermark image url invalid"),void S({errorCode:ha.error.wr.code,extendedData:ha.error.wr.message});if(!pn(null===(a=t.watermark)||void 0===a?void 0:a.layout))return i.logger.error("zb.sh.ums watermark layout must be object"),void S({errorCode:ha.error.Or.code,extendedData:ha.error.Or.message});var P=null===(c=t.watermark)||void 0===c?void 0:c.layout;N=P.bottom,C=P.left,k=P.right;if(!(Cn(P.top,!1)&&Cn(N,!1)&&Cn(C,!1)&&Cn(k,!1)))return i.logger.error("zb.sh.ums watermark topleftbottomright must be integer number"),void S({errorCode:ha.error.Or.code,extendedData:ha.error.Or.message})}if(!mn(t.whiteboard)){if(!_n(null===(l=t.whiteboard)||void 0===l?void 0:l.whiteboardID))return i.logger.error("zb.sh.ums whiteboard is required and must be string"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!pn(null===(f=t.whiteboard)||void 0===f?void 0:f.layout))return i.logger.error("zb.sh.ums whiteboard layout must be object"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});var M=null===(d=t.whiteboard)||void 0===d?void 0:d.layout;N=M.bottom,C=M.left,k=M.right;if(!(Cn(M.top,!1)&&Cn(N,!1)&&Cn(C,!1)&&Cn(k,!1)))return i.logger.error("zb.sh.ums whiteboard topleftbottomright must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});var x=t.whiteboard,U=x.horizontalRatio,q=x.verticalRatio,L=x.isPPTAnimation,G=x.zOrder,H=x.backgroundColor;if(!mn(U)&&!Cn(U))return i.logger.error("zb.sh.ums horizontalRatio must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!mn(q)&&!Cn(q))return i.logger.error("zb.sh.ums verticalRatio must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!mn(L)&&!vn(L))return i.logger.error("zb.sh.ums isPPTAnimation must be boolean"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!mn(G)&&!Cn(G,!1))return i.logger.error("zb.sh.ums zOrder must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(!mn(H)&&!Cn(H,!1))return i.logger.error("zb.sh.ums backgroundColor must be integer number"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message})}if(!mn(t.enableSoundLevel)&&!vn(t.enableSoundLevel))return i.logger.error("zb.sh.ums enableSoundLevel is not bool"),void S({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});for(R=0;R<t.inputList.length;R++){var j=t.inputList[R],$=j.streamID;i.stateCenter.testEnvironment&&($="zegotest-"+i.stateCenter.appid+"-"+j.streamID),T.push({stream_id:$,content_control:ya[j.contentType||"VIDEO"]||0,top:null===(_=j.layout)||void 0===_?void 0:_.top,left:null===(v=j.layout)||void 0===v?void 0:v.left,bottom:null===(m=j.layout)||void 0===m?void 0:m.bottom,right:null===(p=j.layout)||void 0===p?void 0:p.right,render_mode:j.renderMode,image:j.imageInfo,label:j.label})}var B=[];t.outputList.forEach((function(t){var i="";_n(t)?i=t:pn(t)&&t.target&&(i=t.target);var n=0;(i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8"))&&(n=1),B.push({target:i,is_url:n?"true":"false"})}));i.reporter.spanSetAttributes({key:ha.event,par:t.taskID},{mix_stream_conf:ha.mix_stream_conf({fps:E.outputFPS,bitrate:E.outputBitrate,w:E.outputWidth,h:E.outputHeight,stream_cnt:T.length,mix_task_id:t.taskID,input_stream_list:T,output_target_list:B})}),y.streamHandler.updateMixStream(t,wa,(function(e){i.reporter.spanEnd({key:ha.event,par:t.taskID}),n(e)}),S)}else S({errorCode:ha.error.li.code,extendedData:ha.error.li.message})}))},setMixerTaskConfig:function(t){var i=this;return new Sn((function(n,e){var s,r=i.reporter.createSpan(pa.H,{key:ge},{key:""},ca.event),o={},u=function(t){i.reporter.setError(r,t),e(t)};if(t&&t.videoCodec){var h=t.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(h))return i.logger.error("zb.sh.ums param videoCode error"),u({errorCode:ca.error.Ir.code,extendedData:ca.error.Ir.message}),!1;o.videoCodec=h}if(t.backgroundColor){if(!Cn(t.backgroundColor))return i.logger.error("zb.sh.ums param backgroundColor must be integer number"),u({errorCode:ca.error.ai.code,extendedData:ca.error.ai.message}),!1;o.backgroundColor=t.backgroundColor}var a=t.backgroundImage;if(a){if(!_n(a))return i.logger.error("zb.sh.ums param outputBgImage error"),u({errorCode:ca.error.ai.code,extendedData:ca.error.ai.message}),!1;if(!En(a))return i.logger.error("zb.sh.ums illegal input background image URL"),u({errorCode:ca.error.Nr.code,extendedData:ca.error.Nr.message}),!1;o.backgroundImage=a}var c=t&&t.userData;if(c){if(!(c instanceof Uint8Array))return i.logger.error("zb.sh.ums param userData required Uint8Array"),u({errorCode:ca.error.ai.code,extendedData:ca.error.ai.message}),!1;if(c.byteLength>1e3)return i.logger.error("zb.sh.ums param userData should shorter than 1000"),u({errorCode:ca.error.ai.code,extendedData:ca.error.ai.message}),!1;o.userData=c}t.extraParams&&(o.extraParams||(o.extraParams=[]),(s=o.extraParams).push.apply(s,t.extraParams)),wa=o,r.setAttributes({mix_params:ca.mix_params(t)}),i.stateCenter.roomList[0]?(r.end(),n({errorCode:0,extendedData:""})):u({errorCode:ca.error.li.code,extendedData:ca.error.li.message})}))},stopMixerTask:function(t){var i=this;return new Sn((function(n,e){var s=i.reporter.createSpan(pa.H,{key:ge},{key:""},aa.event);if(!t||!_n(t)||t.length>_a||!In(t))return i.logger.error("zb.rh.lg taskID must be string less 256"),i.reporter.setError(s,aa.error.ai," param taskID error"),void e({errorCode:aa.error.ai.code,extendedData:aa.error.ai.message+" param taskID error"});s.setAttributes({mix_task_id:t});var r=function(t){var n=Ea(i.stateCenter,t),r=n.actualError;i.reporter.setError(s,n.reportErr||t),r&&(t.errorCode=null==r?void 0:r.code,t.extendedData=(null==r?void 0:r.message)||""),e(t)},o=i.stateCenter.roomList[0];o?o.streamHandler.stopMixStream(t,(function(t){s.end(),n(t)}),r):r({errorCode:aa.error.li.code,extendedData:aa.error.li.message})}))},startAutoMixerTask:function(t){var i=this;return new Sn((function(n,e){var s,r,o=i.reporter.createSpan(pa.H,{key:ge},{key:la,par:t.taskID},la,!0),u=function(n){var s=Ea(i.stateCenter,n),r=s.reportErr;1000010150===n.errorCode&&o.setAttributes({stop_reason:"UnmatchStreamId"}),i.reporter.setError(o,r||n),i.reporter.spanEnd({key:la,par:t.taskID}),e(n)},h=i.stateCenter.roomList[0];if(h){if(!t.taskID)return i.logger.error("zb.sh.ums no taskId found"),void u({errorCode:ha.error.lr.code,extendedData:ha.error.lr.message});if(!_n(t.taskID))return i.logger.error("zb.rh.lg taskId must be string"),void u({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(t.taskID.length>_a)return i.logger.error("zb.sh.ums taskId is too long"),void u({errorCode:ha.error.dr.code,extendedData:ha.error.dr.message});if(!In(t.taskID))return i.logger.error("zb.sh.ums task ID contains illegal characters"),void u({errorCode:ha.error._r.code,extendedData:ha.error._r.message});if(!t.roomID)return i.logger.error("zb.sh.ums no roomID found"),void u({errorCode:Bn,extendedData:Vn});if(!_n(t.roomID))return i.logger.error("zb.rh.lg roomID must be string"),void u({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(t.roomID.length>128)return i.logger.error("zb.sh.ums roomID is too long"),void u({errorCode:Yn,extendedData:Wn});if(!In(t.roomID))return i.logger.error("zb.sh.ums room ID contains illegal characters"),void u({errorCode:Jn,extendedData:Fn});if(!t.outputList||0==t.outputList.length)return i.logger.error("zb.sh.ums no output list found"),void u({errorCode:ha.error.mr.code,extendedData:ha.error.mr.message});if(t.outputList.some((function(t){return pn(t)&&!t.target})))return i.logger.error("zb.sh.ums stream output target is nul"),void u({errorCode:ha.error.mr.code,extendedData:ha.error.mr.message});if(t.outputList.some((function(t){return pn(t)&&_n(t.target)&&t.target.length>va})))return i.logger.error("zb.sh.ums stream output target is too long"),void u({errorCode:ha.error.br.code,extendedData:ha.error.br.message});if(t.outputList.some((function(t){return pn(t)&&t.target&&!Nn(t.target)&&!In(t.target)})))return i.logger.error("zb.sh.ums stream output target is incorrect"),void u({errorCode:ha.error.pr.code,extendedData:ha.error.pr.message});if(t.audioConfig){if(void 0!==(null===(s=t.audioConfig)||void 0===s?void 0:s.bitrate)&&!Cn(null===(r=t.audioConfig)||void 0===r?void 0:r.bitrate))return i.logger.error("zb.sh.ums audio bitrate param is required and must be integer number"),void u({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(void 0!==t.audioConfig.codecID&&!Cn(t.audioConfig.codecID,!1))return i.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void u({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});if(void 0!==t.audioConfig.channel&&![1,2].includes(t.audioConfig.channel))return i.logger.error("zb.sh.ums AudioChannels param must be 1 or 2"),void u({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message})}if(!mn(t.enableSoundLevel)&&!vn(t.enableSoundLevel))return i.logger.error("zb.sh.ums enableSoundLevel is not bool"),void u({errorCode:ha.error.ai.code,extendedData:ha.error.ai.message});t.outputList.forEach((function(t){var i="";_n(t)?i=t:pn(t)&&t.target&&(i=t.target);i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8")})),i.reporter.spanSetAttributes({key:la,par:t.taskID},{task_id:t.taskID,room_id:t.roomID,with_sound_level:t.enableSoundLevel?1:0,alignment_type:t.streamAlignmentMode||0,recv_buffer_level:t.minPlayStreamBufferLength||0,output_target_list:[]}),h.streamHandler.updateAutoMixStream(t,(function(e){i.reporter.spanEnd({key:la,par:t.taskID}),n(e)}),u)}else u({errorCode:ha.error.li.code,extendedData:ha.error.li.message})}))},stopAutoMixerTask:function(t){var i=this;return new Sn((function(n,e){var s=i.reporter.createSpan(pa.H,{key:ge},{key:""},fa);if(!t.taskID||!_n(t.taskID)||t.taskID.length>_a||!In(t.taskID))return i.logger.error("zb.rh.lg taskID must be string less 256"),i.reporter.setError(s,aa.error.ai," param taskID error"),void e({errorCode:aa.error.ai.code,extendedData:aa.error.ai.message+" param taskID error"});s.setAttributes({task_id:t.taskID,room_id:t.roomID});var r=function(t){var n=Ea(i.stateCenter,t);i.reporter.setError(s,n.reportErr||t),e(t)},o=i.stateCenter.roomList[0];o?o.streamHandler.stopAutoMixStream(t,(function(t){s.end(),n(t)}),r):r({errorCode:aa.error.li.code,extendedData:aa.error.li.message})}))}},Ia={_sendMixStopReqByAccessHub:function(t,i,n){var e=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new ua),t.timestamp=oa.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.1 req "+JSON.stringify(t));var s=this.mixStreamProtoBuf.encodeMixStreamStopReq(t),r=function(i,n){try{var s=e.mixStreamProtoBuf.decodeMixStreamStopRsp(i);On(s),e.logger.info("zb.sh.smseba.1 rsp "+JSON.stringify(t));var r=(null==s?void 0:s.common_response)||{};return{code:r.code,msg:r.message}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:16},s,(function(t,e){var s=r(t),o=s.code,u=s.msg;0!=o&&null!=o||!gn(i)?n&&n({errorCode:o,extendedData:u||""}):i({errorCode:o,extendedData:u})}),(function(t,i,s){var o="";if(s)return s.code==ra.TIMEOUT.code&&(s=ha.error.Sr),s.code&&20010===s.code&&(s=JSON.parse(JSON.stringify(ra.MIXER_NO_SERVICES))),void(n&&n(s,o));s=ha.error.Sr;var u="";if(_n(i))u=i;else{var h=r(i);u=h.code+" "+h.msg}e.logger.error("zb.sh.pt "+(o="request media server fail, error: "+t+" "+u)),n&&n(s,o)}))},stopMixStream:function(t,i,n,e,s){var r=this;this.logger.info("zb.sh.sms call");var o=this.getStopMixStreamParams(t,e,s);this._sendMixStopReqByAccessHub(o.mixStopReq,(function(n){r.mixStreamHbList[t]&&(r.mixStreamHbList[t].timer&&clearTimeout(r.mixStreamHbList[t].timer),delete r.mixStreamHbList[t]),i(n)}),n)},_sendMixStartReqByAccessHub:function(t,i,n,e){var s=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new ua),t.timestamp=oa.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.0 req "+JSON.stringify(t));var r=this.mixStreamProtoBuf.encodeMixStreamStartReq(t),o=function(t,i){try{var n=s.mixStreamProtoBuf.decodeMixStreamStartRsp(t);On(n),s.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(n));var e=n.common_response;return{code:e.code,msg:e.message,data:n.data,errStreamList:n.error_streamid_list}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:15},r,(function(r,u){var h=o(r),a=h.code,c=h.data,l=h.errStreamList;if(void 0===a||0==a){var f=c.play_infos.map((function(t){var n={rtmpURL:"",hlsURL:"",flvURL:""},e=t.stream_alias||"";return s.stateCenter.testEnvironment&&e&&e.startsWith(i)&&(e=e.slice(i.length)),n.streamID=e,t.rtmp_url&&t.rtmp_url.length>0&&(n.rtmpURL=t.rtmp_url),t.hls_url&&t.hls_url.length>0&&(n.hlsURL=t.hls_url),t.hdl_url&&t.hdl_url.length>0&&(n.flvURL=t.hdl_url),n}));if(c.request_id){s.mixStreamTaskList[t.task_id]||(s.mixStreamTaskList[t.task_id]={mixStatusVer:0,requestId:c.request_id}),s.mixStreamTaskList[t.task_id].requestId=c.request_id;var d=s.mixRequestIdList.findIndex((function(t){return t==c.request_id}));d>-1&&(s.fetchMixStreamStatus(s.stateCenter.appid+":"+t.task_id),s.mixRequestIdList.splice(d,1))}if(n)n({errorCode:0,extendedData:JSON.stringify({mixerOutputList:f})})}else{var _="",v=a+1e9;if(1000000150==v&&l){var m=l.map((function(t){return s.stateCenter.testEnvironment&&t.startsWith(i)?t.slice(i.length):t}))||[];m.length>0&&(s.logger.debug("zb.sh.ums not exist streams: "+m),_=m.join(","))}e&&e({errorCode:s.stateCenter.getServerError(ma+v).code,extendedData:_})}}),(function(t,i,n){var r="";if(n)return n.code==ra.TIMEOUT.code&&(n=ha.error.Er),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(ra.MIXER_NO_SERVICES))),void(e&&e(n,r));n=ha.error.Sr;var u="";if(_n(i))u=i;else{var h=o(i);u=h.code+" "+h.msg}s.logger.error("zb.sh.pt "+(r="request media server fail, error: "+t+" "+u)),e&&e(n,r)}))},getStartMixStreamParams:function(t,i){var n,e,s=this,r={request_seq:this.stateCenter.getSeq(),mix_protocol_version:1,task_id:t.taskID,room_id:this.roomID,mix_stream_common:{},input_stream:[],advance_config:[],output_stream:[]},o=t.outputConfig||{};o.singleStreamPassThrough&&vn(o.singleStreamPassThrough)&&(r.mix_stream_common.single_stream_pass_through=o.singleStreamPassThrough?1:0);var u=i;if(u&&(u.videoCodec&&(null===(n=r.advance_config)||void 0===n||n.push({key:"video_encode",value:u.videoCodec})),u.backgroundColor&&(r.mix_stream_common.output_bg_color=u.backgroundColor),u.backgroundImage&&(r.mix_stream_common.output_bg_image=u.backgroundImage),u.userData&&(r.mix_stream_common.user_data=this.stateCenter.uint8arrayToBase64(u.userData)),u.extraParams&&(null===(e=r.advance_config)||void 0===e||e.push.apply(e,u.extraParams))),void 0!==t.enableSoundLevel&&(r.mix_stream_common.with_sound_level=t.enableSoundLevel?1:0),t.inputList.forEach((function(t,i){var n,e,o,u,h,a,c,l,f,d,_,v,m,p,g,b,E,S,y,T,R,w,O=t.streamID;s.stateCenter.testEnvironment&&(O="zegotest-"+s.stateCenter.appid+"-"+t.streamID);var I={stream_input_common:{stream_id:O,content_control:ya[t.contentType||"VIDEO"]||0,layer_rect:{layer:null===(n=t.layout)||void 0===n?void 0:n.layer,top:null===(e=t.layout)||void 0===e?void 0:e.top,left:null===(o=t.layout)||void 0===o?void 0:o.left,bottom:null===(u=t.layout)||void 0===u?void 0:u.bottom,right:null===(h=t.layout)||void 0===h?void 0:h.right}},volume:null!==(a=t.volume)&&void 0!==a?a:100,audio_focus:t.isAudioFocus?1:0,audio_h_angle:-1,render_mode:t.renderMode,corner_radius:t.cornerRadius};if(null===(c=t.label)||void 0===c?void 0:c.text){var N={font_type:(null===(f=null===(l=t.label)||void 0===l?void 0:l.font)||void 0===f?void 0:f.type)||0,font_size:(null===(_=null===(d=t.label)||void 0===d?void 0:d.font)||void 0===_?void 0:_.size)||24,font_color:(null===(m=null===(v=t.label)||void 0===v?void 0:v.font)||void 0===m?void 0:m.color)||16777215,font_transparency:(null===(g=null===(p=t.label)||void 0===p?void 0:p.font)||void 0===g?void 0:g.transparency)||0};N.font_border_color=(null===(E=null===(b=t.label)||void 0===b?void 0:b.font)||void 0===E?void 0:E.border)?null===(y=null===(S=t.label)||void 0===S?void 0:S.font)||void 0===y?void 0:y.borderColor:-1;var C={text:null===(T=t.label)||void 0===T?void 0:T.text,text_left:(null===(R=t.label)||void 0===R?void 0:R.left)||0,text_top:(null===(w=t.label)||void 0===w?void 0:w.top)||0,font:N};I.label=C}t.imageInfo&&(I.image={url:t.imageInfo.url,display_mode:t.imageInfo.displayMode||0}),t.soundLevelID&&(I.stream_input_common.sound_level_id=t.soundLevelID),r.input_stream.push(I)})),t.outputList.forEach((function(t){var i,n,e,h,a,c,l,f,d,_,v,m,p,g="";if(_n(t)?g=t:pn(t)&&t.target?g=t.target:s.logger.error("zb.sh.ums output target required"),Nn(g))m=1,p=g;else{m=0,p=s.stateCenter.testEnvironment?"zegotest-"+s.stateCenter.appid+"-"+g:g}var b=o.outputBitrate;"string"!=typeof t&&(null===(i=t.videoConfig)||void 0===i?void 0:i.bitrate)&&(b=null===(n=t.videoConfig)||void 0===n?void 0:n.bitrate);var E={is_url:m,target:p,video_bitrate:1e3*b,video_fps:o.outputFPS,video_width:o.outputWidth,video_height:o.outputHeight,output_quality:23};o.outputAudioCodecID&&(E.audio_enc_id=o.outputAudioCodecID),"vp8"===u.videoCodec?E.audio_enc_id=3:"h264"===u.videoCodec&&(E.audio_enc_id=0),o.outputAudioBitrate&&(E.audio_bitrate=1e3*o.outputAudioBitrate);var S={output_stream_common:E};"string"!=typeof t&&((null===(e=t.videoConfig)||void 0===e?void 0:e.videoCodecID)&&(S.video_enc_id=Ta[null===(h=t.videoConfig)||void 0===h?void 0:h.videoCodecID]||0),(null===(a=t.videoConfig)||void 0===a?void 0:a.encodeProfile)&&[0,1,2,3].includes(null===(c=t.videoConfig)||void 0===c?void 0:c.encodeProfile)&&(S.video_encode_profile=function(t){var i=1;switch(t){case Wh.ZegoEncodeProfileDefault:case Wh.ZegoEncodeProfileMain:i=1;break;case Wh.ZegoEncodeProfileBaseline:i=0;break;case Wh.ZegoEncodeProfileHigh:i=2}return i}(null===(l=t.videoConfig)||void 0===l?void 0:l.encodeProfile)),dn(null===(f=t.videoConfig)||void 0===f?void 0:f.encodeLatency)&&(S.video_encode_latency=null===(d=t.videoConfig)||void 0===d?void 0:d.encodeLatency),vn(null===(_=t.videoConfig)||void 0===_?void 0:_.enableLowBitrateHD)&&(S.low_bitrate_hd=(null===(v=t.videoConfig)||void 0===v?void 0:v.enableLowBitrateHD)?1:0)),r.output_stream.push(S)})),t.watermark&&(r.water_mark={image:t.watermark.imageURL,layout_rect:t.watermark.layout}),t.whiteboard){var h=t.whiteboard,a=h.horizontalRatio,c=h.verticalRatio,l=h.layout,f=h.zOrder,d=h.isPPTAnimation,_=h.backgroundColor;r.white_board={whiteboard_id:oa.fromString(h.whiteboardID),horizontal_ratio:a||16,vertical_ratio:c||9,is_ppt_animation:!0===d?1:0,layout_rect:da(da({},l),{layer:f||0}),background_color:_||4059296768}}return isNaN(t.streamAlignmentMode)||(r.mix_stream_common.alignment_type=t.streamAlignmentMode),r.audio_channel_cnt=o.outputAudioChannels?o.outputAudioChannels:1,o.audioMixMode&&(r.audio_mix_mode=o.audioMixMode),{mixStartReq:r}},updateMixStream:function(t,i,n,e){var s=this;this.logger.info("zb.sh.ums call"),this.logger.info("zb.sh.ums send command");var r=this.getStartMixStreamParams(t,i).mixStartReq;return this._sendMixStartReqByAccessHub(r,"zegotest-"+this.stateCenter.appid+"-",(function(i){s.startMixHb(t.taskID),n(i)}),e),!0},updateAutoMixStream:function(t,i,n){var e=this;this.logger.info("zb.sh.uams.0 call");var s=t.taskID,r=t.roomID,o=t.audioConfig,u=t.outputList,h=t.enableSoundLevel,a=t.streamAlignmentMode,c=t.minPlayStreamBufferLength;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new ua);var l=[];u.forEach((function(t){var i=t.target,n=0;(i.startsWith("rtmp://")||i.startsWith("avertp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8"))&&(n=1),l.push({stream_out_common:{target:i,is_url:n,audio_bitrate:(null==o?void 0:o.bitrate)?1e3*(null==o?void 0:o.bitrate):48e3,audio_enc_id:mn(null==o?void 0:o.codecID)?0:Ra(null==o?void 0:o.codecID),video_fps:1,video_bitrate:1,video_width:1,video_height:1},audio_channel_cnt:(null==o?void 0:o.channel)||1})}));var f={request_seq:this.stateCenter.getSeq(),mix_stream_common:{with_sound_level:h?1:0,alignment_type:a},room_id:r,task_id:s,output_stream:l};dn(c)&&c>=0&&(f.has_recv_buffer_level=!0,f.recv_buffer_level=c),this.logger.info("zb.sh.uams.0 params "+JSON.stringify(f));var d=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStartReq(f),_=function(t,i){try{var n=e.mixStreamProtoBuf.decodeAutoRoomMixStreamStartRsp(t);On(n),e.logger.info("zb.sh.uams.0 rsp "+JSON.stringify(n));var s=n.common_response;return{code:s.code,msg:s.message}}catch(t){return{code:-1}}};return this.sendMixRequest({interfaceID:10},d,(function(t,s){e.mixSucFun(t,i,n,_,"zb.sh.uams.0")}),(function(t,i,s){e.mixFailFun(t,i,s,n,_,"zb.sh.uams.0")}),6),!0},stopAutoMixStream:function(t,i,n){var e=this,s=t.taskID,r=t.roomID,o={request_seq:this.stateCenter.getSeq(),room_id:r,task_id:s};this.logger.info("zb.sh.uams.1 params "+JSON.stringify(o));var u=this.mixStreamProtoBuf.encodeAutoRoomMixStreamStopReq(o),h=function(t,i){try{var n=e.mixStreamProtoBuf.decodeAutoRoomMixStreamStopRsp(t);On(n),e.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(n));var s=n.common_response;return{code:s.code,msg:s.message}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:11},u,(function(t,s){e.mixSucFun(t,i,n,h,"zb.sh.uams.1")}),(function(t,i,s){e.mixFailFun(t,i,s,n,h,"zb.sh.uams.1")}),6)},mixSucFun:function(t,i,n,e,s,r){var o=e(t,r),u=o.code,h=o.msg;void 0===u||0===u?(this.logger.info(s+" suc"),i&&i({errorCode:0,extendedData:""})):(this.logger.info(s+" fail "+u+" "+h),n&&n({errorCode:this.stateCenter.getServerError(ma+(u+1e9)).code,extendedData:h}))},mixFailFun:function(t,i,n,e,s,r){var o="";if(n)return n.code==ra.TIMEOUT.code&&(n=ha.error.Sr),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(ra.MIXER_NO_SERVICES))),void(e&&e(n,o));n=ha.error.Sr;var u="";if(_n(i))u=i;else{var h=s(i);u=h.code+" "+h.msg}o="request media server fail, error: "+t+" "+u,this.logger.error("".concat(r," http fail ").concat(o)),e&&e(n,o)},getStopMixStreamParams:function(t,i,n){var e={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:"3.6.0"},s={request_seq:this.stateCenter.getSeq(),room_id:this.roomID};if(_n(t)&&(e.task_id=t,s.task_id=t),null!=i){var r=void 0;e.stream_id=r=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+i:i,s.is_url=0,s.target=r}else null!=n&&(e.mixurl=n,s.is_url=1,s.target=n);return{req_body:e,mixStopReq:s}},getMixStreamStatus:function(t){this.logger.info("zb.sh.fmss call");for(var i=0;i<t.length;i++){var n=t[i],e=n.trans_type.replace("mixpushstatus:",""),s=e.replace(this.stateCenter.appid+":",""),r=this.mixStreamTaskList[s],o=JSON.parse(n.trans_data),u=o.request_id;if(r&&r.requestId===u){var h=parseInt(o.version);h<=r.mixStatusVer&&1!=h?this.logger.info("zb.sh.fmss data ver is not new"):this.fetchMixStreamStatus(e)}else this.logger.info("zb.sh.fmss taskId don't exist"),this.mixRequestIdList.push(u)}},fetchMixStreamStatus:function(t){var i=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new ua);var n={request_seq:this.stateCenter.getSeq(),task_id:t},e=this.mixStreamProtoBuf.encodeGetMixStreamStatusReq(n),s=t.replace(this.stateCenter.appid+":","");this.sendMixRequest({interfaceID:13},e,(function(t,n){var e=function(t){try{var n=i.mixStreamProtoBuf.decodeGetMixStreamStatusRsp(t);On(n),i.logger.info("zb.sh.fmss rsp "+JSON.stringify(n));var e=n.common_response;return{code:e.code,msg:e.message,push_url:n.push_url,request_seq:n.request_seq,task_id:n.task_id,version:n.version}}catch(t){return{code:-1}}}(t),r=e.code,o=e.msg,u=e.push_url,h=e.task_id,a=e.version;if(void 0!==r&&0!==r||!dn(a))i.logger.warn("zb.sh.fmss fail "+r+" "+o);else{var c=i.mixStreamTaskList[s];if(!c)return void i.logger.info("zb.sh.fmss taskId don't exist");if(a<=c.mixStatusVer&&1!=a)return void i.logger.warn("zb.sh.fmss data ver is not new");c.mixStatusVer=a;var l=[];u.forEach((function(t){l.push({url:t.url,state:ga[t.status],updateReason:ba[t.reason],stateTime:oa.isLong(t.mod_time)?t.mod_time.toNumber():t.mod_time})})),i.stateCenter.actionListener("mixerRelayCDNStateUpdate",h,l)}}),(function(t,n,e){i.logger.warn("zb.sh.fmss http fail "+t+" "+JSON.stringify(e))}))},startMixHb:function(t){var i=this;this.logger.info("zb.sh.smh.0 call");var n={request_seq:this.stateCenter.getSeq(),task_id:"".concat(t)},e=this.mixStreamProtoBuf.encodeMixStreamTaskHbReq(n);this.sendMixRequest({interfaceID:12},e,(function(n,e){var s=function(t){try{var n=i.mixStreamProtoBuf.decodeMixStreamTaskHbRsp(t);On(n),i.logger.info("zb.sh.smh.0 rsp "+JSON.stringify(n));var e=n.common_response;return{code:e.code,msg:e.message,status:n.status,hb_interval:n.hb_interval}}catch(t){return{code:-1}}}(n),r=s.code,o=s.msg,u=s.status,h=s.hb_interval;void 0===r||0===r?(i.logger.info("zb.sh.smh.0 suc ".concat(u," ").concat(h)),dn(h)&&0===u&&(!i.mixStreamHbList[t]&&(i.mixStreamHbList[t]={}),i.mixStreamHbList[t].timer=setTimeout((function(){i.startMixHb(t)}),1e3*h))):i.logger.info("zb.sh.smh.0 fail ".concat(r," ").concat(o))}),(function(t,n,e){i.logger.info("zb.sh.smh.0 send err ".concat(t," ").concat(e))}))}},Na={type:"MixStream",install:function(t,i){for(var n in Oa)Object.defineProperty(t.prototype,n,{value:Oa[n],writable:!1});for(var n in Ia)Object.defineProperty(i.prototype,n,{value:Ia[n],writable:!1})}},Ca=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();Tu.use(Rh),Tu.use(sa),Tu.use(Na);var ka=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return Ca(i,t),i}(Tu)})(),__webpack_exports__})()));