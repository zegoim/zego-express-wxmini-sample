!function(t,i){if("object"==typeof exports&&"object"==typeof module)module.exports=i();else if("function"==typeof define&&define.amd)define([],i);else{var n=i();for(var e in n)("object"==typeof exports?exports:t)[e]=n[e]}}("undefined"!=typeof self?self:this,(function(){return(()=>{var __webpack_modules__={537:t=>{"use strict";t.exports=function(t,i){var n=new Array(arguments.length-1),e=0,s=2,r=!0;for(;s<arguments.length;)n[e++]=arguments[s++];return new Promise((function(s,o){n[e]=function(t){if(r)if(r=!1,t)o(t);else{for(var i=new Array(arguments.length-1),n=0;n<i.length;)i[n++]=arguments[n];s.apply(null,i)}};try{t.apply(i||null,n)}catch(t){r&&(r=!1,o(t))}}))}},419:(t,i)=>{"use strict";var n=i;n.length=function(t){var i=t.length;if(!i)return 0;for(var n=0;--i%4>1&&"="===t.charAt(i);)++n;return Math.ceil(3*t.length)/4-n};for(var e=new Array(64),s=new Array(123),r=0;r<64;)s[e[r]=r<26?r+65:r<52?r+71:r<62?r-4:r-59|43]=r++;n.encode=function(t,i,n){for(var s,r=null,o=[],u=0,h=0;i<n;){var c=t[i++];switch(h){case 0:o[u++]=e[c>>2],s=(3&c)<<4,h=1;break;case 1:o[u++]=e[s|c>>4],s=(15&c)<<2,h=2;break;case 2:o[u++]=e[s|c>>6],o[u++]=e[63&c],h=0}u>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),u=0)}return h&&(o[u++]=e[s],o[u++]=61,1===h&&(o[u++]=61)),r?(u&&r.push(String.fromCharCode.apply(String,o.slice(0,u))),r.join("")):String.fromCharCode.apply(String,o.slice(0,u))};var o="invalid encoding";n.decode=function(t,i,n){for(var e,r=n,u=0,h=0;h<t.length;){var c=t.charCodeAt(h++);if(61===c&&u>1)break;if(void 0===(c=s[c]))throw Error(o);switch(u){case 0:e=c,u=1;break;case 1:i[n++]=e<<2|(48&c)>>4,e=c,u=2;break;case 2:i[n++]=(15&e)<<4|(60&c)>>2,e=c,u=3;break;case 3:i[n++]=(3&e)<<6|c,u=0}}if(1===u)throw Error(o);return n-r},n.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},211:t=>{"use strict";function i(){this._listeners={}}t.exports=i,i.prototype.on=function(t,i,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:i,ctx:n||this}),this},i.prototype.off=function(t,i){if(void 0===t)this._listeners={};else if(void 0===i)this._listeners[t]=[];else for(var n=this._listeners[t],e=0;e<n.length;)n[e].fn===i?n.splice(e,1):++e;return this},i.prototype.emit=function(t){var i=this._listeners[t];if(i){for(var n=[],e=1;e<arguments.length;)n.push(arguments[e++]);for(e=0;e<i.length;)i[e].fn.apply(i[e++].ctx,n)}return this}},945:t=>{"use strict";function i(t){return"undefined"!=typeof Float32Array?function(){var i=new Float32Array([-0]),n=new Uint8Array(i.buffer),e=128===n[3];function s(t,e,s){i[0]=t,e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2],e[s+3]=n[3]}function r(t,e,s){i[0]=t,e[s]=n[3],e[s+1]=n[2],e[s+2]=n[1],e[s+3]=n[0]}function o(t,e){return n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],i[0]}function u(t,e){return n[3]=t[e],n[2]=t[e+1],n[1]=t[e+2],n[0]=t[e+3],i[0]}t.writeFloatLE=e?s:r,t.writeFloatBE=e?r:s,t.readFloatLE=e?o:u,t.readFloatBE=e?u:o}():function(){function i(t,i,n,e){var s=i<0?1:0;if(s&&(i=-i),0===i)t(1/i>0?0:2147483648,n,e);else if(isNaN(i))t(2143289344,n,e);else if(i>34028234663852886e22)t((s<<31|2139095040)>>>0,n,e);else if(i<11754943508222875e-54)t((s<<31|Math.round(i/1401298464324817e-60))>>>0,n,e);else{var r=Math.floor(Math.log(i)/Math.LN2);t((s<<31|r+127<<23|8388607&Math.round(i*Math.pow(2,-r)*8388608))>>>0,n,e)}}function o(t,i,n){var e=t(i,n),s=2*(e>>31)+1,r=e>>>23&255,o=8388607&e;return 255===r?o?NaN:s*(1/0):0===r?1401298464324817e-60*s*o:s*Math.pow(2,r-150)*(o+8388608)}t.writeFloatLE=i.bind(null,n),t.writeFloatBE=i.bind(null,e),t.readFloatLE=o.bind(null,s),t.readFloatBE=o.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var i=new Float64Array([-0]),n=new Uint8Array(i.buffer),e=128===n[7];function s(t,e,s){i[0]=t,e[s]=n[0],e[s+1]=n[1],e[s+2]=n[2],e[s+3]=n[3],e[s+4]=n[4],e[s+5]=n[5],e[s+6]=n[6],e[s+7]=n[7]}function r(t,e,s){i[0]=t,e[s]=n[7],e[s+1]=n[6],e[s+2]=n[5],e[s+3]=n[4],e[s+4]=n[3],e[s+5]=n[2],e[s+6]=n[1],e[s+7]=n[0]}function o(t,e){return n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],n[4]=t[e+4],n[5]=t[e+5],n[6]=t[e+6],n[7]=t[e+7],i[0]}function u(t,e){return n[7]=t[e],n[6]=t[e+1],n[5]=t[e+2],n[4]=t[e+3],n[3]=t[e+4],n[2]=t[e+5],n[1]=t[e+6],n[0]=t[e+7],i[0]}t.writeDoubleLE=e?s:r,t.writeDoubleBE=e?r:s,t.readDoubleLE=e?o:u,t.readDoubleBE=e?u:o}():function(){function i(t,i,n,e,s,r){var o=e<0?1:0;if(o&&(e=-e),0===e)t(0,s,r+i),t(1/e>0?0:2147483648,s,r+n);else if(isNaN(e))t(0,s,r+i),t(2146959360,s,r+n);else if(e>17976931348623157e292)t(0,s,r+i),t((o<<31|2146435072)>>>0,s,r+n);else{var u;if(e<22250738585072014e-324)t((u=e/5e-324)>>>0,s,r+i),t((o<<31|u/4294967296)>>>0,s,r+n);else{var h=Math.floor(Math.log(e)/Math.LN2);1024===h&&(h=1023),t(4503599627370496*(u=e*Math.pow(2,-h))>>>0,s,r+i),t((o<<31|h+1023<<20|1048576*u&1048575)>>>0,s,r+n)}}}function o(t,i,n,e,s){var r=t(e,s+i),o=t(e,s+n),u=2*(o>>31)+1,h=o>>>20&2047,c=4294967296*(1048575&o)+r;return 2047===h?c?NaN:u*(1/0):0===h?5e-324*u*c:u*Math.pow(2,h-1075)*(c+4503599627370496)}t.writeDoubleLE=i.bind(null,n,0,4),t.writeDoubleBE=i.bind(null,e,4,0),t.readDoubleLE=o.bind(null,s,0,4),t.readDoubleBE=o.bind(null,r,4,0)}(),t}function n(t,i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}function e(t,i,n){i[n]=t>>>24,i[n+1]=t>>>16&255,i[n+2]=t>>>8&255,i[n+3]=255&t}function s(t,i){return(t[i]|t[i+1]<<8|t[i+2]<<16|t[i+3]<<24)>>>0}function r(t,i){return(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])>>>0}t.exports=i(i)},199:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}module.exports=inquire},662:t=>{"use strict";t.exports=function(t,i,n){var e=n||8192,s=e>>>1,r=null,o=e;return function(n){if(n<1||n>s)return t(n);o+n>e&&(r=t(e),o=0);var u=i.call(r,o,o+=n);return 7&o&&(o=1+(7|o)),u}}},997:(t,i)=>{"use strict";var n=i;n.length=function(t){for(var i=0,n=0,e=0;e<t.length;++e)(n=t.charCodeAt(e))<128?i+=1:n<2048?i+=2:55296==(64512&n)&&56320==(64512&t.charCodeAt(e+1))?(++e,i+=4):i+=3;return i},n.read=function(t,i,n){if(n-i<1)return"";for(var e,s=null,r=[],o=0;i<n;)(e=t[i++])<128?r[o++]=e:e>191&&e<224?r[o++]=(31&e)<<6|63&t[i++]:e>239&&e<365?(e=((7&e)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536,r[o++]=55296+(e>>10),r[o++]=56320+(1023&e)):r[o++]=(15&e)<<12|(63&t[i++])<<6|63&t[i++],o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,r)),o=0);return s?(o&&s.push(String.fromCharCode.apply(String,r.slice(0,o))),s.join("")):String.fromCharCode.apply(String,r.slice(0,o))},n.write=function(t,i,n){for(var e,s,r=n,o=0;o<t.length;++o)(e=t.charCodeAt(o))<128?i[n++]=e:e<2048?(i[n++]=e>>6|192,i[n++]=63&e|128):55296==(64512&e)&&56320==(64512&(s=t.charCodeAt(o+1)))?(++o,i[n++]=(e=65536+((1023&e)<<10)+(1023&s))>>18|240,i[n++]=e>>12&63|128,i[n++]=e>>6&63|128,i[n++]=63&e|128):(i[n++]=e>>12|224,i[n++]=e>>6&63|128,i[n++]=63&e|128);return n-r}},720:t=>{t.exports=n;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=e;var s={},r={};function o(t,i){var n,e,o;return i?(o=0<=(t>>>=0)&&t<256)&&(e=r[t])?e:(n=h(t,(0|t)<0?-1:0,!0),o&&(r[t]=n),n):(o=-128<=(t|=0)&&t<128)&&(e=s[t])?e:(n=h(t,t<0?-1:0,!1),o&&(s[t]=n),n)}function u(t,i){if(isNaN(t))return i?p:v;if(i){if(t<0)return p;if(t>=_)return R}else{if(t<=-d)return y;if(t+1>=d)return S}return t<0?u(-t,i).neg():h(t%f|0,t/f|0,i)}function h(t,i,e){return new n(t,i,e)}n.fromInt=o,n.fromNumber=u,n.fromBits=h;var c=Math.pow;function a(t,i,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return v;if("number"==typeof i?(n=i,i=!1):i=!!i,(n=n||10)<2||36<n)throw RangeError("radix");var e;if((e=t.indexOf("-"))>0)throw Error("interior hyphen");if(0===e)return a(t.substring(1),i,n).neg();for(var s=u(c(n,8)),r=v,o=0;o<t.length;o+=8){var h=Math.min(8,t.length-o),l=parseInt(t.substring(o,o+h),n);if(h<8){var f=u(c(n,h));r=r.mul(f).add(u(l))}else r=(r=r.mul(s)).add(u(l))}return r.unsigned=i,r}function l(t,i){return"number"==typeof t?u(t,i):"string"==typeof t?a(t,i):h(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=a,n.fromValue=l;var f=4294967296,_=f*f,d=_/2,m=o(1<<24),v=o(0);n.ZERO=v;var p=o(0,!0);n.UZERO=p;var g=o(1);n.ONE=g;var b=o(1,!0);n.UONE=b;var E=o(-1);n.NEG_ONE=E;var S=h(-1,2147483647,!1);n.MAX_VALUE=S;var R=h(-1,-1,!0);n.MAX_UNSIGNED_VALUE=R;var y=h(0,-2147483648,!1);n.MIN_VALUE=y;var O=n.prototype;O.toInt=function(){return this.unsigned?this.low>>>0:this.low},O.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},O.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(y)){var i=u(t),n=this.div(i),e=n.mul(i).sub(this);return n.toString(t)+e.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var s=u(c(t,6),this.unsigned),r=this,o="";;){var h=r.div(s),a=(r.sub(h.mul(s)).toInt()>>>0).toString(t);if((r=h).isZero())return a+o;for(;a.length<6;)a="0"+a;o=""+a+o}},O.getHighBits=function(){return this.high},O.getHighBitsUnsigned=function(){return this.high>>>0},O.getLowBits=function(){return this.low},O.getLowBitsUnsigned=function(){return this.low>>>0},O.getNumBitsAbs=function(){if(this.isNegative())return this.eq(y)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;i>0&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},O.isZero=function(){return 0===this.high&&0===this.low},O.eqz=O.isZero,O.isNegative=function(){return!this.unsigned&&this.high<0},O.isPositive=function(){return this.unsigned||this.high>=0},O.isOdd=function(){return 1==(1&this.low)},O.isEven=function(){return 0==(1&this.low)},O.equals=function(t){return e(t)||(t=l(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},O.eq=O.equals,O.notEquals=function(t){return!this.eq(t)},O.neq=O.notEquals,O.ne=O.notEquals,O.lessThan=function(t){return this.comp(t)<0},O.lt=O.lessThan,O.lessThanOrEqual=function(t){return this.comp(t)<=0},O.lte=O.lessThanOrEqual,O.le=O.lessThanOrEqual,O.greaterThan=function(t){return this.comp(t)>0},O.gt=O.greaterThan,O.greaterThanOrEqual=function(t){return this.comp(t)>=0},O.gte=O.greaterThanOrEqual,O.ge=O.greaterThanOrEqual,O.compare=function(t){if(e(t)||(t=l(t)),this.eq(t))return 0;var i=this.isNegative(),n=t.isNegative();return i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},O.comp=O.compare,O.negate=function(){return!this.unsigned&&this.eq(y)?y:this.not().add(g)},O.neg=O.negate,O.add=function(t){e(t)||(t=l(t));var i=0,n=0,s=0,r=0;return s+=(r+=(65535&this.low)+(65535&t.low))>>>16,n+=(s+=(this.low>>>16)+(t.low>>>16))>>>16,i+=(n+=(65535&this.high)+(65535&t.high))>>>16,i+=(this.high>>>16)+(t.high>>>16),h((s&=65535)<<16|(r&=65535),(i&=65535)<<16|(n&=65535),this.unsigned)},O.subtract=function(t){return e(t)||(t=l(t)),this.add(t.neg())},O.sub=O.subtract,O.multiply=function(t){if(this.isZero())return v;if(e(t)||(t=l(t)),i)return h(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned);if(t.isZero())return v;if(this.eq(y))return t.isOdd()?y:v;if(t.eq(y))return this.isOdd()?y:v;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(m)&&t.lt(m))return u(this.toNumber()*t.toNumber(),this.unsigned);var n=65535&this.high,s=this.low>>>16,r=65535&this.low,o=65535&t.high,c=t.low>>>16,a=65535&t.low,f=0,_=0,d=0,p=0;return d+=(p+=r*a)>>>16,_+=(d+=s*a)>>>16,d&=65535,_+=(d+=r*c)>>>16,f+=(_+=n*a)>>>16,_&=65535,f+=(_+=s*c)>>>16,_&=65535,f+=(_+=r*o)>>>16,f+=(this.high>>>16)*a+n*c+s*o+r*(t.high>>>16),h((d&=65535)<<16|(p&=65535),(f&=65535)<<16|(_&=65535),this.unsigned)},O.mul=O.multiply,O.divide=function(t){if(e(t)||(t=l(t)),t.isZero())throw Error("division by zero");var n,s,r;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?h((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?p:v;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return p;if(t.gt(this.shru(1)))return b;r=p}else{if(this.eq(y))return t.eq(g)||t.eq(E)?y:t.eq(y)?g:(n=this.shr(1).div(t).shl(1)).eq(v)?t.isNegative()?g:E:(s=this.sub(t.mul(n)),r=n.add(s.div(t)));if(t.eq(y))return this.unsigned?p:v;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();r=v}for(s=this;s.gte(t);){n=Math.max(1,Math.floor(s.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),a=o<=48?1:c(2,o-48),f=u(n),_=f.mul(t);_.isNegative()||_.gt(s);)_=(f=u(n-=a,this.unsigned)).mul(t);f.isZero()&&(f=g),r=r.add(f),s=s.sub(_)}return r},O.div=O.divide,O.modulo=function(t){return e(t)||(t=l(t)),i?h((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},O.mod=O.modulo,O.rem=O.modulo,O.not=function(){return h(~this.low,~this.high,this.unsigned)},O.and=function(t){return e(t)||(t=l(t)),h(this.low&t.low,this.high&t.high,this.unsigned)},O.or=function(t){return e(t)||(t=l(t)),h(this.low|t.low,this.high|t.high,this.unsigned)},O.xor=function(t){return e(t)||(t=l(t)),h(this.low^t.low,this.high^t.high,this.unsigned)},O.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):h(0,this.low<<t-32,this.unsigned)},O.shl=O.shiftLeft,O.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?h(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):h(this.high>>t-32,this.high>=0?0:-1,this.unsigned)},O.shr=O.shiftRight,O.shiftRightUnsigned=function(t){if(e(t)&&(t=t.toInt()),0===(t&=63))return this;var i=this.high;return t<32?h(this.low>>>t|i<<32-t,i>>>t,this.unsigned):h(32===t?i:i>>>t-32,0,this.unsigned)},O.shru=O.shiftRightUnsigned,O.shr_u=O.shiftRightUnsigned,O.toSigned=function(){return this.unsigned?h(this.low,this.high,!1):this},O.toUnsigned=function(){return this.unsigned?this:h(this.low,this.high,!0)},O.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},O.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},O.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,e){return e?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)}},100:(t,i,n)=>{"use strict";t.exports=n(482)},482:(t,i,n)=>{"use strict";var e=i;function s(){e.util._configure(),e.Writer._configure(e.BufferWriter),e.Reader._configure(e.BufferReader)}e.build="minimal",e.Writer=n(173),e.BufferWriter=n(155),e.Reader=n(408),e.BufferReader=n(593),e.util=n(693),e.rpc=n(994),e.roots=n(54),e.configure=s,s()},408:(t,i,n)=>{"use strict";t.exports=h;var e,s=n(693),r=s.LongBits,o=s.utf8;function u(t,i){return RangeError("index out of range: "+t.pos+" + "+(i||1)+" > "+t.len)}function h(t){this.buf=t,this.pos=0,this.len=t.length}var c,a="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new h(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new h(t);throw Error("illegal buffer")},l=function(){return s.Buffer?function(t){return(h.create=function(t){return s.Buffer.isBuffer(t)?new e(t):a(t)})(t)}:a};function f(){var t=new r(0,0),i=0;if(!(this.len-this.pos>4)){for(;i<3;++i){if(this.pos>=this.len)throw u(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*i)>>>0,t}for(;i<4;++i)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*i)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(i=0,this.len-this.pos>4){for(;i<5;++i)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}else for(;i<5;++i){if(this.pos>=this.len)throw u(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function _(t,i){return(t[i-4]|t[i-3]<<8|t[i-2]<<16|t[i-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw u(this,8);return new r(_(this.buf,this.pos+=4),_(this.buf,this.pos+=4))}h.create=l(),h.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,h.prototype.uint32=(c=4294967295,function(){if(c=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return c;if(c=(c|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return c;if((this.pos+=5)>this.len)throw this.pos=this.len,u(this,10);return c}),h.prototype.int32=function(){return 0|this.uint32()},h.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},h.prototype.bool=function(){return 0!==this.uint32()},h.prototype.fixed32=function(){if(this.pos+4>this.len)throw u(this,4);return _(this.buf,this.pos+=4)},h.prototype.sfixed32=function(){if(this.pos+4>this.len)throw u(this,4);return 0|_(this.buf,this.pos+=4)},h.prototype.float=function(){if(this.pos+4>this.len)throw u(this,4);var t=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},h.prototype.double=function(){if(this.pos+8>this.len)throw u(this,4);var t=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},h.prototype.bytes=function(){var t=this.uint32(),i=this.pos,n=this.pos+t;if(n>this.len)throw u(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(i,n):i===n?new this.buf.constructor(0):this._slice.call(this.buf,i,n)},h.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},h.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw u(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw u(this)}while(128&this.buf[this.pos++]);return this},h.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},h._configure=function(t){e=t,h.create=l(),e._configure();var i=s.Long?"toLong":"toNumber";s.merge(h.prototype,{int64:function(){return f.call(this)[i](!1)},uint64:function(){return f.call(this)[i](!0)},sint64:function(){return f.call(this).zzDecode()[i](!1)},fixed64:function(){return d.call(this)[i](!0)},sfixed64:function(){return d.call(this)[i](!1)}})}},593:(t,i,n)=>{"use strict";t.exports=r;var e=n(408);(r.prototype=Object.create(e.prototype)).constructor=r;var s=n(693);function r(t){e.call(this,t)}r._configure=function(){s.Buffer&&(r.prototype._slice=s.Buffer.prototype.slice)},r.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},r._configure()},54:t=>{"use strict";t.exports={}},994:(t,i,n)=>{"use strict";i.Service=n(948)},948:(t,i,n)=>{"use strict";t.exports=s;var e=n(693);function s(t,i,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");e.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(i),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(e.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function t(i,n,s,r,o){if(!r)throw TypeError("request must be specified");var u=this;if(!o)return e.asPromise(t,u,i,n,s,r);if(u.rpcImpl)try{return u.rpcImpl(i,n[u.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(t,n){if(t)return u.emit("error",t,i),o(t);if(null!==n){if(!(n instanceof s))try{n=s[u.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return u.emit("error",t,i),o(t)}return u.emit("data",n,i),o(null,n)}u.end(!0)}))}catch(t){return u.emit("error",t,i),void setTimeout((function(){o(t)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},630:(t,i,n)=>{"use strict";t.exports=s;var e=n(693);function s(t,i){this.lo=t>>>0,this.hi=i>>>0}var r=s.zero=new s(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(t){if(0===t)return r;var i=t<0;i&&(t=-t);var n=t>>>0,e=(t-n)/4294967296>>>0;return i&&(e=~e>>>0,n=~n>>>0,++n>4294967295&&(n=0,++e>4294967295&&(e=0))),new s(n,e)},s.from=function(t){if("number"==typeof t)return s.fromNumber(t);if(e.isString(t)){if(!e.Long)return s.fromNumber(parseInt(t,10));t=e.Long.fromString(t)}return t.low||t.high?new s(t.low>>>0,t.high>>>0):r},s.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var i=1+~this.lo>>>0,n=~this.hi>>>0;return i||(n=n+1>>>0),-(i+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(t){return e.Long?new e.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var u=String.prototype.charCodeAt;s.fromHash=function(t){return t===o?r:new s((u.call(t,0)|u.call(t,1)<<8|u.call(t,2)<<16|u.call(t,3)<<24)>>>0,(u.call(t,4)|u.call(t,5)<<8|u.call(t,6)<<16|u.call(t,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},s.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},s.prototype.length=function(){var t=this.lo,i=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===i?t<16384?t<128?1:2:t<2097152?3:4:i<16384?i<128?5:6:i<2097152?7:8:n<128?9:10}},693:function(t,i,n){"use strict";var e=i;function s(t,i,n){for(var e=Object.keys(i),s=0;s<e.length;++s)void 0!==t[e[s]]&&n||(t[e[s]]=i[e[s]]);return t}function r(t){function i(t,n){if(!(this instanceof i))return new i(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,i):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return(i.prototype=Object.create(Error.prototype)).constructor=i,Object.defineProperty(i.prototype,"name",{get:function(){return t}}),i.prototype.toString=function(){return this.name+": "+this.message},i}e.asPromise=n(537),e.base64=n(419),e.EventEmitter=n(211),e.float=n(945),e.inquire=n(199),e.utf8=n(997),e.pool=n(662),e.LongBits=n(630),e.isNode=Boolean(void 0!==n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),e.global=e.isNode&&n.g||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"==typeof t},e.isset=e.isSet=function(t,i){var n=t[i];return!(null==n||!t.hasOwnProperty(i))&&("object"!=typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,i){var n=e.LongBits.fromHash(t);return e.Long?e.Long.fromBits(n.lo,n.hi,i):n.toNumber(Boolean(i))},e.merge=s,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=r,e.ProtocolError=r("ProtocolError"),e.oneOfGetter=function(t){for(var i={},n=0;n<t.length;++n)i[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===i[t[n]]&&null!=this[t[n]])return t[n]}},e.oneOfSetter=function(t){return function(i){for(var n=0;n<t.length;++n)t[n]!==i&&delete this[t[n]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(i,n){return new t(i,n)},e._Buffer_allocUnsafe=t.allocUnsafe||function(i){return new t(i)}):e._Buffer_from=e._Buffer_allocUnsafe=null}},173:(t,i,n)=>{"use strict";t.exports=l;var e,s=n(693),r=s.LongBits,o=s.base64,u=s.utf8;function h(t,i,n){this.fn=t,this.len=i,this.next=void 0,this.val=n}function c(){}function a(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function l(){this.len=0,this.head=new h(c,0,0),this.tail=this.head,this.states=null}var f=function(){return s.Buffer?function(){return(l.create=function(){return new e})()}:function(){return new l}};function _(t,i,n){i[n]=255&t}function d(t,i){this.len=t,this.next=void 0,this.val=i}function m(t,i,n){for(;t.hi;)i[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)i[n++]=127&t.lo|128,t.lo=t.lo>>>7;i[n++]=t.lo}function v(t,i,n){i[n]=255&t,i[n+1]=t>>>8&255,i[n+2]=t>>>16&255,i[n+3]=t>>>24}l.create=f(),l.alloc=function(t){return new s.Array(t)},s.Array!==Array&&(l.alloc=s.pool(l.alloc,s.Array.prototype.subarray)),l.prototype._push=function(t,i,n){return this.tail=this.tail.next=new h(t,i,n),this.len+=i,this},(d.prototype=Object.create(h.prototype)).fn=function(t,i,n){for(;t>127;)i[n++]=127&t|128,t>>>=7;i[n]=t},l.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new d((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},l.prototype.int32=function(t){return t<0?this._push(m,10,r.fromNumber(t)):this.uint32(t)},l.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},l.prototype.int64=l.prototype.uint64=function(t){var i=r.from(t);return this._push(m,i.length(),i)},l.prototype.sint64=function(t){var i=r.from(t).zzEncode();return this._push(m,i.length(),i)},l.prototype.bool=function(t){return this._push(_,1,t?1:0)},l.prototype.sfixed32=l.prototype.fixed32=function(t){return this._push(v,4,t>>>0)},l.prototype.sfixed64=l.prototype.fixed64=function(t){var i=r.from(t);return this._push(v,4,i.lo)._push(v,4,i.hi)},l.prototype.float=function(t){return this._push(s.float.writeFloatLE,4,t)},l.prototype.double=function(t){return this._push(s.float.writeDoubleLE,8,t)};var p=s.Array.prototype.set?function(t,i,n){i.set(t,n)}:function(t,i,n){for(var e=0;e<t.length;++e)i[n+e]=t[e]};l.prototype.bytes=function(t){var i=t.length>>>0;if(!i)return this._push(_,1,0);if(s.isString(t)){var n=l.alloc(i=o.length(t));o.decode(t,n,0),t=n}return this.uint32(i)._push(p,i,t)},l.prototype.string=function(t){var i=u.length(t);return i?this.uint32(i)._push(u.write,i,t):this._push(_,1,0)},l.prototype.fork=function(){return this.states=new a(this),this.head=this.tail=new h(c,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new h(c,0,0),this.len=0),this},l.prototype.ldelim=function(){var t=this.head,i=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=i,this.len+=n),this},l.prototype.finish=function(){for(var t=this.head.next,i=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,i,n),n+=t.len,t=t.next;return i},l._configure=function(t){e=t,l.create=f(),e._configure()}},155:(t,i,n)=>{"use strict";t.exports=r;var e=n(173);(r.prototype=Object.create(e.prototype)).constructor=r;var s=n(693);function r(){e.call(this)}function o(t,i,n){t.length<40?s.utf8.write(t,i,n):i.utf8Write?i.utf8Write(t,n):i.write(t,n)}r._configure=function(){r.alloc=s._Buffer_allocUnsafe,r.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(t,i,n){i.set(t,n)}:function(t,i,n){if(t.copy)t.copy(i,n,0,t.length);else for(var e=0;e<t.length;)i[n++]=t[e++]}},r.prototype.bytes=function(t){s.isString(t)&&(t=s._Buffer_from(t,"base64"));var i=t.length>>>0;return this.uint32(i),i&&this._push(r.writeBytesBuffer,i,t),this},r.prototype.string=function(t){var i=s.Buffer.byteLength(t);return this.uint32(i),i&&this._push(o,i,t),this},r._configure()},901:function(t,i,n){"undefined"!=typeof self&&self,t.exports=function(t){return n=[function(t,i,n){"use strict";function e(t){return"number"==typeof t}function s(t){return"string"==typeof t}function r(t){return"boolean"==typeof t}function o(t){return void 0===t}function u(t){return null!==t&&t instanceof Object}function h(t){return"function"==typeof t}function c(t){return t instanceof Array}n.d(i,"d",(function(){return e})),n.d(i,"f",(function(){return s})),n.d(i,"b",(function(){return r})),n.d(i,"g",(function(){return o})),n.d(i,"e",(function(){return u})),n.d(i,"c",(function(){return h})),n.d(i,"a",(function(){return c}))},function(t,i,n){var e=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}function s(t){var i=Math.clz32(t&-t);return t?31-i:i}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=e;var r={},o={};function u(t,i){var n,e,s;return i?(s=0<=(t>>>=0)&&t<256)&&(e=o[t])?e:(n=c(t,0,!0),s&&(o[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(e=r[t])?e:(n=c(t,t<0?-1:0,!1),s&&(r[t]=n),n)}function h(t,i){if(isNaN(t))return i?g:p;if(i){if(t<0)return g;if(d<=t)return y}else{if(t<=-m)return O;if(m<=t+1)return R}return t<0?h(-t,i).neg():c(t%_|0,t/_|0,i)}function c(t,i,e){return new n(t,i,e)}n.fromInt=u,n.fromNumber=h,n.fromBits=c;var a=Math.pow;function l(t,i,n){if(0===t.length)throw Error("empty string");if(i="number"==typeof i?(n=i,!1):!!i,"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return i?g:p;if((n=n||10)<2||36<n)throw RangeError("radix");var e;if(0<(e=t.indexOf("-")))throw Error("interior hyphen");if(0===e)return l(t.substring(1),i,n).neg();for(var s=h(a(n,8)),r=p,o=0;o<t.length;o+=8){var u=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+u),n);r=(u<8?(u=h(a(n,u)),r.mul(u)):r=r.mul(s)).add(h(c))}return r.unsigned=i,r}function f(t,i){return"number"==typeof t?h(t,i):"string"==typeof t?l(t,i):c(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=l,n.fromValue=f;var _=4294967296,d=_*_,m=d/2,v=u(1<<24),p=u(0),g=(n.ZERO=p,u(0,!0)),b=(n.UZERO=g,u(1)),E=(n.ONE=b,u(1,!0)),S=(n.UONE=E,u(-1)),R=(n.NEG_ONE=S,c(-1,2147483647,!1)),y=(n.MAX_VALUE=R,c(-1,-1,!0)),O=(n.MAX_UNSIGNED_VALUE=y,c(0,-2147483648,!1)),T=(n.MIN_VALUE=O,n.prototype);return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},T.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";var i,n;if(this.isNegative())return this.eq(O)?(n=h(t),n=(i=this.div(n)).mul(n).sub(this),i.toString(t)+n.toInt().toString(t)):"-"+this.neg().toString(t);for(var e=h(a(t,6),this.unsigned),s=this,r="";;){var o=s.div(e),u=(s.sub(o.mul(e)).toInt()>>>0).toString(t);if((s=o).isZero())return u+r;for(;u.length<6;)u="0"+u;r=""+u+r}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;0<i&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||0<=this.high},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(t){return e(t)||(t=f(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},T.eq=T.equals,T.notEquals=function(t){return!this.eq(t)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(t){return this.comp(t)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(t){return this.comp(t)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(t){return 0<this.comp(t)},T.gt=T.greaterThan,T.greaterThanOrEqual=function(t){return 0<=this.comp(t)},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(t){var i,n;return e(t)||(t=f(t)),this.eq(t)?0:(i=this.isNegative(),n=t.isNegative(),i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1)},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(b)},T.neg=T.negate,T.add=function(t){e(t)||(t=f(t));var i=0,n=0,s=0,r=0;return n+=(s=s+((r+=(65535&this.low)+(65535&t.low))>>>16)+((this.low>>>16)+(t.low>>>16)))>>>16,c((s&=65535)<<16|(r&=65535),((i+=(n+=(65535&this.high)+(65535&t.high))>>>16)+((this.high>>>16)+(t.high>>>16))&65535)<<16|(n&=65535),this.unsigned)},T.subtract=function(t){return e(t)||(t=f(t)),this.add(t.neg())},T.sub=T.subtract,T.multiply=function(t){var n,s,r,o,u,a,l,_,d,m;return this.isZero()?this:(e(t)||(t=f(t)),i?c(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):t.isZero()?this.unsigned?g:p:this.eq(O)?t.isOdd()?O:p:t.eq(O)?this.isOdd()?O:p:this.isNegative()?t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg():t.isNegative()?this.mul(t.neg()).neg():this.lt(v)&&t.lt(v)?h(this.toNumber()*t.toNumber(),this.unsigned):(o=t.high>>>16,u=65535&t.high,a=t.low>>>16,m=(m=d=_=l=0)+((_=_+((d+=(r=65535&this.low)*(t=65535&t.low))>>>16)+(s=this.low>>>16)*t)>>>16)+((_=(65535&_)+r*a)>>>16),c((_&=65535)<<16|(d&=65535),(l=(l=(l+=(m+=(n=65535&this.high)*t)>>>16)+((m=(65535&m)+s*a)>>>16)+((m=(65535&m)+r*u)>>>16))+((this.high>>>16)*t+n*a+s*u+r*o)&65535)<<16|(m&=65535),this.unsigned)))},T.mul=T.multiply,T.divide=function(t){if((t=e(t)?t:f(t)).isZero())throw Error("division by zero");var n,s,r;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?c((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:p;if(this.unsigned){if((t=t.unsigned?t:t.toUnsigned()).gt(this))return g;if(t.gt(this.shru(1)))return E;s=g}else{if(this.eq(O))return t.eq(b)||t.eq(S)?O:t.eq(O)?b:(r=this.shr(1).div(t).shl(1)).eq(p)?t.isNegative()?b:S:(n=this.sub(t.mul(r)),r.add(n.div(t)));if(t.eq(O))return this.unsigned?g:p;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=p}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),u=o<=48?1:a(2,o-48),l=h(r),_=l.mul(t);_.isNegative()||_.gt(n);)_=(l=h(r-=u,this.unsigned)).mul(t);l.isZero()&&(l=b),s=s.add(l),n=n.sub(_)}return s},T.div=T.divide,T.modulo=function(t){return e(t)||(t=f(t)),i?c((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return c(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?s(this.low):s(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(t){return e(t)||(t=f(t)),c(this.low&t.low,this.high&t.high,this.unsigned)},T.or=function(t){return e(t)||(t=f(t)),c(this.low|t.low,this.high|t.high,this.unsigned)},T.xor=function(t){return e(t)||(t=f(t)),c(this.low^t.low,this.high^t.high,this.unsigned)},T.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):c(0,this.low<<t-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):c(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):c(32===t?this.high:this.high>>>t-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?c(this.high,this.low,this.unsigned):t<32?c(this.low<<t|this.high>>>(i=32-t),this.high<<t|this.low>>>i,this.unsigned):c(this.high<<(t-=32)|this.low>>>(i=32-t),this.low<<t|this.high>>>i,this.unsigned)},T.rotl=T.rotateLeft,T.rotateRight=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?c(this.high,this.low,this.unsigned):t<32?c(this.high<<(i=32-t)|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned):c(this.low<<(i=32-(t-=32))|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},T.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},T.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,e){return e?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)},t.default=n,"default"in t?t.default:t}({});void 0!==(i=function(){return e}.apply(i,[]))&&(t.exports=i)},function(t,i,n){function e(t){var i;return(r[t]||(i=r[t]={i:t,l:!1,exports:{}},s[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var s,r;t.exports=(s=[function(t,i,n){"use strict";n.r(i),n.d(i,"ZegoLogger",(function(){return X})),n.d(i,"ZegoDataReport",(function(){return _})),n.d(i,"createZegoWebSocket",(function(){return l})),n.d(i,"LoggerStateCenter",(function(){return o})),u.getInstance=function(){return u.instance||(u.instance=new u).init(),u.instance},u.prototype.init=function(){},Object.defineProperty(u.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(t){this._testEnvironment=t},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"ENV",{get:function(){return this._ENV},set:function(t){this._ENV=t},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t},enumerable:!1,configurable:!0}),u.instance=new u;var e,s,r,o=u;function u(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}(n=e=e||{})[n.BROWSER=0]="BROWSER",n[n.WEIXINMINI=1]="WEIXINMINI",(s=s||{})[s.DEFAULT=0]="DEFAULT",(i=r=r||{})[i.DISABLE=0]="DISABLE",i[i.WEBSOCKET=1]="WEBSOCKET",i[i.HTTPS=2]="HTTPS";var h={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},c=(a.prototype.init=function(){var t=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(i){t.readyState=t._websocket.readyState,"function"==typeof t.onopen&&(t.onopen(i),t._websocket.onClose((function(i){t.readyState=t._websocket.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t._websocket.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this._websocket.onError((function(i){t.readyState=t._websocket.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},a.prototype.onopen=function(t){},a.prototype.onerror=function(t){},a.prototype.onclose=function(t){},a.prototype.onmessage=function(t){},a.prototype.send=function(t){this._websocket&&this._websocket.send({data:t})},a.prototype.close=function(){this._websocket&&this._websocket.close()},a);function a(t,i){this.url=t,this.readyState=3,this._websocket=wx.connectSocket({url:t}),this.init()}function l(t,i){return new(i%2===e.BROWSER?WebSocket:c)(t)}var f=function(){return(f=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},_=(d.prototype.newReport=function(t,i){this.dataStatistics[t]={event_time:Date.now(),time_consumed:0,seq:t,error:0,message:"success",event:i,events:[]}},d.prototype.addMsgExt=function(t,i){this.dataStatistics[t]?this.dataStatistics[t].msg_ext=i:console.warn("".concat(t," not exist"))},d.prototype.addMsgInfo=function(t,i){this.dataStatistics[t]?Object.assign(this.dataStatistics[t],i):console.warn("".concat(t," not exist"))},d.prototype.eventStart=function(t,i){this.dataStatistics[t]?null!=this.dataStatistics[t].events?this.dataStatistics[t].events.push({event:i,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},d.prototype.eventEnd=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e&&0!==e.length){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},d.prototype.eventEndWithMsg=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time,null==e[s].msg_ext&&(e[s].msg_ext={}),e[s].msg_ext=f({},n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},d.prototype.eventEndWithMsgInfo=function(t,i,n){if(this.dataStatistics[t]){var e=this.dataStatistics[t].events;if(e){for(var s=e.length-1;0<=s;s--)if(e[s].event==i&&0==e[s].time_consumed){e[s].time_consumed=Date.now()-e[s].event_time,Object.assign(e[s],n);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},d.prototype.addEventInfo=function(t,i,n,e){if(this.dataStatistics[t]){var s=this.dataStatistics[t].events;if(null!=s){for(var r=s.length-1;0<=r;r--)if(s[r].event==i&&null!=s[r].time_consumed){null==s[r].msg_ext?s[r].msg_ext={}:s[r].msg_ext&&(s[r].msg_ext[n]=e);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},d.prototype.addEventMsg=function(t,i,n,e){if(this.dataStatistics[t]){var s=this.dataStatistics[t].events;if(null!=s){for(var r=s.length-1;0<=r;r--)if(s[r].event==i){s[r][n]=e;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},d.prototype.addEvent=function(t,i,n){this.dataStatistics[t]?this.dataStatistics[t].events&&this.dataStatistics[t].events.push(n?{event:i,event_time:Date.now(),msg_ext:n}:{event:i,event_time:Date.now()}):this.logger.warn("zd.ae.0 no seq match")},d.prototype.uploadReport=function(t,i,n,e){var s=this.dataStatistics[t];null!=s&&(i&&(s.event=i),s.time_consumed=Date.now()-s.event_time,n&&this.addMsgInfo(t,{error:n.code,message:n.message||n.msg+" "+(e||"")}),this.logger.report(s),delete this.dataStatistics[t])},d);function d(t){this.dataStatistics={},this.logger=t}var m,v=["00","01","02","03","04","05","06","07","08","09"];function p(){var t=new Date;return[t.getFullYear()+"/",(v[t.getMonth()+1]||t.getMonth()+1)+"/",(v[t.getDate()]||t.getDate())+" ",(v[t.getHours()]||t.getHours())+":",(v[t.getMinutes()]||t.getMinutes())+":",v[t.getSeconds()]||t.getSeconds(),"."+t.getTime()%1e3].join("")}function g(t){this.cache=t}(n=m=m||{}).WEBSOCKET_STATE_CHANGE="zl.net.wsc",n.OPEN_WS="zl.net.opws",Object.defineProperty(et.prototype,"url",{get:function(){return this.configState.url},set:function(t){this.configState.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(et.prototype,"strategy",{get:function(){return this.senderBuilder.strategy},enumerable:!1,configurable:!0}),et.prototype.setStrategy=function(t){this.senderBuilder.setStrategy(t),this.sender=this.senderBuilder.build()},et.prototype.addRemoteWsLog=function(t){if(this.configState.env!=e.BROWSER)throw new Error("cannot use net strategy on wx mini program");var i;this.closed()&&(i=this.url,this.url="",this.openWebSocketLogServer(i)),this.cache.push(t),this.connected()&&this.sender&&this.sender.active()},et.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},et.prototype.updateSender=function(){this.websocket instanceof WebSocket&&this.configState.useStrategy&&(this.senderBuilder.setWs(this.websocket),this.senderBuilder.setCache(this.cache),this.sender=this.senderBuilder.build())},et.prototype.updateWebSocketState=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];var e=this.websocketState,s="";switch(t){case"onconnecting":this.websocketState="never_opened"===this.websocketState?"first_connecting":"reconnecting";break;case"onopen":this.websocketState="connected";break;case"onclosed":this.websocketState="closed";var r=i[0];r&&(s+=" close code=".concat(r.code));break;case"onerror":this.websocketState="error"}t=m.WEBSOCKET_STATE_CHANGE+" log ws state change: ".concat(e," -> ").concat(this.websocketState),s&&(t+=s),this.innerLogger.info(t)},et.prototype.openWebSocketLogServer=function(t){var i=this;this.url!=t&&((this.url&&""!==this.url||"never_opened"===this.websocketState)&&this.innerLogger.info(m.OPEN_WS+" log url change to: ".concat(t)),this.url=t)&&(this.stopWebSocketServer(),this.websocket=l(t,this.configState.env),this.updateSender(),this.updateWebSocketState("onconnecting"),this.websocket.onopen=function(){var t;i.configState.useStrategy&&null!=(t=i.sender)&&t.active(),i.updateWebSocketState("onopen")},this.websocket.onclose=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.warn("onclose   websocket error:",t),i.updateWebSocketState.apply(i,function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}(["onclosed"],t,!1))},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];console.warn("open log websocket error:",t),i.updateWebSocketState("onerror")})},et.prototype.closed=function(){return null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState},et.prototype.connected=function(){return null!==this.websocket&&1==this.websocket.readyState},et.prototype.connecting=function(){return null!==this.websocket&&0==this.websocket.readyState},et.prototype.wsSend=function(t){this.websocket&&this.websocket.send(t)},et.prototype.destroy=function(){this.websocket=null};var b,E=et,S=(nt.prototype.active=function(){var t=this;this.ws&&1===this.ws.readyState&&0!==this.cache.size()&&this.strategy.canSendLog()&&(this.strategy.getLog().forEach((function(i){t.ws.send(i)})),this.strategy.onSendLog())},nt),R=(b=function(t,i){return(b=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t){function i(i){return t.call(this,i)||this}var n=i,e=t;if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function s(){this.constructor=n}return b(n,e),n.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s),i.prototype.getLog=function(){return this.cache.clear()},i.prototype.canSendLog=function(){return 0<this.cache.size()},i.prototype.onSendLog=function(){},i}(g));V=function(t,i){return(V=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}V(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(it,B=g),it.prototype.canSendLog=function(){return!this.locked&&0<this.cache.size()},it.prototype.getLog=function(){for(var t=[],i=0;i<this.maxPacketLen-4e3;){var n=this.cache.getOneLogPacket();if(!n||n.length<=0)break;i+=n.length||0,t.push(n)}return t},it.prototype.onSendLog=function(){var t=this;this.locked=!0,setTimeout((function(){t.locked=!1,t.onCanSendActive&&t.onCanSendActive()}),this.maxDelay)},H=function(t,i){return(H=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}H(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(tt,G=i=it);var y=tt,O=(q=function(t,i){return(q=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(){return null!==j&&j.apply(this,arguments)||this});if("function"!=typeof(n=j=i)&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function T(){this.constructor=O}q(O,n),O.prototype=null===n?Object.create(n):(T.prototype=n.prototype,new T),L=function(t,i){return(L=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};var w=function(){return null!==x&&x.apply(this,arguments)||this};if("function"!=typeof(n=x=i)&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function I(){this.constructor=w}function N(){this.url="",this.env=e.BROWSER,this.useStrategy=!0,this.token="",this.deviceid=k.id()}L(w,n),w.prototype=null===n?Object.create(n):(I.prototype=n.prototype,new I),U=function(t,i){return(U=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}U(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}((function(){return null!==M&&M.apply(this,arguments)||this}),M=i),Object.defineProperty(Q.prototype,"strategy",{get:function(){return this._strategy},enumerable:!1,configurable:!0}),Q.prototype.setWs=function(t){this.ws=t},Q.prototype.setCache=function(t){this.cache=t},Q.prototype.setStrategy=function(t){t&&(this._strategy=t)},Q.prototype.build=function(){if(this.ws&&this.cache)return new S(this.ws,this.cache,this._strategy!==s.DEFAULT?new R(this.cache):new y(this.cache));throw new Error("cannot build log sender")};var C=Q,k=(Z.isEnvSupport=function(){return!(!window||!window.localStorage)},Z.bin2hex=function(t){for(var i,n="",e=0,s=(t+="").length;e<s;e++)n+=(i=t.charCodeAt(e).toString(16)).length<2?"0"+i:i;return n},Z.getCanvasFingerprint=function(t){var i=document.createElement("canvas"),n=((n=i.getContext("2d")).textBaseline="top",n.font="14px 'Arial'",n.fillStyle="#f60",n.fillRect(125,1,62,20),n.fillStyle="#069",n.fillText(t,2,15),n.fillStyle="rgba(102, 204, 0, 0.7)",n.fillText(t,4,17),i.toDataURL().replace("data:image/png;base64,",""));return t=atob(n),this.bin2hex(t.slice(-16,-12))},Z.generateUUID=function(){var t,i,n;return(i=localStorage.getItem(this.storageKey))||(t=(new Date).getTime(),i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==i?n:3&n|8).toString(36)})),n=this.getCanvasFingerprint("hello, zego")+i.slice(8),localStorage.setItem(this.storageKey,n),i)},Z.id=function(){var t;return Z.isEnvSupport()?((t=localStorage.getItem(this.storageKey))||(t=Z.generateUUID(),localStorage.setItem(this.storageKey,t)),t):""},Z.storageKey="z_deviceID",Z);function z(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))}function D(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var c=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&c[o=0]?0:r;)try{if(n=1,e&&(s=2&c[0]?e.return:c[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,c[1])).done)return s;switch(e=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,e=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!((s=0<(s=r.trys).length&&s[s.length-1])||6!==c[0]&&2!==c[0])){r=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3]))r.label=c[1];else if(6===c[0]&&r.label<s[1])r.label=s[1],s=c;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(c)}}c=i.call(t,r)}catch(h){c=[6,h],e=0}finally{n=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}Object.defineProperty(F.prototype,"buffer",{get:function(){return this.queue},set:function(t){this.queue=t},enumerable:!1,configurable:!0}),F.prototype.push=function(t){if(!t)throw new Error("item null!");t&&this.queue.push(t)},F.prototype.pop=function(){return this.queue.shift()},F.prototype.front=function(){return this.queue[0]},P=function(t,i){return(P=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)};var A,P,M,U,x,L,j,q,G,H,B,V,$=function(){return($=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},J=(function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}P(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(K,A=n=F),K.prototype.size=function(){return this.queue.length},K.prototype.getOneLogPacket=function(){var t="";if(this.size()){var i=JSON.parse(this.queue[this.queue.length-1]).userid,n=this.configState.userid||i;if(n){for(;0<this.queue.length;){if(4e3<(t+this.queue[0]).length)return t;var e=JSON.parse(this.queue[0]);e=$($({},e),{userid:e.userid||n,roomid:e.roomid||this.configState.roomid,userName:e.userName||this.configState.userName}),t=t+JSON.stringify(e)+"\n",this.queue.shift()}return""===t?void 0:t}}},K.prototype.clear=function(){for(var t=[];0<this.queue.length;){var i=this.getOneLogPacket();if(!i)break;t.push(i)}return t},K),Y=function(){return(Y=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},X=(Object.defineProperty(W.prototype,"url",{get:function(){return this.configState.url||""},set:function(t){this.configState.url=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"logType",{get:function(){return this.configState.logType||r.DISABLE},set:function(t){this.configState.logType=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"env",{get:function(){return this.configState.env},set:function(t){this.configState.env=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"appid",{get:function(){return this.configState.appid},set:function(t){this.configState.appid=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"roomid",{get:function(){return this.configState.roomid},set:function(t){this.configState.roomid=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"sessionid",{get:function(){return this.configState.sessionid},set:function(t){this.configState.sessionid=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"userid",{get:function(){return this.configState.userid},set:function(t){this.configState.userid=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"userName",{get:function(){return this.configState.userName},set:function(t){this.configState.userName=t},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"version",{get:function(){return this.configState.userName},set:function(t){this.configState.version=t},enumerable:!1,configurable:!0}),W.prototype.setLogLevel=function(t){return void 0!==(t=h[t])&&(this.logLevel=t,!0)},W.prototype.setRemoteLogLevel=function(t){return void 0!==(t=h[t])&&(this.logRemoteLevel=t,!0)},W.prototype.setSessionInfo=function(t,i,n,e,s,r){this.appid=t,this.roomid=i,this.sessionid=n,this.userid=e,this.userName=s,this.version=r},W.prototype.setTokenInfo=function(t,i){this.configState.token=t,i&&(this.configState.userid=i)},W.prototype.setZipLogConfig=function(t,i){},W.prototype.setZipLogUploadUrl=function(t){},W.prototype.makeZipLogSpaceUpload=function(){return z(this,void 0,void 0,(function(){return D(this,(function(t){return[2]}))}))},W.prototype.uploadStorageLog=function(){return z(this,void 0,void 0,(function(){return D(this,(function(t){return[2]}))}))},W.prototype.report=function(t){t=this.logReportParamList(h.REPORT,t),this.logLevel!==h.DISABLE&&this.logLevel<=h.REPORT&&console.debug(t),this.RemoteLog(h.REPORT,t,!0)},W.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.logParamList(h.DEBUG,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.DEBUG&&console.debug(n),this.log(h.DEBUG,n)},W.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.logParamList(h.INFO,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.INFO&&console.info(n),this.log(h.INFO,n)},W.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.logParamList(h.WARN,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.WARN&&console.warn(n),this.log(h.WARN,n)},W.prototype.remoteReport=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=this.logParamList(h.INFO,t.join(""));this.log(h.INFO,n)},W.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=wx,s=this.logParamList(h.ERROR,t.join(""));this.logLevel!==h.DISABLE&&this.logLevel<=h.ERROR&&(console.error(s),this.env%2===e.BROWSER&&window?this.stateCenter.debug&&window.alert(t.join("").substr(t.join("").indexOf(" ")+1,4500)):this.env%2===e.WEIXINMINI&&n&&this.stateCenter.debug&&wx.showModal({title:"",content:t.join("").substr(t.join("").indexOf(" ")+1,4500)})),this.log(h.ERROR,s)},W.prototype.log=function(t,i){this.logRemoteLevel!==h.DISABLE&&this.logRemoteLevel<=t&&(this.RemoteLog(t,i),this.zipLogContext)&&this.zipLogContext.saveLog(i)},W.prototype.setLogServer=function(t){if(this.isDestroy)return!1;try{return t.startsWith("wss:")?(this.logType=r.WEBSOCKET,this.netContext.openWebSocketLogServer(t)):t.startsWith("https:")?(this.logType=r.HTTPS,this.openHttpsLogServer(t)):this.logType=r.DISABLE,!0}catch(t){return this.error(JSON.stringify(t)),!1}},W.prototype.stopLogServer=function(){this.logType==r.WEBSOCKET?this.stopWebSocketServer():this.logType==r.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=r.DISABLE},W.prototype.stopWebSocketServer=function(){this.netContext.stopWebSocketServer()},W.prototype.openHttpsLogServer=function(t){var i=this;(this.url=t)&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){i.SendHttpsLog()}),this.logUploadInterval)))},W.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},W.prototype.RemoteLog=function(t,i,n){return void 0===n&&(n=!1),z(this,void 0,void 0,(function(){return D(this,(function(e){if(!this.isDestroy)if(this.logType==r.WEBSOCKET)this.RemoteWebSocketLog(t,i);else if(this.logType==r.HTTPS)this.RemoteHttpsLog(t,i,n);else if(this.logLevel!==h.DISABLE&&this.logLevel<=t)for(this.logCache.push(i);this.logCache.size()>this.logCacheMax;)this.logCache.pop();return[2]}))}))},W.prototype.clearLogCache=function(){var t=this;this.netContext.connected()&&this.logCache.clear().forEach((function(i){t.netContext.wsSend(i)}))},W.prototype.clearCache=function(){0!==this.logCache.size()&&this.clearLogCache()},W.prototype.saveLog=function(t){this.logCache.size()<this.logCacheMax&&this.logCache.push(t)},W.prototype.websocketSendLog=function(t){this.netContext.connected()?this.netContext.wsSend(t):this.saveLog(t)},W.prototype.RemoteWebSocketLog=function(t,i){return z(this,void 0,void 0,(function(){var t;return D(this,(function(n){return"string"==typeof i&&4e3<i.length?console.info("log over maximum, ignore"):this.configState.useStrategy&&this.env==e.BROWSER?this.netContext.addRemoteWsLog(i):this.netContext.closed()?(t=this.url,this.url="",this.setLogServer(t),this.saveLog(i)):this.netContext.connecting()?this.saveLog(i):this.netContext.connected()&&(this.clearCache(),this.websocketSendLog(i)),[2]}))}))},W.prototype.RemoteHttpsLog=function(t,i,n){this.logCache.push(i),(this.logCache.size()>=this.logCacheMax||!0===n)&&this.SendHttpsLog()},W.prototype.logParamList=function(t,i){var n={time:n=p(),level:t,action:(i=[i.substr(0,i.indexOf(" "))||i,i.substr(i.indexOf(" ")+1,4500)||i])[0],content:i[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(n)},W.prototype.logReportParamList=function(t,i){var n=p(),s=this.env%2===e.BROWSER?"rtc":"xcx";return i=Y(Y({},i),{time:n,level:t,console:s,appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+i.event_time+"_"+i.seq}),JSON.stringify(i)},W.prototype.SendHttpsLog=function(){0!=this.logCache.size()&&(this.env%2===e.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},W.prototype.SendHttpsLogWeb=function(){},W.prototype.SendHttpsLogWeChatMini=function(){var t=this;if(!this.existUserID){if(!this.userid)return void console.log("no userid");this.logCache.buffer.forEach((function(i,n){(i=JSON.parse(i))&&""==i.userid?(i.userid=t.userid,i.id_name=i.id_name||t.userid,i.roomid=i.roomid||t.roomid,i.userName=i.userName||t.userName,t.logCache.buffer[n]=JSON.stringify(i)):t.existUserID=!0}))}var i=this.logCache.buffer.join("\n"),n=this.logCache.buffer;i=1==this.env?i:JSON.stringify({user_id:this.userid,log:i}),(0,wx.request)({url:this.url,data:i,method:"POST",success:function(i){0!=i.data.length&&("number"==typeof(i=i&&i.data&&i.data.interval)&&t.logUploadInterval!==i&&(t.timeInterval=i,t.openHttpsLogServer(t.url)),n=null)},fail:function(i){t.logCache.buffer=n.concat(t.logCache.buffer),console.log("send failed "+i.statusCode),n=null}}),this.logCache.buffer=[]},W.prototype.destroy=function(){this.stopLogServer(),this.logUploadTimer&&clearTimeout(this.logUploadTimer),o.instance=void 0,this.netContext.destroy(),this.zipLogContext&&this.zipLogContext.destroy(),this.url=""},W.logVersion="1.4.2",W);function W(t){var i=this;this.logLevel=h.INFO,this.logRemoteLevel=0,this.logUploadTimer=null,this.logUploadInterval=1e4,this.existUserID=!1,this.isDestroy=!1,this.logCacheMax=8192,this.innerLogger={debug:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.debug.apply(i,t)},info:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.info.apply(i,t)},warn:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.warn.apply(i,t)},error:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];i.error.apply(i,t)}},this.stateCenter=o.getInstance(),this.configState=new N,this.configState.env=t,this.logCache=new J(this.configState),this.netContext=new E(this.logCache,this.configState,this.innerLogger)}function K(t){var i=A.call(this)||this;return i.configState=t,i}function F(){this.queue=[]}function Z(){}function Q(){this._strategy=s.DEFAULT}function tt(t){return(t=G.call(this,t)||this).maxDelay=10,t.maxPacketLen=20480,t}function it(){var t=null!==B&&B.apply(this,arguments)||this;return t.maxDelay=10,t.maxPacketLen=20480,t.locked=!1,t}function nt(t,i,n){this.ws=t,this.cache=i,this.strategy=n,this.strategy.onCanSendActive=this.active.bind(this)}function et(t,i,n){this.cache=t,this.configState=i,this.innerLogger=n,this.websocket=null,this.websocketState="never_opened",this.senderBuilder=new C,this.sender=null}}],r={},e.m=s,e.c=r,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=0))},function(i,n){i.exports=t},function(t,i,n){(function(i){var e;t.exports=(e=function(t){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),!(e=!(e=!(e="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:e)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:e)&&void 0!==i&&i.crypto?i.crypto:e))try{e=n(9)}catch(o){}var s=Object.create||function(t){return r.prototype=t,t=new r,r.prototype=null,t};function r(){}var o={},u=o.lib={},h=u.Base={extend:function(t){var i=s(this);return t&&i.mixIn(t),i.hasOwnProperty("init")&&this.init!==i.init||(i.init=function(){i.$super.init.apply(this,arguments)}),(i.init.prototype=i).$super=this,i},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=u.WordArray=h.extend({init:function(t,i){t=this.words=t||[],this.sigBytes=null!=i?i:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var i=this.words,n=t.words,e=this.sigBytes,s=t.sigBytes;if(this.clamp(),e%4)for(var r=0;r<s;r++)i[e+r>>>2]|=(n[r>>>2]>>>24-r%4*8&255)<<24-(e+r)%4*8;else for(var o=0;o<s;o+=4)i[e+o>>>2]=n[o>>>2];return this.sigBytes+=s,this},clamp:function(){var i=this.words,n=this.sigBytes;i[n>>>2]&=4294967295<<32-n%4*8,i.length=t.ceil(n/4)},clone:function(){var t=h.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var i=[],n=0;n<t;n+=4)i.push(function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new c.init(i,t)}}),a=o.enc={},l=a.Hex={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++){var r=i[s>>>2]>>>24-s%4*8&255;e.push((r>>>4).toString(16)),e.push((15&r).toString(16))}return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e+=2)n[e>>>3]|=parseInt(t.substr(e,2),16)<<24-e%8*4;return new c.init(n,i/2)}},f=a.Latin1={stringify:function(t){for(var i=t.words,n=t.sigBytes,e=[],s=0;s<n;s++)e.push(String.fromCharCode(i[s>>>2]>>>24-s%4*8&255));return e.join("")},parse:function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t.charCodeAt(e))<<24-e%4*8;return new c.init(n,i)}},_=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(f.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return f.parse(unescape(encodeURIComponent(t)))}},d=u.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=_.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(i){var n,e=this._data,s=e.words,r=e.sigBytes,o=this.blockSize,u=r/(4*o),h=(u=i?t.ceil(u):t.max((0|u)-this._minBufferSize,0))*o;if(i=t.min(4*h,r),h){for(var a=0;a<h;a+=o)this._doProcessBlock(s,a);n=s.splice(0,h),e.sigBytes-=i}return new c.init(n,i)},clone:function(){var t=h.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),m=(u.Hasher=d.extend({cfg:h.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(i,n){return new t.init(n).finalize(i)}},_createHmacHelper:function(t){return function(i,n){return new m.HMAC.init(t,n).finalize(i)}}}),o.algo={});return o}(Math),e)}).call(this,n(8))},function(t,i,n){function e(t){var i;return(u[t]||(i=u[t]={i:t,l:!1,exports:{}},o[t].call(i.exports,i,i.exports,e),i.l=!0,i)).exports}var s,r,o,u;t.exports=(s=n(1),r=n(3),o=[function(t,i){t.exports=s},function(t,i){t.exports=r},function(t,i,n){"use strict";var e,s,r,o,u,h,c,a;n.r(i),n.d(i,"ZegoConnectionAgent",(function(){return Nt})),n.d(i,"NetAgentPCRequest",(function(){return gt})),n.d(i,"NetAgentHttpRequest",(function(){return Ot})),n.d(i,"BusinessService",(function(){return r})),n.d(i,"BrokenType",(function(){return m})),n.d(i,"NET_ACCESS_CONFIG",(function(){return lt})),n.d(i,"ConnectedType",(function(){return d})),n.d(i,"DisconnectedType",(function(){return _})),n.d(i,"Mode",(function(){return u})),n.d(i,"Method",(function(){return f})),(i=e=e||{})[i.offline=0]="offline",i[i.online=1]="online",(i=s=s||{})[i.MSG_TYPE_STREAM_CLOSED=2]="MSG_TYPE_STREAM_CLOSED",i[i.MSG_TYPE_CLOSE_CONNECTION=3]="MSG_TYPE_CLOSE_CONNECTION",i[i.MSG_TYPE_HTTP_REQUEST=4]="MSG_TYPE_HTTP_REQUEST",i[i.MSG_TYPE_HTTP_RESPONSE=5]="MSG_TYPE_HTTP_RESPONSE",i[i.MSG_TYPE_HB_REQUEST=12]="MSG_TYPE_HB_REQUEST",i[i.MSG_TYPE_HB_RESPONSE=13]="MSG_TYPE_HB_RESPONSE",i[i.MSG_TYPE_GET_CONFIG_REQUEST=14]="MSG_TYPE_GET_CONFIG_REQUEST",i[i.MSG_TYPE_GET_CONFIG_RESPONSE=15]="MSG_TYPE_GET_CONFIG_RESPONSE",i[i.MSG_TYPE_HTTP_REQUEST_ACK=16]="MSG_TYPE_HTTP_REQUEST_ACK",i[i.MSG_TYPE_PC_UPWARD_MESSAGE=17]="MSG_TYPE_PC_UPWARD_MESSAGE",i[i.MSG_TYPE_PC_UPWARD_MESSAGE_ACK=18]="MSG_TYPE_PC_UPWARD_MESSAGE_ACK",i[i.MSG_TYPE_PC_ESTABLISHED=19]="MSG_TYPE_PC_ESTABLISHED",i[i.MSG_TYPE_PC_BROKEN=20]="MSG_TYPE_PC_BROKEN",i[i.MSG_TYPE_PC_DOWNWARD_MESSAGE=21]="MSG_TYPE_PC_DOWNWARD_MESSAGE",i[i.MSG_TYPE_REDIRECT=22]="MSG_TYPE_REDIRECT",i[i.MSG_TYPE_GET_APPCONFIG_REQUEST=23]="MSG_TYPE_GET_APPCONFIG_REQUEST",i[i.MSG_TYPE_GET_APPCONFIG_RESPONSE=24]="MSG_TYPE_GET_APPCONFIG_RESPONSE",i[i.MSG_TYPE_PUSH_APPCONFIG=25]="MSG_TYPE_PUSH_APPCONFIG",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST=26]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE=27]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE",i[i.MSG_TYPE_PUSH_EXCEPTION=30]="MSG_TYPE_PUSH_EXCEPTION",i[i.MSG_TYPE_HTTP_REQUEST2=33]="MSG_TYPE_HTTP_REQUEST2",i[i.MSG_TYPE_REDIRECT2=34]="MSG_TYPE_REDIRECT2",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2=35]="MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2",i[i.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2=36]="MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2",i[i.MSG_TYPE_GET_SVRADDR_REQUEST=39]="MSG_TYPE_GET_SVRADDR_REQUEST",i[i.MSG_TYPE_GET_SVRADDR_RESPONSE=40]="MSG_TYPE_GET_SVRADDR_RESPONSE",(i=g=g||{})[i.ACCESSHUB_INVALID_FRAME=2e4]="ACCESSHUB_INVALID_FRAME",i[i.ACCESSHUB_NEED_ENCRYPT=20001]="ACCESSHUB_NEED_ENCRYPT",i[i.ACCESSHUB_DECRYPT=20002]="ACCESSHUB_DECRYPT",i[i.ACCESSHUB_MSGTYPE=20003]="ACCESSHUB_MSGTYPE",i[i.ACCESSHUB_UNMARSHAL=20004]="ACCESSHUB_UNMARSHAL",i[i.ACCESSHUB_TIMEOUT=20005]="ACCESSHUB_TIMEOUT",i[i.ACCESSHUB_CONNECT=20006]="ACCESSHUB_CONNECT",i[i.ACCESSHUB_BROKEN=20007]="ACCESSHUB_BROKEN",i[i.ACCESSHUB_INTERNAL_ERROR=20008]="ACCESSHUB_INTERNAL_ERROR",i[i.ACCESSHUB_MARSHAL=20009]="ACCESSHUB_MARSHAL",i[i.ACCESSHUB_UNSUPPORTED_SERVICE=20010]="ACCESSHUB_UNSUPPORTED_SERVICE",i[i.ACCESSHUB_TOO_FREQUENTLY=20011]="ACCESSHUB_TOO_FREQUENTLY",i[i.ACCESSHUB_INVALID_APPID=20012]="ACCESSHUB_INVALID_APPID",i[i.ACCESSHUB_HB_TIMEOUT=20013]="ACCESSHUB_HB_TIMEOUT",i[i.ACCESSHUB_INVALID_SIGNATURE=20014]="ACCESSHUB_INVALID_SIGNATURE",(i=r=r||{})[i.SERVICE_UNSET=0]="SERVICE_UNSET",i[i.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",i[i.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",i[i.SERVICE_MIX=3]="SERVICE_MIX",i[i.SERVICE_ZEUS=4]="SERVICE_ZEUS",i[i.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",i[i.SERVICE_L3=6]="SERVICE_L3",i[i.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",i[i.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",i[i.SERVICE_ZIM=9]="SERVICE_ZIM",i[i.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",i[i.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",i[i.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",i[i.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",i[i.SERVICE_QUALITY=14]="SERVICE_QUALITY",i[i.SERVICE_SECURITY=15]="SERVICE_SECURITY",i[i.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",i[i.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",i[i.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",i[i.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",i[i.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",i[i.SERVICE_CDN=21]="SERVICE_CDN",i[i.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",i[i.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",i[i.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",i[i.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",i[i.SERVICE_ECHO=26]="SERVICE_ECHO",i[i.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",i[i.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(i=o=o||{})[i.ZEGOCONN_RUN_ENV_UNSET=0]="ZEGOCONN_RUN_ENV_UNSET",i[i.ZEGOCONN_RUN_ENV_BROWSER=1]="ZEGOCONN_RUN_ENV_BROWSER",i[i.ZEGOCONN_RUN_ENV_APPLET=2]="ZEGOCONN_RUN_ENV_APPLET",(i=u=u||{})[i.Mode_UNSET=0]="Mode_UNSET",i[i.MODE_ONLINE=1]="MODE_ONLINE",i[i.MODE_TEST=2]="MODE_TEST",i[i.MODE_ALPHA=3]="MODE_ALPHA",(i=h=h||{})[i.HTTP=0]="HTTP",i[i.PC=1]="PC",i[i.OTHER=2]="OTHER",(i=c=c||{})[i.NONE=0]="NONE",i[i.BROKEN=1]="BROKEN",i[i.DISCONNECT=2]="DISCONNECT",(i=a=a||{})[i.CONNECTED=0]="CONNECTED",i[i.DISCONNECT=1]="DISCONNECT",i[i.BROKEN=2]="BROKEN";var l,f,_,d,m,v=[g.ACCESSHUB_INVALID_APPID,g.ACCESSHUB_INVALID_SIGNATURE],p=((i=l=l||{})[i.ACTION_RESERVED=0]="ACTION_RESERVED",i[i.ACTION_DISPATCH=1]="ACTION_DISPATCH",i[i.ACTION_RETRY=2]="ACTION_RETRY",i[i.ACTION_NEXT_NODE=3]="ACTION_NEXT_NODE",i[i.ACTION_ABORT=4]="ACTION_ABORT",i[i.ACTION_NEXT_GROUP=5]="ACTION_NEXT_GROUP",(g=f=f||{})[g.METHOD_UNSET=0]="METHOD_UNSET",g[g.METHOD_GET=1]="METHOD_GET",g[g.METHOD_POST=2]="METHOD_POST",g[g.METHOD_PUT=3]="METHOD_PUT",g[g.METHOD_PATCH=4]="METHOD_PATCH",g[g.METHOD_DELETE=5]="METHOD_DELETE",g[g.METHOD_HEAD=6]="METHOD_HEAD",g[g.METHOD_OPTIONS=7]="METHOD_OPTIONS",(i=_=_||{})[i.CLOSE=0]="CLOSE",i[i.TEMP=1]="TEMP",i[i.TIMEOUT=2]="TIMEOUT",(g=d=d||{})[g.AUTO=0]="AUTO",g[g.MANUAL=1]="MANUAL",(i=m=m||{})[i.EMPTY=0]="EMPTY",i[i.CLOSE=1]="CLOSE",{2:"stream_closed",3:"close_connection",4:"http_request",5:"http_response",12:"hb_request",13:"hb_response",14:"get_config_request",15:"get_config_response",16:"http_request_ack",17:"pc_upward_message",18:"pc_upward_message_ack",19:"pc_established",20:"pc_broken",21:"pc_downward_message",22:"redirect",23:"get_appconfig_request",24:"get_appconfig_response",25:"push_appconfig",26:"accesshub_dispatch_request",27:"accesshub_dispatch_response",30:"push_exception",33:"http_request2",34:"redirect2",35:"accesshub_dispatch_request2",36:"accesshub_dispatch_response2",39:"get_svraddr_request",40:"get_svraddr_response"}),g=n(0),b=n.n(g),E=(i=n(1),n(1));g=n(0),E.util.Long=g,E.util.Long.fromBits=E.util.Long?E.util.Long.fromBits:function(){return 0};for(var S=E.roots,R=E.types?E.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},y=E.types?E.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},O=Object.keys(R),T={$:function(t){return T[t]?T[t].call(this):S[t].decode?S[t].decode(this,this.uint32()):T.$.call(this,"int32")}},w={$:function(t,i,n){var e=R[t];return void 0===e?S[t].encode?(this.uint32((n<<3|2)>>0).fork(),S[t].encode(i,this).ldelim()):w.$.call(this,"int32",i,n):w[t].call(this.uint32(n<<3|e),i)}},I=0;I<O.length;I++)T[O[I]]=E.Reader.prototype[O[I]],w[O[I]]=E.Writer.prototype[O[I]];!function t(i,n,e,s){for(var r=0,o=Object.keys(i);r<o.length;r++){var u=o[r];if(i[u].$m&&Object.keys(i[u].$m).every((function(t){return Number(t)}))){if(e[u])throw Error(`nested type ${e}.${u} has already exist`);e[u]=function(i,e){function s(t){for(var n in i)"{"===(n=i[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(t)for(var e=Object.keys(t),s=0;s<e.length;++s)null!=t[e[s]]&&(this[e[s]]=t[e[s]])}var r,o={};for(r in i){var u=i[r],h=u[1];"{"===h.charAt(0)?(s.prototype[u[0]]=E.util.emptyObject,o[h]={$m:h.substring(1).split(",").map((function(t,i){return["$"+(i+1),t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):s.prototype[u[0]]="["===h.charAt(0)||"<"===h.charAt(0)?E.util.emptyArray:"bytes"===h?E.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?E.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof E.Reader||(t=E.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32(),u=o>>>3;if(0<u&&i[u]){var h=i[u][0],c=i[u][1];if("{"===c.charAt(0))r[h]===E.util.emptyObject&&(r[h]={}),u=s.$namespace[c].decode(t,t.uint32()),r[h][u.$1]=u.$2;else if("["===c.charAt(0)||"<"===c.charAt(0))if(c=c.substring(1),r[h]&&r[h].length||(r[h]=[]),void 0!==y[c=T[c]||S[c].decode?c:"int32"]&&2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)r[h].push(T.$.call(t,c));else r[h].push(T.$.call(t,c));else r[h]=T.$.call(t,c)}else t.skipType(7&o)}return r},s.encode=function(t,n){for(var e in n=n||E.Writer.create(),i){var r=i[e][0];if("{"===(c=i[e][1]).charAt(0)){if(null!=t[r]&&t.hasOwnProperty(r))for(var o=0,u=Object.keys(t[r]);o<u.length;++o)n.uint32((e<<3|2)>>0).fork(),s.$namespace[c].encode({$1:u[o],$2:t[r][u[o]]},n).ldelim()}else if("["===c.charAt(0)||"<"===c.charAt(0)){var h="<"===c.charAt(0),c=c.substring(1),a=t[r];if(null!=a&&a.length)if(c=void 0!==R[c]||S[c].encode?c:"int32",h&&void 0!==y[c]){for(n.uint32((e<<3|2)>>0).fork(),o=0;o<a.length;o++)w[c].call(n,a[o]);n.ldelim()}else for(o=0;o<a.length;o++)w.$.call(n,c,a[o],e)}else null!=t[r]&&t.hasOwnProperty(r)&&w.$.call(n,c,t[r],e)}return n},Object.keys(o).length&&(s.$namespace=t(o,n+"."+e,s.$namespace||{},!0)),s}(i[u].$m,u)}else i[u].$s?e[u]=function(t,i){function e(t,i,n){E.rpc.Service.call(this,t,i,n)}return((e.prototype=Object.create(E.rpc.Service.prototype)).constructor=e).create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){var r=t[s];function o(t,i){return this.rpcCall(o,S[r[0]],S[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:n+"."+i}),e.prototype[s]=o})),e}(i[u].$s,u):i[u].$e&&Object.values(i[u].$e).every((function(t){return Number(t)===t}))&&(e[u]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[u].$e));e[u]&&!s&&(S[n+"."+u]=e[u]),delete i[u].$m,delete i[u].$s,delete i[u].$e,e[u]=t(i[u],n?n+"."+u:u,e[u]||{})}return e}({protocol:{proto_accesshub:{AccesshubAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","protocol.proto_accesshub.IPV6Addr",null],3:["quic_port","uint32",0],4:["wss_port","uint32",0]}},AccesshubDispatchGroup:{$m:{1:["group","string",""],2:["quic_nodes","<string",null],3:["mtcp_nodes","<string",null],4:["wss_nodes","<string",null]}},AccesshubDispatchGroup2:{$m:{1:["group","string",""],2:["nodes","<protocol.proto_accesshub.AccesshubAddr",null],3:["nodes_dual","<protocol.proto_accesshub.AccesshubAddr",null]}},AccesshubDispatchRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","protocol.proto_accesshub.SdkType",0],7:["zegoconn_version","uint32",0],8:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],9:["device_id","string",""],10:["client_ip","string",""],11:["geofencing_type","uint32",0],12:["geofencings","[uint32",null],13:["addr_type","uint32",0]}},AccesshubDispatchResponse2:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","protocol.proto_accesshub.AccesshubDispatchResponseData2",null]}},AccesshubDispatchResponseData2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["rand","string",""],3:["secret","string",""],4:["groups","<protocol.proto_accesshub.AccesshubDispatchGroup2",null],5:["wss_groups","<protocol.proto_accesshub.WssAccesshubDispatchGroup",null],6:["ttl","uint32",0]}},BackendConnType:{$e:{BACKEND_CONN_TYPE_UNSET:0,BACKEND_CONN_TYPE_TCP:1,BACKEND_CONN_TYPE_WSS:2}},CloseConnection:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["action","int32",0]},Action:{$e:{ACTION_RESERVED:0,ACTION_DISPATCH:1,ACTION_RETRY:2,ACTION_NEXT_NODE:3,ACTION_ABORT:4,ACTION_NEXT_GROUP:5}}},ConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},ErrorCode:{$e:{OK:0,DISPATCH_NO_AVAILABLE_NODE:1e4,DISPATCH_INTERNAL_ERROR:10001,DISPATCH_INVALID_FRAME:10002,DISPATCH_UNMARSHAL:10003,DISPATCH_MSGTYPE:10004,DISPATCH_MARSHAL:10005,DISPATCH_TOO_FREQUENTLY:10006,DISPATCH_EMPTY_GEOFENCING:10007,ACCESSHUB_INVALID_FRAME:2e4,ACCESSHUB_NEED_ENCRYPT:20001,ACCESSHUB_DECRYPT:20002,ACCESSHUB_MSGTYPE:20003,ACCESSHUB_UNMARSHAL:20004,ACCESSHUB_TIMEOUT:20005,ACCESSHUB_CONNECT:20006,ACCESSHUB_BROKEN:20007,ACCESSHUB_INTERNAL_ERROR:20008,ACCESSHUB_MARSHAL:20009,ACCESSHUB_UNSUPPORTED_SERVICE:20010,ACCESSHUB_TOO_FREQUENTLY:20011,ACCESSHUB_INVALID_APPID:20012,ACCESSHUB_HB_TIMEOUT:20013,ACCESSHUB_INVALID_SIGNATURE:20014,ACCESSHUB_AUTH_FAILED:20015,ACCESSHUB_UNSUPPORTED_INTERFACE:20016,ACCESSHUB_EMPTY_GEOFENCING:20017,ACCESSHUB_ACCESS_DENIED:20018,ACCESSHUB_SPECIAL_CUSTOMER:20019,ACCESSHUB_GET_STREAM_FAILED:3e4,ACCESSHUB_GET_CONN_FAILED:30001,ACCESSHUB_DO_HTTP_REQUEST_FAILED:30002,ACCESSHUB_UNMARSHAL_HB_FAILED:30003,ACCESSHUB_DO_BACKEND_DISPATCH_FAILED:30004}},GeoFencing:{$e:{CN:2,NA:3,EU:4,AS:5,IN:6,NCN:7}},GeoFencingType:{$e:{NONE:0,UNION:1,EXCLUDE:2}},GetAppConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["config_key","string",""],7:["ts","uint64",{low:0,high:0,unsigned:!0}],8:["signature","bytes",[]],9:["lite_sign","string",""],10:["token","string",""],11:["sdk_type","protocol.proto_accesshub.SdkType",0],12:["zegoconn_version","uint32",0],13:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],14:["device_id","string",""],15:["etag","uint32",0],16:["is_special_customer","uint32",0]}},GetAppConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","protocol.proto_accesshub.GetAppConfigResponseData",null]}},GetAppConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["data","bytes",[]],3:["ts","uint64",{low:0,high:0,unsigned:!0}],4:["etag","uint32",0]}},GetConfigRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["zegoconn_version","uint32",0],8:["sdk_type","protocol.proto_accesshub.SdkType",0],9:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],10:["device_id","string",""],11:["mode_no","protocol.proto_accesshub.Mode",0],12:["geofencing_type","uint32",0],13:["geofencings","[uint32",null]}},GetConfigResponse:{$m:{1:["code","int32",0],2:["message","string",""],3:["data","protocol.proto_accesshub.GetConfigResponseData",null]}},GetConfigResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["quic_hb_interval","uint32",0],3:["quic_hb_timeout","uint32",0],4:["logic_hb_interval","uint32",0],5:["logic_hb_timeout","uint32",0],6:["pc_establish_timeout","uint32",0],7:["sdk_link_detect_interval","uint32",0],8:["sdk_link_detect_duration","uint32",0],9:["client_outer_ip","string",""],10:["ntp_time","uint64",{low:0,high:0,unsigned:!0}],11:["root_rsa_certs_ver","uint32",0],12:["geofencing_id","uint32",0],13:["svraddr_ver","uint32",0],14:["root_ecc_certs_ver","uint32",0]}},GetSvraddrRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","protocol.proto_accesshub.SdkType",0],7:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["device_id","string",""],10:["geofencing_type","uint32",0],11:["geofencings","[uint32",null]}},GetSvraddrResponse:{$m:{1:["code","int32",0],2:["msg","string",""],3:["data","protocol.proto_accesshub.GetSvraddrResponseData",null]}},GetSvraddrResponseData:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["geofencing_id","uint32",0],3:["svraddr_ver","uint32",0],4:["anycast_ips","<protocol.proto_accesshub.IPAddr",null],5:["zegons_domain","string",""],6:["zegons_ips","<protocol.proto_accesshub.IPAddr",null],7:["accesshub_domain","string",""],8:["accesshub_ips","<protocol.proto_accesshub.IPAddr",null],9:["logreport_domain","string",""],10:["logreport_ips","<protocol.proto_accesshub.IPAddr",null],11:["detaillog_domain","string",""],12:["detaillog_ips","<protocol.proto_accesshub.IPAddr",null],13:["stunsvr_domain","string",""],14:["stunsvr_ips","<protocol.proto_accesshub.IPAddr",null],15:["zimfile_domain","string",""],16:["zimfile_ips","<protocol.proto_accesshub.IPAddr",null],17:["accesshub_sni","string",""],18:["accesshub_web_domain","string",""],19:["logreport_web_domain","string",""]}},HBRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}]}},HBResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["ts","int64",{low:0,high:0,unsigned:!1}],3:["ntp_time","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequest:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","string",""],5:["id_name","string",""],6:["reqid","string",""],7:["stick","string",""],8:["service","string",""],9:["location","string",""],10:["method","string",""],11:["headers","<protocol.proto_accesshub.HTTPRequest.HTTPHeader",null],12:["body","bytes",[]],13:["ack","bool",!1],14:["mode_no","protocol.proto_accesshub.Mode",0],15:["service_no","protocol.proto_accesshub.Service",0],16:["method_no","protocol.proto_accesshub.Method",0],17:["sdk_type","protocol.proto_accesshub.SdkType",0],18:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],19:["zegoconn_version","uint32",0],20:["device_id","string",""],21:["reduce_resp_header","uint32",0]},HTTPHeader:{$m:{1:["name","string",""],2:["val","string",""]}}},HTTPRequest2:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["sdk_type","protocol.proto_accesshub.SdkType",0],7:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],8:["zegoconn_version","uint32",0],9:["headers","<protocol.proto_accesshub.HTTPRequest.HTTPHeader",null],10:["method","protocol.proto_accesshub.Method",0],11:["interface_id","uint32",0],12:["res_id","string",""],13:["params","string",""],14:["body","bytes",[]],15:["ack","bool",!1],16:["device_id","string",""],17:["ts","uint64",{low:0,high:0,unsigned:!0}],18:["signature","bytes",[]],19:["token","string",""],20:["lite_sign","string",""],21:["reduce_resp_header","uint32",0]}},HTTPRequestAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},HTTPRequestDroped:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["reason","int32",0],3:["msg","string",""]}},HTTPResponse:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["headers","<protocol.proto_accesshub.HTTPRequest.HTTPHeader",null],3:["status_code","int32",0],4:["body","bytes",[]]}},IPAddr:{$m:{1:["ipv4","fixed32",0],2:["ipv6","protocol.proto_accesshub.IPV6Addr",null]}},IPV6Addr:{$m:{1:["high","fixed64",{low:0,high:0,unsigned:!1}],2:["low","fixed64",{low:0,high:0,unsigned:!1}]}},MessageType:{$e:{MSG_TYPE_EMPTY:0,MSG_TYPE_CONNECTION_CLOSED:1,MSG_TYPE_STREAM_CLOSED:2,MSG_TYPE_CLOSE_CONNECTION:3,MSG_TYPE_HTTP_REQUEST:4,MSG_TYPE_HTTP_RESPONSE:5,MSG_TYPE_HTTP_REQUEST_DROPED:6,MSG_TYPE_PROXY_CONNECT:7,MSG_TYPE_PROXY_CONNECTED:8,MSG_TYPE_PROXY_CONNECTION_CLOSED:9,MSG_TYPE_PROXY_SEND_DATA:10,MSG_TYPE_PROXY_RECV_DATA:11,MSG_TYPE_HB_REQUEST:12,MSG_TYPE_HB_RESPONSE:13,MSG_TYPE_GET_CONFIG_REQUEST:14,MSG_TYPE_GET_CONFIG_RESPONSE:15,MSG_TYPE_HTTP_REQUEST_ACK:16,MSG_TYPE_PC_UPWARD_MESSAGE:17,MSG_TYPE_PC_UPWARD_MESSAGE_ACK:18,MSG_TYPE_PC_ESTABLISHED:19,MSG_TYPE_PC_BROKEN:20,MSG_TYPE_PC_DOWNWARD_MESSAGE:21,MSG_TYPE_REDIRECT:22,MSG_TYPE_GET_APPCONFIG_REQUEST:23,MSG_TYPE_GET_APPCONFIG_RESPONSE:24,MSG_TYPE_PUSH_APPCONFIG:25,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST:26,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE:27,MSG_TYPE_GET_IM_CONFIG_REQUEST:28,MSG_TYPE_GET_IM_CONFIG_RESPONSE:29,MSG_TYPE_PUSH_EXCEPTION:30,MSG_TYPE_RESOLVE_DOMAIN_REQUEST:31,MSG_TYPE_RESOLVE_DOMAIN_RESPONSE:32,MSG_TYPE_HTTP_REQUEST2:33,MSG_TYPE_REDIRECT2:34,MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2:35,MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2:36,MSG_TYPE_GET_ROOTCERTS_REQUEST:37,MSG_TYPE_GET_ROOTCERTS_RESPONSE:38,MSG_TYPE_GET_SVRADDR_REQUEST:39,MSG_TYPE_GET_SVRADDR_RESPONSE:40,MSG_TYPE_UA_DISPATCH_REQUEST:50,MSG_TYPE_UA_DISPATCH_RESPONSE:51,MSG_TYPE_UA_ECHO_REQUEST:52,MSG_TYPE_UA_ECHO_RESPONSE:53,MSG_TYPE_NODE_REGISTER_REQUEST:100,MSG_TYPE_NODE_REGISTER_RESPONSE:101,MSG_TYPE_NODE_HB_REQUEST:102,MSG_TYPE_NODE_HB_RESPONSE:103}},Method:{$e:{METHOD_UNSET:0,METHOD_GET:1,METHOD_POST:2,METHOD_PUT:3,METHOD_PATCH:4,METHOD_DELETE:5,METHOD_HEAD:6,METHOD_OPTIONS:7}},Mode:{$e:{Mode_UNSET:0,MODE_ONLINE:1,MODE_TEST:2,MODE_ALPHA:3}},PCBroken:{$m:{}},PCDownwardMessage:{$m:{1:["payload","bytes",[]],2:["wss_message_type","uint32",0],3:["ts","uint64",{low:0,high:0,unsigned:!0}]}},PCEstablished:{$m:{1:["elapse","uint32",0],2:["from","uint32",0]}},PCUpwardMessage:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}],2:["appid","uint32",0],3:["biz_type","uint32",0],4:["mode_no","protocol.proto_accesshub.Mode",0],5:["id_name","string",""],6:["service_no","protocol.proto_accesshub.Service",0],7:["ack","bool",!1],8:["payload","bytes",[]],9:["sdk_type","protocol.proto_accesshub.SdkType",0],10:["wss_message_type","uint32",0],11:["wss_path","string",""],12:["wss_raw_query","string",""],13:["zegoconn_version","uint32",0],14:["zegoconn_run_env","protocol.proto_accesshub.ZegoconnRunEnv",0],15:["backend_conn_type","protocol.proto_accesshub.BackendConnType",0],16:["device_id","string",""],17:["geofencing_type","uint32",0],18:["geofencings","[uint32",null],19:["addr_type","uint32",0]}},PCUpwardMessageAck:{$m:{1:["txid","uint64",{low:0,high:0,unsigned:!0}]}},ProxyConnectionClosed:{$m:{1:["code","int32",0],2:["msg","string",""],3:["connected","int32",0]}},PushAppConfig:{$m:{1:["config_key","string",""],2:["data","bytes",[]]}},PushException:{$m:{1:["reason","int32",0],2:["msg","string",""],3:["txid","uint64",{low:0,high:0,unsigned:!0}]}},Redirect2:{$m:{1:["rand","string",""],2:["secret","string",""],3:["groups","<protocol.proto_accesshub.AccesshubDispatchGroup2",null],4:["wss_groups","<protocol.proto_accesshub.WssAccesshubDispatchGroup",null],5:["ttl","uint32",0]}},SdkType:{$e:{SDK_TYPE_UNSET:0,SDK_TYPE_NATIVE:1,SDK_TYPE_WSS_WEB:3}},Service:{$e:{SERVICE_UNSET:0,SERVICE_MEDIAGW:1,SERVICE_LIVEROOM:2,SERVICE_MIX:3,SERVICE_ZEUS:4,SERVICE_ZPUSH:5,SERVICE_L3:6,SERVICE_TALKLINE:7,SERVICE_EDUSUITE:8,SERVICE_ZIM:9,SERVICE_ClOUD_SETTING:10,SERVICE_ZEUSHB:11,SERVICE_USER_LOGIC:12,SERVICE_UNIFYDISPATCH:13,SERVICE_QUALITY:14,SERVICE_SECURITY:15,SERVICE_KTVCPR:16,SERVICE_SWITCH4LIVEROOM:17,SERVICE_WEBRTC_SIGNAL:18,SERVICE_L3_WEBRTC_SIGNAL:19,SERVICE_VIDEOCPR:20,SERVICE_CDN:21,SERVICE_CLOUDRECORD:22,SERVICE_INNER_ECHO:23,SERVICE_OUTER_ECHO:24,SERVICE_LOCALHOST_ECHO:25,SERVICE_ECHO:26,SERVICE_DOCSERVICE:27,SERVICE_AUTHSVR:28,SERVICE_WEBLIVEROOM:29,SERVICE_WHITEBOARD:30,SERVICE_METAWORLD:31,SERVICE_ZEGOLAND:32}},StreamClosed:{$m:{1:["code","int32",0],2:["msg","string",""]}},WssAccesshubDispatchGroup:{$m:{1:["group","string",""],2:["host","string",""],3:["main_domain","string",""]}},ZegoconnRunEnv:{$e:{ZEGOCONN_RUN_ENV_UNSET:0,ZEGOCONN_RUN_ENV_BROWSER:1,ZEGOCONN_RUN_ENV_APPLET:2}}},proto_initconfig:{AppConfig:{$m:{1:["test_id","int32",0],2:["domain","string",""],3:["flexible_domain","string",""],4:["replace_flexible_domain","string",""]}},InitConfig:{$m:{1:["app_config","protocol.proto_initconfig.AppConfig",null],4:["speedlog_config","protocol.proto_initconfig.SpeedlogConfig",null],5:["media_config","protocol.proto_initconfig.MediaConfig",null]}},MediaConfig:{$m:{1:["play_config","protocol.proto_initconfig.MediaPlayConfig",null],2:["publish_config","protocol.proto_initconfig.MediaPublishConfig",null]}},MediaPlayConfig:{$m:{5:["resource_info","<protocol.proto_initconfig.MediaResourceInfo",null]}},MediaPublishConfig:{$m:{2:["resource_info","<protocol.proto_initconfig.MediaResourceInfo",null],5:["enable_subject_segmentation","int32",0],6:["object_segmentation_platform","int32",0]}},MediaResourceInfo:{$m:{1:["resource_type","protocol.proto_initconfig.ResourceType",0],2:["service_info","<protocol.proto_initconfig.MediaServiceProtocolInfo",null]}},MediaServiceProtocolInfo:{$m:{1:["config_id","string",""],2:["protocol","protocol.proto_initconfig.ProtocolType",0],3:["url_template","string",""],4:["resolve_type","protocol.proto_initconfig.ResolveType",0],5:["push_cdn_authentication","int32",0],6:["cdn_quic_version","<int32",null]}},ProtocolType:{$e:{UDP:0,RTMP:1,FLV:2,HLS:3,WEBRTC:4}},ResolveType:{$e:{LOCAL_DNS:0,DISPATCH:1}},ResourceType:{$e:{CDN:0,RTC:1,L3:2,CDN_PLUS:3,CDN_PLUS_BACKUP:4}},SpeedlogConfig:{$m:{1:["report_count","int32",0],2:["report_retry_interval","int32",0],3:["push_quality_sample_count","int32",0],4:["pull_quality_sample_count","int32",0],5:["hardware_report_cycle","int32",0],6:["room_user_max_count","int32",0],7:["room_stream_max_count","int32",0],8:["charge_info_report_cycle","int32",0],9:["charge_info_report_mode","int32",0],10:["disable_report_pull","<protocol.proto_initconfig.ResourceType",null],11:["report_max_bytes","int32",0],12:["push_quality_report_freq","int32",0],13:["pull_quality_report_freq","int32",0],14:["charge_info_report_no_playing","int32",0]}}}}},"",S,!1);var N=S.protocol,C=function(){return(C=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)};i.util.Long=b.a,i.configure(),x.prototype.encodeRequest=function(t,i,n){var e,s=(r=this._[t])[0],r=r[1];return r=(s=this.S(this.h[s][r],i)).length,0===this.stateCenter.appInfo.model?((e=new Uint8Array(13+r))[0]=175,e[1]=0,e[2]=t>>8,e[3]=t-(e[2]<<8),e.set(new Uint8Array(Int32Array.from([r]).buffer).reverse(),4),e.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),8),e[12]=0):((e=new Uint8Array(13+r))[0]=172,e[1]=0,e[2]=0,e.set(new Uint8Array(Int32Array.from([n]).buffer).reverse(),3),e[7]=t>>8,e[8]=t-(e[2]<<8),e.set(new Uint8Array(Int32Array.from([r]).buffer).reverse(),9)),e.set(s,13),e},x.prototype.decodeResponse=function(t){var i,n=0===this.stateCenter.appInfo.model?(i=(t[2]<<8)+t[3],new DataView(t.buffer).getUint32(8)):(i=(t[7]<<8)+t[8],new DataView(t.buffer).getUint32(3)),e=t.slice(13);try{var s=this._[i];return[n,i,this.T(this.h[s[0]][s[1]],e)]}catch(t){return[n,i,{code:1}]}},x.prototype.decodeConfigMessage=function(t){return this.T(this.h.proto_initconfig.InitConfig,t)},x.prototype.S=function(t,i){return t.encode(new t(i)).finish()},x.prototype.T=function(t,i){return C({},t.decode(i))};var k,z=x,D=(Object.defineProperty(U.prototype,"id",{get:function(){return this.v||null},set:function(t){this.v=t},enumerable:!1,configurable:!0}),Object.defineProperty(U.prototype,"data",{get:function(){return this.C},set:function(t){this.C=t},enumerable:!1,configurable:!0}),U.prototype.hasNext=function(){return this.next&&this.next.id},U.prototype.hasPrev=function(){return this.prev&&this.prev.id},U),A=(M.prototype.insertBefore=function(t,i){return(i=new D(this.R,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this.R,++this.O,i},M.prototype.addLast=function(t){return this.insertBefore(this.end,t)},M.prototype.add=function(t){return this.addLast(t)},M.prototype.getFirst=function(){return 0===this.O?null:this.start.next},M.prototype.getLast=function(){return 0===this.O?null:this.end.prev},M.prototype.size=function(){return this.O},M.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},M.prototype.get=function(t){return 0===t?this.getFirst():t===this.O-1?this.getLast():this.getFromFirst(t)},M.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this.O,t},M.prototype.removeFirst=function(){var t=null;return 0<this.O&&this.start.next?this.remove(this.start.next):t},M.prototype.removeLast=function(){var t=null;return 0<this.O&&this.end.prev?this.remove(this.end.prev):t},M.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this.O=0,this.R=0},M.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},M.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},M.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},M.prototype.push=function(t){return this.addLast(t)},M.prototype.unshift=function(t){this.insertBefore(0<this.O?this.start.next:this.end,t)},M.prototype.pop=function(){return this.removeLast()},M.prototype.shift=function(){return this.removeFirst()},M);function P(){this.txid=0,this.linkRetryTime=60,this.updatedMsgTime=0,this.connectServer=""}function M(){this.start=new D,this.end=new D,this.R=0,this.O=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}function U(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this.v=t,this.C=i}function x(t){this.stateCenter=t,this.h=N,this._=((t={})[s.MSG_TYPE_STREAM_CLOSED]=["proto_accesshub","ConnectionClosed"],t[s.MSG_TYPE_CLOSE_CONNECTION]=["proto_accesshub","CloseConnection"],t[s.MSG_TYPE_HTTP_REQUEST]=["proto_accesshub","HTTPRequest"],t[s.MSG_TYPE_HTTP_RESPONSE]=["proto_accesshub","HTTPResponse"],t[s.MSG_TYPE_HTTP_REQUEST2]=["proto_accesshub","HTTPRequest2"],t[s.MSG_TYPE_HB_REQUEST]=["proto_accesshub","HBRequest"],t[s.MSG_TYPE_HB_RESPONSE]=["proto_accesshub","HBResponse"],t[s.MSG_TYPE_GET_CONFIG_REQUEST]=["proto_accesshub","GetConfigRequest"],t[s.MSG_TYPE_GET_CONFIG_RESPONSE]=["proto_accesshub","GetConfigResponse"],t[s.MSG_TYPE_GET_SVRADDR_REQUEST]=["proto_accesshub","GetSvraddrRequest"],t[s.MSG_TYPE_GET_SVRADDR_RESPONSE]=["proto_accesshub","GetSvraddrResponse"],t[s.MSG_TYPE_HTTP_REQUEST_ACK]=["proto_accesshub","HTTPRequestAck"],t[s.MSG_TYPE_PC_UPWARD_MESSAGE]=["proto_accesshub","PCUpwardMessage"],t[s.MSG_TYPE_PC_UPWARD_MESSAGE_ACK]=["proto_accesshub","PCUpwardMessageAck"],t[s.MSG_TYPE_PC_ESTABLISHED]=["proto_accesshub","PCEstablished"],t[s.MSG_TYPE_PC_BROKEN]=["proto_accesshub","PCBroken"],t[s.MSG_TYPE_PC_DOWNWARD_MESSAGE]=["proto_accesshub","PCDownwardMessage"],t[s.MSG_TYPE_REDIRECT]=["proto_accesshub","Redirect"],t[s.MSG_TYPE_REDIRECT2]=["proto_accesshub","Redirect2"],t[s.MSG_TYPE_GET_APPCONFIG_REQUEST]=["proto_accesshub","GetAppConfigRequest"],t[s.MSG_TYPE_GET_APPCONFIG_RESPONSE]=["proto_accesshub","GetAppConfigResponse"],t[s.MSG_TYPE_PUSH_APPCONFIG]=["proto_accesshub","PushAppConfig"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST]=["proto_accesshub","AccesshubDispatchRequest"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE]=["proto_accesshub","AccesshubDispatchResponse"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2]=["proto_accesshub","AccesshubDispatchRequest2"],t[s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2]=["proto_accesshub","AccesshubDispatchResponse2"],t[s.MSG_TYPE_PUSH_EXCEPTION]=["proto_accesshub","PushException"],t)}P.prototype.createSocket=function(t){},P.prototype.setState=function(t){},P.prototype.initEvent=function(t,i,n,e){},P.prototype.sendMessage=function(t,i,n,e,s,r,o,u){void 0===e&&(e=!0),void 0===s&&(s=null),void 0===r&&(r=null),void 0===o&&(o=null)},n=P,(g=k=k||{})[g.BROWSER=0]="BROWSER",g[g.WEIXINMINI=1]="WEIXINMINI",j.prototype.init=function(){var t=this;this.P&&(this.readyState=0,this.P.onOpen((function(i){t.readyState=t.P.readyState,"function"==typeof t.onopen&&(t.onopen(i),t.P.onClose((function(i){t.readyState=t.P.readyState,"function"==typeof t.onclose&&t.onclose(i)})),t.P.onMessage((function(i){"function"==typeof t.onmessage&&t.onmessage(i)})))})),this.P.onError((function(i){t.readyState=t.P.readyState,"function"==typeof t.onerror&&t.onerror(i)})))},j.prototype.onopen=function(t){},j.prototype.onerror=function(t){},j.prototype.onclose=function(t){},j.prototype.onmessage=function(t){},j.prototype.send=function(t){t instanceof Uint8Array&&(t=new Uint8Array(t).buffer),this.P&&this.P.send({data:t})},j.prototype.close=function(){this.P&&this.P.close()};var L=j;function j(t,i){this.url=t,this.readyState=3,this.P=wx.connectSocket({url:t}),this.init()}function q(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}function G(t){var i=unescape||window.unescape;return Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})))}function H(t){var i=escape||window.escape;return decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))))}function B(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}Gt.prototype.createSocket=function(t){var i,n;this.A=(n=this.proxyCtrl,(i=this.ENV%2)%2===k.BROWSER?(i=t,n?n.createSocket(i,0):new WebSocket(i)):new L(t))},Gt.prototype.openHandler=function(t){var i=this;this.A&&(this.A.onopen=function(n){i.A.binaryType="arraybuffer",i.responseHandler(),t(n)})},Gt.prototype.responseHandler=function(){var t=this;this.A&&(this.A.onmessage=function(i){i="string"==typeof i.data?JSON.parse(i.data):i.data,t.onMessage(i)})},Gt.prototype.onMessage=function(t){},Gt.prototype.closeHandler=function(t){this.A&&(this.A.onclose=function(i){t(i)})},Gt.prototype.errorHandler=function(t){this.A&&(this.A.onerror=t)},Gt.prototype.closeSocket=function(){this.A&&(this.A.onclose=null,this.A.onerror=null,this.A.close(),this.A=null)},Gt.prototype.isDisConnect=function(){return!this.A||1!==this.A.readyState},Gt.prototype.sendMessage=function(t){this.isDisConnect()||this.A&&this.A.send(t)};var V,$=Gt,J={TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},NET_CONNECT_TIMEOUT:{code:1100006,msg:"net connect timeout"}},Y={code:1100007,msg:"the user breaks the network connection"},X="zn.zca.gc",W="zn.zca.gac",K="zn.zca.rd",F="zn.zca.cc",Z="zn.shq.0",Q="zn.nab.gsa",tt="zn.nab.du",it="zn.nab.gac",nt="zn.nhb.s",et="zn.rlh.at",st="zn.rlh.sm",rt="zn.wl.cs.0",ot="zn.wl.bse",ut="zn.napr.sr",ht="zn.napr.ope",ct="zn.nahr.sr",at="zn.nahr.sr2",lt={domains:["accesshub-wss.zego.im"],mode:"online",modeNo:u.MODE_ONLINE,sdkType:3,connectVer:31,pcEstablishTimeout:15,scheme:"wss",location:"accesshub",wssMessageType:1,model:0},ft=(V=function(t,i){return(V=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(){return(ft=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)}),_t=function(t){function i(i,n,e,r,o,u){var h=t.call(this)||this;return h.I=i,h.N=n,h.D=e,h.M=r,h.U=o,h.proxyCtrl=u,h.socketService=new $(h.N,h.proxyCtrl),h.urlIndex=0,h.updatedMsgTime=0,h.unUpdateMsgTimeTypes=[s.MSG_TYPE_HB_REQUEST,s.MSG_TYPE_HB_RESPONSE,s.MSG_TYPE_GET_CONFIG_REQUEST,s.MSG_TYPE_GET_CONFIG_RESPONSE,s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,s.MSG_TYPE_ACCESSHUB_DISPATCH_RESPONSE2,s.MSG_TYPE_GET_SVRADDR_REQUEST,s.MSG_TYPE_GET_APPCONFIG_RESPONSE],h.netLinkState=0,h.sendCommandList=new A,h.unSendCommandList=new A,h.sendCommandMap={},h.unSendCommandMap={},h.H=100,h.G=15e3,h.Y=1e3,h.V=5e3,h.connectInterval=1e4,h.connectTimer=null,h.connectRsp={},h.unlogTypes=[12,13],h.tryServers=[],h.tryConnectEvents=[],h.connectStartTime=0,h.updatedMsgTime=Date.now(),h}var n=i,e=t;if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=n}return V(n,e),n.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r),i.prototype.initEvent=function(t,i,n,e){this.B=t,this.k=i,this.L=n,this.q=e},i.prototype.createSocket=function(t){this.servers=t,this.urlIndex=0},i.prototype.destroySocket=function(t,i){this.M.info("zn.wl.ds.0 call "+t),this.socketService.closeSocket(),this.netLinkState=0,t!==c.NONE&&(i&&(this.j(this.servers?this.servers[this.urlIndex]:"",i.code,!0),this.B)&&this.B(this.tryServers,this.tryConnectEvents),this.k)&&this.k(t===c.BROKEN),this.resetConnect()},i.prototype.refreshServers=function(t){this.servers=q(q([],t,!0),this.servers,!0)},i.prototype.connectSocket=function(t,i,n){var e=this,s=(void 0===t&&(t=!0),this.M.info(rt+" call"),this.connectRsp.suc=i,!1),r=(this.connectRsp.fail=function(){n&&(s?e.M.info(rt+" fail cb has exec"):(n(),s=!0))},t&&(this.urlIndex=(this.urlIndex+1)%this.servers.length),this.servers[this.urlIndex]);return this.connectServer=r,this.M.info(rt+" server "+r),this.tryServers.push(r),this.connectStartTime=Date.now(),this.closeSocket(),this.netLinkState=1,this.socketService.createSocket(r),this.L&&this.L(!0),this.bindSocketEvent(),this.connectTimer=setTimeout((function(){e.M.info(rt+" timeout"),e.j(r,J.NET_CONNECT_TIMEOUT.code),e.connectRsp.fail&&e.connectRsp.fail()}),this.connectInterval),!0},i.prototype.bindSocketEvent=function(){var t=this;this.openHandler((function(){t.M.info(ot+" open"),t.resetConnect(),t.connectRsp.suc&&t.connectRsp.suc(),t.netLinkState=2,t.j(t.connectServer,0),t.B&&t.B(t.tryServers,t.tryConnectEvents),t.tryConnectEvents=[],t.checkUnSendMsgs(t.unSendCommandList,t.unSendCommandMap)})),this.closeHandler((function(i){t.M.warn(ot+" close "+JSON.stringify(i.code||i)),t.resetConnect(),t.connectRsp.fail&&t.connectRsp.fail(),t.j(t.connectServer,(null==i?void 0:i.code)||J.NET_CONNECT_TIMEOUT.code),t.k&&t.k(!0),t.netLinkState=0})),this.errorHandler((function(i){t.M.warn(ot+" error "+JSON.stringify(i.code||i)),t.resetConnect(),t.connectRsp.fail&&t.connectRsp.fail(),t.j(t.connectServer,(null==i?void 0:i.code)||J.NET_CONNECT_TIMEOUT.code),t.k&&t.k(!0),t.netLinkState=0})),this.onMessage()},i.prototype.closeSocket=function(){this.M.info("zn.wl.cs.1 call"),this.socketService.closeSocket(),this.netLinkState=0},i.prototype.j=function(t,i,n){(this.connectStartTime||n)&&(n=this.connectStartTime?Date.now()-this.connectStartTime:0,this.tryConnectEvents.push({url:t,time_consumed:n,connect_type:3,error:i}))},i.prototype.resetConnect=function(){this.connectTimer&&(clearTimeout(this.connectTimer),this.connectTimer=null)},i.prototype.release=function(){this.stopCheck()},i.prototype.isConnect=function(){return 2===this.netLinkState},i.prototype.isDisConnect=function(){return!this.socketService||this.socketService.isDisConnect()},i.prototype.isConnecting=function(){return 1===this.netLinkState},i.prototype.setState=function(t){this.netLinkState=t},i.prototype.closeHandler=function(t){this.socketService.closeHandler(t)},i.prototype.openHandler=function(t){this.socketService.openHandler(t)},i.prototype.errorHandler=function(t){this.socketService.errorHandler(t)},i.prototype.sendMessage=function(t,i,n,e,r,u,h,c){void 0===e&&(e=!0),void 0===r&&(r=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===(c=void 0===c?{}:c).timeout&&(c.timeout=5e3),void 0===c.isInSendMap&&(c.isInSendMap=!0),void 0===c.isMsgCache&&(c.isMsgCache=!0),this.txid++;var a={appid:this.I,biz_type:0,mode_no:(null==(a=this.U.appInfo)?void 0:a.mode)||lt.modeNo,id_name:this.U.userId,sdk_type:lt.sdkType,zegoconn_run_env:0===this.N?o.ZEGOCONN_RUN_ENV_BROWSER:o.ZEGOCONN_RUN_ENV_APPLET,zegoconn_version:(null==(a=this.U.appInfo)?void 0:a.connVer)||lt.connectVer};null!=(l=this.U.appInfo)&&l.deviceID&&(a.device_id=null==(l=this.U.appInfo)?void 0:l.deviceID);var l=ft(ft({txid:this.txid},e?a:{}),n);e={data:l,txid:this.txid,sendTime:Date.now(),streamID:i,type:t,timeOut:c.timeout||this.V,ack:n.ack,success:r,error:u,ackFunc:h,isSend:!0,isCheck:t!==s.MSG_TYPE_PC_UPWARD_MESSAGE,extras:c.extras},c.isInSendMap&&(a=this.sendCommandList.push(e),this.sendCommandMap[this.txid]=a,this.F||this.startCheck()),10!==l.service&&14!==l.interface_id&&this.unUpdateMsgTimeTypes.includes(t)||(this.updatedMsgTime=Date.now()),-1===this.unlogTypes.indexOf(t)&&this.M.info("zn.wl.sm type: "+t+"-"+p[t]+" streamID: "+i+" txid: "+this.txid),this.isConnect()?this.sendUint8Data(t,l,i,c.extras):c.isMsgCache&&(e.isSend=!1,n=this.unSendCommandList.push(e),this.unSendCommandMap[this.txid]=n)},i.prototype.checkUnSendMsgs=function(t,i){for(var n,e=t.getFirst();null!=e;)e.C&&delete i[null==(n=e.C)?void 0:n.txid],t.remove(e),e.C&&!1===(null==(n=e.C)?void 0:n.isSend)&&e.C.type&&e.C.streamID&&e.C.data&&(this.sendUint8Data(e.C.type,e.C.data,e.C.streamID),e.C.isSend=!0),e=t.getFirst()},i.prototype.W=function(t){return t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset)},i.prototype.sendUint8Data=function(t,i,n,e){t=this.D.encodeRequest(t,i,n),this.socketService.sendMessage(this.W(t))},i.prototype.onMessage=function(){var t=this;this.socketService.onMessage=function(i){i=new Uint8Array(i);var n,e,s=(e=t.D.decodeResponse(i))[0],r=e[1],o=((e=e[2]).txid&&b.a.isLong(e.txid)&&e.txid.toNumber&&(e.txid=e.txid.toNumber()),t.unUpdateMsgTimeTypes.includes(r)||(t.updatedMsgTime=Date.now()),(null==e?void 0:e.txid)||(null==(o=null==e?void 0:e.data)?void 0:o.txid));-1===t.unlogTypes.indexOf(r)&&(n=o?", txid: ".concat(o):"",t.M.info("zn.wl.om"+" streamID: ".concat(s,", msgType: ").concat(r,"-").concat(p[r])+n)),o&&t.isRspMsg(o)?t.handleSendCommandMsgRsp(s,r,o,e,{size:i.length}):t.q(s,r,e,{size:i.length})}},i.prototype.isRspMsg=function(t){return void 0!==this.sendCommandMap[t]},i.prototype.startCheck=function(){var t=this;this.K(this.sendCommandList,this.sendCommandMap,this.unSendCommandList,this.unSendCommandMap),this.F=setTimeout((function(){t.startCheck()}),this.Y)},i.prototype.stopCheck=function(){this.Z(this.sendCommandList),this.F&&(clearTimeout(this.F),this.F=null)},i.prototype.K=function(t,i,n,e){for(var s,r,o=t.getFirst(),u=t.size(),h=Date.now(),c=0,a=0;null!=o;){if(o.C&&o.C.sendTime+o.C.timeOut>h){if(++a<u){var l=t.removeFirst();l&&null!=l&&l.data&&(l=t.push(null==l?void 0:l.data),null!=(r=o.C))&&r.txid&&(i[null==(r=o.C)?void 0:r.txid]=l),o=t.getFirst();continue}break}if(t.remove(o),o.C&&(delete i[o.C.txid],r=e[o.C.txid])&&(n.remove(r),delete e[o.C.txid]),++a,o.C&&null==o.C.error||o.C&&o.C.sendTime+this.G<h||(l=o&&o.C&&o.C.error,o&&o.C&&null!=(s=o.C)&&s.isCheck&&l&&l({},o&&o.C&&o.C.txid,J.TIMEOUT)),++c>=this.H)break;o=t.getFirst()}},i.prototype.Z=function(t){for(var i,n=t.getFirst();null!=n&&n.C;)!function(){var e,s,r;t.remove(n),n.C.isSend&&n.C.error&&(e=n&&n.C&&n.C.error,s=n&&n.C&&n.C.txid,r=n&&n.C&&(null==(i=n.C)?void 0:i.isCheck),setTimeout((function(){r&&e&&e({},s,J.TIMEOUT)}),0)),n=t.getFirst()}()},i.prototype.handleSendCommandMsgRsp=function(t,i,n,e,r){var o,u=this.sendCommandMap[n];null!=u&&(null!=(o=u.C)&&o.ack||(delete this.sendCommandMap[n],this.sendCommandList.remove(u)),e.code&&0!==e.code?o&&null!=o.error&&(o.error(e,n),o.success=null,o.error=null):i===s.MSG_TYPE_PUSH_EXCEPTION?(e.code=e.reason,e.message=e.msg,delete e.reason,delete e.msg,o&&null!=o.error&&(o.error(e,n),o.success=null,o.error=null)):i===s.MSG_TYPE_HTTP_REQUEST_ACK?o&&null!=o.ackFunc&&o.ackFunc(e,n):o&&null!=o.success&&(o.success(e,n,r),o.success=null,o.error=null))},i}(n),dt=(qt.prototype.getConfig=function(t,i){var n;this.M.info("zn.nab.gc call"),this.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_CONFIG_REQUEST,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},t,i)},qt.prototype.dispatchURL=function(t,i){var n,e=this;this.M.info(tt+" call"),this.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_ACCESSHUB_DISPATCH_REQUEST2,{geofencing_type:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.type,geofencings:null==(n=this.stateCenter.appInfo.geoFencing)?void 0:n.list},(function(i){e.M.info(tt+" suc "),t&&t(i)}),(function(t,n,s){e.M.info(tt+" fail"),i&&i(s||t)}))},qt.prototype.getAppConfig=function(t,i,n,e,r,o){var u=this;return new Promise((function(c,a){function l(t,i,n){n?(u.M.error(it+" fail "+JSON.stringify(n)),a(n)):0===t.code?(u.M.info(it+" suc"),n=u.decodeConfigMessage(t.data.data),c({code:0,data:n,etag:t.data.etag})):(u.M.error(it+" fail "+t.code),a({code:t.code}))}u.M.info(it+" call");var f={id_name:i,config_key:t,token:n,mode_no:(null==(f=u.stateCenter.appInfo)?void 0:f.mode)||lt.modeNo,etag:r,is_special_customer:null!=o&&o.isSpecial?1:0};u.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_APPCONFIG_REQUEST,f,l,l,null,{timeout:e})}))},qt.prototype.decodeConfigMessage=function(t){return this.D.decodeConfigMessage(t)},qt.prototype.getSvrAddr=function(){var t=this;return new Promise((function(i,n){var e;t.M.info("".concat(Q," call")),t.J.createStream(h.OTHER).sendMessage(s.MSG_TYPE_GET_SVRADDR_REQUEST,{geofencing_type:null==(e=t.stateCenter.appInfo.geoFencing)?void 0:e.type,geofencings:null==(e=t.stateCenter.appInfo.geoFencing)?void 0:e.list},(function(n){t.M.info("".concat(Q," suc")),i(n)}),(function(i,e,s){t.M.info("".concat(Q," fail")),n(s||i)}))}))},qt),mt=(jt.prototype.init=function(t){var i=this;this.M.info("zn.nhb.ii call"),this.ot||(this.ot=this.J.createStream(h.OTHER)),1<=t.data.logic_hb_interval&&t.data.logic_hb_interval<=10&&(this.tt=t.data.logic_hb_interval),3<=t.data.logic_hb_timeout&&t.data.logic_hb_timeout<=30&&(this.nt=t.data.logic_hb_timeout),this.et=0,this.it=this.nt/this.tt,this.X&&clearTimeout(this.X),this.X=setTimeout((function(){i.start()}),1e3*this.tt)},jt.prototype.start=function(){var t,i,n,e=this;this.M.debug(nt+" call "),this.et++>this.it?(this.M.error(nt+" come to try limit"),this.reset(),this.netHbLogout(J.NET_HB_TIMEOUT)):(t=(new Date).getTime(),i=function(i,n,s){var r=(new Date).getTime()-t;e.M.debug(nt+" hb callback "+r),s&&0!==(null==s?void 0:s.code)?e.M.info(nt+" fail "+JSON.stringify(s)):(null!=i&&i.ntp_time&&(s="number"==typeof(r=i.ntp_time)?r:r.toNumber(),i=(new Date).getTime(),0===e.U.appInfo.env)&&e.U.updateNTP(t,s,i),e.et=0)},n={ts:Date.now()},this.ot.sendMessage(s.MSG_TYPE_HB_REQUEST,n,i,i,null),this.ot.isFirst=!1,this.X&&clearTimeout(this.X),this.X=setTimeout((function(){e.start()}),1e3*this.tt))},jt.prototype.netHbLogout=function(t){},jt.prototype.reset=function(){this.X&&(clearTimeout(this.X),this.X=null),this.et=0},jt),vt=(Lt.prototype.addEventHandler=function(t,i){if(this.st[t]||(this.st[t]=[]),"function"!=typeof i)throw new Error("Params callBack is not a Function");return this.st[t]&&-1==this.st[t].indexOf(i)&&this.st[t].push(i),!0},Lt.prototype.removeEventHandler=function(t,i){return!!this.st[t]&&(this.st[t]=i?this.st[t].filter((function(t){return t!==i})):[],!0)},Lt.prototype.emit=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];this.st[t]&&this.st[t].forEach((function(n){try{n.apply(void 0,i)}catch(n){console.error('Fail to execute callback of event "'.concat(t,'" : ').concat(n))}}))},Lt),pt=function(){return(pt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},gt=(xt.prototype.sendRequest=function(t,i,n,e){var r=this,o=t.payload,u=(null!=(u=this.ut)&&u.encode&&(o=G(t.payload)),{service_no:this.rt,ack:t.ack,payload:o,wss_message_type:null!=(o=null==(u=this.ut)?void 0:u.messageType)?o:lt.wssMessageType,wss_path:null==(u=this.ut)?void 0:u.path,wss_raw_query:null==(o=this.ut)?void 0:o.query,zegoconn_version:lt.connectVer});this.netPcStream.isConnect()||(this.M.info(ut+" pc is not connect"),this.eventManager.emit("connectStart")),this.netPcStream.sendMessage(s.MSG_TYPE_PC_UPWARD_MESSAGE,u,(function(){r.M.info(ut+" suc"),n&&n()}),(function(t){r.M.error(ut+" fail"),i&&i(t)}),null,{isInSendMap:"boolean"==typeof t.isInSendMap&&t.isInSendMap,extras:e,isMsgCache:null==(o=this.ut)?void 0:o.isMsgCache})},xt.prototype.onPushEvent=function(t,i,n){var e;switch(this.M.info(ht+" msgType: ".concat(t)),t){case s.MSG_TYPE_PC_ESTABLISHED:this.netPcStream.isFirst=!1,this.pcEstablished(i,this.netPcStream.StreamID);break;case s.MSG_TYPE_PC_BROKEN:this.pcBroken();break;case s.MSG_TYPE_PC_DOWNWARD_MESSAGE:this.M.info(ht+" ".concat(this.rt," down ").concat((null==i?void 0:i.ts)&&i.ts.toNumber&&i.ts.toNumber()||i.ts));var r=i.payload;null!=(e=this.ut)&&e.encode&&(r=H(i.payload)),this.eventManager.emit("downLoadMessage",r,n);break;case s.MSG_TYPE_PUSH_EXCEPTION:this.M.info(ht+" ".concat(this.rt," exception ").concat(JSON.stringify(i))),this.eventManager.emit("exception",i,n)}},xt.prototype.on=function(t,i){return this.eventManager.addEventHandler(t,i)},xt.prototype.off=function(t,i){this.eventManager.removeEventHandler(t,i)},xt.prototype.pcEstablished=function(t,i){this.M.info("zn.napr.pe call "+JSON.stringify(t)),this.setConnectState(a.CONNECTED);var n=d.MANUAL;this.lastConnectState===a.BROKEN&&this.connectState===a.CONNECTED&&(n=d.AUTO),this.eventManager.emit("connected",n),this.reportEvent("pcConnectedEvent",{proxy_link_sources:null==t?void 0:t.from,connect_stream:i}),this.brokenTimer&&clearTimeout(this.brokenTimer)},xt.prototype.pcBroken=function(){var t=this;this.M.info("zn.napr.pb call"),this.setConnectState(a.BROKEN),this.eventManager.emit("broken"),this.reportEvent("pcBrokenEvent"),this.brokenTimer=setTimeout((function(){t.eventManager.emit("disconnected",_.TEMP),t.reportEvent("pcDisconnectedEvent")}),1e3*this.ct)},xt.prototype.resetBrokenTimer=function(){this.brokenTimer&&clearTimeout(this.brokenTimer)},xt.prototype.ht=function(t,i){var n;this.M.info("zn.napr.cr call "+this.rt+" "+this.connectState),this.connectState!==a.DISCONNECT&&(this.netPcStream.closeStream(0,""),this.resetBrokenTimer(),n=this.J.getStreamID(),this.netPcStream.refresh(n),this.eventManager.emit(t,i),n="","broken"===t?n="pcBrokenEvent":"disconnected"===t&&(n="pcDisconnectedEvent"),n)&&this.reportEvent(n),this.setConnectState(a.DISCONNECT)},xt.prototype.closePc=function(){this.ht("broken")},xt.prototype.closeRequest=function(){this.ht("disconnected",_.CLOSE)},xt.prototype.setConnectState=function(t){this.connectState!==t&&(this.lastConnectState=this.connectState,this.connectState=t)},xt.prototype.reportEvent=function(t,i){this.eventManager.emit(t,pt({service_no:this.rt},i))},xt),bt=(Ut.prototype.getRequest=function(t,i){return t=new gt(this.M,t,this.J,this.pcEstablishTimeout,i),this.pcStreamRequests.push(t),t},Ut.prototype.updateConnectState=function(t,i,n){this.M.info("zn.naprm.ucs call "+t+" "+i),this.pcStreamRequests.forEach((function(e){t===a.BROKEN?(e.eventManager.emit("broken"),e.reportEvent("pcBrokenEvent")):t===a.DISCONNECT&&(e.eventManager.emit("disconnected",i,n),e.reportEvent("pcDisconnectedEvent"))}))},Ut.prototype.closePCs=function(){this.pcStreamRequests.forEach((function(t){t.closePc()}))},Ut.prototype.setEstablishTimeout=function(t){this.pcEstablishTimeout=t},Ut),Et=(Mt.prototype.initLink=function(t){this.link=t},Mt.prototype.startMaxTime=function(){var t=this;this.M.info(st+" call"),this.maxTimer||(this.M.info(st+" start max timer"),this.maxTimer=setTimeout((function(){t.M.warn(st+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.link.destroySocket(c.NONE),t.stopMaxTime(),t.invalid(),t.onactive(!1,J.NET_SOCKET_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},Mt.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Mt.prototype.active=function(t,i,n){var s=this;if(void 0===n&&(n=!1),this.M.info(et+" call "+t+" "+(i=void 0!==i&&i)),this.U.isDestroyed)return!1;if(this.retryTimer)return this.M.info(et+" has actived, ignore"),!1;var r=this.U.networkState==e.offline;if(r){if(this.M.info(et+"  check if really offline. "+this.lt),this.lt>=this.Et)return this.M.warn(et+" network is broken, stop retry"),!1}else this.lt=0;return this.link.isConnecting()&&!n?(this.M.info(et+" link is connecting, ignore"),!1):this.isOverTime?(this.M.info(et+" retry over time, stop retry"),!1):(1==this._t?this.ft=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this._t/this.RETRY_CONTINUE_COUNT+1)),this.ft=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.M.info(et+" interval "+this.ft),this.retryTimer=setTimeout((function(){s.link.destroySocket(c.BROKEN),s.link.connectSocket(t,(function(){s.M.info(et+" suc"),s.U.networkState=e.online,s.stopMaxTime(),s.invalid(),s.onactive(!0)}),(function(){s.M.info(et+" fail"),s.maxTimer||s.startMaxTime(),s.active(!0,!1,!0)})),s.retryTimer&&clearTimeout(s.retryTimer),s.retryTimer=null,r?s.lt++:s._t++}),i?0:1e3*this.ft),!0)},Mt.prototype.onactive=function(){for(var t=0;t<arguments.length;t++);},Mt.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof t&&t<3600&&(this.RETRY_MAX_TIME=t),"number"==typeof i&&(this.RETRY_START_TIME_INTERVAL=i),"number"==typeof n&&(this.RETRY_CONTINUE_COUNT=n),"number"==typeof e&&(this.RETRY_MAX_TIME_INTERVAL=e)},Mt.prototype.invalid=function(){this.M.info("zn.rlh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this._t=1,this.lt=0},Mt),St=(Pt.prototype.updateNTP=function(t,i,n){var e;n<t||(e=n-t,this.timeOffset=Math.round((i-t+(i-n))/2),t=Math.round(i+e/2),(!this.networkRTT||e<this.networkRTT)&&(this.networkRTT=e,this.ntpTimeInfo={performanceTime:Math.round(performance.now()),ntp:t}))},Pt),Rt=(At.prototype.log=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.log(n)},At.prototype.debug=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.debug(n)},At.prototype.info=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.info(n)},At.prototype.warn=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.warn(n)},At.prototype.error=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var n=t.join(" ");console.error(n)},At),yt=function(){return(yt=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},Ot=(Dt.prototype.sendRequest=function(t,i,n,e,r){var o=this,u=t.disableLog;t={service_no:this.rt,ack:t.ack,headers:t.headers,body:G(JSON.stringify(t.body)),id_name:t.idName,method_no:t.method_no,stick:t.stick,location:t.location,reduce_resp_header:t.reduceRspHeaders?1:0},this.netHttpStream.sendMessage(s.MSG_TYPE_HTTP_REQUEST,t,(function(t){o.closeStream();var n=("gzip"===(null==(n=(null==t?void 0:t.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)})))?void 0:n.val)?u||o.M.info(ct+" gzip"):t.body&&(n=H(t.body),t.body=n),yt(yt({},t),{body:void 0}));u||o.M.info(ct+" suc "+JSON.stringify(n)),i&&i(t)}),(function(t,i,e){o.closeStream(),u||o.M.error(ct+" fail"),n&&n(e||t)}),(function(t){u||o.M.error(ct+" ack"),e&&e(t)}),r),this.netHttpStream.isFirst=!1},Dt.prototype.sendRequest2=function(t,i,n,e,r){var o=this,u=1===t.format?G(JSON.stringify(t.body)):t.body;u={ack:t.ack,body:u,id_name:t.idName,method:t.method,interface_id:t.interfaceID,token:t.token,reduce_resp_header:t.reduceRspHeaders?1:0},t.headers&&(u.headers=t.headers),t.resID&&(u.res_id=t.resID),t.urlParams&&(u.params=t.urlParams),t.mode&&(u.mode=t.mode),this.netHttpStream.sendMessage(s.MSG_TYPE_HTTP_REQUEST2,u,(function(e,s){o.closeStream();var r=(null==e?void 0:e.headers).find((function(t){return"Content-Encoding"===(null==t?void 0:t.name)}));if(200===e.status_code){if("gzip"===(null==r?void 0:r.val))o.M.info(at+" gzip");else if(e.body&&1===t.format)try{u=H(e.body),e.body=u}catch(s){o.M.info(at+" decode "+JSON.stringify(s))}r=yt(yt({},e),{body:void 0}),o.M.info(at+" suc "+JSON.stringify(r)),i&&i(e,s)}else{try{var u=H(e.body);e.body=u}catch(s){o.M.info(at+" status "+e.status_code+" "+JSON.stringify(s))}n&&n(e)}}),(function(t,i,e){o.closeStream(),o.M.error(at+" fail"),n&&n(e||t)}),(function(t){o.M.error(at+" ack"),e&&e(t)}),r),this.netHttpStream.isFirst=!1},Dt.prototype.closeStream=function(){this.M.info("zn.nahr.cs call"),this.netHttpStream.closeStream(0,"")},Dt),Tt=(Object.defineProperty(zt.prototype,"StreamID",{get:function(){return this.St},enumerable:!1,configurable:!0}),zt.prototype.refresh=function(t){this.St=t,this.isFirst=!0},zt.prototype.sendMessage=function(t,i,n,e,s,r){var o=this;void 0===n&&(n=null),void 0===e&&(e=null),this.Tt.sendMessage(t,this.St,i,this.isFirst,(function(t,i,e){o.dt!==h.PC&&(o.isFree=!0),n&&n(t,e)}),(function(t,i,n){o.dt!==h.PC&&(o.isFree=!0),e&&e(t,i,n)}),s=void 0===s?null:s,r=void 0===r?{timeout:5e3,isInSendMap:!0}:r)},zt.prototype.onPushEvent=function(t,i,n){},zt.prototype.closeStream=function(t,i){this.Tt.sendMessage(s.MSG_TYPE_STREAM_CLOSED,this.St,{code:t,msg:i},void 0,void 0,void 0,void 0,{isInSendMap:!1})},zt.prototype.isConnect=function(){return this.Tt.isConnect()},zt),wt=(kt.prototype.createStream=function(t){var i=new Tt(t,this.streamID++,this.Tt);return t===h.PC&&this.pcStreams.push(i),i},kt.prototype.onPushEvent=function(t,i,n,e){var s=this.pcStreams.find((function(i){return i.StreamID===t}));s&&s.onPushEvent(i,n,e)},kt.prototype.getStreamID=function(){return this.streamID++},kt),It=function(){return(It=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},Nt=(Object.defineProperty(Ct.prototype,"isDestroy",{get:function(){return this.stateCenter.isDestroyed},enumerable:!1,configurable:!0}),Object.defineProperty(Ct.prototype,"clientIP",{get:function(){return this.stateCenter.clientIP},enumerable:!1,configurable:!0}),Object.defineProperty(Ct.prototype,"timeOffset",{get:function(){return this.stateCenter.timeOffset},enumerable:!1,configurable:!0}),Object.defineProperty(Ct.prototype,"linkConnectState",{get:function(){return this.Ct},set:function(t){this.lastLinkConnectState=this.Ct,this.Ct=t},enumerable:!1,configurable:!0}),Ct.prototype.init=function(){this.logger=new Rt,this.stateCenter=new St,this.protobuf=new z(this.stateCenter),this.eventManager=new vt,this.Nt(),this.inited=!0},Ct.prototype.unInit=function(){this.inited=!1,this.zegoLink.release()},Ct.prototype.setAppInfo=function(t){this.logger.info("zn.sai.0 "+JSON.stringify(t)),this.stateCenter.appInfo=It({model:lt.model},t),this.stateCenter.networkState=!navigator||navigator.onLine?e.online:e.offline,0===t.env?this.Dt():1===t.env&&this.Mt(),this.zegoLink=new _t(t.appID,t.env,this.protobuf,this.logger,this.stateCenter,this.proxyCtrl),this.zegoLink.initEvent(this.B,this.k,this.L,this.q),this.streamManager=new wt(this.zegoLink),this.businessRequestMgr=new dt(this.streamManager,this.protobuf,this.logger,this.stateCenter),this.netHeartBeatHandler=new mt(this.streamManager,this.logger,this.stateCenter),this.netAgentPCRequestMgr=new bt(this.streamManager,this.logger),this.Ut()},Ct.prototype.setUserInfo=function(t){this.stateCenter.userId=t},Ct.prototype.setNetAgentDefaultServers=function(t){this.connectServers=B([],t,!0)},Ct.prototype.setNetAgentSpecifiedServers=function(t){throw this.logger.info("zn.sss.0 "+JSON.stringify(t)),Error("not support")},Ct.prototype.setBackupDomains=function(t){throw Error("not support")},Ct.prototype.setDispatchConnectServers=function(t){this.Ht(t)},Ct.prototype.startHttpRequest=function(t,i,n,e,s){var r=this;if(s&&"number"==typeof(null==s?void 0:s.timeout)&&((null==s?void 0:s.timeout)<1e3||1e4<(null==s?void 0:s.timeout)))throw Error("timeout must between 1 and 10 second");var o=this.reportSeq++;this.eventManager.emit("requestEvent",o,"start"),this.isConnect()||(this.logger.info(Z+" link is not connect"),this.connectUa()),new Ot(this.logger,this.streamManager,t.service).sendRequest(t,(function(n){r.eventManager.emit("requestEvent",o,"end",{na_req_location:t.location,status_code:n.status_code,err_code:0}),i&&i(n)}),(function(i){r.eventManager.emit("requestEvent",o,"end",{na_req_location:t.location,err_code:i.code||0}),n&&n(i)}),e,s)},Ct.prototype.startHttpRequest2=function(t,i,n,e,s){var r=this,o=this.reportSeq++;this.eventManager.emit("requestEvent",o,"start"),this.isConnect()||(this.logger.info(Z+" link is not connect"),this.connectUa()),new Ot(this.logger,this.streamManager).sendRequest2(t,(function(n,e){r.eventManager.emit("requestEvent",o,"end",{na_req_interface:t.interfaceID,status_code:n.status_code,err_code:0}),i&&i(n,e)}),(function(i){r.eventManager.emit("requestEvent",o,"end",{na_req_interface:t.interfaceID,err_code:i.code||0}),n&&n(i)}),e,s)},Ct.prototype.getAppConfigByAgent=function(t,i,n,e,s){return this.isConnect()||(this.logger.info("zn.gab.0 link is not connect"),this.connectUa()),this.yt(t,this.stateCenter.userId,i,n,e,s)},Ct.prototype.getPCRequest=function(t,i){var n=this;return(i=this.netAgentPCRequestMgr.getRequest(t,i)).on("disconnected",(function(i){n.logger.warn("zn.zca.gpr "+t+" disconnect "+i),i===_.TEMP&&(n.Pt(),n.Gt())})),i.on("connectStart",(function(){n.connectUa()})),i},Ct.prototype.connectUa=function(){this.isDestroy||(this.logger.info("zn.zca.cua call"),this.retryLinkHandler&&(this.retryLinkHandler.init(),this.Gt(!1,!0)))},Ct.prototype.destroyConnect=function(t){this.logger.info("zn.zca.dc.0 call"),this.wt(t)},Ct.prototype.destroy=function(){this.logger.info("zn.zca.dy.0 call"),this.destroyConnect(2!==this.linkConnectState?Y:void 0),this.vt&&clearTimeout(this.vt),this.retryLinkHandler&&this.retryLinkHandler.invalid(),this.retryLinkHandler&&this.retryLinkHandler.stopMaxTime(),this.stateCenter.isDestroyed=!0},Ct.prototype.isConnect=function(){return this.zegoLink&&this.zegoLink.isConnect()},Ct.prototype.on=function(t,i){return this.logger.info("zn.zca.o.0 "+t),this.eventManager.addEventHandler(t,i)},Ct.prototype.off=function(t,i){this.logger.info("zn.zca.o.1 "+t),this.eventManager.removeEventHandler(t,i)},Ct.prototype.setLogger=function(t){this.logger=t},Ct.prototype.setAccess=function(t){this.stateCenter.useNetAgent=t},Ct.prototype.getVersion=function(){return"1.1.8"},Ct.prototype.Ut=function(){var t=this;this.netHeartBeatHandler.netHbLogout=function(i){t.retryLinkHandler&&([J.NET_HB_TIMEOUT.code].includes(i.code)?(t.retryLinkHandler.startMaxTime(),t.Pt(),t.Gt()):(t.retryLinkHandler.stopMaxTime(),t.retryLinkHandler.invalid(),t.eventManager.emit("disconnected"),t.At()))}},Ct.prototype.Dt=function(){var t=this;window.addEventListener("offline",(function(){t.Yt()})),window.addEventListener("online",(function(){t.Vt()}))},Ct.prototype.Mt=function(){var t=this;wx.onNetworkStatusChange((function(i){i.isConnected?t.Vt():t.Yt()}))},Ct.prototype.Vt=function(){this.logger.info("zn.zca.noh.0 network is online"),this.stateCenter.networkState=e.online,this.stateCenter.useNetAgent&&this.Bt()},Ct.prototype.Yt=function(){this.logger.info("zn.zca.noh.1 network is broken"),this.stateCenter.networkState=e.offline,this.stateCenter.useNetAgent&&this.zt()},Ct.prototype.Nt=function(){var t=this;if(this.stateCenter.useNetAgent){if(this.isConnect()){var i=Date.now()-this.zegoLink.updatedMsgTime;if(i>1e3*this.linkMsgMaxInterval)return this.logger.info("zn.zca.clm interval: "+i),void this.wt()}this.vt&&clearTimeout(this.vt),this.vt=setTimeout((function(){t.Nt()}),1e3*this.linkMsgCheckInterval)}},Ct.prototype.Ht=function(t){var i=this;0<t.length&&(this.connectServers=B([],t,!0)),0<this.defaultConnectServers.length&&this.defaultConnectServers.forEach((function(t){i.connectServers.includes(t)||i.connectServers.push(t)})),this.zegoLink.createSocket(this.connectServers),this.retryLinkHandler||(this.retryLinkHandler=new Et(this.logger,this.stateCenter)),this.retryLinkHandler.init(),this.retryLinkHandler.initLink(this.zegoLink),this.retryLinkHandler.onactive=function(t,n){n===J.NET_SOCKET_TIMEOUT&&(i.eventManager.emit("disconnected",n),i.At(),i.netAgentPCRequestMgr.updateConnectState(a.DISCONNECT,_.TIMEOUT,n))},this.Gt(!1,!0)},Ct.prototype.wt=function(t){this.netHeartBeatHandler&&this.netHeartBeatHandler.reset(),this.zegoLink&&this.zegoLink.destroySocket(c.DISCONNECT,t)},Ct.prototype.gt=function(){function t(t,e,s){s?i.logger.info(X+" fail "+JSON.stringify(s)):0===t.code?(i.logger.info(X+" suc "+JSON.stringify(t)),i.kt(t,n)):i.logger.info(X+" fail "+JSON.stringify(t))}var i=this,n=(new Date).getTime();this.businessRequestMgr.getConfig(t,t)},Ct.prototype.kt=function(t,i){var n,e;this.netHeartBeatHandler.init(t),this.netAgentPCRequestMgr.setEstablishTimeout(t.data.pc_establish_timeout),null!=(n=null==t?void 0:t.data)&&n.client_outer_ip&&(this.stateCenter.clientIP=t.data.client_outer_ip),null!=(n=null==t?void 0:t.data)&&n.ntp_time&&(n="number"==typeof(n=t.data.ntp_time)?n:n.toNumber(),e=(new Date).getTime(),0===this.stateCenter.appInfo.env)&&this.stateCenter.updateNTP(i,n,e),this.eventManager.emit("clientInfo",{clientIP:this.clientIP,timeOffset:this.timeOffset,geofencingID:i=t.data.geofencing_id})},Ct.prototype.Rt=function(){var t=this;return new Promise((function(i,n){t.businessRequestMgr.dispatchURL((function(n){n=n.data.wss_groups;var e=(t.logger.info(tt+" wss_groups: "+JSON.stringify(n)),n.some((function(t){return t.host.includes("geo")}))),s=null!=(s=t.stateCenter.appInfo)&&s.geoFencing||e?n:t.Lt(n);e=t.$t(s),i({servers:e,domains:s})}),(function(t){n(t)}))}))},Ct.prototype.Ot=function(){var t=this;return new Promise((function(i,n){t.businessRequestMgr.getSvrAddr().then((function(e){var s,r,o,u=e.code,h=e.msg;e=e.data,0===u?(s=e.accesshub_domain,r=e.logreport_domain,o=e.detaillog_domain,e=e.geofencing_id,t.logger.info("".concat(Q," domains: ").concat(s," ").concat(r," ").concat(o)),i({accesshub_domain:s,logreport_domain:r,detaillog_domain:o,geofencing_id:e})):n({code:u,msg:h})})).catch((function(t){n(t)}))}))},Ct.prototype.$t=function(t){return Array.isArray(t)&&0<t.length?t.map((function(t){return lt.scheme+"://"+t.host+"/"+lt.location})):[]},Ct.prototype.Lt=function(t){return(t=B([],t,!0)).filter((function(t){return!!t.host}))},Ct.prototype.yt=function(t,i,n,e,s,r){var o=this;return new Promise((function(u,h){"string"==typeof i&&"string"==typeof n?o.businessRequestMgr.getAppConfig(t,i,n,e,s,r).then((function(t){u(It(It({},t),{retryCount:o.getAppConfigFailCount}))})).catch((function(e){var r;o.logger.error(W+" "+JSON.stringify(e)),!(-1<v.indexOf(e.code))&&(o.getAppConfigFailCount++,20008===e.code||1100002===e.code)&&o.getAppConfigFailCount<3?o.yt(t,i,n,s).then((function(t){return u(t)})).catch((function(t){return h(t)})):(r=o.getAppConfigFailCount,o.getAppConfigFailCount=0,h(It(It({},e),{retryCount:r})))})):o.logger.error(W+" userID or token must be string")}))},Ct.prototype.At=function(){var t=(new Date).getTime()-this.connectedTime;this.connectid&&this.eventManager.emit("disConnectedEvent",{duration:t,server:this.zegoLink.connectServer,connectid:this.connectid})},Ct.prototype.bt=function(t){this.logger.info(K+" ".concat(JSON.stringify(t.wss_groups))),(t=this.$t(t.wss_groups))&&Array.isArray(t)&&0<t.length?(this.Pt(),this.stateCenter.specified&&(this.logger.info(K+" specified"),t=this.specifiedServers),this.zegoLink.createSocket(t),this.Gt(!1,!0)):this.logger.warn(K+" wss_groups null")},Ct.prototype.It=function(t){var i=this;switch(this.logger.info(F+" ".concat(t.reason," ").concat(t.msg," ").concat(t.action)),t.action){case l.ACTION_DISPATCH:var n=this.reportSeq++;this.eventManager.emit("dispatchEvent",n,"start"),this.Rt().then((function(t){var e=t.servers;i.eventManager.emit("dispatchEvent",n,"end",{domains:t=t.domains,reason:"ConnectClosed"}),Array.isArray(e)&&0<e.length&&(i.eventManager.emit("dispatchResultUpdate",{servers:e,domains:t}),t=i.stateCenter.specified?i.specifiedServers:e,i.Pt(),i.zegoLink.createSocket(t),i.Gt(!1,!0))})).catch((function(t){i.logger.info(F+" dispatch fail")}));break;case l.ACTION_RETRY:this.Pt(),this.Gt(!1);break;case l.ACTION_NEXT_GROUP:this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken",m.CLOSE),this.Gt()}},Ct.prototype.Bt=function(){this.retryLinkHandler&&(this.zegoLink.isConnect()?this.retryLinkHandler.stopMaxTime():this.Gt())},Ct.prototype.zt=function(){this.Pt(),this.retryLinkHandler&&(this.retryLinkHandler.invalid(),this.retryLinkHandler.startMaxTime(),this.zegoLink.setState(0))},Ct.prototype.Gt=function(t,i){this.retryLinkHandler.active(t,i)&&this.xt()},Ct.prototype.xt=function(){var t=this.reportSeq++;this.connectSeq=t,this.eventManager.emit("connectedEvent",t,"start")},Ct.prototype.Pt=function(){this.logger.info("zn.zca.dc.1 call"),this.netAgentPCRequestMgr.closePCs(),this.eventManager.emit("broken"),2===this.lastLinkConnectState&&0===this.linkConnectState&&this.At()},Ct.prototype.getNetworkTimeInfo=function(){var t,i=Date.now()+this.stateCenter.timeOffset,n=Math.round(this.stateCenter.networkRTT/2),e=this.stateCenter.ntpTimeInfo;return e&&(t=performance.now()-e.performanceTime,i=Math.round(e.ntp+t)),{timestamp:i,maxDeviation:n}},Ct);function Ct(t){var i=this;this.proxyCtrl=t,this.vt=null,this.connectServers=[],this.specifiedServers=[],this.getAppConfigFailCount=0,this.getAppConfigTime=0,this.inited=!1,this.linkMsgMaxInterval=90,this.linkMsgCheckInterval=5,this.connectedTime=0,this.connectid="",this.reportSeq=0,this.connectSeq=0,this.defaultConnectServers=[],this.Ct=0,this.lastLinkConnectState=0,this.B=function(t,n){var e;i.linkConnectState=2,i.gt(),0===i.stateCenter.appInfo.env&&(e=i.reportSeq++,i.eventManager.emit("dispatchEvent",e,"start"),i.Rt().then((function(t){var n=t.servers;t=t.domains.map((function(t){return t.host})),i.eventManager.emit("dispatchEvent",e,"end",{domains:t}),0<n.length&&i.eventManager.emit("dispatchResultUpdate",{servers:n,domains:t})})).catch((function(t){})),i.Ot().then((function(t){i.eventManager.emit("svrAddrResultUpdate",{accesshub_domain:t.accesshub_domain,logreport_domain:t.logreport_domain,detaillog_domain:t.detaillog_domain,geofencing_id:t=t.geofencing_id})})).catch((function(t){}))),i.eventManager.emit("connected"),i.connectedTime=(new Date).getTime(),i.connectid=function(t){var i,n="0123456789".split(""),e=[];for(t=n.length,i=0;i<16;i++)e[i]=n[0|Math.random()*t];return e.join("")}(),i.eventManager.emit("connectedEvent",i.connectSeq,"end",{servers:t,count:t.length,connectid:i.connectid,connectEvents:n})},this.L=function(){i.logger.info("zn.zca.oce call"),i.linkConnectState=1},this.k=function(t){i.logger.info("zn.zca.ode"+" ".concat(t)),i.linkConnectState=0,t?(i.Pt(),i.netAgentPCRequestMgr.updateConnectState(a.BROKEN)):(i.eventManager.emit("disconnected"),i.netAgentPCRequestMgr.updateConnectState(a.DISCONNECT),i.At())},this.q=function(t,n,e,r){switch(n){case s.MSG_TYPE_REDIRECT:case s.MSG_TYPE_REDIRECT2:i.bt(e);break;case s.MSG_TYPE_CLOSE_CONNECTION:i.It(e);break;case s.MSG_TYPE_PC_BROKEN:case s.MSG_TYPE_PC_ESTABLISHED:case s.MSG_TYPE_PC_DOWNWARD_MESSAGE:case s.MSG_TYPE_PUSH_EXCEPTION:i.streamManager.onPushEvent(t,n,e,r);break;case s.MSG_TYPE_PUSH_APPCONFIG:i.businessRequestMgr.decodeConfigMessage(e.data)}}}function kt(t){this.Tt=t,this.streamID=1,this.httpStreams=[],this.pcStreams=[]}function zt(t,i,n){this.dt=t,this.St=i,this.Tt=n,this.isFree=!1,this.isFirst=!0}function Dt(t,i,n){this.M=t,this.J=i,this.rt=n,this.netHttpStream=this.J.createStream(h.HTTP)}function At(){}function Pt(){this.networkState=e.online,this.useNetAgent=!0,this.specified=!1,this.clientIP="",this.timeOffset=0,this.networkRTT=0,this.isDestroyed=!1}function Mt(t,i){this.M=t,this.U=i,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this._t=1,this.lt=0,this.Et=3,this.isOverTime=!1,this.RETRY_MAX_TIME=90}function Ut(t,i){this.J=t,this.M=i,this.pcStreamRequests=[],this.pcEstablishTimeout=lt.pcEstablishTimeout}function xt(t,i,n,e,s){this.M=t,this.rt=i,this.J=n,this.ct=e,this.ut=s,this.connectState=a.DISCONNECT,this.lastConnectState=a.DISCONNECT,this.brokenTimer=null,this.listenerList={connected:[],broken:[]},this.netPcStream=this.J.createStream(h.PC),this.eventManager=new vt,this.netPcStream.onPushEvent=this.onPushEvent.bind(this)}function Lt(){this.st={}}function jt(t,i,n){this.J=t,this.M=i,this.U=n,this.X=null,this.tt=5,this.nt=10,this.it=0,this.et=0}function qt(t,i,n,e){this.J=t,this.D=i,this.M=n,this.stateCenter=e}function Gt(t,i){this.proxyCtrl=i,this.A=null,this.ENV=t}}],u={},e.m=o,e.c=u,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"u",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.u)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var s in t)e.d(n,s,function(i){return t[i]}.bind(null,s));return n},e.n=function(t){var i=t&&t.u?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},e.p="",e(e.s=2))},function(t,i,n){var e;t.exports=(e=n(4),function(){var t,i;"function"==typeof ArrayBuffer&&(i=(t=e.lib.WordArray).init,(t.init=function(t){if((t=(t=t instanceof ArrayBuffer?new Uint8Array(t):t)instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t)instanceof Uint8Array){for(var n=t.byteLength,e=[],s=0;s<n;s++)e[s>>>2]|=t[s]<<24-s%4*8;i.call(this,e,n)}else i.apply(this,arguments)}).prototype=t)}(),e.lib.WordArray)},function(t,i,n){t.exports=function(t){for(var i=Math,n=t,e=n.lib,s=e.WordArray,r=e.Hasher,o=n.algo,u=[],h=0;h<64;h++)u[h]=4294967296*i.abs(i.sin(h+1))|0;var c=o.MD5=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,i){for(var n=0;n<16;n++){var e=i+n,s=t[e];t[e]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var r=this._hash.words,o=t[i+0],h=t[i+1],c=t[i+2],d=t[i+3],m=t[i+4],v=t[i+5],p=t[i+6],g=t[i+7],b=t[i+8],E=t[i+9],S=t[i+10],R=t[i+11],y=t[i+12],O=t[i+13],T=t[i+14],w=t[i+15],I=r[0],N=r[1],C=r[2],k=r[3];I=a(I,N,C,k,o,7,u[0]),k=a(k,I,N,C,h,12,u[1]),C=a(C,k,I,N,c,17,u[2]),N=a(N,C,k,I,d,22,u[3]),I=a(I,N,C,k,m,7,u[4]),k=a(k,I,N,C,v,12,u[5]),C=a(C,k,I,N,p,17,u[6]),N=a(N,C,k,I,g,22,u[7]),I=a(I,N,C,k,b,7,u[8]),k=a(k,I,N,C,E,12,u[9]),C=a(C,k,I,N,S,17,u[10]),N=a(N,C,k,I,R,22,u[11]),I=a(I,N,C,k,y,7,u[12]),k=a(k,I,N,C,O,12,u[13]),C=a(C,k,I,N,T,17,u[14]),I=l(I,N=a(N,C,k,I,w,22,u[15]),C,k,h,5,u[16]),k=l(k,I,N,C,p,9,u[17]),C=l(C,k,I,N,R,14,u[18]),N=l(N,C,k,I,o,20,u[19]),I=l(I,N,C,k,v,5,u[20]),k=l(k,I,N,C,S,9,u[21]),C=l(C,k,I,N,w,14,u[22]),N=l(N,C,k,I,m,20,u[23]),I=l(I,N,C,k,E,5,u[24]),k=l(k,I,N,C,T,9,u[25]),C=l(C,k,I,N,d,14,u[26]),N=l(N,C,k,I,b,20,u[27]),I=l(I,N,C,k,O,5,u[28]),k=l(k,I,N,C,c,9,u[29]),C=l(C,k,I,N,g,14,u[30]),I=f(I,N=l(N,C,k,I,y,20,u[31]),C,k,v,4,u[32]),k=f(k,I,N,C,b,11,u[33]),C=f(C,k,I,N,R,16,u[34]),N=f(N,C,k,I,T,23,u[35]),I=f(I,N,C,k,h,4,u[36]),k=f(k,I,N,C,m,11,u[37]),C=f(C,k,I,N,g,16,u[38]),N=f(N,C,k,I,S,23,u[39]),I=f(I,N,C,k,O,4,u[40]),k=f(k,I,N,C,o,11,u[41]),C=f(C,k,I,N,d,16,u[42]),N=f(N,C,k,I,p,23,u[43]),I=f(I,N,C,k,E,4,u[44]),k=f(k,I,N,C,y,11,u[45]),C=f(C,k,I,N,w,16,u[46]),I=_(I,N=f(N,C,k,I,c,23,u[47]),C,k,o,6,u[48]),k=_(k,I,N,C,g,10,u[49]),C=_(C,k,I,N,T,15,u[50]),N=_(N,C,k,I,v,21,u[51]),I=_(I,N,C,k,y,6,u[52]),k=_(k,I,N,C,d,10,u[53]),C=_(C,k,I,N,S,15,u[54]),N=_(N,C,k,I,h,21,u[55]),I=_(I,N,C,k,b,6,u[56]),k=_(k,I,N,C,w,10,u[57]),C=_(C,k,I,N,p,15,u[58]),N=_(N,C,k,I,O,21,u[59]),I=_(I,N,C,k,m,6,u[60]),k=_(k,I,N,C,R,10,u[61]),C=_(C,k,I,N,c,15,u[62]),N=_(N,C,k,I,E,21,u[63]),r[0]=r[0]+I|0,r[1]=r[1]+N|0,r[2]=r[2]+C|0,r[3]=r[3]+k|0},_doFinalize:function(){var t=this._data,n=t.words,e=8*this._nDataBytes,s=8*t.sigBytes;n[s>>>5]|=128<<24-s%32;var r=i.floor(e/4294967296),o=e;n[15+(s+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),n[14+(s+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process();for(var u=this._hash,h=u.words,c=0;c<4;c++){var a=h[c];h[c]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return u},clone:function(){var t=r.clone.call(this);return t._hash=this._hash.clone(),t}});function a(t,i,n,e,s,r,o){var u=t+(i&n|~i&e)+s+o;return(u<<r|u>>>32-r)+i}function l(t,i,n,e,s,r,o){var u=t+(i&e|n&~e)+s+o;return(u<<r|u>>>32-r)+i}function f(t,i,n,e,s,r,o){var u=t+(i^n^e)+s+o;return(u<<r|u>>>32-r)+i}function _(t,i,n,e,s,r,o){var u=t+(n^(i|~e))+s+o;return(u<<r|u>>>32-r)+i}return n.MD5=r._createHelper(c),n.HmacMD5=r._createHmacHelper(c),t.MD5}(n(4))},function(t,i){var n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,i){},function(t,i,n){"use strict";n.r(i),n.d(i,"ZegoExpressWebRTMEngine",(function(){return Jn})),n.d(i,"getReportSeq",(function(){return d})),n.d(i,"getSeq",(function(){return _})),n.d(i,"ZegoLogger",(function(){return s.ZegoLogger})),n.d(i,"ZegoDataReport",(function(){return s.ZegoDataReport})),n.d(i,"ZegoExpressWebRTM",(function(){return qn})),n.d(i,"BusinessService",(function(){return y})),n.d(i,"NetConnection",(function(){return I})),n.d(i,"ZReporter",(function(){return Vn})),n.d(i,"getUserAgent",(function(){return bn})),n.d(i,"isIos",(function(){return En})),n.d(i,"isMacOs",(function(){return Sn})),n.d(i,"isAndroid",(function(){return Rn})),n.d(i,"isWindows",(function(){return yn})),n.d(i,"isWin32",(function(){return On})),n.d(i,"isLinux",(function(){return Tn})),n.d(i,"getOsType",(function(){return wn})),n.d(i,"getNetTypeNum",(function(){return In}));var e,s=n(2);(i=e=e||{})[i.SWITCH_ONE=1]="SWITCH_ONE",i[i.SWITCH_TWO=2]="SWITCH_TWO";var r,o,u,h,c,a,l,f,_=((i=r=r||{})[i.TT_NONE=0]="TT_NONE",i[i.TT_PC=1]="TT_PC",i[i.TT_IOS=2]="TT_IOS",i[i.TT_ANDROID=3]="TT_ANDROID",i[i.TT_MAC=4]="TT_MAC",i[i.TT_LINUX=5]="TT_LINUX",i[i.TT_WEB=6]="TT_WEB",i[i.TT_MINIPROGRAM=7]="TT_MINIPROGRAM",i[i.TT_UNKNOWN=32]="TT_UNKNOWN",(i=o=o||{})[i.logout=0]="logout",i[i.trylogin=1]="trylogin",i[i.login=2]="login",(i=u=u||{})[i.I=0]="I",i[i.H=10]="H",i[i.M=100]="M",i[i.L=1e3]="L",(i=h=h||{})[i.offline=0]="offline",i[i.online=1]="online",(i=c=c||{})[i.NT_NONE=0]="NT_NONE",i[i.NT_LINE=1]="NT_LINE",i[i.NT_WIFI=2]="NT_WIFI",i[i.NT_2G=3]="NT_2G",i[i.NT_3G=4]="NT_3G",i[i.NT_4G=5]="NT_4G",i[i.NT_UNKNOWN=32]="NT_UNKNOWN",(i=a=a||{}).WIN32="WIN32",i.MAC="Mac",i.ANDROID="Android",i.LINUX="Linux",i.IOS="iOS",i.UNKNOWN="WTF",function(){return l++}),d=(f=l=1,function(){return f++}),m=(Object.defineProperty(v.prototype,"id",{get:function(){return this._id||null},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),v.prototype.hasNext=function(){return this.next&&this.next.id},v.prototype.hasPrev=function(){return this.prev&&this.prev.id},v);function v(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.next=null,this.prev=null,this._id=t,this._data=i}g.prototype.insertBefore=function(t,i){return(i=new m(this._idCounter,i)).next=t,i.prev=t.prev,t.prev&&(t.prev.next=i),t.prev=i,++this._idCounter,++this._numNodes,i},g.prototype.addLast=function(t){return this.insertBefore(this.end,t)},g.prototype.add=function(t){return this.addLast(t)},g.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},g.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},g.prototype.size=function(){return this._numNodes},g.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(0<=t)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},g.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},g.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._numNodes,t},g.prototype.removeFirst=function(){var t=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):t},g.prototype.removeLast=function(){var t=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):t},g.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},g.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},g.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},g.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},g.prototype.push=function(t){return this.addLast(t)},g.prototype.unshift=function(t){this.insertBefore(0<this._numNodes?this.start.next:this.end,t)},g.prototype.pop=function(){return this.removeLast()},g.prototype.shift=function(){return this.removeFirst()};var p=g;function g(){this.start=new m,this.end=new m,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}var b,E,S,R,y,O,T="",w=n(5).ZegoConnectionAgent,I=(Object.defineProperty(N.prototype,"clientIP",{get:function(){var t;return(null==(t=this.connection)?void 0:t.clientIP)||""},enumerable:!1,configurable:!0}),Object.defineProperty(N.prototype,"timeOffset",{get:function(){var t;return null==(t=this.connection)?void 0:t.timeOffset},enumerable:!1,configurable:!0}),N.prototype.init=function(){var t;null!=(t=this.connection)&&t.init()},N.prototype.unInit=function(){var t;null!=(t=this.connection)&&t.unInit()},N.prototype.setAppInfo=function(t){var i;null!=(i=this.connection)&&i.setAppInfo(t)},N.prototype.setUserInfo=function(t){var i;null!=(i=this.connection)&&i.setUserInfo(t)},N.prototype.setNetAgentDefaultServers=function(t){var i;null!=(i=this.connection)&&i.setNetAgentDefaultServers(t)},N.prototype.setBackupDomains=function(t){var i;null!=(i=this.connection)&&i.setBackupDomains(t)},N.prototype.setDispatchConnectServers=function(t){var i;null!=(i=this.connection)&&i.setDispatchConnectServers(t)},N.prototype.setNetAgentSpecifiedServers=function(t){var i;null!=(i=this.connection)&&i.setNetAgentSpecifiedServers(t)},N.prototype.startHttpRequest=function(t,i,n,e,s){var r;null!=(r=this.connection)&&r.startHttpRequest(t,i,n,e,s)},N.prototype.startHttpRequest2=function(t,i,n,e,s){var r;null!=(r=this.connection)&&r.startHttpRequest2(t,i,n,e,s)},N.prototype.getAppConfigByAgent=function(t,i,n,e,s){var r;return null==(r=this.connection)?void 0:r.getAppConfigByAgent(t,i,n,e,s)},N.prototype.getPCRequest=function(t,i){var n;return(null==(n=this.connection)?void 0:n.getPCRequest(t,i))||null},N.prototype.connectUa=function(){var t;null!=(t=this.connection)&&t.connectUa()},N.prototype.destroyConnect=function(){var t;null!=(t=this.connection)&&t.destroyConnect()},N.prototype.destroy=function(){var t;null!=(t=this.connection)&&t.destroy()},N.prototype.isConnect=function(){return!!this.connection&&this.connection.isConnect()},N.prototype.on=function(t,i){var n;return(null==(n=this.connection)?void 0:n.on(t,i))||!0},N.prototype.off=function(t,i){var n;return null==(n=this.connection)?void 0:n.off(t,i)},N.prototype.setLogger=function(t){var i;return null==(i=this.connection)?void 0:i.setLogger(t)},N.prototype.setAccess=function(t){var i;return null==(i=this.connection)?void 0:i.setAccess(t)},N.prototype.getNTP=function(){return{timestamp:0,maxDeviation:0}},N);function N(){this.connection=null,this.isLoad=!1,this.callBackList=[],this.connection=new w}(i=b=b||{})[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL",(i=E=E||{})[i.EMPTY=0]="EMPTY",i[i.CLOSE=1]="CLOSE",(i=S=S||{})[i.Mode_UNSET=0]="Mode_UNSET",i[i.MODE_ONLINE=1]="MODE_ONLINE",i[i.MODE_TEST=2]="MODE_TEST",i[i.MODE_ALPHA=3]="MODE_ALPHA",(i=R=R||{})[i.CLOSE=0]="CLOSE",i[i.TEMP=1]="TEMP",i[i.TIMEOUT=2]="TIMEOUT",(i=y=y||{})[i.SERVICE_UNSET=0]="SERVICE_UNSET",i[i.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",i[i.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",i[i.SERVICE_MIX=3]="SERVICE_MIX",i[i.SERVICE_ZEUS=4]="SERVICE_ZEUS",i[i.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",i[i.SERVICE_L3=6]="SERVICE_L3",i[i.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",i[i.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",i[i.SERVICE_ZIM=9]="SERVICE_ZIM",i[i.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",i[i.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",i[i.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",i[i.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",i[i.SERVICE_QUALITY=14]="SERVICE_QUALITY",i[i.SERVICE_SECURITY=15]="SERVICE_SECURITY",i[i.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",i[i.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",i[i.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",i[i.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",i[i.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",i[i.SERVICE_CDN=21]="SERVICE_CDN",i[i.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",i[i.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",i[i.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",i[i.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",i[i.SERVICE_ECHO=26]="SERVICE_ECHO",i[i.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",i[i.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(i=O=O||{}).Logining="LOGINING",i.Logined="LOGINED",i.LoginFailed="LOGIN_FAILED",i.Reconnecting="RECONNECTING",i.Reconnected="RECONNECTED",i.ReconnectFailed="RECONNECT_FAILED",i.Kickout="KICKOUT",i.Logout="LOGOUT",i.LogoutFailed="LOGOUT_FAILED";var C={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},SDK_NOT_SPECIAL:{code:1001005,msg:"sdk require special"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},GEO_SET_ERROR:{code:1000018,msg:"geo set error"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_EXTRA_INFO_KEY_LIMIT:{code:1002017,msg:"room extra info key exceed the limit"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},FORBID_BLACK_USER:{code:1002066,msg:"forbid black user"},WHITE_BOARD_VERSION_ERROR:{code:1002098,msg:"Mismatch with RTC SDK version, please upgrade ZegoSuperBoard or ZegoWhiteboardView SDK to the latest version"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},UPLOAD_LOG_ERROR:{code:1102025,msg:"upload zip logs failed"}},k=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];function z(t,i){try{wx.setStorageSync(t,i)}catch(t){}}function D(t){try{return wx.getStorageSync(t)}catch(t){}}var A=n(0),P=function(){return(P=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},M="TOKEN_ERROR",U="MULTIPLE_LOGIN_KICKOUT",x="TOKEN_EXPIRED",L="ROOM_INNER_ERROR";function j(t,i){return 0==i?Object(A.d)(t)&&t%1==0&&0<=t:Object(A.d)(t)&&t%1==0&&0<t}function q(t,i,n){i.success&&(n[t+"SuccessCallback"]=i.success),i.error&&(n[t+"ErrorCallback"]=i.error)}function G(t,i){return i[t+"ErrorCallback"]}function H(t,i){return i[t+"SuccessCallback"]}function B(t,i,n,e){q(t,{success:function(t,e){for(var s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];var o=i,u=n,h=e,c=s;switch(t){case"eventStart":o.eventStart(u,h);break;case"eventEndWithMsgInfo":o.eventEndWithMsgInfo(u,h,c[0]);break;case"addEventMsg":o.addEventMsg(u,h,c[0],c[1]);break;case"addEvent":o.addEvent(u,h);break;case"eventEnd":o.eventEnd(u,h);break;case"addMsgInfo":o.addMsgInfo(u,c[0])}}},e)}function V(t,i){var n={code:-1,message:"server error"};return n.code=1e9<t?t-1e9+52e6:t+2002e6,i&&(n.message=i),n}function $(t,i,n,e){return{interResolve:function(e){t.uploadReport(i),n(e)},interReject:function(n,s){var r;void 0===s&&(s=""),(r=n.code<2e9&&1e9<n.code?V(n.code,n.msg):{code:n.code,message:n.msg})&&t.addMsgInfo(i,{error:r.code,message:r.message+s}),t.uploadReport(i),e({errorCode:n.code||n.errorCode})}}}function J(t){var i,n,e={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};return 0===t?C.SUCCESS:((i=P({},C.ROOM_INNER_ERROR)).code=t,i.msg=1e9<t?(n=e[t])?"liveroom cmd error, code: "+t+", message: "+n:e[1e9]+t:e[t]?e[t]+" code:"+t:"unknown error code:"+t,i)}function Y(t,i){delete i[t+"SuccessCallback"],delete i[t+"ErrorCallback"]}function X(t){var i={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:M,2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:M,5022:"ROOM_COUNT_EXCEED",5030:"FORBID_BLACK_USER"};return 2e5<t&&t<3e5?i[t-2e5]:t<2e5?{50013:U,50116:M,50117:x,50118:M,50119:M,50120:M,50121:M,50122:M,50123:x,50124:M,50125:M,50126:M,50127:M,50128:M}[t]||i[t]||L:i[t]||L}function W(t){return parseInt(Math.random()*(t+1)+"",10)}function K(t){return!(!t.startsWith("wss")||-1===t.indexOf("test")||!t.endsWith("ws"))}function F(t){try{var i,n=Uint8Array.from(function(t){for(var i,n,e,s,r=t.length,o=0,u="";o<r;){for(;i=k[255&t.charCodeAt(o++)],o<r&&-1==i;);if(-1==i)break;for(;n=k[255&t.charCodeAt(o++)],o<r&&-1==n;);if(-1==n)break;u+=String.fromCharCode(i<<2|(48&n)>>4);do{if(61==(e=255&t.charCodeAt(o++)))return u}while(e=k[e],o<r&&-1==e);if(-1==e)break;u+=String.fromCharCode((15&n)<<4|(60&e)>>2);do{if(61==(s=255&t.charCodeAt(o++)))return u}while(s=k[s],o<r&&-1==s);if(-1==s)break;u+=String.fromCharCode((3&e)<<6|s)}return u}(t),(function(t){return t.charCodeAt(0)})),e=new DataView(n.buffer);return 0<(i=Object(A.c)(e.getBigInt64)?e.getBigUint64(0):(u=(o=e).getUint32(s=0,r=!1),o=o.getUint32(s+4,r),s=Math.pow(2,32)*u+o,Number.isSafeInteger(s)||console.warn(s,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),s))?Number(i):Number(e.getBigUint64(0,!0))}catch(t){console.error("token error")}var s,r,o,u;return-1}function Z(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==i?n:3&n|8).toString(36)}))}var Q=["accesshub-wss.zego.im","accesshub-wss.coolzcloud.com","accesshub-wss.zegocloud.com"];function tt(t,i){this.qt=t,this.jt=i,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this._retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}function it(t){return t}function nt(t){return t}function et(t){return t}function st(t){return t}tt.prototype.init=function(t,i,n,e){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,Object(A.d)(t)&&t<3600&&(this.RETRY_MAX_TIME=t),Object(A.d)(i)&&(this.RETRY_START_TIME_INTERVAL=i),Object(A.d)(n)&&(this.RETRY_CONTINUE_COUNT=n),Object(A.d)(e)&&(this.RETRY_MAX_TIME_INTERVAL=e)},tt.prototype.invalid=function(){this.qt.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this._retryStartTime=0,this.retryActiveCount=1};var rt="zm.0",ot="zm.slf",ut="zm.lg",ht="zm.lo",ct="zm.fac",at="zm.hlu",lt="zm.cna",ft="zm.on",_t="zm.rntk",dt="zm.rm.lg",mt="zm.rm.tl",vt="zm.rm.lgr",pt="zm.rm.clh",gt="zm.rm.lo",bt="zm.rm.rr",Et="zm.rm.dcn",St="zm.rm.kco",Rt="zm.hhl",yt="zm.hb.st",Ot="zm.hb.rsp",Tt="zm.us.ftu",wt="zm.us.urp",It="zm.us.uph",Nt="zm.us.mg",Ct="ON_LISTENER",kt="zm.st.ofls",zt="zm.lrh.sm",Dt="zm.lrh.hp",At="zm.lrh.hsp",Pt="zm.lrh.gs",Mt="zm.lrh.lgi",Ut="zm.lrh.ful",xt="zm.lrh.lgo",Lt="zm.lrh.sru",jt="zm.lrh.hd",qt="zm.lrh.hb",Gt="zm.nt.od",Ht={event:"/sdk/init",error:{kInvalidParamError:C.INPUT_PARAM},system_info:nt,servers:function(t){return t},is_from_cache:st,project:nt,liveroom_version:nt,biz_type:et,lua_md5:nt,sev_env:nt,use_na:et},Bt="listener",Vt="/sdk/set_debug",$t=nt,Jt={event:"/sdk/set_log_config",error:{kInvalidParamError:C.INPUT_PARAM},log_level:function(t){return t},remote_log_level:nt,log_url:nt},Yt={event:"/sdk/on_listener",listener:nt,error:{INPUT_PARAM:C.INPUT_PARAM}},Xt=nt,Wt={event:"/sdk/login",room_id:nt,room_sid_string:nt,user_state_update:et,max_member_cnt:et,message:nt,token:nt,svr_env:nt,server:nt,try_cnt:et,room_mode:et,role:et,audience_create_room:et,liveroom_sid_string:nt,error:{ROOM_ID_NULL:C.ROOM_ID_NULL,INPUT_PARAM:C.INPUT_PARAM,ROOM_ID_TOO_LONG:C.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:C.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:C.USER_ID_NULL,USER_ID_TOO_LONG:C.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:C.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:C.USER_NAME_NULL,USER_NAME_TOO_LONG:C.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:C.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:C.LOGIN_TIMEOUT,INNER_ERROR:C.ROOM_INNER_ERROR,NETWORK_BROKEN:C.NETWORK_BROKEN}},Kt="/sdk/sublogin",Ft=nt,Zt={event:"/zpush/login",sdk_zpush_sessionid_string:nt},Qt={event:"/liveroom/enter"},ti={event:"/sdk/renew_token",error:{INPUT_PARAM:C.INPUT_PARAM,NOT_LOGIN:C.NOT_LOGIN},token:nt},ii={event:"/sdk/logout",error:{INPUT_PARAM:C.INPUT_PARAM,ROOM_NOT_EXIST:C.ROOM_NOT_EXIST},room_id:nt,room_sid_string:nt,is_multi:st,is_send_cmd_net:st,liveroom_sid_string:nt},ni="/liveroom/quit",ei=nt,si=nt,ri="/sdk/relogin",oi={event:"/liveroom/tempbroken"},ui={event:"/sdk/reconnect",room_broken_time:et},hi={event:"/sdk/disconnect",valid_d:et,total_d:et,tempbroken_cnt:et},ci=et,ai=et,li={event:"/liveroom/hb",room_id:nt,room_sid_string:nt,interval:et,stream_seq:et,server_user_seq:et,error:{NOT_LOGIN:C.NOT_LOGIN,HB_TIMEOUT:C.TIMEOUT}},fi="/sdk/listener",_i={event:"/sdk/enable_multi_room",is_multi:st,error:{kInvalidParamError:C.INPUT_PARAM,kAlreadyLoginError:C.ALREADY_LOGIN}},di={event:"/liveroom/get_current_user_list",user_index:et,is_time_ascend:st,use_na:et},mi="/zegoconn/connect",vi=nt,pi=et,gi=it,bi=nt,Ei=nt,Si=et,Ri="/zegoconn/request",yi=it,Oi=it,Ti=et,wi={event:"/zegoconn/proxy_connect",service_no:et,proxy_link_sources:et,recv_time:et,connect_stream:et},Ii={event:"/zegoconn/proxy_broken",service_no:et},Ni={event:"/zegoconn/proxy_disconnect",service_no:et};Ci=function(t,i){return(Ci=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,i){t.__proto__=i}:function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}))(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}Ci(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}(Ai,ki=tt),Object.defineProperty(Ai.prototype,"Jt",{get:function(){return this.jt.reporter},enumerable:!1,configurable:!0}),Ai.prototype.renewLocalToken=function(t,i){this.token=t,this._room.token=this.token;var n=(new Date).getTime(),e=void 0;i&&Object(A.d)(i)?e=1e3*i:Object(A.f)(t)&&["03","04"].includes(t.substring(0,2))&&(i=1e3*F(t.substring(2)),this.qt.info("zm.rm.rlt time "+i+" "+n+" "+this.jt.local_time_deviation),e=i-(n-this.jt.local_time_deviation)),e&&this.roomHandler.resetTokenTimer(e),this.qt.setTokenInfo(t),this.jt.actionListener("_tokenRenewed",t,this._room.roomID)},Ai.prototype.initRoom=function(t,i,n,e,s,r,o){this.roomHandler=t,this.roomID=i,this.renewLocalToken(n),this.user=e,this.server=s,this.serverBak=r||s,this.config=o},Ai.prototype.active=function(t){var i=this,n=(this.qt.info(dt+" retry call "+(null==(n=this._room)?void 0:n.roomID)+" "+(t=void 0!==t&&t)),null!=(n=this.loginRoomCallback)&&n.success?Kt:ri);if(this.subLoginSpan||(this.subLoginSpan=this.Jt.createSpan(u.H,{key:Wt.event,par:this.roomID},{key:n,par:this.roomID},n,!0),this.spanKey=n),this.roomHandler.setRunState(o.trylogin),this._room.isMulti&&(null==(n=this.jt.roomModulesList.find((function(t){return!t.isMulti})))?void 0:n.runState)!==o.login)this.qt.info(dt+" service is disconnected, multi room stop retry");else if(this.retryTimer)this.qt.info(dt+" has actived, ignore");else{var e=this.jt.networkState==h.offline;if(e){if(this.qt.info(dt+" check if really offline. "+this._retryNetCount),this._retryNetCount>=this._retryNetMaxTimes)return void this.qt.warn(dt+" network is broken, stop retry")}else this._retryNetCount=0;this.isOverTime?this.qt.info(dt+" retry over time, stop retry"):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(n=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=n>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:n),this.qt.info(dt+" interval "+this.retryActiveInterval),wx.getNetworkType({success:function(t){z("netType",t.networkType.toLowerCase())}}),this.retryTimer=setTimeout((function(){i.roomHandler.login(i.retryActiveCount%2==1?i.server:i.serverBak,i.roomID,i.token,i.user,i.config,(function(t){i.jt.networkState=h.online,i.handleLoginFinish(t)}),(function(t,n){i.handleLoginFinish(!1,t,n)})),i.retryTimer&&clearTimeout(i.retryTimer),i.retryTimer=null,e?i._retryNetCount++:i.retryActiveCount++}),t?0:1e3*this.retryActiveInterval))}},Ai.prototype.startMaxTime=function(){var t=this;this.maxTimer||(this.qt.info(dt+" start max timer"),0===this.activeStartTime&&(this.activeStartTime=(new Date).getTime()),this.maxTimer=setTimeout((function(){var i;t.qt.info(dt+" over max time ".concat(t.RETRY_MAX_TIME,"s, stop retry")),t.isOverTime=!0,t.roomHandler.resetRoom(),0!==t.activeStartTime&&(i=0<(i=(new Date).getTime()-t.activeStartTime)?i:void 0),t.stopMaxTime(),t.invalid(),t.onactive(!1,C.LOGIN_TIMEOUT),t.subLoginSpan&&(t.Jt.spanEnd({key:t.spanKey,par:t.roomID},{error:C.LOGIN_TIMEOUT.code,message:C.LOGIN_TIMEOUT.msg,try_time:i}),t.subLoginSpan=null),t.loginRoomCallback.fail&&(t.loginRoomCallback.fail(C.LOGIN_TIMEOUT),t.roomHandler.disconnectedHandle(C.LOGIN_TIMEOUT),t.resetCallBack())}),1e3*this.RETRY_MAX_TIME))},Ai.prototype.stopMaxTime=function(){this.qt.info(dt+" stop max timer"),0!==this.activeStartTime&&(this.activeStartTime=0),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},Ai.prototype.onactive=function(t,i){},Ai.prototype.handleError=function(t,i){if(this.RETRY_MAX_TIME<3)return!1;if(i){i=void 0;var n=void 0,e=void 0,s=(this.jt.useNetAgent&&(i=["202002","205030","205035","50116","50117","50118","50119","50120","50121","50122","50123","50124","50125","50126","50127","50128","50013"],n=["40001","40100"],e=["201002","30019"]),t.code+"");if(this.jt.useNetAgent){if(10015===t.code)return this._room.retryConnect(),!0;if(40001<=t.code&&t.code<=40100||50200<=t.code&&t.code<=50299||null!=e&&e.includes(s))return this._room.resetSessionInfo(),!0}return!(null!=i&&i.includes(s)||(null==n||!n.includes(s))&&(this._room.lastRunState!=o.login||(this.qt.warn("zm.rrh.he reset"),this._room.resetUserSession(),this.invalid(),0)))}return!0},Ai.prototype.setLoginRoomCallback=function(t,i){this.loginRoomCallback.success=t,this.loginRoomCallback.fail=i},Ai.prototype.loginFail=function(t){this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(!1,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.roomHandler.disconnectedHandle(t),this.resetCallBack())},Ai.prototype.handleLoginFinish=function(t,i,n){var e;this.qt.info("zm.rrh.hlf "+t+" "+JSON.stringify(i)),i?(this.subLoginSpan&&(e=void 0,0!==this.activeStartTime&&(e=0<(e=(new Date).getTime()-this.activeStartTime)?e:void 0),this.Jt.spanEnd({key:this.spanKey,par:this.roomID},{error:i.code,message:i.msg,try_time:e}),this.subLoginSpan=null),this.handleError(i,n)?(this.maxTimer||this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(t,i),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(i),this.roomHandler.disconnectedHandle(i),this.resetCallBack()))):(e=void 0,0!==this.activeStartTime&&(e=0<(e=(new Date).getTime()-this.activeStartTime)?e:void 0),this.stopMaxTime(),this.invalid(),this.onactive(t,{code:0,msg:""}),this.subLoginSpan&&(this.Jt.spanEnd({key:this.spanKey,par:this.roomID},{room_id:this.roomID,room_sid_string:null==(n=this._room)?void 0:n.roomSidString,try_time:e}),this.subLoginSpan=null),this.loginRoomCallback.success&&(this.loginRoomCallback.success(t),this.resetCallBack()))},Ai.prototype.invalid=function(){this.qt.info("zm.rh.ivd end retry"),this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryActiveCount=1,this._retryNetCount=0},Ai.prototype.resetCallBack=function(){this.loginRoomCallback.success=void 0,this.loginRoomCallback.fail=void 0};var Ci,ki,zi,Di=Ai;function Ai(t,i,n){var e=ki.call(this,t,i)||this;return e.qt=t,e.jt=i,e._room=n,e.activeStartTime=0,e._retryNetCount=0,e._retryNetMaxTimes=3,e.spanKey="",e.loginRoomCallback={},e}(i=zi=zi||{}).NOT_EMPTY="NOT_EMPTY",i.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",i.TYPE_STRING="TYPE_STRING",i.TYPE_INTEGER="TYPE_INTEGER",i.TYPE_OBJECT="TYPE_OBJECT",i.MAX_LENGTH_10="MAX_LENGTH_10",i.MAX_LENGTH_64="MAX_LENGTH_64",i.MAX_LENGTH_100="MAX_LENGTH_100",i.MAX_LENGTH_128="MAX_LENGTH_128",i.MAX_LENGTH_256="MAX_LENGTH_256",i.MAX_LENGTH_1024="MAX_LENGTH_1024";var Pi={error:{code:0,msg:"suc"}},Mi={NOT_EMPTY:function(t,i,n,e,s){return void 0===i||""===i||null===i?(e.error("".concat(n," ").concat(t," is empty")),s):Pi},ILLEGAL_CHARACTERS:function(t,i,n,e,s){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(i)&&/^[^:/]*$/g.test(i)?Pi:(e.error("".concat(n," ").concat(t," contains illegal characters")),s)},TYPE_STRING:function(t,i,n,e,s){return Object(A.f)(i)?Pi:(e.error("".concat(n," ").concat(t," must be string")),s)},TYPE_INTEGER:function(t,i,n,e,s){return j(i,!1)?Pi:(e.error("".concat(n," ").concat(t,"  must be integer number")),s)},TYPE_OBJECT:function(t,i,n,e,s){return i&&Object(A.e)(i)?Pi:(e.error("".concat(n," ").concat(t,"  must be object")),s)},MAX_LENGTH_10:function(t,i,n,e,s){return 10<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_64:function(t,i,n,e,s){return 64<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_100:function(t,i,n,e,s){return 100<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_128:function(t,i,n,e,s){return 128<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_256:function(t,i,n,e,s){return 256<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi},MAX_LENGTH_1024:function(t,i,n,e,s){return 1024<i.length?(e.error("".concat(n," ").concat(t," is too long")),s):Pi}};Object.defineProperty(xi.prototype,"debug",{get:function(){return this._debug},set:function(t){this._debug=t,s.LoggerStateCenter.getInstance().debug=t},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(t){this._testEnvironment=t,s.LoggerStateCenter.getInstance().testEnvironment=t},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"ENV",{get:function(){return this._env},set:function(t){this._env=t,s.LoggerStateCenter.getInstance().ENV=t},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(xi.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),xi.prototype.getRequestId=function(){return this.idName+"-"+_()},xi.prototype.actionListener=function(t){for(var i,n=this,e=[],s=1;s<arguments.length;s++)e[s-1]=arguments[s];["getAnchorInfo","HBResponse","roomOnlineUserCountUpdate","roomLoginResponse"].includes(t)||t.startsWith("_")||!this.listenerList[t]||((i=this.reporter.createSpan(u.H,{key:Bt},{key:""},fi)).setAttributes({listener:t,listener_params:JSON.stringify(e)}),i.end()),["roomStateChanged","tokenWillExpire"].includes(t)&&this.qt.info("zm.al ".concat(t," ").concat(JSON.stringify(e),". pageID: ").concat(qn.pageID," , instID: ").concat(this.id)),this.listenerList[t]&&this.listenerList[t].forEach((function(i){try{i.apply(void 0,e)}catch(i){n.qt.error("zm.st.at ",t," ",JSON.stringify(i))}}))},xi.prototype.onListener=function(t,i){return this.listenerList[t]?Object(A.c)(i)?(-1==this.listenerList[t].indexOf(i)&&this.listenerList[t].push(i),!0):(this.qt.error(Ct+" listener callBack must be funciton"),!1):(this.qt.error(Ct+" event "+t+" no found"),!1)},xi.prototype.offListener=function(t,i){return this.listenerList[t]?Object(A.c)(i)?(-1!==this.listenerList[t].indexOf(i)&&(this.listenerList[t]=this.listenerList[t].filter((function(t){return t!==i}))),!0):(this.qt.error(kt+" listener callBack must be funciton"),!1):(this.qt.error(kt+" event "+t+" no found"),!1)},Object.defineProperty(xi.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(t){this._sdkVersion=t},enumerable:!1,configurable:!0}),xi.prototype.proxyRes=function(t,i,n){return{interResolve:function(n){i(n),t.end()},interReject:function(i,e){var s;void 0===e&&(e=""),(s=i.code<2e9&&1e9<i.code?V(i.code,i.msg):{code:i.code,message:i.msg})&&t.setAttributes({error:s.code,message:s.message+e}),t.end(),n({errorCode:i.code})}}};var Ui=xi;function xi(t,i){this.qt=t,this._dataReport=i,this.id="",this._debug=!1,this.appConfigEtag=-1,this.appConfigFetched=!1,this.requestList={},this.mode=S.MODE_ONLINE,this.connectState="connected",this.testNetPackageSize=!1,this.netGeoFencing={},this.svrDomains={},this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],_netAppConfigRsp:[],_connectChanged:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],roomStateChanged:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=h.online,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.useNetAgent=!0,this.netHasSet=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown"}Object.defineProperty(ji.prototype,"Jt",{get:function(){return this.jt.reporter},enumerable:!1,configurable:!0}),ji.prototype.init=function(t){var i=this,n=t.body.hearbeat_interval<3e3?3e3:t.body.hearbeat_interval;this._tryHeartbeatCount=0,this._heartbeatTimer&&clearTimeout(this._heartbeatTimer),this._loginHeartbeatTimer=setTimeout((function(){i.start(n)}),n),this.initCount++},ji.prototype.start=function(t){var i,n=this,e=(this.qt.info(yt+" call"),this.Jt.createSpan(u.H,{key:Wt.event,par:this._room.roomID},{key:""},li.event));this._room.isLogin()?3<++this._tryHeartbeatCount?(this.qt.error(yt+" come to try limit"),this.Jt.setError(e,li.error.HB_TIMEOUT),this.hbLogout(C.HEARTBEAT_TIMEOUT),this.Jt.createSpan(u.H,{key:Wt.event,par:this._room.roomID},{key:""},"/zpush/hb_timeout").end()):(this._liveRoomHandler.heartBeat(i=function(t,i){var s=t.body&&t.body.err_code;t.header&&t.body?0!==s&&(s=V(t.body.err_code||t.body.code,t.body.err_message||t.body.message),e.setAttributes({error:s.code,message:s.message+t.body.err_code})):e.setAttributes({error:(0<t.code?t:C.ROOM_INNER_ERROR).code,message:t.msg||C.ROOM_INNER_ERROR}),n._handleHeartbeatRsp(t,i),0===(null==(s=null==t?void 0:t.body)?void 0:s.err_code)&&e.setAttributes({interval:li.interval(null==(i=null==t?void 0:t.body)?void 0:i.hearbeat_interval),stream_seq:li.stream_seq(null==(s=null==t?void 0:t.body)?void 0:s.stream_seq),server_user_seq:li.server_user_seq(null==(i=null==t?void 0:t.body)?void 0:i.server_user_seq)}),e.end()},i,this._room),this._heartbeatInterval=t,i=this._heartbeatInterval,2<=this.initCount?(i=Math.round(Math.random()*(this._heartbeatInterval+1)),this.initCount=1):i=this._heartbeatInterval,this._heartbeatTimer=setTimeout((function(){n.start(n._heartbeatInterval)}),i),this.qt.info(yt+" call success")):(this.qt.error(yt+" state error"),this.Jt.setError(e,li.error.NOT_LOGIN))},ji.prototype._handleHeartbeatRsp=function(t,i){if(t.body&&t.body.err_code&&0!==t.body.err_code)return this.qt.error(Ot+" disconnect, server error=",t.body.err_code),1000000152==t.body.err_code?void this.hbLogout(C.HEARTBEAT_TIMEOUT):void this.hbLogout(J(t.body.err_code));t.header&&t.body?((this._tryHeartbeatCount=0)!==t.body.hearbeat_interval&&(this._heartbeatInterval=t.body.hearbeat_interval,this._heartbeatInterval<3e3)&&(this._heartbeatInterval=3e3),this.heartbeatRspNotiFy(t,this._room.roomID),this.qt.info(Ot+" call success")):(this.qt.error(Ot+" disconnect, error=",JSON.stringify(t)+", seq = "+i),this.hbLogout(t))},ji.prototype.heartbeatRspNotiFy=function(t,i){},ji.prototype.hbLogout=function(t){},ji.prototype.resetHeartbeat=function(){clearTimeout(this._heartbeatTimer),this._heartbeatTimer=null,clearTimeout(this._loginHeartbeatTimer),this._loginHeartbeatTimer=null,this._tryHeartbeatCount=0,this.initCount=0,this.qt.info("zm.hb.rst call success")};var Li=ji;function ji(t,i,n,e,s,r){this.qt=t,this.jt=i,this._dataReport=n,this._liveRoomHandler=e,this._room=s,this._service=r,this._tryHeartbeatCount=0,this._heartbeatTimer=null,this._loginHeartbeatTimer=null,this.initCount=0}var qi={code:1102026,msg:"cancel login"},Gi="DISCONNECTED",Hi="CONNECTED",Bi=(Object.defineProperty(Vi.prototype,"_isUseNetAgent",{get:function(){return this.jt.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(Vi.prototype,"Jt",{get:function(){return this.jt.reporter},enumerable:!1,configurable:!0}),Vi.prototype.resetTokenTimer=function(t){var i=this;this.qt.info("zm.rm.rst  call: "+(t=2147483647<(t=(t-=3e4)<0?0:t)?2147483647:t)),this._tokenTimer&&clearTimeout(this._tokenTimer),this._tokenTimer=setTimeout((function(){i.jt.actionListener("tokenWillExpire",i._room.roomID),i.jt.actionListener("roomTokenWillExpire",i._room.roomID)}),t)},Vi.prototype._stopTokenTimer=function(){this._tokenTimer&&clearTimeout(this._tokenTimer),this._tokenTimer=null},Vi.prototype.setRunState=function(t){this._room.runState!==t&&(this._room.lastRunState=this._room.runState,this._room.runState=t)},Vi.prototype._resetTryLogin=function(){this._tryLoginTimer&&clearTimeout(this._tryLoginTimer),this._tryLoginTimer=null},Vi.prototype._reportLogoutSpan=function(t){var i,n=this.jt.isMultiRoom?ni:"/switch/logout_user";n=this.Jt.createSpan(u.H,{key:ii.event,par:this._room.roomID},{key:""},n),t&&this._isUseNetAgent&&"0"===this._liveRoomHandler.roomServicer.zPushSid&&(this._liveRoomHandler.roomServicer.zPushSid=null==(i=null==(i=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:i.switchSessionID)?void 0:i.toString()),this.updateTimes(),t=this._isUseNetAgent?t?null==(t=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:t.zPushSid:null==(i=null==(t=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:t.switchSessionID)?void 0:i.toString():void 0,n.setAttributes({room_id:ii.room_id(null==(i=this._room)?void 0:i.roomID),room_sid_string:ii.room_sid_string(null==(i=this._room)?void 0:i.roomSidString),liveroom_sid_string:ei(null==(i=this._room)?void 0:i.userSidString),sdk_zpush_sessionid_string:si(t),valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),n.end()},Vi.prototype.resetRoom=function(t){var i,n=this;this.qt.info(bt+" call"),1<this.jt.roomModulesList.length&&!t&&(this._room.isMulti=!0),this._resetTryLogin(),this._room.sessionExist&&this._room.runState!==o.logout&&!this._room.isDisConnect()&&this._liveRoomHandler.logout(this._room,i=function(t){n.handleLogoutRsp(t,!n._room.isMulti)},i),this._reportLogoutSpan(t),this.setRunState(o.logout),this._room.resetRoomSession(),this._room.resetUserSession(),this._room.isMulti||(this.jt.userid="",this.qt.setSessionInfo(this.jt.appid,this._room.roomID,this._room.userSidString,this.jt.idName,this.jt.nickName,this.jt.sdKVersion),null!=(i=this._liveRoomHandler)&&i.reset()),this.resetRoomCallBack(),this.jt.roomModulesList=this.jt.roomModulesList.filter((function(t){return t!==n._room})),(t=this.jt.roomModulesList[0])&&(t.isMulti=!1,t.runState!==o.login)&&t.roomTryHandler&&(t.roomTryHandler.startMaxTime(),t.roomTryHandler.active()),this.jt.isMultiRoom&&0===this.jt.roomModulesList.length&&(this.Jt.createSpan(u.H,{key:ii.event,par:this._room.roomID},{key:""},"/zpush/multi_logout_user").end(),this._liveRoomHandler.roomServicer.zPushSid="0"),this.qt.info(bt+" call success")},Vi.prototype.resetRoomCallBack=function(){},Vi.prototype.loginSuccessCallBack=function(t,i){},Vi.prototype.handlePushKickout=function(t,i,n){var e=this,s=(this.qt.info(St+"  call "+JSON.stringify(t)),function(t,i){var n={code:t,message:"kickout reason = "+t},e={code:63000005,message:"zpush token expired",name:x};switch(t){case 1:return{code:63000001,message:"zpush multiple login kickout",name:U};case 2:return{code:63000002,message:"zpush manual kickout",name:"MANUAL_KICKOUT"};case 4:return i?e:{code:63000004,message:"zpush multiple login kickout",name:U};case 5:if(!i)return e;default:n.code=t,n.message="kickout reason = "+t}return n}(t.body.reason||(null==(s=t.body)?void 0:s.kickout_reason),this._isUseNetAgent)),r=this.Jt.createSpan(u.H,{key:Wt.event,par:this._room.roomID},{key:""},"/sdk/kickout"),h=(this.updateTimes(),r.setAttributes({error:null==(h=C[s.name||"ROOM_INNER_ERROR"])?void 0:h.code,message:s.message,kickout_reason:ci((null==(h=t.body)?void 0:h.reason)||(null==(h=t.body)?void 0:h.kickout_reason)),need_relogin:ai(null==(h=null==t?void 0:t.body)?void 0:h.need_relogin),valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),r.end(),this._room.roomTryHandler);h?(h.onactive=function(t,i){e.qt.info(St+" onactive"),e.disconnectedHandle(i),e.jt.actionListener("_kickout",i)},t.body.need_relogin&&1==t.body.need_relogin?(this._room.resetUserSession(),h.startMaxTime(),h.active()):(this.setRunState(o.logout),this.resetRoom(i),r={},t&&t.body.custom_reason?r.custom_kickout_message=t.body.custom_reason:s.name&&C[s.name]&&(r.custom_kickout_message=C[s.name].msg+"; kickout reason: "+(h=t.body.reason||t.body.kickout_reason)),this.disconnectedHandle(s.name&&C[s.name]?C[s.name]:C.ROOM_INNER_ERROR,{extendedData:JSON.stringify(r),isKickout:!0}),this.jt.actionListener("_kickout",{code:C.MANUAL_KICKOUT.code,msg:C.MANUAL_KICKOUT.msg+t.body.reason||t.body.kickout_reason}))):this.qt.info(St+" try handler no found")},Vi.prototype.handleHbLogout=function(t){var i=this,n=this._room.roomTryHandler;n&&(n.onactive=function(t,n){i.qt.warn(Rt+" onactive"),i.transError(n),i.disconnectedHandle(n)},[C.HEARTBEAT_TIMEOUT,C.SOCKET_CLOSE].includes(t)||[105,152,2001].includes(null==t?void 0:t.code)||t.msg.endsWith("1000002001")||t.msg.endsWith("1000000152")||t.msg.endsWith("1000000105")?(n.startMaxTime(),n.active()):[C.TIMEOUT].includes(t)?this.qt.warn(Rt+" timeout"):(this.qt.warn(Rt+" unexpected error: ".concat(JSON.stringify(t))),n.stopMaxTime(),n.invalid(),this.resetRoom(),this.disconnectedHandle(t)))},Vi.prototype.onDisconnect=function(t){var i=this,n=(this.qt.error(Et+" "+t.msg),t.code);Object(A.f)(n)&&"Error.Network"===n||Object(A.d)(n)&&(n<2e9&&1e9<n||n<1e6)&&V(n,t.msg),Y(ri,this.jt.reportList),(n=this._room.roomTryHandler)?(n.onactive=function(t,n){i.qt.error(Et+" onactive"),n&&0!==n.code?(i.transError(n),i._roomStateHandle(Gi,O.ReconnectFailed,n)):i._roomStateHandle(Hi,O.Reconnected,n)},n.startMaxTime(),n.active()):this.qt.error(Et+" try handler no found")},Vi.prototype.onConnecting=function(t){this._roomStateHandle("CONNECTING",O.Logining,t)},Vi.prototype.disconnectedHandle=function(t,i){var n;t&&0!==t.code?(this._stopTokenTimer(),n=null!=i&&i.isKickout?O.Kickout:O.ReconnectFailed,this.transError(t),this._roomStateHandle(Gi,n,t,(null==i?void 0:i.extendedData)||t.msg)):this._roomStateHandle(Hi,O.Reconnected,t,null==i?void 0:i.extendedData)},Vi.prototype.updateTimes=function(){this.updateValidTime(),this.updateTotalTime()},Vi.prototype.updateValidTime=function(){this.Wt&&(this.validTime=this.validTime+Date.now()-this.Wt,this.Wt=0)},Vi.prototype.updateTotalTime=function(){this.Kt&&(this.totalTime=Date.now()-this.Kt)},Vi.prototype._roomStateHandle=function(t,i,n,e,s){var r=this._room.roomID,o=Date.now();if(!i||i!=O.Reconnecting||(this._reconectTimes++,1!=this._reconectTimes)){this.qt.info("zm.rm.scb "+t+" "+JSON.stringify(n)),[Hi,Gi].includes(t)&&(this._reconectTimes=0,this.Ft)&&this.brokenCounts++,t!==Hi&&this.updateTimes(),(i=i&&[O.LoginFailed,O.ReconnectFailed].includes(i)?null!=(c=this._room.roomTryHandler)&&c.loginRoomCallback.fail?O.LoginFailed:O.ReconnectFailed:i)&&[O.Logined,O.Reconnected].includes(i)&&(null!=(c=this._room.roomTryHandler)&&c.loginRoomCallback.success?(i=O.Logined,this.Kt=this.Kt||o):i=O.Reconnected,this.Ft=!1,this.Wt=o),i&&[O.Logining,O.Reconnecting].includes(i)&&(i=null!=(c=this._room.roomTryHandler)&&c.loginRoomCallback.success?O.Logining:O.Reconnecting,this.Kt)&&(this.Ft=!0);var h,c,a=0;switch(i){case O.Reconnecting:h=oi,this.tempBrokenTime=(new Date).getTime();break;case O.ReconnectFailed:h=hi;break;case O.Reconnected:h=ui,a=(new Date).getTime()-this.tempBrokenTime}this._room.lastRoomState=this._room.roomState,this._room.roomState=t,this._room.roomReasonState=i,this._room.roomState!==this._room.lastRoomState&&(this.jt.actionListener("_roomStateUpdate",r,t,n?n.code:0,e,s),s||(this.jt.actionListener("roomStateUpdate",r,t,o=(o=(null==n?void 0:n.code)||0)==qi.code?0:o,e),this.jt.actionListener("roomStateChanged",r,i,o,e)),h)&&((c=this.Jt.createSpan(u.H,{key:Wt.event,par:r},{key:""},h.event)).setAttributes(i===O.Reconnected?{room_broken_time:ui.room_broken_time(a)}:{error:(null==n?void 0:n.code)||0,message:e||""}),h==hi&&c.setAttributes({valid_d:this.validTime,total_d:this.totalTime,tempbroken_cnt:this.brokenCounts}),c.end()),t===Gi&&(this.Kt=0,this.totalTime=0,this.validTime=0,this.brokenCounts=0)}},Vi.prototype.transError=function(t){var i;this.qt.info("zm.rm.te "+JSON.stringify(t)),0!==t.code&&(t.code<2e9&&1e9<t.code||t.code<1e6)&&(i=X(t.code,this.jt.useNetAgent))&&C[i]&&(t.code=C[i].code,t.msg=C[i].msg)},Vi.prototype.login=function(t,i,n,e,s,r,h){var c;this.qt.info(dt+" call:"+i),this.qt.remoteReport(dt+" call:"+n),this._room.isMulti||this.qt.setSessionInfo(this.jt.appid,i,"",e.userID,"",this.jt.sdKVersion),s&&(c=s.userUpdate,s=s.maxMemberCount,c&&Object(A.b)(c)&&(this._room.userStateUpdate=c),s)&&Object(A.d)(s)&&(this._room.maxMemberCount=s),this.jt.configOK?(this._room.runState!==o.trylogin&&this.setRunState(o.trylogin),this._room.isCancelLogin=!1,this._room.roomID=i,this._room.token=n,this._room.thirdToken=n,this.jt.idName=e.userID,this.jt.nickName=e.userName||e.userID,this.loginCallback.success=r,this.loginCallback.fail=h,this.server=t,this.Jt.spanSetAttributes({key:Kt,bak_key:ri,par:i},{server:this._isUseNetAgent?void 0:Ft(this.server)}),this.liveRoomLoginKey=this._room.isMulti?Qt:Zt,this.Jt.createSpan(u.H,{key:Kt,bak_key:ri,par:this._room.roomID},{key:this.liveRoomLoginKey.event,par:this._room.roomID},this.liveRoomLoginKey.event,!0),this._resetTryLogin(),this.onConnecting({code:0,msg:""}),this._tryLogin(t),this.qt.info(dt+" call success")):(this.qt.error(dt+" init sdk wrong"),h(C.INIT))},Vi.prototype._tryLogin=function(t){var i,n=this;if(this._room.runState!==o.trylogin)this.qt.error("zb.rh.tl state error");else{var e;if(this._isUseNetAgent)return this._room.isMulti&&this._room.isDisConnect()?void this.qt.warn(mt+" liveroom is not connected"):(e=function(t,i){n.handleLoginRsp(t,i)},void(null!=(i=this._liveRoomHandler)&&i.isUaConnect()?(this.Jt.spanSetAttributes({key:this.liveRoomLoginKey.event,par:null==(i=this._room)?void 0:i.roomID},{sdk_zpush_sessionid_string:null==(i=null==(i=null==(i=this._liveRoomHandler)?void 0:i.roomServicer)?void 0:i.switchSessionID)?void 0:i.toString()}),this._liveRoomHandler.login(this._room,e,e)):(this._tryLoginTimer=setTimeout((function(){n.qt.info(mt+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(Wt.error.LOGIN_TIMEOUT)}),this._tryLoginInterval),this.qt.warn(mt+" ua is not connected"))));this._tryLoginTimer=setTimeout((function(){n.qt.info(mt+" over time no response, login timeout"),n.loginCallback.fail&&n.loginCallback.fail(Wt.error.LOGIN_TIMEOUT)}),this._tryLoginInterval),this.qt.info(mt+" call success")}},Vi.prototype.handleLoginRsp=function(t,i){this.qt.info(vt+" seq: "+i+" "+JSON.stringify(t)),this._room.runState!==o.trylogin?this._room.isCancelLogin?(this.handleLoginFail(qi),this._room.isCancelLogin=!1):this.qt.error(vt+" state error"):t.header&&t.body?t.header.seq!==i&&0==this._room.isMulti?this.qt.error(vt+" in wrong seq, local=",i+"",",recv=",t.header.seq):0!==t.body.err_code?(this.qt.error(vt+" server error=",t.body.err_code),this.handleLoginFail(t)):(this.qt.info(vt+" call success."),this.handleLoginSuccess(t)):(this.qt.error(vt+" "+JSON.stringify(t)),this.handleLoginFail(t))},Vi.prototype.handleLoginFail=function(t){this._resetTryLogin();var i=Wt.error.INNER_ERROR;t.header&&t.body?i=J(t.body.err_code):t.code&&t.msg&&(i=t),this.Jt.spanEnd({key:this.liveRoomLoginKey.event,par:this._room.roomID},{error:i.code,message:i.msg}),this.loginCallback.fail&&this.loginCallback.fail(i,!0)},Vi.prototype.handleLoginSuccess=function(t){var i,n,e=this,s=(this._room.checkRoomSession(t.body.room_session_id)&&(this._room.loginTime=Date.now()),this._room.lastRunState),r=(this.setRunState(o.login),this.jt.userid=t.body.user_id,this._room.longRoomSid=t.body.room_session_id,this._room.longSid=t.body.session_id,(r={})[this._room.roomID]={room_sid_string:this._room.roomSidString},this.Jt.setPublicPros(r),null==(r=null==t?void 0:t.body)?void 0:r.token_remain_time);this.jt.configRoomAuth=0<r,t.body.ret_timestamp&&["03","04"].includes(this._room.token.substring(0,2))&&(n=(i=(new Date).getTime())-t.body.ret_timestamp,this.jt.local_time_deviation=n<5e3?0:n,n=0<r?1e3*r:1e3*F(this._room.token.substring(2))-(i-this.jt.local_time_deviation),this.resetTokenTimer(n)),this._room.isMulti||this.qt.setSessionInfo(this.jt.appid,this._room.roomID,this._room.userSidString,this.jt.idName,this.jt.nickName,this.jt.sdKVersion),this.Jt.spanEnd({key:this.liveRoomLoginKey.event,par:this._room.roomID},{server:this._isUseNetAgent?void 0:Ft(this.server),room_id:null==(r=this._room)?void 0:r.roomID,room_sid_string:null==(i=this._room)?void 0:i.roomSidString,zpush_sessionid_string:this._isUseNetAgent&&null!=(r=null==(n=null==t?void 0:t.header)?void 0:n.session_id)?r.toString():void 0,liveroom_sid_string:null==(i=this._room)?void 0:i.userSidString}),this._resetTryLogin(),this.loginSuccessCallBack(s,t),this._roomStateHandle(Hi,O.Logined,{code:0,msg:""}),this.qt.makeZipLogSpaceUpload().catch((function(t){e.qt.error("zm.rm.lgsuc zip log upload error: "+JSON.stringify(t))})),this.loginCallback.success&&this.loginCallback.success(!0)},Vi.prototype.closeHandler=function(t){this.qt.error(pt+" room websocket close "+JSON.stringify(t.code||t)),this._room.runState!==o.logout?this._room.runState===o.trylogin?(this._resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==t.code?Wt.error.LOGIN_TIMEOUT:t)):this._room.runState===o.login&&(this.qt.info(pt+" is called because of network broken"),this._resetTryLogin(),this.onDisconnect(Wt.error.NETWORK_BROKEN)):this.qt.info(pt+" onclose logout flow call websocket.close")},Vi.prototype.logout=function(t,i){this.qt.info(gt+" call");var n={code:0,msg:""};this._room.runState===o.logout?this.qt.warn("zb.rh.lo at logout"):(this._room.runState===o.trylogin&&(this._room.isCancelLogin=!0,n=qi),this.resetRoom(t),this._roomStateHandle(Gi,O.Logout,n,void 0,i),this._stopTokenTimer(),this.qt.info(gt+" call success"))},Vi.prototype.handleLogoutRsp=function(t,i){this.qt.info(gt+" result=",t.body&&t.body.err_code?t.body.err_code:"-1"),this._isUseNetAgent&&i&&null!=(t=this._liveRoomHandler)&&t.closeRequest()},Vi);function Vi(t,i,n,e,s,r){this.qt=t,this.jt=i,this._dataReport=n,this._room=e,this._liveRoomHandler=s,this._service=r,this._tryLoginTimer=null,this._tryLoginCount=0,this._tryLoginInterval=1e4,this._tokenTimer=null,this._beforeExpire=30,this.server="",this.tempBrokenTime=0,this._reconectTimes=0,this.validTime=0,this.totalTime=0,this.brokenCounts=0,this.Wt=0,this.Kt=0,this.Ft=!1,this.loginCallback={}}var $i=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},Ji=(Yi.prototype.loginRsp=function(t,i){this._anchor_info=t.body.anchor_info||this._anchor_info,this._userListInterval=t.body.userlist_interval||this._userListInterval,this._userListMergeInterval=t.body.userlist_merge_timeout||this._userListMergeInterval,t.body.anchor_info&&(this.jt.actionListener("getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name),this.jt.actionListener("_getAnchorInfo",t.body.anchor_info.anchor_id_name,t.body.anchor_info.anchor_nick_name)),t.body.online_count&&this.jt.actionListener("roomOnlineUserCountUpdate",this._room.roomID,t.body.online_count),this.qt.info("zm.us.lgr  userStateUpdate "+this._room.userStateUpdate),this._room.userStateUpdate&&this.fetchUserList(i)},Yi.prototype.patchUserList=function(t){var i=this;t.body.server_user_seq!==this._userSeq&&this._room.userStateUpdate&&!this._userSeqMergeMap&&(this.qt.info("zm.us.pt call update user "+this._userSeq+" server "+t.body.server_user_seq),this._userSeqMergeMap||(this._userSeqMergeMap={}),this._userSeqMergeTimer&&clearTimeout(this._userSeqMergeTimer),this._userSeqMergeTimer=setTimeout((function(){i.handleMergeTimeout()}),this._userListMergeInterval)),this._minUserSeq=t.body.server_user_seq,null!=t.body.online_count&&0!=t.body.online_count&&this.jt.actionListener("roomOnlineUserCountUpdate",this._room.roomID,t.body.online_count)},Yi.prototype.resetUserHandler=function(){this._userQuerying=!1,this._lastUserQueryTime=0,this._userTempList=[],this._userSeq=0,this._minUserSeq=0,this._userList=void 0,this._userSeqMergeMap={},this._userSeqMergeTimer=void 0,this._userQueryTimer=void 0,this._userListInterval=3e4,this._userListMergeInterval=5e3,this._anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},Yi.prototype.fetchUserList=function(t){this._userQuerying?this.qt.warn(Tt+" is already querying"):(this._userQuerying=!0,this._userTempList=[],this.fetchUserListWithPage(0,t||0),this.qt.info(Tt+" the first time call"))},Yi.prototype.fetchUserListWithPage=function(t,i){function n(t){e.handleFetchUserListRsp(t,i)}var e=this,s={user_index:t,sort_type:0},r=di;this.jt.reporter.createSpan(u.H,{key:Wt.event,par:this._room.roomID},{key:r.event,par:this._room.roomID},r.event,!0).setAttribute("user_index",r.user_index(t)),null!=(r=this._liveRoomHandler)&&r.fetchUserList(s,n,n,this._room)},Yi.prototype.handleFetchUserListRsp=function(t,i){var n=this;if(this.jt.reporter.spanEnd({key:di.event,par:this._room.roomID},{error:(null==(e=null==t?void 0:t.body)?void 0:e.err_code)||(null==t?void 0:t.code),message:(null==(e=null==t?void 0:t.body)?void 0:e.err_message)||(null==t?void 0:t.msg)}),t.body&&0!=t.body.err_code)this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this.qt.info(wt+" fetch error "+t.body.err_code);else if(t.header&&t.body)if(this._room.userStateUpdate){this._userTempList=$i($i([],this._userTempList,!0),t.body.user_baseinfos,!0);var e=t.body.ret_user_index;if(e!=t.body.server_user_index)this.qt.info(wt+" fetch another page"),this.fetchUserListWithPage(e+1,i);else{this._userSeq=t.body.server_user_seq;for(var s=[],r=[],u=0;u<this._userTempList.length;u++){var h={userID:this._userTempList[u].id_name,userName:this._userTempList[u].nick_name,role:this._userTempList[u].role};4!==h.role&&(s.push(h),r.push({idName:this._userTempList[u].id_name,nickName:this._userTempList[u].nick_name,role:this._userTempList[u].role}))}if(this.jt.actionListener("_getTotalUserList",this._room.roomID,r),i==o.login){if(this._userList){var c=this._userList,a=s;i=function(t,i){0!==t.length&&n.onUserStateUpdate(n._room.roomID,"ADD",t),0!==i.length&&n.onUserStateUpdate(n._room.roomID,"DELETE",i)},(e=this.qt).debug("msl.0 call");var l=[],f=[];a=a||[];for(var _=0;_<a.length;_++){for(var d=!1,m=0;m<c.length;m++)if(a[_].userID===c[m].userID){d=!0;break}d||l.push(a[_])}for(var v=0;v<c.length;v++){d=!1;for(var p=0;p<a.length;p++)if(c[v].userID===a[p].userID){d=!0;break}d||f.push(c[v])}for(c.splice(0),_=0;_<a.length;_++)c.push(c[_]);i(l,f),e.debug("msl.0 call success")}this._userList=s}else 0!==(this._userList=s).length&&this.onUserStateUpdate(this._room.roomID,"ADD",s);this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this._userTempList=[],this.qt.info(wt+" call success user_list "+s+", count: "+s.length+", seq: "+this._userSeq)}}else this.qt.info(wt+" not update");else this._userQuerying=!1,this._lastUserQueryTime=Date.now()+this._userListInterval,this.qt.info(wt+" fetch error "+t)},Yi.prototype.handlePushUserStateUpdateMsg=function(t){if(this.qt.info(It+" call"),this._room.userStateUpdate)if(this._userSeq===t.body.user_list_seq)this.qt.warn(It+" user_list_seq is the same with local seq");else if(this._userSeq+t.body.user_actions.length!==t.body.user_list_seq)this.mergeUserByUserSeq(t.body.user_list_seq,t.body.user_actions);else{this._userSeq=t.body.user_list_seq;for(var i=[],n=0;n<t.body.user_actions.length;n++){var e={action:t.body.user_actions[n].Action,idName:t.body.user_actions[n].IdName,nickName:t.body.user_actions[n].NickName,role:t.body.user_actions[n].Role,loginTime:t.body.user_actions[n].LoginTime};4!==e.role&&i.push(e)}this.jt.actionListener("_userStateUpdate",t.body.room_id,i);var s=[],r=[];i.forEach((function(t){1==t.action?s.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&r.push({userID:t.idName,userName:t.nickName,role:t.role})})),this._userList&&(this._userList=this._userList.concat(s).filter((function(t){return!r.some((function(i){return i.userID==t.userID}))}))),0!==s.length&&this.onUserStateUpdate(t.body.room_id,"ADD",s),0!==r.length&&this.onUserStateUpdate(t.body.room_id,"DELETE",r),this.qt.info(It+" call success")}else this.qt.info(It+" userStateUpdate is false")},Yi.prototype.onUserStateUpdate=function(t,i,n){var e=this;n=n.filter((function(t){return t.userID!==e.jt.idName})),0!=n.length&&(n=n.map((function(t){return{userID:t.userID,userName:t.userName}})),this.jt.actionListener("roomUserUpdate",t,i,n))},Yi.prototype.mergeUserByUserSeq=function(t,i){var n=this;this._userSeqMergeMap||(this.qt.warn(Nt+" new merge userlist "+this._userSeq+" server "+t),this._userSeqMergeMap={},this._userSeqMergeTimer&&clearTimeout(this._userSeqMergeTimer),this._userSeqMergeTimer=setTimeout((function(){n.handleMergeTimeout()}),this._userListMergeInterval)),this._userSeqMergeMap[t]=i,this.qt.warn(Nt+"  merge userlist "+this._userSeq+" server "+t+" userlist "+i.length)},Yi.prototype.mergeUser=function(t){var i=this,n=(this.qt.info("zm.us.mg merge userlist "+this._userSeq+" userSeqList "+t.join(",")),this._userSeq=t[t.length-1],this._lastUserQueryTime=Date.now()+this._userListInterval,{}),e=((t.forEach((function(t){i._userSeqMergeMap&&i._userSeqMergeMap[t].forEach((function(t){n[t.IdName]=t}))})),this._userSeqMergeMap=null,t=Object.values(n).map((function(t){return{action:t.Action,idName:t.IdName,nickName:t.NickName,role:t.Role,loginTime:t.LoginTime?String(t.LoginTime):""}})).filter((function(t){return 4!==t.role}))).sort((function(t,i){return t.loginTime.localeCompare(i.loginTime)})),[]),s=[];t.forEach((function(t){1==t.action?e.push({userID:t.idName,userName:t.nickName,role:t.role}):2==t.action&&s.push({userID:t.idName,userName:t.nickName,role:t.role})})),this._userList=this._userList&&this._userList.concat(e).filter((function(t){return!s.some((function(i){return i.userID==t.userID}))})),0!==e.length&&this.onUserStateUpdate(this._room.roomID,"ADD",e),0!==s.length&&this.onUserStateUpdate(this._room.roomID,"DELETE",s),this.jt.actionListener("_userStateUpdate",this._room.roomID,t)},Yi.prototype.handleMergeTimeout=function(){var t,i=this,n=Object.keys(this._userSeqMergeMap).map((function(t){return+t})).sort((function(t,i){return t-i}));n[n.length-1]-n[0]+1===n.length||n[n.length-1]>=this._minUserSeq?this.mergeUser(n):(this._userSeqMergeMap=null,t=this._lastUserQueryTime-Date.now(),this.qt.info("zm.us.mto  fetch merge userlist "+this._userSeq+" userSeqList "+n.join(",")+" wait "+t),0<t?(this._userQueryTimer&&clearTimeout(this._userQueryTimer),this._userQueryTimer=setTimeout((function(){i.fetchUserList()}),t)):this.fetchUserList())},Yi);function Yi(t,i,n,e,s,r){this.qt=t,this.jt=i,this._dataReport=n,this._liveRoomHandler=e,this._room=s,this._service=r,this._userQuerying=!1,this._userTempList=[],this._userSeq=0,this._minUserSeq=0,this._userList=[],this._userSeqMergeMap=null,this._userListInterval=3e4,this._userListMergeInterval=5e3,this._anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}Object.defineProperty(Wi.prototype,"logger",{get:function(){return this.qt},enumerable:!1,configurable:!0}),Object.defineProperty(Wi.prototype,"stateCenter",{get:function(){return this.jt},enumerable:!1,configurable:!0}),Object.defineProperty(Wi.prototype,"liveRoomHandler",{get:function(){return this._liveRoomHandler},enumerable:!1,configurable:!0}),Object.defineProperty(Wi.prototype,"_isUseNetAgent",{get:function(){return this.jt.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(Wi.prototype,"sessionExist",{get:function(){return null!==this.longSid||"0"!==this.sessionID},enumerable:!1,configurable:!0}),Object.defineProperty(Wi.prototype,"roomSidString",{get:function(){return this.longRoomSid?this.longRoomSid.toString():"0"},enumerable:!1,configurable:!0}),Object.defineProperty(Wi.prototype,"userSidString",{get:function(){return this.longSid?this.longSid.toString():"0"},enumerable:!1,configurable:!0}),Wi.prototype.initMessageHandler=function(){},Wi.prototype.initLiveHandler=function(){},Wi.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},Wi.prototype.bindHeatBeatHandler=function(){var t=this;this.heartBeatHandler.hbLogout=function(i){t.roomHandler.handleHbLogout(i)},this.heartBeatHandler.heartbeatRspNotiFy=function(i,n){t.messageHandler&&t.messageHandler.loginRsp(i),t.userHandler.patchUserList(i),t._HBResponse(i,n)}},Wi.prototype.bindRoomHandler=function(){var t=this;this.roomHandler.loginSuccessCallBack=function(i,n){t.qt.info("zm.lrm.brh login suc "+i),t.heartBeatHandler.init(n),t._liveRoomHandler.startCheck(),t.userHandler.loginRsp(n,i),t.messageHandler&&t.messageHandler.loginRsp(n),t.isMulti||t._handleMultiRoom(),t._roomLoginResponse(n)},this.roomHandler.resetRoomCallBack=function(){t.heartBeatHandler.resetHeartbeat(),t.liveHandler&&t.liveHandler.resetLiveHandler(),t.messageHandler&&t.messageHandler.resetMessageInfo(),t._isUseNetAgent&&t._liveRoomHandler&&t._liveRoomHandler.stopCheck(),t.userHandler.resetUserHandler(),t.roomTryHandler&&(t.roomTryHandler.invalid(),t.roomTryHandler.stopMaxTime())}},Wi.prototype.bindUserHandler=function(){},Wi.prototype.bindMessageHandler=function(){},Wi.prototype.bindLiveHandler=function(){},Wi.prototype._HBResponse=function(t,i){this.jt.actionListener("HBResponse",t,i)},Wi.prototype._roomLoginResponse=function(t){this.jt.actionListener("roomLoginResponse",t)},Wi.prototype.checkRoomSession=function(t){return null!==this.longRoomSid&&this.longRoomSid.eq(t)},Wi.prototype._handleMultiRoom=function(){var t=this;this.jt.roomModulesList.forEach((function(i){i.runState!==o.login&&i.roomTryHandler&&1==i.isMulti&&(i.roomTryHandler.onactive=function(n,e){var s;e&&0!==e.code?(0!==e.code&&(s=X(e.code,t._isUseNetAgent))&&C[s]&&(e=C[s]),i.roomHandler._roomStateHandle("DISCONNECTED",O.ReconnectFailed,e,e.msg)):i.roomHandler._roomStateHandle("CONNECTED",O.Reconnected,e)},i.roomTryHandler.startMaxTime(),i.roomTryHandler.active())}))},Wi.prototype.isLogin=function(){return this.runState===o.login},Wi.prototype.isLogout=function(){return this.runState===o.logout},Wi.prototype.isTryLogin=function(){return this.runState===o.trylogin},Wi.prototype.isDisConnect=function(){return this._liveRoomHandler.isDisConnect()},Wi.prototype.retryConnect=function(){this.qt.info("zm.lrm.rc call"),this._isUseNetAgent&&(this.resetSessionInfo(),this._liveRoomHandler.closeRequest())},Wi.prototype.retryRoom=function(){this.qt.info("zm.lrm.rr.0 call"),this.roomTryHandler&&this.rtm.netAgent.isConnect()&&(this.resetRoomSession(),this.resetUserSession(),this.roomTryHandler.active(!0))},Wi.prototype.resetSessionInfo=function(){var t;this.qt.info("zm.lrm.rsi call"),this.resetRoomSession(),this.resetUserSession(),null!=(t=this._liveRoomHandler)&&t.reset()},Wi.prototype.resetRoomSession=function(){this.roomSessionID="0",this.longRoomSid=null},Wi.prototype.resetUserSession=function(){this.sessionID="0",this.longSid=null};var Xi=Wi;function Wi(t,i,n,e,s,r,u){this.roomID=t,this.jt=i,this.qt=n,this.dataReport=e,this.rtm=s,this._liveRoomHandler=r,this.service=u,this.runState=o.logout,this.lastRunState=o.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomReasonState=O.Logout,this.roomSessionID="0",this.sessionID="0",this.longSid=null,this.longRoomSid=null,this.isMulti=!1,this.token="",this.thirdToken="",this.loginTime=0,this.userStateUpdate=!1,this.maxMemberCount=0,this.roomName="",this.isCancelLogin=!1,this.roomHandler=new Bi(this.qt,this.jt,this.dataReport,this,r,this.service),this.heartBeatHandler=new Li(this.qt,this.jt,this.dataReport,this._liveRoomHandler,this,this.service),this.userHandler=new Ji(this.qt,this.jt,this.dataReport,this._liveRoomHandler,this,this.service),this.initMessageHandler(),this.initLiveHandler(),this.init()}var Ki=function(){},Fi=(Object.defineProperty(Zi.prototype,"Jt",{get:function(){return this.jt.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(Zi.prototype,"logger",{get:function(){return this.qt},enumerable:!1,configurable:!0}),Object.defineProperty(Zi.prototype,"stateCenter",{get:function(){return this.jt},enumerable:!1,configurable:!0}),Zi.prototype.checkResponse=function(t){return!1},Zi.prototype.handleSendCommandMsgRsp=function(t){},Zi.prototype.onPush=function(){},Zi.prototype.handlePushKickout=function(t){},Zi.prototype.handlePushCustomMsg=function(t){},Zi.prototype.handlePushRoomMsg=function(t){},Zi.prototype.handlePushUserStateUpdateMsg=function(t){},Zi.prototype.handlePushMergeMsg=function(t){},Zi.prototype.handlePushTransMsg=function(t){},Zi.prototype.handleBigImMsgRsp=function(t){},Zi.prototype.handlePushSignalMsg=function(t){},Zi.prototype.handlePushTokenExpire=function(t){},Zi.prototype.closeHandler=function(t){},Zi.prototype.openHandler=function(t){},Zi.prototype.errorHandler=function(t){},Zi.prototype.getHeader=function(t,i,n,e){return{Protocol:"req",cmd:t,appid:this.jt.appid,seq:++this.cmdSeq,user_id:this.jt.userid,session_id:i||"",room_id:n||"",room_session_id:e||"",biz_version:this.jt.bizVersion||""}},Zi.prototype.startCheck=function(){},Zi.prototype.stopCheck=function(){},Zi.prototype.isDisConnect=function(){return!1},Zi.prototype.createSocket=function(t){},Zi.prototype.closeSocket=function(){},Zi.prototype.sendMessage=function(t,i,n,e,s,r){return 0},Zi.prototype.on=function(t,i){},Zi.prototype.login=function(t,i,n){return-1},Zi.prototype.logout=function(t,i,n){return-1},Zi.prototype.heartBeat=function(t,i,n){return-1},Zi.prototype.fetchUserList=function(t,i,n,e){return this.sendMessage("user_list",t,i,n,void 0,e)},Zi.prototype.fetchUserListV2=function(t,i,n,e){return this.sendMessage("user_list_v2",t,i,n,void 0,e)},Zi.prototype.fetchReliableMessage=function(t,i,n,e){return this.sendMessage("trans_fetch",t,i,n,void 0,e)},Zi.prototype.sendReliableMessage=function(t,i,n,e){return this.sendMessage("trans",t,i,n,void 0,e)},Zi.prototype.sendRoomMsg=function(t,i,n,e){return this.sendMessage("im_chat",t,i,n,void 0,e)},Zi.prototype.sendCustomCommand=function(t,i,n,e){return this.sendMessage("custommsg",t,i,n,void 0,e)},Zi.prototype.sendBigRoomMessage=function(t,i,n,e){return this.sendMessage("bigim_chat",t,i,n,void 0,e)},Zi.prototype.sendRelayMessage=function(t,i,n,e){return this.sendMessage("relay",t,i,n,void 0,e)},Zi.prototype.sendSignalCmd=function(t,i,n,e){return this.sendMessage("signal",t,i,n,void 0,e)},Zi.prototype.sendPB=function(t){return!1},Zi);function Zi(t,i,n){this.jt=t,this.qt=i,this.rtm=n,this.cmdSeq=0,this.responseRouters={},this.service=new Ki(this.jt.ENV)}for(var Qi=n(3),tn=(i=n(1),Qi.util.Long=i,Qi.util.Long.fromBits=Qi.util.Long?Qi.util.Long.fromBits:function(){return 0},Qi.roots),nn=Qi.types?Qi.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},en=Qi.types?Qi.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},sn=Object.keys(nn),rn={$:function(t){return rn[t]?rn[t].call(this):tn[t].decode?tn[t].decode(this,this.uint32()):rn.$.call(this,"int32")}},on={$:function(t,i,n){var e=nn[t];return void 0===e?tn[t].encode?(this.uint32((n<<3|2)>>0).fork(),tn[t].encode(i,this).ldelim()):on.$.call(this,"int32",i,n):on[t].call(this.uint32(n<<3|e),i)}},un=0;un<sn.length;un++)rn[sn[un]]=Qi.Reader.prototype[sn[un]],on[sn[un]]=Qi.Writer.prototype[sn[un]];!function t(i,n,e,s){for(var r=0,o=Object.keys(i);r<o.length;r++){var u=o[r];if(i[u].$m&&Object.keys(i[u].$m).every((function(t){return Number(t)}))){if(e[u])throw Error(`nested type ${e}.${u} has already exist`);e[u]=function(i,e){function s(t){for(var n in i)"{"===(n=i[n])[1].charAt(0)?this[n[0]]={}:"["!==n[1].charAt(0)&&"<"!==n[1].charAt(0)||(this[n[0]]=[]);if(t)for(var e=Object.keys(t),s=0;s<e.length;++s)null!=t[e[s]]&&(this[e[s]]=t[e[s]])}var r,o={};for(r in i){var u=i[r],h=u[1];"{"===h.charAt(0)?(s.prototype[u[0]]=Qi.util.emptyObject,o[h]={$m:h.substring(1).split(",").map((function(t,i){return["$"+(i+1),t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):s.prototype[u[0]]="["===h.charAt(0)||"<"===h.charAt(0)?Qi.util.emptyArray:"bytes"===h?Qi.util.newBuffer([]):u[2]&&u[2].hasOwnProperty("low")&&u[2].hasOwnProperty("high")?Qi.util.Long.fromBits(u[2].low,u[2].high,u[2].unsigned):u[2]}return s.create=function(t){return new s(t)},s.decode=function(t,n){t instanceof Qi.Reader||(t=Qi.Reader.create(t));for(var e=void 0===n?t.len:t.pos+n,r=new s;t.pos<e;){var o=t.uint32();if(0<(c=o>>>3)&&i[c]){var u=i[c][0];if("{"===(h=i[c][1]).charAt(0))r[u]===Qi.util.emptyObject&&(r[u]={}),c=s.$namespace[h].decode(t,t.uint32()),r[u][c.$1]=c.$2;else if("["===h.charAt(0)||"<"===h.charAt(0)){h=h.substring(1),r[u]&&r[u].length||(r[u]=[]);var h,c=!rn[h]&&!tn[h].decode;if(void 0!==en[h=c?"int32":h]&&2==(7&o))for(var a=t.uint32()+t.pos;t.pos<a;)r[u].push(rn.$.call(t,h));else r[u].push(rn.$.call(t,h))}else r[u]=rn.$.call(t,h)}else t.skipType(7&o)}return r},s.encode=function(t,n){for(var e in n=n||Qi.Writer.create(),i){var r=i[e][0];if("{"===(a=i[e][1]).charAt(0)){if(null!=t[r]&&t.hasOwnProperty(r))for(var o=0,u=Object.keys(t[r]);o<u.length;++o)n.uint32((e<<3|2)>>0).fork(),s.$namespace[a].encode({$1:u[o],$2:t[r][u[o]]},n).ldelim()}else if("["===a.charAt(0)||"<"===a.charAt(0)){var h="<"===a.charAt(0),c=(a=a.substring(1),t[r]);if(null!=c&&c.length){var a=void 0!==nn[a]||tn[a].encode?a:"int32";if(h&&void 0!==en[a]){for(n.uint32((e<<3|2)>>0).fork(),o=0;o<c.length;o++)on[a].call(n,c[o]);n.ldelim()}else for(o=0;o<c.length;o++)on.$.call(n,a,c[o],e)}}else null!=t[r]&&t.hasOwnProperty(r)&&on.$.call(n,a,t[r],e)}return n},Object.keys(o).length&&(s.$namespace=t(o,n+"."+e,s.$namespace||{},!0)),s}(i[u].$m,u)}else i[u].$s?e[u]=function(t,i){function e(t,i,n){Qi.rpc.Service.call(this,t,i,n)}return((e.prototype=Object.create(Qi.rpc.Service.prototype)).constructor=e).create=function(t,i,n){return new e(t,i,n)},Object.keys(t).forEach((function(s){var r=t[s];function o(t,i){return this.rpcCall(o,tn[r[0]],tn[r[1]],t,i)}Object.defineProperty(o,"name",{value:s}),Object.defineProperty(o,"path",{value:n+"."+i}),e.prototype[s]=o})),e}(i[u].$s,u):i[u].$e&&Object.values(i[u].$e).every((function(t){return Number(t)===t}))&&(e[u]=function(t){for(var i=Object.keys(t),n={},e=0;e<i.length;e++)n[n[i[e]]=t[i[e]]]=i[e];return n}(i[u].$e));e[u]&&!s&&(tn[n+"."+u]=e[u]),delete i[u].$m,delete i[u].$s,delete i[u].$e,e[u]=t(i[u],n?n+"."+u:u,e[u]||{})}return e}({liveroom:{liveroom_cs_v3:{AddStreamReq:{$m:{1:["stream_id","bytes",[]],2:["stream_title","bytes",[]],3:["stream_type","uint32",0],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["third_token","bytes",[]],8:["censor_mode","uint32",0],9:["need_gather","uint32",0]}},AddStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_sid","string",""],4:["stream_ver","uint32",0],5:["stream_nid","uint32",0],6:["token_remain_time","uint32",0]}},AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},BigImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","bytes",[]],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}]}},CommonRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},DeleteStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["client_req_seq","uint32",0]}},DeleteStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},EnterRoomReq:{$m:{1:["net_type","uint32",0],2:["conn_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["third_token","bytes",[]],7:["room_create_flag","uint32",0],8:["user_state_flag","uint32",0],9:["user_count_limit","uint32",0],10:["relate_service","string",""],11:["need_gather_stream","uint32",0],12:["callback_data","bytes",[]],13:["service_flags","uint32",0],14:["license_token","bytes",[]]}},EnterRoomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["user_id","uint64",{low:0,high:0,unsigned:!0}],5:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],6:["big_im_time_window","uint32",0],7:["liveroom_hb_interval","uint32",0],8:["liveroom_hb_timeout","uint32",0],9:["online_count","uint32",0],10:["anchor_info","liveroom.liveroom_cs_v3.AnchorInfo",null],11:["userlist_merge_timeout","uint32",0],12:["userlist_interval","uint32",0],13:["token_remain_time","uint32",0],14:["trans_list_seq","uint32",0],15:["trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],16:["stream_count","uint32",0],17:["stream_list_seq","uint32",0],18:["stream_info_list","<liveroom.liveroom_cs_v3.StreamInfo",null],19:["stream_fetch_flag","uint32",0],20:["stream_list_push_merge_timeout","uint32",0],21:["stream_list_hb_merge_timeout","uint32",0],22:["relate_result_list","<liveroom.liveroom_cs_v3.RelateResult",null],23:["gather_list_seq","uint32",0],24:["gather_info_list","<liveroom.liveroom_cs_v3.GatherInfo",null]}},EnumSignalTransmitResult:{$e:{ok:0,version_err:1}},GatherInfo:{$m:{1:["gather_id","string",""]}},GetGatherListReq:{$m:{}},GetGatherListRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["gather_list_seq","uint32",0],3:["gather_info_list","<liveroom.liveroom_cs_v3.GatherInfo",null]}},GetImReq:{$m:{1:["msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["sort_type","uint32",0],3:["msg_count","uint32",0]}},GetImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],3:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<liveroom.liveroom_cs_v3.GetImRspImData",null]}},GetImRspImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},GetStreamListReq:{$m:{}},GetStreamListRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_list_seq","uint32",0],3:["stream_info_list","<liveroom.liveroom_cs_v3.StreamInfo",null],4:["stream_refresh","uint32",0]}},GetTransReq:{$m:{1:["trans_channel","bytes",[]],2:["trans_list","<liveroom.liveroom_cs_v3.GetTransReqTransData",null]}},GetTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["trans_list_seq","uint32",0],4:["trans_list","<liveroom.liveroom_cs_v3.GetTransRspTransData",null]}},GetTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},GetUserlistReq:{$m:{1:["sort_type","uint32",0],2:["user_index","uint32",0]}},GetUserlistRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["server_user_seq","uint64",{low:0,high:0,unsigned:!0}],3:["server_user_index","int64",{low:0,high:0,unsigned:!1}],4:["ret_user_index","int64",{low:0,high:0,unsigned:!1}],5:["user_base_info_list","<liveroom.liveroom_cs_v3.UserBaseInfo",null]}},GetUserTransReq:{$m:{1:["trans_channel","bytes",[]],2:["user_trans_list","<liveroom.liveroom_cs_v3.GetUserTransReqTransData",null]}},GetUserTransReqTransData:{$m:{1:["trans_type","bytes",[]],2:["trans_local_seq","uint32",0]}},GetUserTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_channel","bytes",[]],3:["user_trans_list","<liveroom.liveroom_cs_v3.GetUserTransRspTransData",null]}},GetUserTransRspTransData:{$m:{1:["err_code","uint32",0],2:["trans_type","bytes",[]],3:["trans_data","bytes",[]],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_seq","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["role","uint32",0]}},HbReq:{$m:{}},HbRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],3:["hb_interval","uint32",0],4:["hb_timeout","uint32",0],5:["stream_seq","uint32",0],6:["user_seq","int64",{low:0,high:0,unsigned:!1}],7:["online_count","uint32",0],8:["big_im_time_window","uint32",0],9:["trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],10:["user_trans_channel_list","<liveroom.liveroom_cs_v3.TransChannel",null],11:["stream_refresh","uint32",0],12:["trans_list_seq","uint32",0],13:["gather_list_seq","uint32",0]}},ImData:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["msg_id","uint64",{low:0,high:0,unsigned:!0}],5:["msg_category","uint32",0],6:["msg_type","uint32",0],7:["msg_content","bytes",[]],8:["send_time","int64",{low:0,high:0,unsigned:!1}]}},LiveroomSessionInfo:{$m:{1:["RoomId","bytes",[]],2:["UserSessionId","uint64",{low:0,high:0,unsigned:!0}],3:["RoomSessionId","uint64",{low:0,high:0,unsigned:!0}],4:["Role","uint32",0]}},PushBigIm:{$m:{1:["msg_list","<liveroom.liveroom_cs_v3.BigImData",null]}},PushIm:{$m:{1:["server_msg_id","uint64",{low:0,high:0,unsigned:!0}],2:["ret_msg_id","uint64",{low:0,high:0,unsigned:!0}],4:["msg_list","<liveroom.liveroom_cs_v3.ImData",null]}},PushStartGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStopGather:{$m:{1:["gather_id","string",""],2:["gather_seq","uint32",0]}},PushStream:{$m:{1:["stream_seq","uint32",0],2:["stream_info_list","<liveroom.liveroom_cs_v3.PushStreamInfo",null]}},PushStreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["stream_src","uint32",0],9:["stream_state","uint32",0],10:["stream_type","uint32",0],11:["stream_nid","uint32",0],12:["extra_info","bytes",[]],13:["create_time","int64",{low:0,high:0,unsigned:!1}],14:["close_type","uint32",0],15:["need_gather","uint32",0]}},PushTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_type","bytes",[]],5:["trans_data","bytes",[]],6:["trans_seq","uint32",0],7:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],8:["trans_channel","bytes",[]],9:["trans_list_seq","uint32",0]}},PushUserInfoUpdated:{$m:{1:["server_user_seq","int64",{low:0,high:0,unsigned:!1}],2:["user_action_list","<liveroom.liveroom_cs_v3.UserAction",null]}},PushUserKickout:{$m:{1:["id_name","bytes",[]],2:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["kickout_reason","int32",0],4:["custom_reason","bytes",[]]}},PushUserLogReport:{$m:{}},PushUserTokenExpire:{$m:{1:["token","string",""],2:["stop_stream_info","liveroom.liveroom_cs_v3.StopStream",null]}},PushUserTrans:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0],4:["trans_send_time","int64",{low:0,high:0,unsigned:!1}],5:["trans_channel","bytes",[]],6:["trans_seq_list","<liveroom.liveroom_cs_v3.PushUserTransInfo",null]}},PushUserTransInfo:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_seq","uint32",0]}},QuitRoomReq:{$m:{}},QuitRoomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},RenewTokenReq:{$m:{1:["token","string",""]}},RenewTokenRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["token_remain_time","uint32",0],3:["stop_stream_id_list","<bytes",null]}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SendBigImReq:{$m:{1:["msg_list","<liveroom.liveroom_cs_v3.SendBigImReqMsgData",null]}},SendBigImReqMsgData:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["msg_timestamp","int64",{low:0,high:0,unsigned:!1}],5:["msg_client_id","bytes",[]]}},SendBigImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["big_im_time_window","uint32",0],3:["msg_list","<liveroom.liveroom_cs_v3.SendBigImRspMsgData",null]}},SendBigImRspMsgData:{$m:{1:["msg_id","bytes",[]],2:["msg_client_id","bytes",[]]}},SendImReq:{$m:{1:["msg_category","uint32",0],2:["msg_type","uint32",0],3:["msg_content","bytes",[]],4:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SendImRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["msg_id","uint64",{low:0,high:0,unsigned:!0}]}},SetTransReq:{$m:{1:["trans_type","bytes",[]],2:["trans_data","bytes",[]],3:["trans_local_seq","uint32",0],4:["trans_channel","bytes",[]]}},SetTransRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["trans_type","bytes",[]],3:["trans_seq","uint32",0],4:["trans_list_seq","uint32",0],5:["trans_channel","bytes",[]]}},SetUserAttrReq:{$m:{1:["use_data_channel","uint32",0],2:["is_modify_use_data_channel","bool",!1],3:["user_type","uint32",0],4:["is_modify_user_type","bool",!1]}},SetUserAttrRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveCustomReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveCustomRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveInviteReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveInviteRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveRequestReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveRequestRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveResultReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveResultRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalLiveStopReq:{$m:{1:["push_message","bytes",[]],2:["to_user_list","<liveroom.liveroom_cs_v3.ToUser",null]}},SignalLiveStopRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null]}},SignalTransmitReq:{$m:{1:["to_user_list","<bytes",null],2:["transmit_data","bytes",[]]}},SignalTransmitResult:{$m:{1:["to_user","bytes",[]],2:["result","liveroom.liveroom_cs_v3.EnumSignalTransmitResult",0]}},SignalTransmitRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["result","<liveroom.liveroom_cs_v3.SignalTransmitResult",null]}},StopStream:{$m:{1:["stream_id_list","<bytes",null]}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["stream_title","bytes",[]],6:["stream_ver","uint32",0],7:["stream_attr","bytes",[]],8:["create_time","int64",{low:0,high:0,unsigned:!1}],9:["stream_src","uint32",0],10:["stream_state","uint32",0],11:["stream_type","uint32",0],12:["stream_nid","uint32",0],13:["extra_info","bytes",[]],14:["need_gather","uint32",0]}},ToUser:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}]}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<liveroom.liveroom_cs_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}},UpdateStreamReq:{$m:{1:["stream_sid","string",""],2:["stream_id","bytes",[]],3:["stream_title","bytes",[]],4:["stream_attr","bytes",[]],5:["extra_info","bytes",[]],6:["client_req_seq","uint32",0],7:["nick_name","bytes",[]]}},UpdateStreamRsp:{$m:{1:["rsp_head","liveroom.liveroom_cs_v3.RspHead",null],2:["stream_seq","uint32",0],3:["stream_ver","uint32",0]}},UserAction:{$m:{1:["action","uint32",0],2:["id_name","bytes",[]],3:["nick_name","bytes",[]],4:["role","uint32",0],5:["login_time","int64",{low:0,high:0,unsigned:!1}]}},UserBaseInfo:{$m:{1:["id_name","bytes",[]],2:["nick_name","bytes",[]],3:["role","uint32",0]}}},proto_switch_v3:{AnchorInfo:{$m:{1:["id_name","bytes",[]],2:["user_id","uint64",{low:0,high:0,unsigned:!0}],3:["nick_name","bytes",[]]}},CommonRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null]}},GatherInfo:{$m:{1:["gather_id","string",""]}},Header:{$m:{1:["cmd","uint32",0],2:["seq","uint32",0],3:["timestamp","int64",{low:0,high:0,unsigned:!1}],4:["controls","bytes",[]],5:["flags","bytes",[]],6:["context_key","uint32",0],101:["dev_traffic_label","bytes",[]]}},LiveroomProtoVersion:{$e:{PROTO_VERSION_NONE:0,RPOTO_V020000:131072}},LoginRoomReq:{$m:{1:["app_id","uint32",0],2:["biz_type","uint32",0],3:["room_id","bytes",[]],4:["room_name","bytes",[]],5:["role","uint32",0],6:["id_name","bytes",[]],7:["nick_name","bytes",[]],8:["device_id","string",""],9:["term_type","liveroom.proto_switch_v3.TermType",0],10:["net_type","liveroom.proto_switch_v3.NetType",0],11:["sdk_conn_type","liveroom.proto_switch_v3.SdkConnType",0],12:["sdk_version","uint32",0],13:["biz_version","string",""],14:["client_stamp","bytes",[]],15:["login_logic","uint32",0],16:["third_token","bytes",[]],17:["login_token","bytes",[]],18:["relogin_token","bytes",[]],19:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],20:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],21:["room_create_flag","uint32",0],22:["user_state_flag","uint32",0],23:["user_count_limit","uint32",0],24:["relate_service","string",""],25:["need_gather_stream","uint32",0],26:["callback_data","bytes",[]],27:["service_flags","uint32",0],28:["license_token","bytes",[]],29:["relogin_type","liveroom.proto_switch_v3.ReloginType",0]}},LoginRoomRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null],2:["switch_session_id","uint64",{low:0,high:0,unsigned:!0}],3:["user_session_id","uint64",{low:0,high:0,unsigned:!0}],4:["room_session_id","uint64",{low:0,high:0,unsigned:!0}],5:["user_id","uint64",{low:0,high:0,unsigned:!0}],6:["ret_timestamp","int64",{low:0,high:0,unsigned:!1}],7:["big_im_time_window","uint32",0],8:["liveroom_hb_interval","uint32",0],9:["liveroom_hb_timeout","uint32",0],10:["online_count","uint32",0],11:["anchor_info","liveroom.proto_switch_v3.AnchorInfo",null],12:["relogin_token","bytes",[]],13:["userlist_merge_timeout","uint32",0],14:["userlist_interval","uint32",0],15:["token_remain_time","uint32",0],16:["trans_list_seq","uint32",0],17:["trans_channel_list","<liveroom.proto_switch_v3.TransChannel",null],18:["stream_count","uint32",0],19:["stream_list_seq","uint32",0],20:["stream_info_list","<liveroom.proto_switch_v3.StreamInfo",null],21:["stream_fetch_flag","uint32",0],22:["stream_list_push_merge_timeout","uint32",0],23:["stream_list_hb_merge_timeout","uint32",0],24:["relate_result_list","<liveroom.proto_switch_v3.RelateResult",null],25:["gather_list_seq","uint32",0],26:["gather_info_list","<liveroom.proto_switch_v3.GatherInfo",null]}},LogoutRoomReq:{$m:{2:["logout_check","bytes",[]]}},LogoutRoomRsp:{$m:{1:["rsp_head","liveroom.proto_switch_v3.RspHead",null]}},MergePushHead:{$m:{1:["qos_flag","uint32",0],2:["send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0],3:["msg_body","bytes",[]]}},MergePushReq:{$m:{1:["head","liveroom.proto_switch_v3.MergePushHead",null],2:["message_list","<liveroom.proto_switch_v3.MergePushInfo",null]}},MergePushRsp:{$m:{1:["message_list","<liveroom.proto_switch_v3.MergePushRspInfo",null],2:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},MergePushRspInfo:{$m:{1:["sub_cmd","uint32",0],2:["sub_seq","uint32",0]}},NetType:{$e:{NT_NONE:0,NT_LINE:1,NT_WIFI:2,NT_2G:3,NT_3G:4,NT_4G:5,NT_UNKNOWN:32}},PushKickout:{$m:{1:["reason","uint32",0],2:["message","string",""],3:["is_need_relogin","uint32",0]}},PushReq:{$m:{1:["head","liveroom.proto_switch_v3.PushReqHead",null],2:["msg_body","bytes",[]]}},PushReqHead:{$m:{1:["sub_cmd","uint32",0],2:["qos_flag","uint32",0],3:["send_time","int64",{low:0,high:0,unsigned:!1}]}},PushRsp:{$m:{1:["code","uint32",0],2:["message","string",""],3:["sub_cmd","uint32",0],4:["server_send_time","int64",{low:0,high:0,unsigned:!1}]}},RelateResult:{$m:{1:["service","string",""],2:["relate_result","uint32",0]}},ReloginType:{$e:{ReloginType_None:0,ReloginType_SdkAuto:1}},RspHead:{$m:{1:["code","uint32",0],2:["message","string",""]}},SdkConnType:{$e:{SdkConnType_None:0,SdkConnType_Tcp:1,SdkConnType_Websocket:2}},StreamInfo:{$m:{1:["stream_id","bytes",[]],2:["stream_sid","string",""],3:["id_name","bytes",[]],4:["nick_name","bytes",[]],5:["create_time","int64",{low:0,high:0,unsigned:!1}],6:["extra_info","bytes",[]],7:["title","bytes",[]],8:["stream_ver","uint32",0],9:["stream_attr","bytes",[]],10:["stream_src","uint32",0],11:["stream_state","uint32",0],12:["stream_type","uint32",0],13:["stream_nid","uint32",0],14:["need_gather","uint32",0]}},TermType:{$e:{TT_NONE:0,TT_PC:1,TT_IOS:2,TT_ANDROID:3,TT_MAC:4,TT_LINUX:5,TT_WEB:6,TT_MINI_PROGRAM:7,TT_UNKNOWN:32}},TransChannel:{$m:{1:["trans_channel","bytes",[]],2:["trans_seq_list","<liveroom.proto_switch_v3.TransSeq",null]}},TransSeq:{$m:{1:["trans_type","bytes",[]],2:["trans_seq","uint32",0]}}}}},"",tn,!1),i=tn.liveroom;var hn,cn={1002:"LoginRoomRsp",1004:"LogoutRoomRsp",1101:"PushReq",1103:"MergePushReq",1105:"PushKickout",10001:"PushUserInfoUpdated",10002:"PushUserKickout",10003:"PushUserLogReport",10004:"PushUserTokenExpire",12001:"PushStream",12002:"PushStream",12003:"PushStream",13001:"PushIm",14001:"PushBigIm",15001:"PushTrans",15002:"PushUserTrans",301002:"EnterRoomRsp",301004:"QuitRoomRsp",301006:"HbRsp",301008:"RenewTokenRsp",301012:"SetTransRsp",301014:"GetTransRsp",302002:"AddStreamRsp",302004:"DeleteStreamRsp",302006:"UpdateStreamRsp",302008:"GetStreamListRsp",303002:"SendImRsp",303006:"SendBigImRsp",303010:"SignalLiveRequestRsp",303012:"SignalLiveResultRsp",303014:"SignalLiveInviteRsp",303016:"SignalLiveStopRsp",303018:"SignalLiveCustomRsp",304002:"GetUserlistRsp"},an=((an=hn=hn||{})[an.LoginRoomReq=1001]="LoginRoomReq",an[an.LoginRoomRsp=1002]="LoginRoomRsp",an[an.LogoutRoomReq=1003]="LogoutRoomReq",an[an.LogoutRoomRsp=1004]="LogoutRoomRsp",an[an.PushReq=1101]="PushReq",an[an.PushRsp=1102]="PushRsp",an[an.MergePushReq=1103]="MergePushReq",an[an.MergePushRsp=1104]="MergePushRsp",an[an.PushKickout=1105]="PushKickout",an[an.PushUserInfoUpdated=10001]="PushUserInfoUpdated",an[an.PushUserKickout=10002]="PushUserKickout",an[an.PushUserLogReport=10003]="PushUserLogReport",an[an.PushUserTokenExpire=10004]="PushUserTokenExpire",an[an.PushIm=13001]="PushIm",an[an.PushBigIm=14001]="PushBigIm",an[an.PushTrans=15001]="PushTrans",an[an.PushUserTrans=15002]="PushUserTrans",an[an.EnterRoomReq=301001]="EnterRoomReq",an[an.EnterRoomRsp=301002]="EnterRoomRsp",an[an.QuitRoomReq=301003]="QuitRoomReq",an[an.QuitRoomRsp=301004]="QuitRoomRsp",an[an.HbReq=301005]="HbReq",an[an.HbRsp=301006]="HbRsp",an[an.RenewTokenReq=301007]="RenewTokenReq",an[an.RenewTokenRsp=301008]="RenewTokenRsp",an[an.SetUserAttrReq=301009]="SetUserAttrReq",an[an.SetUserAttrRsp=301010]="SetUserAttrRsp",an[an.SetTransReq=301011]="SetTransReq",an[an.SetTransRsp=301012]="SetTransRsp",an[an.GetTransReq=301013]="GetTransReq",an[an.GetTransRsp=301014]="GetTransRsp",an[an.GetUserTransReq=301015]="GetUserTransReq",an[an.GetUserTransRsp=301016]="GetUserTransRsp",an[an.AddStreamReq=302001]="AddStreamReq",an[an.AddStreamRsp=302002]="AddStreamRsp",an[an.DeleteStreamReq=302003]="DeleteStreamReq",an[an.DeleteStreamRsp=302004]="DeleteStreamRsp",an[an.UpdateStreamReq=302005]="UpdateStreamReq",an[an.UpdateStreamRsp=302006]="UpdateStreamRsp",an[an.GetStreamListReq=302007]="GetStreamListReq",an[an.GetStreamListRsp=302008]="GetStreamListRsp",an[an.SendImReq=303001]="SendImReq",an[an.SendImRsp=303002]="SendImRsp",an[an.GetImReq=303003]="GetImReq",an[an.GetImRsp=303004]="GetImRsp",an[an.SendBigImReq=303005]="SendBigImReq",an[an.SendBigImRsp=303006]="SendBigImRsp",an[an.SignalLiveRequestReq=303009]="SignalLiveRequestReq",an[an.SignalLiveRequestRsp=303010]="SignalLiveRequestRsp",an[an.SignalLiveResultReq=303011]="SignalLiveResultReq",an[an.SignalLiveResultRsp=303012]="SignalLiveResultRsp",an[an.SignalLiveInviteReq=303013]="SignalLiveInviteReq",an[an.SignalLiveInviteRsp=303014]="SignalLiveInviteRsp",an[an.SignalLiveStopReq=303015]="SignalLiveStopReq",an[an.SignalLiveStopRsp=303016]="SignalLiveStopRsp",an[an.SignalLiveCustomReq=303017]="SignalLiveCustomReq",an[an.SignalLiveCustomRsp=303018]="SignalLiveCustomRsp",an[an.SignalTransmitReq=303019]="SignalTransmitReq",an[an.SignalTransmitRsp=303020]="SignalTransmitRsp",an[an.GetUserlistReq=304001]="GetUserlistReq",an[an.GetUserlistRsp=304002]="GetUserlistRsp",n(3)),ln=n(6),fn=n.n(ln),_n=(ln=n(7),n.n(ln)),dn=(mn.prototype.md5Bytes=function(t){return this.wordArray2Uint8Array(_n()(this.uint8Array2WordArray(t)))},mn.prototype.wordArray2Uint8Array=function(t){for(var i=t.words,n=t.sigBytes,e=new Uint8Array(n),s=0;s<n;s++)e[s]=i[s>>>2]>>>24-s%4*8&255;return e},mn.prototype.uint8Array2WordArray=function(t){for(var i=t.length,n=[],e=0;e<i;e++)n[e>>>2]|=(255&t[e])<<24-e%4*8;return fn.a.create(n,i)},mn);function mn(){}var vn=function(t){return window=window||globalThis,i=unescape||window.unescape,Uint8Array.from(Array.from(i(encodeURIComponent(t))).map((function(t){return t.charCodeAt(0)})));var i},pn=function(t){return window=window||globalThis,i=escape||window.escape,decodeURIComponent(i(String.fromCharCode.apply(String,Array.from(t))));var i},gn=(ln=n(1),n.n(ln));function bn(){return""}function En(){return!1}function Sn(){return!1}function Rn(){return!1}function yn(){return!1}function On(){return!1}function Tn(){return!1}function wn(){return a.UNKNOWN}function In(){var t=c.NT_UNKNOWN,i="";return-1<(i=(i=D("netType")||"").toLocaleUpperCase()).indexOf("4G")?t=c.NT_4G:-1<i.indexOf("2G")?t=c.NT_2G:-1<i.indexOf("3G")?t=c.NT_3G:-1<i.indexOf("WIFI")?t=c.NT_WIFI:-1<i.indexOf("LINE")?t=c.NT_LINE:-1<i.indexOf("NONE")&&(t=c.NT_NONE),t}var Nn,Cn=function(){return(Cn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t}).apply(this,arguments)},kn=(an.util.Long=gn.a,an.configure(),i),zn=i.liveroom_cs_v3,Dn=i.proto_switch_v3,An=((n=Nn=Nn||{})[n.disconnected=0]="disconnected",n[n.broken=1]="broken",n[n.connected=2]="connected",Object.defineProperty(Pn.prototype,"nickName",{get:function(){return vn(this.jt.nickName)},enumerable:!1,configurable:!0}),Object.defineProperty(Pn.prototype,"TermType",{get:function(){return this.jt.ENV%2==0?r.TT_WEB:r.TT_MINIPROGRAM},enumerable:!1,configurable:!0}),Object.defineProperty(Pn.prototype,"Jt",{get:function(){return this.jt.reporter},enumerable:!1,configurable:!0}),Pn.prototype.isDisConnect=function(){return this._state!==Nn.connected},Pn.prototype.getHeader=function(t,i){return t={cmd:t,seq:++this.seq,timestamp:(new Date).getTime()},this.controls&&(t.controls=this.controls),null!=i&&i.contextKey&&(t.context_key=null==i?void 0:i.contextKey),i=Dn.Header.create(t),i=Dn.Header.encode(i).finish(),[t.seq,i]},Pn.prototype.isUaConnect=function(){return this._ua.isConnect()},Pn.prototype.sendMessage=function(t,i,n,e,s,r,o){var u=this;if(void 0===r&&(r={timeout:6e3}),void 0===o&&(o=!0),this.qt.info(zt+" call"),"LoginRoomReq"!==t&&this._state!==Nn.connected)return this.qt.warn(zt+" state "+this._state),e&&e(C.SOCKET_CLOSE),-1;if(Object(A.d)(t))a=t;else if(a=hn[t],Object(A.g)(a))return this.qt.warn(zt+" cmd not found "+t),-1;var h=0,c=Object(A.g)(null==s?void 0:s.roomID)?null==(c=this.jt.roomModulesList[0])?void 0:c.roomID:null==s?void 0:s.roomID,a=("LoginRoomReq"!==t&&c&&(h=this._roomIDKeys[c]),c=this.getHeader(a,{contextKey:h}))[1];return i=this.getHead(a.length,(h=i).length),i=new Uint8Array(Array.from(i).concat(Array.from(a)).concat(Array.from(h))),o&&(a={seq:this.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeout:r.timeout,success:n,error:function(t,i,n){var s;if(u.qt.info(zt+" seq: "+i+" "+JSON.stringify(t)+" "+JSON.stringify(n)),(null==(s=null==t?void 0:t.header)?void 0:s.cmd)!==hn.LoginRoomRsp&&-1<[1002,105].indexOf(null==(s=null==t?void 0:t.body)?void 0:s.err_code))return(null==(s=null==t?void 0:t.header)?void 0:s.cmd)===hn.EnterRoomRsp&&null!=n&&n.roomID?(s=u.jt.roomModulesList.find((function(t){return t.roomID==n.roomID})))?void s.retryRoom():void u.qt.error(zt+" room no found ignore "):void u.rtm.retryRoom();[207,208].indexOf(null==(s=null==t?void 0:t.body)?void 0:s.err_code),e&&e(t,i)},params:s},h=this.sendCommandList.push(a),this.sendCommandMap[a.seq]=h),this.qt.info(zt+" seq: "+c[0]+" cmd: "+t),null!=(o=this.liveroomRequest)&&o.sendRequest({payload:i,ack:"LoginRoomReq"===t},(function(t){u.qt.info(zt+" fail")}),(function(){u.qt.info(zt+" ack")}),{}),c[0]},Pn.prototype.getHead=function(t,i){var n=new Uint8Array(7);return n[0]=49,n[1]=t>>8,n[2]=t-(n[1]<<8),n.set(new Uint8Array(Int32Array.from([i]).buffer).reverse(),3),n},Pn.prototype.handlePush=function(t,i){var n,e,s;49===t[0]&&(n=Dn.Header.decode(t.slice(7,7+(s=(t[1]<<8)+t[2]))),t=t.slice(7+s),cn[n.cmd]?(s=this.decodeResponseBody(n,t),this.swPushCmdList.includes(n.cmd)?this.handleSwitchPush(n,s):(this.qt.info(Dt+" down "+(e=cn[n.cmd]||n.cmd)+" "+JSON.stringify(this.transBuf(s))),e={header:this.transHeader(n),body:this.transRsp(s)},s=this._roomKeyIDs[n.context_key],Object(A.g)(s)||(e.header.room_id=s),this.handleSendCommandMsgRsp(e))):(this.qt.info(Dt+" cmd is not rtc"),this.onSwitchMessage(n,t)))},Pn.prototype.handleSwitchPush=function(t,i){var n,e,s=this._roomKeyIDs[t.context_key];if(s||this.noContextKeyCmdList.includes(t.cmd))if(t.cmd===hn.PushReq)if((e=this.transRsp(i.head)).room_id=s,this.jt.roomModulesList.find((function(t){return t.roomID==s}))){var r,o,u={header:e,body:this.unStructCmdList.includes(i.head.sub_cmd)?{signal_msg:pn(i.msg_body),sub_cmd:i.head.sub_cmd}:11005===i.head.sub_cmd?{custommsg:pn(i.msg_body)}:cn[i.head.sub_cmd]?this.transRsp(this._decode(zn[cn[i.head.sub_cmd]],i.msg_body)):{}};if(this.qt.info(At+" push "+JSON.stringify(this.transBuf(u))),this.rtcPushCmdList.includes(i.head.sub_cmd))switch(i.head.sub_cmd){case hn.PushUserInfoUpdated:this.handlePushUserStateUpdateMsg(u);break;case hn.PushUserKickout:this.transKeysName(u.body,this.loginKeyTransMap),this.handlePushKickout(u,!1);break;case hn.PushTrans:this.handlePushTransMsg(u);break;case hn.PushIm:this.handlePushRoomMsg(u);break;case 11005:this.handlePushCustomMsg(u);break;case 12001:case 12002:case 12003:this.handlePushStreamMsg(u);break;case 11001:case 11002:case 11003:case 11004:this.handlePushSignalMsg(u);break;case hn.PushUserTokenExpire:this.handlePushTokenExpire(u)}else this.qt.info(At+" white "),this.onSwitchMessage(t,i);1==i.head.qos_flag&&(r=Dn.PushRsp.create({code:0,message:"",sub_cmd:i.head.sub_cmd,server_send_time:i.head.send_time}),o=Dn.PushRsp.encode(r).finish(),this.sendMessage("PushRsp",o,void 0,void 0))}else this.qt.warn(At+" room no found ignore ");else t.cmd===hn.MergePushReq?((e=this.transRsp(i.head)).room_id=s,this.jt.roomModulesList.find((function(t){return t.roomID==s}))?(n=[],i.message_list.forEach((function(t){var i;n.push({sub_cmd:t.sub_cmd,sub_seq:t.sub_seq}),t.sub_cmd===hn.PushBigIm&&(i=zn.PushBigIm.decode(t.msg_body),t.msg_body=i)})),delete(e={header:e,body:this.transRsp(i)}).body.head,this.handlePushMergeMsg(e),1==i.head.qos_flag&&(r=Dn.MergePushRsp.create({messages:n,server_send_time:i.head.send_time}),o=Dn.MergePushRsp.encode(r).finish(),this.sendMessage("MergePushRsp",o,void 0,void 0))):this.qt.warn(At+" room no found ignore ")):t.cmd===hn.PushKickout&&this.handlePushKickout({header:t,body:{reason:900<i.reason?i.reason-900:i.reason,msg:i.message,need_relogin:void 0!==i.is_need_relogin?i.is_need_relogin:0}},!0);else this.qt.warn(At+" ctx key not found")},Pn.prototype.handlePushTokenExpire=function(t){},Pn.prototype.handlePushKickout=function(t,i){},Pn.prototype.handlePushStreamMsg=function(t){},Pn.prototype.handlePushSignalMsg=function(t){},Pn.prototype.handlePushMergeMsg=function(t){},Pn.prototype.handlePushCustomMsg=function(t){},Pn.prototype.handlePushRoomMsg=function(t){},Pn.prototype.handlePushTransMsg=function(t){},Pn.prototype.onSwitchMessage=function(t,i){},Pn.prototype.decodeResponseBody=function(t,i){var n=this.onSwitchCmdList.includes(t.cmd)?"proto_switch_v3":"liveroom_cs_v3";return this._decode(this._protoInstance[n][cn[t.cmd]],i)},Pn.prototype.handlePushUserStateUpdateMsg=function(t){},Pn.prototype.login=function(t,i,n){var e,s,r,o=this,u=(this._state==Nn.disconnected&&(this.qt.info(Mt+" state disconnect"),this.closeRequest()),(new Date).getTime()+""),h={net_type:In(),room_id:vn(t.roomID),room_name:vn(t.roomName),nick_name:this.nickName,role:this.jt.role,third_token:vn(t.token),room_create_flag:this.jt.roomCreateFlag,user_state_flag:t.userStateUpdate?1:0,user_count_limit:t.maxMemberCount,relate_service:this.jt.relateService.join()||""};t.isMulti?(s=Cn(Cn({},h),{conn_type:2}),e=Cn(Cn({},s),{room_id:t.roomID,room_name:t.roomName,third_token:t.token}),this.qt.info(Mt+" enter "+JSON.stringify(e)),s=zn.EnterRoomReq.create(s),r=zn.EnterRoomReq.encode(s).finish(),this.sendMessage("EnterRoomReq",r,(function(n,e){o._transLoginRspKeys(n,t),i&&i(n,e)}),(function(t,i){n&&n(t,i)}),{roomID:t.roomID})):(h=Cn(Cn({},h),{app_id:this.jt.appid,id_name:vn(this.jt.idName),device_id:this.jt.deviceID,term_type:this.TermType,sdk_version:this._getNumSDKVersion(),client_stamp:vn(u),relogin_token:this.switchSessionID.notEquals(gn.a.fromInt(0))?vn(this.reloginToken):"",switch_session_id:this.switchSessionID,user_session_id:null!=(h=t.longSid)?h:gn.a.fromInt(0),biz_type:0,biz_version:this.jt.bizVersion||"",login_logic:this.jt.isMultiRoom?3:1,sdk_conn_type:2}),t.roomReasonState===O.Reconnecting&&(h.relogin_type=1),e=Cn(Cn({},h),{id_name:this.jt.idName,nick_name:this.jt.nickName,client_stamp:u,k1_sign:void 0,relogin_token:this.reloginToken,room_id:t.roomID,room_name:t.roomName,user_session_id:t.longSid}),this.logoutCheckToken=t.token,this.qt.info(Mt+" login "+JSON.stringify(e)),this.qt.remoteReport(Mt+" token "+t.token),s=Dn.LoginRoomReq.create(h),r=Dn.LoginRoomReq.encode(s).finish(),this.sendMessage("LoginRoomReq",r,(function(n,e){var s;o.qt.info(Mt+" login rsp"),o.switchSessionID=n.body.switch_session_id,o.reloginToken=n.body.relogin_token,null!=(s=null==n?void 0:n.header)&&s.controls&&(o.controls=null==(s=null==n?void 0:n.header)?void 0:s.controls),o._transLoginRspKeys(n,t),i&&i(n,e)}),(function(t,i){n&&n(t,i)})))},Pn.prototype._transLoginRspKeys=function(t,i){null!=(n=t.header)&&n.context_key&&(this._roomIDKeys[i.roomID]=null==(n=t.header)?void 0:n.context_key,this._roomKeyIDs[null==(n=t.header)?void 0:n.context_key]=i.roomID,t.header.room_id=i.roomID),this.longToStringNumber(t.body,["ret_timestamp"],"toString"),this.transKeysName(t.body,this.loginKeyTransMap),this.keysExist(t.body,["token_remain_time","stream_seq"]);var n={anchor_id_name:t.body.anchor_info.id_name,anchor_id:t.body.anchor_info.user_id,anchor_nick_name:t.body.anchor_info.nick_name};t.body.anchor_info=n},Pn.prototype.transKeysName=function(t,i){i.forEach((function(i){Object(A.g)(t[i[0]])||(t[i[1]]=t[i[0]],delete t[i[0]])}))},Pn.prototype.keysExist=function(t,i){i.forEach((function(i){void 0===t[i]&&(t[i]=0)}))},Pn.prototype.longToStringNumber=function(t,i,n){i.forEach((function(i){gn.a.isLong(t[i])&&(t[i]=t[i][n]())}))},Pn.prototype.logout=function(t,i,n){var e,s,r,o;return t.isMulti?(e={},this.qt.info(xt+" quit "+t.roomID),r=zn.QuitRoomReq.create(e),o=zn.QuitRoomReq.encode(r).finish(),this.sendMessage("QuitRoomReq",o,i,n,{roomID:null==t?void 0:t.roomID})):(e={logout_code:0,logout_check:this.crypto.md5Bytes(vn(this.logoutCheckToken)),user_session_id:t.longSid,logout_logic:this.jt.isMultiRoom?3:1},s=this.transBuf(e),this.qt.info(xt+" logout "+JSON.stringify(s)),r=Dn.LogoutRoomReq.create(e),o=Dn.LogoutRoomReq.encode(r).finish(),this.sendMessage("LogoutRoomReq",o,i,n,{roomID:null==t?void 0:t.roomID}))},Pn.prototype._checkSendMessageList=function(t){for(var i=t.getFirst();null!=i;)t.remove(i),i._data&&i._data.error&&setTimeout((function(){i&&i._data&&i._data.error&&i._data.error(C.TIMEOUT,i._data.seq)}),0),i=t.getFirst()},Pn.prototype._checkMessageListTimeout=function(t,i){for(var n=t.getFirst(),e=Date.parse(new Date+""),s=0,r=this;null!=n&&"break"!==function(){var o,u;return n._data&&n._data.sendTime+n._data.timeout>e||(n._data&&delete i[n._data.seq],t.remove(n),n._data&&null==n._data.error||n._data&&n._data.sendTime+r._sendDataDropTimeout<e||(o=n&&n._data&&n._data.error,u=n&&n._data&&n._data.seq,setTimeout((function(){o&&o(C.TIMEOUT,u)}),0)),++s>=r._sendDataCheckOnceCount)?"break":void(n=t.getFirst())}(););},Pn.prototype.startCheck=function(){var t=this;this._checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this._sendDataCheckTimer=setTimeout((function(){t.startCheck()}),this._sendDataCheckInterval)},Pn.prototype.stopCheck=function(){this._checkSendMessageList(this.sendCommandList),clearTimeout(this._sendDataCheckTimer)},Pn.prototype.handleSendCommandMsgRsp=function(t){var i,n,e=this.sendCommandMap[t.header.seq];null!=e&&(n=null==(i=e._data)?void 0:i.params,delete this.sendCommandMap[t.header.seq],this.sendCommandList.remove(e),0===t.body.err_code?setTimeout((function(){i&&null!=i.success&&i.success(t,t.header.seq)}),0):setTimeout((function(){i&&null!=i.error&&i.error(t,t.header.seq,n)}),0))},Pn.prototype.getReqHead=function(t){return{}},Pn.prototype.heartBeat=function(t,i,n){var e=this,s=zn.HbReq.create({});s=zn.HbReq.encode(s).finish(),this.sendMessage("HbReq",s,(function(i,n){e.transKeysName(i.body,[["hb_interval","hearbeat_interval"],["hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"]]),i.body.server_user_seq=i.body.user_seq.toNumber(),e.longToStringNumber(i.body,["ret_timestamp"],"toNumber"),t&&t(i,n)}),i,{roomID:null==n?void 0:n.roomID})},Pn.prototype.fetchUserList=function(t,i,n,e){var s=this,r=(t=Cn({},t),this.transBuf(t));return this.qt.info(Ut+" "+JSON.stringify(r)),r=zn.GetUserlistReq.create(t),t=zn.GetUserlistReq.encode(r).finish(),this.sendMessage("GetUserlistReq",t,(function(t,n){s.qt.info(Ut+" suc "+n),s.transKeysName(t.body,[["user_base_info_list","user_baseinfos"]]),s.longToStringNumber(t.body,["server_user_seq","server_user_index","ret_user_index"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Pn.prototype.sendRoomMsg=function(t,i,n,e){var s=this,r=(t={msg_category:t.msg_category,msg_type:t.msg_type,msg_content:vn(t.msg_content)},this.transBuf(t));return this.qt.info("zm.lrh.srm.1 "+JSON.stringify(r)),r=zn.SendImReq.create(t),t=zn.SendImReq.encode(r).finish(),this.sendMessage("SendImReq",t,(function(t,n){s.longToStringNumber(t.body,["msg_id"],"toNumber"),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Pn.prototype.sendReliableMessage=function(t,i,n,e){t={trans_type:vn(t.trans_type),trans_data:vn(t.trans_data),trans_local_seq:t.trans_local_seq,trans_channel:vn(t.trans_channel)};var s=this.transBuf(t);return this.qt.info("zm.lrh.srm.0 "+JSON.stringify(s)),s=zn.SetTransReq.create(t),t=zn.SetTransReq.encode(s).finish(),this.sendMessage("SetTransReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Pn.prototype.fetchReliableMessage=function(t,i,n,e){var s=t.fetch_array.map((function(t){return{trans_type:vn(t.trans_type),trans_local_seq:t.trans_seq}}));return t={trans_channel:vn(t.trans_channel),trans_list:s},s=this.transBuf(t),this.qt.info("zm.lrh.frm "+JSON.stringify(s)),s=zn.GetTransReq.create(t),t=zn.GetTransReq.encode(s).finish(),this.sendMessage("GetTransReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Pn.prototype.sendCustomCommand=function(t,i,n,e){var s=this,r=t.dest_id_name.map((function(t){return{id_name:vn(t)}}));return r=Cn({to_user_list:r,push_message:vn(t.custom_msg)},t),t=this.transBuf(r),this.qt.info("zm.lrh.scc "+JSON.stringify(t)),t=zn.SignalLiveCustomReq.create(r),r=zn.SignalLiveCustomReq.encode(t).finish(),this.sendMessage("SignalLiveCustomReq",r,(function(t,n){i&&i(s.transRsp(t),n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},Pn.prototype.sendBigRoomMessage=function(t,i,n,e){t={msg_list:t.msgs.map((function(t){return{msg_category:t.msg_category,msg_type:t.msg_type,msg_timestamp:gn.a.fromNumber(Date.now()),msg_content:vn(t.msg_content),msg_client_id:vn(t.bigmsg_client_id)}}))};var s=this.transBuf(t);return this.qt.info("zm.lrh.sbrm "+JSON.stringify(s)),s=zn.SendBigImReq.create(t),t=zn.SendBigImReq.encode(s).finish(),this.sendMessage("SendBigImReq",t,i,n,{roomID:null==e?void 0:e.roomID})},Pn.prototype.sendSignalCmd=function(t,i,n,e){var s="";switch(t.sub_cmd){case 1003:s="SignalLiveInviteReq";break;case 1001:s="SignalLiveRequestReq";break;case 1002:s="SignalLiveResultReq";break;case 1004:s="SignalLiveStopReq"}var r=t.dest_id_name.map((function(t){return{id_name:vn(t)}}));return t={push_message:vn(t.signal_msg),to_user_list:r},r=this.transBuf(t),this.qt.info("zm.lrh.ssc "+JSON.stringify(r)),r=zn[s].create(t),t=zn[s].encode(r).finish(),this.sendMessage(s,t,i,n,{roomID:null==e?void 0:e.roomID})},Pn.prototype.sendStreamUpdate=function(t,i,n,e){var s,r=this;try{s=JSON.parse(t.stream_msg)}catch(t){}var o,u="",h=(this.qt.info(Lt+" "+JSON.stringify(Cn(Cn({},t),{third_token:void 0}))),this.qt.remoteReport(Lt+" token "+t.third_token),this.jt.roomModulesList.find((function(t){return t.roomID==e.roomID})));if(!h)return this.qt.error(Lt+" room no found ignore "),-1;switch(t.sub_cmd){case 2001:u="AddStreamReq",o={stream_id:vn(s.stream_id),extra_info:vn(s.extra_info),client_req_seq:this.seq+1,third_token:vn(t.third_token||"")};break;case 2002:u="DeleteStreamReq",o={stream_id:vn(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1};break;case 2003:u="UpdateStreamReq",o={stream_id:vn(s.stream_id),stream_sid:s.stream_sid,client_req_seq:this.seq+1,extra_info:vn(s.extra_info)}}var c=this.transBuf(o);return this.qt.info(Lt+" "+JSON.stringify(c)),c=zn[u].create(o),c=zn[u].encode(c).finish(),this.sendMessage(u,c,(function(t,n){r.qt.info(Lt+" suc "+u+" "+JSON.stringify(t)),t.header.room_id=h.roomID,i&&i(t,n)}),(function(t,i){r.qt.info(Lt+" fail "+u+" "+JSON.stringify(t)),n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})},Pn.prototype.getStreamList=function(t,i,n,e){var s,r,o=this;this.jt.roomModulesList.find((function(t){return t.roomID==e.roomID}))?(s=this.transBuf(r={}),this.qt.info(Pt+" "+JSON.stringify(s)),s=zn.GetStreamListReq.create(r),r=zn.GetStreamListReq.encode(s).finish(),this.sendMessage("GetStreamListReq",r,(function(t,n){var e;null!=(e=t.body)&&e.stream_info_list.forEach((function(t){t.create_time=t.create_time.toNumber()})),o.transKeysName(t.body,[["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]]),i&&i(t,n)}),(function(t,i){n&&n(t,i)}),{roomID:null==e?void 0:e.roomID})):this.qt.error(Pt+" room no found ignore "+e.roomID)},Pn.prototype.transBuf=function(t){var i=this,n={};return Object.keys(t).forEach((function(e){["logout_check","k2_sign","k1_sign"].includes(e)?n[e]=t[e]:i.transReqBytes(n,t,e)})),n},Pn.prototype.transReqBytes=function(t,i,n){var e=this;if(gn.a.isLong(i[n]))t[n]=i[n].toString();else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(s){return e.transReqBytes(t[n],i[n],s)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var s=0;s<i[n].length;s++)!function(s){var r={};Object.keys(i[n][s]).forEach((function(t){e.transReqBytes(r,i[n][s],t)})),t[n].push(r)}(s)}else t[n]="[object Uint8Array]"===Object.prototype.toString.call(i[n])?pn(i[n]):i[n]},Pn.prototype.transHeader=function(t){return t.timestamp=gn.a.isLong(t.timestamp)?t.timestamp.toString():t.timestamp,t},Pn.prototype.transRsp=function(t){var i=this,n=t&&t.rsp_head?this.transRspHead(t.rsp_head):{},e=Cn(Cn({},t),n),s=(delete e.rsp_head,{});return Object.keys(e).forEach((function(t){"k2_sign"===t?s[t]=e[t]:i.transBytes(s,e,t)})),s},Pn.prototype.transBytes=function(t,i,n){var e=this;if(gn.a.isLong(i[n]))t[n]=i[n];else if("[object Object]"===Object.prototype.toString.call(i[n]))t[n]={},Object.keys(i[n]).forEach((function(s){return e.transBytes(t[n],i[n],s)}));else if("[object Array]"===Object.prototype.toString.call(i[n])&&"[object Object]"===Object.prototype.toString.call(i[n][0])){t[n]=[];for(var s=0;s<i[n].length;s++)!function(s){var r={};Object.keys(i[n][s]).forEach((function(t){e.transBytes(r,i[n][s],t)})),t[n].push(r)}(s)}else t[n]="[object Uint8Array]"===Object.prototype.toString.call(i[n])?pn(i[n]):i[n]},Pn.prototype.transRspHead=function(t){return t?{err_code:t.code||0,err_message:t.message}:{}},Pn.prototype._decode=function(t,i){return Cn({},t.decode(i))},Pn.prototype._handleDisconnected=function(t,i){var n=this;this.qt.info(jt+" call"),this._state=Nn.disconnected,this.jt.useNetAgent&&t===R.TIMEOUT&&this.jt.roomModulesList.forEach((function(t){t.roomTryHandler&&(n._ua.isConnect()?(n.qt.info(jt+" ua is connect"),t.roomTryHandler.active()):(n.qt.info(jt+" ua is disconnect"),n._ua.connectUa()))}))},Pn.prototype._handleBroken=function(){this.qt.info(qt+" call"),this._state=Nn.broken,this.jt.useNetAgent&&this.handleReconnecting(qt)},Pn.prototype.handleReconnecting=function(t){var i=this;this.jt.roomModulesList.forEach((function(n){var e=n.roomTryHandler,s=n.roomHandler;e&&(e.invalid(),e.onactive=function(n,e){i.qt.info(t+" onactive"),s.transError(e),s.disconnectedHandle(e)},e.startMaxTime(),s._roomStateHandle("CONNECTING",O.Reconnecting,C.NETWORK_BROKEN))}))},Pn.prototype._handleConnected=function(t){var i=this;this.qt.info("zm.lrh.hc call "+t),this._state=Nn.connected,this.jt.useNetAgent&&t===b.AUTO&&this.jt.roomModulesList.forEach((function(t){t.roomTryHandler&&i._ua.isConnect()&&t.roomTryHandler.active()}))},Pn.prototype.renewToken=function(t,i,n,e){var s=this,r=zn.RenewTokenReq.create(t={token:t.token});r=zn.RenewTokenReq.encode(r).finish(),t=this.transBuf(t),this.qt.info("zm.lrh.rt "+JSON.stringify(t)),this.sendMessage("RenewTokenReq",r,(function(t,n){s.keysExist(t.body,["token_remain_time"]),i&&i(t,n)}),n,{roomID:null==e?void 0:e.roomID})},Pn.prototype.reset=function(){this.qt.info("zm.lrh.r.0 call "),this._state=Nn.disconnected,this.switchSessionID=gn.a.fromInt(0),this._sendDataCheckTimer&&clearTimeout(this._sendDataCheckTimer)},Pn.prototype.closeRequest=function(){var t;null!=(t=this.liveroomRequest)&&t.closeRequest()},Pn.prototype.resetSessionInfo=function(){this.switchSessionID=gn.a.fromInt(0)},Pn.prototype._getNumSDKVersion=function(){var t=0===this.jt.ENV?6:7,i=this.rtm.version.split(".").map((function(t){return parseInt(t)}));return t<<28|i[0]<<20|i[1]<<8|i[2]},Pn);function Pn(t,i,n,e,s){var r=this;this.qt=t,this.jt=i,this._ua=n,this._dataReport=e,this.rtm=s,this.seq=0,this.sendCommandList=new p,this.sendCommandMap={},this.logoutCheckToken="",this.zPushSid="0",this.loginKeyTransMap=[["user_session_id","session_id"],["liveroom_hb_interval","hearbeat_interval"],["liveroom_hb_timeout","hearbeat_timeout"],["big_im_time_window","bigim_time_window"],["trans_channel_list","trans_seqs"],["stream_list_seq","stream_seq"],["stream_info_list","stream_info"]],this._sendDataCheckOnceCount=100,this._sendDataDropTimeout=1e4,this._sendDataCheckInterval=2e3,this._protoInstance=kn,this._roomKeyIDs={},this._roomIDKeys={},this.swPushCmdList=[hn.PushReq,hn.MergePushReq,hn.PushKickout],this.onSwitchCmdList=[hn.LoginRoomRsp,hn.LogoutRoomRsp,hn.PushKickout,hn.PushReq,hn.MergePushReq],this.noContextKeyCmdList=[1105],this.rtcPushCmdList=[10001,10002,10004,11001,11002,11003,11004,11005,12001,12002,12003,13001,15001],this._state=Nn.disconnected,this.unStructCmdList=[11001,11002,11003,11004],this.reloginToken="",this.crypto=new dn,this.liveroomRequest=this._ua.getPCRequest(y.SERVICE_SWITCH4LIVEROOM),this.switchSessionID=gn.a.fromInt(0),null!=(t=this.liveroomRequest)&&t.on("connected",(function(t){r._handleConnected(t)})),null!=(i=this.liveroomRequest)&&i.on("broken",(function(t){r._handleBroken()})),null!=(n=this.liveroomRequest)&&n.on("disconnected",(function(t,i){r._handleDisconnected(t,i)})),null!=(e=this.liveroomRequest)&&e.on("downLoadMessage",(function(t,i){r.handlePush(t,i)})),null!=(s=this.liveroomRequest)&&s.on("exception",(function(t,i){r.qt.info("zm.lrh.o.0 except "+JSON.stringify(t))})),null!=(t=this.liveroomRequest)&&t.on("pcBrokenEvent",(function(t){var i=Ii,n=r.Jt.createSpan(u.H,{key:mi},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null!=(i=this.liveroomRequest)&&i.on("pcDisconnectedEvent",(function(t){var i=Ni,n=r.Jt.createSpan(u.H,{key:mi},{key:""},i.event);n.setAttributes({service_no:i.service_no(null==t?void 0:t.service_no)}),n.end()})),null!=(n=this.liveroomRequest)&&n.on("pcConnectedEvent",(function(t){var i=wi,n=r.Jt.createSpan(u.H,{key:mi},{key:""},i.event);n.setAttributes({service_no:i.service_no(t.service_no),recv_time:i.recv_time((new Date).getTime()),proxy_link_sources:i.proxy_link_sources(t.proxy_link_sources),connect_stream:i.connect_stream(t.connect_stream)}),n.end()}))}var Mn=(Object.defineProperty(Un.prototype,"logger",{get:function(){return this.qt},enumerable:!1,configurable:!0}),Object.defineProperty(Un.prototype,"stateCenter",{get:function(){return this.jt},enumerable:!1,configurable:!0}),Un.prototype.listenCallBack=function(){var t=this;this.roomServicer.handlePushCustomMsg=function(i){t.handlePushCustomMsg(i)},this.roomServicer.handlePushTokenExpire=function(i){var n,e=null==(e=null==(e=null==i?void 0:i.body)?void 0:e.stop_stream)?void 0:e.stream_id_list.map((function(t){return pn(t)}));null!=(n=null==(n=null==i?void 0:i.body)?void 0:n.stop_stream)&&(n.stream_id_list=e),t.jt.actionListener("_tokenExpired",i)},this.roomServicer.handlePushKickout=function(i,n){var e;n?function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))}([],t.jt.roomModulesList,!0).forEach((function(t){t.roomHandler.handlePushKickout(i,!0,!0)})):(e=null==(n=null==i?void 0:i.header)?void 0:n.room_id,n=t.jt.roomModulesList.find((function(t){return t.roomID==e})),t.roomServicer.longToStringNumber(i.body,["session_id"],"toString"),n?n.roomHandler.handlePushKickout(i):t.qt.error("zm.lrh.pk room no found ignore "+JSON.stringify(null==(n=i.header)?void 0:n.room_id)))},this.roomServicer.handlePushStreamMsg=function(i){t.handlePushStreamMsg(i)},this.roomServicer.handlePushSignalMsg=function(i){t.handlePushSignalMsg(i)},this.roomServicer.handlePushMergeMsg=function(i){t.handlePushMergeMsg(i)},this.roomServicer.handlePushRoomMsg=function(i){t.handlePushRoomMsg(i)},this.roomServicer.handlePushTransMsg=function(i){t.handlePushTransMsg(i)},this.roomServicer.onSwitchMessage=function(i,n){t.onSwitchMessage(i,n)},this.roomServicer.handlePushUserStateUpdateMsg=function(i){var n,e,s,r=null==(o=null==i?void 0:i.header)?void 0:o.room_id,o=t.jt.roomModulesList.find((function(t){return t.roomID==r}));o?(s=i.body.user_action_list.map((function(t){return{Action:t.action,IdName:t.id_name,NickName:t.nick_name,Role:t.role,LoginTime:t.login_time.toString()}})),e=t.jt.reporter.createSpan(u.H,{key:Wt.event,par:r},{key:""},"/liveroom/recv_user_update_info"),s={body:{user_actions:s,user_list_seq:i.body.server_user_seq.toNumber(),room_id:r}},e.setAttributes({user_list_seq:null==(n=null===s?void 0:s.body)?void 0:n.user_list_seq,update_user:null==(n=null===s?void 0:s.body)?void 0:n.user_actions}),e.end(),o.userHandler.handlePushUserStateUpdateMsg(s)):t.qt.error("zm.lrh.puu room no found ignore "+JSON.stringify(i))}},Un.prototype.isDisConnect=function(){return!!this.roomServicer&&this.roomServicer.isDisConnect()},Un.prototype.isUaConnect=function(){var t;return null==(t=this.roomServicer)?void 0:t.isUaConnect()},Un.prototype.sendMessage=function(t,i,n,e,s,r,o){var u;return null==(u=this.roomServicer)?void 0:u.sendMessage(t,i,n,e,s,r)},Un.prototype.handlePushTokenExpire=function(t){},Un.prototype.handlePushKickout=function(t,i){},Un.prototype.handlePushStreamMsg=function(t){},Un.prototype.handlePushSignalMsg=function(t){},Un.prototype.handlePushMergeMsg=function(t){},Un.prototype.handlePushCustomMsg=function(t){},Un.prototype.handlePushRoomMsg=function(t){},Un.prototype.handlePushTransMsg=function(t){},Un.prototype.onSwitchMessage=function(t,i){},Un.prototype.handlePushUserStateUpdateMsg=function(t){},Un.prototype.login=function(t,i,n){var e;null!=(e=this.roomServicer)&&e.login(t,i,n)},Un.prototype.logout=function(t,i,n){var e;return null==(e=this.roomServicer)?void 0:e.logout(t,i,n)},Un.prototype.startCheck=function(){var t;null!=(t=this.roomServicer)&&t.startCheck()},Un.prototype.stopCheck=function(){var t;null!=(t=this.roomServicer)&&t.stopCheck()},Un.prototype.getReqHead=function(t){var i;return null==(i=this.roomServicer)?void 0:i.getReqHead(t)},Un.prototype.heartBeat=function(t,i,n){var e;null!=(e=this.roomServicer)&&e.heartBeat(t,i,n)},Un.prototype.fetchUserList=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.fetchUserList(t,i,n,e)},Un.prototype.sendRoomMsg=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendRoomMsg(t,i,n,e)},Un.prototype.sendReliableMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendReliableMessage(t,i,n,e)},Un.prototype.fetchReliableMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.fetchReliableMessage(t,i,n,e)},Un.prototype.sendCustomCommand=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendCustomCommand(t,i,n,e)},Un.prototype.sendBigRoomMessage=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendBigRoomMessage(t,i,n,e)},Un.prototype.sendSignalCmd=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendSignalCmd(t,i,n,e)},Un.prototype.sendStreamUpdate=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.sendStreamUpdate(t,i,n,e)},Un.prototype.getStreamList=function(t,i,n,e){var s;return null==(s=this.roomServicer)?void 0:s.getStreamList(t,i,n,e)},Un.prototype.renewToken=function(t,i,n,e){var s;null!=(s=this.roomServicer)&&s.renewToken(t,i,n,e)},Un.prototype.reset=function(){var t;null!=(t=this.roomServicer)&&t.reset()},Un.prototype.closeRequest=function(){var t;null!=(t=this.roomServicer)&&t.closeRequest()},Un);function Un(t,i,n,e,s){this.qt=t,this.jt=i,this.ua=n,this._dataReport=e,this.rtm=s,this.roomServicer=new An(t,i,n,e,s),this.listenCallBack()}var xn=function(t,i,n,e){return new(n=n||Promise)((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):((i=t.value)instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},Ln=function(t,i){var n,e,s,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:u(0),throw:u(1),return:u(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(u){return function(h){var c=[u,h];if(n)throw new TypeError("Generator is already executing.");for(;r=o&&c[o=0]?0:r;)try{if(n=1,e&&(s=2&c[0]?e.return:c[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,c[1])).done)return s;switch(e=0,(c=s?[2&c[0],s.value]:c)[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,e=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===c[0]||2===c[0])){r=0;continue}if(3===c[0]&&(!s||c[1]>s[0]&&c[1]<s[3]))r.label=c[1];else if(6===c[0]&&r.label<s[1])r.label=s[1],s=c;else{if(!(s&&r.label<s[2])){s[2]&&r.ops.pop(),r.trys.pop();continue}r.label=s[2],r.ops.push(c)}}c=i.call(t,r)}catch(h){c=[6,h],e=0}finally{n=s=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}},jn=function(t,i,n){if(n||2===arguments.length)for(var e,s=0,r=i.length;s<r;s++)!e&&s in i||((e=e||Array.prototype.slice.call(i,0,s))[s]=i[s]);return t.concat(e||Array.prototype.slice.call(i))},qn=(Object.defineProperty(Gn.prototype,"logger",{get:function(){return this.qt},enumerable:!1,configurable:!0}),Object.defineProperty(Gn.prototype,"stateCenter",{get:function(){return this.jt},enumerable:!1,configurable:!0}),Object.defineProperty(Gn.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),Object.defineProperty(Gn.prototype,"isUseNetAgent",{get:function(){return this.jt.useNetAgent},enumerable:!1,configurable:!0}),Gn.prototype.destroyRTM=function(){this.jt.roomModulesList.some((function(t){return!(null!=t&&t.isLogout()||"DISCONNECTED"===t.roomState)}))&&this.logoutRoom(),this.Jt.setUnloadState(u.I),this.Jt.destroy(),this.Zt()},Gn.prototype._initCallback=function(){this.proxyRes=$,this.actionSuccessCallback=H,this.actionErrorCallback=G,this.getServerError=J,this.generateRandumNumber=W,this.unregisterCallback=Y,this.logReportCallback=B,this.registerCallback=q},Gn.prototype._createNetAgent=function(){var t=this,i=(this.qt.info(lt+" call"),this.netAgent.on("disconnected",(function(i){t.qt.info("".concat(lt," netAgent disconnect"))})),this.netAgent.on("connected",(function(){t.qt.info("".concat(lt," netAgent connect")),t.Jt.setNetStateCheck(),t.isUseNetAgent&&(t.fetchAppConfig(),t.jt.roomModulesList.forEach((function(i){i.roomTryHandler&&t.netAgent.isConnect()&&i.roomTryHandler.active(!0)})))})),this.netAgent.on("broken",(function(i){t.qt.info("".concat(lt," netAgent broken")),i===E.CLOSE&&t.jt.roomModulesList.forEach((function(t){t.resetSessionInfo()}))})),this.netAgent.on("dispatchEvent",(function(i,n,e){var s;t.qt.info("".concat(lt," dispatch")),"start"===n?(s=t.Jt.createSpan(u.H,{key:mi},{key:""},"/zegoconn/auto_dispatch"),t.jt.requestList[i]=s):"end"===n&&(s=t.jt.requestList[i])&&(s.setAttributes({domain_list:e.domains}),s.end())})),this.netAgent.on("connectedEvent",(function(i,n,e){var s;t.qt.info("".concat(lt," connect")),"start"===n?(s=t.Jt.createSpan(u.H,{key:Ht.event},{key:mi},mi,!0),t.jt.requestList[i]=s):"end"===n&&(s=t.jt.requestList[i])&&(n=e.connectEvents||[],s.setAttributes({request_count:pi(e.count),connect_id:vi(e.connectid),events:gi(n),error:(null==(i=n[0])?void 0:i.error)||0}),s.end())})),this.netAgent.on("requestEvent",(function(i,n,e){var s;t.qt.info("".concat(lt," request")),"start"===n?(s=t.Jt.createSpan(u.H,{key:Ht.event},{key:Ri},Ri,!0),t.jt.requestList[i]=s):"end"===n&&(s=t.jt.requestList[i])&&(s.setAttributes({req_location:yi(e.na_req_location),http_code:e.status_code,error:e.err_code}),s.end())})),this.netAgent.on("disConnectedEvent",(function(i){var n=i.duration,e=i.server,s=(i=i.connectid,t.qt.info("".concat(lt," disconnect")),t.Jt.createSpan(u.H,{key:Ht.event},{key:""},"/zegoconn/disconnect"));s.setAttributes({url:Ei(e),connect_duration:Si(n),connect_id:bi(i)}),s.end()})),null!=(i=this.netAgent)&&i.on("clientInfo",(function(i){var n=i.timeOffset;Object(A.d)(n)&&t.Jt.setTimeOffset(n),t._updateTimeOffsetInterval()})),[]);i=Q,this.qt.info("".concat(lt," domains ").concat(JSON.stringify(i))),i=i.map((function(t){return"wss://".concat(t,"/accesshub")})),this.netAgent.setNetAgentDefaultServers(i),this.dispatchServers=[],this.netAgent.setDispatchConnectServers(this.dispatchServers)},Gn.prototype._getMainDomain=function(t){return(t=t.split("."))[t.length-2]+"."+t[t.length-1]},Gn.prototype._bindWxListener=function(){var t=this;wx.onNetworkStatusChange.bind(this)((function(i){i.isConnected?t._netOnLineHandle():t._netOffLineHandle()}))},Gn.prototype.retryRoom=function(){var t=this;this.jt.roomModulesList.forEach((function(i){i.roomTryHandler&&t.netAgent.isConnect()&&(i.resetSessionInfo(),i.roomTryHandler.active(!0))}))},Gn.prototype._netOnLineHandle=function(){this.qt.info("zm.wl network is online"),this.jt.networkState!==h.online&&(this.jt.networkState=h.online,this.Zt())},Gn.prototype.Zt=function(){this.Qt&&(clearInterval(this.Qt),this.Qt=null)},Gn.prototype.Xt=function(){var t=this;this.Zt(),this.qt.info(Gt+" start network online detection.."),this.Qt=setInterval((function(){t.jt.networkState!==h.offline&&t.Zt(),t.jt.useNetAgent&&t.netAgent.isConnect()&&(t.qt.info(Gt+" detected network online"),t._netOnLineHandle(),t.Zt())}),this.ti)},Gn.prototype._netOffLineHandle=function(){this.qt.info("zm.wl network is broken"),this.jt.networkState!==h.offline&&(this.jt.networkState=h.offline,this.Xt())},Gn.prototype.setLogConfig=function(t){this.qt.info(ot+" call");var i,n=this.Jt.createSpan(u.H,{key:Ht.event},{key:Jt.event},Jt.event);if(t.logLevel&&["debug","info","warn","error","report","disable"].includes(t.logLevel)&&(this.qt.setLogLevel(t.logLevel),n.setAttributes({log_level:Jt.log_level(t.logLevel)})),t.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(t.remoteLogLevel)&&n.setAttributes({remote_log_level:Jt.remote_log_level(t.remoteLogLevel)}),Object(A.f)(t.logURL)&&(t.logURL.startsWith("wss://")||t.logURL.startsWith("https://")))null!=(i=this.jt.geoFencing)&&i.logreport?this.qt.info(ot+" geo exist"):(this.qt.setLogServer(t.logURL),0===this.jt.ENV&&(this.jt.logDomain=null==(i=this.qt.url)?void 0:i.split("/")[2],this.Jt.setConfig({serverUrl:"wss://"+this.jt.logDomain+"/zglog/tlog"}))),n.setAttributes({log_url:Jt.log_url(t.logURL)}),n.end();else if(t.logURL)return this.qt.error(ot+"log url must be a wss or https url"),this.Jt.setError(n,Jt.error.kInvalidParamError),!1;return this.qt.info(ot+" call success"),n.end(),!0},Gn.prototype.setDebugVerbose=function(t){var i=this.Jt.createSpan(u.H,{key:Ht.event},{key:Vt},Vt);Object(A.b)(t)&&(this.jt.debug=t,this.jt.debugCustom=!0,i.setAttributes({debug:$t(t?"true":"false")})),i.end(),this.qt.info("zm.sdv call success")},Gn.prototype._setDebug=function(t){Object(A.f)(t)&&-1<t.indexOf("wss")?this.jt.debug=K(t):Array.isArray(t)&&0<t.length&&t.every((function(t){return Object(A.f)(t)&&-1<t.indexOf("wss")}))?this.jt.debug=K(t[0]):this.qt.info(rt+" server wrong"),this.jt.testEnvironment=this.jt.debug},Gn.prototype.renewToken=function(t,i){var n,e=this,s=this.Jt.createSpan(u.H,{key:Wt.event,par:i},{key:""},ti.event);return Object(A.g)(i)||Object(A.f)(i)&&""!=i?(n=this.getRoomModules(i)||this.jt.roomModulesList[0])?Object(A.f)(t)&&n.roomTryHandler?(t===n.roomTryHandler.token?(this.qt.info(_t+" token has not changed"),s.setAttributes({error:ti.error.INPUT_PARAM.code,message:"token has not changed"}),s.end()):(s.setAttributes({token:ti.token(t)}),this.jt.configRoomAuth?null!=(i=this.liveRoomHandler)&&i.renewToken({token:t},(function(i){var r;null!=(r=n.roomTryHandler)&&r.renewLocalToken(t,null==(r=null==i?void 0:i.body)?void 0:r.token_remain_time),e.Jt.setReporterInfo(e.jt.idName||"",t),e.jt.configCheckToken=!0,s.end(),e.qt.info(_t+" "+JSON.stringify(i))}),(function(i){var r=null==(r=null==i?void 0:i.body)?void 0:r.err_code;e.Jt.setError(s,i),!r||1000002014!==r&&2014!==r?e.qt.error(_t+" "+JSON.stringify(i)):(e.jt.configCheckToken=!1,null!=(r=n.roomTryHandler)&&r.renewLocalToken(t),e.qt.warn(_t+" "+JSON.stringify(i)))}),n):(null!=(i=n.roomTryHandler)&&i.renewLocalToken(t),this.Jt.setReporterInfo(this.jt.idName||"",t),s.end())),!0):(Object(A.f)(t)&&!n.roomTryHandler?(this.qt.error(_t+" calling must after loginRoom"),this.Jt.setError(s,ti.error.NOT_LOGIN)):(this.qt.error(_t+" token must be string and not empty"),this.Jt.setError(s,ti.error.INPUT_PARAM)),!1):(this.qt.error(_t+" calling must after loginRoom"),this.Jt.setError(s,ti.error.NOT_LOGIN),!1):(this.qt.error(_t+" roomID must be string and no empty"),!1)},Gn.prototype.loginRoom=function(t,i,n,e){var s=this;return this.qt.info(ut+" call by user "+(null==n?void 0:n.userID)+" "+t+" "+this.version),new Promise((function(r,u){return xn(s,void 0,void 0,(function(){var s,c,a,l,f,_=this;return Ln(this,(function(d){switch(d.label){case 0:return 1!==this.jt.ENV?[3,2]:[4,new Promise((function(t){wx.getNetworkType({success:function(i){_.jt.networkState="none"===i.networkType?h.offline:h.online,t()},fail:function(i){_.qt.error(rt+" network "+JSON.stringify(i)),_.jt.networkState=h.online,t()}})}))];case 1:d.sent(),d.label=2;case 2:return c=this._loginReport(r,u,t,i,e),f=c.interResolve,s=c.interReject,c=c.loginSpan,(e=e||{}).maxMemberCount||(e.maxMemberCount=0),a=this.getRoomModules(t),l=Wt.error,a?(this.qt.setSessionInfo(this.jt.appid,t,"",n.userID,"",this.jt.sdKVersion),s(l.REPEATEDLY_LOGIN)):((a=new Xi(t,this.jt,this.qt,this._dataReport,this,this.liveRoomHandler,this.service)).roomTryHandler||(a.roomTryHandler=new Di(this.qt,this.jt,a)),a.roomTryHandler.init(this.jt.roomRetryTime),a.roomTryHandler.initRoom(a.roomHandler,t,i,n,this.jt.server,this.jt.serverBak,e),a.roomTryHandler.setLoginRoomCallback(f,s),a.roomHandler._roomStateHandle("CONNECTING",O.Logining,{code:0,msg:""}),(f=function(t,i){var n,e,s=[],r={};for(n in t)r[t[n].order]=t[n],t[n].key=n;for(e in r)s.push(r[e]);for(var o=0;o<s.length;o++)for(var u=s[o].rules,h=0;h<u.length;h++){var c={key:s[o].key,value:s[o].value,action:i.action,logger:i.logger},a=c.value,l=u[h].name?""+u[h].name:"";if((void 0===a&&l===zi.NOT_EMPTY||void 0!==a)&&Mi[l]&&(l=Mi[l](c.key,a,c.action,c.logger,u[h]))!=Pi)return l}return Pi}({roomID:{order:0,value:t,rules:[{name:zi.NOT_EMPTY,error:l.ROOM_ID_NULL},{name:zi.TYPE_STRING,error:l.INPUT_PARAM,extMsg:"roomID must be string"},{name:zi.MAX_LENGTH_128,error:l.ROOM_ID_TOO_LONG},{name:zi.ILLEGAL_CHARACTERS,error:l.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:i,rules:[{name:zi.NOT_EMPTY,error:l.INPUT_PARAM},{name:zi.TYPE_STRING,error:l.INPUT_PARAM}]},user:{order:2,value:n,rules:[{name:zi.NOT_EMPTY,error:l.INPUT_PARAM,extMsg:" param user error."},{name:zi.TYPE_OBJECT,error:l.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:n.userID,rules:[{name:zi.NOT_EMPTY,error:l.USER_ID_NULL,extMsg:" param user error."},{name:zi.TYPE_STRING,error:l.INPUT_PARAM,extMsg:" param userID error."},{name:zi.MAX_LENGTH_64,error:l.USER_ID_TOO_LONG},{name:zi.ILLEGAL_CHARACTERS,error:l.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:n.userName,rules:[{name:zi.TYPE_STRING,error:l.INPUT_PARAM,extMsg:" userName must be string."},{name:zi.MAX_LENGTH_256,error:l.USER_NAME_TOO_LONG}]},config:{order:5,value:e,rules:[]},"config.maxMemberCount":{order:6,value:e.maxMemberCount,rules:[{name:zi.TYPE_INTEGER,error:l.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:ut,logger:this.qt}))!==Pi?(a.roomHandler._roomStateHandle("DISCONNECTED",O.LoginFailed,f.error,f.extMsg),s(f.error,f.extMsg)):(this.qt.setSessionInfo(this.jt.appid,"","",n.userID,"",this.version),0<this.jt.roomModulesList.length&&1==this.jt.isMultiRoom?a.isMulti=!0:jn([],this.jt.roomModulesList,!0).forEach((function(t){return t.roomHandler.logout()})),e&&(a.config=e),this.jt.roomModulesList.push(a),this.netAgent&&(this.jt.idName=n.userID,this.netAgent.setUserInfo(n.userID),this.jt.actionListener("_roomLogin",t,i),this.netAgent.isConnect())&&this.fetchAppConfig(i),c.setAttributes({id_name:n.userID}),this.Jt.setCommonAttributes({id_name:n.userID}),this.Jt.setReporterInfo(n.userID,i),this.qt.setTokenInfo(i,n.userID),this.Jt.setSpanInMap(c,{key:Wt.event,par:t}),this.jt.setMultiRoom=!0,a.roomTryHandler.startMaxTime(),this.isUseNetAgent&&!this.netAgent.isConnect()?(this.qt.info(ut," us is not connected"),a.roomHandler.setRunState(o.trylogin),this.netAgent.connectUa()):(this.isUseNetAgent&&(this.jt.networkState=h.online),a.roomTryHandler.active(!0)))),[2]}}))}))}))},Gn.prototype.handleLogUpload=function(t){var i="";t&&t.app_config?i=t.app_config.domain:this.jt.appConfig&&this.jt.appConfig.app_config&&(i=this.jt.appConfig.app_config.domain),this.qt.info(at+" call"),this.qt.url?this.qt.info(at+" log is connected"):(null!=(t=this.jt.geoFencing)&&t.logreport?(this.jt.logDomain=null==(t=this.jt.geoFencing)?void 0:t.logreport,i=this._getMainDomain(null==(t=this.jt.geoFencing)?void 0:t.logreport)):this.jt.testEnvironment?(this.jt.logDomain="weblogger-hk-test.zegocloud.com",i="zegocloud.com"):0===this.stateCenter.ENV&&this.jt.svrDomains.logreport?(this.jt.logDomain=this.jt.svrDomains.logreport,i=this._getMainDomain(this.jt.svrDomains.logreport)):i&&(this.jt.logDomain="weblogger".concat(this.jt.appid,"-api.").concat(i)),i?(t="",0===this.jt.ENV?(t="wss://".concat(this.jt.logDomain,"/log"),this.Jt.setConfig({serverUrl:"wss://".concat(this.jt.logDomain,"/zglog/tlog")})):t="https://".concat(this.jt.logDomain,"/httplog"),this.qt.setLogServer(t)):this.qt.warn(at+" appconfig no domain"))},Gn.prototype.fetchAppConfigByTargetToken=function(t,i){return xn(this,void 0,void 0,(function(){return Ln(this,(function(t){return[2,null]}))}))},Gn.prototype.fetchAppConfig=function(t){return xn(this,void 0,void 0,(function(){var i,n,e,s,r,o,h,c;return Ln(this,(function(a){switch(a.label){case 0:if(this.jt.appConfigFetched)return this.qt.warn(ct+" config fetched"),[2];if(!this.getUserID())return this.qt.warn(ct+" user not exist"),[2];if(i="",t)i=t;else{if(!(0<this.jt.roomModulesList.length))return this.qt.warn(ct+" token not exist"),[2];i=this.getToken()}n=this.Jt.createSpan(u.H,{key:Ht.event},{key:""},"/sdk_config/init"),this.qt.info(ut+" initConfig etag: "+this.jt.appConfigEtag),e=!!this.jt.appConfig,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",i,5e3,this.jt.appConfigEtag,{isSpecial:!1})];case 2:if(h=a.sent(),r=h.code,o=h.data,s=h.etag,h=h.retryCount,n.setAttributes({trigger_reason:Oi(this.jt.appConfig?"refresh":"normal"),try_count:Ti(h||0)}),n.end(),this.jt.appConfigFetched=!0,this.qt.info(ut+" initConfig code:"+r+" data: "+JSON.stringify(o)+" etag: "+s),this.jt.appConfigEtag!==s){if(0==Object.keys(o).length)return this.qt.info(ut+" initConfig data null"),[2];this.jt.appConfig={app_config:h=o.app_config,media_config:{publish_config:(r=o.media_config).publish_config,play_config:r=r.play_config},speedlog_config:{charge_info_report_no_playing:(o=o.speedlog_config.charge_info_report_no_playing)||0}},this.jt.appConfigEtag=s}return this.handleLogUpload(),!e&&this.jt.appConfig&&this.jt.actionListener("_appConfigRsp"),!this.jt.netAppConfig&&this.jt.appConfig&&(this.jt.netAppConfig=Object.assign(this.jt.appConfig),this.jt.actionListener("_netAppConfigRsp",this.jt.netAppConfig),this._onAppConfigUpdate)&&this._onAppConfigUpdate(this.jt.netAppConfig),[3,4];case 3:return h=a.sent(),this.qt.error(ut+" fail "+JSON.stringify(h)),n.setAttributes({error:null==h?void 0:h.code}),n.end(),[20012,20008,20019].includes(null==h?void 0:h.code)&&(c=20019===(null==h?void 0:h.code)?JSON.parse(JSON.stringify(C.SDK_NOT_SPECIAL)):JSON.parse(JSON.stringify(C.APPID_INVALID)),this.jt.roomModulesList.forEach((function(t){t.roomTryHandler&&t.roomTryHandler.loginFail(c)}))),[3,4];case 4:return[2]}}))}))},Gn.prototype._cloudReportNotify=function(t,i,n){},Gn.prototype._loginReport=function(t,i,n,e,s){var r=this,o=Wt,h=this.Jt.createSpan(u.I,{key:Ht.event},{key:""},o.event);return h.setAttributes({svr_env:o.svr_env(this.jt.testEnvironment?"test":"online"),token:o.token(e)}),s&&(Object(A.b)(s.userUpdate)&&h.setAttribute("user_state_update",o.user_state_update(s.userUpdate?1:0)),Object(A.d)(s.maxMemberCount))&&h.setAttributes({max_member_cnt:o.max_member_cnt(s.maxMemberCount)}),{interResolve:function(i){var e=r.getRoomSessionID(n),s=r.getRoomModules(n),u=r.getSessionId(n);h.setAttributes({room_id:o.room_id(n),room_sid_string:o.room_sid_string(e),liveroom_sid_string:o.liveroom_sid_string(u),try_cnt:o.try_cnt(null==(e=null==s?void 0:s.roomTryHandler)?void 0:e.retryActiveCount),server:o.server(null==(u=null==s?void 0:s.roomHandler)?void 0:u.server),room_mode:o.room_mode(r.jt.isMultiRoom?1:0),role:o.role(r.jt.role),audience_create_room:o.audience_create_room(r.jt.roomCreateFlag?1:0),max_member_cnt:o.max_member_cnt((null==s?void 0:s.maxMemberCount)||0)}),h.end(),t(i)},interReject:function(t,e){var s,u;void 0===e&&(e=""),h.setAttributes({room_id:o.room_id(n)}),t.code<2e9&&1e9<t.code||t.code<1e6?(s=V(t.code,t.msg),u=X(t.code,r.isUseNetAgent)):s={code:t.code,message:t.msg},s&&r.Jt.setError(h,{code:s.code,msg:s.message+e}),u&&C[u]&&(t.code=C[u].code,t.msg.includes("unknown"))&&(t.msg=C[u].msg),i(t.code&&t.msg&&""!==e?{code:t.code,msg:t.msg+e}:t)},loginSpan:h}},Gn.prototype.logoutRoom=function(t){var i=this,n=(this.qt.info(ht+" call by user "+t),[]);if(this.jt.roomModulesList.length){if(void 0===t)jn([],this.jt.roomModulesList,!0).forEach((function(t){i._logoutSpan(t),n.push(t.roomID),t.roomHandler.logout(!0)}));else{if(!Object(A.f)(t)||""==t)return this.qt.error(ht+" roomID must be string and not empty"),void this._logoutSpan(void 0,ii.error.INPUT_PARAM);var e=this.getRoomModules(t);e?(this._logoutSpan(e),n.push(t),e.roomHandler.logout()):(this.qt.error(ht+" room not exist"),this._logoutSpan(void 0,ii.error.ROOM_NOT_EXIST,t))}this.Jt.deleteCommonAttributes(["id_name"]),this.Jt.clearRoomSpans(n)}else this.qt.warn(ht+" no room")},Gn.prototype.uploadLog=function(){var t=this;return new Promise((function(i,n){t.qt.info("zm.zip.udlg call"),t.qt.uploadStorageLog().then((function(){t.qt.info("zm.zip.udlg call success"),i({errorCode:0,extendedData:"upload logs success!"})})).catch((function(i){t.qt.error("zm.zip.udlg upload zip log failed, result: "+((null==i?void 0:i.message)||"unknown")),n({errorCode:C.UPLOAD_LOG_ERROR.code,extendedData:C.UPLOAD_LOG_ERROR.msg+", result: "+((null==i?void 0:i.message)||"unknown")})}))}))},Gn.prototype.sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Gn.prototype._sendCustomCommand=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Gn.prototype.sendBroadcastMessage=function(t,i){return new Promise((function(t,i){console.error(T),i()}))},Gn.prototype._sendBroadcastMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(T),i()}))},Gn.prototype.setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Gn.prototype._setRoomExtraInfo=function(t,i,n){return new Promise((function(t,i){console.error(T),i()}))},Gn.prototype.sendBarrageMessage=function(t,i){return new Promise((function(t,i){console.error(T),i()}))},Gn.prototype._sendBarrageMessage=function(t,i,n,e){return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(t,i){console.error(T),i()}))},Gn.prototype.sendRelayMessage=function(t,i,n,e,s){console.error(T)},Gn.prototype.requestJoinLive=function(t,i,n,e,s){return console.error(T),!1},Gn.prototype.inviteJoinLive=function(t,i,n,e,s){return console.error(T),!1},Gn.prototype.endJoinLive=function(t,i,n,e){return console.error(T),!1},Gn.prototype.respondJoinLive=function(t,i,n,e,s){return console.error(T),!1},Gn.prototype.getVersion=function(){return this.version},Gn.prototype.setSdkBizVersion=function(t){Object(A.f)(t)&&""!==t&&(this.jt.bizVersion=t)},Gn.prototype.on=function(t,i){var n=this.Jt.createSpan(u.H,{key:Bt},{key:""},Yt.event);return n.setAttributes({listener:Yt.listener(t)}),this.jt.listenerList[t]?Object(A.c)(i)?(-1==this.jt.listenerList[t].indexOf(i)&&this.jt.listenerList[t].push(i),n.end(),!0):(this.qt.error(ft+" listener callBack must be funciton"),this.Jt.setError(n,Yt.error.INPUT_PARAM," listener callBack must be function"),!1):(this.qt.error(ft+" event "+t+" no found"),this.Jt.setError(n,Yt.error.INPUT_PARAM," event "+t+" no found"),!1)},Gn.prototype.off=function(t,i){var n,e=this.Jt.createSpan(u.H,{key:Bt},{key:""},"/sdk/off_listener");return e.setAttributes({listener:Xt(t)}),this.jt.listenerList[t]?(n=this.jt.listenerList[t],i?0<=(i=n.indexOf(i))&&n.splice(i,1):this.jt.listenerList[t]=[],e.end(),!0):(this.qt.error("zm.off listener no found"),this.Jt.setError(e,Yt.error.INPUT_PARAM," event "+t+" no found"),!1)},Gn.prototype._on=function(t,i){return this.jt.listenerList[t]?Object(A.c)(i)?(-1==this.jt.listenerList[t].indexOf(i)&&this.jt.listenerList[t].push(i),!0):(this.qt.error(ft+" listener callBack must be funciton"),!1):(this.qt.error(ft+" event "+t+" no found"),!1)},Gn.prototype._off=function(t,i){var n;return this.jt.listenerList[t]?(n=this.jt.listenerList[t],i?n.splice(n.indexOf(i),1):this.jt.listenerList[t]=[],!0):(this.qt.error("zm.off listener no found"),!1)},Gn.prototype.isTestEnvironment=function(){return this.jt.testEnvironment},Gn.prototype.isLogin=function(t){return!!(t=this.getRoomModules(t)||this.jt.roomModulesList[0])&&t.isLogin()},Gn.prototype.getMultiRoom=function(){return this.jt.isMultiRoom},Gn.prototype.getAppID=function(){return this.jt.appid},Gn.prototype.getUserID=function(){return this.jt.idName},Gn.prototype.getUserName=function(){return this.jt.nickName},Gn.prototype.getToken=function(t){return(this.getRoomModules(t)||this.jt.roomModulesList[0]).token},Gn.prototype.setRoomCreateFlag=function(t){this.jt.roomCreateFlag=t},Gn.prototype.setRole=function(t){this.jt.role=t},Gn.prototype.getSessionId=function(t){return(t=this.getRoomModules(t)||this.jt.roomModulesList[0])?t.userSidString:"0"},Gn.prototype.getRoomSessionID=function(t){return(t=this.getRoomModules(t)||this.jt.roomModulesList[0])?t.roomSidString:"0"},Gn.prototype.getAppConfig=function(){return this.jt.appConfig},Gn.prototype.setTestPackageSize=function(t){this.jt.testNetPackageSize=t},Gn.prototype.setCloudEnv=function(t){this.cloudSetting&&(this.cloudSetting.zegoSetting.options.online="online"===t)},Gn.prototype.setAccess=function(t){},Gn.prototype.enableMultiRoom=function(t){var i=this.Jt.createSpan(u.H,{key:Ht.event},{key:""},_i.event);return Object(A.b)(t)?(i.setAttribute("is_multi",_i.is_multi(t)),0<this.jt.roomModulesList.length||this.jt.setMultiRoom?(this.qt.error("zm.emr multi room can only be set once before first login"),this.Jt.setError(i,_i.error.kInvalidParamError),!1):(i.end(),this.jt.isMultiRoom=t,this.jt.setMultiRoom=!0)):(this.qt.error("zm.emr param must be boolean"),this.Jt.setError(i,_i.error.kAlreadyLoginError),!1)},Gn.prototype.getRoomModules=function(t){return this.jt.roomModulesList.find((function(i){return i.roomID==t}))},Gn.prototype._onAppConfigUpdate=function(t){},Gn.prototype._onBeforePageUnload=function(){},Gn.use=function(t){switch(t.type){case"message":case"live":t.install(Gn,Xi,Fi,Mn)}},Gn.setEngineOptions=function(t){Gn.engineOptions=t},Gn.prototype.resetRoomTokenTimer=function(t,i){(t=this.getRoomModules(t)||this.jt.roomModulesList[0])&&i&&0<i&&t.roomHandler.resetTokenTimer(1e3*i)},Gn.prototype.isDisConnect=function(){return this.liveRoomHandler.isDisConnect()},Gn.prototype.sendMessage=function(t,i,n,e){this.liveRoomHandler.sendMessage(t,i,n,e)},Gn.prototype.getNetworkInfo=function(){return this.netAgent.getNTP()},Gn.prototype.setProtoFormat=function(t){if(!["json","pb"].includes(t=void 0===t?"json":t))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.jt.protoFormat=t},Gn.prototype.setSdkLoginRelateService=function(t){Array.isArray(t)&&t.every((function(t){return Object(A.f)(t)}))&&(this.jt.relateService=t)},Gn.prototype.getRoomID=function(){return this.jt.roomid},Gn.prototype.getServerTimeOffset=function(){return this.jt.serverTimeOffset},Gn.prototype.getReqHead=function(t){return t=Object(A.f)(t)&&""!==t&&this.getRoomModules(t)||this.jt.roomModulesList[0],this.liveRoomHandler.getReqHead(t)},Gn.prototype.sendSwitchMessage=function(t,i){throw this.qt.error("".concat("zm.ssm"," ").concat(C.WHITE_BOARD_VERSION_ERROR.msg)),C.WHITE_BOARD_VERSION_ERROR},Gn.prototype.onSwitchMessage=function(t){t&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=t)},Gn.prototype.onAppConfigUpdate=function(t){t&&(this._onAppConfigUpdate=t)},Gn.prototype.onBeforePageUnload=function(t){t&&(this._onBeforePageUnload=t)},Gn.prototype.getProtoVer=function(){return e.SWITCH_TWO},Gn.prototype.sendBusinessMessage=function(t,i,n){return Object(A.d)(t)&&i?this.liveRoomHandler.sendMessage(t,i,void 0,void 0,n,void 0,!1):-1},Gn.prototype._logoutSpan=function(t,i,n){var e,s=this,r=this.Jt.createSpan(u.I,{key:Ht.event},{key:ii.event,par:null==t?void 0:t.roomID},ii.event,!0);r.setAttributes({is_multi:ii.is_multi(this.jt.isMultiRoom),is_send_cmd_net:ii.is_send_cmd_net(!0)}),t?((e=t.roomHandler).updateTimes(),r.setAttributes({room_id:ii.room_id(null==t?void 0:t.roomID),room_sid_string:ii.room_sid_string(null==t?void 0:t.roomSidString),liveroom_sid_string:ii.liveroom_sid_string(null==t?void 0:t.userSidString),valid_d:e.validTime,total_d:e.totalTime,tempbroken_cnt:e.brokenCounts})):Object(A.f)(n)&&r.setAttributes({room_id:ii.room_id(n),valid_d:0,total_d:0,tempbroken_cnt:0}),i?this.Jt.setError(r,i):r.end(),setTimeout((function(){s.Jt.flush()}),200)},Gn.prototype.getMsgSpan=function(t,i,n){return this.Jt.createSpan(u.H,{key:Wt.event,par:i},{key:t,par:i},t,n=void 0!==n&&n)},Gn.prototype._updateTimeOffsetInterval=function(){var t=this;Object(A.d)(this.netAgent.timeOffset)&&this.Jt.setTimeOffset(this.netAgent.timeOffset),this.timeOffsetUpdateTimer=setTimeout((function(){t._updateTimeOffsetInterval()}),9e5)},Gn.rtmVersion="2.2.0",Gn.proxyCtrl=null,Gn.pageID="",Gn);function Gn(t,i,n,e,r,o,h,c){var a;if(this.qt=n,this._dataReport=e,this.Jt=r,this.version=o,this._options=c,this.service={},this.Qt=null,this.ti=1e3,this.id="",this._roomLoginResponseListener=function(){},this.jt=new Ui(this.qt,this._dataReport),this.jt.ENV=h,this.jt.product="rtc_web",this.getReportSeq=d,this.getSeq=_,this._initCallback(),this.jt.deviceID=(void 0===(n=h)&&(n=0),(n=D("z_deviceID"))||((new Date).getTime(),z("z_deviceID",n=Z()),n)),Gn.pageID||(Gn.pageID=Z()),e=this.jt.id=Z(),this.logger.info("".concat(rt," deviceID: ").concat(this.jt.deviceID," , pageID: ").concat(Gn.pageID," , instID: ").concat(e)),this.Jt.init(t,h,this.jt.deviceID),this.Jt.setLogger(this.qt),this.jt.reporter=this.Jt,o=this.Jt.createSpan(u.H,{key:""},{key:(r=Ht).event},r.event,!0),0!=h&&1!=h||this._setDebug(i),c="Express",null!=(n=this._options)&&n.reportData&&(a=null==(n=null==(e=this._options)?void 0:e.reportData)?void 0:n.version,c=(null==(n=null==(e=this._options)?void 0:e.reportData)?void 0:n.project)||c),o.setAttributes({biz_type:r.biz_type(0),project:r.project(c),servers:r.servers(Object(A.f)(i)?[i]:i),liveroom_version:r.liveroom_version(a),is_from_cache:r.is_from_cache(!1),sev_env:r.sev_env(this.jt.testEnvironment?"test":"online")}),function(t,i,n){if(t&&Object(A.d)(t)&&j(t)){if(i&&(Object(A.f)(i)||Array.isArray(i))&&""!=i)return 1;n.error("ccp.0 server must be string or string array and not empty")}else n.error("ccp.0 appid must be positive integer number and not empty")}(t,i,this.qt)){this.jt.appid=t,this.jt.configOK=!0,this.jt.sdKVersion=this.version,this.netAgent=new I,this.qt.setSessionInfo(this.jt.appid,"","","","",this.version),this.netAgent.init(),this.netAgent.setLogger(this.qt),this.netAgent.setAppInfo(e={appID:this.jt.appid,env:this.jt.ENV,mode:this.jt.mode}),this.liveRoomHandler=new Mn(this.qt,this.jt,this.netAgent,this._dataReport,this),this._createNetAgent(),o.setAttributes({use_na:r.use_na(1)}),o.end(),Object(A.f)(i)?(this.jt.server=i,this.jt.serverBak=i):Array.isArray(i)&&0<i.length&&(this.jt.server=i[0],this.jt.serverBak=i[1]||i[0]),this.qt.info("".concat(rt,"  ").concat(null===navigator||void 0===navigator?void 0:navigator.appVersion," ").concat(this.version," rtmVersion: ").concat(Gn.rtmVersion," logVersion:").concat(s.ZegoLogger.logVersion)),this._bindWxListener();try{var l,f={brand:(l=wx.getSystemInfoSync()).brand,model:l.model,system:l.system,platform:l.platform,version:l.version,SDKVersion:l.SDKVersion};this.qt.warn(rt+" "+JSON.stringify(f)),o.setAttribute("mini_sys_infos",f),o.end()}catch(t){this.qt.warn(rt+" get system info error")}this.qt.setSessionInfo(this.jt.appid,"","","","",this.version)}else this.qt.error("".concat(rt," init sdk error")),this.Jt.setError(o,r.error.kInvalidParamError);this.jt.onListener("roomLoginResponse",this._roomLoginResponseListener)}Bn.prototype.setAttributes=function(t){this._dataReport.addMsgInfo(this._seq,t)},Bn.prototype.setAttribute=function(t,i){this._dataReport.addMsgInfo(this._seq,{key:i})},Bn.prototype.end=function(t){this._dataReport.uploadReport(this._seq)};var Hn=Bn;function Bn(t,i){this._dataReport=t,this._seq=i}$n.prototype.init=function(t,i,n){},$n.prototype.setConfig=function(t){},$n.prototype.loadScript=function(t,i,n,e){return Promise.resolve()},$n.prototype.setReporterInfo=function(t,i){},$n.prototype.flush=function(t){},$n.prototype.destroy=function(){},$n.prototype.setCommonStates=function(t){},$n.prototype.setResource=function(t){},$n.prototype.setCommonAttributes=function(t){},$n.prototype.deleteCommonAttributes=function(t){},$n.prototype.clearRoomSpans=function(t){},$n.prototype.setPublicPros=function(t){},$n.prototype.createSpan=function(t,i,n,e,s){i&&i.key&&i.par?(o=i.par1?"_"+i.par1:"",!(r=null==(r=this._reportList[i.key])?void 0:r[i.par+o])&&i.bak_key&&(r=null==(u=this._reportList[i.bak_key])?void 0:u[i.par+o])):i&&!(r=this._reportList[i.key])&&i.bak_key&&(r=this._reportList[i.bak_key]),r=r||this._reportList[Ht.event];var r,o,u=d();return this.dataReport.newReport(u,e),i=new Hn(this.dataReport,u),s&&(n.par?(this._reportList[n.key]||(this._reportList[n.key]={}),this._reportList[n.key][n.par+(o=n.par1?"_"+n.par1:"")]=i):this._reportList[n.key]=i),i},$n.prototype.setSpanInMap=function(t,i){i.par?(this._reportList[i.key]||(this._reportList[i.key]={}),this._reportList[i.key][i.par+(i.par2?"_"+i.par2:"")]=t):this._reportList[i.key]=t},$n.prototype.spanEnd=function(t,i,n){var e;t.par?(e=t.par1?"_"+t.par1:"",e=this._reportList[t.key]&&this._reportList[t.key][t.par+e],this._reportList[t.key]&&!n&&delete this._reportList[t.key][t.par]):(e=this._reportList[t.key],n||delete this._reportList[t.key]),e&&(this.dataReport.addMsgInfo(e.seq,i),this.dataReport.uploadReport(e.seq))},$n.prototype.spanSetAttributes=function(t,i){var n,e;t.par?(n=t.par1?"_"+t.par1:"",!(e=this._reportList[t.key]&&this._reportList[t.key][t.par+n])&&t.bak_key&&(e=this._reportList[t.bak_key]&&this._reportList[t.bak_key][t.par+n])):!(e=this._reportList[t.key])&&t.bak_key&&(e=this._reportList[t.key]),e&&(this.dataReport.addMsgInfo(e.seq,i),this.dataReport.uploadReport(e.seq))},$n.prototype.spanAppendAttribute=function(t,i,n){this.qt.warn("zm.zr.saa not support this func "+(null==t?void 0:t.key))},$n.prototype.setError=function(t,i,n){this.dataReport.uploadReport(t.seq,void 0,i,n)},$n.prototype.setLogger=function(t){},$n.prototype.setTimeOffset=function(t){},$n.prototype.setUnloadState=function(t){},$n.prototype.setNetStateCheck=function(){};var Vn=$n;function $n(t){this.qt=t,this._reportList={},this._publicPros={},this.dataReport=new s.ZegoDataReport(t)}Yn.prototype.enableMultiRoom=function(t){return this.zegoWebRTM.enableMultiRoom(t)},Yn.prototype.loginRoom=function(t,i,n,e){return this.zegoWebRTM.loginRoom(t,i,n,e)},Yn.prototype.logoutRoom=function(t){return this.zegoWebRTM.logoutRoom(t)},Yn.prototype.renewToken=function(t,i){return this.zegoWebRTM.renewToken(t,i)},Yn.prototype.sendBarrageMessage=function(t,i){return this.zegoWebRTM.sendBarrageMessage(t,i)},Yn.prototype.sendBroadcastMessage=function(t,i){return this.zegoWebRTM.sendBroadcastMessage(t,i)},Yn.prototype.sendCustomCommand=function(t,i,n){return this.zegoWebRTM.sendCustomCommand(t,i,n)},Yn.prototype.setRoomExtraInfo=function(t,i,n){return this.zegoWebRTM.setRoomExtraInfo(t,i,n)},Yn.prototype.setLogConfig=function(t){return this.zegoWebRTM.setLogConfig(t)},Yn.prototype.setDebugVerbose=function(t){return this.zegoWebRTM.setDebugVerbose(t)},Yn.prototype.on=function(t,i){return this.zegoWebRTM.on(t,i)},Yn.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},Yn.prototype.off=function(t,i){return this.zegoWebRTM.off(t,i)},Yn.use=function(t){qn.use(t)},Yn.setGeoFence=function(t,i){},Yn.setEngineOptions=function(t){qn.setEngineOptions(t)},Yn.setCloudProxyConfig=function(t,i,n){},Yn.setLocalProxyConfig=function(t,i){},Yn.version="2.2.0";var Jn=Yn;function Yn(t,i,n,e){this.logger=new s.ZegoLogger(n=void 0===n?0:n),this.dataReport=new s.ZegoDataReport(this.logger),this.reporter=new Vn(this.logger),this.zegoWebRTM=new qn(t,i,this.logger,this.dataReport,this.reporter,Yn.version,n,e)}}],e={},i.m=n,i.c=e,i.d=function(t,n,e){i.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,n){if(1&n&&(t=i(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(i.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var s in t)i.d(e,s,function(i){return t[i]}.bind(null,s));return e},i.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(n,"a",n),n},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=10);function i(t){var s;return(e[t]||(s=e[t]={i:t,l:!1,exports:{}},n[t].call(s.exports,s,s.exports,i),s.l=!0,s)).exports}var n,e}(n(100))},533:function(t){"undefined"!=typeof self&&self,t.exports=function(){return i={0:function(t,i,n){"use strict";function e(t){return"number"==typeof t}function s(t){return"string"==typeof t}function r(t){return"boolean"==typeof t}function o(t){return void 0===t}function u(t){return null!==t&&t instanceof Object}function h(t){return"function"==typeof t}function c(t){return t instanceof Array}n.d(i,"d",(function(){return e})),n.d(i,"f",(function(){return s})),n.d(i,"b",(function(){return r})),n.d(i,"g",(function(){return o})),n.d(i,"e",(function(){return u})),n.d(i,"c",(function(){return h})),n.d(i,"a",(function(){return c}))},1:function(t,i,n){var e=function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=null;try{i=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}function n(t,i,n){this.low=0|t,this.high=0|i,this.unsigned=!!n}function e(t){return!0===(t&&t.__isLong__)}function s(t){var i=Math.clz32(t&-t);return t?31-i:i}Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=e;var r={},o={};function u(t,i){var n,e,s;return i?(s=0<=(t>>>=0)&&t<256)&&(e=o[t])?e:(n=c(t,0,!0),s&&(o[t]=n),n):(s=-128<=(t|=0)&&t<128)&&(e=r[t])?e:(n=c(t,t<0?-1:0,!1),s&&(r[t]=n),n)}function h(t,i){if(isNaN(t))return i?g:p;if(i){if(t<0)return g;if(d<=t)return y}else{if(t<=-m)return O;if(m<=t+1)return R}return t<0?h(-t,i).neg():c(t%_|0,t/_|0,i)}function c(t,i,e){return new n(t,i,e)}n.fromInt=u,n.fromNumber=h,n.fromBits=c;var a=Math.pow;function l(t,i,n){if(0===t.length)throw Error("empty string");if(i="number"==typeof i?(n=i,!1):!!i,"NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return i?g:p;if((n=n||10)<2||36<n)throw RangeError("radix");var e;if(0<(e=t.indexOf("-")))throw Error("interior hyphen");if(0===e)return l(t.substring(1),i,n).neg();for(var s=h(a(n,8)),r=p,o=0;o<t.length;o+=8){var u=Math.min(8,t.length-o),c=parseInt(t.substring(o,o+u),n);r=(u<8?(u=h(a(n,u)),r.mul(u)):r=r.mul(s)).add(h(c))}return r.unsigned=i,r}function f(t,i){return"number"==typeof t?h(t,i):"string"==typeof t?l(t,i):c(t.low,t.high,"boolean"==typeof i?i:t.unsigned)}n.fromString=l,n.fromValue=f;var _=4294967296,d=_*_,m=d/2,v=u(1<<24),p=u(0),g=(n.ZERO=p,u(0,!0)),b=(n.UZERO=g,u(1)),E=(n.ONE=b,u(1,!0)),S=(n.UONE=E,u(-1)),R=(n.NEG_ONE=S,c(-1,2147483647,!1)),y=(n.MAX_VALUE=R,c(-1,-1,!0)),O=(n.MAX_UNSIGNED_VALUE=y,c(0,-2147483648,!1)),T=(n.MIN_VALUE=O,n.prototype);return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},T.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";var i,n;if(this.isNegative())return this.eq(O)?(n=h(t),n=(i=this.div(n)).mul(n).sub(this),i.toString(t)+n.toInt().toString(t)):"-"+this.neg().toString(t);for(var e=h(a(t,6),this.unsigned),s=this,r="";;){var o=s.div(e),u=(s.sub(o.mul(e)).toInt()>>>0).toString(t);if((s=o).isZero())return u+r;for(;u.length<6;)u="0"+u;r=""+u+r}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(O)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,i=31;0<i&&0==(t&1<<i);i--);return 0!=this.high?i+33:i+1},T.isZero=function(){return 0===this.high&&0===this.low},T.eqz=T.isZero,T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||0<=this.high},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(t){return e(t)||(t=f(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&this.high===t.high&&this.low===t.low},T.eq=T.equals,T.notEquals=function(t){return!this.eq(t)},T.neq=T.notEquals,T.ne=T.notEquals,T.lessThan=function(t){return this.comp(t)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(t){return this.comp(t)<=0},T.lte=T.lessThanOrEqual,T.le=T.lessThanOrEqual,T.greaterThan=function(t){return 0<this.comp(t)},T.gt=T.greaterThan,T.greaterThanOrEqual=function(t){return 0<=this.comp(t)},T.gte=T.greaterThanOrEqual,T.ge=T.greaterThanOrEqual,T.compare=function(t){var i,n;return e(t)||(t=f(t)),this.eq(t)?0:(i=this.isNegative(),n=t.isNegative(),i&&!n?-1:!i&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1)},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(O)?O:this.not().add(b)},T.neg=T.negate,T.add=function(t){e(t)||(t=f(t));var i=0,n=0,s=0,r=0;return n+=(s=s+((r+=(65535&this.low)+(65535&t.low))>>>16)+((this.low>>>16)+(t.low>>>16)))>>>16,c((s&=65535)<<16|(r&=65535),((i+=(n+=(65535&this.high)+(65535&t.high))>>>16)+((this.high>>>16)+(t.high>>>16))&65535)<<16|(n&=65535),this.unsigned)},T.subtract=function(t){return e(t)||(t=f(t)),this.add(t.neg())},T.sub=T.subtract,T.multiply=function(t){var n,s,r,o,u,a,l,_,d,m;return this.isZero()?this:(e(t)||(t=f(t)),i?c(i.mul(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):t.isZero()?this.unsigned?g:p:this.eq(O)?t.isOdd()?O:p:t.eq(O)?this.isOdd()?O:p:this.isNegative()?t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg():t.isNegative()?this.mul(t.neg()).neg():this.lt(v)&&t.lt(v)?h(this.toNumber()*t.toNumber(),this.unsigned):(o=t.high>>>16,u=65535&t.high,a=t.low>>>16,m=(m=d=_=l=0)+((_=_+((d+=(r=65535&this.low)*(t=65535&t.low))>>>16)+(s=this.low>>>16)*t)>>>16)+((_=(65535&_)+r*a)>>>16),c((_&=65535)<<16|(d&=65535),(l=(l=(l+=(m+=(n=65535&this.high)*t)>>>16)+((m=(65535&m)+s*a)>>>16)+((m=(65535&m)+r*u)>>>16))+((this.high>>>16)*t+n*a+s*u+r*o)&65535)<<16|(m&=65535),this.unsigned)))},T.mul=T.multiply,T.divide=function(t){if((t=e(t)?t:f(t)).isZero())throw Error("division by zero");var n,s,r;if(i)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?c((this.unsigned?i.div_u:i.div_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:p;if(this.unsigned){if((t=t.unsigned?t:t.toUnsigned()).gt(this))return g;if(t.gt(this.shru(1)))return E;s=g}else{if(this.eq(O))return t.eq(b)||t.eq(S)?O:t.eq(O)?b:(r=this.shr(1).div(t).shl(1)).eq(p)?t.isNegative()?b:S:(n=this.sub(t.mul(r)),r.add(n.div(t)));if(t.eq(O))return this.unsigned?g:p;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();s=p}for(n=this;n.gte(t);){r=Math.max(1,Math.floor(n.toNumber()/t.toNumber()));for(var o=Math.ceil(Math.log(r)/Math.LN2),u=o<=48?1:a(2,o-48),l=h(r),_=l.mul(t);_.isNegative()||_.gt(n);)_=(l=h(r-=u,this.unsigned)).mul(t);l.isZero()&&(l=b),s=s.add(l),n=n.sub(_)}return s},T.div=T.divide,T.modulo=function(t){return e(t)||(t=f(t)),i?c((this.unsigned?i.rem_u:i.rem_s)(this.low,this.high,t.low,t.high),i.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},T.mod=T.modulo,T.rem=T.modulo,T.not=function(){return c(~this.low,~this.high,this.unsigned)},T.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},T.clz=T.countLeadingZeros,T.countTrailingZeros=function(){return this.low?s(this.low):s(this.high)+32},T.ctz=T.countTrailingZeros,T.and=function(t){return e(t)||(t=f(t)),c(this.low&t.low,this.high&t.high,this.unsigned)},T.or=function(t){return e(t)||(t=f(t)),c(this.low|t.low,this.high|t.high,this.unsigned)},T.xor=function(t){return e(t)||(t=f(t)),c(this.low^t.low,this.high^t.high,this.unsigned)},T.shiftLeft=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):c(0,this.low<<t-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):c(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(t){return e(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?c(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):c(32===t?this.high:this.high>>>t-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.shr_u=T.shiftRightUnsigned,T.rotateLeft=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?c(this.high,this.low,this.unsigned):t<32?c(this.low<<t|this.high>>>(i=32-t),this.high<<t|this.low>>>i,this.unsigned):c(this.high<<(t-=32)|this.low>>>(i=32-t),this.low<<t|this.high>>>i,this.unsigned)},T.rotl=T.rotateLeft,T.rotateRight=function(t){var i;return e(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?c(this.high,this.low,this.unsigned):t<32?c(this.high<<(i=32-t)|this.low>>>t,this.low<<i|this.high>>>t,this.unsigned):c(this.low<<(i=32-(t-=32))|this.high>>>t,this.high<<i|this.low>>>t,this.unsigned)},T.rotr=T.rotateRight,T.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},T.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var t=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},T.toBytesBE=function(){var t=this.high,i=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,i>>>24,i>>>16&255,i>>>8&255,255&i]},n.fromBytes=function(t,i,e){return e?n.fromBytesLE(t,i):n.fromBytesBE(t,i)},n.fromBytesLE=function(t,i){return new n(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,i)},n.fromBytesBE=function(t,i){return new n(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],i)},t.default=n,"default"in t?t.default:t}({});void 0!==(i=function(){return e}.apply(i,[]))&&(t.exports=i)},11:function(t,i,n){"use strict";function e(t){return t}function s(t){return t}function r(t){return t}n.r(i);var o,u="zm.scc",h="zm.sbcm",c="zm.srlm",a="zm.sbrm",l="zm.msg.sdr",f="zm.msg.rlr",_="zm.msg.rps",d="zm.msg.srm",m="zm.msg.scm",v="zm.msg.sbm",p="zm.msg.bps",g="zm.msg.slm",b="zm.sv.ps",E={code:1100001,msg:"input parm error."},S={code:1100002,msg:"network timeout."},R={code:1000002,msg:"not login"},y={code:1009001,msg:"message content is empty"},O={code:1009010,msg:"failed to send message"},T={code:1002014,msg:"room not exist"},w={code:1002099,msg:"room inner error"},I={code:1109001,msg:"frequency limited."},N={INPUT_PARAM:E,IM_CONTENT_NULL:y,IM_CONTENT_TOO_LONG:$={code:1009002,msg:"message content is too long"},ROOM_NOT_EXIST:T},C="/liveroom/send_custom_command",k=s,z={INPUT_PARAM:E,IM_CONTENT_NULL:y,IM_CONTENT_TOO_LONG:$,ROOM_NOT_EXIST:T},D="/liveroom/send_room_message",A=r,P=r,M={INPUT_PARAM:E,IM_CONTENT_NULL:y,IM_CONTENT_TOO_LONG:$,ROOM_NOT_EXIST:T},U=s,x=s,L=E,j={code:1102022,msg:"trans send frequently"},q=T,G=e,H=e,B=s,V=r,$=((y=o=o||{})[y.I=0]="I",y[y.H=10]="H",y[y.M=100]="M",y[y.L=1e3]="L",n(1)),J=n.n($),Y=n(0),X=(Object.defineProperty(W.prototype,"_isUseNetAgent",{get:function(){return this.h.useNetAgent},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"u",{get:function(){return this.h.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(W.prototype,"_serviceHandler",{get:function(){return this._liveRoomHandler},enumerable:!1,configurable:!0}),W.prototype.loginRsp=function(t){var i=this,n=(t=t.body).ret_timestamp,e=t.bigim_time_window,s=t.dati_time_window,r=t.trans_seqs;if(null!=n&&Object(Y.f)(n)&&(t=parseFloat(n),this._serverTimeOffset=0==t?0:+n-(new Date).getTime()),e&&Object(Y.d)(e)&&(this._bigimTimeWindow=e),s&&Object(Y.d)(s)&&(this._datiTimeWindow=s),r)for(var o=0;o<r.length;o++){var u=r[o].trans_channel,h=r[o].trans_seq_list||r[o].trans_seq_array;0<(h=(h=h.filter((function(t){var n=t.trans_type;return t=t.trans_seq,!i.transSeqMap[n]||i.transSeqMap[n].seq<t}))).map((function(t){return{trans_type:t.trans_type,trans_local_seq:t.trans_seq}}))).length&&this.fetchReliableMessage(u,h)}},W.prototype.sendReliableMessage=function(t,i,n,e){var s,r=this;this.v.info(l+" call"),this._room.isLogin()?this._isReliable?(this.v.error(l+" send too often"),e(j)):(this.transSeqMap[t]||(this.transSeqMap[t]={seq:0}),s={trans_type:t,trans_data:i,trans_local_seq:this.transSeqMap[t].seq,trans_channel:"clt"},this._isReliable=!0,this._serviceHandler.sendReliableMessage(s,(function(e){r.transSeqMap[t].seq=e.body.trans_seq,r.v.info(l+" trans "+t+" seq "+e.body.trans_seq),r._isReliable=!1,r.roomExtraInfo[t]={key:t,value:i,updateUser:{userID:r._room.userID,userName:r._room.userName},updateTime:Date.now()},n({seq:e.header.seq,errorCode:0})}),(function(t){var i=w;t.body&&t.body.err_code?(i=r._rtm.getServerError(t.body.err_code),r.v.error(d+"  "+i.msg)):i=t,r._isReliable=!1,e(i)}),this._room)):(this.v.error(l+" state error"),e&&e(R))},W.prototype.fetchReliableMessage=function(t,i){function n(t){e.handleFetchTransRsp(t,s)}var e=this,s=(t={trans_channel:t,fetch_array:i},this.u.createSpan(o.H,{key:"/sdk/login",par:this._room.roomID},{key:""},"/liveroom/get_room_extrainfo"));s.setAttributes({fetch_array:G(i)}),this._serviceHandler.fetchReliableMessage(t,n,n,this._room),this.v.info("zm.msg.frm call success")},W.prototype.handleFetchTransRsp=function(t,i){if(t.body&&0!=t.body.err_code)this.v.error(f+" trans send error "+t.body.err_code),this.h.tracer.setError(i,{code:t.body.err_code});else if(t.header&&t.body){var n=t.body.trans_list||t.body.trans_fetch_results,e=[],s=[];if(Array.isArray(n)&&0<n.length){for(var r=0;r<n.length;r++){var o,u,h=n[r];1000001109===h.err_code?this.v.warn(f+" fetch trans unknown type "+h.err_code):(s.push({trans_type:o=h.trans_type,trans_seq:u=h.trans_seq}),1000001110===h.err_code?(this.v.warn(f+" fetch trans seq is wrong "+h.err_code),this.transSeqMap[o]={seq:u}):!this.transSeqMap[o]||this.transSeqMap[o].seq<u?(this.transSeqMap[o]={seq:u},e.push(h)):this.v.warn(f+" fetch trans seq wrong"))}this.roomExtraInfo={},0<e.length&&this.onRecvReliableMessage(e)}i.setAttributes({result_array:H(s)}),i.end()}else this.v.error(f+" trans send error "+t),this.h.tracer.setError(i,S)},W.prototype.handlePushTransMsg=function(t){var i,n=t.body.trans_type,e=t.body.trans_seq;!this.transSeqMap[n]||this.transSeqMap[n].seq<e?(this.transSeqMap[n]={seq:e},this.onRecvReliableMessage([t.body],(null==(i=null==t?void 0:t.body)?void 0:i.trans_idname)===this.h.idName||(null==(i=null==t?void 0:t.body)?void 0:i.id_name)===this.h.idName)):this.v.warn(_+" trans seq wrong"),this.v.info(_+" trans "+n+" seq "+e)},W.prototype.sendRoomMsg=function(t,i,n,e,s,r){var o=this;if(!this._room.isLogin())return this.v.error(d+" state error"),r(R),!1;var u=Date.parse(new Date+"");return 0<this._sendRoomMsgTime&&this._sendRoomMsgTime+this._sendRoomMsgInterval>u?(this.v.info(d+" freq error"),r&&r(I,0,t,e),!1):(this._sendRoomMsgTime=u,u=this._serviceHandler.sendRoomMsg({msg_category:t,msg_type:1,msg_priority:1,msg_content:e},(function(t){s({seq:t.header.seq,errorCode:0,messageID:t.body.msg_id})}),(function(t){var i,n,e=w;t.header&&t.body?(n=(i=[o._rtm.getServerError(t.body.err_code),t.body.msg_id])[1],o.v.error(d+"  "+(e=i[0]).msg),r({seq:t.header.seq,errorCode:(e=e==S?O:e).code,messageID:n})):(t.code&&t.msg&&(e=t),r({seq:0,errorCode:e.code,messageID:0}))}),this._room),this.u.spanSetAttributes({key:D,par:null==(t=this._room)?void 0:t.roomID},{send_seq:A(u)}),this.v.info(d+"  call success"),!0)},W.prototype.handlePushRoomMsg=function(t){var i,n=[];this._isUseNetAgent&&(i=t.body.msg_list,t.body.msg_list.forEach((function(t){t={fromUser:{userID:t.id_name,userName:t.nick_name},message:t.msg_content,sendTime:t.send_time.toNumber(),messageID:t.msg_id.toNumber()},n.push(t)})),t.body.server_msg_id=t.body.server_msg_id.toNumber(),t.body.ret_msg_id=t.body.ret_msg_id.toNumber()),this.h.actionListener("IMRecvBroadcastMessage",this._room.roomID,n),this.h.actionListener("_recvRoomMsg",i,t.body.server_msg_id,t.body.ret_msg_id)},W.prototype.sendCustomCommand=function(t,i,n,e){var s,r=this;return this._room.isLogin()?(i={from_userid:this.h.idName,from_username:this.h.nickName,request_id:this.h.getRequestId(),custom_content:i||"",room_id:this._room.roomID},this.u.spanSetAttributes({key:C,par:null==(s=this._room)?void 0:s.roomID},{request_id:k(i.request_id)}),s={dest_id_name:t,custom_msg:JSON.stringify(i)},this._serviceHandler.sendCustomCommand(s,(function(t){n({seq:t.header.seq,errorCode:0})}),(function(t){var i,n=r._rtm.getServerError(t.body.err_code);r.v.error(m+" "+n.msg),i=2===(null==(i=t.body)?void 0:i.err_code)||1000000002===(null==(i=t.body)?void 0:i.err_code)?E:n==S?O:n,e({seq:t.header.seq,errorCode:i.code,code:i.code})}),this._room),this.v.info(m+" call success"),!0):(this.v.error(m+" state error"),e(R),!1)},W.prototype.handlePushCustomMsg=function(t){t=[(t=JSON.parse(t.body.custommsg)).from_userid,t.from_username,t.room_id,t.custom_content],this.h.actionListener("IMRecvCustomCommand",t[2],{userID:t[0],userName:t[1]},t[3])},W.prototype.sendBigRoomMessage=function(t,i,n,e,s,r){var o,u,h,c,a=this;this._room.isLogin()?(o=this._bigimTimeWindow,u=this._serverTimeOffset,h=(new Date).getTime()+u,c=this._rtm.getSeq().toString(),this._bigImCallbackMap[c]={success:s,error:r},0==o?this.sendBigRoomMessageInternal([{msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:c}],(function(t){a.handleBigImMsgRsp(t)}),(function(t){r&&r(t)})):(s=Math.floor(h/o),this._bigImLastTimeIndex<s&&0==this._bigIMmessageList.length?(this._bigImLastTimeIndex=s,this.sendBigRoomMessageInternal([{msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:c}],(function(t){a.handleBigImMsgRsp(t)}),(function(t){r&&r(t)}))):(this._bigIMmessageList.push({msg_category:t,msg_type:1,msg_content:e,bigmsg_client_id:c}),1==this._bigIMmessageList.length&&this.setBigImTimer(u,o)))):(this.v.error(v+" state error"),r&&r(R))},W.prototype.sendBigRoomMessageInternal=function(t,i,n){this._serviceHandler.sendBigRoomMessage({msgs:t},(function(t){i(t)}),(function(t){var i=w;t.header&&t.body||(t.code&&t.msg&&(i=t),n(i)),n(i)}),this._room),this.v.info(v+" sendBigRoomMessage called")},W.prototype.handleBigImMsgRsp=function(t){this._bigimTimeWindow=t.body.bigim_time_window;for(var i=t.body.msg_list||t.body.msgs,n=0;n<i.length;n++){var e,s=i[n].msg_client_id||i[n].bigmsg_client_id;this._bigImCallbackMap[s]&&(null!=(e=this._bigImCallbackMap[s].success)&&e({seq:t.header.seq,errorCode:0,messageID:i[n].msg_id||i[n].bigmsg_id}),delete this._bigImCallbackMap[s])}},W.prototype.setBigImTimer=function(t,i){var n=this;t=i-((new Date).getTime()+t)%i,i=this._rtm.generateRandumNumber(i)+t,this._bigImTimer=setTimeout((function(){n.onBigImTimer()}),i)},W.prototype.onBigImTimer=function(){for(var t=this,i=(new Date).getTime()+this._serverTimeOffset,n=(this._bigImLastTimeIndex=Math.floor(i/this._bigimTimeWindow),[]),e=[],s=0;s<this._bigIMmessageList.length&&!(20<=s);s++){var r=this._bigIMmessageList[s];n.push({msg_category:r.msg_category,msg_type:r.msg_type,msg_content:r.msg_content,bigmsg_client_id:r.bigmsg_client_id}),e.push(r.bigmsg_client_id)}20<this._bigIMmessageList.length?this._bigIMmessageList.splice(0,20):this._bigIMmessageList=[],this.sendBigRoomMessageInternal(n,(function(i){t.handleBigImMsgRsp(i)}),(function(i,n){for(var s=0;s<e.length;s++){var r=e[s],o=t._bigImCallbackMap[r];o&&(null!=o.error&&o.error(i,n),delete t._bigImCallbackMap[r])}})),this._bigImTimer&&clearTimeout(this._bigImTimer),this._bigImTimer=null,0<this._bigIMmessageList.length&&this.setBigImTimer(this._serverTimeOffset,this._bigimTimeWindow)},W.prototype.handlePushMergeMsg=function(t){for(var i=t.body.message_list||t.body.messages,n=0;n<i.length;n++)14001===i[n].sub_cmd&&this.handlePushBigRooMsg(i[n].msg_body)},W.prototype.handlePushBigRooMsg=function(t){var i;if(Object(Y.f)(t))try{i=JSON.parse(t)}catch(t){return void this.v.warn(p+"parse json error")}else i=t;if(i){t=i.room_id||this._room.roomID;for(var n=[],e=i.msg_list||i.msg_data,s=0;s<e.length;s++){var r=e[s];r.id_name==this.h.idName?this.v.info(p+" self message"):n.push({idName:r.id_name,nickName:r.nick_name,messageId:r.msg_id||r.bigmsg_id,category:r.msg_category,type:r.msg_type,content:r.msg_content,time:r.send_time||J.a.isLong(r.msg_timestamp)&&r.msg_timestamp.toNumber()})}0==n.length?this.v.info(p+" no other pushData except self"):this.onRecvBigRoomMessage(n,t),this.v.info(p+"call success")}else this.v.warn(p+" cann't find message body")},W.prototype.onRecvBigRoomMessage=function(t,i){var n=[];t.forEach((function(t){n.push(t={fromUser:{userID:t.idName,userName:t.nickName},message:t.content,sendTime:t.time,messageID:t.messageId})})),this.h.actionListener("IMRecvBarrageMessage",i,n),this.h.actionListener("_recvBigRoomMessage",t,i)},W.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this._relayTimer&&(clearTimeout(this._relayTimer),this._relayTimer=null),this._bigImLastTimeIndex=0,this._bigIMmessageList=[],this._bigImCallbackMap={},this._bigImTimer&&(clearTimeout(this._bigImTimer),this._bigImTimer=null),this._serverTimeOffset=0,this._datiTimeWindow=0,this._bigimTimeWindow=0},W.prototype.sendRelayMessage=function(t,i,n,e){var s=this._datiTimeWindow,r=this._serverTimeOffset;0<s?(this.realyMessageList.push({type:t,data:i,success:n,error:e}),1==this.realyMessageList.length&&this.setRelayTimer(r,s)):this.sendRelayMessageInternal(t,i,n,e)},W.prototype.sendRelayMessageInternal=function(t,i,n,e){var s=this;this.v.info(g+" call"),this._serviceHandler.sendRelayMessage(t={relay_type:t,relay_data:i},(function(t){n&&n(t.header.seq,t.body.relay_result)}),(function(t){var i=w;t.header&&t.body?e&&e(s._rtm.getServerError(t.body.err_code),t.header.seq):(t.code&&t.msg&&(i=t),e&&e(i,0))}),i=this._room)},W.prototype.setRelayTimer=function(t,i){var n=this;t=(new Date).getTime()+t,t=this._rtm.generateRandumNumber(2*i-t%i),this.v.info(g+" setTimer "+t),this._relayTimer=setTimeout((function(){n.onRelayTimer()}),t)},W.prototype.onRelayTimer=function(){var t;0==this.realyMessageList.length?this.v.info(g+"  no relay data"):(this.sendRelayMessageInternal((t=this.realyMessageList[0]).type,t.data,t.success,t.error),this._relayTimer&&clearTimeout(this._relayTimer),this._relayTimer=null,this.realyMessageList.splice(0,1),0<this.realyMessageList.length&&this.setRelayTimer(this._serverTimeOffset,this._datiTimeWindow))},W);function W(t,i,n,e,s,r,o){var u=this;this.v=t,this.h=i,this._dataReport=n,this._service=e,this._liveRoomHandler=s,this._rtm=r,this._room=o,this._sendRoomMsgTime=0,this._sendRoomMsgInterval=500,this._bigImCallbackMap={},this._bigImLastTimeIndex=0,this._bigIMmessageList=[],this._bigImTimer=null,this._relayTimer=null,this._serverTimeOffset=0,this._datiTimeWindow=0,this._bigimTimeWindow=0,this._isReliable=!1,this.transSeqMap={},this.roomExtraInfo={},this.onRecvReliableMessage=function(t,i){void 0===i&&(i=!1);var n=t.map((function(t){var i={key:t.trans_type,value:t.trans_data,updateUser:{userID:t.id_name||t.trans_idname,userName:t.nick_name||t.trans_nickname},updateTime:J.a.isLong(t.trans_send_time)?t.trans_send_time.toNumber():t.trans_send_time};return u.roomExtraInfo[t.trans_type]=i}));i?u.v.warn(_+" id name same"):(0<n.length&&u.h.actionListener("roomExtraInfoUpdate",u._room.roomID,Object.values(u.roomExtraInfo)),t.forEach((function(t){u.h.actionListener("recvReliableMessage",t.trans_type,t.trans_seq,t.trans_data)})))},this.realyMessageList=[]}function K(t,i,n,e){var s=this;return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(r,o){var u,c=s.getMsgSpan(D,t,!0),a=(o=s.stateCenter.proxyRes(c,(function(t){c.setAttributes({msg_id:P(t.messageID)}),r(t)}),o)).interResolve;o=o.interReject,Object(Y.f)(t)&&""!=t?void 0===i||""==i?(s.logger.error(h+" message is empty"),o(M.IM_CONTENT_NULL)):Object(Y.f)(i)?1024<i.length?(s.logger.error(h+" message too long"),o(M.IM_CONTENT_TOO_LONG)):(u=s.getRoomModules(t),c.setAttributes({send_seq:A(),msg_content:i}),u?u.messageHandler.sendRoomMsg(n,e,t,i,(function(t){t.messageID&&c.setAttributes({msg_id:t.messageID}),a(t)}),o):o(M.ROOM_NOT_EXIST)):(s.logger.error(h+" message must be string"),o(M.INPUT_PARAM," param message error")):(s.logger.error(h+" roomid must be string and not empty"),o(M.INPUT_PARAM," param roomID error"))}))}function F(t,i,n){var e=this;return new Promise((function(s,r){var o,h,c=e.getMsgSpan(C,t,!0);r=(s=e.stateCenter.proxyRes(c,s,r)).interResolve,s=s.interReject,Object(Y.f)(t)&&""!=t?!Object(Y.a)(n)||n.find((function(t){return!Object(Y.f)(t)}))?(e.logger.error(u+" dstMembers must be string array"),s(z.INPUT_PARAM," param toUserList error")):Object(Y.f)(i)||Object(Y.e)(i)?Object(Y.f)(i)&&1024<i.length?(e.logger.error(u+" command too long"),s(z.IM_CONTENT_TOO_LONG)):(o=e.getRoomModules(t),h=Object(Y.f)(i)?i:JSON.stringify(i),c.setAttributes({msg_content:h}),o?o.messageHandler.sendCustomCommand(n,i,r,s):s(z.ROOM_NOT_EXIST)):(e.logger.error(u+" custom content must be a non empty string or object"),s(z.INPUT_PARAM," param command error")):(e.logger.error(u+" roomid must be string and not empty"),s(E," param roomID error"))}))}function Z(t,i,n,e){var s=this;return void 0===n&&(n=1),void 0===e&&(e=1),new Promise((function(r,o){var u=s.getMsgSpan("/liveroom/send_big_room_message",t);o=(r=s.stateCenter.proxyRes(u,r,o)).interResolve,r=r.interReject,Object(Y.f)(t)&&""!=t?void 0===i||""==i?(s.logger.error(a+" message is empty"),r(N.IM_CONTENT_NULL)):Object(Y.f)(i)?1024<i.length?(s.logger.error(a+" message too long"),r(N.IM_CONTENT_TOO_LONG)):(u.setAttributes({msg_content:i}),(u=s.getRoomModules(t))?u.messageHandler.sendBigRoomMessage(n,e,t,i,o,r):r(N.ROOM_NOT_EXIST)):(s.logger.error(a+" message must be string"),r(N.INPUT_PARAM," param message error")):(s.logger.error(a+" roomid must be string and not empty"),r(N.INPUT_PARAM," param roomID error"))}))}function Q(t,i,n){var e=this;return new Promise((function(s,r){var o=e.getMsgSpan("/liveroom/set_room_extrainfo",t),u=(s=e.stateCenter.proxyRes(o,s,(function(t){e.stateCenter.useNetAgent&&1015===t.errorCode&&(t.errorCode=1002017),r(t)}))).interResolve;s=s.interReject,Object(Y.f)(t)&&""!=t?i&&Object(Y.f)(i)?128<i.length?(e.logger.error(c+" type is too long"),s({errorCode:L.code})):n&&Object(Y.f)(n)?4096<n.length?(e.logger.error(c+" type is too long"),s({errorCode:L.code})):(o.setAttributes({key:U(i),value:x(n)}),(o=e.getRoomModules(t))?o.messageHandler.sendReliableMessage(i,n,u,s):s(q)):(e.logger.error(c+" data must be string"),s({errorCode:L.code})):(e.logger.error(c+" type must be string"),s({errorCode:L.code})):(e.logger.error(h+" roomid must be string and not empty"),s(M.INPUT_PARAM," param roomID error"))}))}var tt={_sendBroadcastMessage:K,sendBroadcastMessage:function(t,i){var n=this;return new Promise((function(e,s){K.call(n,t,i).then((function(t){e({errorCode:t.errorCode,messageID:t.messageID,extendedData:t.extendedData})})).catch((function(t){s(t)}))}))},_sendCustomCommand:F,sendCustomCommand:function(t,i,n){var e=this;return new Promise((function(s,r){F.call(e,t,i,n).then((function(t){s({errorCode:t.errorCode,extendedData:t.extendedData})})).catch((function(t){r(t)}))}))},_sendBarrageMessage:Z,sendBarrageMessage:function(t,i){var n=this;return new Promise((function(e,s){Z.call(n,t,i).then((function(t){e({errorCode:t.errorCode,messageID:t.messageID,extendedData:t.extendedData})})).catch((function(t){s(t)}))}))},_setRoomExtraInfo:Q,setRoomExtraInfo:function(t,i,n){return Q.call(this,t,i,n)},sendRelayMessage:function(t,i,n,e,s){(s=this.getRoomModules(s)||this.stateCenter.roomModulesList[0])?s.messageHandler.sendRelayMessage(t,i,n,e):e&&e(T,0)}},it={handlePushRoomMsg:function(t){(t=this.handlePushMsg(t))[0].messageHandler.handlePushRoomMsg(t=t[1])},handlePushCustomMsg:function(t){(t=this.handlePushMsg(t))[0].messageHandler.handlePushCustomMsg(t=t[1])},handlePushMergeMsg:function(t){var i=null==(i=null==t?void 0:t.header)?void 0:i.room_id;(i=this.rtm.getRoomModules(i))?i.messageHandler.handlePushMergeMsg(t):this.logger.error(b+" room no found ignore "+JSON.stringify(t))},handlePushTransMsg:function(t){var i,n=(e=this.handlePushMsg(t))[0],e=e[1],s=null==(s=null==t?void 0:t.header)?void 0:s.room_id;(s=this.rtm.getMsgSpan("/liveroom/recv_room_extrainfo",s)).setAttributes({trans_type:B(null==(i=null==t?void 0:t.body)?void 0:i.trans_type),trans_seq:V(null==(i=null==t?void 0:t.body)?void 0:i.trans_seq)}),s.end(),n.messageHandler.handlePushTransMsg(e)},handleBigImMsgRsp:function(t){var i=null==(i=null==t?void 0:t.header)?void 0:i.room_id;(i=this.rtm.getRoomModules(i))?i.messageHandler.handleBigImMsgRsp(t):this.logger.error(b+" room no found ignore "+JSON.stringify(t))},handlePushMsg:function(t){var i=null==(i=null==t?void 0:t.header)?void 0:i.room_id;if(i=this.rtm.getRoomModules(i))return[i,t];this.logger.error(b+" room no found ignore "+JSON.stringify(t))}},nt={initMessageHandler:function(){this.messageHandler=new X(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this.rtm,this)}};i.default={type:"message",install:function(t,i,n,e){for(var s in tt)Object.defineProperty(t.prototype,s,{value:tt[s],writable:!1});for(var s in it)Object.defineProperty(n.prototype,s,{value:it[s],writable:!1}),Object.defineProperty(e.prototype,s,{value:it[s],writable:!1});for(var s in nt)Object.defineProperty(i.prototype,s,{value:nt[s],writable:!1})}}}},n={},t.m=i,t.c=n,t.d=function(i,n,e){t.o(i,n)||Object.defineProperty(i,n,{enumerable:!0,get:e})},t.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},t.t=function(i,n){if(1&n&&(i=t(i)),8&n)return i;if(4&n&&"object"==typeof i&&i&&i.__esModule)return i;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:i}),2&n&&"string"!=typeof i)for(var s in i)t.d(e,s,function(t){return i[t]}.bind(null,s));return e},t.n=function(i){var n=i&&i.__esModule?function(){return i.default}:function(){return i};return t.d(n,"a",n),n},t.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},t.p="",t(t.s=11);function t(e){var s;return(n[e]||(s=n[e]={i:e,l:!1,exports:{}},i[e].call(s.exports,s,s.exports,t),s.l=!0,s)).exports}var i,n}()},413:(t,i,n)=>{"use strict";n.d(i,{Z:()=>f});var e=n(100);const s=n(720);e.util.Long=s,e.util.Long.fromBits=e.util.Long?e.util.Long.fromBits:function(){return 0};for(var r=e.roots,o=e.types?e.types.basic:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0,string:2,bytes:2},u=e.types?e.types.packed:{double:1,float:5,int32:0,uint32:0,sint32:0,fixed32:5,sfixed32:5,int64:0,uint64:0,sint64:0,fixed64:1,sfixed64:1,bool:0},h=Object.keys(o),c={$:function(t){return c[t]?c[t].call(this):r[t].decode?r[t].decode(this,this.uint32()):c.$.call(this,"int32")}},a={$:function(t,i,n){var e=o[t];return void 0===e?r[t].encode?(this.uint32((n<<3|2)>>0).fork(),r[t].encode(i,this).ldelim()):a.$.call(this,"int32",i,n):a[t].call(this.uint32(n<<3|e),i)}},l=0;l<h.length;l++)c[h[l]]=e.Reader.prototype[h[l]],a[h[l]]=e.Writer.prototype[h[l]];!function t(i,n,s,h){for(var l=0,f=Object.keys(i);l<f.length;l++){var _=f[l];if(i[_].$m&&Object.keys(i[_].$m).every((function(t){return Number(t)}))){if(s[_])throw Error(`nested type ${s}.${_} has already exist`);s[_]=function(i,s){function h(t){for(var n in i){var e=i[n];"{"===e[1].charAt(0)?this[e[0]]={}:"["!==e[1].charAt(0)&&"<"!==e[1].charAt(0)||(this[e[0]]=[])}if(t)for(var s=Object.keys(t),r=0;r<s.length;++r)null!=t[s[r]]&&(this[s[r]]=t[s[r]])}var l={};for(var f in i){var _=i[f],d=_[1];"{"===d.charAt(0)?(h.prototype[_[0]]=e.util.emptyObject,l[d]={$m:d.substring(1).split(",").map((function(t,i){return[`$${i+1}`,t,null]})).reduce((function(t,i,n){return t[n+1]=i,t}),{})}):h.prototype[_[0]]="["===d.charAt(0)||"<"===d.charAt(0)?e.util.emptyArray:"bytes"===d?e.util.newBuffer([]):_[2]&&_[2].hasOwnProperty("low")&&_[2].hasOwnProperty("high")?e.util.Long.fromBits(_[2].low,_[2].high,_[2].unsigned):_[2]}return h.create=function(t){return new h(t)},h.decode=function(t,n){t instanceof e.Reader||(t=e.Reader.create(t));for(var s=void 0===n?t.len:t.pos+n,o=new h;t.pos<s;){var a=t.uint32(),l=a>>>3;if(l>0&&i[l]){var f=i[l][0],_=i[l][1];if("{"===_.charAt(0)){o[f]===e.util.emptyObject&&(o[f]={});var d=h.$namespace[_].decode(t,t.uint32());o[f][d.$1]=d.$2}else if("["===_.charAt(0)||"<"===_.charAt(0)){_=_.substring(1),o[f]&&o[f].length||(o[f]=[]);if(void 0!==u[_=!c[_]&&!r[_].decode?"int32":_]&&2==(7&a))for(var m=t.uint32()+t.pos;t.pos<m;)o[f].push(c.$.call(t,_));else o[f].push(c.$.call(t,_))}else o[f]=c.$.call(t,_)}else t.skipType(7&a)}return o},h.encode=function(t,n){for(var s in n||(n=e.Writer.create()),i){var c=i[s][0],l=i[s][1];if("{"===l.charAt(0)){if(null!=t[c]&&t.hasOwnProperty(c))for(var f=0,_=Object.keys(t[c]);f<_.length;++f)n.uint32((s<<3|2)>>0).fork(),h.$namespace[l].encode({$1:_[f],$2:t[c][_[f]]},n).ldelim()}else if("["===l.charAt(0)||"<"===l.charAt(0)){var d="<"===l.charAt(0);l=l.substring(1);var m=t[c];if(null!=m&&m.length){if(l=void 0===o[l]&&!r[l].encode?"int32":l,d&&void 0!==u[l]){n.uint32((s<<3|2)>>0).fork();for(f=0;f<m.length;f++)a[l].call(n,m[f]);n.ldelim()}else for(f=0;f<m.length;f++)a.$.call(n,l,m[f],s)}}else null!=t[c]&&t.hasOwnProperty(c)&&a.$.call(n,l,t[c],s)}return n},Object.keys(l).length&&(h.$namespace=t(l,n+"."+s,h.$namespace||{},!0)),h}(i[_].$m,_)}else i[_].$s?s[_]=function(t,i){function s(t,i,n){e.rpc.Service.call(this,t,i,n)}return(s.prototype=Object.create(e.rpc.Service.prototype)).constructor=s,s.create=function(t,i,n){return new s(t,i,n)},Object.keys(t).forEach((function(e){var o=t[e];function u(t,i){return this.rpcCall(u,r[o[0]],r[o[1]],t,i)}Object.defineProperty(u,"name",{value:e}),Object.defineProperty(u,"path",{value:`${n}.${i}`}),s.prototype[e]=u})),s}(i[_].$s,_):i[_].$e&&Object.values(i[_].$e).every((function(t){return Number(t)===t}))&&(s[_]=function(t,i){for(var n=Object.keys(t),e={},s=0;s<n.length;s++)e[e[n[s]]=t[n[s]]]=n[s];return e}(i[_].$e));s[_]&&!h&&(r[`${n}.${_}`]=s[_]),delete i[_].$m,delete i[_].$s,delete i[_].$e,s[_]=t(i[_],n?`${n}.${_}`:_,s[_]||{})}return s}({mixstream:{proto_mixstream:{MixAdvanceConfig:{$m:{1:["key","string",""],2:["value","string",""]}},MixImage:{$m:{1:["url","string",""],2:["display_mode","int32",0]}},MixInputStream:{$m:{1:["stream_input_common","mixstream.proto_mixstream.MixInputStreamCommon",null],2:["volume","int32",0],3:["audio_focus","int32",0],4:["audio_h_angle","int32",0],5:["render_mode","int32",0],6:["corner_radius","uint32",0],7:["label","mixstream.proto_mixstream.MixLabel",null],8:["image","mixstream.proto_mixstream.MixImage",null]}},MixInputStreamCommon:{$m:{1:["stream_id","string",""],2:["sound_level_id","uint32",0],3:["content_control","int32",0],4:["layer_rect","mixstream.proto_mixstream.MixRect",null],5:["stream_url","string",""]}},MixLabel:{$m:{1:["text","string",""],2:["text_left","int32",0],3:["text_top","int32",0],4:["font","mixstream.proto_mixstream.MixLableFont",null]}},MixLableFont:{$m:{1:["font_type","int32",0],2:["font_size","int32",0],3:["font_color","int32",0],4:["font_transparency","int32",0],5:["font_border_color","sint32",0]}},MixOutputStream:{$m:{1:["output_stream_common","mixstream.proto_mixstream.MixOutputStreamCommon",null],2:["video_enc_id","int32",0],3:["video_encode_latency","int32",0],4:["video_encode_profile","int32",0],5:["low_bitrate_hd","int32",0]}},MixOutputStreamCommon:{$m:{1:["is_url","int32",0],2:["target","string",""],3:["video_fps","int32",0],4:["rate_control_mode","int32",0],5:["video_bitrate","int32",0],6:["video_width","int32",0],7:["video_height","int32",0],8:["output_quality","int32",0],9:["audio_bitrate","int32",0],10:["audio_enc_id","int32",0]}},MixRect:{$m:{1:["top","int32",0],2:["left","int32",0],3:["bottom","int32",0],4:["right","int32",0],5:["layer","int32",0]}},MixStartReplyData:{$m:{1:["request_id","string",""],2:["play_infos","<mixstream.proto_mixstream.PlayInfo",null]}},MixStreamCommon:{$m:{1:["user_data","string",""],2:["output_bg_color","int32",0],3:["output_bg_image","string",""],4:["with_sound_level","int32",0],5:["single_stream_pass_through","int32",0],6:["alignment_type","int32",0]}},MixstreamServerCommonResponse:{$m:{1:["code","uint32",0],2:["message","string",""]}},MixStreamStartRequest:{$m:{1:["request_seq","uint32",0],2:["mix_protocol_version","int32",0],3:["task_id","string",""],4:["room_id","string",""],5:["mix_stream_common","mixstream.proto_mixstream.MixStreamCommon",null],6:["audio_channel_cnt","int32",0],7:["audio_mix_mode","int32",0],8:["recv_buffer_level","sint32",0],9:["input_stream","<mixstream.proto_mixstream.MixInputStream",null],10:["water_mark","mixstream.proto_mixstream.MixWaterMark",null],11:["advance_config","<mixstream.proto_mixstream.MixAdvanceConfig",null],12:["output_stream","<mixstream.proto_mixstream.MixOutputStream",null],13:["white_board","mixstream.proto_mixstream.MixWhiteBoard",null],14:["timestamp","int64",{low:0,high:0,unsigned:!1}]}},MixStreamStartResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null],3:["data","mixstream.proto_mixstream.MixStartReplyData",null],4:["error_streamid_list","<string",null]}},MixStreamStopRequest:{$m:{1:["request_seq","uint32",0],2:["task_id","string",""],3:["room_id","string",""],4:["is_url","int32",0],5:["target","string",""],6:["timestamp","int64",{low:0,high:0,unsigned:!1}]}},MixStreamStopResponse:{$m:{1:["request_seq","uint32",0],2:["common_response","mixstream.proto_mixstream.MixstreamServerCommonResponse",null]}},MixWaterMark:{$m:{1:["image","string",""],2:["layout_rect","mixstream.proto_mixstream.MixRect",null]}},MixWhiteBoard:{$m:{1:["whiteboard_id","uint64",{low:0,high:0,unsigned:!0}],2:["horizontal_ratio","int32",0],3:["vertical_ratio","int32",0],4:["is_ppt_animation","int32",0],5:["layout_rect","mixstream.proto_mixstream.MixRect",null],6:["background_color","int32",0]}},PlayInfo:{$m:{1:["stream_alias","string",""],2:["rtmp_url","string",""],3:["hls_url","string",""],4:["hdl_url","string",""]}}}}},"",r,!1);const f=r.mixstream},951:(t,i,n)=>{"use strict";var e,s=n(100),r=s.Reader,o=s.Writer,u=s.util,h=s.roots.default||(s.roots.default={});h.proto_media=((e={}).MediaServerCommonResponse=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.code=0,t.prototype.message="",t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&i.uint32(8).uint32(t.code),null!=t.message&&Object.hasOwnProperty.call(t,"message")&&i.uint32(18).string(t.message),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.MediaServerCommonResponse;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.code=t.uint32();break;case 2:e.message=t.string();break;default:t.skipType(7&s)}}return e},t}(),e.RelayPublishCdnRequest=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.request_seq=0,t.prototype.request_cmd=0,t.prototype.streamid="",t.prototype.cdn_server="",t.prototype.publish_timeout=0,t.prototype.request_seq_v2=u.Long?u.Long.fromBits(0,0,!0):0,t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.request_seq&&Object.hasOwnProperty.call(t,"request_seq")&&i.uint32(8).uint32(t.request_seq),null!=t.request_cmd&&Object.hasOwnProperty.call(t,"request_cmd")&&i.uint32(16).int32(t.request_cmd),null!=t.streamid&&Object.hasOwnProperty.call(t,"streamid")&&i.uint32(26).string(t.streamid),null!=t.cdn_server&&Object.hasOwnProperty.call(t,"cdn_server")&&i.uint32(34).string(t.cdn_server),null!=t.publish_timeout&&Object.hasOwnProperty.call(t,"publish_timeout")&&i.uint32(40).uint32(t.publish_timeout),null!=t.request_seq_v2&&Object.hasOwnProperty.call(t,"request_seq_v2")&&i.uint32(48).uint64(t.request_seq_v2),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.RelayPublishCdnRequest;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.request_seq=t.uint32();break;case 2:e.request_cmd=t.int32();break;case 3:e.streamid=t.string();break;case 4:e.cdn_server=t.string();break;case 5:e.publish_timeout=t.uint32();break;case 6:e.request_seq_v2=t.uint64();break;default:t.skipType(7&s)}}return e},t}(),e.RelayPublishCdnResponse=function(){function t(t){if(t)for(var i=Object.keys(t),n=0;n<i.length;++n)null!=t[i[n]]&&(this[i[n]]=t[i[n]])}return t.prototype.request_seq=0,t.prototype.response=null,t.prototype.request_seq_v2=u.Long?u.Long.fromBits(0,0,!0):0,t.create=function(i){return new t(i)},t.encode=function(t,i){return i||(i=o.create()),null!=t.request_seq&&Object.hasOwnProperty.call(t,"request_seq")&&i.uint32(8).uint32(t.request_seq),null!=t.response&&Object.hasOwnProperty.call(t,"response")&&h.proto_media.MediaServerCommonResponse.encode(t.response,i.uint32(18).fork()).ldelim(),null!=t.request_seq_v2&&Object.hasOwnProperty.call(t,"request_seq_v2")&&i.uint32(24).uint64(t.request_seq_v2),i},t.decode=function(t,i){t instanceof r||(t=r.create(t));for(var n=void 0===i?t.len:t.pos+i,e=new h.proto_media.RelayPublishCdnResponse;t.pos<n;){var s=t.uint32();switch(s>>>3){case 1:e.request_seq=t.uint32();break;case 2:e.response=h.proto_media.MediaServerCommonResponse.decode(t,t.uint32());break;case 3:e.request_seq_v2=t.uint64();break;default:t.skipType(7&s)}}return e},t}(),e),t.exports=h}},__webpack_module_cache__={};function __webpack_require__(t){var i=__webpack_module_cache__[t];if(void 0!==i)return i.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.n=t=>{var i=t&&t.__esModule?()=>t.default:()=>t;return __webpack_require__.d(i,{a:i}),i},__webpack_require__.d=(t,i)=>{for(var n in i)__webpack_require__.o(i,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:i[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),__webpack_require__.o=(t,i)=>Object.prototype.hasOwnProperty.call(t,i),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{ZegoExpressEngine:()=>he});var t,i,n=__webpack_require__(901);!function(t){t[t.debug=0]="debug",t[t.info=1]="info",t[t.warn=2]="warn",t[t.error=3]="error",t[t.report=99]="report",t[t.disable=100]="disable"}(t||(t={})),function(t){t[t.CN=2]="CN",t[t.NA=3]="NA",t[t.EU=4]="EU",t[t.AS=5]="AS",t[t.IN=6]="IN",t[t.NCN=7]="NCN"}(i||(i={}));var e,s;!function(t){t[t.disable=0]="disable",t[t.websocket=1]="websocket",t[t.https=2]="https"}(e||(e={})),function(t){t[t.SDKProject_Other=0]="SDKProject_Other",t[t.SDKProject_ZegoExpressVideo=1]="SDKProject_ZegoExpressVideo",t[t.SDKProject_ZegoExpressAudio=2]="SDKProject_ZegoExpressAudio",t[t.SDKProject_ZegoLiveRoom=3]="SDKProject_ZegoLiveRoom",t[t.SDKProject_ZegoAudioRoom=4]="SDKProject_ZegoAudioRoom",t[t.SDKProject_ZegoAVKit=5]="SDKProject_ZegoAVKit",t[t.SDKProject_ZegoWebRTC=6]="SDKProject_ZegoWebRTC",t[t.SDKProject_ZegoMiniProgram=7]="SDKProject_ZegoMiniProgram"}(s||(s={}));var r;!function(t){t[t.disconnected=0]="disconnected",t[t.connecting=1]="connecting",t[t.connected=2]="connected"}(r||(r={}));var o,u,h,c,a=6,l=7,f=0,_=1,d=2;!function(t){t[t.tryProbe=0]="tryProbe",t[t.probed=2]="probed"}(o||(o={})),function(t){t[t.CDN=0]="CDN",t[t.RTC=1]="RTC",t[t.L3=2]="L3",t[t.DG=3]="DG"}(u||(u={})),function(t){t[t.UDP=0]="UDP",t[t.RTMP=1]="RTMP",t[t.FLV=2]="FLV",t[t.HLS=3]="HLS",t[t.WEBRTC=4]="WEBRTC"}(h||(h={})),function(t){t[t.replaceNew=0]="replaceNew",t[t.changeResolution=1]="changeResolution"}(c||(c={}));var m,v,p,g=1,b=2,E=3,S=4,R=2001,y=2002,O=2003,T=1,w=0;!function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login"}(m||(m={})),function(t){t[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login",t[t.reconnect=3]="reconnect"}(v||(v={})),function(t){t[t.offline=0]="offline",t[t.online=1]="online"}(p||(p={}));var I;!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.CDN=1]="CDN",t[t.RTC=2]="RTC",t[t.L3=3]="L3"}(I||(I={}));var N,C=12001,k=12002,z=12003;!function(t){t[t.low=1]="low",t[t.stantard=2]="stantard",t[t.hight=3]="hight",t[t.custome=4]="custome"}(N||(N={}));var D,A,P,M,U,x;!function(t){t[t.captureFpsToLow=1001]="captureFpsToLow",t[t.captureVolumeToLow=1002]="captureVolumeToLow",t[t.sendVideoBitrateToLow=1003]="sendVideoBitrateToLow",t[t.sendFpsToLow=1004]="sendFpsToLow",t[t.sendAudioBitrateToLow=1005]="sendAudioBitrateToLow",t[t.receiveVolumeToLow=1006]="receiveVolumeToLow",t[t.receiveAudioDecodedFail=1007]="receiveAudioDecodedFail",t[t.receiveVideoDecodedFail=1008]="receiveVideoDecodedFail",t[t.receiveVideoFpsDecodedToLow=1009]="receiveVideoFpsDecodedToLow",t[t.renderVideoFpsToLow=1010]="renderVideoFpsToLow",t[t.captureFpsNormal=2001]="captureFpsNormal",t[t.captureVolumeNormal=2002]="captureVolumeNormal",t[t.sendVideoBitrateNormal=2003]="sendVideoBitrateNormal",t[t.sendFpsNormal=2004]="sendFpsNormal",t[t.sendAudioBitrateNormal=2005]="sendAudioBitrateNormal",t[t.receiveVolumeNormal=2006]="receiveVolumeNormal",t[t.receiveAudioDecodedNormal=2007]="receiveAudioDecodedNormal",t[t.receiveVideoDecodedNormal=2008]="receiveVideoDecodedNormal",t[t.receiveVideoFpsDecodedNormal=2009]="receiveVideoFpsDecodedNormal",t[t.renderVideoFpsNormal=2010]="renderVideoFpsNormal"}(D||(D={})),function(t){t[t.cdn=0]="cdn",t[t.ultra=1]="ultra"}(A||(A={})),function(t){t[t.stop=0]="stop",t[t.start=1]="start"}(P||(P={})),function(t){t[t.cdn=0]="cdn",t[t.ultra=1]="ultra",t[t.customUrl=2]="customUrl"}(M||(M={})),function(t){t[t.CDN=0]="CDN",t[t.BGP=1]="BGP"}(U||(U={})),function(t){t[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallPragram=2]="ClientType_SmallPragram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc"}(x||(x={}));var L,j,q,G,H,B,V,$,J,Y,X,W,K,F,Z=function(){function t(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this._id=null,this.next=null,this.prev=null,this._id=t,this._data=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._id?this._id:null},set:function(t){this._id=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t},enumerable:!1,configurable:!0}),t.prototype.hasNext=function(){return this.next&&this.next.id},t.prototype.hasPrev=function(){return this.prev&&this.prev.id},t}(),Q=(function(){function t(){this.start=new Z,this.end=new Z,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}t.prototype.insertBefore=function(t,i){var n=new Z(this._idCounter,i);return n.next=t,n.prev=t.prev,t.prev&&(t.prev.next=n),t.prev=n,++this._idCounter,++this._numNodes,n},t.prototype.addLast=function(t){return this.insertBefore(this.end,t)},t.prototype.add=function(t){return this.addLast(t)},t.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},t.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},t.prototype.size=function(){return this._numNodes},t.prototype.getFromFirst=function(t){var i=0,n=this.start.next;if(t>=0)for(;i<t&&null!==n;)n=n.next,++i;else n=null;if(null===n)throw"Index out of bounds.";return n},t.prototype.get=function(t){return 0===t?this.getFirst():t===this._numNodes-1?this.getLast():this.getFromFirst(t)},t.prototype.remove=function(t){return t.prev&&(t.prev.next=t.next),t.next&&(t.next.prev=t.prev),--this._numNodes,t},t.prototype.removeFirst=function(){var t=null;return this._numNodes>0&&this.start.next&&(t=this.remove(this.start.next)),t},t.prototype.removeLast=function(){var t=null;return this._numNodes>0&&this.end.prev&&(t=this.remove(this.end.prev)),t},t.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},t.prototype.each=function(t){for(var i=this.start;i.hasNext();)t(i=i.next)},t.prototype.find=function(t){for(var i=this.start,n=!1,e=null;i.hasNext()&&!n;)t(i=i.next)&&(e=i,n=!0);return e},t.prototype.map=function(t){for(var i=this.start,n=[];i.hasNext();)t(i=i.next)&&n.push(i);return n},t.prototype.push=function(t){return this.addLast(t)},t.prototype.unshift=function(t){this.insertBefore(this._numNodes>0?this.start.next:this.end,t)},t.prototype.pop=function(){return this.removeLast()},t.prototype.shift=function(){return this.removeFirst()}}(),0),tt=1,it=2,nt=1,et=2,st="eventStart",rt="addEventMsg",ot="eventEnd",ut="addMsgInfo";!function(t){t[t.Unknown=-1]="Unknown",t[t.Excellent=0]="Excellent",t[t.Good=1]="Good",t[t.Middle=2]="Middle",t[t.Poor=3]="Poor",t[t.Die=4]="Die"}(L||(L={})),function(t){t[t.MinQuality=0]="MinQuality",t[t.DieQuality=0]="DieQuality",t[t.PoorMinQuality=1]="PoorMinQuality",t[t.MiddleMinQuality=30]="MiddleMinQuality",t[t.GoodMinQuality=60]="GoodMinQuality",t[t.ExcellentMinQuality=85]="ExcellentMinQuality",t[t.MaxQuality=100]="MaxQuality"}(j||(j={})),function(t){t[t.ZegoDefined=0]="ZegoDefined",t[t.UserUnregister=1]="UserUnregister"}(q||(q={})),function(t){t[t.CDN=0]="CDN",t[t.L3=1]="L3"}(G||(G={})),function(t){t[t.RTC=0]="RTC",t[t.CDN=1]="CDN",t[t.L3=2]="L3",t[t.DG=3]="DG"}(H||(H={})),function(t){t[t.PortraitSegmentation=0]="PortraitSegmentation"}(B||(B={})),function(t){t[t.Default=3]="Default",t[t.StandardVideoCall=4]="StandardVideoCall",t[t.HighVideoCall=5]="HighVideoCall",t[t.StandardChatroom=6]="StandardChatroom",t[t.HighQualityChatroom=7]="HighQualityChatroom",t[t.Broadcast=8]="Broadcast",t[t.UNKNOWN=100]="UNKNOWN"}(V||(V={})),function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}($||($={})),function(t){t[t.BASE_LINE=1]="BASE_LINE",t[t.MAIN=2]="MAIN",t[t.HIGH=3]="HIGH"}(J||(J={})),function(t){t.ONLY_BASELINE="only_baseline",t.HARD_SOFT_ENCODEC_FIRST="hard_or_soft_encodec_first",t.HIGH_PROFILE_FIRST="high_profile_first"}(Y||(Y={})),function(t){t[t.useAnalyzer=0]="useAnalyzer",t[t.useWorklet=1]="useWorklet"}(X||(X={})),function(t){t[t.None=0]="None",t[t.Vocalist=1]="Vocalist",t[t.BackingSinging=2]="BackingSinging"}(W||(W={})),function(t){t[t.METHOD_UNSET=0]="METHOD_UNSET",t[t.METHOD_GET=1]="METHOD_GET",t[t.METHOD_POST=2]="METHOD_POST",t[t.METHOD_PUT=3]="METHOD_PUT",t[t.METHOD_PATCH=4]="METHOD_PATCH",t[t.METHOD_DELETE=5]="METHOD_DELETE",t[t.METHOD_HEAD=6]="METHOD_HEAD",t[t.METHOD_OPTIONS=7]="METHOD_OPTIONS"}(K||(K={})),function(t){t[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR"}(F||(F={}));var ht="zw.scw.sps.0",ct="zw.scw.sps.1",at="zw.pw.ue",lt="zw.drh.a.0",ft=Promise;document;function _t(t,i,n){void 0===n&&(n=""),t.info("".concat(i," call ").concat(n))}function dt(t,i,n){void 0===n&&(n=""),t.info("".concat(i," end ").concat(n))}function mt(t,i,n){void 0===n&&(n=""),t.info("".concat(i," success ").concat(n))}var vt="input param error",pt="network is broken",gt="the user cancels the stream request.",bt={code:1000002,message:"not login room"},Et={code:1000014,message:"stream ID is too long"},St={code:1000015,message:"streamID is empty"},Rt={code:1000016,message:"stream ID contains illegal characters"},yt={code:1000017,message:pt},Ot={code:1100001,message:vt},Tt={code:1100002,message:"network timeout."},wt={code:1100999,message:"unknown server error"},It={code:1102017,message:"dispatch error"},Nt={code:1102018,message:"token expired"},Ct={code:1102022,message:"dispatch request timeout"},kt={code:1103001,message:vt},zt={code:1103049,message:"repeated pull same stream"},Dt={code:1103051,message:"publisher retry timeout"},At={code:1103055,message:"publish stream no found"},Pt={code:1103056,message:"publish is publishing"},Mt={code:1103089,message:gt},Ut={code:1104001,message:"input parm error"},xt={code:1104031,message:"player retry timeout"},Lt={code:1104032,message:"player is playing"},jt={code:1104039,message:"play stream not found"},qt={code:1104042,message:gt},Gt={code:1103052,message:"publisher cdn push error"},Ht={code:1000055,message:"cdn url is invalid"},Bt=function(t){return t},Vt=function(t){return t},$t=function(t){return t},Jt="/sdk/init",Yt="/sdk/login",Xt="listener",Wt=Jt,Kt="/sdk/start_publish",Ft="/liveroom/send_stream_update_info",Zt=Vt,Qt=Vt,ti=Vt,ii={event:"/liveroom/get_current_stream_list",room_id:Vt,room_sid_string:Vt,stream_seq:$t,stream_size:$t,stream_list:Bt,use_ua:$t,error:{ii:kt,NOT_LOGIN:bt}},ni="/sdk/listener",ei={event:"/sdk/publish_target",error:{ii:Ot,ni:At,ei:bt,si:{code:1103063,message:"publish target no response"},ri:{code:1102021,message:"biz channel error."},oi:{code:1102024,message:"invalid channel"},ui:wt}},si="/mss/pushadd",ri="/mss/pushdel",oi=Vt,ui={event:"/liveroom/send_stream_extra_info",error:{ii:Ot,ci:{code:1003050,message:"extra info of publishing stream is null"},ei:bt,ni:At,ai:{code:1103062,message:"update stream info fail"}},stream_id:Vt,stream_extra_info:Vt,room_sid_string:Vt,room_id:Vt,send_seq:$t};function hi(t){return"number"==typeof t}function ci(t){return"string"==typeof t}function ai(t){return"boolean"==typeof t}function li(t){return void 0===t}function fi(t){return null!==t&&t instanceof Object}function _i(t){return"function"==typeof t}function di(t){return t instanceof Array}function mi(t){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(t)&&/^[^:/]*$/g.test(t)}function vi(t){return!!(t.startsWith("rtmp://")||t.startsWith("avertp://")||t.startsWith("https://")&&t.endsWith(".flv")||t.startsWith("https://")&&t.endsWith(".m3u8"))}function pi(t,i){return i[t+"SuccessCallback"]}function gi(t,i,n,e,s){switch(n){case"eventStart":t.eventStart(i,e);break;case"eventEndWithMsgInfo":t.eventEndWithMsgInfo(i,e,s[0]);break;case"addEventMsg":t.addEventMsg(i,e,s[0],s[1]);break;case"addEvent":t.addEvent(i,e);break;case"eventEnd":t.eventEnd(i,e);break;case"addMsgInfo":t.addMsgInfo(i,s[0])}}function bi(t,i,n,e){!function(t,i,n){i.success&&(n[t+"SuccessCallback"]=i.success),i.error&&(n[t+"ErrorCallback"]=i.error)}(t,{success:function(t,e){for(var s=[],r=2;r<arguments.length;r++)s[r-2]=arguments[r];gi(i,n,t,e,s)}},e)}function Ei(t,i,n,e,s){pi(t,i)&&pi(t,i)(n,e)}function Si(t,i,n){if(i)return{code:t,message:n||"liveroom error"};return{code:0,message:""}}function Ri(t,i){delete i[t+"SuccessCallback"],delete i[t+"ErrorCallback"]}function yi(t,i){var n={code:-1,message:"server error"};return t>1e9&&(n.code=t-1e9+52e6),i&&(n.message=i),n}function Oi(t,i){var n={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED"};return i?t>2e5&&t<3e5?n[t-2e5]:t<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[t]||n[t]||"ROOM_INNER_ERROR":n[t]||"ROOM_INNER_ERROR":""}function Ti(t,i,n,e){var s,r=[],o=[],u=[];n||(n=[]);for(var h=0;h<n.length;h++)if(n[h].anchor_id_name!=t&&n[h].id_name!=t&&n[h].user_id!=t){s=!1;for(var c=0;c<i.length;c++)if(n[h].stream_id===i[c].stream_id){n[h].extra_info!==i[c].extra_info&&u.push(n[h]),s=!0;break}s||r.push(n[h])}for(var a=0;a<i.length;a++)if(i[a].anchor_id_name!=t&&i[a].id_name!=t&&i[a].user_id!=t){s=!1;for(var l=0;l<n.length;l++)if(i[a].stream_id===n[l].stream_id){s=!0;break}s||o.push(i[a])}i.splice(0);for(h=0;h<n.length;h++)i.push(n[h]);e(r,o,u)}function wi(t,i){return 0==i?hi(t)&&t%1==0&&t>=0:hi(t)&&t%1==0&&t>0}function Ii(t,i,n){return i=null!=i?i:1,n=null!=n?n:1e4,hi(t)&&t%1==0&&t>=i&&t<=n}function Ni(t){return 0==t||1==t?0==t?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"}function Ci(t){return 0==t||1==t?0==t?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"}function ki(t){return null!=t&&""!==t}function zi(t,i){return!(t.length>=i)}function Di(t){for(var i,n=0,e=t.length,s="";n<e;)i=t.subarray(n,Math.min(n+32768,e)),s+=String.fromCharCode.apply(null,Array.from(i)),n+=32768;return btoa(s)}function Ai(t){for(var i in t)fi(t[i])?Ai(t[i]):t.hasOwnProperty(i)||(hi(t[i])&&(t[i]=0),ci(t[i])&&(t[i]=""))}var Pi="zc.sh.msbss",Mi="zc.sh.psl",Ui="zc.crh.a.0",xi="zc.hrh.smt.0",Li=function(){function t(t,i){this.li=t,this.fi=i,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.useNetAgent=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.waitPublishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnToTcp=!1,this.turnOverTcpOnly=void 0,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.engineDestroy=!1,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[],beautyEffectOverload:[],playerRecvSEI:[],beautyEffectError:[],_engineConfigUpdate:[],backgroundEffectError:[],exceptionUpdate:[],networkQuality:[],mixerSoundLevelUpdate:[],autoMixerSoundLevelUpdate:[],_engineDestroy:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.customUa=!1,this.testNetPackageSize=!1,this.testSignalConnectCount=0,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.defaultConnTime=5,this.clientIP="",this.accessClientIp="",this.isMultiOuter=!1,this.type="PUBLIC",this.roomList=[],this.tempRoomList=[],this.isMultiRoom=!1,this.browser="",this.unregisterSeiFilter="",this.isTestMode=!1,this.debugLog=!1,this.netAppConfigDelay=0,this.seiConfig={emulationPreventionByte:!1},this.playAccelerate=!0,this.connectChanged=!1,this.autoSwitchDeviceSetting={camera:!1,microphone:!1},this.unSendMessageList=[],this.scenario=V.Default,this.testStreamRetryMode=0,this.testStreamRetryCount=10,this.supportDispatchByPass=!1,this.testStreamStatusSeq=0,this.engineConfig={keepAudioTrack:!0,playClearLastFrame:!0,previewClearLastFrame:!0,mixingAudioDelay:0,baseMixingAudioDelay:0,adaptCustomUA:!1,allowReplaceEmptyTrack:!1,publishQualityInterval:0,playQualityInterval:0},this._i=!0,this.di=!1,this.player265Validated=!1,this.player265ReceiverList=[],this.logReportCallback=bi,this.unregisterCallback=Ri,this.decodeServerError=yi,this.getLiveRoomError=Oi,this.getServerError=Si,this.mergeStreamList=Ti,this.actionSuccessCallback=pi,this.checkValidNumber=Ii,this.uint8arrayToBase64=Di,this.getSeq=n.getSeq,this.getReportSeq=n.getReportSeq}return Object.defineProperty(t.prototype,"networkState",{get:function(){var t;return null===(t=this.rtm)||void 0===t?void 0:t.stateCenter.networkState},set:function(t){var i;(null===(i=this.rtm)||void 0===i?void 0:i.stateCenter)&&!li(t)&&(this.rtm.stateCenter.networkState=t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isMiniSdp",{get:function(){if(!this._i&&!this.di)return!1;if(!window.WebAssembly||!window.Worker)return!1;var t=this.settingConfig.getSetting("open_mini_sdp");return!!ai(t)&&(this.li.info("zc.c.ims setting: "+t),t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamCenter",{get:function(){return this.mi},set:function(t){this.mi=t},enumerable:!1,configurable:!0}),t.prototype.getRequestId=function(){return this.idName+"-"+(0,n.getSeq)()},t.prototype.actionListener=function(t){for(var i=this,n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];var s=["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate","playerRecvSEI","_remoteCameraStatusUpdate","_remoteMicStatusUpdate","_streamUpdated","_deviceError","networkQuality","exceptionUpdate","mixerSoundLevelUpdate","autoMixerSoundLevelUpdate"].includes(t);if(!s&&this.listenerList[t]){var r=this.reporter.createSpan($.H,{key:Xt},{key:""},ni);r.setAttributes({listener:t,listener_params:JSON.stringify(n)}),["deviceError","streamExtraInfoUpdate","publisherStateUpdate","playerStateUpdate","roomStreamUpdate"].includes(t)&&this.li.info("zc.al ".concat(t," ").concat(JSON.stringify(n))),r.end()}this.listenerList[t]&&this.listenerList[t].forEach((function(e){try{setTimeout((function(){e.apply(void 0,n)}),0)}catch(n){i.li.error("zc.sc.al "+t+" "+n)}}))},t.prototype.getRoomByRoomID=function(t){return this.roomList.find((function(i){return i.roomID==t}))},t.prototype.getPlayRoom=function(t){return this.roomList.find((function(i){return!!i.streamList.find((function(i){return i.stream_id==t}))}))},t.prototype.destroy=function(){this.mi=null},t}(),ji=ii,qi="zb.sh.usi",Gi=function(){function t(t,i,n,e,s){this.li=t,this.vi=i,this.rtm=n,this.mi=e,this.pi=s,this.gi=0,this.bi=0,this.Ei=0,this.Si=!1,this.Ri=null,this.yi=2e3,this.Oi=5e3,this.roomID=s,this.logger=t,this.stateCenter=i}return Object.defineProperty(t.prototype,"Ti",{get:function(){return this.vi.reporter},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"reporter",{get:function(){return this.Ti},enumerable:!1,configurable:!0}),t.prototype._setCDNInfo=function(t,i){var n=i.urls_flv,e=i.urls_m3u8,s=i.urls_flv_plus,r=i.urls_m3u8_plus,o=i.urls_https_flv,u=i.urls_https_m3u8,h=i.urls_rtmp;t.urlFlv=di(n)?n[0]||"":ci(n)?n:"",t.urlHls=di(e)?e[0]||"":ci(e)?e:"",t.urlFlvPlus=di(s)?s[0]||"":ci(s)?s:"",t.urlHlsPlus=di(r)?r[0]||"":ci(r)?r:"",t.urlHttpsFlv=di(o)?o[0]||"":ci(o)?o:"",t.urlHttpsHls=di(u)?u[0]||"":ci(u)?u:"",t.urlRtmp=di(h)?h[0]||"":ci(h)?h:""},t.prototype.onStreamUpdated=function(t,i,n){},t.prototype.onStreamExtraInfoUpdated=function(t,i){},t.prototype.handleStreamStart=function(t,i){var n="zb.sh.hss";_t(this.li,n,"stream update"),this.room=i,t.body?(this.yi=t.body.stream_list_hb_wait_merge_time||2e3,this.Oi=t.body.stream_list_push_merge_timeout||5e3,this.Si=!1,this.handleFullUpdateStream(t.body.stream_seq,t.body.stream_info||[]),this._handleReconnectStream(t.body.stream_info),dt(this.li,n)):this.li.error(n+" server response wrong")},t.prototype.onPublishStateUpdate=function(t,i,n){},t.prototype._updateStreamInfo=function(t,i,n,e,s){var r,o,u=this;void 0===n&&(n=""),_t(this.li,qi);var h=n,c=null===(r=this.room)||void 0===r?void 0:r.streamList.find((function(i){return i.stream_id===t}));c||this.li.info("zb.sh.usi stream not in room cmd "+i);var a={stream_id:t,extra_info:h};2002!==i&&2003!==i||(a.stream_sid=(null==c?void 0:c.stream_sid)||"");var l=JSON.stringify(a),f={sub_cmd:i,stream_msg:l,third_token:null===(o=this.room)||void 0===o?void 0:o.token},_=this.room;if(this.vi.useNetAgent){var d=this.rtm.liveRoomHandler.sendStreamUpdate(f,(function(n,s){u.handleStreamUpdateRsp(n,t,i),e&&e(n,s)}),(function(r,o){var h=u.room,c=u.rtm.stateCenter.roomModulesList.find((function(t){return t.roomID===(null==h?void 0:h.roomID)})),a=function(){return(null==c?void 0:c.isTryLogin())||"CONNECTING"===(null==c?void 0:c.roomState)},l=function(){u.li.warn("zb.sh.usi resend stream update "+i),u._updateStreamInfo(t,i,n,e,s)};if(h&&((null==c?void 0:c.isLogin())||a())&&r.code&&r.code==Tt.code&&h.streamInfoList[t].seq==o)setTimeout((function(){if(2001==i&&u.vi.publishStreamList[t]&&u.vi.publishStreamList[t].state==E||2002==i)if(a()){var n=function(t,i){var e=function(){u.rtm.stateCenter.offListener("_roomStateUpdate",n)};t===(null==h?void 0:h.roomID)&&"CONNECTED"===i?(l(),e()):t===(null==h?void 0:h.roomID)&&"DISCONNECTED"===i&&e()};u.rtm.stateCenter.onListener("_roomStateUpdate",n)}else l();else s&&s(Tt)}),0);else if(r.body&&r.body.err_code){var f=u.vi.getServerError(r.body.err_code,u.vi.useNetAgent,r.body.err_message);[1011,1000002002].includes(f.code)&&(f=Nt),s&&s(f,o),i===R&&u.onPublishStateUpdate(tt,t,f)}}),{sessionID:null==_?void 0:_.sessionID,roomID:null==_?void 0:_.roomID,roomSessionID:null==_?void 0:_.roomSessionID});[2001,2002].includes(i)&&(this.room.streamInfoList[t]={seq:d})}mt(this.li,qi,"cmd: "+i+", roomid: ".concat(null==_?void 0:_.roomID,", stream: ").concat(t))},t.prototype.updateStreamInfo=function(t,i,n,e,s){var r=this;if(void 0===n&&(n=""),this.room){var o;if(2001===i||2002===i)(o=this.Ti.createSpan($.H,{key:Yt,par:this.pi},{key:""},Ft)).setAttributes({stream_update_type:Zt(2001===i?"stream added":2002===i?"stream deleted":""),stream_extra_info:Qt(n),stream_id:ti(t)});this._updateStreamInfo(t,i,n,(function(t,n){[2001,2002].includes(i)&&(o.setAttributes({send_seq:n}),o&&o.end()),e&&e(t,n)}),(function(t,n){[2001,2002].includes(i)&&(o.setAttributes({send_seq:n}),r.Ti.setError(o,t)),s&&s(t,n)}))}else this.li.warn("zb.sh.usi room not exist")},t.prototype.handleStreamUpdateRsp=function(t,i,n){var e,s,r,o;if(this.rtm.isDisConnect())this.li.warn("zb.sh.hsur not login");else if(0==t.body.err_code){this.li.info("zb.sh.hsur stream seq "+this.bi+" server seq "+t.body.stream_seq);var u=this.room;if(u){if(null===(e=null==t?void 0:t.body)||void 0===e?void 0:e.token_remain_time)this.vi.getRoomByRoomID(null===(s=null==t?void 0:t.header)||void 0===s?void 0:s.room_id)?this.rtm.resetRoomTokenTimer(t.header.room_id,t.body.token_remain_time):this.li.error("zb.sh.hsur room no found ignore "+JSON.stringify(null===(r=t.header)||void 0===r?void 0:r.room_id));if(this.vi.useNetAgent){this.handleStreamSync(t,i,n);var h=u.streamInfoList[i],c=null===(o=t.header)||void 0===o?void 0:o.seq;h&&h.seq===c?delete u.streamInfoList[i]:this.li.info("zb.sh.hsur ".concat(JSON.stringify(i)," udp stream info; rsp seq: ").concat(c,", cur seq: ").concat(null==h?void 0:h.seq," "))}}else this.li.info("hsur.0 room no found")}else this.li.error("zb.sh.hsur stream update error "+t.body.err_code)},t.prototype.handleStreamSync=function(t,i,n){if(this.handleStreamRsp(this.room,i,{stream_id:i,stream_sid:t.body.stream_sid,stream_ver:t.body.stream_ver,stream_nid:t.body.stream_nid,id_name:this.vi.idName,nick_name:this.vi.nickName},n),t.body.stream_seq>this.bi+1)return this.li.info("zb.sh.hss.1 seq diff server: "+t.body.stream_seq+" client "+this.bi),void this.fetchStreamList();this.bi=t.body.stream_seq;var e=this.room.streamList.find((function(t){return t.stream_id==i}));e&&t.body.stream_ver>e.stream_ver&&this.fetchStreamList(i)},t.prototype.handleStreamRsp=function(t,i,n,e){var s=this.vi.publishStreamList[i],r=t.streamList.find((function(t){return t.stream_id==i}));if(this.li.info("hsur.0 cmd "+e+" "+!!r),r&&2002===e){var o=t.streamList.findIndex((function(t){return t.stream_id==i}));this.li.info("hsur.0 stream index "+o),o>-1&&t.streamList.splice(o,1)}s?(s.state==E&&(s.state=S,2001!==e||r||t.streamList.push(n),this.onPublishStateUpdate(Q,i,{code:0,message:""})),r&&r.stream_sid!==n.stream_sid&&(this.li.info("hsur.0 update sid. "+i+" origin:"+r.stream_sid+", new:"+n.stream_sid),r.stream_sid=n.stream_sid)):this.li.info("hsur.0 stream is not exist")},t.prototype.handleFetchStreamListRsp=function(t,i){var n,e,s,r,o,u,h="zb.sh.hfslr";if(_t(this.li,h,i),this.Si=!1,this.Ti.spanEnd({key:ji.event,par:this.pi},{stream_seq:ji.stream_seq(null===(n=t.body)||void 0===n?void 0:n.stream_seq),stream_size:ji.stream_size(null===(s=null===(e=t.body)||void 0===e?void 0:e.stream_info)||void 0===s?void 0:s.length),stream_list:ji.stream_list(null===(r=t.body)||void 0===r?void 0:r.stream_info),error:(null===(o=null==t?void 0:t.body)||void 0===o?void 0:o.err_code)||(null==t?void 0:t.code),message:(null===(u=null==t?void 0:t.body)||void 0===u?void 0:u.err_message)||(null==t?void 0:t.msg)}),0===t.body.err_code)if(this.bi!==t.body.stream_seq){if(this.bi>t.body.stream_seq)return this.li.error(h+" less seq"),void this.fetchStreamList(i);if(this.Ei>t.body.stream_seq)this.li.info(h+" less than max fetch stream seq ");else{var c=t.body.stream_info;this.vi.useNetAgent&&i&&(c=t.body.stream_info.filter((function(t){return t.stream_id===i}))),this.handleFullUpdateStream(t.body.stream_seq,c),mt(this.li,h)}}else this.li.info(h+" same seq");else this.li.info(h+" server error=",t.body.err_code)},t.prototype.syncPublishStreamList=function(){var t="zb.sh.spsl";_t(this.li,t);var i=function(t){var i=n.vi.publishStreamList[t];if(i.state===S){var e=n.room.streamList.findIndex((function(i){return i.stream_id===t}));if(i.roomID===n.room.roomID&&-1===e)i.state=E,n.updateStreamInfo(t,R,i.extra_info,(function(t){}))}},n=this;for(var e in this.vi.publishStreamList)i(e);mt(this.li,t)},t.prototype.handleFullUpdateStream=function(t,i){var n=this,e="zb.sh.hfus";_t(this.li,e),this.bi=t,this.Ei<t&&(this.Ei=t),this.li.debug(e+" server seq "+this.bi),i=i.filter((function(t){return 1!==t.stream_type})),this.vi.mergeStreamList(this.vi.idName,this.room.streamList,i,(function(t,i,s){0!==t.length&&(n.li.debug(e+" callback addstream"),n.onStreamUpdated(n.pi,T,n.makeCallbackStreamList(t))),0!==i.length&&(n.li.debug(e+" callback delstream"),n.onStreamUpdated(n.pi,w,n.makeCallbackStreamList(i))),0!==s.length&&(n.li.debug(e+" callback updatestream"),n.onStreamExtraInfoUpdated(n.pi,n.makeCallbackStreamList(s)))})),this.syncPublishStreamList(),mt(this.li,e)},t.prototype.handlePushStreamUpdateMsg=function(t){var i="zb.sh.hpsum";_t(this.li,i,JSON.stringify(t));var n=t.body.stream_info;if(n&&0!==n.length){if(n=n.filter((function(t){return 1!==t.stream_type})),this.bi+1!==t.body.stream_seq)return _t(this.li,i,"updatestream 1"),void this.fetchStreamList();if(t.body.stream_seq<this.Ei)return _t(this.li,i,"updatestream 2"),void this.fetchStreamList();switch(this.bi=t.body.stream_seq,t.body.stream_cmd){case C:this.wi(n);break;case k:this.Ii(n);break;case z:this._handleUpdatedStreamList(n)}mt(this.li,i)}else this.li.info(i+", emtpy list")},t.prototype.wi=function(t){var i="zb.sh.hasl";_t(this.li,i);for(var n,e=[],s=0;s<t.length;s++)if(t[s].anchor_id_name!=this.vi.idName&&t[s].id_name!=this.vi.idName&&t[s].user_id!==this.vi.idName){n=!1;for(var r=0;r<this.room.streamList.length;r++)if(t[s].stream_id===this.room.streamList[r].stream_id){n=!0;break}n||e.push(t[s])}else this.li.debug("hdsl.0 have self stream added");if(0!==e.length){this.li.debug(i+" callback addstream");for(var o=0;o<e.length;o++){this.room.streamList.push(e[o]);var u=this.mi.playerList[e[o].stream_id];null==u||u.player.setStreamAdd()}this.onStreamUpdated(this.pi,T,this.makeCallbackStreamList(e))}mt(this.li,i)},t.prototype.Ii=function(t){var i="zb.sh.hdsl";_t(this.li,i);for(var n=[],e=0;e<t.length;e++)if(t[e].anchor_id_name!=this.vi.idName&&t[e].id_name!=this.vi.idName&&t[e].user_id!==this.vi.idName){for(var s=this.room.streamList.length-1;s>=0;s--)if(t[e].stream_id===this.room.streamList[s].stream_id){!this.vi.connectChanged&&this.room.streamList.splice(s--,1),n.push(t[e]);break}}else this.li.debug(i+" have self stream deleted");0!==n.length&&(this.li.debug(i+" callback delstream"),this.onStreamUpdated(this.pi,w,this.makeCallbackStreamList(n))),dt(this.li,i)},t.prototype._handleUpdatedStreamList=function(t){var i="zb.sh.husl";_t(this.li,i);for(var n=[],e=0;e<t.length;e++)if(t[e].anchor_id_name!=this.vi.idName&&t[e].id_name!=this.vi.idName&&t[e].user_id!==this.vi.idName){for(var s=0;s<this.room.streamList.length;s++)if(t[e].stream_id===this.room.streamList[s].stream_id){t[e].extra_info!==this.room.streamList[s].extra_info&&(this.room.streamList[s]=t[e],n.push(t[e]));break}}else this.li.debug("hsul.0 have self stream updated");0!==n.length&&(this.li.debug(i+" callback updatestream"),this.onStreamExtraInfoUpdated(this.pi,this.makeCallbackStreamList(n))),mt(this.li,i)},t.prototype.fetchStreamList=function(t){var i,n,e,s=this,r="zb.sh.fsl";_t(this.li,r);var o=this.Ti.createSpan($.H,{key:Yt,par:this.pi},{key:ji.event,par:this.pi},ji.event,!0);return this.rtm.isDisConnect()?(this.li.info(r+" state error"),void this.Ti.setError(o,ji.error.NOT_LOGIN)):this.Si?(this.li.info(r+" already doing"),void this.Ti.setError(o,ji.error.ii," already doing")):(this.Si=!0,this.li.info(r+" send fetch request"),this.vi.useNetAgent&&this.rtm.liveRoomHandler.getStreamList({},(function(i){s.handleFetchStreamListRsp(i,t)}),(function(t){}),{roomID:null===(i=this.room)||void 0===i?void 0:i.roomID,sessionID:null===(n=this.room)||void 0===n?void 0:n.sessionID,roomSessionID:null===(e=this.room)||void 0===e?void 0:e.roomSessionID}),void mt(this.li,r))},t.prototype._handleReconnectStream=function(t){var i,n,e,s,r,o,u,h="zb.sh.hrs";_t(this.li,h);var c=this.mi.publisherList,f=this.mi.playerList;this.li.info(h+" publish "+Object.keys(this.mi.publisherList));var m=function(h){if((null===(n=null===(i=c[h])||void 0===i?void 0:i.room)||void 0===n?void 0:n.roomID)!==v.pi)return"continue";var f=t.find((function(t){return t.stream_id==h})),m=f&&!(f.anchor_id_name===v.vi.idName||f.id_name===v.vi.idName||f.user_id===v.vi.idName);if(v.li.info("zb.sh.hrs stream ".concat(h," ").concat(!!f," ").concat(m," ").concat(null===(e=c[h].publisher)||void 0===e?void 0:e.state)),(null===(s=c[h].publisher)||void 0===s?void 0:s.state)!=a&&c[h].state!==_||f&&!m){if(((null===(r=c[h].publisher)||void 0===r?void 0:r.state)==l||c[h].state===d)&&!(null===(u=null===(o=c[h])||void 0===o?void 0:o.retryStreamHandler)||void 0===u?void 0:u.maxTimer)&&t.find((function(t){return t.stream_id==h}))){v.updateStreamInfo(h,y);for(var p=0;p<v.room.streamList.length;p++)if(v.room.streamList[p].stream_id==h){v.room.streamList.splice(p--,1);break}}}else v.updateStreamInfo(h,R,v.vi.publishStreamList[h].extra_info)},v=this;for(var p in c)m(p);for(var p in c){if(c[p].room.roomID===this.pi)if(c[p].isReDispatch)this.li.info(h+" "+p+"retry dispatch"),(g=c[p].retryDispatchHandler).stopMaxTime(),g.invalid(),g.initStream(p,c[p].publishOption,!0),g.active(0),c[p].isReDispatch=!1}for(var p in f){var g;if(f[p].room.roomID===this.pi)if(f[p].isReDispatch)this.li.info(h+" "+p+"retry dispatch"),(g=f[p].retryDispatchHandler).stopMaxTime(),g.invalid(),g.initStream(p,f[p].playOption,!1),g.active(0),f[p].isReDispatch=!1}var b=this.mi.stopedPlayerList;for(var p in b)if(b[p].roomID===this.pi){var E=this.mi,S=b[p],O=S.playOption;E.setPlayStateStart(p,O,S.isDataChannel);var T=E.playerList[p].retryDispatchHandler;E.playSuccessCallBackList[p]=b[p].sucCallBack?b[p].sucCallBack:function(t){},b[p].errCallBack&&(E.playErrorCallBackList[p]=b[p].errCallBack),E.onPlayStateUpdate(et,p,{code:0,message:""}),T.stopMaxTime(),T.invalid(),T.initStream(p,O,!1),T.startMaxTime(),T.active(0),delete b[p]}dt(this.li,h)},t.prototype.makeCallbackStreamList=function(t){var i,n=[];this.vi.useNetAgent&&this.vi.appConfig&&(i=this.vi.appConfig.media_config.play_config.resource_info.filter((function(t){return[u.CDN,u.DG].includes(t.resource_type)})));if(t&&t.length>0)for(var e=0;e<t.length;e++){var s=t[e].stream_id;if(i&&i.length)for(var r=0;r<i.length;r++){for(var o=i[r].resource_type==u.DG?"_plus":"",c=[],a=[],l=[],f=0;f<i[r].service_info.length;f++){var _=i[r].service_info[f],d=_.protocol,m=_.url_template.replace("{STREAM_NAME}",s);switch(d){case h.FLV:c.push(m);break;case h.HLS:a.push(m);break;case h.RTMP:l.push(m)}}t[e]["urls_flv"+o]=c,t[e]["urls_m3u8"+o]=a,t[e]["urls_rtmp"+o]=l}var v={user:{userID:t[e].anchor_id_name||t[e].id_name,userName:t[e].anchor_nick_name||t[e].nick_name},extraInfo:t[e].extra_info,streamID:t[e].stream_id,roomID:"",urlFlv:"",urlFlvPlus:"",urlRtmp:"",urlHls:"",urlHlsPlus:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:t[e].stream_gid,closeType:t[e].close_type};this._setCDNInfo(v,t[e]),n.push(v)}return n},t.prototype.sendHttpPBRequest=function(t,i,n,e,s){var r,o;null===(r=this.rtm.netAgent)||void 0===r||r.startHttpRequest2({interfaceID:t.interfaceID,resID:t.resID||"",body:i,ack:!1,idName:this.vi.idName,method:2,token:null===(o=this.room)||void 0===o?void 0:o.token,mode:this.vi.testEnvironment?2:1,reduceRspHeaders:!0},(function(t,i){n&&n(t,i)}),(function(t){e&&e(t)}),null,{timeout:(null==s?void 0:s.timeout)||4e3,extras:{protoCmd:t.protoCmd}})},t.prototype.sendMixRequest=function(t,i,n,e,s){var r=this;void 0===s&&(s=2);var o=function(o,u){var h=o.status_code,c=o.body;if(200!==h)return s--,void(502===h&&s>0?r.sendMixRequest(t,i,n,e,s):e&&e(h,c));n&&n(c,u)};this.sendHttpPBRequest(t,i,(function(t,i){o(t,i)}),(function(t){o(t)}))},t.prototype.sendRTMPRequest=function(t,i,n){var e=this.rtm.netAgent,s=this.vi.appid,r=t.streamID,o="/v1/jsrtmp/dispatch/".concat(s,"/").concat(r,"/").concat(t.actionType,"/").concat(e.clientIP),u=this.room;e.startHttpRequest({service:1,headers:[{name:"Token-Appid",val:s+""},{name:"Token-Str",val:(null==u?void 0:u.token)||""},{name:"Token-Userid",val:this.vi.idName},{name:"Token-Biztype",val:"2"}],body:{},idName:this.vi.idName,method_no:1,ack:!1,location:o},(function(t){i(t)}),(function(t,i,e){n(t)}))},t.prototype._publishTarget=function(t,i,n){this.li.info("zb.sh.pt call")},t.prototype.updateStreamExtraInfo=function(t,i,n,e){_t(this.li,"zb.sh.usei");var s=O;this.vi.publishStreamList[t]&&this.vi.publishStreamList[t].state>=E?(this.vi.publishStreamList[t].extra_info=i,this.updateStreamInfo(t,s,i,n,e)):this.vi.publishStreamList[t]&&this.vi.publishStreamList[t].state===b?(this.vi.publishStreamList[t].extra_info=i,n({errorCode:0})):e(ui.error.ai)},t.prototype.setStreamExtraInfo=function(t,i,n,e){this.updateStreamExtraInfo(t,i,n,e)},t.prototype._publishTargetWeb=function(t,i,n){},t.prototype.patchStreamList=function(t){var i=this;if(hi(t.body.stream_refresh)&&0!==t.body.stream_refresh)return this.li.info("zc.sh.psl stream refresh "),void this.fetchStreamList();this.li.info("zc.sh.psl stream seq "+this.bi+" "+JSON.stringify(this.Ri)),t.body.stream_seq>this.bi&&!this.Ri&&(this.Ri={},_t(this.li,Mi,"update stream "+this.bi+" server "+t.body.stream_seq),this.Ni&&clearTimeout(this.Ni),this.Ni=setTimeout((function(){i.handleMergeTimeout()}),this.yi)),this.gi=t.body.stream_seq},t.prototype.getStreamSeq=function(){return this.bi},t.prototype.mergeStreamByStreamSeq=function(t,i,n){var e=this;this.Ri||(this.li.warn("zc.sh.msbss new merge stream list "+this.bi+" server "+i),this.Ri={},this.Ni&&clearTimeout(this.Ni),this.Ni=setTimeout((function(){e.handleMergeTimeout()}),this.Oi)),this.li.info(Pi+" ".concat(this.Ri," ").concat(t," ").concat(i," ").concat(n)),this.Ri[i]={cmd:t,streamList:n}},t.prototype.handleMergeTimeout=function(){if(this.Ri){var t=Object.keys(this.Ri).map((function(t){return+t})).sort((function(t,i){return t-i}));t[t.length-1]-t[0]+1===t.length||t[t.length-1]>=this.gi?this.mergeStream(t):(this.Ri=null,this.fetchStreamList())}},t.prototype.mergeStream=function(t){var i=this;this.li.info("zc.sh.ms merge streamList "+this.bi+" streamSeqList "+t.join(","));var n=t[t.length-1],e=[];t.forEach((function(t){if(i.Ri&&i.Ri[t])switch(i.Ri[t].cmd){case C:i.Ri[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i),e.push(t)}));break;case k:i.Ri[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i)}));break;case z:i.Ri[t].streamList.forEach((function(t){var i=e.findIndex((function(i){return i.stream_id==t.stream_id}));-1!==i&&e.splice(i),e.push(t)}))}})),this.Ri=null,this.li.info("zc.sh.ms "+e),this.handleFullUpdateStream(n,e)},t.prototype.reset=function(){this.gi=0,this.Ri=null,this.Ni&&(clearTimeout(this.Ni),this.Ni=void 0),this.yi=2e3,this.Oi=5e3},t}(),Hi="/sdk/init",Bi="/sdk/check_system",Vi={kCheckSystemGetSettingFailError:{code:1101001,message:"wx get setting fail"}},$i=Bt,Ji={event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:St,Ci:kt,kPublishStreamIDTooLongError:Et,kPublishStreamIDInvalidCharacterError:Rt,ki:Tt,zi:Ct,Di:It,Ai:yt,Pi:bt,Mi:Dt,Ui:Pt},publishOption:Bt,stream:Bt,message:Bt},Yi={event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:St,xi:Ut,kPlayStreamIDTooLongError:Et,Li:Rt,ji:bt,qi:zt,Gi:jt,Hi:Tt,Bi:Ct,Vi:It,$i:yt,Ji:xt,Yi:Lt},playOption:Bt,message:Bt,session_id:Bt,stream:Bt,audio_activate:Bt,video_activate:Bt},Xi="/sdk/stop_publish",Wi="/sdk/stop_play",Ki="/liveroom/get_stream_update_info",Fi=Bt,Zi=Bt,Qi="/liveroom/get_stream_extra_info",tn=Bt,nn=function(){return nn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},nn.apply(this,arguments)},en=function(){function t(t,i,n,e,s){this.li=t,this.dataReport=i,this.vi=n,this.mi=e,this.rtm=s,this.preferPublishSourceType=M.ultra,this.ultraPlaySourceType="rtmp_v2"}return t.prototype.startPublishingStream=function(t,i){var e=this;return new Promise((function(s,r){var o;e.li.info("zw.pu.sps.0 call");var u=(0,n.getReportSeq)();e.vi.reportSeqList.startPublish[t]=u,e.dataReport.newReport(u,Ji.event);var h=function(i,n){e.li.error("zw.pu.sps.0 "+(n||i.message)),e.dataReport.uploadReport(u,void 0,i,n),delete e.vi.reportSeqList.startPublish[t],r(nn(nn({},i),{errorCode:i.code,extendedData:i.message+(n?" "+n:"")}))};if(ki(t))if(ci(t)){if(!zi(t,256))return h(Ji.error.kPublishStreamIDTooLongError),!1;if(!mi(t))return h(Ji.error.kPublishStreamIDInvalidCharacterError),!1;if(e.vi.isMultiRoom&&(!i||!ci(i.roomID)||""==i.roomID))return h(Ji.error.Ci,"  roomID is need if set multi room"),!1;var c=(null==i?void 0:i.roomID)?i.roomID:null===(o=e.vi.roomList[0])||void 0===o?void 0:o.roomID,a=e.vi.getRoomByRoomID(c);if(e.dataReport.addMsgInfo(u,{stream:Ji.stream(t),publish_room_id:c}),a){if(e.vi.customUrl&&0!=e.vi.customUrl.length){e.vi.publishStreamList[t]={state:g,extra_info:i&&i.extraInfo?i.extraInfo:null,roomID:c};var l=e.mi.updatePublishingState(a,t,i&&i.streamParams?i.streamParams:void 0,!0);if(!0!==l){var f=JSON.parse(JSON.stringify(l));return void h(f,"cannot start publish")}return e.mi.publishSuccessCallBackList[t]=function(t,i){s({streamID:t,url:i})},e.mi.startPublishingStream(t,e.vi.customUrl,1)}if(e.rtm.isDisConnect())h(Ji.error.Pi);else{var _=e.mi.updatePublishingState(a,t,i&&i.streamParams?i.streamParams:void 0,!0);if(!0===_)bi("kZegoTaskPublishStart"+t,e.dataReport,u,e.vi.reportList),a.streamHandler.onPublishStateUpdate(it,t,{code:0,message:""}),e.dataReport.addMsgInfo(u,{publishOption:Ji.publishOption(i),mini_sys_infos:e.mi.systemInfo}),!i||"CDN"!=i.sourceType&&"BGP"!=i.sourceType||e.setPreferPublishSourceType(U[i.sourceType]),e.vi.publishStreamList[t]={state:g,extra_info:i&&i.extraInfo?i.extraInfo:null,roomID:null==a?void 0:a.roomID},e.li.info("zw.pu.sps.0 fetch stream url"),Ei("kZegoTaskPublishStart"+t,e.vi.reportList,st,"get_publish_url"),e.mi.publishSuccessCallBackList[t]=function(t,i){Ei("kZegoTaskPublishStart"+t,e.vi.reportList,ot,"get_publish_url"),s({streamID:t,url:i})},e.mi.publishErrorCallBackList[t]=function(t){h(t)},e.fetchPublishStreamUrl(t,a);else{f=JSON.parse(JSON.stringify(_));h(f,"cannot start publish")}}}else h(Ji.error.Ci,"room no found")}else h(Ji.error.Ci);else h(Ji.error.kPublishStreamIDNullError)}))},t.prototype.setPreferPublishSourceType=function(t,i){return this.li.info("zw.pu.sppst.0 call"),t!==M.cdn&&t!==M.ultra&&t!==M.customUrl?(this.li.error("zw.pu.sppst.0 sourceType only can be number 0 1 2"),!1):t!==M.customUrl||ci(i)&&""!=i?(this.preferPublishSourceType=t,this.customCdnUrl=i,this.li.info("zw.pu.sppst.0 call success"),!0):(this.li.error("zw.pu.sppst.0 customUrl must be string and not empty"),!1)},t.prototype.fetchPublishStreamUrl=function(t,i){var n=this;if(this.li.info("zw.pu.fpsu.0 call"),this.li.info("zw.pu.fpsu.0 send fetch publish request"),this.preferPublishSourceType==M.cdn){var e=this.mi.getCDNUrl(t,1).rtmps;e&&e.length?this.doPublishStream(t,e,i):this.handleStreamPublishFail(t,i,"the cdn url is empty from app config")}else{this.mi.eventSeq+=1;var s=this.mi.eventSeq,r=this.mi.publisherList[t],o=r.dispatchRetryHandler;o.initRequestInfo({actionType:"push",streamID:t},i),o.initCallback((function(e){e.seq=s,n.handleFetchStreamPublishUrlRsp(e,t,i.roomID)}),(function(e){n.handleStreamPublishFail(t,i)})),r.dispatchRetryHandler.startMaxTime(),r.dispatchRetryHandler.active(!0),this.vi.streamUrlMap[s]=t}this.li.info("zw.pu.fpsu.0 call success")},t.prototype.handleFetchStreamPublishUrlRsp=function(t,i,n){this.li.info("zw.pu.hfspur.0 call");var e=this.vi.getRoomByRoomID(n);if(e){var s;if(this.vi.streamUrlMap[null==t?void 0:t.seq]&&delete this.vi.streamUrlMap[null==t?void 0:t.seq],0!==(s=t.code))return this.li.info("zw.pu.hfspur.0 server error= "+s),void(this.vi.publishStreamList[i]&&(this.li.error("zw.pu.hfspur.0 liveRoom cmd error"),this.handleStreamPublishFail(i,e,"server error="+s)));t.hosts&&this.doPublishStream(i,t.hosts||[],e)}else this.li.error("zw.pu.hfspur.0 room no found")},t.prototype.handleStreamPublishFail=function(t,i,n){var e=Ji.error.Di;this.li.error("zw.pu.hspf.0 "+(n=n||e.message)),this.mi.publishErrorCallBackList[t](e),this.mi.stopPublishingStream(t,{code:e.code,message:n})},t.prototype.doPublishStream=function(t,i,n){return this.li.info("zw.pu.dps.0 call "+t+"streamUrl: "+JSON.stringify(i)),this.vi.publishStreamList[t]?(this.vi.publishStreamList[t].state=b,!i||i.length<=0?(this.handleStreamPublishFail(t,n),!1):(this.mi.startPublishingStream(t,i,this.preferPublishSourceType),this.li.info("zw.pu.dps.0 call success"),!0)):(this.li.error("zw.pu.dps.0 cannot find stream"),!1)},t.prototype.stopPublishingStream=function(t,i){var e,s,r=this;this.li.info("zw.pu.sps.0.0 call "+t);var o=(0,n.getReportSeq)();this.dataReport.newReport(o,Xi),this.dataReport.addMsgInfo(o,{stream_id:t,room_id:null===(s=null===(e=this.mi.publisherList[t])||void 0===e?void 0:e.room)||void 0===s?void 0:s.roomID});var u=function(i,n){r.li.error("zw.pu.sps.0.0 "+(n||i.message)),r.dataReport.uploadReport(o,void 0,i,n),delete r.vi.reportSeqList.startPublish[t]};if(!ki(t))return u(Ji.error.kPublishStreamIDNullError),!1;if(!ci(t))return this.li.error("zw.pu.sps.0.0 param error"),u(Ji.error.Ci),!1;var h=this.mi.publisherList[t];return(null==h?void 0:h.room)?(this.mi.stopPublishingStream(t,void 0,i),this.dataReport.uploadReport(o),this.li.info("zw.pu.sps.0.0 call success"),!0):(u(Ji.error.Ci," room no found"),!1)},t}(),sn=function(){return sn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},sn.apply(this,arguments)},rn=function(){function t(t,i,n,e,s){this.li=t,this.dataReport=i,this.vi=n,this.mi=e,this.rtm=s,this.mixStreamList={},this.streamUrlRspList={},this.preferPlaySourceType=A.ultra,this.ultraPlaySourceType="rtmp_v2"}return Object.defineProperty(t.prototype,"isDisConnect",{get:function(){return this.rtm.isDisConnect()},enumerable:!1,configurable:!0}),t.prototype.startPlayingStream=function(t,i){var e=this;return new Promise((function(s,r){e.li.info("zw.pl.sps.1 call "+t);var o=(0,n.getReportSeq)();e.vi.reportSeqList.startPlay[t]=o,e.dataReport.newReport(o,Yi.event);var u=function(i,n){e.li.error("zw.pl.sps.1 "+(n||i.message)),e.dataReport.uploadReport(o,void 0,i,n),delete e.vi.reportSeqList.startPlay[t],r(sn(sn({},i),{errorCode:i.code,extendedData:i.message+(n?" "+n:"")}))};if(ki(t))if(ci(t))if(zi(t,256))if(mi(t)){if(e.vi.customPlayUrl&&0!=e.vi.customPlayUrl.length){var h=e.mi.updatePlayingState(t,i?i.streamParams:void 0,!0);if(!0!==h){var c=JSON.parse(JSON.stringify(h));return void u(c,"cannot start play")}return e.mi.playErrorCallBackList[t]=function(t){u(t)},e.mi.startPlayingStream(t,e.vi.customPlayUrl,1)}if(e.isDisConnect)u(Yi.error.ji);else{var a=e.mi.updatePlayingState(t,i?i.streamParams:void 0,!0);if(!0===a){if(e.mi.onPlayStateUpdate(et,t,{code:0,message:""}),bi("kZegoTaskPlayStart"+t,e.dataReport,o,e.vi.reportList),e.dataReport.addMsgInfo(o,{stream:Yi.stream(t),playOption:Yi.playOption(i),mini_sys_infos:e.mi.systemInfo}),e.mi.playSuccessCallBackList[t]=function(t,i){Ei("kZegoTaskPlayStart"+t,e.vi.reportList,ot,"get_play_url"),s({streamID:t,url:i})},e.mi.playErrorCallBackList[t]=function(i){Ei("kZegoTaskPlayStart"+t,e.vi.reportList,ot,"get_play_url"),u(i)},i&&i.isMix){e.mixStreamList[t]={ultra_url_rtmp:null};var l="BGP"==i.sourceType,f=l?"rtmp_v2":"rtmp_cdn",_=l?M.ultra:M.cdn;return e.li.info("zw.pl.sps.1 play mix: "+"".concat(f,", ").concat(_)),void e.fetchPlayStreamUrl(t,f,_)}Ei("kZegoTaskPlayStart"+t,e.vi.reportList,st,"get_play_url"),i&&"CDN"==i.sourceType||e.preferPlaySourceType===A.cdn?e.startPlayingStreamFromCDN(t):e.startPlayingStreamFromBGP(t)}else{c=JSON.parse(JSON.stringify(a));u(c)}}}else u(Yi.error.Li);else u(Yi.error.kPlayStreamIDTooLongError);else u(Yi.error.xi);else u(Yi.error.kPlayStreamIDNullError)}))},t.prototype.stopPlayingStream=function(t,i){var e;this.li.info("zw.pl.sps.1.0 call "+t);var s=(0,n.getReportSeq)();if(this.dataReport.newReport(s,Wi),this.dataReport.addMsgInfo(s,{stream_id:t,room_id:null===(e=this.mi.playerList[t])||void 0===e?void 0:e.room.roomID}),!ci(t)||""==t)return this.li.error("zw.pl.sps.1.0 stream ID must be string and not empty"),this.dataReport.addMsgInfo(s,Yi.error.xi),void this.dataReport.uploadReport(s);var r=this.mi.playerList[t],o=r&&r.state!==d;for(var u in this.mi.stopPlayingStream(t,void 0,i),o&&this.mi.onPlayStateUpdate(nt,t,{code:0,message:""}),this.vi.streamUrlMap)if(this.vi.streamUrlMap[u]===t){delete this.vi.streamUrlMap[u];break}this.mixStreamList[t]&&delete this.mixStreamList[t],this.dataReport.uploadReport(s),this.li.info("zw.pl.sps.1.0 call success")},t.prototype.startPlayingStreamFromCDN=function(t){this.li.info("zw.pl.spsfc call "+t);var i=this.vi.getPlayRoom(t)||this.vi.roomList[0];if(!i)return this.li.error("zw.pl.spsfc room no found"),!1;for(var n=null,e=0;e<i.streamList.length;e++)if(i.streamList[e].stream_id===t){n=i.streamList[e].urls_rtmp||[];break}if(!n||n.length<=0){var s;if(!(s=this.mi.getCDNUrl(t,0).rtmps)||!s.length)return this.li.error("zw.pl.spsfc cannot find stream url,Please check if CDN is configured "),this.mi.onPlayStateUpdate(nt,t,Yi.error.Vi),!1;this.li.info("zw.pl.spsfcfrom app config"),n=s}return this.li.info("zw.pl.spsfc play stream"),this.doPlayStream(t,n,M.cdn)},t.prototype.startPlayingStreamFromBGP=function(t){return this.li.info("zw.pl.spsfb fetch stream url"),this.fetchPlayStreamUrl(t,this.ultraPlaySourceType,M.ultra),!0},t.prototype.doPlayStream=function(t,i,n){return this.li.info("zw.pl.dps call"),this.mi.startPlayingStream(t,i,n),!0},t.prototype.fetchPlayStreamUrl=function(t,i,n){var e=this;if(this.li.info("zw.pl.fpsu call "+t),this.isDisConnect)this.li.info("zw.pl.fpsu state error");else{this.li.info("zw.pl.fpsu send fetch request");var s=this.vi.roomList[0].roomID,r=this.vi.getRoomByRoomID(s);if(this.mi.eventSeq+=1,r){if(n==M.cdn){var o=this.mi.getCDNUrl(t,0).rtmps;o&&o.length?this.doPlayStream(t,o,n):this.handleStreamUrlFail(t,Yi.error.Vi.code)}else{var u=this.mi.eventSeq,h=this.mi.playerList[t],c=h.dispatchRetryHandler;c.initRequestInfo({actionType:"pull",streamID:t},r),c.initCallback((function(i){i.seq=u,e.handleFetchStreamUrlRsp(i,n,t,s)}),(function(i){e.handleStreamUrlFail(t,i.code)})),h.dispatchRetryHandler.startMaxTime(),h.dispatchRetryHandler.active(!0),this.vi.streamUrlMap[u]=t,this.mi.playerList[t]&&(this.mi.playerList[t].seq=u)}this.li.info("zw.pl.fpsu call success")}else this.li.error("zw.pl.fpsu room no found")}},t.prototype.handleFetchStreamUrlRsp=function(t,i,n,e){var s,r;this.li.info("zw.pl.hfsur call ");var o;if(r=t.code,this.vi.streamUrlMap[o=t.seq]&&delete this.vi.streamUrlMap[o],0!==r)return this.li.error("zw.pl.hfsur server error= "+r),void this.handleStreamUrlFail(n,r);var u=[];t.hosts&&t.hosts.length>0&&(u=t.hosts);var h=!1,c=this.vi.getRoomByRoomID(e);if(c)if(o===(null===(s=this.mi.playerList[n])||void 0===s?void 0:s.seq)){for(var a=0;a<c.streamList.length;a++)if(c.streamList[a].stream_id==n){c.streamList[a].urltra_url_rtmp=u,h=!0;break}!h&&this.mixStreamList[n]&&(this.mixStreamList[n].urltra_url_rtmp=u,i=M.cdn,h=!0),h||(this.li.info("zw.pl.hfsurcannot find streamInfo in existing stream list"),this.streamUrlRspList[n]=u),this.doPlayStream(n,u,i),this.li.info("zw.pl.hfsur call success")}else this.li.info("zw.pl.hfsur seq is not match, ignore "+n);else this.li.error("zw.pl.hfsur room no found")},t.prototype.handleStreamUrlFail=function(t,i){this.mi.onPlayStateUpdate(nt,t,1900001004===i?Yi.error.Gi:Yi.error.Vi)},t.prototype.setPreferPlaySourceType=function(t){return this.li.info("zw.w.sppst.1 call"),t!==A.cdn&&t!==A.ultra?(this.li.error("zw.w.sppst.1 sourceType can be number 0 or 1, which can be represented auto or ultra"),!1):(this.preferPlaySourceType=t,this.li.info("zw.w.sppst.1 call success"),!0)},t}(),on=function(t,i){var n,e={10001:"",10002:""};n=wx.getSystemInfoSync().SDKVersion;var s={code:0,msg:""};(function(t,i){t=t.split("."),i=i.split(".");for(var n=Math.max(t.length,i.length);t.length<n;)t.push("0");for(;i.length<n;)i.push("0");for(var e=0;e<n;e++){var s=parseInt(t[e]),r=parseInt(i[e]);if(s>r)return 1;if(s<r)return-1}return 0})(n,"1.7.0")<0&&(s={code:10001,msg:e[10001]},t&&t(s)),wx.getSetting({success:function(i){var n=i.authSetting;n["scope.camera"]&&n["scope.record"]||(s={code:10002,msg:e[10002]}),t&&t(s)},fail:function(t){console.error("get setting error",t),i&&i(t)}})};var un,hn,cn,an,ln=function(){function t(t,i,n,e){this.mi=t,this.vi=i,this.li=n,this.rtm=e}return Object.defineProperty(t.prototype,"Ti",{get:function(){return this.vi.reporter},enumerable:!1,configurable:!0}),t.prototype.setStreamExtraInfo=function(t,i){var n=this;return new ft((function(e,s){var r=n.mi.getRoomByStreamID(t),o=ui,u=n.Ti.createSpan($.H,r?{key:Yt,par:null==r?void 0:r.roomID}:{key:Wt},{key:""},o.event);u.setAttributes({stream_id:o.stream_id(t),stream_extra_info:o.stream_extra_info(i)});var h=function(t,i){void 0===i&&(i=""),n.li.error("zb.ssei "+i),n.Ti.setError(u,t,i),s({errorCode:t.code,extendedData:t.message+" "+i})};ci(t)&&""!=t?ci(i)&&""!=i?n.rtm.isDisConnect()?h(o.error.ei,"not login"):n.vi.publishStreamList[t]?r?r.streamHandler.setStreamExtraInfo(t,i,(function(t,i){var r,h,c,a;if(0===(null===(r=null==t?void 0:t.body)||void 0===r?void 0:r.err_code)||0===(null==t?void 0:t.errorCode))u.setAttributes({send_seq:o.send_seq(i)}),u.end(),e({errorCode:0===(null===(h=null==t?void 0:t.body)||void 0===h?void 0:h.err_code)?null===(c=null==t?void 0:t.body)||void 0===c?void 0:c.err_code:null==t?void 0:t.errorCode,extendedData:""});else{var l={errorCode:(null===(a=null==t?void 0:t.body)||void 0===a?void 0:a.err_code)||(null==t?void 0:t.code)};n.Ti.setError(u,l),s(l)}}),h):h(o.error.ei,"not login"):h(o.error.ni):h(o.error.ii,"extraInfo must be string and no empty"):h(o.error.ii,"streamID must be string and not empty")}))},t}(),fn=function(){function t(t,i,n,e,s,r){this.li=t,this.dataReport=i,this.reporter=n,this.vi=e,this.rtm=r,this.currentPlaySourceType=M.cdn,this.mixStreamList={},this.ultraPlaySourceType="rtmp_v2",this.mi=s,this.publishModule=new en(this.li,this.dataReport,this.vi,this.mi,this.rtm),this.playModule=new rn(this.li,this.dataReport,this.vi,this.mi,this.rtm),this.streamCommon=new ln(s,e,t,r),this.init(),this.initStreamCDN()}return Object.defineProperty(t.prototype,"logger",{get:function(){return this.li},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"stateCenter",{get:function(){return this.vi},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"streamCenter",{get:function(){return this.mi},enumerable:!1,configurable:!0}),t.prototype.init=function(){this.bindRTMListener(),this.bindStreamCenterHandler()},t.prototype.initStreamCDN=function(){},t.prototype.bindRTMListener=function(){var t=this;this.rtm._on("roomLoginResponse",(function(i){t.li.info("zc.rlr call "+JSON.stringify(i));var n=i.header.room_id;t.vi.appid=t.rtm.getAppID(),t.vi.idName=t.rtm.getUserID(),t.vi.testEnvironment=t.rtm.isTestEnvironment(),t.vi.isMultiRoom=t.rtm.getMultiRoom();var e=t.rtm.getToken(n),s=t.rtm.getSessionId(n),r=t.rtm.getRoomSessionID(n),o=t.vi.getRoomByRoomID(n);if(!o){var u=new Gi(t.li,t.vi,t.rtm,t.mi,n);t.bindStreamHandler(u),t.vi.roomList.push(o={roomID:n,streamHandler:u,sessionID:s,roomSessionID:r,token:e,isResetRoom:!1,streamList:[],streamInfoList:[]})}if(o.sessionID=s,o.roomSessionID=r,o.token=o.token,o.streamHandler.handleStreamStart(i,o),t.li.info("zc.rlr unsendmsg "+JSON.stringify(t.vi.unSendMessageList)),t.vi.unSendMessageList.length>0)for(var h=function(i){var e=t.vi.unSendMessageList[i],s=e.streamid,r=e.cmd,u=e.stream_extra_info;if(n===e.roomID){var h=o.streamList.findIndex((function(t){return t.stream_id===s}));t.li.warn("zc.rlr stream index "+h),2002===r&&h>=0&&(t.li.warn("zc.rlr resend "+r+" "+s),o.streamHandler.updateStreamInfo(s,r,u),o.streamList.splice(h,1)),t.vi.unSendMessageList.splice(i,1)}},c=t.vi.unSendMessageList.length-1;c>=0;c--)h(c);t.li.info("zc.rlr end "+n)})),this.rtm._on("_roomLogin",(function(i,n){t.vi.useNetAgent=t.rtm.isUseNetAgent})),this.rtm._on("_appConfigRsp",(function(){t.li.info("zw.acr call "),t.vi.appConfig=t.rtm.getAppConfig()})),this.rtm._on("HBResponse",(function(i){var n,e=null===(n=null==i?void 0:i.header)||void 0===n?void 0:n.room_id,s=t.vi.getRoomByRoomID(e);null==s||s.streamHandler.patchStreamList(i)})),this.rtm._on("_roomStateUpdate",(function(i,n,e,s){if("DISCONNECTED"==n){t.li.info("zw.w.brl _roomStateUpdate "+i+" disconnected "+(e?e+" ":"")+(s||""));var r=t.vi.getRoomByRoomID(i);if(r){var o=t.vi.roomList.findIndex((function(t){return t.roomID==i}));r.isResetRoom=!0,r.streamHandler.reset(),t.mi.reset(i,e,0===e),t.vi.roomList.splice(o,1)}}else t.li.info("zc.rsu "+i+" state: "+n)})),this.rtm.liveRoomHandler.handlePushStreamMsg=function(i){var n,e=(null===(n=null==i?void 0:i.header)||void 0===n?void 0:n.room_id)||"",s=t.vi.getRoomByRoomID(e);i.body.stream_cmd=i.header.sub_cmd,i.body.stream_info=i.body.stream_info_list,delete i.body.stream_info_list,null==s||s.streamHandler.handlePushStreamUpdateMsg(i)}},t.prototype.bindStreamHandler=function(t){var i=this;t.onStreamUpdated=function(t,e,s){var r=s.map((function(n){var s=i.playModule.streamUrlRspList[n.streamID];if(s&&1===e){var r=i.vi.getRoomByRoomID(t),o=r.streamList.findIndex((function(t){return t.stream_id==n.streamID}));-1!==o&&r.streamList[o]&&(r.streamList[o].urltra_url_rtmp=s)}else 1!==e&&delete i.playModule.streamUrlRspList[n.streamID];return{streamID:n.streamID,user:n.user,extraInfo:n.extraInfo}})),o=(0,n.getReportSeq)();if(i.dataReport.newReport(o,Ki),i.dataReport.addMsgInfo(o,{stream_update_type:Fi(1===e?"added":"deleted"),update_stream:Zi(s)}),i.dataReport.uploadReport(o),i.vi.actionListener("roomStreamUpdate",t,function(t){return 0==t?"DELETE":"ADD"}(e),r),1===e){var u=[];r.forEach((function(t){t.extraInfo&&u.push({streamID:t.streamID,user:t.user,extraInfo:t.extraInfo})})),u.length>0&&i.vi.actionListener("streamExtraInfoUpdate",t,u)}},t.onPublishStateUpdate=function(t,n,e){i.li.info("zw.w.opsu "+n);var s=i.vi.reportSeqList.startPublish[n];i.mi.publishingList[n]&&(0==t||1==t)&&s&&(i.dataReport.eventEndWithMsgInfo(s,"PublishState",{type:t}),1==t&&i.dataReport.addMsgInfo(s,e),i.dataReport.uploadReport(s),1012===e.code&&i.mi.stopPublishingStream(n),delete i.vi.reportSeqList.startPublish[n]),i.vi.actionListener("publisherStateUpdate",{state:Ni(t),streamID:n,errorCode:e.code,extendedData:e.message})},t.onStreamExtraInfoUpdated=function(t,e){var s=e.map((function(t){return{streamID:t.streamID,user:t.user,extraInfo:t.extraInfo}})),r=(0,n.getReportSeq)();i.dataReport.newReport(r,Qi),i.dataReport.addMsgInfo(r,{update_stream:tn(s)}),i.dataReport.uploadReport(r),i.vi.actionListener("streamExtraInfoUpdate",t,s)}},t.prototype.bindStreamCenterHandler=function(){var t=this;this.mi.onPlayStateUpdate=function(i,n,e){var s=t.vi.reportSeqList.startPlay[n];t.mi.playingList.find((function(t){return t.streamID===n}))&&(0==i||1==i)&&s&&(t.dataReport.eventEndWithMsgInfo(s,"PlayState",{type:i}),t.dataReport.uploadReport(s,void 0,1==i&&e?e:void 0),delete t.vi.reportSeqList.startPlay[n]),t.vi.actionListener("playerStateUpdate",{state:Ci(i),streamID:n,errorCode:e&&e.code,extendedData:e&&e.message}),1===i&&t.mi.playErrorCallBackList[n]&&(t.mi.playErrorCallBackList[n](e),delete t.mi.playErrorCallBackList[n])},this.mi.onPublishStateUpdate=function(i,n,e){t.onPublishStateUpdateHandle(i,n,e)},this.mi.onPublishQualityUpdate=function(i,n){t.vi.actionListener("publishQualityUpdate",i,n)},this.mi.onPlayQualityUpdate=function(i,n){t.vi.actionListener("playQualityUpdate",i,n)}},t.prototype.onPublishStateUpdateHandle=function(t,i,n){var e=this;this.li.info("zw.w.opsuh call");var s=this.mi.publisherList[i].room;if(s)if(0==t){if(this.vi.publishStreamList[i]){var r=!s.streamList.find((function(t){return t.stream_id==i&&(t.anchor_id_name==e.vi.idName||t.id_name==e.vi.idName||t.user_id===e.vi.idName)})),o=this.vi.publishStreamList[i].state;if(this.li.info("zc.opsuh.0  state: ".concat(o,", in room: ").concat(r)),o==b&&r)this.vi.publishStreamList[i].state=E,s.streamHandler.updateStreamInfo(i,R,this.vi.publishStreamList[i].extra_info,(function(t){})),this.dataReport.uploadReport(this.vi.reportSeqList.startPublish[i]),delete this.vi.reportSeqList.startPublish[i],Ri("kZegoTaskPublishStart"+i,this.vi.reportList);else this.vi.publishStreamList[i].state=S,s.streamHandler.onPublishStateUpdate(t,i,n),this.dataReport.uploadReport(this.vi.reportSeqList.startPublish[i]),delete this.vi.reportSeqList.startPublish[i],Ri("kZegoTaskPublishStart"+i,this.vi.reportList)}}else s.streamHandler.onPublishStateUpdate(t,i,n),1==t&&(this.li.info("zw.w.opsuh stop publish called by sdk"),this.publishModule.stopPublishingStream(i));else this.li.error("zc.opsuh.0 room not exist")},t.prototype.bindListener=function(t,i){return this.li.info("zw.w.bl call"),this.vi.listenerList[t]?_i(i)?(-1==this.vi.listenerList[t].indexOf(i)&&this.vi.listenerList[t].push(i),!0):(this.li.error("zw.w.bl listener callBack must be function"),!1):(this.li.error("zw.w.bl event "+t+" no found"),!1)},t.prototype.deleteListener=function(t,i){if(this.li.info("zw.w.dl call"),!this.vi.listenerList[t])return this.li.error("zw.w.dl listener no found"),!1;var n=this.vi.listenerList[t];return i?n.splice(n.indexOf(i),1):this.vi.listenerList[t]=[],!0},t.prototype.checkSystemRequirements=function(){var t=this;return new ft((function(i,n){var e=t.vi.reporter.createSpan($.H,{key:Hi},{key:""},Bi);on((function(t){e.setAttributes({capability:$i(t)}),e.end(),i(t)}),(function(i){t.vi.reporter.setError(e,Vi.kCheckSystemGetSettingFailError),n(i)}))}))},t.prototype.updatePlayerState=function(t,i){this.li.info("zw.w.ups call "+t),this.mi.updatePlayerState(t,i)},t.prototype.updatePlayerNetStatus=function(t,i){this.li.info("zw.w.upns call "+t),this.mi.updatePlayerNetStatus(t,i)},t.prototype.updateAudioVolumeNotify=function(t,i){this.mi.updateAudioVolumeNotify(t,i)},t.prototype.getNextUrl=function(t){return ci(t)&&""!=t?this.mi.getNextUrl(t):(this.li.error("zw.w.gnu stream ID must be string and not empty"),"")},t.prototype.setCustomSignalUrl=function(t,i){if(void 0===i&&(i=!0),this.li.info("zw.w.scsu call: "+JSON.stringify(t)),!t||0==t.length)return this.li.error("zw.w.scsu param error"),!1;var n=!0;t.forEach((function(t){return 0!=t.indexOf("rtmp://")&&(n=!1)})),n?i?this.vi.customUrl=t:this.vi.customPlayUrl=t:this.li.error("zw.w.scsu url is not correct")},t}(),_n=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},dn=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},mn=function(){function t(t,i,n,e){this.wxContext=t,this.dataAtr=i,this.zegoWechatMini=n,this.defaultAttributes={enableCamera:!0,enableMic:!0},this.attributes={},this.isPublishing=!1,this.li=this.zegoWechatMini.li,this.context=wx.createLivePusherContext(),Object.assign(this.attributes,this.defaultAttributes),Object.assign(this.attributes,e)}return t.prototype.setWXData=function(t){if(this.wxContext&&this.dataAtr)if(void 0===t||_i(t)){var i={};i[this.dataAtr]=this.attributes,this.wxContext.setData(i,t)}else this.li.info("zw.p.0.swd callBack is not function");else this.li.error("zw.p.0.swd context wrong")},t.prototype.iswxContext=function(){return!!this.wxContext},t.prototype.setPusherAttributes=function(t,i){this.li.info("zw.p.0.spa call "+JSON.stringify(t)),Object.assign(this.attributes,t),this.setWXData(i),this.li.info("zw.p.0.spa call success "+JSON.stringify(this.attributes))},t.prototype.startPreview=function(t){this.li.info("zw.p.0.sp.0 call");try{this.context.startPreview(t)}catch(t){this.li.error("zw.p.0.sp.0 error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.sp.0 call success")},t.prototype.stopPreview=function(t){this.li.info("zw.p.0.sp.1 call");try{this.context.stopPreview(t)}catch(t){this.li.error("zw.p.0.sp.1 error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.sp.1 call success")},t.prototype.start=function(t,i){var n=this;return new Promise((function(e,s){return _n(n,void 0,void 0,(function(){var n,r,o=this;return dn(this,(function(u){switch(u.label){case 0:if(!ci(t))return this.li.error("zw.p.0.s.0 streamID type error"),[2];this.attributes.id=t,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this.zegoWechatMini.startPublishingStream(t,i)];case 2:return n=u.sent(),this.attributes.url=n.url,this.isPublishing=!0,this.setWXData(),this.context.start({success:function(){o.li.info("zw.p.0.s.0 publish success"),e()},fail:function(t){o.li.error(JSON.stringify(t)),s(t)}}),[3,4];case 3:return r=u.sent(),this.li.error("zw.p.0.s.0 "+JSON.stringify(r)),s(r),[3,4];case 4:return[2]}}))}))}))},t.prototype.pause=function(t){this.li.info("zw.p.0.p call");try{this.context.pause(t)}catch(t){this.li.error("zw.p.0.p error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.p call success")},t.prototype.resume=function(t){this.li.info("zw.p.0.r call");try{this.context.resume(t)}catch(t){this.li.error("zw.p.0.r error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.r call success")},t.prototype.stop=function(){this.li.info("zw.p.0.s.1 call"),this.attributes.id||this.li.error("zw.p.0.s.1 publish id no found");try{this.context&&this.context.stop(),this.attributes.id&&this.zegoWechatMini.stopPublishingStream(this.attributes.id),this.attributes={},Object.assign(this.attributes,this.defaultAttributes),this.isPublishing=!1,this.setWXData()}catch(t){return void this.li.error("zw.p.0.s.1 "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.s.1 call success")},t.prototype.snapshot=function(t){this.li.info("zw.p.0.ss call");try{this.context.snapshot(t)}catch(t){this.li.error("zw.p.0.ss error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.ss call success")},t.prototype.playBGM=function(t){this.li.info("zw.p.0.pb.0 call");try{this.context.playBGM(t)}catch(t){this.li.error("zw.p.0.pb.0 error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.pb.0 call success")},t.prototype.pauseBGM=function(t){this.li.info("zw.p.0.pb.1 call");try{this.context.pauseBGM(t)}catch(t){this.li.error("zw.p.0.pb.1 error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.pb.1 call success")},t.prototype.resumeBGM=function(t){this.li.info("zw.p.0.rb call");try{this.context.resumeBGM(t)}catch(t){this.li.error("zw.p.0.rb error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.rb call success")},t.prototype.stopBGM=function(t){this.li.info("zw.p.0.sb call");try{this.context.stopBGM(t)}catch(t){this.li.error("zw.p.0.sb error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.sb call success")},t.prototype.setBGMVolume=function(t){this.li.info("zw.p.0.sbv call");try{this.context.setBGMVolume(t)}catch(t){this.li.error("zw.p.0.sbv error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.sbv call success")},t.prototype.setMICVolume=function(t){this.li.info("zw.p.0.smv call");try{this.context.setMICVolume(t)}catch(t){this.li.error("zw.p.0.smv error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.smv call success")},t.prototype.switchCamera=function(t){this.li.info("zw.p.0.sc call");try{this.context.switchCamera(t)}catch(t){this.li.error("zw.p.0.sc error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.sc call success")},t.prototype.toggleTorch=function(t){this.li.info("zw.p.0.tt call");try{this.context.toggleTorch(t)}catch(t){this.li.error("zw.p.0.tt error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.0.tt call success")},t}(),vn=function(t,i,n,e){return new(n||(n=Promise))((function(s,r){function o(t){try{h(e.next(t))}catch(t){r(t)}}function u(t){try{h(e.throw(t))}catch(t){r(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(o,u)}h((e=e.apply(t,i||[])).next())}))},pn=function(t,i){var n,e,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function u(u){return function(h){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,u[0]&&(o=0)),o;)try{if(n=1,e&&(s=2&u[0]?e.return:u[0]?e.throw||((s=e.return)&&s.call(e),0):e.next)&&!(s=s.call(e,u[1])).done)return s;switch(e=0,s&&(u=[2&u[0],s.value]),u[0]){case 0:case 1:s=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,e=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!s||u[1]>s[0]&&u[1]<s[3])){o.label=u[1];break}if(6===u[0]&&o.label<s[1]){o.label=s[1],s=u;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(u);break}s[2]&&o.ops.pop(),o.trys.pop();continue}u=i.call(t,o)}catch(t){u=[6,t],e=0}finally{n=s=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,h])}}},gn=function(){function t(t,i,n,e){this.wxContext=t,this.streamID=i,this.zegoWechatMini=n,this.attributes={},this.isPlaying=!1,this.li=this.zegoWechatMini.li,this.attributes.id=i,this.context=wx.createLivePlayerContext(this.attributes.id,e||this.wxContext)}return t.prototype.setPlayerAttributes=function(t,i){this.li.info("zw.p.1.spa call "+this.streamID+" "+JSON.stringify(t)),Object.assign(this.attributes,t),this.zegoWechatMini.setPlayData(i),this.li.info("zw.p.1.spa call success "+this.streamID+" "+JSON.stringify(this.attributes))},t.prototype.play=function(t){var i=this;return new Promise((function(n,e){return vn(i,void 0,void 0,(function(){var i,s,r=this;return pn(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.zegoWechatMini.startPlayingStream(this.streamID,t)];case 1:return i=o.sent().url,this.attributes.url=i,this.isPlaying=!0,this.zegoWechatMini.setPlayData(),this.li.info("zw.p.1.p.0 start play url"),this.context.play({success:function(){r.li.info("zw.p.1.p.0 start play success"),n(!0)},fail:function(){r.li.error("zw.p.1.p.0 start play fail"),e()},complete:function(){r.li.info("zw.p.1.p.0 start play complete")}}),n(!0),[3,3];case 2:return s=o.sent(),this.li.error("zw.p.1.p.0 start play catch fail "+JSON.stringify(s)),e(s),[3,3];case 3:return[2]}}))}))}))},t.prototype.stop=function(){var t=this;this.li.info("zw.p.1.s call stop "+this.streamID),this.isPlaying||this.li.info("zw.p.1.s stream is not playing"),this.context&&this.context.stop(),this.streamID&&(this.zegoWechatMini.stopPlayingStream(this.streamID),this.zegoWechatMini.wechatMiniModules.mi.livePlayerList=this.zegoWechatMini.wechatMiniModules.mi.livePlayerList.filter((function(i){return i.streamID!==t.streamID}))),this.isPlaying=!1,this.zegoWechatMini.setPlayData(),this.li.info("zw.p.1.s call success")},t.prototype.pause=function(t){this.li.info("zw.p.1.p.1 pull pause call "+this.streamID);try{this.context.pause(t)}catch(t){this.li.error("zw.p.1.p.1 pull pause error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.p.1 pull pause success")},t.prototype.resume=function(t){this.li.info("zw.p.1.r call "+this.streamID);try{this.context.resume(t)}catch(t){this.li.error("zw.p.1.r error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.r call success")},t.prototype.mute=function(t){this.li.info("zw.p.1.m mute call "+this.streamID);try{this.context.mute(t)}catch(t){this.li.error("zw.p.1.m pull mute error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.m mute success")},t.prototype.requestFullScreen=function(t){this.li.info("zw.p.1.rfs call "+this.streamID);try{this.context.requestFullScreen(t)}catch(t){this.li.error("zw.p.1.rfs error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.rfs call success")},t.prototype.exitFullScreen=function(t){this.li.info("zw.p.1.efs call "+this.streamID);try{this.context.exitFullScreen(t)}catch(t){this.li.error("zw.p.1.efs error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.efs call success")},t.prototype.requestPictureInPicture=function(t){this.li.info("zw.p.1.rpip call "+this.streamID);try{this.context.requestPictureInPicture(t)}catch(t){this.li.error("zw.p.1.rpip error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.rpip call success")},t.prototype.exitPictureInPicture=function(t){this.li.info("zw.p.1.epip call "+this.streamID);try{this.context.exitPictureInPicture(t)}catch(t){this.li.error("zw.p.1.epip error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.epip call success")},t.prototype.snapshot=function(t){this.li.info("zw.p.1.ss call "+this.streamID);try{this.context.snapshot(t)}catch(t){this.li.error("zw.p.1.ss error "+(t?JSON.stringify(t):""))}this.li.info("zw.p.1.ss call success")},t}(),bn=function(){this.publisherList={},this.playerList={},this.stopedPlayerList={}},En=function(){function t(t,i){this.li=t,this.vi=i,this.attempt=0,this.baseInterval=.3,this.capInterval=4.8,this.retryRule=0,this.retryTimer=null,this.maxTimer=null,this.isOverTime=!1,this.RETRY_MAX_TIME=60}return t.prototype.setRetryRule=function(t){switch(this.retryRule=t,t){case 1:this.baseInterval=.3,this.capInterval=32;break;case 0:this.baseInterval=.3,this.capInterval=4.8}},t.prototype.getRetryDelayByCount=function(t){var i;i=1===this.retryRule?t+2:t<2?0:t;var n,e,s=Math.min(this.capInterval,this.baseInterval*Math.pow(2,i)),r=(n=0,e=1e3*s,Math.floor(Math.random()*(e-n+1))+n);return this.li.info("".concat("zc.hrh.grdbc"," ").concat(this.attempt," ").concat(s," ").concat(r)),r},t.prototype.initCallback=function(t,i){this.sucCallBack=t,this.failCallBack=i},t.prototype.startMaxTime=function(){var t,i=this;this.li.info("".concat(xi," ").concat(null===(t=this.requestInfo)||void 0===t?void 0:t.streamID," call")),this.maxTimer?this.li.warn("".concat(xi," max timer")):(this.maxTimer=setTimeout((function(){var t;i.li.warn("".concat(xi," ").concat(null===(t=i.requestInfo)||void 0===t?void 0:t.streamID," over max time ").concat(i.RETRY_MAX_TIME,"s, stop retry")),i.isOverTime=!0,i.requestFail(i._err)}),1e3*this.RETRY_MAX_TIME),this.li.info("".concat(xi," maxTimer=").concat(this.maxTimer)))},t.prototype.invalid=function(){this.clearRetryTimer(),this.attempt=0},t.prototype.clearRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},t.prototype.requestFail=function(t){this.invalid(),this.stopMaxTime(),this.failCallBack&&(this.failCallBack(t),this.resetCallback())},t.prototype.stopMaxTime=function(){this.li.info("".concat("zc.hrh.smt.1"," stop max timer")),this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.resetCallback=function(){this.sucCallBack=void 0,this.failCallBack=void 0},t}(),Sn=(un=function(t,i){return un=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},un(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}un(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),Rn=function(t){function i(i,n){var e=t.call(this,i,n)||this;return e.li=i,e.vi=n,e.RETRY_MAX_TIME=300,e}return Sn(i,t),i.prototype.initRequestInfo=function(t,i){this.requestInfo=t,this.room=i},i.prototype.active=function(t){var i=this;if(void 0===t&&(t=!1),this.retryTimer)this.li.warn("".concat(lt," was actived, ignore"));else if(this.isOverTime)this.li.warn("".concat(lt," retry over time, stop retry"));else{var n=function(){i.clearRetryTimer(),i.room.streamHandler.sendRTMPRequest(i.requestInfo,(function(t){if(200===t.status_code){var n=JSON.parse(t.body);n.hosts=n.hosts&&n.hosts.map((function(t){return"rtmp://".concat(t,"/").concat(i.vi.appid,"/").concat(i.requestInfo.streamID)})),i.invalid(),i.stopMaxTime(),i.sucCallBack&&(i.sucCallBack(n),i.resetCallback())}else i.handleRequestFail(t)}),(function(t){i.handleRequestFail(t)})),t||i.attempt++};if(t)n();else{var e=this.getRetryDelayByCount(this.attempt);this.retryTimer=setTimeout(n,e)}}},i.prototype.handleRequestFail=function(t){if(this._err=t,this.isOverTime)this.requestFail(t);else{var i=t.status_code;(429===i||i>=500&&i<600)&&this.setRetryRule(1),this.active()}},i}(En),yn=function(){return yn=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},yn.apply(this,arguments)},On=function(){function t(t,i,n,e,s,r){this.li=t,this.streamId=i,this.mi=n,this.dataReport=e,this.vi=s,this.room=r,this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=d,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=Date.now(),this.seq=-1,this.netStatusUpdateTime=0,this.cacheQualityInfo={},this.isDoubledQuality=!1,this.dispatchRetryHandler=new Rn(this.li,this.vi)}return t.prototype.resetPlayer=function(){this.state=d},t.prototype.newPlayer=function(){this.resetPlayer();var t=this.getCurrentPlayerUrl(),i=t;0!=this.params.length&&(i=t+"?"+this.params);var n=Date.now();return i=i.indexOf("?")>-1?i+"&zgseq="+n+"&zgdid="+this.room.sessionID:i+"?zgseq="+n+"&zgdid="+this.room.sessionID,t!==this.currentUrl?(this.currentUrl=t,this.mi.onStreamUrlUpdate(this.streamId,i,this.playerType)):this.mi.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,"PlayBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PlayBegin","url",i),this.tryUrls.push(i)):(this.dataReport.eventStart(this.playerReportSeq,"PublishBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PublishBegin","url",i),this.tryUrls.push(i)):this.dataReport.addEventInfo(this.playerSeq,0==this.playerType?"PlayRetry":"PublishRetry","url",i),this.state=f,!0},t.prototype.stopPlayer=function(){this.isDoubledQuality=!1,0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,"PlayStat",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,"PublishStat","quality",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,"PublishStat",{quality:this.playerInfo}))},t.prototype.tryStartPlayer=function(t){for(this.li.info("zw.pw.tsp.0 call");this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.li.info("zw.pw.tsp.0 index: "+this.playUrlIndex+", url: "+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.li.info("zw.pw.tsp.0 stream: "+this.streamId),this.resetPlayer();var i="";0==this.playerType?i="PlayEnd":1==this.playerType&&(i="PublishEnd",this.reportQualityStatics()),this.dataReport.addEvent(this.playerSeq,i,{error:t,reason:"no url to retry"}),this.mi.onPlayerStop(this.streamId,this.playerType,t)}},t.prototype.getPlayerUrl=function(){this.li.info("zw.pw.gpu call "+this.streamId);var t=this.urls[++this.retryIndex%this.urls.length],i=t;0!=this.params.length&&(i=t+"?"+this.params);var n=Date.now();return i=i.indexOf("?")>-1?i+"&zgseq="+n+"&zgdid="+this.room.sessionID:i+"?zgseq="+n+"&zgdid="+this.room.sessionID,this.tryUrls.push(i),this.li.info("zw.pw.gpu call streamId: "+this.streamId+" url: "+i),i},t.prototype.shouldRetryPlay=function(t){return 3001==t||3002==t||3003==t||3005==t},t.prototype.isPlayFailed=function(t){return[-2301,2101,2102].includes(t)},t.prototype.isPlaySuccess=function(t){return 2004===t},t.prototype.shouldRetryPublish=function(t){return 3001==t||3002==t||3003==t||3004==t||3005==t},t.prototype.isPublishFailed=function(t){return t<=-1301&&t>=-1311},t.prototype.isPublishSuccess=function(t){return 1002==t},t.prototype.updateEvent=function(t){var i=t.detail.code;if(this.li.info(at+" ".concat(this.streamId," state code: ").concat(JSON.stringify(i))),0==this.playerType){if(this.playBegin||(this.playBegin=!0,pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)&&pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(st,"play_begin")),this.isPlaySuccess(i))this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PlayRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PlayStat"),pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)&&(pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(rt,"play_begin","try_urls",this.tryUrls),pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(ot,"play_begin"),pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(st,"play_state"))),this.li.info("zw.pw.ue play suc: "+this.streamId),this.state=_,this.mi.onPlayerStart(this.streamId,this.playerType);else if(this.shouldRetryPlay(i));else if(this.isPlayFailed(i)){this.li.info("zw.pw.ue play error: "+this.streamId),this.resetPlayer();pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)&&(pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(rt,"play_begin","error_code",i),pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(rt,"play_begin","try_urls",this.tryUrls),pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(ot,"play_begin"),pi("kZegoTaskPlayStart"+this.streamId,this.vi.reportList)(ut,void 0,{})),this.playBegin=!1,this.mi.onPlayerStop(this.streamId,this.playerType,{code:i,msg:"play fail"})}this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PlayBegin")}else 1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)&&pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(st,"push_begin")),this.isPublishSuccess(i)?this.handlePublisherSuccess():this.shouldRetryPublish(i)||this.isPublishFailed(i)&&(this.li.info("zw.pw.ue publish error: "+this.streamId),this.resetPlayer(),pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)&&(pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(rt,"push_begin","error_code",i),pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(rt,"push_begin","try_urls",this.tryUrls),pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(ot,"push_begin"),pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(ut,void 0,{})),this.pushBegin=!1,this.mi.onPlayerStop(this.streamId,this.playerType,{code:i,msg:"publish fail"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PublishBegin"))},t.prototype.updatePlayerNetStatus=function(t){var i,e,s,r=this,o=yn({},t.detail.info),u=null===(i=this.mi.systemInfo)||void 0===i?void 0:i.platform,h=Date.now(),c=h-this.netStatusUpdateTime;if(this.netStatusUpdateTime=h,!this.isDoubledQuality&&"ios"===u&&this.netStatusUpdateTime&&c<200)this.isDoubledQuality=!0;else{if(this.isDoubledQuality){if(c>200)return void(this.cacheQualityInfo=yn({},o));Object.keys(this.cacheQualityInfo).forEach((function(t){void 0===o[t]&&void 0!==r.cacheQualityInfo[t]&&(o[t]=r.cacheQualityInfo[t])}))}var a={videoBitrate:o.videoBitrate,audioBitrate:o.audioBitrate,videoFPS:o.videoFPS,videoHeight:o.videoHeight,videoWidth:o.videoWidth,videoGOP:o.videoGOP,netSpeed:o.netSpeed,netJitter:o.netJitter};if(this.playerInfo=a,1==this.playerType){if(!this.everSuccess)"8.0.16"==wx.getSystemInfoSync().version&&this.handlePublisherSuccess();var l=yn({},o||{}),f=null===(s=null===(e=this.mi.pusherInstance)||void 0===e?void 0:e.attributes)||void 0===s?void 0:s.enableCamera;if("ios"!==u||!1!==f||0===l.videoWidth&&0===l.videoHeight||(l.videoWidth=0,l.videoHeight=0,this.playerInfo.videoWidth=0,this.playerInfo.videoHeight=0),0==this.publishQualitySeq&&(this.publishQualitySeq=(0,n.getReportSeq)(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,"PublishQuality",l),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportQualityStatics()}else if(0==this.playerType){l=yn({},o||{});if(0==this.playQualitySeq&&(this.playQualitySeq=(0,n.getReportSeq)(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,"PlayQuality",l),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount)Date.now()-this.playerLogUploadTime>45e3&&this.reportPlayQualityStatics()}this.mi.onPlayerQuality(this.streamId,a,this.playerType)}},t.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},t.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:"WXPublishStateUpdate"}),this.dataReport.uploadReport(this.publishQualitySeq,"/sdk/publish_stat_report"),this.publishQualityCount=0,this.publishQualitySeq=0,this.playerLogUploadTime=Date.now()},t.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:"WXPlayStateUpdate"}),this.dataReport.uploadReport(this.playQualitySeq,"/sdk/play_stat_report"),this.playQualityCount=0,this.playQualitySeq=0,this.playerLogUploadTime=Date.now()},t.prototype.handlePublisherSuccess=function(){this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PublishRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PublishStat"),pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)&&(pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(rt,"push_begin","try_urls",this.tryUrls),pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(ot,"push_begin"),this.vi.publishStreamList[this.streamId]&&this.vi.publishStreamList[this.streamId].state==b&&pi("kZegoTaskPublishStart"+this.streamId,this.vi.reportList)(st,"publish_state"))),this.li.info("zw.pw.ue play suc: "+this.streamId),this.state=_,this.mi.onPlayerStart(this.streamId,this.playerType)},t}(),Tn=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),wn=0,In=1,Nn=2,Cn=0,kn=1,zn=function(t){function i(i,n,e){var s,r=t.call(this)||this;return r.playerList={},r.publisherList={},r.playerCount=0,r.playingList=[],r.publishingList=[],r.eventSeq=0,r.streamEventMap={},r.streamReportMap={},r.livePlayerList=[],r.playerContextMap={},r.publishSuccessCallBackList={},r.publishErrorCallBackList={},r.playSuccessCallBackList={},r.playErrorCallBackList={},r.li=i,r.dataReport=e,r.vi=n,s=wx.getSystemInfoSync(),r.systemInfo={brand:s.brand,model:s.model,system:s.system,platform:s.platform,version:s.version,SDKVersion:s.SDKVersion},r}return Tn(i,t),i.prototype.updatePlayingState=function(t,i,n,e){if(this.li.info("zw.scw.ups.1.0 "+t),null==t)return Yi.error.kPlayStreamIDNullError;if(n){var s=this.playerList[t],r=this.vi.reportSeqList.startPlay[t];if(this.dataReport.eventStart(r,"updatePlayingState"),s)return this.li.error("zw.scw.ups.1.0 player already exist"),this.dataReport.eventEndWithMsgInfo(r,"updatePlayingState",{message:"player already exist"}),this.dataReport.uploadReport(r,void 0),delete this.vi.reportSeqList.startPlay[t],Yi.error.qi;var o=this.vi.getPlayRoom(t)||this.vi.roomList[0];if(!o)return this.li.error("zw.scw.ups.1.0 room no found"),Yi.error.ji;this.playerList[t]=new On(this.li,t,this,this.dataReport,this.vi,o)}return this.updateStreamState(t,n,i,this.playingList),n?(this.streamEventMap[t]=this.vi.reportSeqList.startPlay[t],this.eventSeq+=1,this.streamReportMap[t]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPlayInfo")):this.reportPlayEvent(t,e),!0},i.prototype.updatePublishingState=function(t,i,n,e,s){if(void 0===n&&(n=""),void 0===e&&(e=!1),this.li.info("zw.scw.ups.0.0 "+i),null==i)return Ji.error.kPublishStreamIDNullError;if(e){var r=this.publisherList[i],o=this.vi.reportSeqList.startPublish[i];if(this.dataReport.eventStart(o,"updatePublishingState"),this.dataReport.addMsgInfo(o,{error:(null==s?void 0:s.code)||0}),r)return this.li.error("zw.scw.ups.0.0 publisher already exist"),this.dataReport.eventEndWithMsgInfo(o,"updatePublishingState",{message:"publisher already exist"}),this.dataReport.uploadReport(o,void 0),delete this.vi.reportSeqList.startPublish[i],Ji.error.Ui;this.publisherList[i]=new On(this.li,i,this,this.dataReport,this.vi,t)}return this.updateStreamState(i,e,n,this.publishingList),e?(this.streamEventMap[i]=this.vi.reportSeqList.startPublish[i],this.eventSeq+=1,this.streamReportMap[i]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPublishInfo")):this.reportPublishEvent(i,s),!0},i.prototype.updateAudioVolumeNotify=function(t,i){var n;this.li.info("zw.w.upvn "+t+" volume: "+(null===(n=null==i?void 0:i.detail)||void 0===n?void 0:n.volume))},i.prototype.updateStreamState=function(t,i,n,e){if(t)if(n&&ci(n)||(n=""),1==i)e.push({streamID:t,params:n});else for(var s=0;s<e.length;s++)if(e[s].streamID==t){e.splice(s--,1);break}},i.prototype.isPlaying=function(){return 0!=this.playingList.length},i.prototype.isPublishing=function(){return 0!=this.publishingList.length},i.prototype.startPlayingStream=function(t,i,n){if(this.li.info("zw.scw.sps.1 call "+t),this.streamEventMap[t]){0==n?"cdn":1==n&&"ultra_src",Ei("kZegoTaskPlayStart"+t,this.vi.reportList,rt,"get_play_url"),Ei("kZegoTaskPlayStart"+t,this.vi.reportList,rt,"get_play_url")}var e=this.streamReportMap[t];return e&&this.dataReport.eventEndWithMsg(e,"GotPlayInfo",{type:0==n?"cdn":"ultra_src",urls:i}),this.li.info("".concat(ct," call ").concat(t,", urls:").concat(JSON.stringify(i),", type:").concat(n)),this.startPlayer(t,i,n,Cn)},i.prototype.startPlayer=function(t,i,n,e){var s=this.playerList[t];if(e==kn&&(s=this.publisherList[t]),!s)return this.li.error("zw.scw.sp.0 player don't exist"),!1;var r=[];e==Cn?r=this.playingList:e==kn&&(r=this.publishingList);for(var o=!1,u="",h=0;h<r.length;h++)if(r[h].streamID==t){o=!0,u=r[h].params;break}if(!o)return this.li.warn("zw.scw.sp.0 should not start"),!1;if(s.urls=i,s.params=u,s.reconnectLimit=this.getReconnectLimit(n),s.dispatchType=n,s.playerType=e,s.playerSeq=this.streamEventMap[t],s.playerReportSeq=this.streamReportMap[t],!s)return this.li.info("zw.scw.sp.0 new player failed"),!1;++this.playerCount;var c=s.tryStartPlayer(0);return this.li.info("zw.scw.sp.0 call result: "+c),!0},i.prototype.getNextUrl=function(t){this.li.info("zw.scw.gnu call "+t);var i,e=this.publisherList[t]||this.playerList[t];if(!e)return this.li.error("zw.scw.gnu player don't exist"),"";this.publishingList.find((function(i){return i.streamID===t}))?(i=!0,this.onPublishStateUpdate(it,t,{code:0,message:""})):(i=!1,this.onPlayStateUpdate(Nn,t,{code:0,message:""}));var s=e.getPlayerUrl();if(i){if(!this.vi.reportSeqList.startPublish[t]){var r=(0,n.getReportSeq)();this.vi.reportSeqList.startPublish[t]=r,this.dataReport.newReport(r,"/sdk/republish"),e.pushBegin=!1,bi("kZegoTaskPublishStart"+t,this.dataReport,r,this.vi.reportList)}}else if(!this.vi.reportSeqList.startPlay[t]){r=(0,n.getReportSeq)();this.vi.reportSeqList.startPlay[t]=r,this.dataReport.newReport(r,"/sdk/replay"),e.playBegin=!1,bi("kZegoTaskPlayStart"+t,this.dataReport,r,this.vi.reportList)}return s},i.prototype.stopPlayingStream=function(t,i,n){var e;if(this.li.info("zw.scw.sps.1.0 call "+t),null!=t){var s=null===(e=this.playerList[t])||void 0===e?void 0:e.dispatchRetryHandler;s&&(s.invalid(),s.stopMaxTime());var r=this.playerList[t];if(n&&(null==r?void 0:r.state)==f){var o=this.vi.reportSeqList.startPlay[t];this.dataReport.addMsgInfo(o,{error:qt.code,message:qt.message}),this.dataReport.uploadReport(o)}this.stopPlayer(t),delete this.streamEventMap[t],this.updatePlayingState(t,void 0,void 0,i),delete this.streamReportMap[t],delete this.playSuccessCallBackList[t],delete this.playErrorCallBackList[t]}},i.prototype.stopPlayer=function(t){this.li.info("zw.scw.sp.1 call "+t);var i=this.playerList[t],n=this.publisherList[t];i||n?(i&&(i.stopPlayer(),i.reportPlayQualityStatics(),delete this.playerList[t]),n&&(n.stopPlayer(),n.reportQualityStatics(),delete this.publisherList[t]),--this.playerCount):this.li.info("zw.scw.sp.1 play not exist "+t),this.li.info("zw.scw.sp.1 call success")},i.prototype.startPublishingStream=function(t,i,n){if(this.li.info("zw.scw.sps.0 call "+t),this.streamEventMap[t]){0==n?"cdn":1==n&&"ultra_src",Ei("kZegoTaskPublishStart"+t,this.vi.reportList,rt,"type"),Ei("kZegoTaskPublishStart"+t,this.vi.reportList,rt,"urls")}var e=this.streamReportMap[t];return e&&this.dataReport.eventEndWithMsg(e,"GotPublishInfo",{type:0==n?"cdn":"ultra_src",urls:i}),this.li.info("".concat(ht," call ").concat(t,", urls:").concat(JSON.stringify(i),", type:").concat(n)),this.startPlayer(t,i,n,kn)},i.prototype.stopPublishingStream=function(t,i,n){if(void 0===i&&(i={code:0,message:""}),this.li.info("zw.scw.sps.0.0 call "+t),null!=t){var e=this.publisherList[t].room,s=this.publisherList[t],r=null==s?void 0:s.dispatchRetryHandler;if(r&&(r.invalid(),r.stopMaxTime()),n&&(null==s?void 0:s.state)==f){var o=this.vi.reportSeqList.startPublish[t];this.dataReport.addMsgInfo(o,{error:Mt.code,message:Mt.message}),this.dataReport.uploadReport(o)}if(s&&s.state!==d&&e.streamHandler.onPublishStateUpdate(tt,t,i),this.stopPlayer(t),delete this.streamEventMap[t],this.updatePublishingState(e,t,"",!1,i),delete this.streamReportMap[t],this.vi.publishStreamList[t]){if(this.vi.publishStreamList[t].state>=E){e.streamHandler.updateStreamInfo(t,y);for(var u=0;u<e.streamList.length;u++)if(e.streamList[u].stream_id==t){e.streamList.splice(u--,1);break}}delete this.vi.publishStreamList[t]}this.vi.streamUrlMap[t]&&delete this.vi.streamUrlMap[t]}},i.prototype.updatePlayerState=function(t,i){var n=this.playerList[t],e=this.publisherList[t];n||e?(n&&n.updateEvent(i),e&&e.updateEvent(i)):this.li.error("zw.scw.ups.0 no player "+t),this.li.info("zw.scw.ups.0 updatePlayerEvent success")},i.prototype.updatePlayerNetStatus=function(t,i){var n=this.playerList[t],e=this.publisherList[t];n||e?(n&&n.updatePlayerNetStatus(i),e&&e.updatePlayerNetStatus(i)):this.li.error("zw.scw.upns no player "+t),this.li.info("zw.scw.upns updatePlayerNetStatus success"+t)},i.prototype.reset=function(t,i,n){var e,s;for(var r in this.li.info("zw.scw.r.0 call"),this.publisherList){this.publisherList[r].room.roomID!=t&&t||(this.stopPublishingStream(r,{code:i||0,message:""},n),this.pusherInstance&&this.pusherInstance.stop())}this.pusherInstance=void 0;var o=function(r){var o=u.playerList[r].room;if(o.roomID!=t||!o.streamList.find((function(t){return t.stream_id==r}))&&1!=u.vi.roomList.length){if(o.roomID==t&&u.vi.roomList.length>1){var h=u.vi.roomList.find((function(i){return i.roomID!==t}));h?u.playerList[r].room=h:(u.stopPlayingStream(r,{code:i||0,message:""},n),null===(s=u.livePlayerList.find((function(t){return t.attributes.id==r})))||void 0===s||s.stop())}}else u.stopPlayingStream(r,{code:i||0,message:""},n),null===(e=u.livePlayerList.find((function(t){return t.attributes.id==r})))||void 0===e||e.stop()},u=this;for(var h in this.playerList)o(h);this.livePlayerList=[],this.playerContextMap={},this.li.info("zw.scw.r.0 call success")},i.prototype.reportPublishEvent=function(t,i){if(this.streamReportMap[t]){var n=this.streamReportMap[t];this.dataReport.addMsgExt(n,{stream:t}),i&&i.code&&this.dataReport.addMsgInfo(n,{error:i.code}),this.dataReport.addMsgInfo(n,{itemtype:"WXPublishStream"}),this.dataReport.uploadReport(n,"WXPublishStream"),delete this.streamReportMap[t]}},i.prototype.reportPlayEvent=function(t,i){if(this.streamReportMap[t]){var n=this.streamReportMap[t];this.dataReport.addMsgExt(n,{stream:t}),i&&i.code&&this.dataReport.addMsgInfo(n,{error:i.code}),this.dataReport.addMsgInfo(n,{itemtype:"WXPlayStream"}),this.dataReport.uploadReport(n,"WXPlayStream"),delete this.streamReportMap[t]}},i.prototype.onPlayStateUpdate=function(t,i,n){},i.prototype.onPlayQualityUpdate=function(t,i){},i.prototype.onPublishStateUpdate=function(t,i,n){},i.prototype.onPublishQualityUpdate=function(t,i){},i.prototype.onPublisherStreamUrlUpdate=function(t,i){},i.prototype.onPublisherStreamUrlFail=function(t,i){},i.prototype.onPlayerStreamUrlUpdate=function(t,i){},i.prototype.getReconnectLimit=function(t){return 1},i.prototype.onPlayerStart=function(t,i){this.li.info("zw.scw.ops.0 call "+t),i==Cn?this.onPlayStateUpdate(wn,t,{code:0,message:""}):i==kn&&this.onPublishStateUpdate(wn,t,{code:0,message:""})},i.prototype.onPlayerStop=function(t,i,n){this.li.info("zw.scw.ops.1 call "+t),i==Cn?(this.reportPlayEvent(t,n),this.li.warn("zw.scw.ops.1 play error"),this.onPlayStateUpdate(In,t,n)):i==kn&&(this.reportPublishEvent(t,n),this.li.warn("zw.scw.ops.1 publish error"),this.onPublishStateUpdate(In,t,n))},i.prototype.onPlayerRetry=function(t,i){this.li.info("zw.scw.opr call "+t),i==Cn?this.onPlayStateUpdate(Nn,t,{code:0,message:""}):i==kn&&this.onPublishStateUpdate(Nn,t,{code:0,message:""})},i.prototype.onPlayerQuality=function(t,i,n){var e={video:{videoBitrate:i.videoBitrate,videoFPS:i.videoFPS,videoWidth:i.videoWidth,videoHeight:i.videoHeight},audio:{audioBitrate:i.audioBitrate}};n==Cn?this.onPlayQualityUpdate(t,e):n==kn&&this.onPublishQualityUpdate(t,e)},i.prototype.onStreamUrlUpdate=function(t,i,n){this.li.info("zw.scw.opuu.0 call "+t),0==n?this.playSuccessCallBackList[t](t,i):this.publishSuccessCallBackList[t](t,i)},i.prototype.getTotalStreamId=function(t){return t},i.prototype.getRealStreamId=function(t){return t},i.prototype.getRoomByStreamID=function(t){return this.publisherList[t]?this.publisherList[t].room:this.playerList[t]?this.playerList[t].room:void 0},i.prototype.startDispatch=function(){},i.prototype.getCDNUrl=function(t,i){this.li.info("zw.scw.gcu call");var n=[],e=this.vi.appConfig.media_config.play_config.resource_info;if(1==i&&(e=this.vi.appConfig.media_config.publish_config.resource_info),e.length){var s=e.find((function(t){return 0==t.resource_type}));if(s)for(var r=0;r<s.service_info.length;r++){var o=s.service_info[r],u=o.protocol,c=o.url_template.replace("{STREAM_NAME}",t);if(u===h.RTMP)n.push(c)}}return this.li.info("zw.scw.gcu rtmps:"+JSON.stringify(n)),{rtmps:n}},i}(bn),Dn=function(){function t(t,i,n,e,s){void 0===s&&(s=1),this.reporter=n,this.li=t,this.dataReport=i,this.RTM=e,this.stateCenter=new Li(this.li,this.dataReport),this.stateCenter.clientType="wxMini",this.streamCenter=new zn(this.li,this.stateCenter,this.dataReport),this.wechatMiniModules=new fn(this.li,this.dataReport,n,this.stateCenter,this.streamCenter,this.RTM),this.initTracer(n)}return t.prototype.checkSystemRequirements=function(){return this.wechatMiniModules.checkSystemRequirements()},t.prototype.getVersion=function(){return"3.0.2"},t.prototype.on=function(t,i){return this.wechatMiniModules.bindListener(t,i)},t.prototype.off=function(t,i){return this.wechatMiniModules.deleteListener(t,i)},t.prototype.startPublishingStream=function(t,i){return this.wechatMiniModules.publishModule.startPublishingStream(t,i)},t.prototype.stopPublishingStream=function(t){return this.wechatMiniModules.publishModule.stopPublishingStream(t,!0)},t.prototype.getNextUrl=function(t){return this.wechatMiniModules.getNextUrl(t)},t.prototype.setCustomSignalUrl=function(t,i){if(void 0===i&&(i=!0),this.li.info("zw.w.scsu call: "+JSON.stringify(t)),!t||0==t.length)return this.li.error("zw.w.scsu param error"),!1;var n=!0;return t.forEach((function(t){return 0!=t.indexOf("rtmp://")&&(n=!1)})),n?(i?this.stateCenter.customUrl=t:this.stateCenter.customPlayUrl=t,!0):(this.li.error("zw.w.scsu url is not correct"),!1)},t.prototype.addPublishCdnUrl=function(t,i){return this.li.info("zw.apcu call "+t+" "+i),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"addpush",streamID:t,pushUrl:i}):new ft((function(t,i){console.error("should install advanced module"),t({errorCode:-1,extendedData:"should install advanced module"})}))},t.prototype.removePublishCdnUrl=function(t,i){return this.li.info("zw.rpcu call "+t+" "+i),this.wechatMiniModules.streamCDNModule?this.wechatMiniModules.streamCDNModule.publishTarget({type:"delpush",streamID:t,pushUrl:i}):new ft((function(t,i){console.error("should install advanced module"),t({errorCode:-1,extendedData:"should install advanced module"})}))},t.prototype.startMixerTask=function(t){return new ft((function(t,i){console.error(""),i()}))},t.prototype.setMixerTaskConfig=function(t){return new ft((function(t,i){console.error(""),i()}))},t.prototype.stopMixerTask=function(t){return new ft((function(t,i){console.error(""),i()}))},t.prototype.setStreamExtraInfo=function(t,i){return this.wechatMiniModules.streamCommon.setStreamExtraInfo(t,i)},t.prototype.startPlayingStream=function(t,i){return this.wechatMiniModules.playModule.startPlayingStream(t,i)},t.prototype.stopPlayingStream=function(t){this.wechatMiniModules.playModule.stopPlayingStream(t,!0)},t.prototype.updatePlayerState=function(t,i){this.wechatMiniModules.updatePlayerState(t,i)},t.prototype.updatePlayerNetStatus=function(t,i){this.wechatMiniModules.updatePlayerNetStatus(t,i)},t.use=function(i){switch(i.type){case"MixStream":i.install(t,Gi,fn);break;case"StreamCDN":i.install(t,fn,Gi)}},t.prototype.updateAudioVolumeNotify=function(t,i){this.wechatMiniModules.updateAudioVolumeNotify(t,i)},t.prototype.initContext=function(t){t.wxContext&&(this.wxContext=t.wxContext),t.pushAtr&&(this.pushAtr=t.pushAtr),t.playAtr&&(this.playAtr=t.playAtr)},t.prototype.createPusher=function(t){return this.li.info("zw.cp call"),this.wxContext&&this.wxContext.setData&&this.pushAtr?(this.wechatMiniModules.mi.pusherInstance||(this.wechatMiniModules.mi.pusherInstance=new mn(this.wxContext,this.pushAtr,this,t)),this.li.info("zw.cp call success"),this.wechatMiniModules.mi.pusherInstance):(this.li.error("zw.cp init context wrong"),null)},t.prototype.setPusherAttributes=function(t,i){var n;this.li.info("zw.spa.0 call"),this.wechatMiniModules.mi.pusherInstance?(null===(n=this.wechatMiniModules.mi.pusherInstance)||void 0===n||n.setPusherAttributes(t,i),this.li.info("zw.spa.0 call success")):this.li.error("zw.spa.0 publisher no found")},t.prototype.setPlayerAttributes=function(t,i,n){if(this.li.info("zw.spa.1 call"),ci(t)&&ci(this.playAtr)){var e=this.wechatMiniModules.mi.livePlayerList.find((function(i){return i.attributes.id==t}));e?(e.setPlayerAttributes(i,n),this.li.info("zw.spa.1 call success")):this.li.error("zw.spa.1 player no found")}else this.li.error("zw.spa.1 stream no found")},t.prototype.getPusherInstance=function(){return this.wechatMiniModules.mi.pusherInstance?this.wechatMiniModules.mi.pusherInstance:null},t.prototype.getPlayerInstance=function(t,i){if(this.li.info("zw.gpi call"),!ci(t)||!ci(this.playAtr))return this.li.error("zw.gpi param error"),null;var n=this.wechatMiniModules.mi.livePlayerList.find((function(i){return i.attributes.id==t}));return i&&(this.wechatMiniModules.mi.playerContextMap[t]=i),n||(n=new gn(this.wxContext,t,this,this.wechatMiniModules.mi.playerContextMap[t]),this.wechatMiniModules.mi.livePlayerList.push(n)),this.setPlayData(),this.li.info("zw.gpi call success"),n},t.prototype.getPlayerList=function(t){if(this.li.info("zw.gpl call"),!li(t)&&!ci(t)||!ci(this.playAtr))return this.li.error("zw.gpl param error"),[];if(t){var i=this.wechatMiniModules.mi.livePlayerList.find((function(i){return i.attributes.id==t}));return i?[i.attributes]:[]}return this.li.info("zw.gpl call success"),this.wechatMiniModules.mi.livePlayerList.map((function(t){return t.attributes}))},t.prototype.mutePublishStreamVideo=function(t){this.setPusherAttributes({enableCamera:!t})},t.prototype.mutePublishStreamAudio=function(t){this.setPusherAttributes({enableMic:!t})},t.prototype.mutePlayStreamVideo=function(t,i){this.setPlayerAttributes(t,{muteVideo:i})},t.prototype.mutePlayStreamAudio=function(t,i){this.setPlayerAttributes(t,{muteAudio:i})},t.prototype.setPlayData=function(t){if(this.li.info("zw.spd call"),this.wxContext&&this.playAtr){void 0===t||_i(t)||this.li.error("zw.spd callBack is not function");var i={};i[this.playAtr]=this.wechatMiniModules.mi.livePlayerList.map((function(t){return t.attributes})),this.wxContext.setData(i,t),this.li.info("zw.spd call success")}else this.li.error("zw.spd init context wrong")},t.prototype.initTracer=function(t){this.stateCenter.reporter=t},t}(),An=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),Pn=function(t){function i(i,e){var s=this;return n.ZegoExpressWebRTMEngine.version="3.0.2",(s=t.call(this,i,e,1)||this).zegoWechatMini=new Dn(s.logger,s.dataReport,s.reporter,s.zegoWebRTM),s}return An(i,t),i.prototype.getNextUrl=function(t){return this.zegoWechatMini.getNextUrl(t)},i.prototype.startPlayingStream=function(t,i){return this.zegoWechatMini.startPlayingStream(t,i)},i.prototype.stopPlayingStream=function(t){return this.zegoWechatMini.stopPlayingStream(t)},i.prototype.updatePlayerNetStatus=function(t,i){return this.zegoWechatMini.updatePlayerNetStatus(t,i)},i.prototype.updatePlayerState=function(t,i){return this.zegoWechatMini.updatePlayerState(t,i)},i.prototype.updateAudioVolumeNotify=function(t,i){return this.zegoWechatMini.updateAudioVolumeNotify(t,i)},i.prototype.checkSystemRequirements=function(){return this.zegoWechatMini.checkSystemRequirements()},i.prototype.setMixerTaskConfig=function(t){return this.zegoWechatMini.setMixerTaskConfig(t)},i.prototype.startMixerTask=function(t){return this.zegoWechatMini.startMixerTask(t)},i.prototype.off=function(t,i){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.off(t,i):!!this.zegoWechatMini.stateCenter.listenerList[t]&&this.zegoWechatMini.off(t,i)},i.prototype.stopMixerTask=function(t){return this.zegoWechatMini.stopMixerTask(t)},i.prototype.on=function(t,i){return this.zegoWebRTM.stateCenter.listenerList[t]?this.zegoWebRTM.on(t,i):!!this.zegoWechatMini.stateCenter.listenerList[t]&&this.zegoWechatMini.on(t,i)},i.prototype.startPublishingStream=function(t,i){return this.zegoWechatMini.startPublishingStream(t,i)},i.prototype.stopPublishingStream=function(t){return this.zegoWechatMini.stopPublishingStream(t)},i.prototype.addPublishCdnUrl=function(t,i){return 3===arguments.length?this.zegoWechatMini.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.addPublishCdnUrl(t,i)},i.prototype.removePublishCdnUrl=function(t,i){return 3===arguments.length?this.zegoWechatMini.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.removePublishCdnUrl(t,i)},i.prototype.setStreamExtraInfo=function(t,i){return this.zegoWechatMini.setStreamExtraInfo(t,i)},i.use=function(t){n.ZegoExpressWebRTMEngine.use(t),Dn.use(t)},i.prototype.initContext=function(t){this.zegoWechatMini.initContext(t)},i.prototype.createPusher=function(t){return this.zegoWechatMini.createPusher(t)},i.prototype.getPusherInstance=function(){return this.zegoWechatMini.getPusherInstance()},i.prototype.getPlayerInstance=function(t,i){return this.zegoWechatMini.getPlayerInstance(t,i)},i.prototype.mutePublishStreamVideo=function(t){this.zegoWechatMini.mutePublishStreamVideo(t)},i.prototype.mutePublishStreamAudio=function(t){this.zegoWechatMini.mutePublishStreamAudio(t)},i.prototype.mutePlayStreamVideo=function(t,i){this.zegoWechatMini.mutePlayStreamVideo(t,i)},i.prototype.mutePlayStreamAudio=function(t,i){this.zegoWechatMini.mutePlayStreamAudio(t,i)},i.prototype.setPusherAttributes=function(t){this.zegoWechatMini.setPusherAttributes(t)},i.prototype.setPlayerAttributes=function(t,i){this.zegoWechatMini.setPlayerAttributes(t,i)},i.prototype.getPlayerList=function(t){return this.zegoWechatMini.getPlayerList(t)},i}(n.ZegoExpressWebRTMEngine),Mn=__webpack_require__(533),Un=__webpack_require__.n(Mn),xn=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),Ln=function(t){function i(i,n,e){var s=t.call(this,i,n)||this;return s.li=i,s.vi=n,s.Xi=e,s.RETRY_MAX_TIME=8,s}return xn(i,t),i.prototype.initReqParams=function(t,i){this.streamId=t,this.cdnPushConfig=i},i.prototype.active=function(t){var i=this;if(void 0===t&&(t=!1),this.retryTimer)this.li.warn("".concat(Ui," was actived, ignore"));else if(this.isOverTime)this.li.warn("".concat(Ui," retry over time, stop retry"));else{var n=function(){i.clearRetryTimer(),i.Xi.sendCDNRequest(i.streamId,i.cdnPushConfig,(function(t,n){var e=t.body;i.invalid(),i.stopMaxTime(),i.sucCallBack&&(i.sucCallBack&&i.sucCallBack(e,n),i.resetCallback())}),(function(t){i._err=t;var n=t.status_code;i.isOverTime?i.requestFail(t):((429===n||n>=500&&n<600)&&i.setRetryRule(1),i.active())})),t||i.attempt++};if(t)n();else{var e=this.getRetryDelayByCount(this.attempt);this.retryTimer=setTimeout(n,e)}}},i}(En);hn=__webpack_require__(951).proto_media,cn=__webpack_require__(100),an=__webpack_require__(720),cn.util.Long=an,cn.configure();var jn,qn=function(){function t(){}return t.prototype.encodeRelayPublishCdnReq=function(t){var i=hn.RelayPublishCdnRequest.create(t);return hn.RelayPublishCdnRequest.encode(i).finish()},t.prototype.decodeRelayPublishCdnRsp=function(t){var i=hn.RelayPublishCdnResponse.decode(t);return i.request_seq_v2&&an.isLong(i.request_seq_v2)&&(i.request_seq_v2=i.request_seq_v2.toNumber()),i},t}();!function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(jn||(jn={}));var Gn={},Hn={_sendCDNPublishByAccessHub:function(t,i,n,e){var s=this;this.mediaProtoBuf||(this.mediaProtoBuf=new qn);var r=new Ln(this.logger,this.stateCenter,this);r.initReqParams(t,i);var o=function(t,i){try{var n=s.mediaProtoBuf.decodeRelayPublishCdnRsp(t);s.logger.info("zb.sh.pt rsp decode ".concat(JSON.stringify(n)));var e=(null==n?void 0:n.response)||{};return{code:e.code,msg:e.message}}catch(t){return{code:-1}}};r.initCallback((function(t,r){var u=o(t),h=u.code,c=u.msg;h&&0!=h?(s.logger.error("zb.sh.pt "+i.type+" error code: "+h+" "+c),e(5004===h?Ht:wt," cmd: ".concat(i.type," ").concat(h," ").concat(c))):(s.logger.info("zb.sh.pt "+i.type+" success"),n&&n({errorCode:0,extendedData:""}))}),(function(t){var n=t.status_code,r=t.body,u=t.code,h=t.msg,c=JSON.parse(JSON.stringify(ei.error.ui)),a="";if(u)c={code:u,msg:h},a=h;else if(200===n)s.logger.info("zb.sh.pt error: "),c=ei.error.ui,a="cmd: ".concat(i.type);else{var l="";if(ci(r))l=r;else{var f=o(r);l=f.code+" "+f.msg}a="request media server fail, error: "+n+" "+l}s.logger.error("zb.sh.pt "+a),e&&e(c,a)})),r.startMaxTime(),r.active(!0)},sendCDNRequest:function(t,i,n,e){var s=this,r="addpush"===i.type?1:2;0===this.stateCenter.cdnSeq&&(this.stateCenter.cdnSeq=(new Date).getTime());var o={request_cmd:r,streamid:t,cdn_server:i.pushUrl,request_seq_v2:this.stateCenter.cdnSeq++};this.logger.info("zb.sh.scpba "+JSON.stringify(o));var u=this.mediaProtoBuf.encodeRelayPublishCdnReq(o);this.sendHttpPBRequest({interfaceID:6,resID:this.stateCenter.appid+"/"+t},u,(function(t,i){s.logger.info("zb.sh.pt receive message "+(null==t?void 0:t.status_code)),n&&n(t,i)}),(function(t){e&&e(t)}),{timeout:4e3})},_publishTarget:function(t,i,n){this.logger.info("zb.sh.pt call");var e=t.streamID;this.stateCenter.testEnvironment&&(e="zegotest-"+this.stateCenter.appid+"-"+t.streamID),this.stateCenter.useNetAgent&&this._sendCDNPublishByAccessHub(e,t,i,n)}},Bn=function(){function t(t,i,n,e){this.li=t,this.dataReport=i,this.mi=n,this.vi=e,this.screenShotReady=!1}return Object.defineProperty(t.prototype,"Ti",{get:function(){return this.vi.reporter},enumerable:!1,configurable:!0}),t.prototype.publishTarget=function(t){var i=this,n="";switch(t.type){case"addpush":n=si;break;case"delpush":case"clearpush":n=ri}var e=this.Ti.createSpan(jn.H,{key:Kt,par:t.streamID},{key:""},n);return e.setAttributes({url:oi(t.pushUrl)}),new ft((function(n,s){var r=function(t,n){i.li.error("zb.pt "+(n||t.message)),i.Ti.setError(e,t,n),s({errorCode:t.code,extendedData:t.message+(n?" "+n:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(t.type))return i.li.error("zb.sh.pt cdn push type error"),void r(Gt,"type error");if(t.streamID&&ci(t.streamID))if(t.pushUrl&&ci(t.pushUrl))if(i.vi.publishStreamList[t.streamID]){var o=i.mi.getRoomByStreamID(t.streamID);if(o){o.streamHandler._publishTarget(t,(function(t){e.end(),n(t)}),r)}else r(ei.error.ei)}else r(ei.error.ni);else r(ei.error.ii,"push url error");else r(ei.error.ii,"stream id type error")}))},t}();const Vn={type:"StreamCDN",install:function(t,i,n){for(var e in Object.defineProperty(i.prototype,"initStreamCDN",{value:function(){this.streamCDNModule=new Bn(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),Gn)Object.defineProperty(t.prototype,e,{value:Gn[e],writable:!1});for(var e in Hn)Object.defineProperty(n.prototype,e,{value:Hn[e],writable:!1})}};var $n,Jn,Yn,Xn={NOT_LOGIN:bt,INPUT_PARAM:Ot,TIMEOUT:Tt,MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"mix stream input parameters are wrong"},MIXER_INPUT_LABEL_TOO_LONG:{code:1005028,message:"Input stream label text is too long"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_INPUT_IMAGE_URL_TOO_LONG:{code:1005034,message:"Input stream image url too long"},MIXER_INPUT_IMAGE_FORMAT_WRONG:{code:1005035,message:"Input stream image format wrong"},MIXER_INPUT_IMAGE_GET_FAIL:{code:1005036,message:"Input stream image get fail"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}};$n=__webpack_require__(413).Z.proto_mixstream,Jn=__webpack_require__(100),Yn=__webpack_require__(720),Jn.util.Long=Yn,Jn.configure();var Wn,Kn,Fn=function(){function t(){}return t.prototype.encodeMixStreamStartReq=function(t){var i=$n.MixStreamStartRequest.create(t);return $n.MixStreamStartRequest.encode(i).finish()},t.prototype.decodeMixStreamStartRsp=function(t){return $n.MixStreamStartResponse.decode(t)},t.prototype.encodeMixStreamStopReq=function(t){var i=$n.MixStreamStopRequest.create(t);return $n.MixStreamStopRequest.encode(i).finish()},t.prototype.decodeMixStreamStopRsp=function(t){return $n.MixStreamStopResponse.decode(t)},t}(),Zn={event:"/mix/start_mix",error:{ii:Xn.INPUT_PARAM,Wi:Xn.MIXER_TASK_ID_NULL,Ki:Xn.MIXER_TASK_ID_TOO_LONG,Fi:Xn.MIXER_TASK_ID_INVALID_CHARACTER,Zi:Xn.MIXER_INPUTLIST_NULL,Qi:Xn.MIXER_OUTPUTLIST_NULL,tn:Xn.MIXER_OUTPUT_TARGET_INVALID,nn:Xn.MIXER_NO_OUTPUT_TARGET,en:Xn.MIXER_START_REQUEST_ERROR,sn:Xn.MIXER_INNER_ERROR,rn:Xn.MIXER_INPUT_LABEL_TOO_LONG,un:Xn.MIXER_INPUT_IMAGE_URL_TOO_LONG,hn:Xn.MIXER_INPUT_IMAGE_FORMAT_WRONG,cn:Xn.MIXER_WATERMARK_URL_INVALID,ei:Xn.NOT_LOGIN},mix_stream_conf:Bt,stop_reason:Vt},Qn={event:"/mix/stop_mix",error:{ii:Xn.INPUT_PARAM,Wi:Xn.MIXER_TASK_ID_NULL,en:Xn.MIXER_STOP_REQUEST_ERROR,sn:Xn.MIXER_INNER_ERROR,ei:Xn.NOT_LOGIN}},te={event:"/mix/config_mix",error:{ii:Xn.INPUT_PARAM,an:Xn.MIXER_VIDEO_CONFIG_INVALID,ln:Xn.MIXER_BACKGROUND_IMAGE_URL_INVALID,ei:Xn.NOT_LOGIN},mix_params:Bt},ie=function(){return ie=Object.assign||function(t){for(var i,n=1,e=arguments.length;n<e;n++)for(var s in i=arguments[n])Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);return t},ie.apply(this,arguments)};function ne(t,i){var n,e,s,r,o="",u=Xn;return i.errorCode<2e9&&i.errorCode>1e9?(s={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",141:"MIXER_INPUT_IMAGE_FORMAT_WRONG",142:"MIXER_INPUT_IMAGE_GET_FAIL",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",179:"MIXER_INPUT_LABEL_TOO_LONG",190:"MIXER_START_REQUEST_ERROR"},r="MIXER_INNER_ERROR",(e=i.errorCode-1e4)>1e9&&s[e-1e9]&&(r=s[e-1e9]),n=u[o=r]):i.errorCode<1e6&&(n=t.decodeServerError(i.errorCode,i.extendedData),o=t.getLiveRoomError(i.errorCode,t.useNetAgent)),{reportErr:n,actualError:u[o]}}Wn=__webpack_require__(720),function(t){t[t.I=0]="I",t[t.H=10]="H",t[t.M=100]="M",t[t.L=1e3]="L"}(Kn||(Kn={}));var ee={},se={startMixerTask:function(t){var i=this;return new ft((function(n,e){var s,r,o,u,h,c,a,l,f,_,d,m=i.reporter.createSpan(Kn.H,{key:Wt},{key:Zn.event,par:t.taskID},Zn.event,!0),v={errorCode:Xn.MIXER_INPUT_PARAMETERS_ERROR.code,extendedData:Xn.MIXER_INPUT_PARAMETERS_ERROR.message};if(!!(null==t?void 0:t.inputList.find((function(t){return null==t.streamID&&(v.extendedData=v.extendedData+". streamID should be of string type",!0)}))))return i.reporter.setError(m,Xn.MIXER_INPUT_PARAMETERS_ERROR),void e(v);var p=t.outputConfig;p&&p.outputFps&&(p.outputFPS=p.outputFps);var g=function(n){var s=ne(i.stateCenter,n),r=s.reportErr,o=s.actualError;1000010150===n.errorCode&&m.setAttributes({stop_reason:"UnmatchStreamId"}),i.reporter.setError(m,r||n),i.reporter.spanEnd({key:Zn.event,par:t.taskID}),o&&(n.errorCode=null==o?void 0:o.code,n.extendedData=(null==o?void 0:o.message)||""),e(n)},b=i.stateCenter.roomList[0];if(b){var E,S,R=[];if(!t.noTaskID&&!t.taskID)return i.logger.error("zb.sh.ums no taskId found"),void g({errorCode:Zn.error.Wi.code,extendedData:Zn.error.Wi.message});if(!t.noTaskID&&!ci(t.taskID))return i.logger.error("zb.rh.lg taskId must be string"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!t.noTaskID&&t.taskID.length>256)return i.logger.error("zb.sh.ums taskId is too long"),void g({errorCode:Zn.error.Ki.code,extendedData:Zn.error.Ki.message});if(!t.noTaskID&&!mi(t.taskID))return i.logger.error("zb.sh.ums task ID contains illegal characters"),void g({errorCode:Zn.error.Fi.code,extendedData:Zn.error.Fi.message});if(!t.inputList||0==t.inputList.length)return i.logger.error("zb.sh.ums input list wrong"),void g({errorCode:Zn.error.Zi.code,extendedData:Zn.error.Zi.message});t.inputList.forEach((function(t){"AUDIO"===t.contentType&&(!t.layout&&(t.layout={top:0,left:0,bottom:0,right:0}),t.layout.top=0,t.layout.left=0,t.layout.bottom=1,t.layout.right=1)}));for(var y=0;y<t.inputList.length;y++){var O=t.inputList[y],T={errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message};if(!fi(O.layout))return i.logger.error("zb.sh.ums input layout must be object"),void g(T);var w=O.layout,I=w.bottom,N=w.left,C=w.right;if(!(wi(w.top,!1)&&wi(I,!1)&&wi(N,!1)&&wi(C,!1)))return i.logger.error("zb.sh.ums topleftbottomright must be integer number"),void g(T);if(void 0!==O.renderMode&&![0,1].includes(O.renderMode))return i.logger.error("zb.sh.ums render_mode is wrong"),void g(T);if(void 0!==O.imageInfo){if(!ci(O.imageInfo.url))return i.logger.error("zb.sh.ums image url is require string"),void g(T);if(O.imageInfo.url.length>1024)return i.logger.error("zb.sh.ums input image url length too long"),void g({errorCode:Zn.error.un.code,extendedData:Zn.error.un.message})}if(!li(O.label)){if(!ci(null===(s=O.label)||void 0===s?void 0:s.text)||(null===(r=O.label)||void 0===r?void 0:r.text.length)>=300)return i.logger.error("zb.sh.ums input label text is not string or too long"),void g({errorCode:Zn.error.rn.code,extendedData:Zn.error.rn.message});var k=O.label,z=k.left,D=k.top;if(void 0!==z&&!wi(z,!1)||void 0!==D&&!wi(D,!1))return i.logger.error("zb.sh.ums input label left and top should be integer"),void g(T)}if(void 0!==O.cornerRadius&&!wi(O.cornerRadius,!1))return i.logger.error("zb.sh.ums cornerRadius is wrong"),void g(T);if(void 0!==O.soundLevelID&&!wi(O.soundLevelID,!1))return i.logger.error("zb.sh.ums soundLevelID is wrong"),void g(T)}if(!t.outputList||0==t.outputList.length)return i.logger.error("zb.sh.ums no output list found"),void g({errorCode:Zn.error.Qi.code,extendedData:Zn.error.Qi.message});if(t.outputList.some((function(t){return ci(t)&&!vi(t)&&!mi(t)||fi(t)&&t.target&&!vi(t.target)&&!mi(t.target)})))return i.logger.error("zb.sh.ums stream output target is incorrect"),void g({errorCode:Zn.error.tn.code,extendedData:Zn.error.tn.message});if(!((E=t.inputList.every((function(t){return"AUDIO"===t.contentType})))||p&&fi(p)))return i.logger.error("zb.sh.ums no output config found"),void g({errorCode:Zn.error.nn.code,extendedData:Zn.error.nn.message});if(E&&(t.outputConfig=p=ie(ie({},p||{}),{outputBitrate:.001,outputFPS:1,outputWidth:1,outputHeight:1})),!(E||p.outputBitrate&&wi(p.outputBitrate)))return i.logger.error("zb.sh.ums bitrate param is required and must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!p.outputFPS||!wi(p.outputFPS))return i.logger.error("zb.sh.ums fps param is required and must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!p.outputWidth||!wi(p.outputWidth))return i.logger.error("zb.sh.ums width param is required and must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!p.outputHeight||!wi(p.outputHeight))return i.logger.error("zb.sh.ums height param is required and must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(void 0!==p.outputAudioCodecID&&!wi(p.outputAudioCodecID,!1))return i.logger.error("zb.sh.ums AudioCodecID param must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(void 0!==p.outputAudioBitrate&&!wi(p.outputAudioBitrate))return i.logger.error("zb.sh.ums AudioBitrate param must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(void 0!==p.outputAudioChannels&&!wi(p.outputAudioChannels,!1))return i.logger.error("zb.sh.ums AudioChannels param must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!li(t.watermark)){if(!ci(null===(o=t.watermark)||void 0===o?void 0:o.imageURL))return i.logger.error("zb.sh.ums watermark image type error"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!((S=null===(u=t.watermark)||void 0===u?void 0:u.imageURL).startsWith("preset-id://")||S.startsWith("http")||S.startsWith("https"))||!(S.endsWith(".jpg")||S.endsWith(".jpeg")||S.endsWith(".png")))return i.logger.error("zb.sh.ums watermark image url invalid"),void g({errorCode:Zn.error.cn.code,extendedData:Zn.error.cn.message})}if(!li(t.whiteboard)){if(!ci(null===(h=t.whiteboard)||void 0===h?void 0:h.whiteboardID))return i.logger.error("zb.sh.ums whiteboard is required and must be string"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!fi(null===(c=t.whiteboard)||void 0===c?void 0:c.layout))return i.logger.error("zb.sh.ums whiteboard layout must be object"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});var A=null===(a=t.whiteboard)||void 0===a?void 0:a.layout;I=A.bottom,N=A.left,C=A.right;if(!(wi(A.top,!1)&&wi(I,!1)&&wi(N,!1)&&wi(C,!1)))return i.logger.error("zb.sh.ums whiteboard topleftbottomright must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});var P=t.whiteboard,M=P.horizontalRatio,U=P.verticalRatio,x=P.isPPTAnimation,L=P.zOrder,j=P.backgroundColor;if(!li(M)&&!wi(M))return i.logger.error("zb.sh.ums horizontalRatio must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!li(U)&&!wi(U))return i.logger.error("zb.sh.ums verticalRatio must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!li(x)&&!ai(x))return i.logger.error("zb.sh.ums isPPTAnimation must be boolean"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!li(L)&&!wi(L,!1))return i.logger.error("zb.sh.ums zOrder must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});if(!li(j)&&!wi(j,!1))return i.logger.error("zb.sh.ums backgroundColor must be integer number"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message})}if(!li(t.enableSoundLevel)&&!ai(t.enableSoundLevel))return i.logger.error("zb.sh.ums enableSoundLevel is not bool"),void g({errorCode:Zn.error.ii.code,extendedData:Zn.error.ii.message});for(y=0;y<t.inputList.length;y++){var q=t.inputList[y],G=q.streamID;i.stateCenter.testEnvironment&&(G="zegotest-"+i.stateCenter.appid+"-"+q.streamID),R.push({stream_id:G,content_control:"AUDIO"===q.contentType?1:0,top:null===(l=q.layout)||void 0===l?void 0:l.top,left:null===(f=q.layout)||void 0===f?void 0:f.left,bottom:null===(_=q.layout)||void 0===_?void 0:_.bottom,right:null===(d=q.layout)||void 0===d?void 0:d.right,render_mode:q.renderMode,image:q.imageInfo,label:q.label})}var H=[];t.outputList.forEach((function(t){var i="";ci(t)?i=t:fi(t)&&t.target&&(i=t.target);var n=0;(i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8"))&&(n=1),H.push({target:i,is_url:n?"true":"false"})}));i.reporter.spanSetAttributes({key:Zn.event,par:t.taskID},{mix_stream_conf:Zn.mix_stream_conf({fps:p.outputFPS,bitrate:p.outputBitrate,w:p.outputWidth,h:p.outputHeight,stream_cnt:R.length,mix_task_id:t.taskID,input_stream_list:R,output_target_list:H})}),b.streamHandler.updateMixStream(t,ee,(function(e){i.reporter.spanEnd({key:Zn.event,par:t.taskID}),n(e)}),g)}else g({errorCode:Zn.error.ei.code,extendedData:Zn.error.ei.message})}))},setMixerTaskConfig:function(t){var i=this;return new ft((function(n,e){var s,r=i.reporter.createSpan(Kn.H,{key:Wt},{key:""},te.event),o={},u=function(t){i.reporter.setError(r,t),e(t)};if(t&&t.videoCodec){var h=t.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(h))return i.logger.error("zb.sh.ums param videoCode error"),u({errorCode:te.error.an.code,extendedData:te.error.an.message}),!1;o.videoCodec=h}if(t.backgroundColor){if(!wi(t.backgroundColor))return i.logger.error("zb.sh.ums param backgroundColor must be integer number"),u({errorCode:te.error.ii.code,extendedData:te.error.ii.message}),!1;o.backgroundColor=t.backgroundColor}var c=t.backgroundImage;if(c){if(!ci(c))return i.logger.error("zb.sh.ums param outputBgImage error"),u({errorCode:te.error.ii.code,extendedData:te.error.ii.message}),!1;if(!c.startsWith("preset-id://")||!c.endsWith(".jpg")&&!c.endsWith(".png"))return i.logger.error("zb.sh.ums illegal input background image URL"),u({errorCode:te.error.ln.code,extendedData:te.error.ln.message}),!1;o.backgroundImage=c}var a=t&&t.userData;if(a){if(!(a instanceof Uint8Array))return i.logger.error("zb.sh.ums param userData required Uint8Array"),u({errorCode:te.error.ii.code,extendedData:te.error.ii.message}),!1;if(a.byteLength>1e3)return i.logger.error("zb.sh.ums param userData should shorter than 1000"),u({errorCode:te.error.ii.code,extendedData:te.error.ii.message}),!1;o.userData=a}t.extraParams&&(o.extraParams||(o.extraParams=[]),(s=o.extraParams).push.apply(s,t.extraParams)),ee=o,r.setAttributes({mix_params:te.mix_params(t)}),i.stateCenter.roomList[0]?(r.end(),n({errorCode:0,extendedData:""})):u({errorCode:te.error.ei.code,extendedData:te.error.ei.message})}))},stopMixerTask:function(t){var i=this;return new ft((function(n,e){var s=i.reporter.createSpan(Kn.H,{key:Wt},{key:""},Qn.event);if(!t||!ci(t)||t.length>256||!mi(t))return i.logger.error("zb.rh.lg taskID must be string less 256"),i.reporter.setError(s,Qn.error.ii," param taskID error"),void e({errorCode:Qn.error.ii.code,extendedData:Qn.error.ii.message+" param taskID error"});s.setAttributes({mix_task_id:t});var r=function(t){var n=ne(i.stateCenter,t),r=n.actualError;i.reporter.setError(s,n.reportErr||t),r&&(t.errorCode=null==r?void 0:r.code,t.extendedData=(null==r?void 0:r.message)||""),e(t)},o=i.stateCenter.roomList[0];o?o.streamHandler.stopMixStream(t,(function(t){s.end(),n(t)}),r):r({errorCode:Qn.error.ei.code,extendedData:Qn.error.ei.message})}))}},re={_sendMixStopReqByAccessHub:function(t,i,n){var e=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new Fn),t.timestamp=Wn.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.1 req "+JSON.stringify(t));var s=this.mixStreamProtoBuf.encodeMixStreamStopReq(t),r=function(i,n){try{var s=e.mixStreamProtoBuf.decodeMixStreamStopRsp(i);e.logger.info("zb.sh.smseba.1 rsp "+JSON.stringify(t));var r=(null==s?void 0:s.common_response)||{};return{code:r.code,msg:r.message}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:16},s,(function(t,e){var s=r(t),o=s.code,u=s.msg;0!=o&&null!=o||!_i(i)?n&&n({errorCode:o,extendedData:u||""}):i({errorCode:o,extendedData:u})}),(function(t,i,s){var o="";if(s)return s==Xn.TIMEOUT&&(s=Zn.error.en),s.code&&20010===s.code&&(s=JSON.parse(JSON.stringify(Xn.MIXER_NO_SERVICES))),void(n&&n(s,o));s=Zn.error.sn;var u="";if(ci(i))u=i;else{var h=r(i);u=h.code+" "+h.msg}e.logger.error("zb.sh.pt "+(o="request media server fail, error: "+t+" "+u)),n&&n(s,o)}))},stopMixStream:function(t,i,n,e,s){this.logger.info("zb.sh.sms call");var r=this.getStopMixStreamParams(t,e,s);this.stateCenter.useNetAgent&&this._sendMixStopReqByAccessHub(r.mixStopReq,i,n)},_sendMixStartReqByAccessHub:function(t,i,n,e){var s=this;this.mixStreamProtoBuf||(this.mixStreamProtoBuf=new Fn),t.timestamp=Wn.fromInt(Math.ceil((new Date).getTime()/1e3)),this.logger.info("zb.sh.smseba.0 req "+JSON.stringify(t));var r=this.mixStreamProtoBuf.encodeMixStreamStartReq(t),o=function(t,i){try{var n=s.mixStreamProtoBuf.decodeMixStreamStartRsp(t);Ai(n),s.logger.info("zb.sh.smseba.0 rsp "+JSON.stringify(n));var e=n.common_response;return{code:e.code,msg:e.message,data:n.data,errStreamList:n.error_streamid_list}}catch(t){return{code:-1}}};this.sendMixRequest({interfaceID:15},r,(function(t,r){var u=o(t),h=u.code,c=u.errStreamList;if(void 0===h||0==h){var a=u.data.play_infos.map((function(t){var n={rtmpURL:"",hlsURL:"",flvURL:""},e=t.stream_alias||"";return s.stateCenter.testEnvironment&&e&&e.startsWith(i)&&(e=e.slice(i.length)),n.streamID=e,t.rtmp_url&&t.rtmp_url.length>0&&(n.rtmpURL=t.rtmp_url),t.hls_url&&t.hls_url.length>0&&(n.hlsURL=t.hls_url),t.hdl_url&&t.hdl_url.length>0&&(n.flvURL=t.hdl_url),n}));if(n)n({errorCode:0,extendedData:JSON.stringify({mixerOutputList:a})})}else{var l="",f=h+1e9;if(1000000150==f&&c){var _=c.map((function(t){return s.stateCenter.testEnvironment&&t.startsWith(i)?t.slice(i.length):t}))||[];_.length>0&&(s.logger.debug("zb.sh.ums not exist streams: "+_),l=_.join(","))}e&&e({errorCode:s.stateCenter.getServerError(1e4+f,s.stateCenter.useNetAgent).code,extendedData:l})}}),(function(t,i,n){var r="";if(n)return n==Xn.TIMEOUT&&(n=Zn.error.en),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(Xn.MIXER_NO_SERVICES))),void(e&&e(n,r));n=Zn.error.sn;var u="";if(ci(i))u=i;else{var h=o(i);u=h.code+" "+h.msg}s.logger.error("zb.sh.pt "+(r="request media server fail, error: "+t+" "+u)),e&&e(n,r)}))},getStartMixStreamParams:function(t,i){var n,e,s=this,r={request_seq:this.stateCenter.getSeq(),mix_protocol_version:1,task_id:t.taskID,room_id:this.roomID,mix_stream_common:{},input_stream:[],advance_config:[],output_stream:[]},o=t.outputConfig||{};o.singleStreamPassThrough&&ai(o.singleStreamPassThrough)&&(r.mix_stream_common.single_stream_pass_through=o.singleStreamPassThrough?1:0);var u=i;if(u&&(u.videoCodec&&(null===(n=r.advance_config)||void 0===n||n.push({key:"video_encode",value:u.videoCodec})),u.backgroundColor&&(r.mix_stream_common.output_bg_color=u.backgroundColor),u.backgroundImage&&(r.mix_stream_common.output_bg_image=u.backgroundImage),u.userData&&(r.mix_stream_common.user_data=this.stateCenter.uint8arrayToBase64(u.userData)),u.extraParams&&(null===(e=r.advance_config)||void 0===e||e.push.apply(e,u.extraParams))),void 0!==t.enableSoundLevel&&(r.mix_stream_common.with_sound_level=t.enableSoundLevel?1:0),t.inputList.forEach((function(t,i){var n,e,o,u,h,c,a,l,f,_,d,m,v,p,g,b,E,S,R,y,O,T=t.streamID;s.stateCenter.testEnvironment&&(T="zegotest-"+s.stateCenter.appid+"-"+t.streamID);var w={stream_input_common:{stream_id:T,content_control:"AUDIO"===t.contentType?1:0,layer_rect:{layer:null===(n=t.layout)||void 0===n?void 0:n.layer,top:null===(e=t.layout)||void 0===e?void 0:e.top,left:null===(o=t.layout)||void 0===o?void 0:o.left,bottom:null===(u=t.layout)||void 0===u?void 0:u.bottom,right:null===(h=t.layout)||void 0===h?void 0:h.right}},volume:100,audio_h_angle:-1,render_mode:t.renderMode,corner_radius:t.cornerRadius};if(null===(c=t.label)||void 0===c?void 0:c.text){var I={font_type:(null===(l=null===(a=t.label)||void 0===a?void 0:a.font)||void 0===l?void 0:l.type)||0,font_size:(null===(_=null===(f=t.label)||void 0===f?void 0:f.font)||void 0===_?void 0:_.size)||24,font_color:(null===(m=null===(d=t.label)||void 0===d?void 0:d.font)||void 0===m?void 0:m.color)||16777215,font_transparency:(null===(p=null===(v=t.label)||void 0===v?void 0:v.font)||void 0===p?void 0:p.transparency)||0};I.font_border_color=(null===(b=null===(g=t.label)||void 0===g?void 0:g.font)||void 0===b?void 0:b.border)?null===(S=null===(E=t.label)||void 0===E?void 0:E.font)||void 0===S?void 0:S.borderColor:-1;var N={text:null===(R=t.label)||void 0===R?void 0:R.text,text_left:(null===(y=t.label)||void 0===y?void 0:y.left)||0,text_top:(null===(O=t.label)||void 0===O?void 0:O.top)||0,font:I};w.label=N}t.imageInfo&&(w.image=t.imageInfo),t.soundLevelID&&(w.stream_input_common.sound_level_id=t.soundLevelID),r.input_stream.push(w)})),t.outputList.forEach((function(t){var i,n,e="";if(ci(t)?e=t:fi(t)&&t.target?e=t.target:s.logger.error("zb.sh.ums output target required"),vi(e))i=1,n=e;else{i=0,n=s.stateCenter.testEnvironment?"zegotest-"+s.stateCenter.appid+"-"+e:e}var h={is_url:i,target:n,video_bitrate:1e3*o.outputBitrate,video_fps:o.outputFPS,video_width:o.outputWidth,video_height:o.outputHeight,output_quality:23};o.outputAudioCodecID&&(h.audio_enc_id=o.outputAudioCodecID),"vp8"===u.videoCodec?h.audio_enc_id=3:"h264"===u.videoCodec&&(h.audio_enc_id=0),o.outputAudioBitrate&&(h.audio_bitrate=1e3*o.outputAudioBitrate),r.output_stream.push({output_stream_common:h})})),t.watermark&&(r.water_mark={image:t.watermark.imageURL,layout_rect:t.watermark.layout}),t.whiteboard){var h=t.whiteboard,c=h.horizontalRatio,a=h.verticalRatio,l=h.layout,f=h.zOrder,_=h.isPPTAnimation,d=h.backgroundColor;r.white_board={whiteboard_id:Wn.fromString(h.whiteboardID),horizontal_ratio:c||16,vertical_ratio:a||9,is_ppt_animation:!0===_?1:0,layout_rect:ie(ie({},l),{layer:f||0}),background_color:d||4059296768}}return isNaN(t.streamAlignmentMode)||(r.alignment_type=t.streamAlignmentMode),r.audio_channel_cnt=o.outputAudioChannels?o.outputAudioChannels:1,{mixStartReq:r}},updateMixStream:function(t,i,n,e){this.logger.info("zb.sh.ums call"),this.logger.info("zb.sh.ums send command");var s=this.getStartMixStreamParams(t,i).mixStartReq;return this.stateCenter.useNetAgent&&this._sendMixStartReqByAccessHub(s,"zegotest-"+this.stateCenter.appid+"-",n,e),!0},getStopMixStreamParams:function(t,i,n){var e={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:"3.0.2"},s={request_seq:this.stateCenter.getSeq(),room_id:this.roomID};if(ci(t)&&(e.task_id=t,s.task_id=t),null!=i){var r=void 0;e.stream_id=r=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+i:i,s.is_url=0,s.target=r}else null!=n&&(e.mixurl=n,s.is_url=1,s.target=n);return{req_body:e,mixStopReq:s}}};const oe={type:"MixStream",install:function(t,i){for(var n in se)Object.defineProperty(t.prototype,n,{value:se[n],writable:!1});for(var n in re)Object.defineProperty(i.prototype,n,{value:re[n],writable:!1})}};var ue=function(){var t=function(i,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])},t(i,n)};return function(i,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();Pn.use(Un()),Pn.use(Vn),Pn.use(oe);var he=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return ue(i,t),i}(Pn)})(),__webpack_exports__})()}));