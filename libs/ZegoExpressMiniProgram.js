!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}("undefined"!=typeof self?self:this,(function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_PUBLISH_STATE_UPDATE=t.LinkedList=t.ListNode=t.E_CLIENT_TYPE=t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.MIXSTREAM_ERROR_CODE=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.STREAM_DELETE_REASON=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_RETRY_CONNECT_INTERVAL=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAYER_STATE=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.sdkErrorList=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=void 0,t.PROTO_VERSION="2.2.1",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:"Client.",SERVER:"Server.",SUCCESS:{code:"Success",msg:"success."},PARAM:{code:"Error.Param",msg:"input error."},HEARTBEAT_TIMEOUT:{code:"Error.Timeout",msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:"Error.Timeout",msg:"login timeout."},SEND_MSG_TIMEOUT:{code:"Error.Timeout",msg:"send customsg timeout."},RESET_QUEUE:{code:"Error.Timeout",msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:"Error.Network",msg:"network is broken and login fail."},KICK_OUT:{code:"Error.Kickout",msg:"kickout reason="},UNKNOWN:{code:"Error.Unknown",msg:"unknown error."},FREQ_LIMITED:{code:"Error.requencyLimited",msg:"Frequency Limited."}},t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_RETRY_CONNECT_INTERVAL=12,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.STREAM_DELETE_REASON={0:{code:1,description:"user_stop_publishing_stream_normal"},1:{code:2,description:"user_heart_beat_timeout"},2:{code:3,description:"user_repeat_login"},3:{code:4,description:"user_kicked_out"},4:{code:5,description:"user_offline"},100:{code:6,description:"remove_by_server"}},t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.MIXSTREAM_ERROR_CODE=1e4,function(e){e[e.low=1]="low",e[e.stantard=2]="stantard",e[e.hight=3]="hight",e[e.custome=4]="custome"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]="stop",e[e.start=1]="start"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra",e[e.customUrl=2]="customUrl"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]="CDN",e[e.BGP=1]="BGP"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var o=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=o;var s=function(){function e(){this.start=new o,this.end=new o,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new o(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=s,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"};var i=r(4);Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return i.getSeq}}),Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return i.getReportSeq}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatLogEvent=t.ZegoRTCLogEvent=void 0;var o=r(5),s=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:"/sdk/create_stream",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:o.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:o.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:o.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:o.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:o.errorCodeList.PUBLISHER_HTTPS_REQUIRED},stream_type:s,screen:s,camera:s,custom:s},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:o.errorCodeList.PUBLISH_NO_PREVIEW,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kPublishSessionClosedError:o.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:o.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:o.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:o.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:o.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PUBLISHER_TTL_OVERTIME},publishOption:s,message:s,session_id:s,stream:s,video_en_codec_id:s,cap_w:s,cap_h:s,w:s,h:s,video_en_fps:s,video_en_bps:s,audio_c_channel_count:s,audio_en_bps:s,aec_level:s,ans_level:s,agc:s,traffic_control_min_video_bitrate:s},kZegoTaskVideoCaptureSize:{event:"sdk/api/publish_video_c_size",session_id:s,w:s,h:s},kZegoTaskRePublish:{event:"/sdk/republish",stream:s},kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:o.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:o.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:o.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:o.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:o.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:o.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PLAYER_TTL_OVERTIME},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s},kZegoTaskRePlay:{event:"/sdk/replay",stream:s},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoPlayContentChanged:{event:"/sdk/play_content_changed",session_id:s,video_activate:s,audio_activate:s},kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR},mix_stream_id:s,stream_cnt:s,input_stream_list:s,output_target_list:s},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID},config:s},kZegoTaskEnumDevices:{event:"/device/list",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:s},kZegoTaskAudioOutput:{event:"/device/audio_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskVideoCapture:{event:"/device/video_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskDeviceInterrupt:{event:"/device/interrupt",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,interrupt:s},kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskUseVideoDevice:{event:"/device/api/video_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:s},kZegoTaskUseAudioDevice:{event:"/device/api/audio_c",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:s},kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",capability:s},kZegoTaskMutePublishVideo:"/sdk/mute_publish_video",kZegoTaskMutePublishAudio:"/sdk/mute_publish_audio",kZegoTaskMutePlayVideo:"/sdk/mute_play_video",kZegoTaskMutePlayAudio:"/sdk/mute_play_audio",kZegoTaskRemoteCameraUpdate:{event:"/sdk/remote_camera_update",stream:s,status:s},kZegoTaskRemoteMicUpdate:{event:"/sdk/remote_mic_update",stream:s,status:s},kZegoTaskGetSoundLevel:{event:"/sdk/get_sound_level",error:{kGetSoundLevelError:o.errorCodeList.GET_SOUND_LEVEL_FAIL}},kZegoTaskStopSoundLevel:"/sdk/stop_sound_level",kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM},stream:s,target_url:s},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:o.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND}},kZegoTaskDestroyStream:{event:"/sdk/destroy_stream",error:{kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskAudioOutputChanged:{event:"/device/api/audio_output",session_id:s,stream:s,device:s,reason:s},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoSetAudioConfig:{event:"/sdk/set_audio_config",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoSetVideoConfig:{event:"/sdk/set_video_config",error:{kParamError:o.errorCodeList.INPUT_PARAM,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoReplaceTrack:{event:"/sdk/replace_track",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:s},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND},stream:s,stream_extra_info:s,room_sid:s},kZegoTaskPlayDecodeFirstVideoFrame:{event:"/sdk/play_decode_first_video_frame",session_id:s,fft_consumed:s},kZegoVisibilityChange:{event:"/app/background"},kZegoSetCaptureVolume:{event:"/sdk/set_capture_volume",error:{kParamError:o.errorCodeList.INPUT_PARAM}}},t.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",error:{kCheckSystemGetSettingFailError:o.errorCodeList.WX_GETSETTING_FAIL},capability:s},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:s,stream:s,message:s},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskRePublish:"/sdk/republish",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:s},kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR},mix_stream_id:s,stream_cnt:s,input_stream_list:s,output_target_list:s},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID},config:s}},console.log(JSON.stringify(t.ZegoRTCLogEvent))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WECHATMINI_ACTION=t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.CONSTRUCTOR="zc.0",e.CREATE_STREAM="zc.cs",e.DESTROY_STREAM="zc.ds",e.START_PUBLISHING_STREAM="zc.sps.0",e.START_PLAYING_STREAM="zc.sps.1",e.STOP_PUBLISHING_STREAM="zc.sps.0.0",e.STOP_PLAYING_STREAM="zc.sps.1.0",e.BIND_WINDOW_LISTENER="zc.wl",e.MUTE_PUBLISH_STREAM_VIDEO="zc.mpsv.0",e.MUTE_PUBLISH_STREAM_AUDIO="zc.mpsa.0",e.MUTE_PLAY_STREAM_VIDEO="zc.mpsv.1",e.MUTE_PLAY_STREAM_AUDIO="zc.mpsa.1",e.SET_AUDIO_OUTPUT="zc.sao",e.SET_CUSTOM_SIGNAL_URL="zc.scsu",e.SET_TURN_OVER_TCP_ONLY="zc.stoto",e.SET_VIDEO_CONFIG="zc.svc",e.SET_AUDIO_CONFIG="zc.sac",e.REPLACE_TRACK="zc.rp",e.PRELOAD_EFFECT="zc.pe.0",e.PLAY_EFFECT="zc.pe.1",e.PAUSE_EFFECT="zc.pe.2",e.RESUME_EFFECT="zc.re",e.STOP_EFFECT="zc.se",e.UNLOAD_EFFECT="zc.ue",e.SET_EFFECT_VOLUME="zc.sev",e.START_MIXING_AUDIO="zc.sma.0",e.STOP_MIXING_AUDIO="zc.sma.1",e.MIXING_BUFFER="zc.mb",e.STOP_MIXING_BUFFER="zc.smb",e.SET_MIXING_AUDIO_VOLUME="zc.smav",e.ENABLE_STREAM="zc.es",e.RDH_ACTIVE="zc.rdh.a",e.RDH_MAX_TIME="zc.rdh.m",e.RDH_WEBRTC_URL_RSP="zc.rdh.hfwur",e.PUBLISH_STATE_HANDLE="zc.psh.0",e.PLAY_STATE_HANDLE="zc.psh.1",e.STATECENTER_ACTION_LISTENER="zc.sc.al",e.SIGNAL_SET_SESSION_INFO="zc.s.ssi",e.SIGNAL_RESET_CONNECT_TIMER="zc.s.rct",e.SIGNAL_BIND_WEBSOCKET_HANDLE="zc.s.bwh",e.SIGNAL_RESET_CHECK_MESSAGE="zc.s.rcm",e.SIGNAL_UPDATE_TOKEN="zc.s.ut",e.SIGNAL_SEND_MESSAGE_WITH_CALLBACK="zc.s.smwc",e.SIGNAL_CONNECT_SERVER="zc.s.cs.0",e.SIGNAL_START_CONNECT_TIMER="zc.s.sct",e.SIGNAL_DISCONNECT_SERVER="zc.s.dc",e.SIGNAL_CREATE_SESSION="zc.s.cs.1",e.SIGNAL_REMOVE_SESSION="zc.s.rs",e.SIGNAL_SEND_REMOVE_SESSION="zc.s.srs",e.SIGNAL_SEND_MESSAGE="zc.s.sm",e.SIGNAL_HANDLE_RESPOND_DATA="zc.s.hrd",e.SIGNAL_ADD_SESSION="zc.s.as",e.SIGNAL_HANDLE_PUSH_DATA="zc.s.hpd",e.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA="zc.s.hprsd",e.SIGNAL_SEND_MEDIA_DESC="zc.s.smd",e.SIGNAL_SEND_CANDIDATE_INFO="zc.s.sci",e.SIGNAL_SEND_MEDIA_DESC_ACK="zc.s.smda",e.SIGNAL_SEND_CANDIDATE_INFO_ACK="zc.s.scia",e.SIGNAL_SEND_CLOSE_SESSION_ACK="zc.s.scsa",e.SIGNAL_SEND_RESET_SESSION_ACK="zc.s.srsa",e.SIGNAL_REGISTER_PUSH_CALLBACK="zc.s.rpc",e.SIGNAL_CHECK_MESSAGE_TIMEOUT="zc.s.cmt",e.SIGNAL_SEND_HEARTBEAT="zc.s.sh",e.SIGNAL_QUALITY_REPORT="zc.s.qr",e.SIGNAL_SEND_STREAM_STATUS="zc.s.sss",e.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM="zc.s.apvs",e.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM="zc.s.apas",e.SIGNAL_SEND_BROADCAST_STATUS="zc.s.sbs",e.PUBLISHER_START_PUBLISH="zc.p.0.sp",e.PUBLISHER_PUBLISH_SUCCESS="zc.p.ps",e.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS="zc.p.0.ocpss",e.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.0.hcsws",e.PUBLISHER_ON_CREATE_OFFER_SUCCESS="zc.p.0.ocos",e.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.0.oslds",e.PUBLISHER_ON_GET_REMOTE_DESCRIPTION="zc.p.0.ogrd",e.PUBLISHER_ON_RECV_MEDIA_DESC="zc.p.0.ormd",e.PUBLISHER_ON_RECV_CANDIDATE_INFO="zc.p.0.orci.0",e.PUBLISHER_ON_RECV_PUBLISH_EVENT="zc.p.0.orpe",e.PUBLISHER_ON_RECV_CLIENT_INFO="zc.p.0.orci.1",e.PUBLISHER_ON_ICE_CANDIDATE="zc.p.0.oic",e.PUBLISHER_ON_CONNECTION_STATE_CHANGE="zc.p.0.ocsc",e.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.0.oicsc",e.PUBLISHER_RESET_PUBLISH="zc.p.0.rp",e.PUBLISHER_SET_PLAYER_QUALITY_TIMER="zc.p.0.spqt",e.PUBLISHER_UPLOAD_PUBLISH_QUALITY="zc.p.0.upq",e.PUBLISHER_ON_RECV_RESET_SESSION="zc.p.0.orrs",e.PUBLISHER_ON_RECV_CLOSE_SESSION="zc.p.0.orcs",e.PUBLISHER_SEND_CANDIDATE_INFO="zc.p.0.sci",e.PUBLISHER_STATE_ERROR="zc.p.0.psr",e.PUBLISHER_STOP_PUBLISH="zc.p.0.sp",e.PUBLISHER_ON_DISCONNECT="zc.p.0.od",e.PUBLISHER_START_SOUND_LEVEL="zc.p.0.ssl.0",e.PUBLISHER_STOP_SOUND_LEVEL="zc.p.0.ssl.1",e.PUBLISHER_PLAY_EFFECT="zc.p.0.pe.0",e.PUBLISHER_PAUSE_EFFECT="zc.p.0.pe.1",e.PUBLISHER_RESUME_EFFECT="zc.p.0.re",e.PUBLISHER_STOP_EFFECT="zc.p.0.se",e.PUBLISHER_START_MIXING_AUDIO="zc.p.0.sma.0",e.PUBLISHER_STOP_MIXING_AUDIO="zc.p.0.sma.1",e.PUBLISHER_MIXING_BUFFER="zc.p.0.mb",e.PUBLISHER_SET_MIXING_AUDIO_VOLUME="zc.p.0.smav",e.PUBLISHER_HANDLE_ENC_BITRATE="zc.p.0.heb",e.PLAYER_START_PLAY="zc.p.sp.1",e.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS="zc.p.ocpss.1",e.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.hcsws.1",e.PLAYER_ON_CREATE_OFFER_SUCCESS="zc.p.ocos.1",e.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.oslds.1",e.PLAYER_ON_RECV_MEDIA_DESC="zc.p.ormd.1",e.PLAYER_ON_RECV_CANDIDATE_INFO="zc.p.orci.1",e.PLAYER_ON_RECV_PLAY_EVENT="zc.p.orpe.1",e.PLAYER_ON_RECV_CLIENT_INFO="zc.p.orci.1.1",e.PLAYER_ON_ICE_CANDIDATE="zc.p.oic.1",e.PLAYER_ON_CONNECTION_STATE_CHANGE="zc.p.ocsc.1",e.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.oicsc.1",e.PLAYER_RESET_PLAY="zc.p.rp.1",e.PLAYER_SET_PLAYER_QUALITY_TIMER="zc.p.spqt.1",e.PLAYER_UPLOAD_PLAYER_QUALITY="zc.p.upq.1",e.PLAYER_ON_RECV_RESET_SESSION="zc.p.orrs.1",e.PLAYER_ON_RECV_CLOSE_SESSION="zc.p.orcs.1",e.PLAYER_ON_RECV_STREAM_STATUS="zc.p.orss.1",e.PLAYER_ON_GOT_REMOTE_STREAM="zc.p.ogrs.1",e.PLAYER_SEND_CANDIDATE_INFO="zc.p.sci.1",e.PLAYER_STATE_ERROR="zc.p.psr.1",e.PLAYER_STOP_PLAY="zc.p.sp.1",e.PLAYER_ON_DISCONNECT="zc.p.od.1",e.PLAYER_START_SOUND_LEVEL="zc.p.ssl.1",e.PLAYER_STOP_SOUND_LEVEL="zc.p.ssl.1.1",e.PUBLISH_SET_CAPTURE_VOLUME="zc.p.scv"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={})),function(e){e.ADD_PUBLISH_CDN_URL="zw.apcu",e.REMOVE_PUBLISH_CDN_URL="zw.rpcu",e.STOP_MIXER_TASK="zw.smt",e.ON_PUBLISH_STATE_UPDATE="zw.w.opsu",e.ON_PUBLISH_STATE_UPDATE_HANDLE="zw.w.opsuh",e.WECHATMINI_SETPREFERPLAYSOURCETYPE="zw.w.sppst.1",e.WECHATMINI_BIND_LISTENER="zw.w.bl",e.WECHATMINI_DELETE_LISTENER="zw.w.dl",e.WECHATMINI_UPDATE_PLAYER_STATE="zw.w.ups",e.WECHATMINI_UPDATE_PLAYER_NET_STATUS="zw.w.upns",e.WECHATMINI_SET_CUSTOM_SIGNAL_URL="zw.w.scsu",e.WECHATMINI_GET_NEXT_URL="zw.w.gnu",e.WECHATMINI_BIND_STREAM_CENTER_HANDLER="zw.w.bsch",e.WECHATMINI_BIND_RTM_LISTENER="zw.w.brl",e.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE="zw.pu.sppst.0",e.PUBLISHMODULE_START_PUBLISHING_STREAM="zw.pu.sps.0",e.PUBLISHMODULE_STOP_PUBLISHING_STREAM="zw.pu.sps.0.0",e.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL="zw.pu.fpsu.0",e.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP="zw.pu.hfspur.0",e.PUBLISHMODULE_DO_PUBLISH_STREAM="zw.pu.dps.0",e.PUBLISHMODULE_UPDATE_STREAM_INFO="zw.pu.upi",e.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP="zw.pu.hsur",e.PLAYMODULE_START_PLAYING_STREAM="zw.pl.sps.1",e.PLAYMODULE_STOP_PLAYING_STREAM="zw.pl.sps.1.0",e.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN="zw.pl.spsfc",e.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP="zw.pl.spsfb",e.PLAYMODULE_DO_PLAY_STREAM="zw.pl.dps",e.PLAYMODULE_FETCH_PLAY_STREAM_URL="zw.pl.fpsu",e.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP="zw.pl.hfsur",e.STREAMCENTERWECHAT_RESET="zw.scw.r.0",e.STREAMCENTERWECHAT_START_PUBLISHING_STREAM="zw.scw.sps.0",e.STREAMCENTERWECHAT_START_PLAYING_STREAM="zw.scw.sps.1",e.STREAMCENTERWECHAT_START_PLAYER="zw.scw.sp.0",e.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE="zw.scw.opuu.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE="zw.scw.ups.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS="zw.scw.upns",e.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE="zw.scw.ups.0.0",e.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE="zw.scw.ups.1.0",e.STREAMCENTERWECHAT_GET_NEXT_URL="zw.scw.gnu",e.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM="zw.scw.sps.0.0",e.STREAMCENTERWECHAT_STOP_PLAYING_STREAM="zw.scw.sps.1.0",e.STREAMCENTERWECHAT_STOP_PLAYER="zw.scw.sp.1",e.STREAMCENTERWECHAT_ON_PLAY_START="zw.scw.ops.0",e.STREAMCENTERWECHAT_ON_PLAY_STOP="zw.scw.ops.1",e.STREAMCENTERWECHAT_ON_PLAY_RETRY="zw.scw.opr",e.PLAYWECHAT_TRY_START_PLAYER="zw.pw.tsp.0",e.PLAYWECHAT_UPDATE_EVENT="zw.pw.ue",e.PLAYWECHAT_GET_PLAY_URL="zw.pw.gpu"}(t.ZEGO_WECHATMINI_ACTION||(t.ZEGO_WECHATMINI_ACTION={}))},function(e,t,r){"use strict";var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,i){function n(e){try{_(o.next(e))}catch(e){i(e)}}function a(e){try{_(o.throw(e))}catch(e){i(e)}}function _(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,a)}_((o=o.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,o,s,i,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!(s=n.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){n.label=i[1];break}if(6===i[0]&&n.label<s[1]){n.label=s[1],s=i;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(i);break}s[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var i=r(1),n=function(){function e(){}return e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){var o,s;t.success&&(o=t.success,r[e+"SuccessCallback"]=o),t.error&&(s=t.error,r[e+"ErrorCallback"]=s)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,s){e.registerCallback(t,{success:function(t,s){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.dataReportEvent(r,o,t,s,i)}},s)},e.actionLogReportCallback=function(t,r,o,s,i){e.actionSuccessCallback(t,r)&&e.actionSuccessCallback(t,r)(o,s)},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return{code:0,message:""};var r={code:0,message:"liveroom cmd error"};return r.code=e,r.message=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.mixServerError=function(e){var t={82000001:"kMixStreamFailError",82000002:"kMixStreamInputError",82000003:"kMixStreamAuthError",82000150:"kMixStreamNotExistError",82000151:"kMixStreamStartMixError",82000152:"kMixStreamStopMixError",82000155:"kMixStreamInputFormatError",82000156:"kMixStreamOutputFormatError",82000157:"kMixStreamNotOpenError",82000158:"kMixStreamInputExceedError",82000159:"kMixStreamDispatchError",82000160:"kMixStreamStopMixOwnerError",82000170:"kMixStreamWaterMarkParamError",82000171:"kMixStreamWaterMarkImageError",82000190:"kMixStreamQpsOverloadError"},r={1:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",190:"MIXER_START_REQUEST_ERROR"},o=[];if(e>1e9){var s=e-1e9+82e6;o[0]=t[s]?t[s]:"",o[1]=r[e-1e9]?r[e-1e9]:""}return o},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,s){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,s[0]);break;case"addEventMsg":e.addEventMsg(t,o,s[0],s[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,s[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,o){var s,i=[],n=[],a=[];r||(r=[]);for(var _=0;_<r.length;_++)if(r[_].anchor_id_name!=e){s=!1;for(var E=0;E<t.length;E++)if(r[_].stream_id===t[E].stream_id){r[_].extra_info!==t[E].extra_info&&a.push(r[_]),s=!0;break}s||i.push(r[_])}for(var l=0;l<t.length;l++){s=!1;for(var d=0;d<r.length;d++)if(t[l].stream_id===r[d].stream_id){s=!0;break}s||n.push(t[l])}t.splice(0);for(_=0;_<r.length;_++)t.push(r[_]);o(i,n,a)},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(t=t||o.length,e)for(r=0;r<e;r++)s[r]=o[0|Math.random()*t];else{var i=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",r=0;r<36;r++)s[r]||(i=0|16*Math.random(),s[r]=o[19==r?3&i|8:i])}return s.join("")},e.supportDetection=function(e,t){return o(this,void 0,void 0,(function(){var r,o,i,n,a,_;return s(this,(function(s){switch(s.label){case 0:return r={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},((o=document.createElement("video")).captureStream||o.mozCaptureStream)&&(r.customCapture=!0),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?"https:"===window.location.protocol||"file:"===window.location.protocol||-1!=window.location.hostname.indexOf("127.0.0.1")||-1!=window.location.hostname.indexOf("localhost")?[3,1]:(r.camera=!1,console.error("webrtc requires https or localhost"),[3,7]):[3,7];case 1:return s.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 2:return(i=s.sent())&&(r.camera=!0)&&i.getTracks().forEach((function(e){return e.stop()})),[3,4];case 3:return n=s.sent(),r.errInfo.camera={name:n.name,message:n.message},console.error("camera devices detect error: ",n.name,n.message),[3,4];case 4:return s.trys.push([4,6,,7]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 5:return(a=s.sent())&&(r.microphone=!0)&&a.getTracks().forEach((function(e){return e.stop()})),[3,7];case 6:return _=s.sent(),r.errInfo.microphone={name:_.name,message:_.message},console.error("microphone devices detect error: ",_.name,_.message),[3,7];case 7:return this.supportVideoCodeType((function(e,o){r.videoCodec.H264=e.H264,r.videoCodec.H265=e.H265,r.videoCodec.VP8=e.VP8,r.videoCodec.VP9=e.VP9,r.webRTC=e.webRTC,o&&(r.errInfo.webRTC={name:o.name,message:o.message},console.error("videoCodec detect error: "+o)),t&&t(r)})),[2]}}))}))},e.getNetQuality=function(e,t){return e&&e<600?t>.4?2:t>.3?4:5:e<900?t>.4?2:t>.2?3:4:t>.2?2:3},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],o=[],s=[],i=0;i<t.length;i++){var n=t[i];"audioinput"===n.kind&&r.push({deviceName:n.label,deviceID:n.deviceId}),"audiooutput"===n.kind&&o.push({deviceName:n.label,deviceID:n.deviceId}),"videoinput"===n.kind&&s.push({deviceName:n.label,deviceID:n.deviceId})}e&&e({microphones:r,speakers:o,cameras:s})})).catch((function(e){console.error("enumerate devices wrong "+e),t&&t(i.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)})):t&&t(i.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var s=parseInt(e[o]),i=parseInt(t[o]);if(s>i)return 1;if(s<i)return-1}return 0},e.isSupportLive=function(e,t){var r="当前微信版本过低，无法使用相关组件",o="需要摄像头和录音功能的授权",s=wx.getSystemInfoSync().SDKVersion,i={code:0,msg:""};this.compareVersion(s,"1.7.0")<0&&(i={code:10001,msg:r},e&&e(i)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(i={code:10002,msg:o}),e&&e(i)},fail:function(e){console.error("get setting error",e),t&&t(e)}})},e.supportVideoCodeType=function(e){var t={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1};try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){if(t.webRTC=!0,r&&r.sdp){var o=r.sdp.split("\r\n");t.H264=o.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1})),t.VP8=o.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP8/")>-1})),t.VP9=o.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP9/")>-1})),t.H265=o.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H265/")>-1})),e&&e(t)}}))}catch(r){e&&e(t,r)}},e.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:"text/javascript"}));return new Worker(r)}return null},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,s=e.indexOf("Chrome")&&window.chrome,i=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":o?"Opera":s?"Chrome":i?"Safari":"Unkown"},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.checkScreenParams=function(t,r){if("object"==typeof t&&void 0!==t.videoQuality&&!e.checkInteger(t.videoQuality))return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number"),!1;if("object"==typeof t&&4===t.videoQuality){if(void 0===t.bitRate)return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.bitRate))return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1;if(t.bitRate>10240)return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps"),!1;if(void 0===t.frameRate)return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate is required when videoQuality is 4"),!1;if(!e.checkInteger(t.frameRate))return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1;if(void 0===t.width)return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width is required when videoQuality is 4"),!1;if(!e.checkInteger(t.width))return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1;if(void 0===t.height)return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height is required when videoQuality is 4"),!1;if(!e.checkInteger(t.height))return r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1}return!0},e.checkCameraParams=function(t,r){return t.width&&e.checkValidNumber(t.width)?t.height&&e.checkValidNumber(t.height)?t.frameRate&&e.checkValidNumber(t.frameRate)?!(!t.bitRate||!e.checkValidNumber(t.bitRate))||(r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1):(r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," frameRate must be integer number"),!1):(r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," height must be integer number"),!1):(r(i.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," width must be integer number"),!1)},e.isParamEmpty=function(e){return null!=e&&""!==e},e.isTypeString=function(e){return"string"==typeof e},e.isTooLong=function(e,t){return!(e.length>=t)},e.isReDispatch=function(e){var t=e.message.match(/action:(\d+)/),r=t?Number(t[1]):NaN;return[i.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,i.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,i.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(e)||[6].includes(r)},e.arrAvg=function(e,t,r){return e.push(t),e.length>r&&e.shift(),e.reduce((function(e,t){return e+t}))/e.length},e}();t.ClientUtil=n},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedList=t.ListNode=t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.E_CLIENT_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.sdkErrorList=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.PROTO_VERSION="1.2.0",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:"Client.",SERVER:"Server.",SUCCESS:{code:"Success",msg:"success."},PARAM:{code:"Error.Param",msg:"input error."},HEARTBEAT_TIMEOUT:{code:"Error.Timeout",msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:"Error.Timeout",msg:"login timeout."},SEND_MSG_TIMEOUT:{code:"Error.Timeout",msg:"send customsg timeout."},RESET_QUEUE:{code:"Error.Timeout",msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:"Error.Network",msg:"network is broken and login fail."},KICK_OUT:{code:"Error.Kickout",msg:"kickout reason="},UNKNOWN:{code:"Error.Unknown",msg:"unknown error."},FREQ_LIMITED:{code:"Error.requencyLimited",msg:"Frequency Limited."}},t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={})),t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},t.getSeq=(o=1,function(){return o++}),t.getReportSeq=function(){var e=1;return function(){return e++}}();var s=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=s;var i=function(){function e(){this.start=new s,this.end=new s,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new s(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_RTM_ACTION=void 0,function(e){e.ZEGOEXPRESSWEBRTM_CONSTRUCTOR="zm.0",e.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER="zm.wl",e.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG="zm.slf",e.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE="zm.sdv",e.ZEGOEXPRESSWEBRTM_LOGIN_ROOM="zm.lg",e.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM="zm.lo",e.ZEGOEXPRESSWEBRTM_SEND_CUSTOM="zm.scc",e.ZEGOEXPRESSWEBRTM_SEND_BCM="zm.sbcm",e.ZEGOEXPRESSWEBRTM_SEND_RLM="zm.srlm",e.ZEGOEXPRESSWEBRTM_SEND_BRM="zm.sbrm",e.ZEGOEXPRESSWEBRTM_SEND_RAM="zm.sram",e.ZEGOEXPRESSWEBRTM_ON="zm.on",e.ZEGOEXPRESSWEBRTM_OFF="zm.off",e.ROOM_LOGIN_ROOM="zm.rm.lg",e.ROOM_TRY_LOGIN="zm.rm.tl",e.ROOM_OPEN_HANDLER="zm.rm.op",e.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",e.ROOM_CLOSEHANDLER="zm.rm.clh",e.ROOM_LOGOUT="zm.rm.lo",e.ROOM_RESET_ROOM="zm.rm.rr",e.ROOM_DISCONNECT="zm.rm.dcn",e.ROOM_KICK_OUT="zm.rm.kco",e.ROOM_STATUS_CALLBACK="zm.rm.scb",e.HEARTBEAT_START="zm.hb.st",e.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",e.HEARTBEAT_RESET="zm.hb.rst",e.SERVICE_PUSH="zm.sv.ps",e.SERVICE_SEND="zm.sv.sd",e.USER_LOGIN_RSP="zm.us.lgr",e.USER_FETCH_USER="zm.us.ftu",e.USER_FETCH_USER_RSP="zm.us.urp",e.USER_USER_PUSH="zm.us.uph",e.USER_MERGE_SEQ="zm.us.mg",e.USER_MERGE="zm.us.mg",e.USER_HB_PATCH="zm.us.pt",e.MESSAGE_SEND_RELIABLE="zm.msg.sdr",e.MESSAGE_FETCH_RELIABLE="zm.msg.frm",e.MESSAGE_RELIABLE_RSP="zm.msg.rlr",e.MESSAGE_RELIABLE_PUSH="zm.msg.rps",e.MESSAGE_SEND_ROOM_MSG="zm.msg.srm",e.MESSAGE_SEND_CUSTOM_MSG="zm.msg.scm",e.MESSAGE_SEND_BIG_MSG="zm.msg.sbm",e.MESSAGE_BIG_MSG_PUSH="zm.msg.bps",e.MESSAGE_SEND_RELAY_MSG="zm.msg.slm",e.LIVE_SEND_SIGNAL="zm.lv.ssg",e.LIVE_RESPOND_JOIN_LIVE="zm.lv.rjl",e.LIVE_PUSH_SIGNAL="zm.lv.pss",e.STATE_ACTION="zm.st.at"}(t.ZEGO_RTM_ACTION||(t.ZEGO_RTM_ACTION={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login room"},STREAMID_TOO_LONG:{code:1000014,msg:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,msg:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,msg:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,msg:"extra info of publshing stream is null"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,msg:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,msg:"input parm error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,msg:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,msg:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,msg:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,msg:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,msg:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,msg:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,msg:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,msg:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,msg:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,msg:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,msg:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,msg:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,msg:"ice connection error"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,msg:"constraint error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,msg:"negotiation timeout"},PUBLISH_NOT_PUBLISH:{code:1103040,msg:"publisher not found"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,msg:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,msg:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,msg:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,msg:"stream is not from zego"},VIDEO_DEVICE_FALSE:{code:1103045,msg:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,msg:"audio is false"},TRACK_NOT_FOUND:{code:1103047,msg:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,msg:"device is not found"},PLAYER_PARAM:{code:1104001,msg:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,msg:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,msg:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,msg:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,msg:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,msg:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,msg:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,msg:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,msg:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,msg:"ice connection error"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,msg:"negotiation timeout"},MIXER_NO_SERVICES:{code:1005e3,msg:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,msg:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,msg:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,msg:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,msg:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,msg:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,msg:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,msg:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOPMIXER:{code:1005012,msg:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,msg:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,msg:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,msg:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,msg:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,msg:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,msg:"stream input parameters are wrong"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,msg:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,msg:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,msg:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,msg:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,msg:"illegal input background image URL"},MIXER_INNER_ERROR:{code:1005099,msg:"mixed stream internal error"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,msg:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var o=r(0),s=r(2),i=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){var o,s;t.success&&(o=t.success,r[e+"SuccessCallback"]=o),t.error&&(s=t.error,r[e+"ErrorCallback"]=s)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,s){e.registerCallback(t,{success:function(t,s){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.dataReportEvent(r,o,t,s,i)}},s)},e.proxyRes=function(t,r,o,s){return{interResolve:function(e){t.uploadReport(r),o(e)},interReject:function(o,i){var n;void 0===i&&(i=""),(n=o.code<2e9&&o.code>1e9?e.decodeServerError(o.code,o.msg):{code:o.code,message:o.msg})&&t.addMsgInfo(r,{error:n.code,message:n.message+i}),t.uploadReport(r),s(o)}}},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:"};if(0===e)return s.errorCodeList.SUCCESS;var r=s.errorCodeList.SERVER;return r.code=e,r.msg=e>1e9?t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,r},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=e>1e9?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"ROOM_ERROR_AUTHENTICATION_FAILED",2003:"ROOM_ERROR_LOGIN_TIMEOUT"}[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={code:e,message:"kickout reason = "+e};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,s){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,s[0]);break;case"addEventMsg":e.addEventMsg(t,o,s[0],s[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,s[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeUserList=function(e,t,r,o){e.debug("msl.0 call");var s,i=[],n=[];r||(r=[]);for(var a=0;a<r.length;a++){s=!1;for(var _=0;_<t.length;_++)if(r[a].userID===t[_].userID){s=!0;break}s||i.push(r[a])}for(var E=0;E<t.length;E++){s=!1;for(var l=0;l<r.length;l++)if(t[E].userID===r[l].userID){s=!0;break}s||n.push(t[E])}for(t.splice(0),a=0;a<r.length;a++)t.push(t[a]);o(i,n),e.debug("msl.0 call success")},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(t=t||o.length,e)for(r=0;r<e;r++)s[r]=o[0|Math.random()*t];else{var i=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",r=0;r<36;r++)s[r]||(i=0|16*Math.random(),s[r]=o[19==r?3&i|8:i])}return s.join("")},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var s=parseInt(e[o]),i=parseInt(t[o]);if(s>i)return 1;if(s<i)return-1}return 0},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,s=e.indexOf("Chrome")&&window.chrome,i=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":o?"Opera":s?"Chrome":i?"Safari":"Unkown"},e.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},e.getLogLevel=function(e){return o.LOG_LEVEL[e]},e}();t.ClientUtil=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTMLogEvent=void 0;var o=r(2),s=function(e){return e};t.ZegoRTMLogEvent={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:s},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:o.errorCodeList.INPUT_PARAM},log_level:function(e){return e},remote_log_level:s,log_url:s},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:s,max_member_count:s,message:s,token:s,error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,INPUT_PARAM:o.errorCodeList.INPUT_PARAM,ROOM_ID_TOO_LONG:o.errorCodeList.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:o.errorCodeList.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:o.errorCodeList.USER_ID_NULL,USER_ID_TOO_LONG:o.errorCodeList.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:o.errorCodeList.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:o.errorCodeList.USER_NAME_NULL,USER_NAME_TOO_LONG:o.errorCodeList.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:o.errorCodeList.REPEATEDLY_LOGIN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:o.errorCodeList.ROOM_ID_NULL,ROOM_DISCONNECT:o.errorCodeList.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:s,try_cnt:s},liveroom_login:{event:"liveroom_login",server:s,respond_info:s}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:s},kZegoTaskLiveRoomhHB:{event:"/liveroom/hb",room_sid:s,error:{NOT_LOGIN:o.errorCodeList.NOT_LOGIN,HB_TIMEOUT:o.errorCodeList.TIMEOUT}},kZegoTaskLiveSendRoomBigIM:{event:"/liveroom/send_big_room_message",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG}},kZegoTaskLiveRoomSendCustomCommand:{event:"/liveroom/send_custom_command",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG}},kZegoTaskLiveRoomSendRoomMessage:{event:"/liveroom/send_room_message",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM,IM_CONTENT_NULL:o.errorCodeList.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:o.errorCodeList.IM_CONTENT_TOO_LONG}},kZegoTaskLiveRoomSendReliableMessage:{event:"/liveroom/send_reliable_message",room_sid:s,error:{INPUT_PARAM:o.errorCodeList.INPUT_PARAM}},kZegoTaskLiveGetRoomBigIM:{event:"/liveroom/get_big_room_message"},kZegoTaskLiveRoomGetRoomMessage:{event:"/liveroom/get_room_message",room_sid:s},kZegoTaskLiveRoomGetCustomCommand:{event:"/liveroom/get_custom_command"},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:s}}},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,function(e){e[e.IE=0]="IE",e[e.FIREFOX=1]="FIREFOX",e[e.CHROME=2]="CHROME",e[e.SAFARI=3]="SAFARI",e[e.OPERA=4]="OPERA",e[e.WEIXIN=5]="WEIXIN",e[e.WEIXINMINI=6]="WEIXINMINI",e[e.UNKOWN=7]="UNKOWN"}(t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={})),function(e){e[e.BROWSER=0]="BROWSER",e[e.WEIXINMINI=1]="WEIXINMINI"}(t.ZEGO_ENV||(t.ZEGO_ENV={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.WEBSOCKET=1]="WEBSOCKET",e[e.HTTPS=2]="HTTPS"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0;var o=function(){function e(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}return e.getInstance=function(){return e.instance||(e.instance=new e,e.instance.init()),e.instance},e.prototype.init=function(){},Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),e.instance=new e,e}();t.LoggerStateCenter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var o=r(0),s=function(){function e(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}return e.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},e.prototype.onopen=function(e){},e.prototype.onerror=function(e){},e.prototype.onclose=function(e){},e.prototype.onmessage=function(e){},e.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},e.prototype.close=function(){this._websocket&&this._websocket.close()},e}();t.ZegoWeiXinMiniWebSocket=s,t.createZegoWebSocket=function(e,t){return t===o.ZEGO_ENV.BROWSER?new WebSocket(e):new s(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=t.createZegoWebSocket=t.ZegoDataReport=t.ZegoLogger=void 0;var o=r(1);Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return o.LoggerStateCenter}});var s=r(2);Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return s.createZegoWebSocket}});var i=r(4);Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return i.ZegoDataReport}});var n=r(5);Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}})},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0;var s=function(){function e(e){this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+" not exist")},e.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn(e+" not exist")},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o&&0!==o.length){for(var s=o.length-1;s>=0;s--)if(o[s].event==t&&0==o[s].time_consumed){o[s].time_consumed=Date.now()-o[s].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t&&0==s[i].time_consumed){s[i].time_consumed=Date.now()-s[i].event_time,null==s[i].msg_ext&&(s[i].msg_ext={}),s[i].msg_ext=o({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var s=o.length-1;s>=0;s--)if(o[s].event==t&&0==o[s].time_consumed){o[s].time_consumed=Date.now()-o[s].event_time,Object.assign(o[s],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,r,o){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t&&null!=s[i].time_consumed){null==s[i].msg_ext?s[i].msg_ext={}:s[i].msg_ext&&(s[i].msg_ext[r]=o);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEventMsg=function(e,t,r,o){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;i>=0;i--)if(s[i].event==t){s[i][r]=o;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&(r?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),msg_ext:r}):this.dataStatistics[e].events.push({event:t,event_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t,r,o){var s=this.dataStatistics[e];null!=s&&(t&&(s.event=t),s.time_consumed=Date.now()-s.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message||r.msg+" "+(o||"")}),this.logger.report(s),delete this.dataStatistics[e])},e}();t.ZegoDataReport=s},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0;var s=r(0),i=r(2),n=r(1),a=r(6),_=function(){function e(e){this.logLevel=s.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=n.LoggerStateCenter.getInstance(),this.env=e}return e.prototype.setLogLevel=function(e){var t=s.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logLevel=t,!0)},e.prototype.setRemoteLogLevel=function(e){var t=s.ENUM_LOG_LEVEL[e];return void 0!==t&&(this.logRemoteLevel=t,!0)},e.prototype.setSessionInfo=function(e,t,r,o,s,i){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=o,this.userName=s,this.version=i},e.prototype.report=function(e){var t=this.logReportParamList(s.ENUM_LOG_LEVEL.REPORT,e);this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.REPORT&&console.debug(t),this.RemoteLog(s.ENUM_LOG_LEVEL.REPORT,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.DEBUG&&console.debug(r),this.log(s.ENUM_LOG_LEVEL.DEBUG,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.INFO&&console.info(r),this.log(s.ENUM_LOG_LEVEL.INFO,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.WARN&&console.warn(r),this.log(s.ENUM_LOG_LEVEL.WARN,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.ERROR&&(console.error(r),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(s.ENUM_LOG_LEVEL.ERROR,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=s.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=s.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=s.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},e.prototype.stopLogServer=function(){this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==s.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=s.ENUM_REMOTE_TYPE.DISABLE},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==s.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&t.length>4e3)console.info("log over maximum, ignore");else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.setLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var o="",s=0;s<this.logCacheSend.length;s++)(o+this.logCacheSend[s]).length>4e3&&(this.websocket.send(o),o=""),o=o+this.logCacheSend[s]+"\n";t=o+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,t){var r=a.getCurrentTime(),o=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t],s={time:r,level:e,action:o[0],content:o[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(s)},e.prototype.logReportParamList=function(e,t){var r=a.getCurrentTime();return t=o(o({},t),{time:r,level:e,console:this.env===s.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},e.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;this.stopWebSocketServer(),this.websocket=i.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("onclose   websocket error:",e)},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("open log websocket error:",e)}}},e.prototype.SendHttpsLog=function(){0!=this.logCacheSend.length&&(this.env===s.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},e.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){console.log("send result failed "+e)}}else console.log("send failed "+r.status)},r.open("POST",this.url,!0),r.send(t),this.logCacheSend=[]},e.prototype.SendHttpsLogWeChatMini=function(){var e=this;!this.existUserID&&this.userid&&this.logCacheSend.forEach((function(t){Array.isArray(t)&&t.forEach((function(r,o){var s=JSON.parse(r);s&&""==JSON.parse(r).userid?(s.userid=e.userid,s.id_name=e.userid,t[o]=JSON.stringify(s)):e.existUserID=!0}))}));var t=this.logCacheSend.join("\n");wx.request({url:this.url,data:t,method:"POST",success:function(t){if(0!=t.data.length){var r=t&&t.data&&t.data.interval;"number"==typeof r&&e.logUploadInterval!==r&&(e.timeInterval=r,e.openHttpsLogServer(e.url))}},fail:function(e){console.log("send failed "+e.statusCode)}}),this.logCacheSend=[]},e}();t.ZegoLogger=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var o=r(0);t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),s=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),a=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0];return t?o.ZEGO_BROWSER_TYPE.IE:r?o.ZEGO_BROWSER_TYPE.FIREFOX:s?o.ZEGO_BROWSER_TYPE.OPERA:i?o.ZEGO_BROWSER_TYPE.CHROME:n?o.ZEGO_BROWSER_TYPE.SAFARI:a?o.ZEGO_BROWSER_TYPE.WEIXIN:o.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise((function(t){-1==e.indexOf("MicroMessage")?t(o.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(e){e.miniprogram}))}))};var s=["00","01","02","03","04","05","06","07","08","09"];t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(s[e.getMonth()+1]||e.getMonth()+1)+"/",(s[e.getDate()]||e.getDate())+" ",(s[e.getHours()]||e.getHours())+":",(s[e.getMinutes()]||e.getMinutes())+":",s[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSeq=t.getReportSeq=t.ZegoExpressWebRTMEngine=void 0;var o=r(7),s=r(5),i=r(0),n=function(){function e(t,r,i){void 0===i&&(i=0),this.logger=new s.ZegoLogger(i),this.dataReport=new s.ZegoDataReport(this.logger),this.zegoWebRTM=new o.ZegoExpressWebRTM(t,r,this.logger,this.dataReport,e.version,i)}return e.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},e.prototype.loginRoom=function(e,t,r,o){return this.zegoWebRTM.loginRoom(e,t,r,o)},e.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},e.prototype.off=function(e){return this.zegoWebRTM.off(e)},e.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},e.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},e.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},e.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},e.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},e.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTM.sendCustomCommand(e,t,r)},e.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTM.setRoomExtraInfo(e,t,r)},e.version=i.PROTO_VERSION,e}();t.ZegoExpressWebRTMEngine=n;var a=r(0);Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return a.getReportSeq}}),Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return a.getSeq}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressWebRTM=void 0;var o=r(0),s=r(2),i=r(3),n=r(0),a=r(8),_=r(10),E=r(11),l=r(12),d=r(1),u=r(4),g=function(){function e(e,t,r,s,a,_){var g=this;this.logger=r,this.dataReport=s,this.version=a,this.stateCenter=new E.StateCenter(this.logger),this.stateCenter.ENV=_;var c=n.getReportSeq();if(this.dataReport.newReport(c),this.setDebug(t),i.ClientUtil.checkConfigParam(e,t,this.logger)){if(this.stateCenter.appid=e,"string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&t.length>0&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,this.modules=new l.LiveRoomModules(this.stateCenter,this.logger,this.dataReport),0==_)this.bindWindowListener(),this.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+"  "+navigator.appVersion),this.stateCenter.networkState=navigator?navigator.onLine?o.ENUM_NETWORK_STATE.online:o.ENUM_NETWORK_STATE.offline:o.ENUM_NETWORK_STATE.online,this.dataReport.addMsgInfo(c,{system_info:u.ZegoRTMLogEvent.kZegoTaskInitSetting.system_info});else if(1==_){this.bindWxListener(),wx.getNetworkType({success:function(e){g.stateCenter.networkState="none"===e.networkType?o.ENUM_NETWORK_STATE.offline:o.ENUM_NETWORK_STATE.online},fail:function(e){g.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" network "+JSON.stringify(e)),g.stateCenter.networkState=o.ENUM_NETWORK_STATE.online}});try{var h=wx.getSystemInfoSync(),T={brand:h.brand,model:h.model,system:h.system,platform:h.platform,version:h.version,SDKVersion:h.SDKVersion};this.dataReport.addMsgInfo(c,{system_info:T})}catch(e){this.logger.warn(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" get system info error")}}this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version)}else this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" init sdk error"),this.dataReport.addMsgInfo(c,u.ZegoRTMLogEvent.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(c,u.ZegoRTMLogEvent.kZegoTaskInitSetting.event)}return e.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)?"pagehide":"unload";window.addEventListener(t,(function(){e.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" "+t),e.logoutRoom(e.stateCenter.roomid)})),window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},e.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},e.prototype.netOnLineHandle=function(){this.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+"network is online"),this.stateCenter.networkState=o.ENUM_NETWORK_STATE.online,this.stateCenter.roomTryHandler&&this.modules.service.isDisConnect()?this.stateCenter.roomTryHandler.active():this.stateCenter.roomTryHandler&&(this.stateCenter.roomTryHandler.stopMaxTime(),this.modules.roomHandler.roomStateHandle("CONNECTED",{code:0,msg:""}))},e.prototype.netOffLineHandle=function(){var e=this;this.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=o.ENUM_NETWORK_STATE.offline,this.stateCenter.roomTryHandler&&(this.stateCenter.roomTryHandler.invalid(),this.stateCenter.roomTryHandler.onactive=function(t,r){e.modules.roomHandler.disconnectedHandle(r)},this.stateCenter.roomTryHandler.startMaxTime(),this.modules.roomHandler.roomStateHandle("CONNECTING",s.errorCodeList.NETWORK_BROKEN))},e.prototype.setLogConfig=function(e){this.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call");var t=n.getReportSeq();if(this.dataReport.newReport(t),e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),this.dataReport.addMsgInfo(t,{log_level:u.ZegoRTMLogEvent.kZegoTaskSetLog.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&(this.logger.setRemoteLogLevel(e.remoteLogLevel),this.dataReport.addMsgInfo(t,{remote_log_level:u.ZegoRTMLogEvent.kZegoTaskSetLog.remote_log_level(e.remoteLogLevel)})),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.setLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:u.ZegoRTMLogEvent.kZegoTaskSetLog.log_url(e.logURL)}),this.dataReport.uploadReport(t,u.ZegoRTMLogEvent.kZegoTaskSetLog.event);else if(e.logURL)return this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(t,u.ZegoRTMLogEvent.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(t,u.ZegoRTMLogEvent.kZegoTaskSetLog.event),!1;return this.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_LOG_CONFIG+" call success"),!0},e.prototype.setDebugVerbose=function(e){var t=n.getReportSeq();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:u.ZegoRTMLogEvent.kZegoTaskSetDebug.debug(e?"true":"false")})),this.dataReport.uploadReport(t,u.ZegoRTMLogEvent.kZegoTaskSetDebug.event),this.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SET_DEBUG_VERBOSE+" call success")},e.prototype.setDebug=function(e){"string"==typeof e&&e.indexOf("wss")>-1?this.stateCenter.debug=i.ClientUtil.isTestEnv(e):Array.isArray(e)&&e.length>0&&e.every((function(e){return"string"==typeof e&&e.indexOf("wss")>-1}))?this.stateCenter.debug=i.ClientUtil.isTestEnv(e[0])||i.ClientUtil.isTestEnv(e[1]):this.logger.info(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},e.prototype.loginRoom=function(e,t,r,s){var i=this;return new Promise((function(n,E){var l=i.loginReport(n,E,t,s),g=l.interResolve,c=l.interReject;!(s=s||{}).maxMemberCount&&(s.maxMemberCount=0);var h=_.checkParams({roomID:{order:0,value:e,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_NULL},{name:_.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:"roomID must be string"},{name:_.RULE_PARAM_NAME.MAX_LENGTH_128,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_TOO_LONG},{name:_.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM},{name:_.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},user:{order:2,value:r,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."},{name:_.RULE_PARAM_NAME.TYPE_OBJECT,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:r.userID,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_NULL,extMsg:" param user error."},{name:_.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" param userID error."},{name:_.RULE_PARAM_NAME.MAX_LENGTH_100,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_TOO_LONG},{name:_.RULE_PARAM_NAME.ILLEGAL_CHARACTERS,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:r.userName,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_NULL},{name:_.RULE_PARAM_NAME.TYPE_STRING,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" userName must be string."},{name:_.RULE_PARAM_NAME.MAX_LENGTH_256,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.USER_NAME_TOO_LONG}]},config:{order:5,value:s,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM}]},"config.maxMemberCount":{order:4,value:null==s?void 0:s.maxMemberCount,rules:[{name:_.RULE_PARAM_NAME.NOT_EMPTY,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."},{name:_.RULE_PARAM_NAME.TYPE_INTEGER,error:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGIN_ROOM,logger:i.logger});h===_.RULE_SUCCESS?(i.stateCenter.runState!==o.ENUM_RUN_STATE.logout&&(i.modules.roomHandler.resetRoom(),i.modules.roomHandler.roomStateHandle("DISCONNECTED",u.ZegoRTMLogEvent.kZegoTaskLoginRoom.error.REPEATEDLY_LOGIN)),i.stateCenter.roomTryHandler||(i.stateCenter.roomTryHandler=new a.RetryRoomHandler(i.logger,i.stateCenter)),i.stateCenter.roomTryHandler.init(i.stateCenter.roomRetryTime),i.stateCenter.roomTryHandler.initRoom(i.modules.roomHandler,e,t,r,i.stateCenter.server,i.stateCenter.serverBak,s),i.stateCenter.roomTryHandler.onactive=function(e,t){e?g(e):c(t)},i.stateCenter.roomTryHandler.active(!0)):c(h.error,h.extMsg)}))},e.prototype.loginReport=function(e,t,r,o){var a=this;0!==this.stateCenter.reportSeqList.login&&(this.dataReport.uploadReport(this.stateCenter.reportSeqList.login),this.stateCenter.reportSeqList.login=0,i.ClientUtil.unregisterCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.stateCenter.reportList));var _=n.getReportSeq();return this.stateCenter.reportSeqList.login=_,this.dataReport.newReport(_,u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event),"string"==typeof r&&this.dataReport.addMsgInfo(_,{token:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.token(r)}),o&&(o.userUpdate&&"boolean"==typeof o.userUpdate&&this.dataReport.addMsgInfo(_,{user_update:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.user_update(o.userUpdate+"")}),o.maxMemberCount&&"number"==typeof o.maxMemberCount&&this.dataReport.addMsgInfo(_,{max_member_count:u.ZegoRTMLogEvent.kZegoTaskLoginRoom.max_member_count(o.maxMemberCount+"")})),i.ClientUtil.logReportCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,this.dataReport,_,this.stateCenter.reportList),{interResolve:function(t){a.dataReport.uploadReport(_),a.stateCenter.reportSeqList.login=0,i.ClientUtil.unregisterCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,a.stateCenter.reportList),e(t)},interReject:function(e,r){var o,n;void 0===r&&(r=""),e.code<2e9&&e.code>1e9||e.code<1e6?(o=i.ClientUtil.decodeServerError(e.code,e.msg),n=i.ClientUtil.getLiveRoomError(e.code)):o={code:e.code,message:e.msg},o&&a.dataReport.addMsgInfo(_,{error:o.code,message:o.message+r}),a.dataReport.uploadReport(_),a.stateCenter.reportSeqList.login=0,i.ClientUtil.unregisterCallback(u.ZegoRTMLogEvent.kZegoTaskLoginRoom.event,a.stateCenter.reportList),n&&s.errorCodeList[n]&&(e.code=s.errorCodeList[n].code),e.code&&e.msg&&""!==r?t({code:e.code,msg:e.msg+r}):t(e)}}},e.prototype.logoutRoom=function(e){var t=n.getReportSeq();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e}),void 0===e)e=this.stateCenter.roomid;else{if("string"!=typeof e||""==e)return this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event);if(e!==this.stateCenter.roomid)return this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_LOGOUT_ROOM+" roomID is error"),this.dataReport.addMsgInfo(t,{error:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)}this.modules.roomHandler.logout(),this.dataReport.uploadReport(t,u.ZegoRTMLogEvent.kZegoTaskLogoutRoom.event)},e.prototype.sendCustomCommand=function(e,t,r){var o=this;return new Promise((function(s,i){o._sendCustomCommand(e,t,r).then((function(e){s({errorCode:e.errorCode,extendedData:e.extendedData})})).catch((function(e){i(e)}))}))},e.prototype._sendCustomCommand=function(e,t,r){var a=this;return new Promise((function(_,E){var l=n.getReportSeq();a.dataReport.newReport(l,u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.event),a.dataReport.addMsgInfo(l,{room_sid:u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.room_sid(a.stateCenter.sessionid)});var g=i.ClientUtil.proxyRes(a.dataReport,l,_,E),c=g.interResolve,h=g.interReject;return"string"!=typeof e||""==e?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" roomid must be string and not empty"),void h(s.errorCodeList.INPUT_PARAM," param roomID error")):r instanceof Array&&!r.find((function(e){return"string"!=typeof e}))?"string"!=typeof t&&"object"!=typeof t?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" custom content must be a non empty string or object"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error")):"string"==typeof t&&t.length>o.MAX_MESSAGE_LENGTH?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" command too long"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.IM_CONTENT_TOO_LONG)):void a.modules.messageHandler.sendCustomCommand(r,t,c,h):(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_CUSTOM+" dstMembers must be string array"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param toUserList error"))}))},e.prototype.sendBroadcastMessage=function(e,t){var r=this;return new Promise((function(o,s){r._sendBroadcastMessage(e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){s(e)}))}))},e.prototype._sendBroadcastMessage=function(e,t,r,s){var a=this;return void 0===r&&(r=1),void 0===s&&(s=1),new Promise((function(_,E){var l=n.getReportSeq();a.dataReport.newReport(l,u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.event),a.dataReport.addMsgInfo(l,{room_sid:u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.room_sid(a.stateCenter.sessionid)});var g=i.ClientUtil.proxyRes(a.dataReport,l,_,E),c=g.interResolve,h=g.interReject;return"string"!=typeof e||""==e?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error")):void 0===t||""==t?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message is empty"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_NULL)):"string"!=typeof t?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message must be string"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param message error")):t.length>o.MAX_MESSAGE_LENGTH?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" message too long"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_TOO_LONG)):void a.modules.messageHandler.sendRoomMsg(r,s,e,t,c,h)}))},e.prototype.setRoomExtraInfo=function(e,t,r){var o=this;return new Promise((function(s,i){o._setRoomExtraInfo(e,t,r).then((function(e){s({errorCode:e.errorCode})})).catch((function(e){i({errorCode:e.errorCode})}))}))},e.prototype._setRoomExtraInfo=function(e,t,r){var s=this;return new Promise((function(a,_){var E=n.getReportSeq();s.dataReport.newReport(E,u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.event),s.dataReport.addMsgInfo(E,{room_sid:u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.room_sid(s.stateCenter.sessionid)});var l=i.ClientUtil.proxyRes(s.dataReport,E,a,_),g=l.interResolve,c=l.interReject;return"string"!=typeof e||""==e?(s.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BCM+" roomid must be string and not empty"),void c(u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error")):t&&"string"==typeof t?t.length>o.MAX_TRANS_TYPE_LENGTH?(s.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void c({errorCode:u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code})):r&&"string"==typeof r?r.length>o.MAX_TRANS_DATA_LENGTH?(s.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type is too long"),void c({errorCode:u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code})):void s.modules.messageHandler.sendReliableMessage(t,r,g,c):(s.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" data must be string"),void c({errorCode:u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code})):(s.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_RLM+" type must be string"),void c({errorCode:u.ZegoRTMLogEvent.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code}))}))},e.prototype.sendBarrageMessage=function(e,t){var r=this;return new Promise((function(o,s){r._sendBarrageMessage(e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){s(e)}))}))},e.prototype._sendBarrageMessage=function(e,t,r,s){var a=this;return void 0===r&&(r=1),void 0===s&&(s=1),new Promise((function(_,E){var l=n.getReportSeq();a.dataReport.newReport(l,u.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.event),a.dataReport.addMsgInfo(l,{room_sid:u.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.room_sid(a.stateCenter.sessionid)});var g=i.ClientUtil.proxyRes(a.dataReport,l,_,E),c=g.interResolve,h=g.interReject;return"string"!=typeof e||""==e?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+"roomid must be string and not empty"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param roomID error")):void 0===t||""==t?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message is empty"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_NULL)):"string"!=typeof t?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message must be string"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param message error")):t.length>o.MAX_MESSAGE_LENGTH?(a.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_SEND_BRM+" message too long"),void h(u.ZegoRTMLogEvent.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_TOO_LONG)):void a.modules.messageHandler.sendBigRoomMessage(r,s,e,t,c,h)}))},e.prototype.sendRelayMessage=function(e,t,r,o){this.modules.messageHandler.sendRelayMessage(e,t,r,o)},e.prototype.requestJoinLive=function(e,t,r,o){return this.modules.liveHandler.requestJoinLive(e,t,r,o)},e.prototype.inviteJoinLive=function(e,t,r,o){return this.modules.liveHandler.inviteJoinLive(e,t,r,o)},e.prototype.endJoinLive=function(e,t,r){return this.modules.liveHandler.endJoinLive(e,t,r)},e.prototype.respondJoinLive=function(e,t,r,o){return this.modules.liveHandler.respondJoinLive(e,t,r,o)},e.prototype.getVersion=function(){return this.version},e.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},e.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},e.prototype.on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype.off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_ON+" event "+e+" no found"),!1)},e.prototype._off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(d.ZEGO_RTM_ACTION.ZEGOEXPRESSWEBRTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},e.prototype.isLogin=function(){return this.stateCenter.isLogin()},e.prototype.getAppID=function(){return this.stateCenter.appid},e.prototype.getUserID=function(){return this.stateCenter.idName},e.prototype.getToken=function(){return this.stateCenter.token},e.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},e.prototype.setRole=function(e){this.stateCenter.role=e},e.prototype.getSessionId=function(){return this.stateCenter.sessionid},e}();t.ZegoExpressWebRTM=g},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RetryRoomHandler=void 0;var i=r(9),n=r(0),a=r(1),_=function(e){function t(t,r){var o=e.call(this,t,r)||this;return o.logger=t,o.stateCenter=r,o}return s(t,e),t.prototype.initRoom=function(e,t,r,o,s,i,n){this.roomHandler=e,this.roomID=t,this.token=r,this.user=o,this.server=s,this.serverBak=i||s,this.config=n},t.prototype.active=function(e){var t=this;if(this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry call"),this.stateCenter.networkState!=n.ENUM_NETWORK_STATE.offline)if(this.retryTimer)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" has actived, ignore");else if(this.isOverTime)this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" retry over time, stop retry");else{if(1==this.retryActiveCount)this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL);else{var r=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1));this.retryActiveInterval=r>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:r}this.retryTimer=setTimeout((function(){t.roomHandler.login(t.retryActiveCount%2==1?t.server:t.serverBak,t.roomID,t.token,t.user,t.config,(function(e){t.handleLoginFinish(e)}),(function(e,r){t.handleLoginFinish(!1,e,r)})),t.retryTimer&&clearTimeout(t.retryTimer),t.retryTimer=null,t.retryActiveCount++}),e?0:1e3*this.retryActiveInterval)}else this.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" network is broken, stop retry")},t.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.logger.info(a.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" over max time "+e.RETRY_MAX_TIME+"s, stop retry"),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,n.sdkErrorList.LOGIN_TIMEOUT)}),1e3*this.RETRY_MAX_TIME))},t.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},t.prototype.onactive=function(e,t){},t.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){var r=e.code+"";return!["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"].includes(r)&&(!!["1100040001","1100040100"].includes(r)||this.stateCenter.lastRunState==n.ENUM_RUN_STATE.login&&(this.stateCenter.sessionid="",this.invalid(),!0))}return!0},t.prototype.handleLoginFinish=function(e,t,r){t?this.handleError(t,r)?(!this.maxTimer&&this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t)):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}))},t}(i.TryHandler);t.RetryRoomHandler=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TryHandler=void 0;var o=function(){function e(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}return e.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},e.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},e}();t.TryHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkParams=t.RULE_SUCCESS=t.RULE_PARAM_NAME=void 0;var o=r(3);!function(e){e.NOT_EMPTY="NOT_EMPTY",e.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",e.TYPE_STRING="TYPE_STRING",e.TYPE_INTEGER="TYPE_INTEGER",e.TYPE_OBJECT="TYPE_OBJECT",e.MAX_LENGTH_10="MAX_LENGTH_10",e.MAX_LENGTH_64="MAX_LENGTH_64",e.MAX_LENGTH_100="MAX_LENGTH_100",e.MAX_LENGTH_128="MAX_LENGTH_128",e.MAX_LENGTH_256="MAX_LENGTH_256",e.MAX_LENGTH_1024="MAX_LENGTH_1024"}(t.RULE_PARAM_NAME||(t.RULE_PARAM_NAME={})),t.RULE_SUCCESS={error:{code:0,msg:"suc"}};var s={NOT_EMPTY:function(e,r,o,s,i){return void 0===r||""===r||null===r?(s.error(o+" "+e+" is empty"),i):t.RULE_SUCCESS},ILLEGAL_CHARACTERS:function(e,r,s,i,n){return o.ClientUtil.checkIllegalCharacters(r)?t.RULE_SUCCESS:(i.error(s+" "+e+" contains illegal characters"),n)},TYPE_STRING:function(e,r,o,s,i){return"string"!=typeof r?(s.error(o+" "+e+" must be string"),i):t.RULE_SUCCESS},TYPE_INTEGER:function(e,r,s,i,n){return o.ClientUtil.checkInteger(r,!1)?t.RULE_SUCCESS:(i.error(s+" "+e+"  must be integer number"),n)},TYPE_OBJECT:function(e,r,o,s,i){return r&&"object"==typeof r?t.RULE_SUCCESS:(s.error(o+" "+e+"  must be object"),i)},MAX_LENGTH_10:function(e,r,o,s,i){return r.length>10?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_64:function(e,r,o,s,i){return r.length>64?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_100:function(e,r,o,s,i){return r.length>100?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_128:function(e,r,o,s,i){return r.length>128?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_256:function(e,r,o,s,i){return r.length>256?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS},MAX_LENGTH_1024:function(e,r,o,s,i){return r.length>1024?(s.error(o+" "+e+" is too long"),i):t.RULE_SUCCESS}};t.checkParams=function(e,r){var o=[],i={};for(var n in e)i[e[n].order]=e[n],e[n].key=n;for(var a in i)o.push(i[a]);for(var _=0;_<o.length;_++)for(var E=o[_].rules,l=0;l<E.length;l++){var d={key:o[_].key,value:o[_].value,action:r.action,logger:r.logger},u=d.key,g=d.value,c=d.action,h=d.logger;if(E[l].name&&s[E[l].name+""]){var T=s[E[l].name+""](u,g,c,h,E[l]);if(T!=t.RULE_SUCCESS)return T}}return t.RULE_SUCCESS}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(0),s=r(5),i=r(0),n=r(1),a=function(){function e(e){this._debug=!1,this._testEnvironment=!1,this._env=0,this.debugCustom=!1,this.third_token="",this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.runState=o.ENUM_RUN_STATE.logout,this.lastRunState=o.ENUM_RUN_STATE.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=o.ENUM_NETWORK_STATE.offline,this.roomRetryTime=300,this._sdkVersion="unknown",this.logger=e}return Object.defineProperty(e.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,s.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,s.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,s.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),e.prototype.isLogin=function(){return this.runState===o.ENUM_RUN_STATE.login},e.prototype.getRequestId=function(){return this.idName+"-"+i.getSeq()},e.prototype.actionListener=function(e){for(var t=this,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];this.listenerList[e]&&this.listenerList[e].forEach((function(o){try{o.apply(void 0,r)}catch(r){t.logger.error(n.ZEGO_RTM_ACTION.STATE_ACTION+" ",e," ",JSON.stringify(r))}}))},Object.defineProperty(e.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),e}();t.StateCenter=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomModules=void 0;var o=r(13),s=r(15),i=r(16),n=r(17),a=r(18),_=r(19),E=function(){function e(e,t,r){this.stateCenter=e,this.logger=t,this.dataReport=r,this.service=new o.LiveRoomService(this.stateCenter,this.logger),this.roomHandler=new a.RoomHandler(this.logger,this.stateCenter,this.dataReport,this.service),this.heartBeatHandler=new s.HeartBeatHandler(this.logger,this.stateCenter,this.dataReport,this.service),this.userHandler=new _.UserHandler(this.logger,this.stateCenter,this.dataReport,this.service),this.messageHandler=new n.MessageHandler(this.logger,this.stateCenter,this.dataReport,this.service),this.liveHandler=new i.LiveHandler(this.logger,this.stateCenter,this.service),this.init()}return e.prototype.init=function(){this.bindSocketHandler(),this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},e.prototype.bindSocketHandler=function(){var e=this;this.service.handlePushKickout=function(t){e.roomHandler.handlePushKickout(t)},this.service.handlePushUserStateUpdateMsg=function(t){e.userHandler.handlePushUserStateUpdateMsg(t)},this.service.handlePushTransMsg=function(t){e.messageHandler.handlePushTransMsg(t)},this.service.handlePushRoomMsg=function(t){e.messageHandler.handlePushRoomMsg(t)},this.service.handlePushCustomMsg=function(t){e.messageHandler.handlePushCustomMsg(t)},this.service.handlePushMergeMsg=function(t){e.messageHandler.handlePushMergeMsg(t)},this.service.handlePushSignalMsg=function(t){e.liveHandler.handlePushSignalMsg(t)}},e.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t)}},e.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,r){e.heartBeatHandler.init(r),e.service.startCheck(),e.userHandler.loginRsp(r,t),e.messageHandler.loginRsp(r),e.roomLoginResponse(r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler.resetLiveHandler(),e.messageHandler.resetMessageInfo(),e.userHandler.resetUserHandler(),e.stateCenter.roomTryHandler&&(e.stateCenter.roomTryHandler.invalid(),e.stateCenter.roomTryHandler.stopMaxTime(),e.stateCenter.roomTryHandler=void 0)}},e.prototype.bindUserHandler=function(){},e.prototype.bindMessageHandler=function(){},e.prototype.bindLiveHandler=function(){},e.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},e.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},e}();t.LiveRoomModules=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveRoomService=void 0;var o=r(0),s=r(14),i=r(0),n=r(1),a=r(2),_=function(){function e(e,t){this.stateCenter=e,this.logger=t,this.service=new s.ZegoSocketService(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}return e.prototype.checkResponse=function(e){return e.header.appid!==this.stateCenter.appid||e.header.session_id!==this.stateCenter.sessionid||e.header.user_id!==this.stateCenter.userid||e.header.room_id!==this.stateCenter.roomid||this.stateCenter.runState!==i.ENUM_RUN_STATE.login},e.prototype.handleSendCommandMsgRsp=function(e){var t=this,r=this.service.sendCommandMap[e.header.seq];if(null!=r){var o=r._data;delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(r),0===e.body.err_code?setTimeout((function(){o&&null!=o.success&&o.success(e,t.cmdSeq)}),0):setTimeout((function(){o&&null!=o.error&&o.error(e,t.cmdSeq)}),0)}},e.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){0!==t.body.err_code?t.body.err_message&&e.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", err_code="+t.body.err_code+", err_message="+t.body.err_message+" "):e.logger.info(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+", msg="+JSON.stringify(t)+" "),["login","logout"].indexOf(t.header.cmd)>-1?e.handleSendCommandMsgRsp(t):e.stateCenter.isLogin()?e.checkResponse(t)?e.logger.error(n.ZEGO_RTM_ACTION.SERVICE_PUSH+"  check session fail."):(e.logger.info(n.ZEGO_RTM_ACTION.SERVICE_PUSH+" cmd="+t.header.cmd+",function="+!!e.responseRouters[t.header.cmd]),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq)):e.logger.warn(n.ZEGO_RTM_ACTION.SERVICE_PUSH+"  already logout")}},e.prototype.handlePushKickout=function(e){},e.prototype.handlePushCustomMsg=function(e){},e.prototype.handlePushRoomMsg=function(e){},e.prototype.handlePushUserStateUpdateMsg=function(e){},e.prototype.handlePushMergeMsg=function(e){},e.prototype.handlePushTransMsg=function(e){},e.prototype.handleBigImMsgRsp=function(e){},e.prototype.handlePushSignalMsg=function(e){},e.prototype.closeHandler=function(e){this.service.closeHandler(e)},e.prototype.openHandler=function(e){this.service.openHandler(e)},e.prototype.errorHandler=function(e){this.service.errorHandler(e)},e.prototype.getHeader=function(e){return{Protocol:"V1"===i.ROOMVERSION?"req":"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||"",room_id:this.stateCenter.roomid||"",room_session_id:this.stateCenter.roomSessionId||"",biz_version:this.stateCenter.bizVersion||""}},e.prototype.startCheck=function(){this.service.startCheck()},e.prototype.stopCheck=function(){this.service.stopCheck()},e.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},e.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters=this.responseRouters={push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)}}},e.prototype.closeSocket=function(){this.service.closeSocket()},e.prototype.sendMessage=function(e,t,r,o,s,i){if(this.service.isDisConnect())return this.logger.error(n.ZEGO_RTM_ACTION.SERVICE_SEND+" socket is disconnect"),"webrtc_url"==e&&o(a.errorCodeList.SOCKET_CLOSE),0;var _=s||this.getHeader(e);return this.logger.info(n.ZEGO_RTM_ACTION.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:_,body:t})),this.service.sendMessage(_,t,r,o)},e.prototype.on=function(e,t){this.responseRouters[e]=t},e.prototype.login=function(e,t){var r=this.getHeader("login"),s={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:this.stateCenter.token,version:this.stateCenter.sdKVersion,room_name:this.stateCenter.roomid,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?o.E_CLIENT_TYPE.ClientType_Webrtc:o.E_CLIENT_TYPE.ClientType_SmallPragram,third_token:this.stateCenter.third_token,user_count_limit:this.stateCenter.maxMemberCount,relate_service:this.stateCenter.relateService.join()||""};return this.sendMessage("",s,e,t,r)},e.prototype.logout=function(e,t){return this.sendMessage("logout",{reserve:0},e,t)},e.prototype.heartBeat=function(e,t){return this.sendMessage("hb",{reserve:0},e,t)},e.prototype.fetchUserList=function(e,t,r){return this.sendMessage("user_list",e,t,r)},e.prototype.fetchUserListV2=function(e,t,r){return this.sendMessage("user_list_v2",e,t,r)},e.prototype.fetchReliableMessage=function(e,t,r){return this.sendMessage("trans_fetch",e,t,r)},e.prototype.sendReliableMessage=function(e,t,r){return this.sendMessage("trans",e,t,r)},e.prototype.sendRoomMsg=function(e,t,r){return this.sendMessage("im_chat",e,t,r)},e.prototype.sendCustomCommand=function(e,t,r){return this.sendMessage("custommsg",e,t,r)},e.prototype.sendBigRoomMessage=function(e,t,r){return this.sendMessage("bigim_chat",e,t,r)},e.prototype.sendRelayMessage=function(e,t,r){return this.sendMessage("relay",e,t,r)},e.prototype.sendSignalCmd=function(e,t,r){return this.sendMessage("signal",e,t,r)},e}();t.LiveRoomService=_},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoSocketService=void 0;var o=r(5),s=r(0),i=r(2),n=function(){function e(e){this.socket=null,this.sendCommandList=new s.LinkedList,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}return e.prototype.createSocket=function(e){this.socket=o.createZegoWebSocket(e,this.ENV)},e.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},e.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},e.prototype.sendMessage=function(e,t,r,o,s){void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s={timeOut:6e3});var i={header:e,body:t},n={data:i,seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:s.timeOut,success:r,error:o},a=this.sendCommandList.push(n);return this.sendCommandMap[n.seq]=a,this.socket&&this.socket.send(JSON.stringify(i)),e.seq},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data&&t._data.error&&setTimeout((function(){t&&t._data&&t._data.error&&t._data.error(i.errorCodeList.TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg)}),0),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),o=Date.parse(new Date+""),s=0;!(null==r||r._data&&r._data.sendTime+r._data.timeOut>o||(r._data&&delete t[r._data.data.header.seq],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+this.sendDataDropTimeout<o||setTimeout((function(){r&&r._data&&r._data.error&&r._data.error(i.errorCodeList.TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg)}),0),++s>=this.sendDataCheckOnceCount));)r=e.getFirst()},e.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},e.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),clearTimeout(this.sendDataCheckTimer)},e.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(r){t.responseHandler(),e(r)})},e.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){var r="string"==typeof t.data?JSON.parse(t.data):JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t.data)));e.onMessage(r)})},e.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},e.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},e.prototype.onMessage=function(e){},e}();t.ZegoSocketService=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeartBeatHandler=void 0;var o=r(0),s=r(3),i=r(0),n=r(2),a=r(1),_=r(4),E=function(){function e(e,t,r,o){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null}return e.prototype.init=function(e){var t=this,r=e.body.hearbeat_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:e.body.hearbeat_interval;this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout((function(){t.start(r)}),r)},e.prototype.start=function(e){var t=this;this.logger.info(a.ZEGO_RTM_ACTION.HEARTBEAT_START+" call");var r=i.getReportSeq();if(this.dataReport.newReport(r,_.ZegoRTMLogEvent.kZegoTaskLiveRoomhHB.event),this.dataReport.addMsgInfo(r,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomhHB.room_sid(this.stateCenter.sessionid)}),!this.stateCenter.isLogin())return this.logger.error(a.ZEGO_RTM_ACTION.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(r,{error:_.ZegoRTMLogEvent.kZegoTaskLiveRoomhHB.error.NOT_LOGIN.code,message:_.ZegoRTMLogEvent.kZegoTaskLiveRoomhHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(r);if(++this.tryHeartbeatCount>3)return this.logger.error(a.ZEGO_RTM_ACTION.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(r,{error:_.ZegoRTMLogEvent.kZegoTaskLiveRoomhHB.error.HB_TIMEOUT.code,message:_.ZegoRTMLogEvent.kZegoTaskLiveRoomhHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(r),void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT);var o=function(e){if(e.body&&e.body.err_code&&0!==e.body.err_code){var o=s.ClientUtil.decodeServerError(e.body.err_code,e.body.err_message);t.dataReport.addMsgInfo(r,{error:o.code,message:o.message+e.body.err_code})}t.dataReport.uploadReport(r),t.handleHeartbeatRsp(e)};this.service.heartBeat(o,o),this.heartbeatInterval=e,this.heartbeatTimer=setTimeout((function(){t.start(t.heartbeatInterval)}),this.heartbeatInterval),this.logger.info(a.ZEGO_RTM_ACTION.HEARTBEAT_START+" call success")},e.prototype.handleHeartbeatRsp=function(e){if(e.body&&e.body.err_code&&0!==e.body.err_code)return this.logger.error(a.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.err_code),e.body.err_code==o.ERROR_CODES.ROOM_SESSION_ID_ERR?void this.hbLogout(n.errorCodeList.HEARTBEAT_TIMEOUT):void this.hbLogout(s.ClientUtil.getServerError(e.body.err_code));this.tryHeartbeatCount=0,this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<o.MINIUM_HEARTBEAT_INTERVAL&&(this.heartbeatInterval=o.MINIUM_HEARTBEAT_INTERVAL),this.heartbeatRspNotiFy(e),this.logger.info(a.ZEGO_RTM_ACTION.HEARTBEAT_HEARTBEAT_RSP+" call success")},e.prototype.heartbeatRspNotiFy=function(e){},e.prototype.hbLogout=function(e){},e.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.logger.info(a.ZEGO_RTM_ACTION.HEARTBEAT_RESET+" call success")},e}();t.HeartBeatHandler=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveHandler=void 0;var o=r(0),s=r(1),i=r(3),n=function(){function e(e,t,r){this.logger=e,this.stateCenter=t,this.service=r,this.joinLiveCallbackMap={},this.joinLiveRequestMap={}}return e.prototype.resetLiveHandler=function(){this.joinLiveCallbackMap={},this.joinLiveRequestMap={}},e.prototype.getSignalCmdContent=function(e,t,r){var o={request_id:e,room_id:this.stateCenter.roomid,from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,to_userid:t};return null!=r&&(o.result=r),JSON.stringify(o)},e.prototype.requestJoinLive=function(e,t,r,s){var i=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(i,e);return null!=s&&(this.joinLiveCallbackMap[i]=s,this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,n,e,t,r),!0)},e.prototype.sendSignalCmd=function(e,t,r,o,n){if(this.stateCenter.isLogin()){var a={sub_cmd:e,signal_msg:t,dest_id_name:[r]};this.service.sendSignalCmd(a,(function(e){o&&o(e.header.seq)}),(function(e){n&&n(i.ClientUtil.getServerError(e.body.err_code),e.header.seq)})),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" call success"+e)}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_SEND_SIGNAL+" state error")},e.prototype.inviteJoinLive=function(e,t,r,s){var i=this.stateCenter.getRequestId(),n=this.getSignalCmdContent(i,e);return null!=s&&(this.joinLiveCallbackMap[i]=s,this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,n,e,t,r),!0)},e.prototype.endJoinLive=function(e,t,r){var s=this.stateCenter.getRequestId(),i=this.getSignalCmdContent(s,e);return this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveStop,i,e,t,r),!0},e.prototype.respondJoinLive=function(e,t,r,i){var n=this.joinLiveRequestMap[e];if(!n)return this.logger.info(s.ZEGO_RTM_ACTION.LIVE_RESPOND_JOIN_LIVE+" no dest id name"),!1;var a=0;!0===t&&(a=1);var _=this.getSignalCmdContent(e,n,a);return this.sendSignalCmd(o.ENUM_SIGNAL_SUB_CMD.joinLiveResult,_,n,r,i),delete this.joinLiveRequestMap[e],!0},e.prototype.handlePushSignalMsg=function(e){var t=JSON.parse(e.body.signal_msg);switch(this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" hpsm= ",t),e.body.sub_cmd){case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case o.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvJoinLiveRequest "+r)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvJoinLiveRequest=function(e,t,r,o){this.stateCenter.actionListener("recvJoinLiveRequest",e,t,r,o)},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.joinLiveRequestMap[t]=r,this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id),this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvInviteJoinLiveRequest "+r)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no from user")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+"no requestId")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,o){this.stateCenter.actionListener("recvInviteJoinLiveRequest",e,t,r,o)},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.result;if(null!=r){var o=1==r;if(this.joinLiveCallbackMap[t]){var i=this.joinLiveCallbackMap[t];if(!i)return void this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no callback");this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" joinLiveRequest/invite result "+o),delete this.joinLiveCallbackMap[t],i(o,e.from_userid,e.from_username)}}else this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no result")}else this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"==typeof t?(this.logger.info(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error(s.ZEGO_RTM_ACTION.LIVE_PUSH_SIGNAL+" no requestId")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,r,o){this.stateCenter.actionListener("recvEndJoinLiveCommand",e,t,r,o)},e}();t.LiveHandler=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageHandler=void 0;var o=r(0),s=r(3),i=r(2),n=r(0),a=r(1),_=r(4),E=function(){function e(e,t,r,o){var s=this;this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.transSeqMap={},this.onRecvReliableMessage=function(e){var t=e.map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:e.trans_send_time}}));s.stateCenter.actionListener("roomExtraInfoUpdate",s.stateCenter.roomid,t),e.forEach((function(e){s.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)}))},this.realyMessageList=[]}return e.prototype.loginRsp=function(e){var t=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp){var r=parseFloat(e.body.ret_timestamp);this.serverTimeOffset=0==r?0:e.body.ret_timestamp-(new Date).getTime()}if(e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var o=0;o<e.body.trans_seqs.length;o++){var s=e.body.trans_seqs[o].trans_channel,i=e.body.trans_seqs[o].trans_seq_array;(i=i.filter((function(e){var r=e.trans_type,o=e.trans_seq;return!t.transSeqMap[r]||t.transSeqMap[r].seq<o}))).length>0&&this.fetchReliableMessage(s,i)}},e.prototype.sendReliableMessage=function(e,t,r,o){var n=this;this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" call"),this.transSeqMap[e]||(this.transSeqMap[e]={seq:0});var _={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"};this.service.sendReliableMessage(_,(function(t){n.transSeqMap[e].seq=t.body.trans_seq,n.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_RELIABLE+" trans "+e+" seq "+t.body.trans_seq),r({seq:t.header.seq,errorCode:0})}),(function(e){var t,r=[s.ClientUtil.getServerError(e.body.err_code),e.body.msg_id][0];n.logger.error(a.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+r.msg),t=r==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:r,o({errorCode:t.code,msg:e.body.err_message,seq:e.header.seq})}))},e.prototype.fetchReliableMessage=function(e,t){var r=this,o={trans_channel:e,fetch_array:t},s=function(e){r.handleFetchTransRsp(e)};this.service.fetchReliableMessage(o,s,s),this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_FETCH_RELIABLE+" call success")},e.prototype.handleFetchTransRsp=function(e){if(0==e.body.err_code){var t=e.body.trans_fetch_results,r=[];if(Array.isArray(t)&&t.length>0)for(var s=0;s<t.length;s++){var i=t[s];if(i.err_code!==o.ERROR_CODES.FETCH_TRANS_UNKNOWN_TYPE){var n=i.trans_type,_=i.trans_seq;i.err_code!==o.ERROR_CODES.FETCH_TRANS_WRONG_SEQ?(!this.transSeqMap[n]||this.transSeqMap[n].seq<_?(this.transSeqMap[n]={seq:_},r.push(i)):this.logger.warn(a.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq wrong"),r.length>0&&this.onRecvReliableMessage(r)):(this.logger.warn(a.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans seq is wrong "+i.err_code),this.transSeqMap[n]={seq:_})}else this.logger.warn(a.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" fetch trans unknown type "+i.err_code)}}else this.logger.error(a.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_RSP+" trans send error "+e.body.err_code)},e.prototype.handlePushTransMsg=function(e){var t=e.body.trans_type,r=e.body.trans_seq;!this.transSeqMap[t]||this.transSeqMap[t].seq<r?(this.transSeqMap[t]={seq:r},this.onRecvReliableMessage([e.body])):this.logger.warn(a.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans seq wrong"),this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_RELIABLE_PUSH+" trans "+t+" seq "+r)},e.prototype.sendRoomMsg=function(e,t,r,o,n,_){var E=this;if(!this.stateCenter.isLogin())return this.logger.error(a.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" state error"),!1;var l=Date.parse(new Date+"");if(this.sendRoomMsgTime>0&&this.sendRoomMsgTime+this.sendRoomMsgInterval>l)return this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+" freq error"),_&&_(i.errorCodeList.FREQ_LIMITED,0,e,o),!1;this.sendRoomMsgTime=l;var d={msg_category:e,msg_type:t,msg_content:o};return this.service.sendRoomMsg(d,(function(e){n({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})}),(function(e){var t,r=[s.ClientUtil.getServerError(e.body.err_code),e.body.msg_id],o=r[0],n=r[1];E.logger.error(a.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  "+o.msg),t=o==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:o,_({seq:e.header.seq,errorCode:t.code,messageID:n})})),this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_ROOM_MSG+"  call success"),!0},e.prototype.handlePushRoomMsg=function(e){var t=this,r=n.getReportSeq();this.dataReport.newReport(r),this.dataReport.addMsgInfo(r,{room_sid:_.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.room_sid(e.header.session_id)});var o=[];e.body.chat_data.forEach((function(e){var s={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id};o.push(s),t.dataReport.addMsgInfo(r,{from_msg_id:e.id_name})})),this.dataReport.uploadReport(r,_.ZegoRTMLogEvent.kZegoTaskLiveRoomGetRoomMessage.event),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.stateCenter.roomid,o),this.stateCenter.actionListener("_recvRoomMsg",e.body.chat_data,e.body.server_msg_id,e.body.ret_msg_id)},e.prototype.sendCustomCommand=function(e,t,r,o){var n=this;if(!this.stateCenter.isLogin())return this.logger.error(a.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" state error"),!1;var _={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.stateCenter.roomid},E={dest_id_name:e,custom_msg:JSON.stringify(_)};return this.service.sendCustomCommand(E,(function(e){r({seq:e.header.seq,errorCode:0})}),(function(e){var t,r=s.ClientUtil.getServerError(e.body.err_code);n.logger.error(a.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" "+r.msg),t=r==i.errorCodeList.TIMEOUT?i.errorCodeList.IM_SEND_FAILED:r,o({seq:e.header.seq,errorCode:t.code})})),this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_CUSTOM_MSG+" call success"),!0},e.prototype.handlePushCustomMsg=function(e){var t=JSON.parse(e.body.custommsg),r=[t.from_userid,t.from_username,t.room_id,t.custom_content],o=r[0],s=r[1],i=r[2],a=r[3],E=n.getReportSeq();this.dataReport.newReport(E),this.dataReport.uploadReport(E,_.ZegoRTMLogEvent.kZegoTaskLiveRoomGetCustomCommand.event),this.stateCenter.actionListener("IMRecvCustomCommand",i,{userID:o,userName:s},a)},e.prototype.sendBigRoomMessage=function(e,t,r,o,s,i){var a=this,_=this.bigimTimeWindow,E=this.serverTimeOffset,l=(new Date).getTime()+E,d=n.getSeq().toString();if(this.bigImCallbackMap[d]={success:s,error:i},0==_){var u={msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:d};this.sendBigRoomMessageInternal([u],(function(e){a.handleBigImMsgRsp(e)}),(function(e){i&&i(e)}))}else{var g=Math.floor(l/_);if(this.bigImLastTimeIndex<g&&0==this.bigIMmessageList.length){this.bigImLastTimeIndex=g;var c={msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:d};this.sendBigRoomMessageInternal([c],(function(e){a.handleBigImMsgRsp(e)}),(function(e){i&&i(e)}))}else this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:d}),1==this.bigIMmessageList.length&&this.setBigImTimer(E,_)}},e.prototype.sendBigRoomMessageInternal=function(e,t,r){var o={msgs:e};this.service.sendBigRoomMessage(o,(function(e){t(e)}),(function(e){r({seq:e.header.seq,errorCode:s.ClientUtil.getServerError(e.body.err_code).code,messageID:void 0})})),this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_BIG_MSG+" sendBigRoomMessage called")},e.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=0;t<e.body.msgs.length;t++){var r=e.body.msgs[t].bigmsg_client_id,o=e.body.msgs[t].bigmsg_id;if(this.bigImCallbackMap[r]){var s=this.bigImCallbackMap[r].success;null!=s&&s({seq:e.header.seq,errorCode:0,messageID:o}),delete this.bigImCallbackMap[r]}}},e.prototype.setBigImTimer=function(e,t){var r=this,o=t-((new Date).getTime()+e)%t,i=s.ClientUtil.generateRandumNumber(t)+o;this.bigImTimer=setTimeout((function(){r.onBigImTimer()}),i)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.serverTimeOffset;this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow);for(var r=[],o=[],s=0;s<this.bigIMmessageList.length&&!(s>=20);s++){var i=this.bigIMmessageList[s];r.push({msg_category:i.msg_category,msg_type:i.msg_type,msg_content:i.msg_content,bigmsg_client_id:i.bigmsg_client_id}),o.push(i.bigmsg_client_id)}this.bigIMmessageList.length>20?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(r,(function(t){e.handleBigImMsgRsp(t)}),(function(t,r){for(var s=0;s<o.length;s++){var i=o[s],n=e.bigImCallbackMap[i];n&&(null!=n.error&&n.error(t,r),delete e.bigImCallbackMap[i])}})),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,this.bigIMmessageList.length>0&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},e.prototype.handlePushMergeMsg=function(e){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body)},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn(a.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"parse json error")}if(t){for(var r=t.room_id,o=[],s=0;s<t.msg_data.length;s++){var i=t.msg_data[s];i.id_name!=this.stateCenter.idName?o.push({idName:i.id_name,nickName:i.nick_name,messageId:i.bigmsg_id,category:i.msg_category,type:i.msg_type,content:i.msg_content,time:i.send_time}):this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" self message")}0==o.length?this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" no other pushData except self"):this.onRecvBigRoomMessage(o,r),this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+"call success")}else this.logger.warn(a.ZEGO_RTM_ACTION.MESSAGE_BIG_MSG_PUSH+" cann't find message body")},e.prototype.onRecvBigRoomMessage=function(e,t){var r=n.getReportSeq();this.dataReport.newReport(r);var o=[];e.forEach((function(e){var t={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId};o.push(t)})),this.dataReport.uploadReport(r,_.ZegoRTMLogEvent.kZegoTaskLiveGetRoomBigIM.event),this.stateCenter.actionListener("IMRecvBarrageMessage",t,o),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},e.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},e.prototype.sendRelayMessage=function(e,t,r,o){var s=this.datiTimeWindow,i=this.serverTimeOffset;s>0?(this.realyMessageList.push({type:e,data:t,success:r,error:o}),1==this.realyMessageList.length&&this.setRelayTimer(i,s)):this.sendRelayMessageInternal(e,t,r,o)},e.prototype.sendRelayMessageInternal=function(e,t,r,o){this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" call");var i={relay_type:e,relay_data:t};this.service.sendRelayMessage(i,(function(e){r&&r(e.header.seq,e.body.relay_result)}),(function(e){o&&o(s.ClientUtil.getServerError(e.body.err_code),e.header.seq)}))},e.prototype.setRelayTimer=function(e,t){var r=this,o=2*t-((new Date).getTime()+e)%t,i=s.ClientUtil.generateRandumNumber(o);this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+" setTimer "+i),this.relayTimer=setTimeout((function(){r.onRelayTimer()}),i)},e.prototype.onRelayTimer=function(){if(0!=this.realyMessageList.length){var e=this.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),this.realyMessageList.length>0&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow)}else this.logger.info(a.ZEGO_RTM_ACTION.MESSAGE_SEND_RELAY_MSG+"  no relay data")},e}();t.MessageHandler=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RoomHandler=void 0;var o=r(0),s=r(3),i=r(0),n=r(1),a=r(2),_=r(4),E=function(){function e(e,t,r,o){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4}return e.prototype.setRunState=function(e){this.stateCenter.lastRunState=this.stateCenter.runState,this.stateCenter.runState=e},e.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},e.prototype.resetRoom=function(){var e=this;if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call"),this.resetTryLogin(),"0"!==this.stateCenter.sessionid&&this.stateCenter.runState!==o.ENUM_RUN_STATE.logout){var t=function(t){e.handleLogoutRsp(t)};this.service.logout(t,t)}this.setRunState(o.ENUM_RUN_STATE.logout),this.stateCenter.userid="",this.stateCenter.sessionid="",this.stateCenter.roomSessionId="",this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.sessionid,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.service.closeSocket(),this.resetRoomCallBack(),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_RESET_ROOM+" call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.handlePushKickout=function(e){var t=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+"  call "+JSON.stringify(e));var r=i.getReportSeq();this.dataReport.newReport(r,_.ZegoRTMLogEvent.kZegoTaskKickout.event),this.dataReport.addMsgInfo(r,{user_id:_.ZegoRTMLogEvent.kZegoTaskKickout.user_id(this.stateCenter.idName)});var E=s.ClientUtil.getKickoutError(e.body.reason);this.dataReport.addMsgInfo(r,{error:E.code,message:E.message}),this.dataReport.uploadReport(r);var l=this.stateCenter.roomTryHandler;if(l)if(l.onactive=function(e,r){t.disconnectedHandle(r),t.stateCenter.actionListener("_kickout",r)},e.body.need_relogin&&1==e.body.need_relogin)this.stateCenter.sessionid="",l.startMaxTime(),l.active();else{this.resetRoom();var d={};e&&e.body.custom_reason?d.custom_kickout_message=e.body.custom_reason:E.name&&a.errorCodeList[E.name]&&(d.custom_kickout_message=a.errorCodeList[E.name].msg+" kickout，reason: "+e.body.reason),E.name&&a.errorCodeList[E.name]?this.disconnectedHandle(a.errorCodeList[E.name],JSON.stringify(d)):this.disconnectedHandle(a.errorCodeList.ROOM_INNER_ERROR,JSON.stringify(d)),this.stateCenter.actionListener("_kickout",{code:o.sdkErrorList.KICK_OUT.code,msg:o.sdkErrorList.KICK_OUT.msg+e.body.reason})}else this.logger.info(n.ZEGO_RTM_ACTION.ROOM_KICK_OUT+" try handler no found")},e.prototype.handleHbLogout=function(e){var t=this,r=this.stateCenter.roomTryHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},e==a.errorCodeList.HEARTBEAT_TIMEOUT||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")?(r.startMaxTime(),r.active()):(r.stopMaxTime(),r.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},e.prototype.onDisconnect=function(e){var t=this;if(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code)this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg});else if("number"==typeof e.code){var r;(r=e.code<2e9&&e.code>1e9||e.code<1e6?s.ClientUtil.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:r.code,message:r.message})}this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,s.ClientUtil.unregisterCallback(_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.stateCenter.reportList);var o=this.stateCenter.roomTryHandler;o?(o.onactive=function(e,r){r&&0!==r.code?t.roomStateHandle("DISCONNECTED",r):t.roomStateHandle("CONNECTED",r)},o.startMaxTime(),o.active()):this.logger.error(n.ZEGO_RTM_ACTION.ROOM_DISCONNECT+" try handler no found")},e.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",e)},e.prototype.disconnectedHandle=function(e,t){e&&0!==e.code?this.roomStateHandle("DISCONNECTED",e,t):this.roomStateHandle("CONNECTED",e,t)},e.prototype.roomStateHandle=function(e,t,r){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(t)),this.stateCenter.lastRoomState=this.stateCenter.roomState,this.stateCenter.roomState=e,this.stateCenter.roomState!==this.stateCenter.lastRoomState&&(this.stateCenter.actionListener("roomStateUpdate",this.stateCenter.roomid,e,t?t.code:0,r),this.stateCenter.actionListener("_roomStateUpdate",this.stateCenter.roomid,e,t?t.code:0,r))},e.prototype.login=function(e,t,r,E,l,d,u){if(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call:",t,r),this.logger.setSessionInfo(this.stateCenter.appid,t,"",E.userID,"",this.stateCenter.sdKVersion),l&&(l.userUpdate&&"boolean"==typeof l.userUpdate&&(this.stateCenter.userStateUpdate=l.userUpdate),l.maxMemberCount&&"number"==typeof l.maxMemberCount&&(this.stateCenter.maxMemberCount=l.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" init sdk wrong"),void u(a.errorCodeList.INIT);if(this.stateCenter.runState!==o.ENUM_RUN_STATE.trylogin&&this.setRunState(o.ENUM_RUN_STATE.trylogin),this.stateCenter.roomid=t,this.stateCenter.token=r,this.stateCenter.third_token=r,this.stateCenter.idName=E.userID,this.stateCenter.nickName=E.userName||E.userID,s.ClientUtil.registerCallback("login",{success:d,error:u},this.stateCenter.callbackList),0===this.stateCenter.reportSeqList.login){var g=i.getReportSeq();this.stateCenter.reportSeqList.relogin=g,this.dataReport.newReport(g,_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event),s.ClientUtil.logReportCallback(_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event,this.dataReport,g,this.stateCenter.reportList)}this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGIN_ROOM+" call success")},e.prototype.tryLogin=function(e){var t=this;if(this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin){var r=0!==this.stateCenter.reportSeqList.login?_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" new websocket"),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&(this.tryLoginCount>1&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler((function(){t.openHandler()})),this.service.closeHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" close "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)})),this.service.errorHandler((function(e){t.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" error "+JSON.stringify(e.code?e.code:e)),t.service.closeSocket(),t.closeHandler(e)}))}catch(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" use current websocket and sent login"),s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var a=function(e,r){t.handleLoginRsp(e,r)};this.service.login(a,a)}this.tryLoginTimer=setTimeout((function(){t.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" over time no response, login timeout"),s.ClientUtil.actionErrorCallback("login",t.stateCenter.callbackList)(o.sdkErrorList.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_TRY_LOGIN+" call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.openHandler=function(){var e=this;this.logger.info(n.ZEGO_RTM_ACTION.ROOM_OPEN_HANDLER+" websocket.onpen call");var t=0!==this.stateCenter.reportSeqList.login?_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(i.REPORT_ACTION.eventEndWithMsgInfo,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(t,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var r=function(t,r){e.handleLoginRsp(t,r)};this.service.login(r,r)},e.prototype.handleLoginRsp=function(e,t){var r=0!==this.stateCenter.reportSeqList.login?_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;if(s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(r,this.stateCenter.reportList)(i.REPORT_ACTION.eventEndWithMsgInfo,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin){if(e.header.seq===t)return 0!==e.body.err_code?(this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" server error=",e.body.err_code),void this.handleLoginFail(e)):(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" call success."),void this.handleLoginSuccess(e));this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq)}else this.logger.error(n.ZEGO_RTM_ACTION.ROOM_HANDLE_LOGINRSP+" state error")},e.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=s.ClientUtil.getServerError(e.body.err_code);s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(t,!0)},e.prototype.handleLoginSuccess=function(e){var t={},r=this.stateCenter.lastRunState;this.setRunState(o.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.stateCenter.sessionid=e.body.session_id,this.stateCenter.roomSessionId=e.body.room_session_id,this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.sessionid,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),e.body.config_info&&(this.logger.setRemoteLogLevel(e.body.config_info.log_level),t.log_level=e.body.config_info.log_level,""!=e.body.config_info.log_url&&(this.logger.setLogServer(e.body.config_info.log_url),t.log_url=e.body.config_info.log_url)),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,t.test_environment="true",!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0));var n=0!==this.stateCenter.reportSeqList.login?_.ZegoRTMLogEvent.kZegoTaskLoginRoom.event:_.ZegoRTMLogEvent.kZegoTaskReLoginRoom.event;s.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(n,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.event,_.ZegoRTMLogEvent.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),t),this.resetTryLogin(),this.loginSuccessCallBack(r,e),s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)&&s.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0),this.roomStateHandle("CONNECTED",{code:0,msg:""})},e.prototype.closeHandler=function(e){this.logger.error(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code?e.code:e)),this.stateCenter.runState!==o.ENUM_RUN_STATE.logout?this.stateCenter.runState===o.ENUM_RUN_STATE.trylogin?(this.resetTryLogin(),s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(1006==e.code?o.sdkErrorList.LOGIN_TIMEOUT:e)):this.stateCenter.runState===o.ENUM_RUN_STATE.login&&(this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(o.sdkErrorList.LOGIN_DISCONNECT)):this.logger.info(n.ZEGO_RTM_ACTION.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},e.prototype.logout=function(){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call"),this.stateCenter.runState!==o.ENUM_RUN_STATE.logout?(this.resetRoom(),this.roomStateHandle("DISCONNECTED",{code:0,msg:""}),this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+" call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.handleLogoutRsp=function(e){this.logger.info(n.ZEGO_RTM_ACTION.ROOM_LOGOUT+"result=",e.body&&e.body.err_code?e.body.err_code:"")},e}();t.RoomHandler=E},function(e,t,r){"use strict";var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var o=Array(e),s=0;for(t=0;t<r;t++)for(var i=arguments[t],n=0,a=i.length;n<a;n++,s++)o[s]=i[n];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.UserHandler=void 0;var s=r(0),i=r(3),n=r(0),a=r(1),_=r(4),E=function(){function e(e,t,r,o){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.userList=[],this.userSeqMergeMap={},this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}return e.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.stateCenter.roomid,e.body.online_count),this.logger.info(a.ZEGO_RTM_ACTION.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(t)},e.prototype.patchUserList=function(e){var t=this;if(e.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap){var r=this.lastUserQueryTime-Date.now();this.logger.info(a.ZEGO_RTM_ACTION.USER_HB_PATCH+" call update user "+this.userSeq+" server "+e.body.server_user_seq+" wait "+r),r>0?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout((function(){t.fetchUserList()}),r)):this.fetchUserList()}null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.stateCenter.roomid,e.body.online_count)},e.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},e.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(a.ZEGO_RTM_ACTION.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(a.ZEGO_RTM_ACTION.USER_FETCH_USER+" the first time call"))},e.prototype.fetchUserListWithPage=function(e,t){var r=this,o=function(e){r.handleFetchUserListRsp(e,t)};"V1"===s.ROOMVERSION?this.service.fetchUserList({user_index:e,sort_type:0},o,o):this.service.fetchUserListV2({marker:0===e?"":e+"",mode:0,limit:100},o,o)},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(0!=e.body.err_code)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(a.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch error "+e.body.err_code);if(this.stateCenter.userStateUpdate){this.userTempList=o(this.userTempList,e.body.user_baseinfos);var n=e.body.ret_user_index;if(n!=e.body.server_user_index)return this.logger.info(a.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(n+1,t);this.userSeq=e.body.server_user_seq;for(var _=[],E=[],l=0;l<this.userTempList.length;l++){var d={userID:this.userTempList[l].id_name,userName:this.userTempList[l].nick_name};_.push(d),E.push({idName:this.userTempList[l].id_name,nickName:this.userTempList[l].nick_name,role:this.userTempList[l].role})}this.stateCenter.actionListener("_getTotalUserList",this.stateCenter.roomid,E),t==s.ENUM_RUN_STATE.login?(this.userList&&i.ClientUtil.mergeUserList(this.logger,this.userList,_,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.stateCenter.roomid,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.stateCenter.roomid,"DELETE",t)})),this.userList=_):(this.userList=_,0!==_.length&&this.onUserStateUpdate(this.stateCenter.roomid,"ADD",_)),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(a.ZEGO_RTM_ACTION.USER_FETCH_USER_RSP+" call success user_list "+_+" count "+_.length)}},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(a.ZEGO_RTM_ACTION.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq!==e.body.user_list_seq)if(this.userSeq+e.body.user_actions.length===e.body.user_list_seq){this.userSeq=e.body.user_list_seq;for(var t=[],r=0;r<e.body.user_actions.length;r++){var o={action:e.body.user_actions[r].Action,idName:e.body.user_actions[r].IdName,nickName:e.body.user_actions[r].NickName,role:e.body.user_actions[r].Role,loginTime:e.body.user_actions[r].LoginTime};t.push(o)}this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,t);var s=[],i=[];t.forEach((function(e){1==e.action?s.push({userID:e.idName,userName:e.nickName}):2==e.action&&i.push({userID:e.idName,userName:e.nickName})})),this.userList&&(this.userList=this.userList.concat(s).filter((function(e){return!i.some((function(t){return t.userID==e.userID}))}))),0!==s.length&&this.onUserStateUpdate(e.body.room_id,"ADD",s),0!==i.length&&this.onUserStateUpdate(e.body.room_id,"DELETE",i),this.logger.info(a.ZEGO_RTM_ACTION.USER_USER_PUSH+" call success")}else this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else this.logger.warn(a.ZEGO_RTM_ACTION.USER_USER_PUSH+" user_list_seq is the same with local seq");else this.logger.info(a.ZEGO_RTM_ACTION.USER_USER_PUSH+" userStateUpdate is false")},e.prototype.onUserStateUpdate=function(e,t,r){var o=this,s=n.getReportSeq();this.dataReport.newReport(s,_.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.event);var i=r.filter((function(e){return e.userID!==o.stateCenter.idName}));0!==i.length&&this.stateCenter.actionListener("roomUserUpdate",e,t,i),this.dataReport.addMsgInfo(s,{user_update_type:"ADD"==t?_.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("added"):_.ZegoRTMLogEvent.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("deleted")}),this.dataReport.uploadReport(s)},e.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.userSeqMergeMap||(this.logger.warn(a.ZEGO_RTM_ACTION.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){var e=Object.keys(r.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));if(e[e.length-1]-e[0]+1===e.length)r.mergeUser(e);else{r.userSeqMergeMap=null;var t=r.lastUserQueryTime-Date.now();r.logger.info(a.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  fetch merge userlist "+r.userSeq+" userSeqList "+e.join(",")+" wait "+t),t>0?(r.userQueryTimer&&clearTimeout(r.userQueryTimer),r.userQueryTimer=setTimeout((function(){r.fetchUserList()}),t)):r.fetchUserList()}}),this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(a.ZEGO_RTM_ACTION.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},e.prototype.mergeUser=function(e){var t=this;this.logger.info(a.ZEGO_RTM_ACTION.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1];var r={};e.forEach((function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach((function(e){r[e.IdName]=e}))})),this.userSeqMergeMap=null;var o=Object.values(r).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}}));o.sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)}));var s=[],i=[];o.forEach((function(e){1==e.action?s.push({userID:e.idName,userName:e.nickName}):2==e.action&&i.push({userID:e.idName,userName:e.nickName})})),this.userList=this.userList&&this.userList.concat(s).filter((function(e){return!i.some((function(t){return t.userID==e.userID}))})),0!==s.length&&this.onUserStateUpdate(this.stateCenter.roomid,"ADD",s),0!==i.length&&this.onUserStateUpdate(this.stateCenter.roomid,"DELETE",i),this.stateCenter.actionListener("_userStateUpdate",this.stateCenter.roomid,o)},e}();t.UserHandler=E}])},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=t.innerErrList=void 0,t.innerErrList={SUCCESS:{code:0,message:""},SEND_MSG_TIMEOUT:{code:"Error.Timeout",message:"send customessage timeout."}},t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},STREAMID_TOO_LONG:{code:1000014,message:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,message:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,message:"network is broken"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},GET_SOUND_LEVEL_FAIL:{code:1000019,message:"get sound level error"},INPUT_PARAM:{code:1100001,message:"input parm error."},TIMEOUT:{code:1100002,message:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},INIT_SDK_WRONG:{code:1101e3,message:"init sdk wrong"},WX_GETSETTING_FAIL:{code:1101001,message:"wx getsetting fail"},USER_ID_NULL:{code:1002005,message:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,message:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,message:"user ID is too long"},USER_NAME_NULL:{code:1002008,message:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,message:"username is too long"},ROOM_ID_NULL:{code:1002011,message:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,message:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,message:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,message:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,message:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,message:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,message:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,message:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,message:"parse json error."},LOGIN_PROCESSING:{code:1102012,message:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,message:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,message:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,message:"user login state is wrong."},TOKEN_ERROR:{code:1102016,message:"token error"},DISPATCH_ERROR:{code:1102017,message:"dispatch error"},TOKEN_EXPIRED:{code:1102018,message:"token expired"},SUBCMD_ERROR:{code:1102019,message:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,message:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},DISPATCH_TIMEOUT:{code:1102022,message:"dispatch request timeout"},CONNECT_FAILED:{code:1102023,message:"connect signal fail"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publshing stream is null"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,message:"input parm error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:"ice connection error"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:"negotiation timeout"},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,message:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},REPEATED_PULL:{code:1103049,message:"repeated pull same stream"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:"websocket disconnected"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:"publisher retry timeout"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:"https is required"},PUBLISHER_NO_PREVIEW:{code:1103054,message:"no preview"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:"publish is publishing"},PUBLISHER_DECODE_AUDIO_FAIL:{code:1103057,message:"decode audio data fail"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:"client ip changed"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:"ttl over time"},PLAYER_PARAM:{code:1104001,message:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,message:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:"ice connection error"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:"websocket disconnected"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:"negotiation timeout"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:"player retry timeout"},PLAYER_IS_PLAYING:{code:1104032,message:"player is playing"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:"client ip changed"},PLAYER_TTL_OVERTIME:{code:1104034,message:"ttl is over time"},PLAYER_SESSION_RESET:{code:1104035,message:"reset session push"},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOPMIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:"stream input parameters are wrong"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_INNER_ERROR:{code:1005099,message:"mixed stream internal error"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,message:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,message:"message content is too long"},IM_SEND_FAILED:{code:1009010,message:"failed to send message"},FREQ_LIMITED:{code:1109001,message:"frequency limited."}}},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressEngine=void 0;var i=r(4),n=r(7),a=function(e){function t(t,r){var o=this;return i.ZegoExpressWebRTMEngine.version="2.2.1",(o=e.call(this,t,r,1)||this).zegoWechatMini=new n.ZegoWechatMini(o.logger,o.dataReport,o.zegoWebRTM),o}return s(t,e),t.prototype.checkSystemRequirements=function(){return this.zegoWechatMini.checkSystemRequirements()},t.prototype.getNextUrl=function(e){return this.zegoWechatMini.getNextUrl(e)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.off(e,t)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.on(e,t)},t.prototype.setMixerTaskConfig=function(e){return this.zegoWechatMini.setMixerTaskConfig(e)},t.prototype.startMixerTask=function(e){return this.zegoWechatMini.startMixerTask(e)},t.prototype.startPlayingStream=function(e,t){return this.zegoWechatMini.startPlayingStream(e,t)},t.prototype.stopMixerTask=function(e){return this.zegoWechatMini.stopMixerTask(e)},t.prototype.stopPlayingStream=function(e){return this.zegoWechatMini.stopPlayingStream(e)},t.prototype.updatePlayerNetStatus=function(e,t){return this.zegoWechatMini.updatePlayerNetStatus(e,t)},t.prototype.updatePlayerState=function(e,t){return this.zegoWechatMini.updatePlayerState(e,t)},t.prototype.startPublishingStream=function(e,t){return this.zegoWechatMini.startPublishingStream(e,t)},t.prototype.stopPublishingStream=function(e){return this.zegoWechatMini.stopPublishingStream(e)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.addPublishCdnUrl(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.removePublishCdnUrl(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWechatMini.setStreamExtraInfo(e,t)},t}(i.ZegoExpressWebRTMEngine);t.ZegoExpressEngine=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatMini=void 0;var o=r(2),s=r(8),i=r(0),n=r(1),a=r(3),_=r(9),E=function(){function e(e,t,r){this.logger=e,this.dataReport=t,this.rtm=r,this.stateCenter=new s.StateCenter(this.logger),this.stateCenter.clientType="wxMini",this.wechatMiniModules=new _.WechatMiniModules(this.logger,this.dataReport,this.stateCenter,this.rtm)}return e.prototype.checkSystemRequirements=function(){return this.wechatMiniModules.checkSystemRequirements()},e.prototype.getVersion=function(){return i.PROTO_VERSION},e.prototype.on=function(e,t){return this.wechatMiniModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.wechatMiniModules.deleteListener(e,t)},e.prototype.startPublishingStream=function(e,t){return this.wechatMiniModules.publishModule.startPublishingStream(e,t)},e.prototype.stopPublishingStream=function(e){return this.wechatMiniModules.publishModule.stopPublishingStream(e)},e.prototype.getNextUrl=function(e){return this.wechatMiniModules.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" call: "+JSON.stringify(e)),!e||0==e.length)return this.logger.error(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" param error"),!1;var r=!0;e.forEach((function(e){return 0!=e.indexOf("rtmp://")&&(r=!1)})),r?t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e:this.logger.error(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" url is not correct")},e.prototype.addPublishCdnUrl=function(e,t){return this.logger.info(o.ZEGO_WECHATMINI_ACTION.ADD_PUBLISH_CDN_URL+" call "+e+" "+t),this.wechatMiniModules.streamHandler.publishTarget({type:"addpush",streamID:e,pushUrl:t})},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info(o.ZEGO_WECHATMINI_ACTION.REMOVE_PUBLISH_CDN_URL+" call "+e+" "+t),this.wechatMiniModules.streamHandler.publishTarget({type:"delpush",streamID:e,pushUrl:t})},e.prototype.startMixerTask=function(e){var t=this;return new Promise((function(r,o){e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var s=i.getReportSeq();t.dataReport.newReport(s,n.ZegoWechatLogEvent.kZegoTaskMixStart.event),a.ClientUtil.logReportCallback("kZegoTaskMixStart"+e.taskID,t.dataReport,s,t.stateCenter.reportList);t.wechatMiniModules.streamHandler.updateMixStream(e,(function(o){t.dataReport.uploadReport(s),a.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),r(o)}),(function(r){var i,n;r.errorCode<2e9&&r.errorCode>1e9?(a.ClientUtil.mixServerError(r.errorCode)[0],i=a.ClientUtil.mixServerError(r.errorCode)[1],n=a.ClientUtil.mixServerError(r.errorCode)[1]):r.errorCode<1e6&&(n=a.ClientUtil.decodeServerError(r.errorCode,r.extendedData),i=a.ClientUtil.getLiveRoomError(r.errorCode)),n?t.dataReport.addMsgInfo(s,n):t.dataReport.addMsgInfo(s,r),t.dataReport.uploadReport(s),a.ClientUtil.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),i&&(r.errorCode=errorCodeList[i].code),o(r)}))}))},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,o){var s=i.getReportSeq();t.dataReport.newReport(s,n.ZegoWechatLogEvent.kZegoTaskMixConfig.event),a.ClientUtil.logReportCallback("kZegoTaskMixConfig",t.dataReport,s,t.stateCenter.reportList),t.wechatMiniModules.streamHandler.setMixerTaskConfig(e).then((function(e){t.dataReport.uploadReport(s),a.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),r(e)})).catch((function(e){t.dataReport.addMsgInfo(s,e),t.dataReport.uploadReport(s),a.ClientUtil.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),o(e)}))}))},e.prototype.stopMixerTask=function(e){var t=this;return new Promise((function(r,s){var _=i.getReportSeq();if(t.dataReport.newReport(_,n.ZegoWechatLogEvent.kZegoTaskMixStop.event),!e||"string"!=typeof e||e.length>i.MAX_MIX_TASK_ID_LENGTH||!a.ClientUtil.checkIllegalCharacters(e))return t.logger.error(o.ZEGO_WECHATMINI_ACTION.STOP_MIXER_TASK+" taskID must be string less 256"),t.dataReport.addMsgInfo(_,{error:n.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.code,message:n.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"}),t.dataReport.uploadReport(_),void s({errorCode:n.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:n.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});t.wechatMiniModules.streamHandler.stopMixStream(e,(function(e){t.dataReport.uploadReport(_),r(e)}),(function(e){var r,o;e.errorCode<2e9&&e.errorCode>1e9?(a.ClientUtil.mixServerError(e.errorCode-i.MIXSTREAM_ERROR_CODE)[0],o=a.ClientUtil.mixServerError(e.errorCode-i.MIXSTREAM_ERROR_CODE)[1],r=a.ClientUtil.mixServerError(e.errorCode-i.MIXSTREAM_ERROR_CODE)[1]):e.errorCode<1e6&&(r=a.ClientUtil.decodeServerError(e.errorCode,e.extendedData),o=a.ClientUtil.getLiveRoomError(e.errorCode)),r?t.dataReport.addMsgInfo(_,r):t.dataReport.addMsgInfo(_,e),t.dataReport.uploadReport(_),o&&(e.errorCode=errorCodeList[o].code),s(e)}))}))},e.prototype.setStreamExtraInfo=function(e,t){return this.wechatMiniModules.streamHandler.setStreamExtraInfo(e,t)},e.prototype.startPlayingStream=function(e,t){return this.wechatMiniModules.playModule.startPlayingStream(e,t)},e.prototype.stopPlayingStream=function(e){this.wechatMiniModules.playModule.stopPlayingStream(e)},e.prototype.updatePlayerState=function(e,t){this.wechatMiniModules.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.wechatMiniModules.updatePlayerNetStatus(e,t)},e}();t.ZegoWechatMini=E},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(2),s=r(0),i=function(){function e(e){this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.streamQuerying=!1,this.streamSeq=0,this.streamList=[],this.publishStreamList={},this.isResetRoom=!1,this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.mixStreamAdvance={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=s.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamInfoList={},this.clientIP="",this.logger=e}return e.prototype.getRequestId=function(){return this.idName+"-"+s.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r){var o={request_id:e,room_id:this.roomid,from_userid:this.idName,from_username:this.nickName,to_userid:t};return null!=r&&(o.result=r),JSON.stringify(o)},e.prototype.actionListener=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];this.listenerList[e]&&this.listenerList[e].forEach((function(s){try{setTimeout((function(){s.apply(void 0,r)}),0)}catch(r){t.logger.error(o.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+" "+e+" "+r)}}))},e}();t.StateCenter=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WechatMiniModules=void 0;var o=r(10),s=r(13),i=r(14),n=r(15),a=r(0),_=r(1),E=r(3),l=r(2),d=function(){function e(e,t,r,_){this.logger=e,this.dataReport=t,this.stateCenter=r,this.rtm=_,this.currentPlaySourceType=a.ENUM_DISPATCH_TYPE.cdn,this.mixStreamList={},this.ultraPlaySourceType="rtmp_v2",this.streamCenter=new o.ZegoStreamCenterWechat(this.logger,this.stateCenter,this.dataReport),this.streamHandler=new s.StreamHandler(this.logger,this.stateCenter,this.rtm,this.dataReport,this.streamCenter),this.publishModule=new i.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.streamHandler,this.rtm),this.playModule=new n.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.init()}return e.prototype.init=function(){this.bindRTMListener(),this.bindStreamHandler(),this.bindStreamCenterHandler()},e.prototype.bindRTMListener=function(){var e=this;this.rtm._on("roomLoginResponse",(function(t){e.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+" roomLoginResponse call "),e.stateCenter.appid=e.rtm.getAppID(),e.stateCenter.idName=e.rtm.getUserID(),e.stateCenter.token=e.rtm.getToken(),e.stateCenter.testEnvironment=e.rtm.isTestEnvironment(),e.stateCenter.sessionid=e.rtm.getSessionId(),e.streamHandler.handleStreamStart(t),e.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+" roomLoginResponse end")})),this.rtm._on("HBResponse",(function(t){e.streamHandler.fetchStreamList(t)})),this.rtm._on("_roomStateUpdate",(function(t,r,o,s){"DISCONNECTED"==r?(e.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+" _roomStateUpdate "+t+" disconnected "+o?o+" ":""+s?s:""),e.stateCenter.isResetRoom=!0,e.stateCenter.streamList=[],e.streamCenter.reset()):e.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+" _roomStateUpdate "+t+" state")}))},e.prototype.bindStreamHandler=function(){var e=this;this.streamHandler.onStreamUpdated=function(t,r,o){var s=o.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),i=a.getReportSeq();if(e.dataReport.newReport(i,_.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),e.dataReport.addMsgInfo(i,{stream_update_type:_.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(1===r?"added":"deleted"),update_stream:_.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(o)}),e.dataReport.uploadReport(i),e.stateCenter.actionListener("roomStreamUpdate",t,E.ClientUtil.getSteamUpdateType(r),s),1===r){var n=[];s.forEach((function(e){e.extraInfo&&n.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),n.length>0&&e.stateCenter.actionListener("streamExtraInfoUpdate",t,n)}},this.streamHandler.onPublishStateUpdate=function(t,r,o){e.logger.info(l.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE+" "+r);var s=e.stateCenter.reportSeqList.startPublish[r];e.streamCenter.publishingList[r]&&(0==t||1==t)&&s&&(e.dataReport.eventEndWithMsgInfo(s,"PublishState",{type:t}),1==t&&e.dataReport.addMsgInfo(s,o),e.dataReport.uploadReport(s),delete e.stateCenter.reportSeqList.startPublish[r]),e.stateCenter.actionListener("publisherStateUpdate",{state:E.ClientUtil.getPublisherStateType(t),streamID:r,errorCode:o.code,extendedData:o.message})},this.streamHandler.onStreamExtraInfoUpdated=function(t,r){var o=r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),s=a.getReportSeq();e.dataReport.newReport(s,_.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),e.dataReport.addMsgInfo(s,{update_stream:_.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(o)}),e.dataReport.uploadReport(s),e.stateCenter.actionListener("streamExtraInfoUpdate",t,o)}},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,o){var s=e.stateCenter.reportSeqList.startPlay[r];e.streamCenter.playingList[r]&&(0==t||1==t)&&s&&(e.dataReport.eventEndWithMsgInfo(s,"PlayState",{type:t}),1==t&&o&&e.dataReport.addMsgInfo(s,o),e.dataReport.uploadReport(s),delete e.stateCenter.reportSeqList.startPlay[r]),e.stateCenter.actionListener("playerStateUpdate",{state:E.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:o&&o.code,extendedData:o&&o.message})},this.streamCenter.onPublishStateUpdate=function(t,r,o){e.onPublishStateUpdateHandle(t,r,o)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)}},e.prototype.onPublishStateUpdateHandle=function(e,t,r){this.logger.info(l.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE_HANDLE+" call"),0==e?this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].state!=a.ENUM_PUBLISH_STREAM_STATE.tryPublish||this.stateCenter.streamList.find((function(e){return e.stream_id==t}))?(this.stateCenter.publishStreamList[t].state=a.ENUM_PUBLISH_STREAM_STATE.publishing,this.streamHandler.onPublishStateUpdate(e,t,r),this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],E.ClientUtil.unregisterCallback("kZegoTaskPublishStart"+t,this.stateCenter.reportList)):(this.stateCenter.publishStreamList[t].state=a.ENUM_PUBLISH_STREAM_STATE.update_info,this.streamHandler.updateStreamInfo(t,a.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info))):(this.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info(l.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE_HANDLE+" stop publish called by sdk"),this.publishModule.stopPublishingStream(t)))},e.prototype.bindListener=function(e,t){return this.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+" call"),this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+" listener callBack must be function"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+" event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(this.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_DELETE_LISTENER+" call"),!this.stateCenter.listenerList[e])return this.logger.error(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_DELETE_LISTENER+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.checkSystemRequirements=function(){var e=this;return new Promise((function(t,r){var o=a.getReportSeq();e.dataReport.newReport(o,_.ZegoWechatLogEvent.kZegoTaskCheckSystemRequirements.event);E.ClientUtil.isSupportLive((function(r){e.dataReport.addMsgInfo(o,{check_system:r}),e.dataReport.uploadReport(o),t(r)}),(function(t){e.dataReport.addMsgInfo(o,_.ZegoWechatLogEvent.kZegoTaskCheckSystemRequirements.error.kCheckSystemGetSettingFailError),e.dataReport.uploadReport(o),r(t)}))}))},e.prototype.updatePlayerState=function(e,t){this.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_STATE+" call "+e),this.streamCenter.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_NET_STATUS+" call "+e),this.streamCenter.updatePlayerNetStatus(e,t)},e.prototype.getNextUrl=function(e){return"string"!=typeof e||""==e?(this.logger.error(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_GET_NEXT_URL+" stream ID must be string and not empty"),""):this.streamCenter.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" call: "+JSON.stringify(e)),!e||0==e.length)return this.logger.error(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" param error"),!1;var r=!0;e.forEach((function(e){return 0!=e.indexOf("rtmp://")&&(r=!1)})),r?t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e:this.logger.error(l.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" url is not correct")},e}();t.WechatMiniModules=d},function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenterWechat=void 0;var i=r(2),n=r(11),a=r(0),_=r(1),E=r(3),l=r(12),d=0,u=1,g=2,c=0,h=1,T=function(e){function t(t,r,o){var s=e.call(this)||this;return s.playerList={},s.playerCount=0,s.playingList=[],s.publishingList=[],s.eventSeq=0,s.streamEventMap={},s.streamReportMap={},s.playerWaitingList=[],s.playerStatistics={},s.publishSuccessCallBackList={},s.publishErrorCallBackList={},s.playSuccessCallBackList={},s.playErrorCallBackList={},s.logger=t,s.dataReport=o,s.stateCenter=r,s}return s(t,e),t.prototype.updatePlayingState=function(e,t,r){if(this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE+" "+e),null==e)return!1;if(r){var o=this.playerList[e],s=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(s,"updatePlayingState"),o)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE+" player already exist"),this.dataReport.eventEndWithMsgInfo(s,"updatePlayingState",{message:"player already exist"}),this.dataReport.uploadReport(s,void 0),delete this.stateCenter.reportSeqList.startPlay[e],!1;this.playerList[e]=new l.ZegoPlayWechat(this.logger,e,this,this.dataReport,this.stateCenter)}return this.updateStreamState(e,r,t,this.playingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPlay[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPlayInfo")):this.reportPlayEvent(e),!0},t.prototype.updatePublishingState=function(e,t,r){if(void 0===t&&(t=""),void 0===r&&(r=!1),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE+" "+e),null==e)return!1;if(r){var o=this.playerList[e],s=this.stateCenter.reportSeqList.startPublish[e];if(this.dataReport.eventStart(s,"updatePublishingState"),o)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE+" player already exist"),this.dataReport.eventEndWithMsgInfo(s,"updatePublishingState",{message:"player already exist"}),this.dataReport.uploadReport(s,void 0),delete this.stateCenter.reportSeqList.startPublish[e],!1;this.playerList[e]=new l.ZegoPlayWechat(this.logger,e,this,this.dataReport,this.stateCenter)}return this.updateStreamState(e,r,t,this.publishingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPublish[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPublishInfo")):this.reportPublishEvent(e),!0},t.prototype.updateStreamState=function(e,t,r,o){if(e)if(r&&"string"==typeof r||(r=""),1==t)o.push({streamID:e,params:r});else for(var s=0;s<o.length;s++)if(o[s].streamID==e){o.splice(s--,1);break}},t.prototype.isPlaying=function(){return 0!=this.playingList.length},t.prototype.isPublishing=function(){return 0!=this.publishingList.length},t.prototype.startPlayingStream=function(e,t,r){if(this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYING_STREAM+" call "+e),this.streamEventMap[e]){var o="";0==r?o="cdn":1==r&&(o="ultra_src"),E.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"get_play_url",["type",o]),E.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"get_play_url",["urls",t])}var s=this.streamReportMap[e];return s&&this.dataReport.eventEndWithMsg(s,"GotPlayInfo",{type:0==r?"cdn":"ultra_src",urls:t}),this.startPlayer(e,t,r,c)},t.prototype.startPlayer=function(e,t,r,o){var s=this.playerList[e];if(!s)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" player don't exist"),!1;var n=[];o==c?n=this.playingList:o==h&&(n=this.publishingList);for(var a=!1,_="",E=0;E<n.length;E++)if(n[E].streamID==e){a=!0,_=n[E].params;break}if(!a)return this.logger.warn(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" should not start"),!1;if(s.urls=t,s.params=_,s.reconnectLimit=this.getReconnectLimit(r),s.dispatchType=r,s.playerType=o,s.playerSeq=this.streamEventMap[e],s.playerReportSeq=this.streamReportMap[e],!s)return this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" new player failed"),!1;++this.playerCount;var l=s.tryStartPlayer(0);return this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" call result: "+l),l},t.prototype.getNextUrl=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_GET_NEXT_URL+" call "+e);var t,r=this.playerList[e];if(!r)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_GET_NEXT_URL+" player don't exist"),"";this.publishingList.find((function(t){return t.streamID===e}))?(t=!0,this.onPublishStateUpdate(a.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""})):(t=!1,this.onPlayStateUpdate(g,e,{code:0,message:""}));var o=r.getPlayerUrl();if(t){if(!this.stateCenter.reportSeqList.startPublish[e]){var s=a.getReportSeq();this.stateCenter.reportSeqList.startPublish[e]=s,this.dataReport.newReport(s,_.ZegoWechatLogEvent.kZegoTaskRePublish),r.pushBegin=!1,E.ClientUtil.logReportCallback("kZegoTaskPublishStart"+e,this.dataReport,s,this.stateCenter.reportList)}}else if(!this.stateCenter.reportSeqList.startPlay[e]){s=a.getReportSeq();this.stateCenter.reportSeqList.startPlay[e]=s,this.dataReport.newReport(s,_.ZegoWechatLogEvent.kZegoTaskRePlay),r.playBegin=!1,E.ClientUtil.logReportCallback("kZegoTaskPlayStart"+e,this.dataReport,s,this.stateCenter.reportList)}return o},t.prototype.stopPlayingStream=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYING_STREAM+" call "+e),null!=e&&(this.stopPlayer(e),this.updatePlayingState(e))},t.prototype.stopPlayer=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+" call "+e);var t=this.playerList[e];t?(t.stopPlayer(),delete this.playerList[e],--this.playerCount):this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+" play not exist "+e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+" call success")},t.prototype.startPublishingStream=function(e,t,r){if(this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PUBLISHING_STREAM+" call "+e),this.streamEventMap[e]){var o="";0==r?o="cdn":1==r&&(o="ultra_src"),E.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"type",o),E.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"urls",t)}var s=this.streamReportMap[e];return s&&this.dataReport.eventEndWithMsg(s,"GotPublishInfo",{type:0==r?"cdn":"ultra_src",urls:t}),this.startPlayer(e,t,r,h)},t.prototype.stopPublishingStream=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM+" call "+e),null!=e&&(this.stopPlayer(e),this.updatePublishingState(e,"",!1))},t.prototype.updatePlayerState=function(e,t){var r=this.playerList[e];r?r.updateEvent(t):this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE+" no player "+e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE+" updatePlayerEvent success")},t.prototype.updatePlayerNetStatus=function(e,t){var r=this.playerList[e];r?r.updatePlayerNetStatus(t):this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS+" no player "+e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS+" updatePlayerNetStatus success")},t.prototype.reset=function(){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_RESET+" call");for(var e=0;e<this.playingList.length;e++)this.stopPlayingStream(this.playingList[e].streamID);for(var t=0;t<this.publishingList.length;t++)this.stopPublishingStream(this.publishingList[t].streamID);this.playerCount=0,this.playerList={},this.playerWaitingList=[],this.playerStatistics={},this.streamEventMap={},this.streamReportMap={},this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_RESET+" call success")},t.prototype.reportPublishEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:"WXPublishStream"}),this.dataReport.uploadReport(r,"WXPublishStream"),delete this.streamReportMap[e]}},t.prototype.reportPlayEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:"WXPlayStream"}),this.dataReport.uploadReport(r,"WXPlayStream"),delete this.streamReportMap[e]}},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onPublisherStreamUrlUpdate=function(e,t){},t.prototype.onPublisherStreamUrlFail=function(e,t){},t.prototype.onPlayerStreamUrlUpdate=function(e,t){},t.prototype.getReconnectLimit=function(e){return 1},t.prototype.onPlayerStart=function(e,t){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_START+" call "+e),t==c?this.onPlayStateUpdate(d,e,{code:0,message:""}):t==h&&this.onPublishStateUpdate(d,e,{code:0,message:""})},t.prototype.onPlayerStop=function(e,t,r){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+" call "+e),t==c?(this.reportPlayEvent(e,r),this.logger.warn(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+" play error"),this.onPlayStateUpdate(u,e,r)):t==h&&(this.reportPublishEvent(e,r),this.logger.warn(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+" publish error"),this.onPublishStateUpdate(u,e,r))},t.prototype.onPlayerRetry=function(e,t){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_RETRY+" call "+e),t==c?this.onPlayStateUpdate(g,e,{code:0,message:""}):t==h&&this.onPublishStateUpdate(g,e,{code:0,message:""})},t.prototype.onPlayerQuality=function(e,t,r){var o={video:{videoBitrate:t.videoBitrate,videoFPS:t.videoFPS,videoWidth:t.videoWidth,videoHeight:t.videoHeight},audio:{audioBitrate:t.audioBitrate}};r==c?this.onPlayQualityUpdate(e,o):r==h&&this.onPublishQualityUpdate(e,o)},t.prototype.onStreamUrlUpdate=function(e,t,r){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE+" call "+e),0==r?this.playSuccessCallBackList[e](e,t):this.publishSuccessCallBackList[e](e,t)},t.prototype.getTotalStreamId=function(e){return e},t.prototype.getRealStreamId=function(e){return e},t}(n.ZegoStreamCenter);t.ZegoStreamCenterWechat=T},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenter=void 0;var o=function(){this.publisherList={},this.playerList={}};t.ZegoStreamCenter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPlayWechat=void 0;var o=r(2),s=r(3),i=r(0),n=r(1),a=function(){function e(e,t,r,o,s){this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=i.ENUM_PLAYER_STATE.stop,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=(new Date).getTime(),this.seq=-1,this.streamId=t,this.logger=e,this.streamCenter=r,this.dataReport=o,this.stateCenter=s}return e.prototype.resetPlayer=function(){this.state=i.ENUM_PLAYER_STATE.stop},e.prototype.newPlayer=function(){this.resetPlayer();var e=this.getCurrentPlayerUrl(),t=e;0!=this.params.length&&(t=e+"?"+this.params);var r=(new Date).getTime();return t=t.indexOf("?")>-1?t+"&zgseq="+r+"&zgdid="+this.stateCenter.sessionid:t+"?zgseq="+r+"&zgdid="+this.stateCenter.sessionid,e!==this.currentUrl?(this.currentUrl=e,this.streamCenter.onStreamUrlUpdate(this.streamId,t,this.playerType)):this.streamCenter.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,"PlayBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PlayBegin","url",t),this.tryUrls.push(t)):(this.dataReport.eventStart(this.playerReportSeq,"PublishBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PublishBegin","url",t),this.tryUrls.push(t)):0==this.playerType?this.dataReport.addEventInfo(this.playerSeq,"PlayRetry","url",t):this.dataReport.addEventInfo(this.playerSeq,"PublishRetry","url",t),this.state=i.ENUM_PLAYER_STATE.start,!0},e.prototype.stopPlayer=function(){0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,"PlayStat",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,"PublishStat","quality",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,"PublishStat",{quality:this.playerInfo}))},e.prototype.tryStartPlayer=function(e){for(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+" call");this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+" index: "+this.playUrlIndex+", url: "+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+" stream: "+this.streamId),this.resetPlayer();var t="";0==this.playerType?t="PlayEnd":1==this.playerType&&(t="PublishEnd",this.reportQualityStatics());var r={error:e,reason:"no url to retry"};this.dataReport.addEvent(this.playerSeq,t,r),this.streamCenter.onPlayerStop(this.streamId,this.playerType,e)}},e.prototype.getPlayerUrl=function(){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_GET_PLAY_URL+" call "+this.streamId);var e=this.urls[++this.retryIndex%this.urls.length],t=e;0!=this.params.length&&(t=e+"?"+this.params);var r=(new Date).getTime();return t=t.indexOf("?")>-1?t+"&zgseq="+r+"&zgdid="+this.stateCenter.sessionid:t+"?zgseq="+r+"&zgdid="+this.stateCenter.sessionid,this.tryUrls.push(t),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_GET_PLAY_URL+" call streamId: "+this.streamId+" url: "+t),t},e.prototype.shouldRetryPlay=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3005==t},e.prototype.isPlayFailed=function(e){var t=e.detail.code;return-2301==t||2101==t||2102==t},e.prototype.shouldRetryPublish=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3004==t||3005==t},e.prototype.isPublishFailed=function(e){var t=e.detail.code;return-1301==t||-1302==t||-1303==t||-1304==t||-1305==t||-1306==t||-1307==t||-1308==t||-1309==t||-1310==t||-1311==t},e.prototype.updateEvent=function(e){if(0==this.playerType){if(this.playBegin||(this.playBegin=!0,s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"play_begin")),2004==e.detail.code)this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PlayRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PlayStat"),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"play_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"play_begin"),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"play_state"))),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" play suc: "+this.streamId),this.state=i.ENUM_PLAYER_STATE.playing,this.streamCenter.onPlayerStart(this.streamId,this.playerType);else if(2009==e.detail.code);else if(this.shouldRetryPlay(e));else if(this.isPlayFailed(e)){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" play error: "+this.streamId),this.resetPlayer();e.detail.code;s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"play_begin","error_code",e.detail.code),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"play_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"play_begin"),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{})),this.playBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:"play fail"})}this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PlayBegin")}else 1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"push_begin")),1002==e.detail.code?(this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PublishRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PublishStat"),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"push_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"push_begin"),this.stateCenter.publishStreamList[this.streamId]&&this.stateCenter.publishStreamList[this.streamId].state==i.ENUM_PUBLISH_STREAM_STATE.tryPublish&&s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"publish_state"))),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" play suc: "+this.streamId),this.state=i.ENUM_PLAYER_STATE.playing,this.streamCenter.onPlayerStart(this.streamId,this.playerType)):this.shouldRetryPublish(e)||this.isPublishFailed(e)&&(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" publish error: "+this.streamId),this.resetPlayer(),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"push_begin","error_code",e.detail.code),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"push_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"push_begin"),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{})),this.pushBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:"publish fail"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PublishBegin"))},e.prototype.updatePlayerNetStatus=function(e){var t={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoHeight:e.detail.info.videoHeight,videoWidth:e.detail.info.videoWidth,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter};if(this.playerInfo=t,1==this.playerType){var r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight};if(0==this.publishQualitySeq&&(this.publishQualitySeq=i.getReportSeq(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,"PublishQuality",r),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}else if(0==this.playerType){r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight};if(0==this.playQualitySeq&&(this.playQualitySeq=i.getReportSeq(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,"PlayQuality",r),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount)(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportPlayQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}this.streamCenter.onPlayerQuality(this.streamId,t,this.playerType)},e.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},e.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:"WXPublishStateUpdate"}),this.dataReport.uploadReport(this.publishQualitySeq,n.ZegoWechatLogEvent.kZegoEventPublishStat),this.publishQualityCount=0,this.publishQualitySeq=0},e.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:"WXPlayStateUpdate"}),this.dataReport.uploadReport(this.playQualitySeq,n.ZegoWechatLogEvent.kZegoEventPlayStat),this.playQualityCount=0,this.playQualitySeq=0},e}();t.ZegoPlayWechat=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamHandler=void 0;var o=r(0),s=r(3),i=r(0),n=r(1),a=r(5),_=function(){function e(e,t,r,o,s){this.logger=e,this.rtm=r,this.stateCenter=t,this.dataReport=o,this.streamCenter=s}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:"string"==typeof t.urls_rtmp?t.urls_rtmp:""},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e){var t=this;this.logger.info("zb.sh.hss call stream update"),this.stateCenter.streamQuerying=!1,this.rtm.modules.service.on("stream",(function(e){t.handleStreamUpdateRsp(e)})),this.rtm.modules.service.on("push_stream_update",(function(e){t.handlePushStreamUpdateMsg(e)})),this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info("zb.sh.hss call end")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,i){var n=this;void 0===r&&(r=""),this.logger.debug("zb.sh.usi call");var _={stream_id:e,extra_info:r},E=JSON.stringify(_),l={sub_cmd:t,stream_msg:E};this.stateCenter.streamInfoList[e]={},this.stateCenter.streamInfoList[e].seq=this.rtm.modules.service.sendMessage("stream",l,(function(e,t){n.handleStreamUpdateRsp(e)}),(function(_,E){if(n.stateCenter.isResetRoom||n.rtm.modules.service.isDisConnect()||!_.code||_.code!=a.errorCodeList.TIMEOUT.code||n.stateCenter.streamInfoList[e].seq!=E){if(_.body&&_.body.err_code){var l=s.ClientUtil.getServerError(_.body.err_code);i&&i(l,E)}}else 2001==t&&n.stateCenter.publishStreamList[e]&&n.stateCenter.publishStreamList[e].state==o.ENUM_PUBLISH_STREAM_STATE.update_info||2002==t?setTimeout((function(){n.updateStreamInfo(e,t,r,i)}),0):i&&i(a.errorCodeList.TIMEOUT)})),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e){if(this.rtm.modules.service.isDisConnect())this.logger.error("zb.sh.hsur not login");else if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.stateCenter.streamSeq+" server seq "+e.body.stream_seq),this.stateCenter.streamSeq=e.body.stream_seq;for(var t=function(t){var s=e.body.stream_info[t].stream_id;if(!r.stateCenter.publishStreamList[s])return r.logger.info("hsur.0 stream is not exist"),{value:void 0};r.stateCenter.publishStreamList[s].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(r.stateCenter.publishStreamList[s].state=o.ENUM_PUBLISH_STREAM_STATE.publishing,r.stateCenter.streamList.find((function(e){return e.stream_id==s}))||r.stateCenter.streamList.push(e.body.stream_info[t]),r.onPublishStateUpdate(0,s,{code:0,message:""})),delete r.stateCenter.streamInfoList[s]},r=this,s=0;s<e.body.stream_info.length;s++){var i=t(s);if("object"==typeof i)return i.value}}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code)},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info("zb.sh.hfslr call"),this.stateCenter.streamQuerying=!1,0===e.body.err_code?this.stateCenter.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.info("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info("zb.sh.hfus call"),this.stateCenter.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.stateCenter.streamSeq),s.ClientUtil.mergeStreamList(this.stateCenter.idName,this.stateCenter.streamList,t,(function(e,t,s){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==s.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.stateCenter.roomid,r.makeCallbackStreamList(s)))})),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.stateCenter.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList(e);switch(this.stateCenter.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],s=0;s<e.length;s++)if(e[s].anchor_id_name!=this.stateCenter.idName){t=!1;for(var i=0;i<this.stateCenter.streamList.length;i++)if(e[s].stream_id===this.stateCenter.streamList[i].stream_id){t=!0;break}t||r.push(e[s])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var n=0;n<r.length;n++)this.stateCenter.streamList.push(r[n]);this.onStreamUpdated(this.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var s=this.stateCenter.streamList.length-1;s>=0;s--)if(e[r].stream_id===this.stateCenter.streamList[s].stream_id){this.stateCenter.streamList.splice(s--,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var o=0;o<this.stateCenter.streamList.length;o++)if(e[r].stream_id===this.stateCenter.streamList[o].stream_id){e[r].extra_info!==this.stateCenter.streamList[o].extra_info&&(this.stateCenter.streamList[o]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.stateCenter.roomid,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(e){if(this.logger.info("zb.sh.fsl call"),e.body.stream_seq!==this.stateCenter.streamSeq)if(this.rtm.modules.service.isDisConnect())this.logger.info("zb.sh.fsl state error");else if(this.stateCenter.streamQuerying)this.logger.info("zb.sh.fsl already doing");else{this.stateCenter.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request");this.rtm.modules.service.sendMessage("stream_info",{reserve:0},this.handleFetchStreamListRsp.bind(this),(function(e,t){})),this.logger.info("zb.sh.fsl call success")}},e.prototype.handleReconnectStream=function(e){this.logger.info("zb.sh.hrs call");var t=this.streamCenter.publisherList,r=this.streamCenter.playerList,s=function(r){if(t[r].publisher.state!=o.ENUM_PUBLISH_STATE.publishing||e.find((function(e){return e.stream_id==r}))){if(t[r].publisher.state==o.ENUM_PUBLISH_STATE.stop&&e.find((function(e){return e.stream_id==r}))){i.updateStreamInfo(r,o.ENUM_STREAM_SUB_CMD.liveEnd);for(var s=0;s<i.stateCenter.streamList.length;s++)if(i.stateCenter.streamList[s].stream_id==r){i.stateCenter.streamList.splice(s--,1);break}}}else i.updateStreamInfo(r,o.ENUM_STREAM_SUB_CMD.liveBegin,i.stateCenter.publishStreamList[r].extra_info)},i=this;for(var n in t)s(n);for(var n in t){if(t[n].isReDispatch)this.logger.info("zb.sh.hrs "+n+"retry dispatch"),(a=t[n].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(n,t[n].publishOption,!0),a.active(0),t[n].isReDispatch=!1}for(var n in r){var a;if(r[n].isReDispatch)this.logger.info("zb.sh.hrs "+n+"retry dispatch"),(a=r[n].retryDispatchHandler).stopMaxTime(),a.invalid(),a.initStream(n,r[n].playOption,!1),a.active(0),r[n].isReDispatch=!1}this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t=[];if(e&&e.length>0)for(var r=0;r<e.length;r++){var o={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:e[r].stream_gid,closeType:e[r].close_type};this.setCDNInfo(o,e[r]),t.push(o)}return t},e.prototype.updateMixStream=function(e,t,r){var _,E=this;if(this.logger.info("zb.sh.ums call"),!e.noTaskID&&!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&"string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>o.MAX_MIX_TASK_ID_LENGTH)return this.logger.error("zb.sh.ums taskId is too long"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!s.ClientUtil.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach((function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var l=e.inputList.every((function(e){return"AUDIO"===e.contentType})),d=0;d<e.inputList.length;d++){var u=e.inputList[d];if("object"!=typeof u.layout)return this.logger.error("zb.sh.ums input layout must be object"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!(s.ClientUtil.checkInteger(u.layout.top,!1)&&s.ClientUtil.checkInteger(u.layout.bottom,!1)&&s.ClientUtil.checkInteger(u.layout.left,!1)&&s.ClientUtil.checkInteger(u.layout.right,!1)))return this.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some((function(e){return"string"==typeof e&&!s.ClientUtil.isUrl(e)&&!s.ClientUtil.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!s.ClientUtil.isUrl(e.target)&&!s.ClientUtil.checkIllegalCharacters(e.target)})))return this.logger.error("zb.sh.ums stream output target is incorrect"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!(l||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(l&&(void 0===e.outputConfig&&(e.outputConfig={outputBitrate:0,outputFPS:0,outputWidth:0,outputHeight:0}),e.outputConfig.outputBitrate=.001,e.outputConfig.outputFPS=1,e.outputConfig.outputWidth=1,e.outputConfig.outputHeight=1),!(l||e.outputConfig.outputBitrate&&s.ClientUtil.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!s.ClientUtil.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!s.ClientUtil.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!s.ClientUtil.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var g=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(g=e.outputConfig.singleStreamPassThrough?1:0);var c={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:o.PROTO_VERSION,bypass:g},h=this.stateCenter.mixStreamAdvance;h&&(h.videoCodec&&(c.extra_params=[{key:"video_encode",value:h.videoCodec}]),h.backgroundColor&&(c.output_bg_color=h.backgroundColor),h.backgroundImage&&(c.output_bg_image=h.backgroundImage),h.waterMark&&(c.watermark=h.waterMark),h.extraParams&&(!c.extra_params&&(c.extra_params=[]),(_=c.extra_params).push.apply(_,h.extraParams)));var T=[];for(d=0;d<e.inputList.length;d++){var R=e.inputList[d],p=R.streamID;this.stateCenter.testEnvironment&&(p="zegotest-"+this.stateCenter.appid+"-"+R.streamID),T.push({stream_id:p,content_control:"AUDIO"===R.contentType?1:0,rect:{layer:d,top:R.layout.top,left:R.layout.left,bottom:R.layout.bottom,right:R.layout.right}})}c.MixInput=T,s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{mix_stream_id:n.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(e.taskID),stream_cnt:n.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(T.length),input_stream_list:n.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(T)});var m=[];e.outputList.forEach((function(t){var o={},s="";if("string"==typeof t)s=t;else{if("object"!=typeof t||!t.target)return E.logger.error("zb.sh.ums output target required"),r({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;s=t.target}s.startsWith("rtmp://")||s.startsWith("https://")&&s.endsWith(".flv")||s.startsWith("https://")&&s.endsWith(".m3u8")?o.mixurl=s:E.stateCenter.testEnvironment?o.stream_id="zegotest-"+E.stateCenter.appid+"-"+s:o.stream_id=s,o.bitrate=1e3*e.outputConfig.outputBitrate,o.fps=e.outputConfig.outputFPS,o.width=e.outputConfig.outputWidth,o.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(o.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===h.videoCodec?o.audio_enc_id=3:"h264"===h.videoCodec&&(o.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(o.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(o.audio_channel_cnt=e.outputConfig.outputAudioChannels),E.stateCenter.testEnvironment?o.testenv=1:o.testenv=0,m.push(o)})),c.MixOutput=m,s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{output_target_list:n.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(m)});var S={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(c)};return this.logger.debug("zb.sh.ums send command"),this.sendBizChannelRequest(S,(function(e,i,n){E.logger.debug("zb.sh.ums receive message");var a="zegotest-"+E.stateCenter.appid+"-";if(0!=n.length){for(var _=JSON.parse(n),l=[],d=0;d<_.play.length;d++){var u={rtmpURL:"",hlsURL:"",flvURL:""},g=_.play[d].stream_alias||"";E.stateCenter.testEnvironment&&g&&g.startsWith(a)&&(g=g.slice(a.length)),u.streamID=g,_.play[d].rtmp_url&&_.play[d].rtmp_url.length>0&&(u.rtmpURL=_.play[d].rtmp_url),_.play[d].hls_url&&_.play[d].hls_url.length>0&&(u.hlsURL=_.play[d].hls_url),_.play[d].hdl_url&&_.play[d].hdl_url.length>0&&(u.flvURL=_.play[d].hdl_url),l.push(u)}if(t){var c={mixerOutputList:l};t({errorCode:0,extendedData:JSON.stringify(c)})}}else r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).code,extendedData:""})}),(function(e,t,o){if("number"==typeof e){E.logger.debug("zb.sh.ums error: "+e);var i=[];if(1000000150==e&&0!=o.length)for(var _=JSON.parse(o),l="zegotest-"+E.stateCenter.appid+"-",d=0;d<_.non_exist_streams.length;d++){var u=_.non_exist_streams[d];E.stateCenter.testEnvironment&&u.startsWith(l)?i.push(u.slice(l.length)):i.push(u)}r&&r({errorCode:s.ClientUtil.getServerError(e).code,extendedData:""})}else{E.logger.debug("zb.sh.ums error code "+e.code);var g=void 0;g=e==a.errorCodeList.TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,r&&r({errorCode:g.code,extendedData:""})}})),!0},e.prototype.sendBizChannelRequest=function(e,t,r,o){var s=this;void 0===o&&(o=!1),e=Object.assign(e,{is_retry_req:o?1:0}),this.rtm.modules.service.sendMessage("biz_channel",e,(function(e,r){t(e.header.seq,e.body.cmd,e.body.rsp_body)}),(function(o,i){var n=o.body.err_code,a=o.message.body.rsp_body;"number"!=typeof n||2002!==n?r(n,i,a):s.sendBizChannelRequest(e,t,r,!0)}))},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,o){var a,_={},E={};if(e&&e.videoCodec){var l=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(l))return t.logger.error("zb.sh.ums param videoCode error"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;_.videoCodec=l,E.video_codec=l}if(e.backgroundColor){if(!s.ClientUtil.checkInteger(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;_.backgroundColor=e.backgroundColor,E.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return t.logger.error("zb.sh.ums param outputBgImage error"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;_.backgroundImage=e.backgroundImage,E.background_image=e.backgroundImage}e.waterMark&&(_.waterMark=e.waterMark,E.water_mark=e.waterMark),e.extraParams&&(_.extraParams||(_.extraParams=[]),(a=_.extraParams).push.apply(a,e.extraParams)),t.stateCenter.mixStreamAdvance=_,s.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{config:n.ZegoRTCLogEvent.kZegoTaskMixConfig.config(E)}),r({errorCode:0,extendedData:""})}))},e.prototype.stopMixStream=function(e,t,r,i,_){var E=this;this.logger.info("zb.sh.sms call");var l={id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:o.PROTO_VERSION};"string"==typeof e&&(l.task_id=e),null!=i?this.stateCenter.testEnvironment?l.stream_id="zegotest-"+this.stateCenter.appid+"-"+i:l.stream_id=i:null!=_&&(l.mixurl=_);var d={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(l)};return this.sendBizChannelRequest(d,(function(){t&&t({errorCode:0})}),(function(e){if("number"==typeof e)r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+e).code,extendedData:""});else{E.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e));var t=void 0;t=e==a.errorCodeList.TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,r&&r({errorCode:t.code,extendedData:""})}})),!0},e.prototype.updateStreamExtraInfo=function(e,t){return this.logger.info("zb.sh.usei call"),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].extra_info=t,this.stateCenter.publishStreamList[e].state>=o.ENUM_PUBLISH_STREAM_STATE.update_info&&this.updateStreamInfo(e,o.ENUM_STREAM_SUB_CMD.liveUpdate,t)),!0},e.prototype.setStreamExtraInfo=function(e,t){var r=this;return new Promise((function(o,s){r._handleStreamInfo(e,t,s),o({errorCode:0,extendedData:""})}))},e.prototype._setStreamExtraInfo=function(e,t){return this._handleStreamInfo(e,t)},e.prototype._handleStreamInfo=function(e,t,r){var s=o.getReportSeq();if(this.dataReport.newReport(s,n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),this.dataReport.addMsgInfo(s,{stream:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(t),room_sid:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(this.stateCenter.sessionid)}),"string"!=typeof e||""==e)return this.logger.error("zb.ssei streamID must be string and not empty"),this.dataReport.addMsgInfo(s,{error:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message+" streamID must be string and not empty"}),this.dataReport.uploadReport(s),r&&r({errorCode:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message}),!1;if(void 0===t||""===t)return this.logger.error("zb.ssei extraInfo is empty"),this.dataReport.addMsgInfo(s,{error:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message+" extraInfo is empty"}),this.dataReport.uploadReport(s),r&&r({errorCode:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kExtraInfoNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kExtraInfoNullError.message}),!1;if("string"!=typeof t||""==t)return this.logger.error("zb.ssei extraInfo must be string"),this.dataReport.addMsgInfo(s,{error:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,message:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message+" extraInfo must be string"}),this.dataReport.uploadReport(s),r&&r({errorCode:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message}),!1;if(this.rtm.modules.service.isDisConnect())return this.logger.error("zb.ssei not login"),this.dataReport.uploadReport(s,void 0,n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError),r&&r({errorCode:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError.message}),!1;if(!this.stateCenter.publishStreamList[e])return this.logger.error("zb.ssei publish stream no found"),this.dataReport.addMsgInfo(s,n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError),this.dataReport.uploadReport(s),r&&r({errorCode:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError.message}),!1;var i=this.updateStreamExtraInfo(e,t);return this.dataReport.uploadReport(s),i},e.prototype.publishTarget=function(e){var t=this,r=o.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(r,n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(r,{stream:n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise((function(o,i){var a=function(e,o){t.logger.error("zb.pt"+(o||e.message)),t.dataReport.addMsgInfo(r,{error:e.code,message:e.message+(o||"")}),t.dataReport.uploadReport(r),i({errorCode:e.code,extendedData:e.message+(o?" "+o:"")})};e.streamID&&"string"==typeof e.streamID||a(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error"),e.pushUrl&&"string"==typeof e.pushUrl||a(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error"),t.stateCenter.publishStreamList[e.streamID]||a(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);t._publishTarget(e,(function(e){t.dataReport.uploadReport(r),o(e)}),(function(e){var o=s.ClientUtil.getServerError(e.errorCode),n=s.ClientUtil.decodeServerError(o.code,o.message);t.dataReport.addMsgInfo(r,n),t.dataReport.uploadReport(r),i(e)}))}))},e.prototype._publishTarget=function(e,t,r){var i=this;if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return this.logger.error("zb.sh.pt cdn push type error"),void(r&&r({errorCode:a.errorCodeList.PUBLISHER_CDN_PUSH_ERROR.code,extendedData:a.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.message+" type error"}));this.logger.info("zb.sh.ptcall");var n=Math.ceil((new Date).getTime()/1e3),_=e.streamID;this.stateCenter.testEnvironment&&(_="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var E={appid:this.stateCenter.appid,biz_type:0,timestamp:n,seq:this.stateCenter.cdnSeq++,version:1*o.PROTO_VERSION,stream_id:_,pushurl:e.pushUrl},l={channel:"media",cmd:e.type,req_body:JSON.stringify(E)};this.logger.debug("zb.sh.pt send command"),this.sendBizChannelRequest(l,(function(n,_,E){if(i.logger.info("zb.sh.pt receive message"),0!=E.length){var l=JSON.parse(E),d=l.code,u=l.message;d&&0!=d?(i.logger.error("zb.sh.pt "+e.type+" error code: "+d+" "+u),r&&r({errorCode:a.errorCodeList.UNKNOWN_SERVER_ERROR.code,extendedData:a.errorCodeList.UNKNOWN_SERVER_ERROR.message+" cmd: "+e.type+" "+d+" "+u+"  "})):(i.logger.info("zb.sh.pt "+e.type+" success"),t&&t({errorCode:0,extendedData:""}))}else r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).code,extendedData:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).message})}),(function(t,o,s){i.logger.info("zb.sh.pt error: "+t);var n="";2001==t?n="invalid channel":2002==t&&(n="bizchannel error"),i.logger.error("zb.sh.pt "+n),r&&r({errorCode:a.errorCodeList.UNKNOWN_SERVER_ERROR.code,extendedData:a.errorCodeList.UNKNOWN_SERVER_ERROR.message+" cmd: "+e.type+" "+t+" "+n+"  "})}))},e}();t.StreamHandler=_},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PublishModule=void 0;var s=r(0),i=r(2),n=r(1),a=r(3),_=function(){function e(e,t,r,o,i,n){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.streamHandler=i,this.rtm=n,this.preferPublishSourceType=s.ENUM_DISPATCH_TYPE.ultra,this.ultraPlaySourceType="rtmp_v2"}return e.prototype.startPublishingStream=function(e,t){var r=this;return new Promise((function(_,E){r.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+" call");var l=s.getReportSeq();r.stateCenter.reportSeqList.startPublish[e]=l,r.dataReport.newReport(l,n.ZegoWechatLogEvent.kZegoTaskPublishStart.event);var d=function(t,s){r.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+" "+(s||t.message)),r.dataReport.uploadReport(l,void 0,t,s),delete r.stateCenter.reportSeqList.startPublish[e],E(o(o({},t),{errorCode:t.code,extendedData:t.message+(s?" "+s:"")}))};if(a.ClientUtil.isParamEmpty(e))if(a.ClientUtil.isTypeString(e)){if(!a.ClientUtil.isTooLong(e,s.MAX_STREAM_ID_LENGTH))return d(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDTooLongError),!1;if(!a.ClientUtil.checkIllegalCharacters(e))return d(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDInvalidCharacterError),!1;if(r.stateCenter.customUrl&&0!=r.stateCenter.customUrl.length)return r.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null},r.streamCenter.updatePublishingState(e,t&&t.streamParams?t.streamParams:void 0,!0)?(r.streamCenter.publishSuccessCallBackList[e]=function(e,t){_({streamID:e,url:t})},r.streamCenter.startPublishingStream(e,r.stateCenter.customUrl,1)):void d(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kIsPublishing,"cannot start publish");if(r.rtm.modules.service.isDisConnect())d(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError);else{if(!r.streamCenter.updatePublishingState(e,t&&t.streamParams?t.streamParams:void 0,!0))return d(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kIsPublishing,"cannot start publish"),!1;a.ClientUtil.logReportCallback("kZegoTaskPublishStart"+e,r.dataReport,l,r.stateCenter.reportList),r.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""}),r.dataReport.addMsgInfo(l,{stream:n.ZegoWechatLogEvent.kZegoTaskPublishStart.stream(e),publishOption:n.ZegoWechatLogEvent.kZegoTaskPublishStart.publishOption(t)}),!t||"CDN"!=t.sourceType&&"BGP"!=t.sourceType||r.setPreferPublishSourceType(s.ENUM_SOURCE_TYPE[t.sourceType]),r.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null},r.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+" fetch stream url"),a.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventStart,"get_publish_url"),r.streamCenter.publishSuccessCallBackList[e]=function(e,t){a.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,"get_publish_url"),_({streamID:e,url:t})},r.streamCenter.publishErrorCallBackList[e]=function(e){d(e)},r.fetchPublishStreamUrl(e)}}else d(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError);else d(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDNullError)}))},e.prototype.setPreferPublishSourceType=function(e,t){return this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" call"),e!==s.ENUM_DISPATCH_TYPE.cdn&&e!==s.ENUM_DISPATCH_TYPE.ultra&&e!==s.ENUM_DISPATCH_TYPE.customUrl?(this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" sourceType only can be number 0 1 2"),!1):e!==s.ENUM_DISPATCH_TYPE.customUrl||"string"==typeof t&&""!=t?(this.preferPublishSourceType=e,this.customCdnUrl=t,this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" call success"),!0):(this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" customUrl must be string and not empty"),!1)},e.prototype.fetchPublishStreamUrl=function(e){var t=this;this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+" call"),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+" send fetch publish request");var r="";this.preferPublishSourceType==s.ENUM_DISPATCH_TYPE.cdn?r="cdn":this.preferPublishSourceType==s.ENUM_DISPATCH_TYPE.ultra&&(r="bgp");var o={stream_id:e,url_type:this.ultraPlaySourceType,publish_type:r,header_kvs:[{key:"grpc-metadata-push",value:this.customCdnUrl||""}]},a=this.rtm.modules.service.sendMessage("stream_publish",o,(function(e){t.handleFetchStreamPublishUrlRsp(e)}),(function(r,o){t.streamCenter.publishErrorCallBackList[e](n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),t.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),t.streamCenter.stopPublishingStream(e)}));-1!==a&&(this.stateCenter.streamUrlMap[a]=e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+" call success")},e.prototype.handleFetchStreamPublishUrlRsp=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" call");var t=this.stateCenter.streamUrlMap[e.header.seq];if(t&&delete this.stateCenter.streamUrlMap[e.header.seq],0!==e.body.err_code)return this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" server error= "+e.body.err_code),void(this.stateCenter.publishStreamList[t]&&(this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" liveRoom cmd error"),this.streamCenter.publishErrorCallBackList[t](n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),this.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,t,{code:n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError.code,message:"server error= "+e.body.err_code}),this.streamCenter.stopPublishingStream(t)));if(e.body.stream_url_info){var r=e.body.stream_url_info.stream_id,o=e.body.stream_url_info.urls_ws;if(!this.stateCenter.publishStreamList[r])return void this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" cannot find stream");this.stateCenter.publishStreamList[r].url_rtmp=o,this.stateCenter.publishStreamList[r].state=s.ENUM_PUBLISH_STREAM_STATE.tryPublish,this.doPublishStream(r,o)}},e.prototype.doPublishStream=function(e,t){return this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_DO_PUBLISH_STREAM+" call "+e+"streamUrl: "+t),!t||t.length<=0?(this.streamCenter.publishErrorCallBackList[e](n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),this.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),!1):(this.streamCenter.startPublishingStream(e,t,this.preferPublishSourceType),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_DO_PUBLISH_STREAM+" call success"),!0)},e.prototype.stopPublishingStream=function(e){var t=this;this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+" call "+e);var r=s.getReportSeq();this.dataReport.newReport(r,n.ZegoWechatLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(r,{stream_id:e});var o=function(o,s){t.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+" "+(s||o.message)),t.dataReport.uploadReport(r,void 0,o,s),delete t.stateCenter.reportSeqList.startPublish[e]};if(!a.ClientUtil.isParamEmpty(e))return o(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDNullError),!1;if(!a.ClientUtil.isTypeString(e))return o(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError),!1;this.streamCenter.stopPublishingStream(e);var _=this.streamCenter.playerList[e];return _&&_.state!==s.ENUM_PLAYER_STATE.stop&&this.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:0,message:""}),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].state>=s.ENUM_PUBLISH_STREAM_STATE.update_info&&this.streamHandler.updateStreamInfo(e,s.ENUM_STREAM_SUB_CMD.liveEnd),delete this.stateCenter.publishStreamList[e]),this.stateCenter.streamUrlMap[e]&&delete this.stateCenter.streamUrlMap[e],this.dataReport.uploadReport(r),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+" call success"),!0},e}();t.PublishModule=_},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayModule=void 0;var s=r(0),i=r(1),n=r(3),a=r(2),_=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i,this.mixStreamList={},this.preferPlaySourceType=s.ENUM_PLAY_SOURCE_TYPE.ultra,this.currentPlaySourceType=s.ENUM_DISPATCH_TYPE.cdn,this.ultraPlaySourceType="rtmp_v2"}return e.prototype.startPlayingStream=function(e,t){var r=this;return new Promise((function(_,E){r.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM+" call "+e);var l=s.getReportSeq();r.stateCenter.reportSeqList.startPlay[e]=l,r.dataReport.newReport(l,i.ZegoWechatLogEvent.kZegoTaskPlayStart.event);var d=function(t,s){r.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM+" "+(s||t.message)),r.dataReport.uploadReport(l,void 0,t,s),delete r.stateCenter.reportSeqList.startPlay[e],E(o(o({},t),{errorCode:t.code,extendedData:t.message+(s?" "+s:"")}))};if(n.ClientUtil.isParamEmpty(e))if(n.ClientUtil.isTypeString(e))if(n.ClientUtil.isTooLong(e,s.MAX_STREAM_ID_LENGTH))if(n.ClientUtil.checkIllegalCharacters(e)){if(r.stateCenter.customPlayUrl&&0!=r.stateCenter.customPlayUrl.length)return r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0)?(r.streamCenter.playErrorCallBackList[e]=function(e){d(e)},r.streamCenter.startPlayingStream(e,r.stateCenter.customPlayUrl,1)):void d(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError,"cannot start play");if(r.rtm.modules.service.isDisConnect())d(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError);else if(r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0)){if(r.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),n.ClientUtil.logReportCallback("kZegoTaskPlayStart"+e,r.dataReport,l,r.stateCenter.reportList),r.dataReport.addMsgInfo(l,{stream:i.ZegoWechatLogEvent.kZegoTaskPlayStart.stream(e),playOption:i.ZegoWechatLogEvent.kZegoTaskPlayStart.playOption(t)}),!t||"CDN"!=t.sourceType&&"BGP"!=t.sourceType||r.setPreferPlaySourceType(s.ENUM_SOURCE_TYPE[t.sourceType]),r.streamCenter.playSuccessCallBackList[e]=function(e,t){n.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,"get_play_url"),_({streamID:e,url:t})},r.streamCenter.playErrorCallBackList[e]=function(t){n.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,"get_play_url"),d(t)},t&&t.isMix)return r.mixStreamList[e]={ultra_url_rtmp:null},void r.fetchPlayStreamUrl(e,"rtmp_cdn");n.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventStart,"get_play_url"),r.preferPlaySourceType==s.ENUM_PLAY_SOURCE_TYPE.cdn?r.startPlayingStreamFromCDN(e):r.startPlayingStreamFromBGP(e)}else d(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError,"cannot start play")}else d(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError);else d(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDTooLongError);else d(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayParamError);else d(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDNullError)}))},e.prototype.stopPlayingStream=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+" call "+e);var t=s.getReportSeq();if(this.dataReport.newReport(t,i.ZegoWechatLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(t,{stream_id:e}),"string"!=typeof e||""==e)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+" stream ID must be string and not empty"),this.dataReport.addMsgInfo(t,i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayParamError),void this.dataReport.uploadReport(t);var r=this.streamCenter.playerList[e];for(var o in r&&r.state!==s.ENUM_PLAYER_STATE.stop&&this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,message:""}),this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[o]===e){delete this.stateCenter.streamUrlMap[o];break}this.mixStreamList[e]&&delete this.mixStreamList[e],this.dataReport.uploadReport(t),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+" call success")},e.prototype.startPlayingStreamFromCDN=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+" call "+e);for(var t=null,r=0;r<this.stateCenter.streamList.length;r++)if(this.stateCenter.streamList[r].stream_id===e){t=this.stateCenter.streamList[r].urls_rtmp||[];break}return!t||t.length<=0?(this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+" cannot find stream url,Please check if CDN is configured "),this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e,i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError),!1):(this.currentPlaySourceType=s.ENUM_DISPATCH_TYPE.cdn,this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+" play stream"),this.doPlayStream(e,t,this.currentPlaySourceType))},e.prototype.startPlayingStreamFromBGP=function(e){return this.currentPlaySourceType=s.ENUM_DISPATCH_TYPE.ultra,this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP+" fetch stream url"),this.fetchPlayStreamUrl(e,this.ultraPlaySourceType),!0},e.prototype.doPlayStream=function(e,t,r){return this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_DO_PLAY_STREAM+" call"),this.streamCenter.startPlayingStream(e,t,r),!0},e.prototype.fetchPlayStreamUrl=function(e,t){var r=this;if(this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" call "+e),this.rtm.modules.service.isDisConnect())this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" state error");else{this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" send fetch request");var o={stream_ids:[e],url_type:t},n=this.rtm.modules.service.sendMessage("stream_url",o,(function(e){r.handleFetchStreamUrlRsp(e)}),(function(e){r.stateCenter.streamUrlMap[n]?r.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r.stateCenter.streamUrlMap[n],i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError):r.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" already stop play")}));-1!==n&&(this.stateCenter.streamUrlMap[n]=e,this.streamCenter.playerList[e]&&(this.streamCenter.playerList[e].seq=n)),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" call success")}},e.prototype.handleFetchStreamUrlRsp=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" call ");var t=this.stateCenter.streamUrlMap[e.header.seq];if(t&&delete this.stateCenter.streamUrlMap[e.header.seq],0!==e.body.err_code)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" server error= "+e.body.err_code),void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,t,i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError);if(e.body.stream_url_infos&&e.body.stream_url_infos.length>0){var r=e.body.stream_url_infos[0].stream_id,o=e.body.stream_url_infos[0].urls_ws,n=this.currentPlaySourceType,_=!1;if(e.header.seq!==this.streamCenter.playerList[r].seq)return void this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" seq is not match, ignore "+r);for(var E=0;E<this.stateCenter.streamList.length;E++)if(this.stateCenter.streamList[E].stream_id==r){this.stateCenter.streamList[E].urltra_url_rtmp=o,_=!0;break}!_&&this.mixStreamList[r]&&(this.mixStreamList[r].urltra_url_rtmp=o,n=s.ENUM_DISPATCH_TYPE.cdn,_=!0),_||(this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+"cannot find streamInfo in existing stream list"),this.stateCenter.streamList.push({stream_id:r,urltra_url_rtmp:o})),this.doPlayStream(r,o,n)}this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" call success")},e.prototype.setPreferPlaySourceType=function(e){return this.logger.info(a.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+" call"),e!==s.ENUM_PLAY_SOURCE_TYPE.cdn&&e!==s.ENUM_PLAY_SOURCE_TYPE.ultra?(this.logger.error(a.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+" sourceType can be number 0 or 1, which can be represented auto or ultra"),!1):(this.preferPlaySourceType=e,this.logger.info(a.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+" call success"),!0)},e}();t.PlayModule=_}])}));