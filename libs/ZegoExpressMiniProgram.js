!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var o in r)("object"==typeof exports?exports:e)[o]=r[o]}}("undefined"!=typeof self?self:this,(function(){return e={828:function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressEngine=void 0;var n=r(165),a=i(r(126)),l=i(r(12)),u=i(r(577));n.ZegoExpressEngine.use(a.default),n.ZegoExpressEngine.use(l.default),n.ZegoExpressEngine.use(u.default);var c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t}(n.ZegoExpressEngine);t.ZegoExpressEngine=c},165:function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoExpressEngine=void 0;var i=r(706),n=r(130),a=function(e){function t(t,r){var o=this;return i.ZegoExpressWebRTMEngine.version="2.11.1",(o=e.call(this,t,r,1)||this).zegoWechatMini=new n.ZegoWechatMini(o.logger,o.dataReport,o.zegoWebRTM),o}return s(t,e),t.prototype.getNextUrl=function(e){return this.zegoWechatMini.getNextUrl(e)},t.prototype.startPlayingStream=function(e,t){return this.zegoWechatMini.startPlayingStream(e,t)},t.prototype.stopPlayingStream=function(e){return this.zegoWechatMini.stopPlayingStream(e)},t.prototype.updatePlayerNetStatus=function(e,t){return this.zegoWechatMini.updatePlayerNetStatus(e,t)},t.prototype.updatePlayerState=function(e,t){return this.zegoWechatMini.updatePlayerState(e,t)},t.prototype.updateAudioVolumeNotify=function(e,t){return this.zegoWechatMini.updateAudioVolumeNotify(e,t)},t.prototype.checkSystemRequirements=function(){return this.zegoWechatMini.checkSystemRequirements()},t.prototype.setMixerTaskConfig=function(e){return this.zegoWechatMini.setMixerTaskConfig(e)},t.prototype.startMixerTask=function(e){return this.zegoWechatMini.startMixerTask(e)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.off(e,t)},t.prototype.stopMixerTask=function(e){return this.zegoWechatMini.stopMixerTask(e)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.on(e,t)},t.prototype.startPublishingStream=function(e,t){return this.zegoWechatMini.startPublishingStream(e,t)},t.prototype.stopPublishingStream=function(e){return this.zegoWechatMini.stopPublishingStream(e)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.addPublishCdnUrl(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.removePublishCdnUrl(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWechatMini.setStreamExtraInfo(e,t)},t.use=function(e){i.ZegoExpressWebRTMEngine.use(e),n.ZegoWechatMini.use(e)},t.prototype.initContext=function(e){this.zegoWechatMini.initContext(e)},t.prototype.createPusher=function(e){return this.zegoWechatMini.createPusher(e)},t.prototype.getPusherInstance=function(){return this.zegoWechatMini.getPusherInstance()},t.prototype.getPlayerInstance=function(e,t){return this.zegoWechatMini.getPlayerInstance(e,t)},t.prototype.mutePublishStreamVideo=function(e){this.zegoWechatMini.mutePublishStreamVideo(e)},t.prototype.mutePublishStreamAudio=function(e){this.zegoWechatMini.mutePublishStreamAudio(e)},t.prototype.mutePlayStreamVideo=function(e,t){this.zegoWechatMini.mutePlayStreamVideo(e,t)},t.prototype.mutePlayStreamAudio=function(e,t){this.zegoWechatMini.mutePlayStreamAudio(e,t)},t.prototype.setPusherAttributes=function(e){this.zegoWechatMini.setPusherAttributes(e)},t.prototype.setPlayerAttributes=function(e,t){this.zegoWechatMini.setPlayerAttributes(e,t)},t.prototype.getPlayerList=function(e){return this.zegoWechatMini.getPlayerList(e)},t}(i.ZegoExpressWebRTMEngine);t.ZegoExpressEngine=a},89:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.CONSTRUCTOR="zc.0",e.CHECK_SUPPORT="zc.csr",e.CREATE_STREAM="zc.cs",e.DESTROY_STREAM="zc.ds",e.START_PUBLISHING_STREAM="zc.sps.0",e.START_PLAYING_STREAM="zc.sps.1",e.STOP_PUBLISHING_STREAM="zc.sps.0.0",e.STOP_PLAYING_STREAM="zc.sps.1.0",e.SET_MEDIA_SIDE_FLAGS="zc.smsg.0",e.SEND_MEDIA_SIDE_INFO="zc.smsi.0",e.ON_STREAM="zc.os",e.ON_PUSH_STREAM_UPDATE="zc.opsu",e.BIND_WINDOW_LISTENER="zc.wl",e.SET_AUDIO_OUTPUT="zc.sao",e.SET_CUSTOM_SIGNAL_URL="zc.scsu",e.SET_TURN_OVER_TCP_ONLY="zc.stoto",e.RDH_ACTIVE="zc.rdh.a",e.RDH_MAX_TIME="zc.rdh.m",e.RDH_WEBRTC_URL_RSP="zc.rdh.hfwur",e.PUBLISH_STATE_HANDLE="zc.psh.0",e.PLAY_STATE_HANDLE="zc.psh.1",e.STATECENTER_ACTION_LISTENER="zc.sc.al",e.STATECENTER_SET_SETTING="zc.sc.ss",e.SIGNAL_SET_SESSION_INFO="zc.s.ssi",e.SIGNAL_RESET_CONNECT_TIMER="zc.s.rct",e.SIGNAL_BIND_WEBSOCKET_HANDLE="zc.s.bwh",e.SIGNAL_RESET_CHECK_MESSAGE="zc.s.rcm",e.SIGNAL_UPDATE_TOKEN="zc.s.ut",e.SIGNAL_SEND_MESSAGE_WITH_CALLBACK="zc.s.smwc",e.SIGNAL_CONNECT_SERVER="zc.s.cs.0",e.SIGNAL_START_CONNECT_TIMER="zc.s.sct",e.SIGNAL_DISCONNECT_SERVER="zc.s.dc",e.SIGNAL_CREATE_SESSION="zc.s.cs.1",e.SIGNAL_REMOVE_SESSION="zc.s.rs",e.SIGNAL_SEND_REMOVE_SESSION="zc.s.srs",e.SIGNAL_SEND_MESSAGE="zc.s.sm",e.SIGNAL_HANDLE_RESPOND_DATA="zc.s.hrd",e.SIGNAL_ADD_SESSION="zc.s.as",e.SIGNAL_HANDLE_PUSH_DATA="zc.s.hpd",e.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA="zc.s.hprsd",e.SIGNAL_SEND_MEDIA_DESC="zc.s.smd",e.SIGNAL_SEND_CANDIDATE_INFO="zc.s.sci",e.SIGNAL_SEND_MEDIA_DESC_ACK="zc.s.smda",e.SIGNAL_SEND_CANDIDATE_INFO_ACK="zc.s.scia",e.SIGNAL_SEND_CLOSE_SESSION_ACK="zc.s.scsa",e.SIGNAL_SEND_RESET_SESSION_ACK="zc.s.srsa",e.SIGNAL_REGISTER_PUSH_CALLBACK="zc.s.rpc",e.SIGNAL_CHECK_MESSAGE_TIMEOUT="zc.s.cmt",e.SIGNAL_SEND_HEARTBEAT="zc.s.sh",e.SIGNAL_QUALITY_REPORT="zc.s.qr",e.SIGNAL_SEND_STREAM_STATUS="zc.s.sss",e.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM="zc.s.apvs",e.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM="zc.s.apas",e.SIGNAL_SEND_BROADCAST_STATUS="zc.s.sbs",e.SIGNAL_SEND_NET_PROBE="zc.s.snp",e.SIGNAL_SEND_NET_QUALITY_INFO_PUSH_ACK="zc.s.npa",e.PUBLISHER_START_PUBLISH="zc.p.0.sp.0",e.PUBLISHER_PUBLISH_SUCCESS="zc.p.ps",e.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS="zc.p.0.ocpss",e.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.0.hcsws",e.PUBLISHER_ON_CREATE_OFFER_SUCCESS="zc.p.0.ocos",e.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.0.oslds",e.PUBLISHER_ON_GET_REMOTE_DESCRIPTION="zc.p.0.ogrd",e.PUBLISHER_ON_RECV_MEDIA_DESC="zc.p.0.ormd",e.PUBLISHER_ON_RECV_CANDIDATE_INFO="zc.p.0.orci.0",e.PUBLISHER_ON_RECV_PUBLISH_EVENT="zc.p.0.orpe",e.PUBLISHER_ON_RECV_CLIENT_INFO="zc.p.0.orci.1",e.PUBLISHER_ON_ICE_CANDIDATE="zc.p.0.oic",e.PUBLISHER_ON_CONNECTION_STATE_CHANGE="zc.p.0.ocsc",e.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.0.oicsc",e.PUBLISHER_RESET_PUBLISH="zc.p.0.rp",e.PUBLISHER_SET_PLAYER_QUALITY_TIMER="zc.p.0.spqt",e.PUBLISHER_UPLOAD_PUBLISH_QUALITY="zc.p.0.upq",e.PUBLISHER_ON_RECV_RESET_SESSION="zc.p.0.orrs",e.PUBLISHER_ON_RECV_CLOSE_SESSION="zc.p.0.orcs",e.PUBLISHER_SEND_CANDIDATE_INFO="zc.p.0.sci",e.PUBLISHER_STATE_ERROR="zc.p.0.psr",e.PUBLISHER_STOP_PUBLISH="zc.p.0.sp.1",e.PUBLISHER_ON_DISCONNECT="zc.p.0.od",e.PUBLISHER_START_SOUND_LEVEL="zc.p.0.ssl.0",e.PUBLISHER_STOP_SOUND_LEVEL="zc.p.0.ssl.1",e.PUBLISHER_HANDLE_ENC_BITRATE="zc.p.0.heb",e.PUBLISHER_ON_RECV_NET_QUALITY_INFO="zc.p.0.nqi",e.PUBLISHER_ON_RECV_UPDATE_MEDIA_DESC="zc.p.0.orumd",e.PUBLISHER_SEND_SEI="zc.p.0.ss",e.PLAYER_START_PLAY="zc.p.1.sp.0",e.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS="zc.p.ocpss.1",e.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP="zc.p.hcsws.1",e.PLAYER_ON_CREATE_OFFER_SUCCESS="zc.p.ocos.1",e.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS="zc.p.oslds.1",e.PLAYER_ON_RECV_MEDIA_DESC="zc.p.ormd.1",e.PLAYER_ON_RECV_CANDIDATE_INFO="zc.p.orci.1",e.PLAYER_ON_RECV_PLAY_EVENT="zc.p.orpe.1",e.PLAYER_ON_RECV_CLIENT_INFO="zc.p.orci.1.1",e.PLAYER_ON_ICE_CANDIDATE="zc.p.oic.1",e.PLAYER_ON_CONNECTION_STATE_CHANGE="zc.p.ocsc.1",e.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE="zc.p.oicsc.1",e.PLAYER_RESET_PLAY="zc.p.rp.1",e.PLAYER_SET_PLAYER_QUALITY_TIMER="zc.p.spqt.1",e.PLAYER_UPLOAD_PLAYER_QUALITY="zc.p.upq.1",e.PLAYER_ON_RECV_RESET_SESSION="zc.p.orrs.1",e.PLAYER_ON_RECV_CLOSE_SESSION="zc.p.orcs.1",e.PLAYER_ON_RECV_STREAM_STATUS="zc.p.orss.1",e.PLAYER_ON_GOT_REMOTE_STREAM="zc.p.ogrs.1",e.PAYER_GET_VIDEO_CODEC="zc.p.gvc",e.PLAYER_SEND_CANDIDATE_INFO="zc.p.sci.1",e.PLAYER_STATE_ERROR="zc.p.psr.1",e.PLAYER_STOP_PLAY="zc.p.1.sp.1",e.PLAYER_ON_DISCONNECT="zc.p.od.1",e.PLAYER_START_SOUND_LEVEL="zc.p.ssl.1",e.PLAYER_STOP_SOUND_LEVEL="zc.p.ssl.1.1",e.PLAYER_ON_RECV_NET_QUALITY_INFO="zc.p.1.nqi",e.UPLOAD_SPEED_LOG_QUALITY="zc.uslq",e.PUBLISH_SET_CAPTURE_VOLUME="zc.p.scv",e.PUBLISH_SET_BEAUTY_EFFECT="zc.p.0.sbe",e.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ="zc.sh.msbss",e.STREAMHANDLER_MERGE_STREAM="zc.sh.ms",e.STREAMHANDLER_PATCH_STREAM_LIST="zc.sh.psl",e.STREAMHANDLER_SEND_BIZCHANNEL_REQUESTV2="zc.sh.sbr",e.ANALOGSOCKET_UPDATE_MEDIA_READY_STATE="zc.as.umrs",e.ANALOGSOCKET_UPDATE_ACCESS_READY_STATE="zc.as.uars",e.ANALOGSOCKET_SET_MEDIA_SERVER_STATE="zc.as.smss",e.ANALOGSOCKET_SET_ACCESS_SERVER_STATE="zc.as.sass",e.ANALOGSOCKET_SEND="zc.as.s.0",e.ANALOGSOCKET_OPEN="zc.as.op"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={}))},98:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZEGO_WECHATMINI_ACTION=void 0,function(e){e.ADD_PUBLISH_CDN_URL="zw.apcu",e.REMOVE_PUBLISH_CDN_URL="zw.rpcu",e.STOP_MIXER_TASK="zw.smt",e.ON_STREAM="zw.os",e.ON_PUSH_STREAM_UPDATE="zw.opsu",e.ON_PUBLISH_STATE_UPDATE="zw.w.opsu",e.ON_PUBLISH_STATE_UPDATE_HANDLE="zw.w.opsuh",e.WECHATMINI_SETPREFERPLAYSOURCETYPE="zw.w.sppst.1",e.WECHATMINI_BIND_LISTENER="zw.w.bl",e.WECHATMINI_DELETE_LISTENER="zw.w.dl",e.WECHATMINI_UPDATE_PLAYER_STATE="zw.w.ups",e.WECHATMINI_UPDATE_PLAYER_NET_STATUS="zw.w.upns",e.WECHATMINI_UPDATE_PLAYER_VOLUME_NOTIFY="zw.w.upvn",e.WECHATMINI_SET_CUSTOM_SIGNAL_URL="zw.w.scsu",e.WECHATMINI_GET_NEXT_URL="zw.w.gnu",e.WECHATMINI_BIND_STREAM_CENTER_HANDLER="zw.w.bsch",e.WECHATMINI_BIND_RTM_LISTENER="zw.w.brl",e.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE="zw.pu.sppst.0",e.PUBLISHMODULE_START_PUBLISHING_STREAM="zw.pu.sps.0",e.PUBLISHMODULE_STOP_PUBLISHING_STREAM="zw.pu.sps.0.0",e.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL="zw.pu.fpsu.0",e.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP="zw.pu.hfspur.0",e.PUBLISHMODULE_DO_PUBLISH_STREAM="zw.pu.dps.0",e.PUBLISHMODULE_UPDATE_STREAM_INFO="zw.pu.upi",e.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP="zw.pu.hsur",e.PLAYMODULE_START_PLAYING_STREAM="zw.pl.sps.1",e.PLAYMODULE_STOP_PLAYING_STREAM="zw.pl.sps.1.0",e.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN="zw.pl.spsfc",e.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP="zw.pl.spsfb",e.PLAYMODULE_DO_PLAY_STREAM="zw.pl.dps",e.PLAYMODULE_FETCH_PLAY_STREAM_URL="zw.pl.fpsu",e.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP="zw.pl.hfsur",e.STREAMCENTERWECHAT_RESET="zw.scw.r.0",e.STREAMCENTERWECHAT_START_PUBLISHING_STREAM="zw.scw.sps.0",e.STREAMCENTERWECHAT_START_PLAYING_STREAM="zw.scw.sps.1",e.STREAMCENTERWECHAT_START_PLAYER="zw.scw.sp.0",e.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE="zw.scw.opuu.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE="zw.scw.ups.0",e.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS="zw.scw.upns",e.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE="zw.scw.ups.0.0",e.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE="zw.scw.ups.1.0",e.STREAMCENTERWECHAT_GET_NEXT_URL="zw.scw.gnu",e.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM="zw.scw.sps.0.0",e.STREAMCENTERWECHAT_STOP_PLAYING_STREAM="zw.scw.sps.1.0",e.STREAMCENTERWECHAT_STOP_PLAYER="zw.scw.sp.1",e.STREAMCENTERWECHAT_ON_PLAY_START="zw.scw.ops.0",e.STREAMCENTERWECHAT_ON_PLAY_STOP="zw.scw.ops.1",e.STREAMCENTERWECHAT_ON_PLAY_RETRY="zw.scw.opr",e.PLAYWECHAT_TRY_START_PLAYER="zw.pw.tsp.0",e.PLAYWECHAT_UPDATE_EVENT="zw.pw.ue",e.PLAYWECHAT_GET_PLAY_URL="zw.pw.gpu"}(t.ZEGO_WECHATMINI_ACTION||(t.ZEGO_WECHATMINI_ACTION={}))},325:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StateCenter=void 0;var o=r(706),s=r(608),i=r(89),n=r(706),a=r(529),l=function(){function e(e,t){this.logger=e,this.dataReport=t,this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.useNetAgent=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.publishStreamList={},this.waitPublishStreamList={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],capturedSoundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[],receiveRealTimeSequentialData:[],beautyEffectOverload:[],playerRecvSEI:[],beautyEffectError:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=n.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.checkList=[],this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.streamConnectTime=0,this.clientIP="",this.type="PUBLIC",this.roomList=[],this.tempRoomList=[],this.isMultiRoom=!1,this.browser="",this.unregisterSeiFilter="",this.isTestMode=!1,this.playAccelerate=!0,this.softCoding=!0,this.connectChanged=!1,this.logReportCallback=s.ClientUtil.logReportCallback,this.unregisterCallback=s.ClientUtil.unregisterCallback,this.checkIllegalCharacters=s.ClientUtil.checkIllegalCharacters,this.decodeServerError=s.ClientUtil.decodeServerError,this.getLiveRoomError=s.ClientUtil.getLiveRoomError,this.getServerError=s.ClientUtil.getServerError,this.mergeStreamList=s.ClientUtil.mergeStreamList,this.checkInteger=s.ClientUtil.checkInteger,this.isUrl=s.ClientUtil.isUrl,this.actionSuccessCallback=s.ClientUtil.actionSuccessCallback,this.checkValidNumber=s.ClientUtil.checkValidNumber,this.getDevices=s.ClientUtil.getDevices,this.uint8arrayToBase64=s.ClientUtil.uint8arrayToBase64,this.getSeq=n.getSeq,this.getReportSeq=o.getReportSeq}return e.prototype.getRequestId=function(){return this.idName+"-"+n.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r,o){var s={request_id:t,room_id:e,from_userid:this.idName,from_username:this.nickName,to_userid:r};return null!=o&&(s.result=o),JSON.stringify(s)},e.prototype.actionListener=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];if(!["playQualityUpdate","publishQualityUpdate","soundLevelUpdate","capturedSoundLevelUpdate"].includes(e)&&this.listenerList[e]){var n=o.getReportSeq();this.dataReport.newReport(n,a.ZegoRTCLogEvent.kZegoListener.event),this.dataReport.addMsgInfo(n,{listener:e,params:r}),this.dataReport.uploadReport(n)}this.listenerList[e]&&this.listenerList[e].forEach((function(o){try{setTimeout((function(){o.apply(void 0,r)}),0)}catch(r){t.logger.error(i.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+" "+e+" "+r)}}))},e.prototype.getRoomByRoomID=function(e){return this.roomList.find((function(t){return t.roomID==e}))},e.prototype.getPlayRoom=function(e){return this.roomList.find((function(t){return!!t.streamList.find((function(t){return t.stream_id==e}))}))},e}();t.StateCenter=l},740:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenter=void 0,t.ZegoStreamCenter=function(){this.publisherList={},this.playerList={},this.stopedPlayerList={}}},560:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StreamHandler=void 0;var o=r(706),s=r(752),i=r(89),n=function(){function e(e,t,r,o,s){this.logger=e,this.stateCenter=t,this.rtm=r,this.streamCenter=o,this.roomID=s,this.minStreamSeq=0,this.streamSeq=0,this.streamQuerying=!1,this.streamSeqMergeMap=null,this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]||"":"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]||"":"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]||"":"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]||"":"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]||"":"string"==typeof t.urls_rtmp?t.urls_rtmp:""},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){this.logger.info("zb.sh.hss call stream update"),this.room=t,e.body?(this.streamListHBMergeInterval=e.body.stream_list_hb_wait_merge_time||2e3,this.streamListMergeInterval=e.body.stream_list_push_merge_timeout||5e3,this.streamQuerying=!1,this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info("zb.sh.hss call end")):this.logger.error("zb.sh.hss server response wrong")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,i){var n,a,l=this;void 0===r&&(r=""),this.logger.info("zb.sh.usi call");var u=r,c=null===(n=this.room)||void 0===n?void 0:n.streamList.find((function(t){return t.stream_id===e}));c||this.logger.warn("zb.sh.usi stream not in room cmd "+t);var h={stream_id:e,extra_info:u};2002!==t&&2003!==t||(h.stream_sid=(null==c?void 0:c.stream_sid)||"");var g=JSON.stringify(h),d={sub_cmd:t,stream_msg:g,third_token:null===(a=this.room)||void 0===a?void 0:a.token},_=this.room;this.room.streamInfoList[e]={};var p=function(r,o){l.handleStreamUpdateRsp(r,e,t)},E=function(n,a){var u=l.room;if(u&&!u.isResetRoom&&!l.rtm.isDisConnect()&&n.code&&n.code==s.errorCodeList.TIMEOUT.code&&u.streamInfoList[e].seq==a)2001==t&&l.stateCenter.publishStreamList[e]&&l.stateCenter.publishStreamList[e].state==o.ENUM_PUBLISH_STREAM_STATE.update_info||2002==t?setTimeout((function(){l.updateStreamInfo(e,t,r,i)}),0):i&&i(s.errorCodeList.TIMEOUT);else if(n.body&&n.body.err_code){var c=l.stateCenter.getServerError(n.body.err_code,l.stateCenter.useNetAgent,n.body.err_message);[1011,1000002002].includes(c.code)&&(c=s.errorCodeList.TOKEN_EXPIRED),i&&i(c,a),t===o.ENUM_STREAM_SUB_CMD.liveBegin&&l.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,e,c)}};this.stateCenter.useNetAgent?this.rtm.liveRoomHandler.sendStreamUpdate(d,p,E,{sessionID:null==_?void 0:_.sessionID,roomID:null==_?void 0:_.roomID,roomSessionID:null==_?void 0:_.roomSessionID}):this.room.streamInfoList[e].seq=this.rtm.service.sendMessage("stream",d,p,E,void 0,{sessionID:null==_?void 0:_.sessionID,roomID:null==_?void 0:_.roomID,roomSessionID:null==_?void 0:_.roomSessionID}),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e,t,r){var o,s,i;if(this.rtm.isDisConnect())this.logger.warn("zb.sh.hsur not login");else if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.streamSeq+" server seq "+e.body.stream_seq),this.streamSeq=e.body.stream_seq;var n=this.room;if(n)if((null===(o=null==e?void 0:e.body)||void 0===o?void 0:o.token_remain_time)&&(this.stateCenter.getRoomByRoomID(null===(s=null==e?void 0:e.header)||void 0===s?void 0:s.room_id)?this.rtm.resetRoomTokenTimer(e.header.room_id,e.body.token_remain_time):this.logger.error("zb.sh.hsur room no found ignore "+JSON.stringify(null===(i=e.header)||void 0===i?void 0:i.room_id))),this.stateCenter.useNetAgent)this.handleStreamSync(e,t,r);else for(var a=0;a<e.body.stream_info.length;a++){var l=e.body.stream_info[a].stream_id;this.handleStreamRsp(n,l,e.body.stream_info[a],r),delete n.streamInfoList[l]}else this.logger.info("hsur.0 room no found")}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code)},e.prototype.handleStreamSync=function(e,t,r){if(e.body.stream_seq>this.streamSeq)this.fetchStreamList();else{var o=this.room.streamList.find((function(e){return e.stream_id==t}));o&&e.body.stream_ver>o.stream_ver?this.fetchStreamList(t):this.handleStreamRsp(this.room,t,{stream_id:t,stream_sid:e.body.stream_sid,stream_ver:e.body.stream_ver,stream_nid:e.body.stream_nid},r)}},e.prototype.handleStreamRsp=function(e,t,r,s){var i=this.stateCenter.publishStreamList[t];i?i.state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(i.state=o.ENUM_PUBLISH_STREAM_STATE.publishing,this.logger.info("hsur.0 cmd "+s),2001===s||e.streamList.find((function(e){return e.stream_id==t}))||e.streamList.push(r),this.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.start,t,{code:0,message:""})):this.logger.info("hsur.0 stream is not exist")},e.prototype.handleFetchStreamListRsp=function(e,t){if(this.logger.info("zb.sh.hfslr call"),this.streamQuerying=!1,0===e.body.err_code)if(this.streamSeq!==e.body.stream_seq){var r=e.body.stream_info;t&&(r=e.body.stream_info.filter((function(e){return e.stream_id===t}))),this.handleFullUpdateStream(e.body.stream_seq,r),this.logger.info("zb.sh.hfslr call success")}else this.logger.info("zb.sh.hfslr same seq");else this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info("zb.sh.hfus call"),this.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.streamSeq),this.stateCenter.mergeStreamList(this.stateCenter.idName,this.room.streamList,t,(function(e,t,s){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==s.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.roomID,r.makeCallbackStreamList(s)))})),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.warn("zb.sh.hpsum call "+JSON.stringify(e)),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handlePriPushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.streams_info&&0!==e.body.streams_info.length){if(e.body.streams_info.length+this.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.mergeStreamByStreamSeq(e.body.stream_cmd,e.body.stream_seq,e.body.streams_info);switch(this.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD_PRI.added:this.handleAddedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.deleted:this.handleDeletedStreamList(e.body.streams_info);break;case o.ENUM_STREAM_UPDATE_CMD_PRI.updated:this.handleUpdatedStreamList(e.body.streams_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],s=0;s<e.length;s++)if(e[s].anchor_id_name!=this.stateCenter.idName&&e[s].id_name!=this.stateCenter.idName&&e[s].user_id!==this.stateCenter.idName){t=!1;for(var i=0;i<this.room.streamList.length;i++)if(e[s].stream_id===this.room.streamList[i].stream_id){t=!0;break}t||r.push(e[s])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var n=0;n<r.length;n++)this.room.streamList.push(r[n]);this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var s=this.room.streamList.length-1;s>=0;s--)if(e[r].stream_id===this.room.streamList[s].stream_id){!this.stateCenter.connectChanged&&this.room.streamList.splice(s--,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.roomID,o.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName&&e[r].id_name!=this.stateCenter.idName&&e[r].user_id!==this.stateCenter.idName){for(var o=0;o<this.room.streamList.length;o++)if(e[r].stream_id===this.room.streamList[o].stream_id){e[r].extra_info!==this.room.streamList[o].extra_info&&(this.room.streamList[o]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.roomID,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(e){var t,r,o,s=this;if(this.logger.info("zb.sh.fsl call"),this.rtm.isDisConnect())this.logger.info("zb.sh.fsl state error");else if(this.streamQuerying)this.logger.info("zb.sh.fsl already doing");else{if(this.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),this.stateCenter.useNetAgent)this.rtm.liveRoomHandler.getStreamList({},(function(t){s.handleFetchStreamListRsp(t,e)}),(function(e){}),{roomID:null===(t=this.room)||void 0===t?void 0:t.roomID,sessionID:null===(r=this.room)||void 0===r?void 0:r.sessionID,roomSessionID:null===(o=this.room)||void 0===o?void 0:o.roomSessionID});else{var i=this.room;this.rtm.service.sendMessage("stream_info",{reserve:0},this.handleFetchStreamListRsp.bind(this),(function(e,t){}),void 0,{roomID:null==i?void 0:i.roomID,sessionID:null==i?void 0:i.sessionID,roomSessionID:null==i?void 0:i.roomSessionID})}this.logger.info("zb.sh.fsl call success")}},e.prototype.handleReconnectStream=function(e){var t,r,s,i,n,a;this.logger.info("zb.sh.hrs call");var l=this.streamCenter.publisherList,u=this.streamCenter.playerList,c=function(u){if((null===(r=null===(t=l[u])||void 0===t?void 0:t.room)||void 0===r?void 0:r.roomID)!==h.roomID)return"continue";if((null===(s=l[u].publisher)||void 0===s?void 0:s.state)!=o.ENUM_PUBLISH_STATE.publishing&&l[u].state!==o.ENUM_PLAYER_STATE.playing||e.find((function(e){return e.stream_id==u}))){if(((null===(i=l[u].publisher)||void 0===i?void 0:i.state)==o.ENUM_PUBLISH_STATE.stop||l[u].state===o.ENUM_PLAYER_STATE.stop)&&!(null===(a=null===(n=l[u])||void 0===n?void 0:n.retryStreamHandler)||void 0===a?void 0:a.maxTimer)&&e.find((function(e){return e.stream_id==u}))){h.updateStreamInfo(u,o.ENUM_STREAM_SUB_CMD.liveEnd);for(var c=0;c<h.room.streamList.length;c++)if(h.room.streamList[c].stream_id==u){h.room.streamList.splice(c--,1);break}}}else h.updateStreamInfo(u,o.ENUM_STREAM_SUB_CMD.liveBegin,h.stateCenter.publishStreamList[u].extra_info)},h=this;for(var g in l)c(g);for(var g in l)l[g].room.roomID===this.roomID&&l[g].isReDispatch&&(this.logger.info("zb.sh.hrs "+g+"retry dispatch"),(d=l[g].retryDispatchHandler).stopMaxTime(),d.invalid(),d.initStream(g,l[g].publishOption,!0),d.active(0),l[g].isReDispatch=!1);for(var g in u){var d;u[g].room.roomID===this.roomID&&u[g].isReDispatch&&(this.logger.info("zb.sh.hrs "+g+"retry dispatch"),(d=u[g].retryDispatchHandler).stopMaxTime(),d.invalid(),d.initStream(g,u[g].playOption,!1),d.active(0),u[g].isReDispatch=!1)}var _=this.streamCenter.stopedPlayerList,p=function(e){if(_[e].roomID!==E.roomID)return"continue";var t=E.streamCenter,r=_[e],s=r.playOption,i=r.playStream;t.setPlayStateStart(e,s,r.isDataChannel);var n=t.playerList[e].retryDispatchHandler;t.playSuccessCallBackList[e]=_[e].sucCallBack?_[e].sucCallBack:function(e){for(var t=document.querySelectorAll("video, audio"),r=0;r<t.length;r++)i&&t[r].srcObject===i&&(i.getTracks().forEach((function(e){return i.removeTrack(e)})),e.clone().getTracks().forEach((function(e){return i.addTrack(e)})))},_[e].errCallBack&&(t.playErrorCallBackList[e]=_[e].errCallBack),t.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),n.stopMaxTime(),n.invalid(),n.initStream(e,s,!1),n.startMaxTime(),n.active(0),delete _[e]},E=this;for(var g in _)p(g);this.logger.info("zb.sh.hrs end")},e.prototype.makeCallbackStreamList=function(e){var t,r=[];if(this.stateCenter.useNetAgent&&this.stateCenter.appConfig&&(t=this.stateCenter.appConfig.media_config.play_config.resource_info.find((function(e){return e.resource_type===o.SignalResourceType.CDN}))),e&&e.length>0)for(var s=0;s<e.length;s++){var i=[],n=[],a=[],l=e[s].stream_id;if(t){for(var u=0;u<t.service_info.length;u++){var c=t.service_info[u],h=c.url_template;switch(c.protocol){case o.ProtocolType.FLV:var g=h.replace("{STREAM_NAME}",l);i.push(g);break;case o.ProtocolType.HLS:var d=h.replace("{STREAM_NAME}",l);n.push(d);break;case o.ProtocolType.RTMP:var _=h.replace("{STREAM_NAME}",l);a.push(_)}}e[s].urls_flv=i,e[s].urls_m3u8=n,e[s].urls_rtmp=a}var p={user:{userID:e[s].anchor_id_name||e[s].id_name,userName:e[s].anchor_nick_name||e[s].nick_name},extraInfo:e[s].extra_info,streamID:e[s].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:"",streamGID:e[s].stream_gid,closeType:e[s].close_type};this.setCDNInfo(p,e[s]),r.push(p)}return r},e.prototype.sendBizChannelRequest=function(e,t,r,o){var s=this;void 0===o&&(o=!1),e=Object.assign(e,{is_retry_req:o?1:0});var i=this.room;this.rtm.service.sendMessage("biz_channel",e,(function(e,r){t(e.header.seq,e.body.cmd,e.body.rsp_body)}),(function(o,i){var n=o.body.err_code;"number"!=typeof n||2002!==n?r(n,i,o.body.rsp_body):s.sendBizChannelRequest(e,t,r,!0)}),void 0,{roomID:null==i?void 0:i.roomID,sessionID:null==i?void 0:i.sessionID,roomSessionID:null==i?void 0:i.roomSessionID})},e.prototype.sendBizChannelRequestV2=function(e,t,r,o){var s=this,n=e.server,a=e.location,l=e.cmd,u=e.channel,c=this.rtm.netAgent,h=this.room,g=void 0,d=t.timestamp;t&&(g=JSON.stringify(t));var _={cmd:l,req_body:g,appid:this.stateCenter.appid,timestamp:d||Math.ceil((new Date).getTime()/1e3),token:null==h?void 0:h.token,user_id:this.stateCenter.idName,channel:u||"media"};this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_SEND_BIZCHANNEL_REQUESTV2+" "+JSON.stringify(_)+" request "+JSON.stringify(e)),c.startHttpRequest({service:n,headers:[],body:_,idName:this.stateCenter.idName,method_no:2,ack:!1,location:a},(function(e){s.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_SEND_BIZCHANNEL_REQUESTV2+" rsp "+JSON.stringify(e.body));var n=e.status_code,a=e.body;if(200===n){var l=a;if("string"==typeof a)try{l=JSON.parse(a)}catch(e){throw o(n),e}var u=l.err_code,c=l.rsp_body,h=void 0;try{h=JSON.parse(c)}catch(e){h=c}if(0!==u)return"number"==typeof u&&2002===u?void s.sendBizChannelRequest(t,r,o,!0):void o(n,u,h);r(h)}else o(n)}),(function(e){o(-1,null==e?void 0:e.code,void 0,e)}))},e.prototype.updateStreamExtraInfo=function(e,t,r,o){},e.prototype.setStreamExtraInfo=function(e,t,r,o){},e.prototype._publishTarget=function(e,t,r){},e.prototype.patchStreamList=function(e){var t=this;if("number"==typeof e.body.StreamRefresh&&0!==e.body.StreamRefresh)return this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" stream refresh "),void this.fetchStreamList();e.body.stream_seq===this.streamSeq||this.streamSeqMergeMap||(this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_PATCH_STREAM_LIST+" call update stream "+this.streamSeq+" server "+e.body.stream_seq),this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.streamListHBMergeInterval)),this.minStreamSeq=e.body.stream_seq},e.prototype.getStreamSeq=function(){return this.streamSeq},e.prototype.mergeStreamByStreamSeq=function(e,t,r){var o=this;this.streamSeqMergeMap||(this.logger.warn(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" new merge stream list "+this.streamSeq+" server "+t),this.streamSeqMergeMap={},this.streamSeqMergeTimer&&clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=setTimeout((function(){o.handleMergeTimeout()}),this.streamListMergeInterval)),this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM_BY_STREAM_SEQ+" "+this.streamSeqMergeMap+" "+e+" "+t+" "+r),this.streamSeqMergeMap[t]={cmd:e,streamList:r}},e.prototype.handleMergeTimeout=function(){if(this.streamSeqMergeMap){var e=Object.keys(this.streamSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));e[e.length-1]-e[0]+1===e.length||e[e.length-1]>=this.minStreamSeq?this.mergeStream(e):(this.streamSeqMergeMap=null,this.fetchStreamList())}},e.prototype.mergeStream=function(e){var t=this;this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" merge streamList "+this.streamSeq+" streamSeqList "+e.join(","));var r=e[e.length-1],s=[];e.forEach((function(e){if(t.streamSeqMergeMap&&t.streamSeqMergeMap[e])switch(t.streamSeqMergeMap[e].cmd){case o.ENUM_STREAM_UPDATE_CMD.added:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=s.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&s.splice(t),s.push(e)}));break;case o.ENUM_STREAM_UPDATE_CMD.deleted:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=s.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&s.splice(t)}));break;case o.ENUM_STREAM_UPDATE_CMD.updated:t.streamSeqMergeMap[e].streamList.forEach((function(e){var t=s.findIndex((function(t){return t.stream_id==e.stream_id}));-1!==t&&s.splice(t),s.push(e)}))}})),this.streamSeqMergeMap=null,this.logger.info(i.ZEGO_WEBRTC_ACTION.STREAMHANDLER_MERGE_STREAM+" "+s),this.handleFullUpdateStream(r,s)},e.prototype.reset=function(){this.minStreamSeq=0,this.streamSeqMergeMap=null,this.streamSeqMergeTimer&&(clearTimeout(this.streamSeqMergeTimer),this.streamSeqMergeTimer=void 0),this.streamListHBMergeInterval=2e3,this.streamListMergeInterval=5e3},e}();t.StreamHandler=n},706:(e,t,r)=>{"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD_PRI=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.STREAM_DELETE_REASON=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_CMD_PRI=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_RETRY_CONNECT_INTERVAL=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.streamMap=t.ENUM_CONNECT_STATE=t.ProtocolType=t.SignalResourceType=t.ENUM_PROBE_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAYER_STATE=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.BusinessService=t.NetConnection=t.ZegoExpressWebRTM=t.ZegoDataReport=t.ZegoLogger=t.ZegoExpressWebRTMEngine=t.getReportSeq=t.getSeq=t.ZegoSEIType=t.QUALITY_CONSTANT=t.QualityGrade=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=t.ENUM_PUBLISH_STATE_UPDATE=t.LinkedList=t.ListNode=t.E_CLIENT_TYPE=void 0,t.PROTO_VERSION="2.11.1",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1500},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOfferRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOfferRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},function(e){e[e.tryProbe=0]="tryProbe",e[e.probed=2]="probed"}(t.ENUM_PROBE_STATE||(t.ENUM_PROBE_STATE={})),function(e){e[e.CDN=0]="CDN",e[e.RTC=1]="RTC",e[e.L3=2]="L3"}(t.SignalResourceType||(t.SignalResourceType={})),function(e){e[e.UDP=0]="UDP",e[e.RTMP=1]="RTMP",e[e.FLV=2]="FLV",e[e.HLS=3]="HLS",e[e.WEBRTC=4]="WEBRTC"}(t.ProtocolType||(t.ProtocolType={})),t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.streamMap={"/lr/push/stream_add":12001,"/lr/push/stream_delete":12002,"/lr/push/stream_update":12003},t.MAX_TRY_CONNECT_COUNT=3,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_RETRY_CONNECT_INTERVAL=12,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]="offline",e[e.online=1]="online"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.STREAM_DELETE_REASON={0:{code:1,description:"user_stop_publishing_stream_normal"},1:{code:2,description:"user_heart_beat_timeout"},2:{code:3,description:"user_repeat_login"},3:{code:4,description:"user_kicked_out"},4:{code:5,description:"user_offline"},100:{code:6,description:"remove_by_server"}},function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.CDN=1]="CDN",e[e.RTC=2]="RTC",e[e.L3=3]="L3"}(o||(o={})),t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.ENUM_STREAM_UPDATE_CMD_PRI={added:1,updated:2,deleted:3},t.SERVER_ERROR_CODE=1e4,function(e){e[e.low=1]="low",e[e.stantard=2]="stantard",e[e.hight=3]="hight",e[e.custome=4]="custome"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6,iceClosed:7,iceFailed:8},function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]="stop",e[e.start=1]="start"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra",e[e.customUrl=2]="customUrl"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]="CDN",e[e.BGP=1]="BGP"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var s=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=s;var i=function(){function e(){this.start=new s,this.end=new s,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new s(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this.insertBefore(this._numNodes>0?this.start.next:this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=i,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:"eventStart",eventEndWithMsgInfo:"eventEndWithMsgInfo",addEventMsg:"addEventMsg",addEvent:"addEvent",eventEnd:"eventEnd",addMsgInfo:"addMsgInfo"},function(e){e[e.Unknown=-1]="Unknown",e[e.Excellent=0]="Excellent",e[e.Good=1]="Good",e[e.Middle=2]="Middle",e[e.Poor=3]="Poor",e[e.Die=4]="Die"}(t.QualityGrade||(t.QualityGrade={})),function(e){e[e.MinQuality=0]="MinQuality",e[e.DieQuality=0]="DieQuality",e[e.PoorMinQuality=1]="PoorMinQuality",e[e.MiddleMinQuality=30]="MiddleMinQuality",e[e.GoodMinQuality=60]="GoodMinQuality",e[e.ExcellentMinQuality=85]="ExcellentMinQuality",e[e.MaxQuality=100]="MaxQuality"}(t.QUALITY_CONSTANT||(t.QUALITY_CONSTANT={})),function(e){e[e.ZegoDefined=0]="ZegoDefined",e[e.UserUnregister=1]="UserUnregister"}(t.ZegoSEIType||(t.ZegoSEIType={}));var n=r(545);Object.defineProperty(t,"getSeq",{enumerable:!0,get:function(){return n.getSeq}}),Object.defineProperty(t,"getReportSeq",{enumerable:!0,get:function(){return n.getReportSeq}}),Object.defineProperty(t,"ZegoExpressWebRTMEngine",{enumerable:!0,get:function(){return n.ZegoExpressWebRTMEngine}}),Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}}),Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return n.ZegoDataReport}}),Object.defineProperty(t,"ZegoExpressWebRTM",{enumerable:!0,get:function(){return n.ZegoExpressWebRTM}}),Object.defineProperty(t,"NetConnection",{enumerable:!0,get:function(){return n.NetConnection}}),Object.defineProperty(t,"BusinessService",{enumerable:!0,get:function(){return n.BusinessService}})},752:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},STREAMID_TOO_LONG:{code:1000014,message:"stream ID is too long"},STREAM_ID_NULL:{code:1000015,message:"streamID is empty"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:"stream ID contains illegal characters"},NETWORK_BROKEN:{code:1000017,message:"network is broken"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},INIT_SDK_WRONG:{code:1101e3,message:"init sdk wrong"},WX_GET_SETTING_FAIL:{code:1101001,message:"wx get setting fail"},GET_CONFIG_FAIL:{code:1101002,message:"get app config fail"},USER_ID_NULL:{code:1002005,message:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,message:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,message:"user ID is too long"},USER_NAME_NULL:{code:1002008,message:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,message:"username is too long"},ROOM_ID_NULL:{code:1002011,message:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,message:"room ID is too long"},LOGIN_TIMEOUT:{code:1002031,message:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,message:"users logging into the room exceeds the maximum number"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:"kickout may be the same user ID login other"},ROOM_RETRY_TIMEOUT:{code:1002053,message:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,message:"server has sent a signal to kick out"},ROOM_INNER_ERROR:{code:1002099,message:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,message:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,message:"parse json error."},LOGIN_PROCESSING:{code:1102012,message:"login is processing."},LIVEROOM_REQUEST_ERROR:{code:1102013,message:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,message:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,message:"user login state is wrong."},TOKEN_ERROR:{code:1102016,message:"token error"},DISPATCH_ERROR:{code:1102017,message:"dispatch error"},TOKEN_EXPIRED:{code:1102018,message:"token expired"},SUBCMD_ERROR:{code:1102019,message:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,message:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},DISPATCH_TIMEOUT:{code:1102022,message:"dispatch request timeout"},CONNECT_FAILED:{code:1102023,message:"connect signal fail"},PUBLISHER_MEDIA_SERVER_FORBID:{code:1003025,message:"stream is forbided by media server"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:"stream extra info is too long"},PUBLISHER_PARAM:{code:1103001,message:"input param error"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:"browser do not support"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:"dispatch request error"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:"screen fail"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:"enumerate devices fail"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:"dispatch request fail"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:"session request fail"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:"create offer error"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:"setLocalDescription error"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:"mediaDesc error"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:"other side offer error"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:"candidate error"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:"server session closed"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:"ice connection error"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:"negotiation timeout"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:"device change "},PUBLISH_SCREEN_CANCELED:{code:1103042,message:"screen canceled"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:"screen not support"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},REPEATED_PULL:{code:1103049,message:"repeated pull same stream"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:"websocket disconnected"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:"publisher retry timeout"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:"https is required"},PUBLISHER_NO_PREVIEW:{code:1103054,message:"no preview"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:"publish is publishing"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:"client ip changed"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:"ttl over time"},PUBLISHER_SESSION_TIMEOUT:{code:1103060,message:"session request timeout"},PUBLISHER_GET_USER_MEDIA_FAIL:{code:1103061,message:"get media fail"},PUBLISHER_DEVICE_NO_ALLOWED:{code:1103064,message:"get device not allowed"},PUBLISHER_DEVICE_NO_READABLE:{code:1103065,message:"device is not readable"},PUBLISHER_OVER_CONSTRAINED:{code:1103066,message:"device does not meet constraints"},PUBLISHER_UPDATE_SDP_TIMEOUT:{code:1103067,message:"update sdp time out"},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},VIDEO_EFFECT_IS_STARTING:{code:1103073,message:"video effect is starting, please operate after video effect is started"},PLAYER_PARAM:{code:1104001,message:"input parm error"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:"dispatch request fail"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:"session request fail"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:"create offer error"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:"setLocalDescription error"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:"mediaDesc error"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:"other side offer error"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:"candidate error"},PLAYER_SESSION_CLOSED:{code:1104027,message:"server session closed"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:"ice connection error"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:"websocket disconnected"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:"negotiation timeout"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:"player retry timeout"},PLAYER_IS_PLAYING:{code:1104032,message:"player is playing"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:"client ip changed"},PLAYER_TTL_OVERTIME:{code:1104034,message:"ttl is over time"},PLAYER_SESSION_RESET:{code:1104035,message:"reset session push"},PLAYER_SESSION_TIMEOUT:{code:1104036,message:"session request timeout"},PLAYER_PROBE_TIMEOUT:{code:1104037,message:"probe time out"},PLAYER_UNSUPPORTED_PROTOCOL:{code:1104038,message:"resource mode is not supported"},PLAYER_STREAM_NOT_EXIST:{code:1104039,message:"play stream not found"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:"the device is unplugged"},IM_CONTENT_NULL:{code:1009001,message:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,message:"message content is too long"},IM_SEND_FAILED:{code:1009010,message:"failed to send message"},FREQ_LIMITED:{code:1109001,message:"frequency limited."}}},529:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatLogEvent=t.ZegoRTCLogEvent=void 0;var o=r(752),s=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:"/sdk/create_stream",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:o.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:o.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:o.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:o.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:o.errorCodeList.PUBLISHER_HTTPS_REQUIRED,kGetUserMediaError:o.errorCodeList.PUBLISHER_GET_USER_MEDIA_FAIL,kDeviceNoAllowedError:o.errorCodeList.PUBLISHER_DEVICE_NO_ALLOWED,kDeviceNoReadableError:o.errorCodeList.PUBLISHER_DEVICE_NO_READABLE,kDeviceOverConstrainedError:o.errorCodeList.PUBLISHER_OVER_CONSTRAINED},stream_type:s,screen:s,camera:s,custom:s},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:o.errorCodeList.PUBLISH_NO_PREVIEW,kPublishEffectIsStarting:o.errorCodeList.VIDEO_EFFECT_IS_STARTING,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kMediaServerForbidError:o.errorCodeList.PUBLISHER_MEDIA_SERVER_FORBID,kPublishTokenExpiredError:o.errorCodeList.TOKEN_EXPIRED,kPublishSessionClosedError:o.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:o.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionTimeoutError:o.errorCodeList.PUBLISHER_SESSION_TIMEOUT,kSessionRequestError:o.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:o.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:o.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:o.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PUBLISHER_TTL_OVERTIME,kUpdateMediaDescriptionTimeOut:o.errorCodeList.PUBLISHER_UPDATE_SDP_TIMEOUT,kUpdateMediaDescriptionError:o.errorCodeList.PUBLISHER_UPDATE_SDP_FAIL},publishOption:s,message:s,session_id:s,stream:s,video_en_codec_id:s,cap_w:s,cap_h:s,w:s,h:s,video_en_fps:s,video_en_bps:s,audio_c_channel_count:s,audio_en_bps:s,aec_level:s,ans_level:s,agc:s,traffic_control_min_video_bitrate:s,use_na:s},kZegoTaskVideoCaptureSize:{event:"/sdk/api/publish_video_c_size",session_id:s,w:s,h:s},kZegoTaskVideoPlaySize:{event:"/sdk/play_video_size_changed",session_id:s,w:s,h:s},kZegoTaskRePublish:{event:"/sdk/republish",stream:s},kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayUnsupportedResourceMode:o.errorCodeList.PLAYER_UNSUPPORTED_PROTOCOL,kPlayStreamNotFound:o.errorCodeList.PLAYER_STREAM_NOT_EXIST,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:o.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:o.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:o.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSessionTimeoutError:o.errorCodeList.PLAYER_SESSION_TIMEOUT,kSetRemoteDescError:o.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:o.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:o.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:o.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PLAYER_TTL_OVERTIME,kProbeTimeOutError:o.errorCodeList.PLAYER_PROBE_TIMEOUT},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s,use_na:s},kZegoTaskRePlay:{event:"/sdk/replay",stream:s},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskEnumDevices:{event:"/device/list",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:s},kZegoTaskAudioOutput:{event:"/device/audio_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskVideoCapture:{event:"/device/video_capture",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskDeviceInterrupt:{event:"/device/interrupt",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,interrupt:s},kZegoTaskSetDebug:"/sdk/set_debug",kZegoTaskSetLog:"/sdk/set_log_config",kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",capability:s},kZegoTaskRemoteCameraUpdate:{event:"/sdk/remote_camera_update",stream:s,status:s},kZegoTaskRemoteMicUpdate:{event:"/sdk/remote_mic_update",stream:s,status:s},kZegoTaskDestroyStream:{event:"/sdk/destroy_stream",error:{kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:"/sdk/screen_share_end",kZegoTaskAudioOutputChanged:{event:"/device/api/audio_output",session_id:s,stream:s,device:s,reason:s},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:s},kZegoTaskPlayDecodeFirstVideoFrame:{event:"/sdk/play_decode_first_video_frame",session_id:s,fft_consumed:s},kZegoVisibilityChange:{event:"/app/background"},kZegoSetCaptureVolume:{event:"/sdk/set_capture_volume",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoListener:{event:"/sdk/listener"},kZegoNetProbe:{event:"/sdk/net_probe"},kZegoNetProbeResult:{event:"/sdk/net_probe_result"},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"}},t.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:"/sdk/check_system",error:{kCheckSystemGetSettingFailError:o.errorCodeList.WX_GET_SETTING_FAIL},capability:s},kZegoTaskPublishStart:{event:"/sdk/api/publish_request",error:{kPublishStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:s,stream:s,message:s},kZegoTaskPlayStart:{event:"/sdk/api/play_request",error:{kPlayStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s},kZegoEventPublishStat:"/sdk/publish_stat_report",kZegoEventPlayStat:"/sdk/play_stat_report",kZegoTaskRePublish:"/sdk/republish",kZegoTaskRePlay:"/sdk/replay",kZegoTaskPublishStop:{event:"/sdk/stop_publish",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStop:{event:"/sdk/stop_play",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:"/liveroom/get_stream_update_info",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:"/liveroom/get_stream_extra_info",update_stream:s}}},906:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.streamHandler=t.zegoWebRTC=void 0;var s=r(817),i=r(145),n="2.11.1",a=1e4,l={},u="addMsgInfo",c=1005027,h="mix stream input parameters are wrong";function g(e,t){var r,o,i,n,l="",u=s.errorCodeList;return t.errorCode<2e9&&t.errorCode>1e9?(i={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",190:"MIXER_START_REQUEST_ERROR"},n="MIXER_INNER_ERROR",(o=t.errorCode-a)>1e9&&i[o-1e9]&&(n=i[o-1e9]),r=u[l=n]):t.errorCode<1e6&&(r=e.decodeServerError(t.errorCode,t.extendedData),l=e.getLiveRoomError(t.errorCode,this.stateCenter.useNetAgent)),{reportErr:r,actualError:u[l]}}t.zegoWebRTC={startMixerTask:function(e){var t=this;return new Promise((function(r,o){var s=t.stateCenter.getReportSeq();t.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskMixStart.event),t.stateCenter.logReportCallback("kZegoTaskMixStart"+e.taskID,t.dataReport,s,t.stateCenter.reportList);var n={errorCode:c,extendedData:h};if(null==e?void 0:e.inputList.find((function(e){return null==e.streamID&&(n.extendedData=n.extendedData+". streamID should be of string type",!0)})))return t.dataReport.addMsgInfo(s,n),t.dataReport.uploadReport(s),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),void o(n);e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var a=function(r){var i=g(t.stateCenter,r),n=i.reportErr,a=i.actualError;t.dataReport.addMsgInfo(s,n||r),t.dataReport.uploadReport(s),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),a&&(r.errorCode=null==a?void 0:a.code,r.extendedData=(null==a?void 0:a.message)||""),o(r)},l=t.stateCenter.roomList[0];l?l.streamHandler.updateMixStream(e,(function(o){t.dataReport.uploadReport(s),t.stateCenter.unregisterCallback("kZegoTaskMixStart"+e.taskID,t.stateCenter.reportList),r(o)}),a):a({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.message})}))},setMixerTaskConfig:function(e){var t=this;return new Promise((function(r,o){var s=t.stateCenter.getReportSeq();t.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskMixConfig.event),t.stateCenter.logReportCallback("kZegoTaskMixConfig",t.dataReport,s,t.stateCenter.reportList);var n=t.stateCenter.roomList[0];n?n.streamHandler.setMixerTaskConfig(e).then((function(e){t.dataReport.uploadReport(s),t.stateCenter.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),r(e)})).catch((function(e){t.dataReport.addMsgInfo(s,e),t.dataReport.uploadReport(s),t.stateCenter.unregisterCallback("kZegoTaskMixConfig",t.stateCenter.reportList),o(e)})):o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.message})}))},stopMixerTask:function(e){var t=this;return new Promise((function(r,o){var s=t.stateCenter.getReportSeq();if(t.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskMixStop.event),!e||"string"!=typeof e||e.length>256||!t.stateCenter.checkIllegalCharacters(e))return t.logger.error("zb.rh.lg taskID must be string less 256"),t.dataReport.addMsgInfo(s,{error:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,message:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"}),t.dataReport.uploadReport(s),void o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});var n=function(e){var r=g(t.stateCenter,e),i=r.reportErr,n=r.actualError;t.dataReport.addMsgInfo(s,i||e),t.dataReport.uploadReport(s),n&&(e.errorCode=null==n?void 0:n.code,e.extendedData=(null==n?void 0:n.message)||""),o(e)},a=t.stateCenter.roomList[0];a?a.streamHandler.stopMixStream(e,(function(e){t.dataReport.uploadReport(s),r(e)}),n):n({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.message})}))}},t.streamHandler={setMixerTaskConfig:function(e){var t=this;return new Promise((function(r,o){var s,n={},a={};if(e&&e.videoCodec){var c=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(c))return t.logger.error("zb.sh.ums param videoCode error"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;n.videoCodec=c,a.video_codec=c}if(e.backgroundColor){if(!t.stateCenter.checkInteger(e.backgroundColor))return t.logger.error("zb.sh.ums param backgroundColor must be integer number"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;n.backgroundColor=e.backgroundColor,a.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return t.logger.error("zb.sh.ums param outputBgImage error"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return t.logger.error("zb.sh.ums illegal input background image URL"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;n.backgroundImage=e.backgroundImage,a.background_image=e.backgroundImage}if(e.waterMark&&(n.waterMark=e.waterMark,a.water_mark=e.waterMark),e&&e.userData){if(!(e.userData instanceof Uint8Array))return t.logger.error("zb.sh.ums param userData required Uint8Array"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(e.userData.byteLength>1e3)return t.logger.error("zb.sh.ums param userData should shorter than 1000"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;n.userData=e.userData}e.extraParams&&(n.extraParams||(n.extraParams=[]),(s=n.extraParams).push.apply(s,e.extraParams)),l=n,t.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)&&t.stateCenter.actionSuccessCallback("kZegoTaskMixConfig",t.stateCenter.reportList)(u,void 0,{config:i.ZegoRTCLogEvent.kZegoTaskMixConfig.config(a)}),r({errorCode:0,extendedData:""})}))},stopMixStream:function(e,t,r,o,l){var u=this;this.logger.info("zb.sh.sms call");var c={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:n};if("string"==typeof e&&(c.task_id=e),null!=o?c.stream_id=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+o:o:null!=l&&(c.mixurl=l),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"stop_mix"},c,(function(e){t&&t({errorCode:0,extendedData:""})}),(function(e,t,o,n){var l="";if(n)return n==s.errorCodeList.TIMEOUT&&(n=i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(s.errorCodeList.MIXER_NO_SERVICES))),void(r&&r(n,l));if(n=i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,200===e){if("number"==typeof t)return u.logger.debug("zb.sh.sms error: "+t),t+=1e9,void(r&&r({errorCode:u.stateCenter.getServerError(a+t).code,extendedData:l}));u.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(error));var c=i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;r&&r({errorCode:c.code,extendedData:c.message})}else u.logger.error("zb.sh.sms "+(l="request mix server fail, error: "+e)),r&&r(n,l)}));else{var h={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(c)};this.sendBizChannelRequest(h,(function(){t&&t({errorCode:0,extendedData:""})}),(function(e){if("number"==typeof e)r&&r({errorCode:u.stateCenter.getServerError(a+e).code,extendedData:""});else{u.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e));var t=void 0;t=e==s.errorCodeList.TIMEOUT?i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,r&&r({errorCode:t.code,extendedData:t.message})}}))}return!0},updateMixStream:function(e,t,r){var c,h,g=this;if(this.logger.info("zb.sh.ums call"),!e.noTaskID&&!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&"string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>256)return this.logger.error("zb.sh.ums taskId is too long"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!this.stateCenter.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach((function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var d=0;d<e.inputList.length;d++){var _=e.inputList[d],p={errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message};if("object"!=typeof _.layout)return this.logger.error("zb.sh.ums input layout must be object"),r(p),!1;if(!(this.stateCenter.checkInteger(_.layout.top,!1)&&this.stateCenter.checkInteger(_.layout.bottom,!1)&&this.stateCenter.checkInteger(_.layout.left,!1)&&this.stateCenter.checkInteger(_.layout.right,!1)))return this.logger.error("zb.sh.ums topleftbottomright must be integer number"),r(p),!1;if(void 0!==_.renderMode&&![0,1].includes(_.renderMode))return this.logger.error("zb.sh.ums render_mode is wrong"),r(p),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some((function(e){return"string"==typeof e&&!g.stateCenter.isUrl(e)&&!g.stateCenter.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!g.stateCenter.isUrl(e.target)&&!g.stateCenter.checkIllegalCharacters(e.target)})))return this.logger.error("zb.sh.ums stream output target is incorrect"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!((h=e.inputList.every((function(e){return"AUDIO"===e.contentType})))||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(h&&(e.outputConfig=o(o({},e.outputConfig||{}),{outputBitrate:.001,outputFPS:1,outputWidth:1,outputHeight:1})),!(h||e.outputConfig.outputBitrate&&this.stateCenter.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!this.stateCenter.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!this.stateCenter.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!this.stateCenter.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var E={},m=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(m=e.outputConfig.singleStreamPassThrough?1:0),E={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:n,bypass:m,timestamp:Math.ceil((new Date).getTime()/1e3)};var T=l;T&&(T.videoCodec&&(E.extra_params=[{key:"video_encode",value:T.videoCodec}]),T.backgroundColor&&(E.output_bg_color=T.backgroundColor),T.backgroundImage&&(E.output_bg_image=T.backgroundImage),T.waterMark&&(E.watermark=T.waterMark),T.userData&&(E.userdata=this.stateCenter.uint8arrayToBase64(T.userData)),T.extraParams&&(!E.extra_params&&(E.extra_params=[]),(c=E.extra_params).push.apply(c,T.extraParams))),E.MixInput=e.inputList.map((function(e,t){var r=e.streamID;return g.stateCenter.testEnvironment&&(r="zegotest-"+g.stateCenter.appid+"-"+e.streamID),{stream_id:r,content_control:"AUDIO"===e.contentType?1:0,rect:{layer:t,top:e.layout.top,left:e.layout.left,bottom:e.layout.bottom,right:e.layout.right},render_mode:e.renderMode}})),this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(u,void 0,{mix_stream_id:i.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(e.taskID),stream_cnt:i.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(E.MixInput.length),input_stream_list:i.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(E.MixInput)}),E.MixOutput=e.outputList.map((function(t){var o={},s="";if("string"==typeof t)s=t;else{if("object"!=typeof t||!t.target)return g.logger.error("zb.sh.ums output target required"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;s=t.target}return s.startsWith("rtmp://")||s.startsWith("https://")&&s.endsWith(".flv")||s.startsWith("https://")&&s.endsWith(".m3u8")?o.mixurl=s:o.stream_id=g.stateCenter.testEnvironment?"zegotest-"+g.stateCenter.appid+"-"+s:s,o.bitrate=1e3*e.outputConfig.outputBitrate,o.fps=e.outputConfig.outputFPS,o.width=e.outputConfig.outputWidth,o.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(o.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===T.videoCodec?o.audio_enc_id=3:"h264"===T.videoCodec&&(o.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(o.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(o.audio_channel_cnt=e.outputConfig.outputAudioChannels),o.testenv=g.stateCenter.testEnvironment?1:0,o})),this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)&&this.stateCenter.actionSuccessCallback("kZegoTaskMixStart"+e.taskID,this.stateCenter.reportList)(u,void 0,{output_target_list:i.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(E.MixOutput)}),this.logger.debug("zb.sh.ums send command");var R="zegotest-"+this.stateCenter.appid+"-";if(this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"start_mix"},E,(function(e){var r=e.play.map((function(e){var t={rtmpURL:"",hlsURL:"",flvURL:""},r=e.stream_alias||"";return g.stateCenter.testEnvironment&&r&&r.startsWith(R)&&(r=r.slice(R.length)),t.streamID=r,e.rtmp_url&&e.rtmp_url.length>0&&(t.rtmpURL=e.rtmp_url),e.hls_url&&e.hls_url.length>0&&(t.hlsURL=e.hls_url),e.hdl_url&&e.hdl_url.length>0&&(t.flvURL=e.hdl_url),t}));t&&t({errorCode:0,extendedData:JSON.stringify({mixerOutputList:r})})}),(function(e,t,o,n){var l="";if(n)return n==s.errorCodeList.TIMEOUT&&(n=i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),n.code&&20010===n.code&&(n=JSON.parse(JSON.stringify(s.errorCodeList.MIXER_NO_SERVICES))),void(r&&r(n,l));if(n=i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,200===e){if("number"==typeof t){if(g.logger.debug("zb.sh.ums error: "+t),1000000150==(t+=1e9)&&o){var u=o,c=(null==u?void 0:u.non_exist_streams.map((function(e){return g.stateCenter.testEnvironment&&e.startsWith(R)?e.slice(R.length):e})))||[];c.length>0&&(g.logger.debug("zb.sh.ums not exist streams: "+c),l=c.join(","))}return void(r&&r({errorCode:g.stateCenter.getServerError(a+t).code,extendedData:l}))}g.logger.debug("zb.sh.ums error code "+t);var h=i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;r&&r({errorCode:h.code,extendedData:h.message})}else g.logger.error("zb.sh.ums "+(l="request mix server fail, error: "+e)),r&&r(n,l)}));else{var f={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(E)};this.sendBizChannelRequest(f,(function(e,o,s){if(g.logger.debug("zb.sh.ums receive message"),0!=s.length){for(var i=JSON.parse(s),n=[],a=0;a<i.play.length;a++){var l={rtmpURL:"",hlsURL:"",flvURL:""},u=i.play[a].stream_alias||"";g.stateCenter.testEnvironment&&u&&u.startsWith(R)&&(u=u.slice(R.length)),l.streamID=u,i.play[a].rtmp_url&&i.play[a].rtmp_url.length>0&&(l.rtmpURL=i.play[a].rtmp_url),i.play[a].hls_url&&i.play[a].hls_url.length>0&&(l.hlsURL=i.play[a].hls_url),i.play[a].hdl_url&&i.play[a].hdl_url.length>0&&(l.flvURL=i.play[a].hdl_url),n.push(l)}t&&t({errorCode:0,extendedData:JSON.stringify({mixerOutputList:n})})}else r&&r({errorCode:g.stateCenter.getServerError(10001).code,extendedData:""})}),(function(e,t,o){if("number"==typeof e){g.logger.debug("zb.sh.ums error: "+e);var n=[];if(1000000150==e&&0!=o.length)for(var l=JSON.parse(o),u=0;u<l.non_exist_streams.length;u++){var c=l.non_exist_streams[u];g.stateCenter.testEnvironment&&c.startsWith(R)?n.push(c.slice(R.length)):n.push(c)}r&&r({errorCode:g.stateCenter.getServerError(a+e).code,extendedData:""})}else{g.logger.debug("zb.sh.ums error code "+e.code);var h=void 0;h=e==s.errorCodeList.TIMEOUT?i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,r&&r({errorCode:h.code,extendedData:h.message})}}))}return!0}}},817:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}}},577:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(906);t.default={type:"MixStream",install:function(e,t){for(var r in o.zegoWebRTC)Object.defineProperty(e.prototype,r,{value:o.zegoWebRTC[r],writable:!1});for(var r in o.streamHandler)Object.defineProperty(t.prototype,r,{value:o.streamHandler[r],writable:!1})}}},145:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTCLogEvent=void 0;var o=r(817),s=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN},mix_stream_id:s,stream_cnt:s,input_stream_list:s,output_target_list:s},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:o.errorCodeList.NOT_LOGIN},config:s}}},39:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdvancedModule=void 0;var o=r(91),s=r(427),i=function(){function e(e,t,r,o){this.logger=e,this.dataReport=t,this.streamCenter=r,this.stateCenter=o,this.screenShotReady=!1}return e.prototype.publishTarget=function(e){var t=this,r=this.stateCenter.getReportSeq();switch(e.type){case"addpush":this.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case"delpush":case"clearpush":this.dataReport.newReport(r,s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(r,{stream:s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:s.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise((function(i,n){var a=function(e,o){t.logger.error("zb.pt"+(o||e.message)),t.dataReport.addMsgInfo(r,{error:e.code,message:e.message+(o||"")}),t.dataReport.uploadReport(r),n({errorCode:e.code,extendedData:e.message+(o?" "+o:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return t.logger.error("zb.sh.pt cdn push type error"),void a(o.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(t.stateCenter.publishStreamList[e.streamID]){var l=t.streamCenter.getRoomByStreamID(e.streamID);l?l.streamHandler._publishTarget(e,(function(e){t.dataReport.uploadReport(r),i(e)}),a):a(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else a(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else a(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else a(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")}))},e}();t.AdvancedModule=i},243:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.streamHandler=t.zegoWebRTC=t.ENUM_PUBLISH_STREAM_STATE=t.ENUM_STREAM_CMD_PRI=t.ENUM_STREAM_SUB_CMD=t.PROTO_VERSION=void 0;var o=r(91),s=r(427);t.PROTO_VERSION="2.11.1",t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.zegoWebRTC={setStreamExtraInfo:function(e,t){var r=this;return new Promise((function(o,i){var n=r.stateCenter.getReportSeq();r.dataReport.newReport(n,s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),r.dataReport.addMsgInfo(n,{stream:s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(t)});var a=function(e,t){r.logger.error("zb.ssei "+t),r.dataReport.addMsgInfo(n,{error:e.code,message:e.message+" "+t}),r.dataReport.uploadReport(n),i({errorCode:e.code,extendedData:e.message+" "+t})};if("string"==typeof e&&""!=e)if("string"==typeof t&&""!=t)if(r.RTM.isDisConnect())a(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login");else if(r.stateCenter.publishStreamList[e]){var l=r.streamCenter.getRoomByStreamID(e);l?(r.dataReport.addMsgInfo(n,{room_sid:s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(l.sessionID)}),l.streamHandler.setStreamExtraInfo(e,t,o,a),r.dataReport.uploadReport(n)):a(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError,"not login")}else a(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError,"publish stream no found");else a(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"extraInfo must be string and no empty");else a(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError,"streamID must be string and not empty")}))}},t.streamHandler={_publishTarget:function(e,r,i){var n=this;this.logger.info("zb.sh.ptcall");var a=Math.ceil((new Date).getTime()/1e3),l=e.streamID;this.stateCenter.testEnvironment&&(l="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var u={appid:this.stateCenter.appid,biz_type:0,timestamp:a,seq:this.stateCenter.cdnSeq++,version:1*t.PROTO_VERSION,stream_id:l,pushurl:e.pushUrl};if(this.logger.debug("zb.sh.pt send command"),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:1,location:"/liveroomcmd/push",cmd:e.type},u,(function(t){n.logger.info("zb.sh.pt receive message");var s=t||{},a=s.code,l=s.message;a&&0!=a?(n.logger.error("zb.sh.pt "+e.type+" error code: "+a+" "+l),i(o.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+e.type+" "+a+" "+l)):(n.logger.info("zb.sh.pt "+e.type+" success"),r&&r({errorCode:0,extendedData:""}))}),(function(t,r,o,a){var l="";a||(a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,200===t?(n.logger.info("zb.sh.pt error: "+r),a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,2001==r?a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==r&&(a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),l="cmd: "+e.type+", biz_code: "+r):l="request media server fail, error: "+t,n.logger.error("zb.sh.pt "+l)),i&&i(a,l)}));else{var c={channel:"media",cmd:e.type,req_body:JSON.stringify(u)};this.sendBizChannelRequest(c,(function(t,a,l){if(n.logger.info("zb.sh.pt receive message"),0!=l.length){var u=JSON.parse(l),c=u.code,h=u.message;c&&0!=c?(n.logger.error("zb.sh.pt "+e.type+" error code: "+c+" "+h),i(o.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: "+e.type+" "+c+" "+h)):(n.logger.info("zb.sh.pt "+e.type+" success"),r&&r({errorCode:0,extendedData:""}))}else i(s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)}),(function(t,r,o){n.logger.info("zb.sh.pt error: "+t);var a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;2001==t?a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==t&&(a=s.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),n.logger.error("zb.sh.pt "),i(a," cmd: "+e.type+" "+t+"   ")}))}},updateStreamExtraInfo:function(e,r,o,i){this.logger.info("zb.sh.usei call");var n=t.ENUM_STREAM_SUB_CMD.liveUpdate;this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=t.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[e].extra_info=r,this.updateStreamInfo(e,n,r),o({errorCode:0})):this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state===t.ENUM_PUBLISH_STREAM_STATE.tryPublish?(this.stateCenter.publishStreamList[e].extra_info=r,o({errorCode:0})):i(s.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kUpdateStreamInfoFailError)},setStreamExtraInfo:function(e,t,r,o){this.updateStreamExtraInfo(e,t,r,o)}}},91:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errorCodeList=void 0,t.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"},TRACK_CAN_NOT_ADD:{code:1103063,message:"only stream which have one track and kind no exist can add track"},TRACK_CAN_NOT_REMOVE:{code:1103064,message:"stream which only has one track can not remove "},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},PUBLISHER_STATE_WRONG:{code:1103069,message:"publisher state wrong"},HANDLE_TRACK_NOT_SUPPORTED:{code:1103070,message:"not support remove track"},VIDEO_EFFECT_IS_RUNNING:{code:1103071,message:"video effect processor is running"}}},12:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r(39),s=r(243);t.default={type:"StreamCommon",install:function(e,t,r){for(var i in Object.defineProperty(t.prototype,"initStreamCommon",{value:function(){this.streamCommonModule=new o.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),s.zegoWebRTC)Object.defineProperty(e.prototype,i,{value:s.zegoWebRTC[i],writable:!1});for(var i in s.streamHandler)Object.defineProperty(r.prototype,i,{value:s.streamHandler[i],writable:!1})}}},427:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoRTCLogEvent=void 0;var o=r(91),s=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:o.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:o.errorCodeList.NOT_LOGIN,kNoResponseError:o.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:o.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:o.errorCodeList.INVALID_CHANNEL,kUnknownServerError:o.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskAddPublishCdnUrl:{event:"/sdk/add_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:"/sdk/remove_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM},stream:s,target_url:s},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:o.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream:s,stream_extra_info:s,room_sid:s}}},608:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientUtil=void 0;var o=r(706),s=r(529),i=function(){function e(){}return e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("avertp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},e.registerCallback=function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.logReportCallback=function(t,r,o,s){e.registerCallback(t,{success:function(t,s){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];e.dataReportEvent(r,o,t,s,i)}},s)},e.actionLogReportCallback=function(t,r,o,s,i){e.actionSuccessCallback(t,r)&&e.actionSuccessCallback(t,r)(o,s)},e.getServerError=function(e,t,r){if(t)return{code:e,message:r||"liveroom error"};var o={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",1013:"token03 format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(0===e)return{code:0,message:""};var s={code:0,message:"liveroom cmd error"};if(s.code=e,e>1e9){var i=o[e];s.message=i?"liveroom cmd error, code: "+e+", message: "+i:o[1e9]+e}else s.message=o[e]?o[e]+" code:"+e:"unknown error code:"+e;return s},e.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},e.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r},e.getLiveRoomError=function(e,t){var r={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED"};return t?e>2e5&&e<3e5?r[e-2e5]:e<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[e]||r[e]||"ROOM_INNER_ERROR":r[e]||"ROOM_INNER_ERROR":e>1e9?r[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:t.code=63000002,t.message="zpush manual kickout",t.name="MANUAL_KICKOUT";break;case 3:t.code=63000003,t.message="kickout reason = "+e;break;case 4:t.code=63000004,t.message="zpush multiple login kickout",t.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:t.code=63000005,t.message="zpush token expired",t.name="TOKEN_EXPIRED";break;default:t.code=e,t.message="kickout reason = "+e}return t},e.dataReportEvent=function(e,t,r,o,s){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,s[0]);break;case"addEventMsg":e.addEventMsg(t,o,s[0],s[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,s[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,o){var s,i=[],n=[],a=[];r||(r=[]);for(var l=0;l<r.length;l++)if(r[l].anchor_id_name!=e&&r[l].id_name!=e&&r[l].user_id!=e){s=!1;for(var u=0;u<t.length;u++)if(r[l].stream_id===t[u].stream_id){r[l].extra_info!==t[u].extra_info&&a.push(r[l]),s=!0;break}s||i.push(r[l])}for(var c=0;c<t.length;c++){s=!1;for(var h=0;h<r.length;h++)if(t[c].stream_id===r[h].stream_id){s=!0;break}s||n.push(t[c])}for(t.splice(0),l=0;l<r.length;l++)t.push(r[l]);o(i,n,a)},e.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&e>=0:"number"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&e>=t&&e<=r},e.uuid=function(e,t){var r,o="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[];if(t=t||o.length,e)for(r=0;r<e;r++)s[r]=o[0|Math.random()*t];else{var i=void 0;for(s[8]=s[13]=s[18]=s[23]="-",s[14]="4",r=0;r<36;r++)s[r]||(i=0|16*Math.random(),s[r]=o[19==r?3&i|8:i])}return s.join("")},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],o=[],s=[],i=0;i<t.length;i++){var n=t[i];"audioinput"===n.kind&&r.push({deviceName:n.label,deviceID:n.deviceId}),"audiooutput"===n.kind&&o.push({deviceName:n.label,deviceID:n.deviceId}),"videoinput"===n.kind&&s.push({deviceName:n.label,deviceID:n.deviceId})}e&&e({microphones:r,speakers:o,cameras:s})})).catch((function(e){console.error("enumerate devices wrong "+e),t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)})):t&&t(s.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.checkScreenParams=function(t,r){if("object"==typeof t&&void 0!==t.videoQuality&&!e.checkInteger(t.videoQuality))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," videoQuality must be integer number"),!1;if("object"==typeof t&&void 0!==t.sourceID&&"string"!=typeof t.sourceID)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," sourceID must be string"),!1;if("object"==typeof t&&4===t.videoQuality){if(!e.checkCameraOrScreenBitRate(t.bitRate,r))return!1;if(!e.checkParamsWithConstraintExtend(t,r))return!1}return!0},e.checkParamsWithConstraintExtend=function(t,r){for(var o=0,i=["frameRate","width","height"];o<i.length;o++){var n=i[o],a=t[n];if(void 0===a)return r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," "+n+" is required when videoQuality is 4"),!1;if("number"==typeof a&&!e.checkInteger(a,!1))return r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," "+n+" must be integer number"),!1;if("number"==typeof a&&("width"===n||"height"===n)&&a<0)return r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," "+n+" must greater than 0."),!1;if("number"==typeof a&&"width"===n&&a>7680)r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," "+n+" cannot greater than 7680.");else if("number"==typeof a&&"height"===n&&a>4320)r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," "+n+" cannot greater than 4320.");else if("object"==typeof a){if("width"===n&&!e.checkConstraintExtend(a,n,r,0,7680))return!1;if("height"===n&&!e.checkConstraintExtend(a,n,r,0,4320))return!1;if("frameRate"===n&&!e.checkConstraintExtend(a,n,r))return!1}else if("number"!=typeof a&&"object"!=typeof a)return r&&r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," "+n+" must be number or object"),!1}return!0},e.checkConstraintExtendWithMessage=function(t,r,o,s){if("object"!=typeof t)return{result:!1,message:"Invalid constraint. Constraint Extend must be a object"};if(0===Object.keys(t).length)return{result:!1,message:r+" can not be a empty object"};for(var i=0,n=["exact","ideal","max","min"];i<n.length;i++){var a=n[i],l=t[a];if("number"==typeof l&&!e.checkInteger(l,!1))return{result:!1,message:" "+a+" of "+r+" must be integer number"};if("number"==typeof o&&"number"==typeof l&&l<o)return{result:!1,message:" "+a+" of "+r+" must greater than "+o};if("number"==typeof s&&"number"==typeof l&&l>s)return{result:!1,message:" "+a+" of "+r+" cannot greater than "+s}}return{result:!0,message:"Constraint Extend OK."}},e.checkConstraintExtend=function(t,r,o,i,n){var a=e.checkConstraintExtendWithMessage(t,r,i,n);return a.result||o&&o(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,a.message),a.result},e.checkBitRateLimit=function(e,t){return!(e>10240&&(t(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate cannot greater than 10 Mbps"),1))},e.checkCameraOrScreenBitRate=function(t,r){if(void 0===t)return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate is required when videoQuality is 4"),!1;if("number"==typeof t){if(!e.checkValidNumber(t))return r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be integer number"),!1;if(!e.checkBitRateLimit(t,r))return!1}else r(s.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError," bitrate must be number");return!0},e.checkCameraParams=function(t,r){return!!e.checkParamsWithConstraintExtend(t,r)&&!!e.checkCameraOrScreenBitRate(t.bitRate,r)},e.isParamEmpty=function(e){return null!=e&&""!==e},e.isTypeString=function(e){return"string"==typeof e},e.isTooLong=function(e,t){return!(e.length>=t)},e.isReDispatch=function(e){var t=e.message.match(/action:(\d+)/),r=t?Number(t[1]):NaN;return[s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,s.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(e)||[6].includes(r)},e.arrAvg=function(e,t,r){return e.push(t),e.length>r&&e.shift(),e.reduce((function(e,t){return e+t}))/e.length},e.getNetQuality=function(e,t,r){return void 0!==r?.15*this.calcQualityOfJitter(r)+.85*Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!1)):Math.min(this.calcQualityOfRtt(e),this.calcQualityOfLostRate(t,!0))},e.calcQualityOfRtt=function(e){return e<600?97-Math.pow(.09*e,1.1):18*Math.exp(.002*(600-e))},e.calcQualityOfJitter=function(e){return e<=50?98-Math.pow(e,1.15):o.QUALITY_CONSTANT.PoorMinQuality},e.calcQualityOfLostRate=function(e,t){if(t)return e<=55?99-Math.pow(.8*e,1.18):o.QUALITY_CONSTANT.PoorMinQuality;var r=100*e;return r<=40?96-Math.pow(r,1.22):o.QUALITY_CONSTANT.PoorMinQuality},e.quality2QualityGrade=function(e){return e>=o.QUALITY_CONSTANT.ExcellentMinQuality?o.QualityGrade.Excellent:e>=o.QUALITY_CONSTANT.GoodMinQuality?o.QualityGrade.Good:e>=o.QUALITY_CONSTANT.MiddleMinQuality?o.QualityGrade.Middle:e>=o.QUALITY_CONSTANT.PoorMinQuality?o.QualityGrade.Poor:o.QualityGrade.Die},e.checkAudioTrackIsActive=function(e){return!!e.enabled},e.checkVideoTrackIsActive=function(e){return!!e.enabled},e.isSupportEncodedTransforms=function(){var e=!!window.RTCRtpScriptTransform;if(!e){var t=!!RTCRtpSender.prototype.createEncodedStreams,r=!1;try{new ReadableStream,r=!0}catch(e){console.error("Transferable streams are not supported.")}e=t&&r}return e},e.uint8arrayToBase64=function(e){for(var t,r=0,o=e.length,s="";r<o;)t=e.subarray(r,Math.min(r+32768,o)),s+=String.fromCharCode.apply(null,Array.from(t)),r+=32768;return btoa(s)},e}();t.ClientUtil=i},51:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isSupportLive=void 0,t.isSupportLive=function(e,t){var r="",o="",s=wx.getSystemInfoSync().SDKVersion,i={code:0,msg:""};(function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var s=parseInt(e[o]),i=parseInt(t[o]);if(s>i)return 1;if(s<i)return-1}return 0})(s,"1.7.0")<0&&(i={code:10001,msg:r},e&&e(i)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(i={code:10002,msg:o}),e&&e(i)},fail:function(e){console.error("get setting error",e),t&&t(e)}})}},130:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoWechatMini=void 0;var o=r(98),s=r(325),i=r(706),n=r(8),a=r(935),l=r(557),u=r(560),c=r(300),h=function(){function e(e,t,r,o){void 0===o&&(o=1),this.logger=e,this.dataReport=t,this.RTM=r,this.stateCenter=new s.StateCenter(this.logger,this.dataReport),this.stateCenter.clientType="wxMini",this.streamCenter=new c.ZegoStreamCenterWechat(this.logger,this.stateCenter,this.dataReport),this.wechatMiniModules=new n.WechatMiniModules(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.RTM)}return e.prototype.checkSystemRequirements=function(){return this.wechatMiniModules.checkSystemRequirements()},e.prototype.getVersion=function(){return i.PROTO_VERSION},e.prototype.on=function(e,t){return this.wechatMiniModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.wechatMiniModules.deleteListener(e,t)},e.prototype.startPublishingStream=function(e,t){return this.wechatMiniModules.publishModule.startPublishingStream(e,t)},e.prototype.stopPublishingStream=function(e){return this.wechatMiniModules.publishModule.stopPublishingStream(e)},e.prototype.getNextUrl=function(e){return this.wechatMiniModules.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" call: "+JSON.stringify(e)),!e||0==e.length)return this.logger.error(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" param error"),!1;var r=!0;return e.forEach((function(e){return 0!=e.indexOf("rtmp://")&&(r=!1)})),r?(t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e,!0):(this.logger.error(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" url is not correct"),!1)},e.prototype.addPublishCdnUrl=function(e,t){var r;this.logger.info(o.ZEGO_WECHATMINI_ACTION.ADD_PUBLISH_CDN_URL+" call "+e+" "+t);var s=null===(r=this.wechatMiniModules.streamCenter.publisherList[e])||void 0===r?void 0:r.room;return new Promise((function(r,o){s.streamHandler._publishTarget({type:"addpush",streamID:e,pushUrl:t},r,o)}))},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info(o.ZEGO_WECHATMINI_ACTION.REMOVE_PUBLISH_CDN_URL+" call "+e+" "+t),this.wechatMiniModules.streamCommonModule?this.wechatMiniModules.streamCommonModule.publishTarget({type:"delpush",streamID:e,pushUrl:t}):new Promise((function(e,t){console.error("should install advanced module"),e({errorCode:-1,extendedData:"should install advanced module"})}))},e.prototype.startMixerTask=function(e){return new Promise((function(e,t){console.error(""),t()}))},e.prototype.setMixerTaskConfig=function(e){return new Promise((function(e,t){console.error(""),t()}))},e.prototype.stopMixerTask=function(e){return new Promise((function(e,t){console.error(""),t()}))},e.prototype.setStreamExtraInfo=function(e,t){return new Promise((function(e,t){console.error("should use advanced module first"),t()}))},e.prototype.startPlayingStream=function(e,t){return this.wechatMiniModules.playModule.startPlayingStream(e,t)},e.prototype.stopPlayingStream=function(e){this.wechatMiniModules.playModule.stopPlayingStream(e)},e.prototype.updatePlayerState=function(e,t){this.wechatMiniModules.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.wechatMiniModules.updatePlayerNetStatus(e,t)},e.use=function(t){switch(t.type){case"MixStream":t.install(e,u.StreamHandler,n.WechatMiniModules);break;case"StreamCommon":t.install(e,n.WechatMiniModules,u.StreamHandler)}},e.prototype.updateAudioVolumeNotify=function(e,t){this.wechatMiniModules.updateAudioVolumeNotify(e,t)},e.prototype.initContext=function(e){e.wxContext&&(this.wxContext=e.wxContext),e.pushAtr&&(this.pushAtr=e.pushAtr),e.playAtr&&(this.playAtr=e.playAtr)},e.prototype.createPusher=function(e){return this.logger.info("zw.cp call"),this.wxContext&&this.wxContext.setData&&this.pushAtr?(this.wechatMiniModules.streamCenter.pusherInstance||(this.wechatMiniModules.streamCenter.pusherInstance=new a.LivePusher(this.wxContext,this.pushAtr,this,e)),this.logger.info("zw.cp call success"),this.wechatMiniModules.streamCenter.pusherInstance):(this.logger.error("zw.cp init context wrong"),null)},e.prototype.setPusherAttributes=function(e,t){var r;this.logger.info("zw.spa.0 call"),this.wechatMiniModules.streamCenter.pusherInstance?(null===(r=this.wechatMiniModules.streamCenter.pusherInstance)||void 0===r||r.setPusherAttributes(e,t),this.logger.info("zw.spa.0 call success")):this.logger.error("zw.spa.0 publisher no found")},e.prototype.setPlayerAttributes=function(e,t,r){if(this.logger.info("zw.spa.1 call"),"string"==typeof e&&"string"==typeof this.playAtr){var o=this.wechatMiniModules.streamCenter.livePlayerList.find((function(t){return t.attributes.id==e}));o?(o.setPlayerAttributes(t,r),this.logger.info("zw.spa.1 call success")):this.logger.error("zw.spa.1 player no found")}else this.logger.error("zw.spa.1 stream no found")},e.prototype.getPusherInstance=function(){return this.wechatMiniModules.streamCenter.pusherInstance?this.wechatMiniModules.streamCenter.pusherInstance:null},e.prototype.getPlayerInstance=function(e,t){if(this.logger.info("zw.gpi call"),"string"!=typeof e||"string"!=typeof this.playAtr)return this.logger.error("zw.gpi param error"),null;var r=this.wechatMiniModules.streamCenter.livePlayerList.find((function(t){return t.attributes.id==e}));return t&&(this.wechatMiniModules.streamCenter.playerContextMap[e]=t),r||(r=new l.LivePlayer(this.wxContext,e,this,this.wechatMiniModules.streamCenter.playerContextMap[e]),this.wechatMiniModules.streamCenter.livePlayerList.push(r)),this.setPlayData(),this.logger.info("zw.gpi call success"),r},e.prototype.getPlayerList=function(e){if(this.logger.info("zw.gpl call"),void 0!==e&&"string"!=typeof e||"string"!=typeof this.playAtr)return this.logger.error("zw.gpl param error"),[];if(e){var t=this.wechatMiniModules.streamCenter.livePlayerList.find((function(t){return t.attributes.id==e}));return t?[t.attributes]:[]}return this.logger.info("zw.gpl call success"),this.wechatMiniModules.streamCenter.livePlayerList.map((function(e){return e.attributes}))},e.prototype.mutePublishStreamVideo=function(e){this.setPusherAttributes({enableCamera:!e})},e.prototype.mutePublishStreamAudio=function(e){this.setPusherAttributes({enableMic:!e})},e.prototype.mutePlayStreamVideo=function(e,t){this.setPlayerAttributes(e,{muteVideo:t})},e.prototype.mutePlayStreamAudio=function(e,t){this.setPlayerAttributes(e,{muteAudio:t})},e.prototype.setPlayData=function(e){if(this.logger.info("zw.spd call"),this.wxContext&&this.playAtr){void 0!==e&&"function"!=typeof e&&this.logger.error("zw.spd callBack is not function");var t={};t[this.playAtr]=this.wechatMiniModules.streamCenter.livePlayerList.map((function(e){return e.attributes})),this.wxContext.setData(t,e),this.logger.info("zw.spd call success")}else this.logger.error("zw.spd init context wrong")},e}();t.ZegoWechatMini=h},8:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WechatMiniModules=void 0;var o=r(560),s=r(80),i=r(168),n=r(706),a=r(529),l=r(608),u=r(98),c=r(51),h=function(){function e(e,t,r,o,a){this.logger=e,this.dataReport=t,this.stateCenter=r,this.rtm=a,this.currentPlaySourceType=n.ENUM_DISPATCH_TYPE.cdn,this.mixStreamList={},this.ultraPlaySourceType="rtmp_v2",this.streamCenter=o,this.publishModule=new s.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.playModule=new i.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.init(),this.initStreamCommon()}return e.prototype.init=function(){this.bindRTMListener(),this.bindStreamCenterHandler()},e.prototype.initStreamCommon=function(){},e.prototype.bindRTMListener=function(){var e=this;this.rtm._on("roomLoginResponse",(function(t){e.logger.info("zc.rlr call "+JSON.stringify(t));var r=t.header.room_id;e.stateCenter.appid=e.rtm.getAppID(),e.stateCenter.idName=e.rtm.getUserID(),e.stateCenter.testEnvironment=e.rtm.isTestEnvironment(),e.stateCenter.isMultiRoom=e.rtm.getMultiRoom();var s=e.rtm.getToken(r),i=e.rtm.getSessionId(r),n=e.rtm.getRoomSessionID(r),a=e.stateCenter.getRoomByRoomID(r);if(!a){var l=new o.StreamHandler(e.logger,e.stateCenter,e.rtm,e.streamCenter,r);e.bindStreamHandler(l),e.stateCenter.roomList.push(a={roomID:r,streamHandler:l,sessionID:i,roomSessionID:n,token:s,isResetRoom:!1,streamList:[],streamInfoList:[]})}a.sessionID=i,a.roomSessionID=n,a.token=a.token,a.streamHandler.handleStreamStart(t,a),e.logger.info("zc.rlr end "+r)})),this.rtm._on("_roomLogin",(function(t,r){e.stateCenter.useNetAgent=e.rtm.getUseNetAgent()})),this.rtm._on("HBResponse",(function(t){var r,o=null===(r=null==t?void 0:t.header)||void 0===r?void 0:r.room_id,s=e.stateCenter.getRoomByRoomID(o);null==s||s.streamHandler.patchStreamList(t)})),this.rtm._on("_roomStateUpdate",(function(t,r,o,s){if("DISCONNECTED"==r){e.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+" _roomStateUpdate "+t+" disconnected "+(o?o+" ":"")+(s||""));var i=e.stateCenter.getRoomByRoomID(t);if(i){var n=e.stateCenter.roomList.findIndex((function(e){return e.roomID==t}));i.isResetRoom=!0,i.streamHandler.reset(),e.streamCenter.reset(t,o),e.stateCenter.roomList.splice(n,1)}}else e.logger.info("zc.rsu "+t+" state: "+r)})),this.rtm.service.on("stream",(function(t){var r,o=(null===(r=null==t?void 0:t.header)||void 0===r?void 0:r.room_id)||"",s=e.stateCenter.getRoomByRoomID(o);s?s.streamHandler.handleStreamUpdateRsp(t):e.logger.error(u.ZEGO_WECHATMINI_ACTION.ON_STREAM+" room no found")})),this.rtm.service.on("push_stream_update",(function(t){var r,o=(null===(r=null==t?void 0:t.header)||void 0===r?void 0:r.room_id)||"",s=e.stateCenter.getRoomByRoomID(o);s?s.streamHandler.handlePushStreamUpdateMsg(t):e.logger.error(u.ZEGO_WECHATMINI_ACTION.ON_PUSH_STREAM_UPDATE+" room no found")})),this.rtm.service.on("zegochat_js.push_room_stream_update_req",(function(t){var r,o=(null===(r=null==t?void 0:t.header)||void 0===r?void 0:r.room_id)||"",s=e.stateCenter.getRoomByRoomID(o);s?s.streamHandler.handlePriPushStreamUpdateMsg(t):e.logger.error(u.ZEGO_WECHATMINI_ACTION.ON_STREAM+" room no found")}))},e.prototype.bindStreamHandler=function(e){var t=this;e.onStreamUpdated=function(e,r,o){var s=o.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),i=n.getReportSeq();if(t.dataReport.newReport(i,a.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),t.dataReport.addMsgInfo(i,{stream_update_type:a.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(1===r?"added":"deleted"),update_stream:a.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(o)}),t.dataReport.uploadReport(i),t.stateCenter.actionListener("roomStreamUpdate",e,l.ClientUtil.getSteamUpdateType(r),s),1===r){var u=[];s.forEach((function(e){e.extraInfo&&u.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),u.length>0&&t.stateCenter.actionListener("streamExtraInfoUpdate",e,u)}},e.onPublishStateUpdate=function(e,r,o){t.logger.info(u.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE+" "+r);var s=t.stateCenter.reportSeqList.startPublish[r];t.streamCenter.publishingList[r]&&(0==e||1==e)&&s&&(t.dataReport.eventEndWithMsgInfo(s,"PublishState",{type:e}),1==e&&t.dataReport.addMsgInfo(s,o),t.dataReport.uploadReport(s),delete t.stateCenter.reportSeqList.startPublish[r]),t.stateCenter.actionListener("publisherStateUpdate",{state:l.ClientUtil.getPublisherStateType(e),streamID:r,errorCode:o.code,extendedData:o.message})},e.onStreamExtraInfoUpdated=function(e,r){var o=r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),s=n.getReportSeq();t.dataReport.newReport(s,a.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),t.dataReport.addMsgInfo(s,{update_stream:a.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(o)}),t.dataReport.uploadReport(s),t.stateCenter.actionListener("streamExtraInfoUpdate",e,o)}},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,o){var s=e.stateCenter.reportSeqList.startPlay[r];e.streamCenter.playingList.find((function(e){return e.streamID===r}))&&(0==t||1==t)&&s&&(e.dataReport.eventEndWithMsgInfo(s,"PlayState",{type:t}),1==t&&o&&e.dataReport.addMsgInfo(s,o),e.dataReport.uploadReport(s),delete e.stateCenter.reportSeqList.startPlay[r]),e.stateCenter.actionListener("playerStateUpdate",{state:l.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:o&&o.code,extendedData:o&&o.message}),1===t&&(e.streamCenter.playErrorCallBackList[r]&&(e.streamCenter.playErrorCallBackList[r](o),delete e.streamCenter.playErrorCallBackList[r]),e.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_STREAM_CENTER_HANDLER+" stop play called by sdk"))},this.streamCenter.onPublishStateUpdate=function(t,r,o){e.onPublishStateUpdateHandle(t,r,o)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)}},e.prototype.onPublishStateUpdateHandle=function(e,t,r){this.logger.info(u.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE_HANDLE+" call");var o=this.streamCenter.publisherList[t].room;o?0==e?this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].state!=n.ENUM_PUBLISH_STREAM_STATE.tryPublish||o.streamList.find((function(e){return e.stream_id==t}))?(this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.publishing,o.streamHandler.onPublishStateUpdate(e,t,r),this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],l.ClientUtil.unregisterCallback("kZegoTaskPublishStart"+t,this.stateCenter.reportList)):(this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.update_info,o.streamHandler.updateStreamInfo(t,n.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info,(function(e){})),this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],l.ClientUtil.unregisterCallback("kZegoTaskPublishStart"+t,this.stateCenter.reportList))):(o.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info(u.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE_HANDLE+" stop publish called by sdk"),this.publishModule.stopPublishingStream(t))):this.logger.error("zc.opsuh.0 room not exist")},e.prototype.bindListener=function(e,t){return this.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+" call"),this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+" listener callBack must be function"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+" event "+e+" no found"),!1)},e.prototype.deleteListener=function(e,t){if(this.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_DELETE_LISTENER+" call"),!this.stateCenter.listenerList[e])return this.logger.error(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_DELETE_LISTENER+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.checkSystemRequirements=function(){var e=this;return new Promise((function(t,r){var o=n.getReportSeq();e.dataReport.newReport(o,a.ZegoWechatLogEvent.kZegoTaskCheckSystemRequirements.event),c.isSupportLive((function(r){e.dataReport.addMsgInfo(o,{check_system:r}),e.dataReport.uploadReport(o),t(r)}),(function(t){e.dataReport.addMsgInfo(o,a.ZegoWechatLogEvent.kZegoTaskCheckSystemRequirements.error.kCheckSystemGetSettingFailError),e.dataReport.uploadReport(o),r(t)}))}))},e.prototype.updatePlayerState=function(e,t){this.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_STATE+" call "+e),this.streamCenter.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_NET_STATUS+" call "+e),this.streamCenter.updatePlayerNetStatus(e,t)},e.prototype.updateAudioVolumeNotify=function(e,t){this.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_VOLUME_NOTIFY+" call "+e),this.streamCenter.updateAudioVolumeNotify(e,t)},e.prototype.getNextUrl=function(e){return"string"!=typeof e||""==e?(this.logger.error(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_GET_NEXT_URL+" stream ID must be string and not empty"),""):this.streamCenter.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" call: "+JSON.stringify(e)),!e||0==e.length)return this.logger.error(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" param error"),!1;var r=!0;e.forEach((function(e){return 0!=e.indexOf("rtmp://")&&(r=!1)})),r?t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e:this.logger.error(u.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+" url is not correct")},e}();t.WechatMiniModules=h},168:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PlayModule=void 0;var s=r(706),i=r(529),n=r(608),a=r(98),l=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i,this.mixStreamList={},this.preferPlaySourceType=s.ENUM_PLAY_SOURCE_TYPE.ultra,this.ultraPlaySourceType="rtmp_v2"}return e.prototype.startPlayingStream=function(e,t){var r=this;return new Promise((function(l,u){r.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM+" call "+e);var c=s.getReportSeq();r.stateCenter.reportSeqList.startPlay[e]=c,r.dataReport.newReport(c,i.ZegoWechatLogEvent.kZegoTaskPlayStart.event);var h=function(t,s){r.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM+" "+(s||t.message)),r.dataReport.uploadReport(c,void 0,t,s),delete r.stateCenter.reportSeqList.startPlay[e],u(o(o({},t),{errorCode:t.code,extendedData:t.message+(s?" "+s:"")}))};if(n.ClientUtil.isParamEmpty(e))if(n.ClientUtil.isTypeString(e))if(n.ClientUtil.isTooLong(e,s.MAX_STREAM_ID_LENGTH))if(n.ClientUtil.checkIllegalCharacters(e)){if(r.stateCenter.customPlayUrl&&0!=r.stateCenter.customPlayUrl.length){var g=r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0);if(!0!==g){var d=JSON.parse(JSON.stringify(g));return void h(d,"cannot start play")}return r.streamCenter.playErrorCallBackList[e]=function(e){h(e)},r.streamCenter.startPlayingStream(e,r.stateCenter.customPlayUrl,1)}if(r.rtm.service.isDisConnect())h(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError);else{var _=r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0);if(!0===_){if(r.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:""}),n.ClientUtil.logReportCallback("kZegoTaskPlayStart"+e,r.dataReport,c,r.stateCenter.reportList),r.dataReport.addMsgInfo(c,{stream:i.ZegoWechatLogEvent.kZegoTaskPlayStart.stream(e),playOption:i.ZegoWechatLogEvent.kZegoTaskPlayStart.playOption(t),mini_sys_infos:r.streamCenter.systemInfo}),r.streamCenter.playSuccessCallBackList[e]=function(e,t){n.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,"get_play_url"),l({streamID:e,url:t})},r.streamCenter.playErrorCallBackList[e]=function(t){n.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,"get_play_url"),h(t)},t&&t.isMix)return r.mixStreamList[e]={ultra_url_rtmp:null},void r.fetchPlayStreamUrl(e,"rtmp_cdn",s.ENUM_DISPATCH_TYPE.cdn);n.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventStart,"get_play_url"),t&&"CDN"==t.sourceType||r.preferPlaySourceType===s.ENUM_PLAY_SOURCE_TYPE.cdn?r.startPlayingStreamFromCDN(e):r.startPlayingStreamFromBGP(e)}else d=JSON.parse(JSON.stringify(_)),h(d)}}else h(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError);else h(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDTooLongError);else h(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayParamError);else h(i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDNullError)}))},e.prototype.stopPlayingStream=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+" call "+e);var t=s.getReportSeq();if(this.dataReport.newReport(t,i.ZegoWechatLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(t,{stream_id:e}),"string"!=typeof e||""==e)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+" stream ID must be string and not empty"),this.dataReport.addMsgInfo(t,i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayParamError),void this.dataReport.uploadReport(t);var r=this.streamCenter.playerList[e],o=r&&r.state!==s.ENUM_PLAYER_STATE.stop;for(var n in this.streamCenter.stopPlayingStream(e),o&&this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,message:""}),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[n]===e){delete this.stateCenter.streamUrlMap[n];break}this.mixStreamList[e]&&delete this.mixStreamList[e],this.dataReport.uploadReport(t),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+" call success")},e.prototype.startPlayingStreamFromCDN=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+" call "+e);var t=this.stateCenter.getPlayRoom(e)||this.stateCenter.roomList[0];if(t){for(var r=null,o=0;o<t.streamList.length;o++)if(t.streamList[o].stream_id===e){r=t.streamList[o].urls_rtmp||[];break}return!r||r.length<=0?(this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+" cannot find stream url,Please check if CDN is configured "),this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e,i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError),!1):(this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+" play stream"),this.doPlayStream(e,r,s.ENUM_DISPATCH_TYPE.cdn))}this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+" room no found")},e.prototype.startPlayingStreamFromBGP=function(e){return this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP+" fetch stream url"),this.fetchPlayStreamUrl(e,this.ultraPlaySourceType,s.ENUM_DISPATCH_TYPE.ultra),!0},e.prototype.doPlayStream=function(e,t,r){return this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_DO_PLAY_STREAM+" call"),this.streamCenter.startPlayingStream(e,t,r),!0},e.prototype.fetchPlayStreamUrl=function(e,t,r){var o=this;if(this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" call "+e),this.rtm.service.isDisConnect())this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" state error");else{this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" send fetch request");var n=this.rtm.service.sendMessage("stream_url",{stream_ids:[e],url_type:t},(function(e){o.handleFetchStreamUrlRsp(e,r)}),(function(e){o.stateCenter.streamUrlMap[n]?o.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,o.stateCenter.streamUrlMap[n],i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError):o.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" already stop play")}));-1!==n&&(this.stateCenter.streamUrlMap[n]=e,this.streamCenter.playerList[e]&&(this.streamCenter.playerList[e].seq=n)),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+" call success")}},e.prototype.handleFetchStreamUrlRsp=function(e,t){var r,o,n;this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" call ");var l=this.stateCenter.streamUrlMap[null===(r=e.header)||void 0===r?void 0:r.seq];l&&delete this.stateCenter.streamUrlMap[null===(o=e.header)||void 0===o?void 0:o.seq];var u=e.body?e.body.err_code:e.code;if(0!==u)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" server error= "+u),void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,l,i.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError);var c="",h=[];e.body.stream_url_infos&&e.body.stream_url_infos.length>0&&(c=e.body.stream_url_infos[0].stream_id,h=e.body.stream_url_infos[0].urls_ws);var g=!1,d=this.stateCenter.getRoomByRoomID(null===(n=null==e?void 0:e.header)||void 0===n?void 0:n.room_id);if(d)if(e.header.seq===this.streamCenter.playerList[c].seq){for(var _=0;_<d.streamList.length;_++)if(d.streamList[_].stream_id==c){d.streamList[_].urltra_url_rtmp=h,g=!0;break}!g&&this.mixStreamList[c]&&(this.mixStreamList[c].urltra_url_rtmp=h,t=s.ENUM_DISPATCH_TYPE.cdn,g=!0),g||(this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+"cannot find streamInfo in existing stream list"),d.streamList.push({stream_id:c,urltra_url_rtmp:h})),this.doPlayStream(c,h,t),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" call success")}else this.logger.info(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" seq is not match, ignore "+c);else this.logger.error(a.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+" room no found")},e.prototype.setPreferPlaySourceType=function(e){return this.logger.info(a.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+" call"),e!==s.ENUM_PLAY_SOURCE_TYPE.cdn&&e!==s.ENUM_PLAY_SOURCE_TYPE.ultra?(this.logger.error(a.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+" sourceType can be number 0 or 1, which can be represented auto or ultra"),!1):(this.preferPlaySourceType=e,this.logger.info(a.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+" call success"),!0)},e}();t.PlayModule=l},557:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,i){function n(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,a)}l((o=o.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,o,s,i,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){n.label=i[1];break}if(6===i[0]&&n.label<s[1]){n.label=s[1],s=i;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(i);break}s[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LivePlayer=void 0;var s=function(){function e(e,t,r,o){this.wxContext=e,this.streamID=t,this.zegoWechatMini=r,this.attributes={},this.isPlaying=!1,this.logger=this.zegoWechatMini.logger,this.attributes.id=t,this.context=wx.createLivePlayerContext(this.attributes.id,o||this.wxContext)}return e.prototype.setPlayerAttributes=function(e,t){this.logger.info("zw.p.1.spa call "+this.streamID+" "+JSON.stringify(e)),Object.assign(this.attributes,e),this.zegoWechatMini.setPlayData(t),this.logger.info("zw.p.1.spa call success "+this.streamID+" "+JSON.stringify(this.attributes))},e.prototype.play=function(e){return r(this,void 0,void 0,(function(){var t=this;return o(this,(function(s){return new Promise((function(s,i){return r(t,void 0,void 0,(function(){var t,r,n=this;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.zegoWechatMini.startPlayingStream(this.streamID,e)];case 1:return t=o.sent().url,this.attributes.url=t,this.isPlaying=!0,this.zegoWechatMini.setPlayData(),this.context.play({success:function(){s(!0)},fail:function(){n.logger.error("zw.p.1.p.0 start play fail"),i()}}),[3,3];case 2:return r=o.sent(),this.logger.error("zw.p.1.p.0 start play catch fail "+JSON.stringify(r)),i(),[3,3];case 3:return[2]}}))}))})),[2]}))}))},e.prototype.stop=function(){var e=this;this.logger.info("zw.p.1.s call stop "+this.streamID),this.isPlaying||this.logger.info("zw.p.1.s stream is not playing"),this.context&&this.context.stop(),this.streamID&&(this.zegoWechatMini.stopPlayingStream(this.streamID),this.zegoWechatMini.wechatMiniModules.streamCenter.livePlayerList=this.zegoWechatMini.wechatMiniModules.streamCenter.livePlayerList.filter((function(t){return t.streamID!==e.streamID}))),this.isPlaying=!1,this.zegoWechatMini.setPlayData(),this.logger.info("zw.p.1.s call success")},e.prototype.pause=function(e){this.logger.info("zw.p.1.p.1 pull pause call "+this.streamID);try{this.context.pause(e)}catch(e){this.logger.error("zw.p.1.p.1 pull pause error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.p.1 pull pause success")},e.prototype.resume=function(e){this.logger.info("zw.p.1.r call "+this.streamID);try{this.context.resume(e)}catch(e){this.logger.error("zw.p.1.r error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.r call success")},e.prototype.mute=function(e){this.logger.info("zw.p.1.m mute call "+this.streamID);try{this.context.mute(e)}catch(e){this.logger.error("zw.p.1.m pull mute error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.m mute success")},e.prototype.requestFullScreen=function(e){this.logger.info("zw.p.1.rfs call "+this.streamID);try{this.context.requestFullScreen(e)}catch(e){this.logger.error("zw.p.1.rfs error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.rfs call success")},e.prototype.exitFullScreen=function(e){this.logger.info("zw.p.1.efs call "+this.streamID);try{this.context.exitFullScreen(e)}catch(e){this.logger.error("zw.p.1.efs error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.efs call success")},e.prototype.requestPictureInPicture=function(e){this.logger.info("zw.p.1.rpip call "+this.streamID);try{this.context.requestPictureInPicture(e)}catch(e){this.logger.error("zw.p.1.rpip error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.rpip call success")},e.prototype.exitPictureInPicture=function(e){this.logger.info("zw.p.1.epip call "+this.streamID);try{this.context.exitPictureInPicture(e)}catch(e){this.logger.error("zw.p.1.epip error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.epip call success")},e.prototype.snapshot=function(e){this.logger.info("zw.p.1.ss call "+this.streamID);try{this.context.snapshot(e)}catch(e){this.logger.error("zw.p.1.ss error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.1.ss call success")},e}();t.LivePlayer=s},80:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},o.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.PublishModule=void 0;var s=r(706),i=r(98),n=r(529),a=r(608),l=function(){function e(e,t,r,o,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=i,this.preferPublishSourceType=s.ENUM_DISPATCH_TYPE.ultra,this.ultraPlaySourceType="rtmp_v2"}return e.prototype.startPublishingStream=function(e,t){var r=this;return new Promise((function(l,u){r.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+" call");var c=s.getReportSeq();r.stateCenter.reportSeqList.startPublish[e]=c,r.dataReport.newReport(c,n.ZegoWechatLogEvent.kZegoTaskPublishStart.event);var h=function(t,s){r.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+" "+(s||t.message)),r.dataReport.uploadReport(c,void 0,t,s),delete r.stateCenter.reportSeqList.startPublish[e],u(o(o({},t),{errorCode:t.code,extendedData:t.message+(s?" "+s:"")}))};if(a.ClientUtil.isParamEmpty(e))if(a.ClientUtil.isTypeString(e)){if(!a.ClientUtil.isTooLong(e,s.MAX_STREAM_ID_LENGTH))return h(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDTooLongError),!1;if(!a.ClientUtil.checkIllegalCharacters(e))return h(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDInvalidCharacterError),!1;if(r.stateCenter.isMultiRoom&&(!t||"string"!=typeof t.roomID||""==t.roomID))return h(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError,"  roomID is need if set multi room"),!1;var g=(null==t?void 0:t.roomID)?t.roomID:r.stateCenter.roomList[0].roomID,d=r.stateCenter.getRoomByRoomID(g);if(r.dataReport.addMsgInfo(c,{publish_room_id:g}),d){if(r.stateCenter.customUrl&&0!=r.stateCenter.customUrl.length){r.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null};var _=r.streamCenter.updatePublishingState(d,e,t&&t.streamParams?t.streamParams:void 0,!0);if(!0!==_){var p=JSON.parse(JSON.stringify(_));return void h(p,"cannot start publish")}return r.streamCenter.publishSuccessCallBackList[e]=function(e,t){l({streamID:e,url:t})},r.streamCenter.startPublishingStream(e,r.stateCenter.customUrl,1)}if(r.rtm.service.isDisConnect())h(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError);else{var E=r.streamCenter.updatePublishingState(d,e,t&&t.streamParams?t.streamParams:void 0,!0);!0===E?(a.ClientUtil.logReportCallback("kZegoTaskPublishStart"+e,r.dataReport,c,r.stateCenter.reportList),d.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""}),r.dataReport.addMsgInfo(c,{stream:n.ZegoWechatLogEvent.kZegoTaskPublishStart.stream(e),publishOption:n.ZegoWechatLogEvent.kZegoTaskPublishStart.publishOption(t),mini_sys_infos:r.streamCenter.systemInfo}),!t||"CDN"!=t.sourceType&&"BGP"!=t.sourceType||r.setPreferPublishSourceType(s.ENUM_SOURCE_TYPE[t.sourceType]),r.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null},r.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+" fetch stream url"),a.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventStart,"get_publish_url"),r.streamCenter.publishSuccessCallBackList[e]=function(e,t){a.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,"get_publish_url"),l({streamID:e,url:t})},r.streamCenter.publishErrorCallBackList[e]=function(e){h(e)},r.fetchPublishStreamUrl(e,d)):(p=JSON.parse(JSON.stringify(E)),h(p,"cannot start publish"))}}else h(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError,"room no found")}else h(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError);else h(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDNullError)}))},e.prototype.setPreferPublishSourceType=function(e,t){return this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" call"),e!==s.ENUM_DISPATCH_TYPE.cdn&&e!==s.ENUM_DISPATCH_TYPE.ultra&&e!==s.ENUM_DISPATCH_TYPE.customUrl?(this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" sourceType only can be number 0 1 2"),!1):e!==s.ENUM_DISPATCH_TYPE.customUrl||"string"==typeof t&&""!=t?(this.preferPublishSourceType=e,this.customCdnUrl=t,this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" call success"),!0):(this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+" customUrl must be string and not empty"),!1)},e.prototype.fetchPublishStreamUrl=function(e,t){var r=this;this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+" call"),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+" send fetch publish request");var o="";this.preferPublishSourceType==s.ENUM_DISPATCH_TYPE.cdn?o="cdn":this.preferPublishSourceType==s.ENUM_DISPATCH_TYPE.ultra&&(o="bgp");var a=this.rtm.service.sendMessage("stream_publish",{stream_id:e,url_type:this.ultraPlaySourceType,publish_type:o,header_kvs:[{key:"grpc-metadata-push",value:this.customCdnUrl||""}]},(function(e){r.handleFetchStreamPublishUrlRsp(e)}),(function(o,i){r.streamCenter.publishErrorCallBackList[e](n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),t.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),r.streamCenter.stopPublishingStream(e)}),void 0,{sessionID:t.sessionID,roomID:t.roomID,roomSessionID:t.roomSessionID});-1!==a&&(this.stateCenter.streamUrlMap[a]=e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+" call success")},e.prototype.handleFetchStreamPublishUrlRsp=function(e){var t,r;this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" call");var o=null===(t=null==e?void 0:e.header)||void 0===t?void 0:t.room_id,a=this.stateCenter.getRoomByRoomID(o);if(a){var l=this.stateCenter.streamUrlMap[e.header.seq];l&&delete this.stateCenter.streamUrlMap[e.header.seq];var u=null===(r=e.body)||void 0===r?void 0:r.err_code;if(0!==u)return this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" server error= "+u),void(this.stateCenter.publishStreamList[l]&&(this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" liveRoom cmd error"),this.streamCenter.publishErrorCallBackList[l](n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),a.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,l,{code:n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError.code,message:"server error= "+u}),this.streamCenter.stopPublishingStream(l)));if(e.body.stream_url_info){var c,h=e.body.stream_url_info.stream_id;if(c=e.body.stream_url_info.urls_ws,!this.stateCenter.publishStreamList[h])return void this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" cannot find stream");this.stateCenter.publishStreamList[h].url_rtmp=c,this.stateCenter.publishStreamList[h].state=s.ENUM_PUBLISH_STREAM_STATE.tryPublish,this.doPublishStream(h,c,a)}}else this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+" room no found")},e.prototype.doPublishStream=function(e,t,r){return this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_DO_PUBLISH_STREAM+" call "+e+"streamUrl: "+t),!t||t.length<=0?(this.streamCenter.publishErrorCallBackList[e](n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),r.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),!1):(this.streamCenter.startPublishingStream(e,t,this.preferPublishSourceType),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_DO_PUBLISH_STREAM+" call success"),!0)},e.prototype.stopPublishingStream=function(e){var t=this;this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+" call "+e);var r=s.getReportSeq();this.dataReport.newReport(r,n.ZegoWechatLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(r,{stream_id:e});var o=function(o,s){t.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+" "+(s||o.message)),t.dataReport.uploadReport(r,void 0,o,s),delete t.stateCenter.reportSeqList.startPublish[e]};if(!a.ClientUtil.isParamEmpty(e))return o(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDNullError),!1;if(!a.ClientUtil.isTypeString(e))return this.logger.error(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+" room no found"),!1;var l=this.streamCenter.publisherList[e],u=null==l?void 0:l.room;if(!u)return o(n.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError," room no found"),!1;if(l&&l.state!==s.ENUM_PLAYER_STATE.stop&&u.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:0,message:""}),this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]){if(this.stateCenter.publishStreamList[e].state>=s.ENUM_PUBLISH_STREAM_STATE.update_info){u.streamHandler.updateStreamInfo(e,s.ENUM_STREAM_SUB_CMD.liveEnd);for(var c=0;c<u.streamList.length;c++)if(u.streamList[c].stream_id==e){u.streamList.splice(c--,1);break}}delete this.stateCenter.publishStreamList[e]}return this.stateCenter.streamUrlMap[e]&&delete this.stateCenter.streamUrlMap[e],this.dataReport.uploadReport(r),this.logger.info(i.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+" call success"),!0},e}();t.PublishModule=l},935:function(e,t){"use strict";var r=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,i){function n(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(n,a)}l((o=o.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,o,s,i,n={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,o&&(s=2&i[0]?o.return:i[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,i[1])).done)return s;switch(o=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return n.label++,{value:i[1],done:!1};case 5:n.label++,o=i[1],i=[0];continue;case 7:i=n.ops.pop(),n.trys.pop();continue;default:if(!((s=(s=n.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){n=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){n.label=i[1];break}if(6===i[0]&&n.label<s[1]){n.label=s[1],s=i;break}if(s&&n.label<s[2]){n.label=s[2],n.ops.push(i);break}s[2]&&n.ops.pop(),n.trys.pop();continue}i=t.call(e,n)}catch(e){i=[6,e],o=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.LivePusher=void 0;var s=function(){function e(e,t,r,o){this.wxContext=e,this.dataAtr=t,this.zegoWechatMini=r,this.defaultAttributes={enableCamera:!0,enableMic:!0},this.attributes={},this.isPublishing=!1,this.logger=this.zegoWechatMini.logger,this.context=wx.createLivePusherContext(),Object.assign(this.attributes,this.defaultAttributes),Object.assign(this.attributes,o)}return e.prototype.setWXData=function(e){if(this.wxContext&&this.dataAtr)if(void 0===e||"function"==typeof e){var t={};t[this.dataAtr]=this.attributes,this.wxContext.setData(t,e)}else this.logger.info("zw.p.0.swd callBack is not function");else this.logger.error("zw.p.0.swd context wrong")},e.prototype.iswxContext=function(){return!!this.wxContext},e.prototype.setPusherAttributes=function(e,t){this.logger.info("zw.p.0.spa call "+JSON.stringify(e)),Object.assign(this.attributes,e),this.setWXData(t),this.logger.info("zw.p.0.spa call success "+JSON.stringify(this.attributes))},e.prototype.startPreview=function(e){this.logger.info("zw.p.0.sp.0 call");try{this.context.startPreview(e)}catch(e){this.logger.error("zw.p.0.sp.0 error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.sp.0 call success")},e.prototype.stopPreview=function(e){this.logger.info("zw.p.0.sp.1 call");try{this.context.stopPreview(e)}catch(e){this.logger.error("zw.p.0.sp.1 error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.sp.1 call success")},e.prototype.start=function(e,t){var s=this;return new Promise((function(i,n){return r(s,void 0,void 0,(function(){var r,s,a=this;return o(this,(function(o){switch(o.label){case 0:if("string"!=typeof e)return this.logger.error("zw.p.0.s.0 streamID type error"),[2];this.attributes.id=e,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.zegoWechatMini.startPublishingStream(e,t)];case 2:return r=o.sent(),this.attributes.url=r.url,this.isPublishing=!0,this.setWXData(),this.context.start({success:function(){a.logger.info("zw.p.0.s.0 publish success"),i()},fail:function(e){a.logger.error(JSON.stringify(e)),n(e)}}),[3,4];case 3:return s=o.sent(),this.logger.error("zw.p.0.s.0 "+JSON.stringify(s)),n(s),[3,4];case 4:return[2]}}))}))}))},e.prototype.pause=function(e){this.logger.info("zw.p.0.p call");try{this.context.pause(e)}catch(e){this.logger.error("zw.p.0.p error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.p call success")},e.prototype.resume=function(e){this.logger.info("zw.p.0.r call");try{this.context.resume(e)}catch(e){this.logger.error("zw.p.0.r error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.r call success")},e.prototype.stop=function(){this.logger.info("zw.p.0.s.1 call"),this.attributes.id||this.logger.error("zw.p.0.s.1 publish id no found");try{this.context&&this.context.stop(),this.attributes.id&&this.zegoWechatMini.stopPublishingStream(this.attributes.id),this.attributes={},Object.assign(this.attributes,this.defaultAttributes),this.isPublishing=!1,this.setWXData()}catch(e){return void this.logger.error("zw.p.0.s.1 "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.s.1 call success")},e.prototype.snapshot=function(e){this.logger.info("zw.p.0.ss call");try{this.context.snapshot(e)}catch(e){this.logger.error("zw.p.0.ss error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.ss call success")},e.prototype.playBGM=function(e){this.logger.info("zw.p.0.pb.0 call");try{this.context.playBGM(e)}catch(e){this.logger.error("zw.p.0.pb.0 error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.pb.0 call success")},e.prototype.pauseBGM=function(e){this.logger.info("zw.p.0.pb.1 call");try{this.context.pauseBGM(e)}catch(e){this.logger.error("zw.p.0.pb.1 error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.pb.1 call success")},e.prototype.resumeBGM=function(e){this.logger.info("zw.p.0.rb call");try{this.context.resumeBGM(e)}catch(e){this.logger.error("zw.p.0.rb error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.rb call success")},e.prototype.stopBGM=function(e){this.logger.info("zw.p.0.sb call");try{this.context.stopBGM(e)}catch(e){this.logger.error("zw.p.0.sb error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.sb call success")},e.prototype.setBGMVolume=function(e){this.logger.info("zw.p.0.sbv call");try{this.context.setBGMVolume(e)}catch(e){this.logger.error("zw.p.0.sbv error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.sbv call success")},e.prototype.setMICVolume=function(e){this.logger.info("zw.p.0.smv call");try{this.context.setMICVolume(e)}catch(e){this.logger.error("zw.p.0.smv error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.smv call success")},e.prototype.switchCamera=function(e){this.logger.info("zw.p.0.sc call");try{this.context.switchCamera(e)}catch(e){this.logger.error("zw.p.0.sc error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.sc call success")},e.prototype.toggleTorch=function(e){this.logger.info("zw.p.0.tt call");try{this.context.toggleTorch(e)}catch(e){this.logger.error("zw.p.0.tt error "+(e?JSON.stringify(e):""))}this.logger.info("zw.p.0.tt call success")},e}();t.LivePusher=s},938:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoPlayWechat=void 0;var o=r(98),s=r(608),i=r(706),n=r(529),a=function(){function e(e,t,r,o,s,n){this.logger=e,this.streamId=t,this.streamCenter=r,this.dataReport=o,this.stateCenter=s,this.room=n,this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=i.ENUM_PLAYER_STATE.stop,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=(new Date).getTime(),this.seq=-1}return e.prototype.resetPlayer=function(){this.state=i.ENUM_PLAYER_STATE.stop},e.prototype.newPlayer=function(){this.resetPlayer();var e=this.getCurrentPlayerUrl(),t=e;0!=this.params.length&&(t=e+"?"+this.params);var r=(new Date).getTime();return t=t.indexOf("?")>-1?t+"&zgseq="+r+"&zgdid="+this.room.sessionID:t+"?zgseq="+r+"&zgdid="+this.room.sessionID,e!==this.currentUrl?(this.currentUrl=e,this.streamCenter.onStreamUrlUpdate(this.streamId,t,this.playerType)):this.streamCenter.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,"PlayBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PlayBegin","url",t),this.tryUrls.push(t)):(this.dataReport.eventStart(this.playerReportSeq,"PublishBegin"),this.dataReport.addEventInfo(this.playerReportSeq,"PublishBegin","url",t),this.tryUrls.push(t)):this.dataReport.addEventInfo(this.playerSeq,0==this.playerType?"PlayRetry":"PublishRetry","url",t),this.state=i.ENUM_PLAYER_STATE.start,!0},e.prototype.stopPlayer=function(){0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,"PlayStat",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,"PublishStat","quality",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,"PublishStat",{quality:this.playerInfo}))},e.prototype.tryStartPlayer=function(e){for(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+" call");this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+" index: "+this.playUrlIndex+", url: "+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+" stream: "+this.streamId),this.resetPlayer();var t="";0==this.playerType?t="PlayEnd":1==this.playerType&&(t="PublishEnd",this.reportQualityStatics()),this.dataReport.addEvent(this.playerSeq,t,{error:e,reason:"no url to retry"}),this.streamCenter.onPlayerStop(this.streamId,this.playerType,e)}},e.prototype.getPlayerUrl=function(){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_GET_PLAY_URL+" call "+this.streamId);var e=this.urls[++this.retryIndex%this.urls.length],t=e;0!=this.params.length&&(t=e+"?"+this.params);var r=(new Date).getTime();return t=t.indexOf("?")>-1?t+"&zgseq="+r+"&zgdid="+this.room.sessionID:t+"?zgseq="+r+"&zgdid="+this.room.sessionID,this.tryUrls.push(t),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_GET_PLAY_URL+" call streamId: "+this.streamId+" url: "+t),t},e.prototype.shouldRetryPlay=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3005==t},e.prototype.isPlayFailed=function(e){var t=e.detail.code;return-2301==t||2101==t||2102==t},e.prototype.shouldRetryPublish=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3004==t||3005==t},e.prototype.isPublishFailed=function(e){var t=e.detail.code;return-1301==t||-1302==t||-1303==t||-1304==t||-1305==t||-1306==t||-1307==t||-1308==t||-1309==t||-1310==t||-1311==t},e.prototype.updateEvent=function(e){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" "+this.streamId+" state code: "+JSON.stringify(e.detail.code)),0==this.playerType?(this.playBegin||(this.playBegin=!0,s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"play_begin")),2004==e.detail.code?(this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PlayRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PlayStat"),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"play_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"play_begin"),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"play_state"))),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" play suc: "+this.streamId),this.state=i.ENUM_PLAYER_STATE.playing,this.streamCenter.onPlayerStart(this.streamId,this.playerType)):2009==e.detail.code||this.shouldRetryPlay(e)||this.isPlayFailed(e)&&(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" play error: "+this.streamId),this.resetPlayer(),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"play_begin","error_code",e.detail.code),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"play_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"play_begin"),s.ClientUtil.actionSuccessCallback("kZegoTaskPlayStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{})),this.playBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:"play fail"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PlayBegin")):1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"push_begin")),1002==e.detail.code?this.handlePublisherSuccess():this.shouldRetryPublish(e)||this.isPublishFailed(e)&&(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" publish error: "+this.streamId),this.resetPlayer(),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"push_begin","error_code",e.detail.code),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"push_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"push_begin"),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addMsgInfo,void 0,{})),this.pushBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:"publish fail"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,"PublishBegin"))},e.prototype.updatePlayerNetStatus=function(e){var t={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoHeight:e.detail.info.videoHeight,videoWidth:e.detail.info.videoWidth,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter};if(this.playerInfo=t,1==this.playerType){this.everSuccess||"8.0.16"==wx.getSystemInfoSync().version&&this.handlePublisherSuccess();var r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight};0==this.publishQualitySeq&&(this.publishQualitySeq=i.getReportSeq(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,"PublishQuality",r),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount&&(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}else 0==this.playerType&&(r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight},0==this.playQualitySeq&&(this.playQualitySeq=i.getReportSeq(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,"PlayQuality",r),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount&&(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportPlayQualityStatics(),this.playerLogUploadTime=(new Date).getTime()));this.streamCenter.onPlayerQuality(this.streamId,t,this.playerType)},e.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},e.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:"WXPublishStateUpdate"}),this.dataReport.uploadReport(this.publishQualitySeq,n.ZegoWechatLogEvent.kZegoEventPublishStat),this.publishQualityCount=0,this.publishQualitySeq=0},e.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:"WXPlayStateUpdate"}),this.dataReport.uploadReport(this.playQualitySeq,n.ZegoWechatLogEvent.kZegoEventPlayStat),this.playQualityCount=0,this.playQualitySeq=0},e.prototype.handlePublisherSuccess=function(){this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,"PublishRetry"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,"PublishStat"),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.addEventMsg,"push_begin","try_urls",this.tryUrls),s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventEnd,"push_begin"),this.stateCenter.publishStreamList[this.streamId]&&this.stateCenter.publishStreamList[this.streamId].state==i.ENUM_PUBLISH_STREAM_STATE.tryPublish&&s.ClientUtil.actionSuccessCallback("kZegoTaskPublishStart"+this.streamId,this.stateCenter.reportList)(i.REPORT_ACTION.eventStart,"publish_state"))),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+" play suc: "+this.streamId),this.state=i.ENUM_PLAYER_STATE.playing,this.streamCenter.onPlayerStart(this.streamId,this.playerType)},e}();t.ZegoPlayWechat=a},300:function(e,t,r){"use strict";var o,s=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoStreamCenterWechat=void 0;var i=r(98),n=r(740),a=r(706),l=r(529),u=r(608),c=r(938),h=0,g=1,d=2,_=0,p=1,E=function(e){function t(t,r,o){var s=e.call(this)||this;s.playerList={},s.publisherList={},s.playerCount=0,s.playingList=[],s.publishingList=[],s.eventSeq=0,s.streamEventMap={},s.streamReportMap={},s.livePlayerList=[],s.playerContextMap={},s.publishSuccessCallBackList={},s.publishErrorCallBackList={},s.playSuccessCallBackList={},s.playErrorCallBackList={},s.logger=t,s.dataReport=o,s.stateCenter=r;var i=wx.getSystemInfoSync();return s.systemInfo={brand:i.brand,model:i.model,system:i.system,platform:i.platform,version:i.version,SDKVersion:i.SDKVersion},s}return s(t,e),t.prototype.updatePlayingState=function(e,t,r){if(this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE+" "+e),null==e)return l.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDNullError;if(r){var o=this.playerList[e],s=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(s,"updatePlayingState"),o)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE+" player already exist"),this.dataReport.eventEndWithMsgInfo(s,"updatePlayingState",{message:"player already exist"}),this.dataReport.uploadReport(s,void 0),delete this.stateCenter.reportSeqList.startPlay[e],l.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayRepeatedPullError;var n=this.stateCenter.getPlayRoom(e)||this.stateCenter.roomList[0];if(!n)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE+" room no found"),l.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError;this.playerList[e]=new c.ZegoPlayWechat(this.logger,e,this,this.dataReport,this.stateCenter,n)}return this.updateStreamState(e,r,t,this.playingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPlay[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPlayInfo")):this.reportPlayEvent(e),!0},t.prototype.updatePublishingState=function(e,t,r,o){if(void 0===r&&(r=""),void 0===o&&(o=!1),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE+" "+t),null==t)return l.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDNullError;if(o){var s=this.publisherList[t],n=this.stateCenter.reportSeqList.startPublish[t];if(this.dataReport.eventStart(n,"updatePublishingState"),s)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE+" player already exist"),this.dataReport.eventEndWithMsgInfo(n,"updatePublishingState",{message:"player already exist"}),this.dataReport.uploadReport(n,void 0),delete this.stateCenter.reportSeqList.startPublish[t],l.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kIsPublishing;this.publisherList[t]=new c.ZegoPlayWechat(this.logger,t,this,this.dataReport,this.stateCenter,e)}return this.updateStreamState(t,o,r,this.publishingList),o?(this.streamEventMap[t]=this.stateCenter.reportSeqList.startPublish[t],this.eventSeq+=1,this.streamReportMap[t]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,"GotPublishInfo")):this.reportPublishEvent(t),!0},t.prototype.updateAudioVolumeNotify=function(e,t){var r,o;this.logger.info(i.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_VOLUME_NOTIFY+" "+e),null!=e&&null!=(null===(r=null==t?void 0:t.detail)||void 0===r?void 0:r.volume)&&this.logger.info(i.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_VOLUME_NOTIFY+" "+e+" volume: "+(null===(o=null==t?void 0:t.detail)||void 0===o?void 0:o.volume))},t.prototype.updateStreamState=function(e,t,r,o){if(e)if(r&&"string"==typeof r||(r=""),1==t)o.push({streamID:e,params:r});else for(var s=0;s<o.length;s++)if(o[s].streamID==e){o.splice(s--,1);break}},t.prototype.isPlaying=function(){return 0!=this.playingList.length},t.prototype.isPublishing=function(){return 0!=this.publishingList.length},t.prototype.startPlayingStream=function(e,t,r){if(this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYING_STREAM+" call "+e),this.streamEventMap[e]){var o="";0==r?o="cdn":1==r&&(o="ultra_src"),u.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"get_play_url",["type",o]),u.ClientUtil.actionLogReportCallback("kZegoTaskPlayStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"get_play_url",["urls",t])}var s=this.streamReportMap[e];return s&&this.dataReport.eventEndWithMsg(s,"GotPlayInfo",{type:0==r?"cdn":"ultra_src",urls:t}),this.startPlayer(e,t,r,_)},t.prototype.startPlayer=function(e,t,r,o){var s=this.playerList[e];if(o==p&&(s=this.publisherList[e]),!s)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" player don't exist"),!1;var n=[];o==_?n=this.playingList:o==p&&(n=this.publishingList);for(var a=!1,l="",u=0;u<n.length;u++)if(n[u].streamID==e){a=!0,l=n[u].params;break}if(!a)return this.logger.warn(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" should not start"),!1;if(s.urls=t,s.params=l,s.reconnectLimit=this.getReconnectLimit(r),s.dispatchType=r,s.playerType=o,s.playerSeq=this.streamEventMap[e],s.playerReportSeq=this.streamReportMap[e],!s)return this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" new player failed"),!1;++this.playerCount;var c=s.tryStartPlayer(0);return this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+" call result: "+c),!0},t.prototype.getNextUrl=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_GET_NEXT_URL+" call "+e);var t,r=this.publisherList[e]||this.playerList[e];if(!r)return this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_GET_NEXT_URL+" player don't exist"),"";this.publishingList.find((function(t){return t.streamID===e}))?(t=!0,this.onPublishStateUpdate(a.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:""})):(t=!1,this.onPlayStateUpdate(d,e,{code:0,message:""}));var o=r.getPlayerUrl();if(t){if(!this.stateCenter.reportSeqList.startPublish[e]){var s=a.getReportSeq();this.stateCenter.reportSeqList.startPublish[e]=s,this.dataReport.newReport(s,l.ZegoWechatLogEvent.kZegoTaskRePublish),r.pushBegin=!1,u.ClientUtil.logReportCallback("kZegoTaskPublishStart"+e,this.dataReport,s,this.stateCenter.reportList)}}else this.stateCenter.reportSeqList.startPlay[e]||(s=a.getReportSeq(),this.stateCenter.reportSeqList.startPlay[e]=s,this.dataReport.newReport(s,l.ZegoWechatLogEvent.kZegoTaskRePlay),r.playBegin=!1,u.ClientUtil.logReportCallback("kZegoTaskPlayStart"+e,this.dataReport,s,this.stateCenter.reportList));return o},t.prototype.stopPlayingStream=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYING_STREAM+" call "+e),null!=e&&(this.stopPlayer(e),delete this.streamEventMap[e],delete this.streamReportMap[e],this.updatePlayingState(e),delete this.playSuccessCallBackList[e],delete this.playErrorCallBackList[e])},t.prototype.stopPlayer=function(e){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+" call "+e);var t=this.playerList[e],r=this.publisherList[e];t||r?(t&&(t.stopPlayer(),delete this.playerList[e]),r&&(r.stopPlayer(),delete this.publisherList[e]),--this.playerCount):this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+" play not exist "+e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+" call success")},t.prototype.startPublishingStream=function(e,t,r){if(this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PUBLISHING_STREAM+" call "+e),this.streamEventMap[e]){var o="";0==r?o="cdn":1==r&&(o="ultra_src"),u.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"type",o),u.ClientUtil.actionLogReportCallback("kZegoTaskPublishStart"+e,this.stateCenter.reportList,a.REPORT_ACTION.addEventMsg,"urls",t)}var s=this.streamReportMap[e];return s&&this.dataReport.eventEndWithMsg(s,"GotPublishInfo",{type:0==r?"cdn":"ultra_src",urls:t}),this.startPlayer(e,t,r,p)},t.prototype.stopPublishingStream=function(e){if(this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM+" call "+e),null!=e){var t=this.publisherList[e].room;this.stopPlayer(e),delete this.streamEventMap[e],delete this.streamReportMap[e],this.updatePublishingState(t,e,"",!1)}},t.prototype.updatePlayerState=function(e,t){var r=this.playerList[e],o=this.publisherList[e];r||o?(r&&r.updateEvent(t),o&&o.updateEvent(t)):this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE+" no player "+e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE+" updatePlayerEvent success")},t.prototype.updatePlayerNetStatus=function(e,t){var r=this.playerList[e],o=this.publisherList[e];r||o?(r&&r.updatePlayerNetStatus(t),o&&o.updatePlayerNetStatus(t)):this.logger.error(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS+" no player "+e),this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS+" updatePlayerNetStatus success")},t.prototype.reset=function(e,t){var r,o;for(var s in this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_RESET+" call"),this.publisherList)(this.publisherList[s].room.roomID==e||!e)&&this.stopPublishingStream(s),this.pusherInstance&&this.pusherInstance.stop();this.pusherInstance=void 0;var n=function(t){var s=a.playerList[t].room;if(s.roomID!=e||!s.streamList.find((function(e){return e.stream_id==t}))&&1!=a.stateCenter.roomList.length){if(s.roomID==e&&a.stateCenter.roomList.length>1){var i=a.stateCenter.roomList.find((function(t){return t.roomID!==e}));i?a.playerList[t].room=i:(null===(o=a.livePlayerList.find((function(e){return e.attributes.id==t})))||void 0===o||o.stop(),a.stopPlayingStream(t))}}else null===(r=a.livePlayerList.find((function(e){return e.attributes.id==t})))||void 0===r||r.stop(),a.stopPlayingStream(t)},a=this;for(var l in this.playerList)n(l);this.livePlayerList=[],this.playerContextMap={},this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_RESET+" call success")},t.prototype.reportPublishEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:"WXPublishStream"}),this.dataReport.uploadReport(r,"WXPublishStream"),delete this.streamReportMap[e]}},t.prototype.reportPlayEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:"WXPlayStream"}),this.dataReport.uploadReport(r,"WXPlayStream"),delete this.streamReportMap[e]}},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onPublisherStreamUrlUpdate=function(e,t){},t.prototype.onPublisherStreamUrlFail=function(e,t){},t.prototype.onPlayerStreamUrlUpdate=function(e,t){},t.prototype.getReconnectLimit=function(e){return 1},t.prototype.onPlayerStart=function(e,t){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_START+" call "+e),t==_?this.onPlayStateUpdate(h,e,{code:0,message:""}):t==p&&this.onPublishStateUpdate(h,e,{code:0,message:""})},t.prototype.onPlayerStop=function(e,t,r){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+" call "+e),t==_?(this.reportPlayEvent(e,r),this.logger.warn(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+" play error"),this.onPlayStateUpdate(g,e,r)):t==p&&(this.reportPublishEvent(e,r),this.logger.warn(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+" publish error"),this.onPublishStateUpdate(g,e,r))},t.prototype.onPlayerRetry=function(e,t){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_RETRY+" call "+e),t==_?this.onPlayStateUpdate(d,e,{code:0,message:""}):t==p&&this.onPublishStateUpdate(d,e,{code:0,message:""})},t.prototype.onPlayerQuality=function(e,t,r){var o={video:{videoBitrate:t.videoBitrate,videoFPS:t.videoFPS,videoWidth:t.videoWidth,videoHeight:t.videoHeight},audio:{audioBitrate:t.audioBitrate}};r==_?this.onPlayQualityUpdate(e,o):r==p&&this.onPublishQualityUpdate(e,o)},t.prototype.onStreamUrlUpdate=function(e,t,r){this.logger.info(i.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE+" call "+e),0==r?this.playSuccessCallBackList[e](e,t):this.publishSuccessCallBackList[e](e,t)},t.prototype.getTotalStreamId=function(e){return e},t.prototype.getRealStreamId=function(e){return e},t.prototype.getRoomByStreamID=function(e){return this.publisherList[e]?this.publisherList[e].room:this.playerList[e]?this.playerList[e].room:void 0},t}(n.ZegoStreamCenter);t.ZegoStreamCenterWechat=E},545:function(e){"undefined"!=typeof self&&self,e.exports=function(){return t=[function(e,t,r){(function(t){var o;e.exports=(o=function(e){var o;if("undefined"!=typeof window&&window.crypto&&(o=window.crypto),"undefined"!=typeof self&&self.crypto&&(o=self.crypto),!(o=!(o=!(o="undefined"!=typeof globalThis&&globalThis.crypto?globalThis.crypto:o)&&"undefined"!=typeof window&&window.msCrypto?window.msCrypto:o)&&void 0!==t&&t.crypto?t.crypto:o))try{o=r(7)}catch(n){}var s=Object.create||function(e){return i.prototype=e,e=new i,i.prototype=null,e};function i(){}var n={},a=n.lib={},l=a.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),(t.init.prototype=t).$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=a.WordArray=l.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,r=e.words,o=this.sigBytes,s=e.sigBytes;if(this.clamp(),o%4)for(var i=0;i<s;i++)t[o+i>>>2]|=(r[i>>>2]>>>24-i%4*8&255)<<24-(o+i)%4*8;else for(var n=0;n<s;n+=4)t[o+n>>>2]=r[n>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(function(){if(o){if("function"==typeof o.getRandomValues)try{return o.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof o.randomBytes)try{return o.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")}());return new u.init(t,e)}}),c=n.enc={},h=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,o=[],s=0;s<r;s++){var i=t[s>>>2]>>>24-s%4*8&255;o.push((i>>>4).toString(16)),o.push((15&i).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o+=2)r[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new u.init(r,t/2)}},g=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,o=[],s=0;s<r;s++)o.push(String.fromCharCode(t[s>>>2]>>>24-s%4*8&255));return o.join("")},parse:function(e){for(var t=e.length,r=[],o=0;o<t;o++)r[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new u.init(r,t)}},d=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(g.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return g.parse(unescape(encodeURIComponent(e)))}},_=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,o=this._data,s=o.words,i=o.sigBytes,n=this.blockSize,a=i/(4*n),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*n;if(t=e.min(4*l,i),l){for(var c=0;c<l;c+=n)this._doProcessBlock(s,c);r=s.splice(0,l),o.sigBytes-=t}return new u.init(r,t)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),p=(a.Hasher=_.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}}),n.algo={});return n}(Math),o)}).call(this,r(6))},function(e,t,r){function o(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return s[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var s,i;e.exports=(s=[function(e,t,r){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.E_CLIENT_TYPE=t.ENUM_LOG_LEVEL=t.ENUM_REMOTE_TYPE=t.ZEGO_ENV=t.ZEGO_BROWSER_TYPE=void 0,(o=t.ZEGO_BROWSER_TYPE||(t.ZEGO_BROWSER_TYPE={}))[o.IE=0]="IE",o[o.FIREFOX=1]="FIREFOX",o[o.CHROME=2]="CHROME",o[o.SAFARI=3]="SAFARI",o[o.OPERA=4]="OPERA",o[o.WEIXIN=5]="WEIXIN",o[o.WEIXINMINI=6]="WEIXINMINI",o[o.UNKOWN=7]="UNKOWN",(o=t.ZEGO_ENV||(t.ZEGO_ENV={}))[o.BROWSER=0]="BROWSER",o[o.WEIXINMINI=1]="WEIXINMINI",(o=t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={}))[o.DISABLE=0]="DISABLE",o[o.WEBSOCKET=1]="WEBSOCKET",o[o.HTTPS=2]="HTTPS",t.ENUM_LOG_LEVEL={DEBUG:0,INFO:1,WARN:2,ERROR:3,REPORT:99,DISABLE:100,debug:0,info:1,warn:2,error:3,report:99,disable:100},(o=t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}))[o.ClientType_None=0]="ClientType_None",o[o.ClientType_H5=1]="ClientType_H5",o[o.ClientType_SmallPragram=2]="ClientType_SmallPragram",o[o.ClientType_Webrtc=3]="ClientType_Webrtc"},function(e,t,r){"use strict";function o(){this._testEnvironment=!0,this._ENV=0,this._debug=!0}Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=void 0,o.getInstance=function(){return o.instance||(o.instance=new o).init(),o.instance},o.prototype.init=function(){},Object.defineProperty(o.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"ENV",{get:function(){return this._ENV},set:function(e){this._ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e},enumerable:!1,configurable:!0}),o.instance=new o,t.LoggerStateCenter=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createZegoWebSocket=t.ZegoWeiXinMiniWebSocket=void 0;var o=r(0),s=(i.prototype.init=function(){var e=this;this._websocket&&(this.readyState=0,this._websocket.onOpen((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onopen&&(e.onopen(t),e._websocket.onClose((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onclose&&e.onclose(t)})),e._websocket.onMessage((function(t){"function"==typeof e.onmessage&&e.onmessage(t)})))})),this._websocket.onError((function(t){e.readyState=e._websocket.readyState,"function"==typeof e.onerror&&e.onerror(t)})))},i.prototype.onopen=function(e){},i.prototype.onerror=function(e){},i.prototype.onclose=function(e){},i.prototype.onmessage=function(e){},i.prototype.send=function(e){this._websocket&&this._websocket.send({data:e})},i.prototype.close=function(){this._websocket&&this._websocket.close()},i);function i(e,t){this.url=e,this.readyState=3,this._websocket=wx.connectSocket({url:e}),this.init()}t.ZegoWeiXinMiniWebSocket=s,t.createZegoWebSocket=function(e,t){return new(t%2===o.ZEGO_ENV.BROWSER?WebSocket:s)(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerStateCenter=t.createZegoWebSocket=t.ZegoDataReport=t.ZegoLogger=void 0;var o=r(1),s=(Object.defineProperty(t,"LoggerStateCenter",{enumerable:!0,get:function(){return o.LoggerStateCenter}}),r(2)),i=(Object.defineProperty(t,"createZegoWebSocket",{enumerable:!0,get:function(){return s.createZegoWebSocket}}),r(4)),n=(Object.defineProperty(t,"ZegoDataReport",{enumerable:!0,get:function(){return i.ZegoDataReport}}),r(5));Object.defineProperty(t,"ZegoLogger",{enumerable:!0,get:function(){return n.ZegoLogger}})},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoDataReport=void 0,i.prototype.newReport=function(e,t){this.dataStatistics[e]={event_time:Date.now(),time_consumed:0,seq:e,error:0,message:"success",event:t,events:[]}},i.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+" not exist")},i.prototype.addMsgInfo=function(e,t){this.dataStatistics[e]?Object.assign(this.dataStatistics[e],t):console.warn(e+" not exist")},i.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,event_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},i.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o&&0!==o.length){for(var s=o.length-1;0<=s;s--)if(o[s].event==t&&0==o[s].time_consumed){o[s].time_consumed=Date.now()-o[s].event_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},i.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(s){for(var i=s.length-1;0<=i;i--)if(s[i].event==t&&0==s[i].time_consumed){s[i].time_consumed=Date.now()-s[i].event_time,null==s[i].msg_ext&&(s[i].msg_ext={}),s[i].msg_ext=o({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},i.prototype.eventEndWithMsgInfo=function(e,t,r){if(this.dataStatistics[e]){var o=this.dataStatistics[e].events;if(o){for(var s=o.length-1;0<=s;s--)if(o[s].event==t&&0==o[s].time_consumed){o[s].time_consumed=Date.now()-o[s].event_time,Object.assign(o[s],r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},i.prototype.addEventInfo=function(e,t,r,o){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;0<=i;i--)if(s[i].event==t&&null!=s[i].time_consumed){null==s[i].msg_ext?s[i].msg_ext={}:s[i].msg_ext&&(s[i].msg_ext[r]=o);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},i.prototype.addEventMsg=function(e,t,r,o){if(this.dataStatistics[e]){var s=this.dataStatistics[e].events;if(null!=s){for(var i=s.length-1;0<=i;i--)if(s[i].event==t){s[i][r]=o;break}}else this.logger.warn("zd.aem.0 no events")}else this.logger.warn("zd.aem.0 no seq match")},i.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&this.dataStatistics[e].events.push(r?{event:t,event_time:Date.now(),msg_ext:r}:{event:t,event_time:Date.now()}):this.logger.warn("zd.ae.0 no seq match")},i.prototype.uploadReport=function(e,t,r,o){var s=this.dataStatistics[e];null!=s&&(t&&(s.event=t),s.time_consumed=Date.now()-s.event_time,r&&this.addMsgInfo(e,{error:r.code,message:r.message||r.msg+" "+(o||"")}),this.logger.report(s),delete this.dataStatistics[e])},i);function i(e){this.dataStatistics={},this.logger=e}t.ZegoDataReport=s},function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},s=(Object.defineProperty(t,"__esModule",{value:!0}),t.ZegoLogger=void 0,r(0)),i=r(2),n=r(1),a=r(6);function l(e){this.logLevel=s.ENUM_LOG_LEVEL.INFO,this.logRemoteLevel=0,this.websocket=null,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.existUserID=!1,this.stateCenter=n.LoggerStateCenter.getInstance(),this.env=e}l.prototype.setLogLevel=function(e){return void 0!==(e=s.ENUM_LOG_LEVEL[e])&&(this.logLevel=e,!0)},l.prototype.setRemoteLogLevel=function(e){return void 0!==(e=s.ENUM_LOG_LEVEL[e])&&(this.logRemoteLevel=e,!0)},l.prototype.setSessionInfo=function(e,t,r,o,s,i){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=o,this.userName=s,this.version=i},l.prototype.report=function(e){e=this.logReportParamList(s.ENUM_LOG_LEVEL.REPORT,e),this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.REPORT&&console.debug(e),this.RemoteLog(s.ENUM_LOG_LEVEL.REPORT,e,!0)},l.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.DEBUG,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.DEBUG&&console.debug(r),this.log(s.ENUM_LOG_LEVEL.DEBUG,r)},l.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.INFO,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.INFO&&console.info(r),this.log(s.ENUM_LOG_LEVEL.INFO,r)},l.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.WARN,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.WARN&&console.warn(r),this.log(s.ENUM_LOG_LEVEL.WARN,r)},l.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(s.ENUM_LOG_LEVEL.ERROR,e.join(""));this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=s.ENUM_LOG_LEVEL.ERROR&&(console.error(r),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(s.ENUM_LOG_LEVEL.ERROR,r)},l.prototype.log=function(e,t){this.logRemoteLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},l.prototype.setLogServer=function(e){try{return e.startsWith("wss:")?(this.logType=s.ENUM_REMOTE_TYPE.WEBSOCKET,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=s.ENUM_REMOTE_TYPE.HTTPS,this.openHttpsLogServer(e)):this.logType=s.ENUM_REMOTE_TYPE.DISABLE,!0}catch(e){return this.error(JSON.stringify(e)),!1}},l.prototype.stopLogServer=function(){this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET?this.stopWebSocketServer():this.logType==s.ENUM_REMOTE_TYPE.HTTPS&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=s.ENUM_REMOTE_TYPE.DISABLE},l.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},l.prototype.openHttpsLogServer=function(e){var t=this;(this.url=e)&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},l.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},l.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==s.ENUM_REMOTE_TYPE.WEBSOCKET)this.RemoteWebSocketLog(e,t);else if(this.logType==s.ENUM_REMOTE_TYPE.HTTPS)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==s.ENUM_LOG_LEVEL.DISABLE&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},l.prototype.RemoteWebSocketLog=function(e,t){if("string"==typeof t&&4e3<t.length)console.info("log over maximum, ignore");else if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.setLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(0<this.logCacheSend.length){for(var s="",i=0;i<this.logCacheSend.length;i++){4e3<(s+this.logCacheSend[i]).length&&(this.websocket.send(s),s="");var n=JSON.parse(this.logCacheSend[i]);n=o(o({},n),{userid:n.userid||this.userid,roomid:n.roomid||this.roomid,userName:n.roomid||this.userName}),s=s+JSON.stringify(n)+"\n"}t=s+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},l.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},l.prototype.logParamList=function(e,t){var r={time:r=a.getCurrentTime(),level:e,action:(t=[t.substr(0,t.indexOf(" "))||t,t.substr(t.indexOf(" ")+1,4500)||t])[0],content:t[1],appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(r)},l.prototype.logReportParamList=function(e,t){var r=a.getCurrentTime();return t=o(o({},t),{time:r,level:e,console:this.env%2===s.ZEGO_ENV.BROWSER?"rtc":"xcx",appid:this.appid,room_id:this.roomid,roomid:this.roomid,userid:this.userid,id_name:this.userid,userName:this.userName,sessionid:this.sessionid,sdk_version:this.version,test_environment:this.stateCenter.testEnvironment,version:this.version,event_id:this.appid+"_"+this.userid+"_"+t.event_time+"_"+t.seq}),JSON.stringify(t)},l.prototype.openWebSocketLogServer=function(e){this.url!=e&&(this.url=e)&&(this.stopWebSocketServer(),this.websocket=i.createZegoWebSocket(e,this.env),this.websocket.onopen=function(){},this.websocket.onclose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("onclose   websocket error:",e)},this.websocket.onmessage=function(){},this.websocket.onerror=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn("open log websocket error:",e)})},l.prototype.SendHttpsLog=function(){0!=this.logCacheSend.length&&(this.env%2===s.ZEGO_ENV.BROWSER?this.SendHttpsLogWeb():this.SendHttpsLogWeChatMini())},l.prototype.SendHttpsLogWeb=function(){var e=this,t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(0!=r.responseText.length)try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(t){console.log("send result failed "+t)}}else console.log("send failed "+r.status)},r.open("POST",this.url,!0),0==this.env?r.send(t):2==this.env&&(r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify({user_id:this.userid,log:t}))),this.logCacheSend=[]},l.prototype.SendHttpsLogWeChatMini=function(){var e=this,t=(!this.existUserID&&this.userid&&this.logCacheSend.forEach((function(t){Array.isArray(t)&&t.forEach((function(r,o){var s=JSON.parse(r);s&&""==JSON.parse(r).userid?(s.userid=e.userid,s.id_name=e.userid,t[o]=JSON.stringify(s)):e.existUserID=!0}))})),this.logCacheSend.join("\n"));t=1==this.env?t:JSON.stringify({user_id:this.userid,log:t}),wx.request({url:this.url,data:t,method:"POST",success:function(t){0!=t.data.length&&"number"==typeof(t=t&&t.data&&t.data.interval)&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))},fail:function(e){console.log("send failed "+e.statusCode)}}),this.logCacheSend=[]},t.ZegoLogger=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentTime=t.getCurrentEnv=t.getBrowser=void 0;var o=r(0),s=(t.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),s=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,n=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return e=e.toLowerCase().match(/MicroMessenger/i)&&"micromessenger"===e.toLowerCase().match(/MicroMessenger/i)[0],t?o.ZEGO_BROWSER_TYPE.IE:r?o.ZEGO_BROWSER_TYPE.FIREFOX:s?o.ZEGO_BROWSER_TYPE.OPERA:i?o.ZEGO_BROWSER_TYPE.CHROME:n?o.ZEGO_BROWSER_TYPE.SAFARI:e?o.ZEGO_BROWSER_TYPE.WEIXIN:o.ZEGO_BROWSER_TYPE.UNKOWN},t.getCurrentEnv=function(){var e=window.navigator.userAgent;return new Promise((function(t){-1==e.indexOf("MicroMessage")?t(o.ZEGO_ENV.BROWSER):wx.miniProgram.getEnv((function(e){}))}))},["00","01","02","03","04","05","06","07","08","09"]);t.getCurrentTime=function(){var e=new Date;return[e.getFullYear()+"/",(s[e.getMonth()+1]||e.getMonth()+1)+"/",(s[e.getDate()]||e.getDate())+" ",(s[e.getHours()]||e.getHours())+":",(s[e.getMinutes()]||e.getMinutes())+":",s[e.getSeconds()]||e.getSeconds(),"."+e.getTime()%1e3].join("")}}],i={},o.m=s,o.c=i,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)o.d(r,s,function(t){return e[t]}.bind(null,s));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3))},function(e,t,r){e.exports=function(e){for(var t=e,r=t.lib.BlockCipher,o=t.algo,s=[],i=[],n=[],a=[],l=[],u=[],c=[],h=[],g=[],d=[],_=[],p=0;p<256;p++)_[p]=p<128?p<<1:p<<1^283;var E=0,m=0;for(p=0;p<256;p++){var T=m^m<<1^m<<2^m<<3^m<<4;s[E]=T=T>>>8^255&T^99,i[T]=E;var R=_[E],f=_[R],S=_[f],C=257*_[T]^16843008*T;n[E]=C<<24|C>>>8,a[E]=C<<16|C>>>16,l[E]=C<<8|C>>>24,u[E]=C,c[T]=(C=16843009*S^65537*f^257*R^16843008*E)<<24|C>>>8,h[T]=C<<16|C>>>16,g[T]=C<<8|C>>>24,d[T]=C,E?(E=R^_[_[_[S^R]]],m^=_[_[m]]):E=m=1}var I=[0,1,2,4,8,16,32,64,128,27,54],L=o.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,o=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],n=0;n<o;n++)n<r?i[n]=t[n]:(u=i[n-1],n%r?r>6&&n%r==4&&(u=s[u>>>24]<<24|s[u>>>16&255]<<16|s[u>>>8&255]<<8|s[255&u]):(u=s[(u=u<<8|u>>>24)>>>24]<<24|s[u>>>16&255]<<16|s[u>>>8&255]<<8|s[255&u],u^=I[n/r|0]<<24),i[n]=i[n-r]^u);for(var a=this._invKeySchedule=[],l=0;l<o;l++){if(n=o-l,l%4)var u=i[n];else u=i[n-4];a[l]=l<4||n<=4?u:c[s[u>>>24]]^h[s[u>>>16&255]]^g[s[u>>>8&255]]^d[s[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,n,a,l,u,s)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,c,h,g,d,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,o,s,i,n,a){for(var l=this._nRounds,u=e[t]^r[0],c=e[t+1]^r[1],h=e[t+2]^r[2],g=e[t+3]^r[3],d=4,_=1;_<l;_++){var p=o[u>>>24]^s[c>>>16&255]^i[h>>>8&255]^n[255&g]^r[d++],E=o[c>>>24]^s[h>>>16&255]^i[g>>>8&255]^n[255&u]^r[d++],m=o[h>>>24]^s[g>>>16&255]^i[u>>>8&255]^n[255&c]^r[d++],T=o[g>>>24]^s[u>>>16&255]^i[c>>>8&255]^n[255&h]^r[d++];u=p,c=E,h=m,g=T}p=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[h>>>8&255]<<8|a[255&g])^r[d++],E=(a[c>>>24]<<24|a[h>>>16&255]<<16|a[g>>>8&255]<<8|a[255&u])^r[d++],m=(a[h>>>24]<<24|a[g>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^r[d++],T=(a[g>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&h])^r[d++],e[t]=p,e[t+1]=E,e[t+2]=m,e[t+3]=T},keySize:8});return t.AES=r._createHelper(L),e.AES}(r(0),(r(8),r(9),r(4),r(12)))},,function(e,t,r){var o,s,i,n,a;e.exports=(e=r(0),r(10),r(11),o=(i=(r=e).lib).Base,s=i.WordArray,n=(i=r.algo).MD5,a=i.EvpKDF=o.extend({cfg:o.extend({keySize:4,hasher:n,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,o=this.cfg,i=o.hasher.create(),n=s.create(),a=n.words,l=o.keySize,u=o.iterations;a.length<l;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var c=1;c<u;c++)r=i.finalize(r),i.reset();n.concat(r)}return n.sigBytes=4*l,n}}),r.EvpKDF=function(e,t,r){return a.create(r).compute(e,t)},e.EvpKDF)},function(e,t,r){e.exports=r(0).enc.Utf8},function(e,t){var r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){},function(e,t,r){var o;e.exports=(e=r(0),o=e.lib.WordArray,e.enc.Base64={stringify:function(e){for(var t=e.words,r=e.sigBytes,o=this._map,s=(e.clamp(),[]),i=0;i<r;i+=3)for(var n=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<r;a++)s.push(o.charAt(n>>>6*(3-a)&63));var l=o.charAt(64);if(l)for(;s.length%4;)s.push(l);return s.join("")},parse:function(e){var t=e.length,r=this._map;if(!(s=this._reverseMap))for(var s=this._reverseMap=[],i=0;i<r.length;i++)s[r.charCodeAt(i)]=i;var n=r.charAt(64);return n&&-1!==(n=e.indexOf(n))&&(t=n),function(e,t,r){for(var s,i,n=[],a=0,l=0;l<t;l++)l%4&&(s=r[e.charCodeAt(l-1)]<<l%4*2,i=r[e.charCodeAt(l)]>>>6-l%4*2,n[a>>>2]|=(s|i)<<24-a%4*8,a++);return o.create(n,a)}(e,t,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},e.enc.Base64)},function(e,t,r){e.exports=function(e){for(var t=Math,r=e,o=r.lib,s=o.WordArray,i=o.Hasher,n=r.algo,a=[],l=0;l<64;l++)a[l]=4294967296*t.abs(t.sin(l+1))|0;var u=n.MD5=i.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var o=t+r,s=e[o];e[o]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}var i=this._hash.words,n=e[t+0],l=e[t+1],u=e[t+2],_=e[t+3],p=e[t+4],E=e[t+5],m=e[t+6],T=e[t+7],R=e[t+8],f=e[t+9],S=e[t+10],C=e[t+11],I=e[t+12],L=e[t+13],y=e[t+14],v=e[t+15],M=i[0],N=i[1],O=i[2],A=i[3];M=c(M,N,O,A,n,7,a[0]),A=c(A,M,N,O,l,12,a[1]),O=c(O,A,M,N,u,17,a[2]),N=c(N,O,A,M,_,22,a[3]),M=c(M,N,O,A,p,7,a[4]),A=c(A,M,N,O,E,12,a[5]),O=c(O,A,M,N,m,17,a[6]),N=c(N,O,A,M,T,22,a[7]),M=c(M,N,O,A,R,7,a[8]),A=c(A,M,N,O,f,12,a[9]),O=c(O,A,M,N,S,17,a[10]),N=c(N,O,A,M,C,22,a[11]),M=c(M,N,O,A,I,7,a[12]),A=c(A,M,N,O,L,12,a[13]),O=c(O,A,M,N,y,17,a[14]),M=h(M,N=c(N,O,A,M,v,22,a[15]),O,A,l,5,a[16]),A=h(A,M,N,O,m,9,a[17]),O=h(O,A,M,N,C,14,a[18]),N=h(N,O,A,M,n,20,a[19]),M=h(M,N,O,A,E,5,a[20]),A=h(A,M,N,O,S,9,a[21]),O=h(O,A,M,N,v,14,a[22]),N=h(N,O,A,M,p,20,a[23]),M=h(M,N,O,A,f,5,a[24]),A=h(A,M,N,O,y,9,a[25]),O=h(O,A,M,N,_,14,a[26]),N=h(N,O,A,M,R,20,a[27]),M=h(M,N,O,A,L,5,a[28]),A=h(A,M,N,O,u,9,a[29]),O=h(O,A,M,N,T,14,a[30]),M=g(M,N=h(N,O,A,M,I,20,a[31]),O,A,E,4,a[32]),A=g(A,M,N,O,R,11,a[33]),O=g(O,A,M,N,C,16,a[34]),N=g(N,O,A,M,y,23,a[35]),M=g(M,N,O,A,l,4,a[36]),A=g(A,M,N,O,p,11,a[37]),O=g(O,A,M,N,T,16,a[38]),N=g(N,O,A,M,S,23,a[39]),M=g(M,N,O,A,L,4,a[40]),A=g(A,M,N,O,n,11,a[41]),O=g(O,A,M,N,_,16,a[42]),N=g(N,O,A,M,m,23,a[43]),M=g(M,N,O,A,f,4,a[44]),A=g(A,M,N,O,I,11,a[45]),O=g(O,A,M,N,v,16,a[46]),M=d(M,N=g(N,O,A,M,u,23,a[47]),O,A,n,6,a[48]),A=d(A,M,N,O,T,10,a[49]),O=d(O,A,M,N,y,15,a[50]),N=d(N,O,A,M,E,21,a[51]),M=d(M,N,O,A,I,6,a[52]),A=d(A,M,N,O,_,10,a[53]),O=d(O,A,M,N,S,15,a[54]),N=d(N,O,A,M,l,21,a[55]),M=d(M,N,O,A,R,6,a[56]),A=d(A,M,N,O,v,10,a[57]),O=d(O,A,M,N,m,15,a[58]),N=d(N,O,A,M,L,21,a[59]),M=d(M,N,O,A,p,6,a[60]),A=d(A,M,N,O,C,10,a[61]),O=d(O,A,M,N,u,15,a[62]),N=d(N,O,A,M,f,21,a[63]),i[0]=i[0]+M|0,i[1]=i[1]+N|0,i[2]=i[2]+O|0,i[3]=i[3]+A|0},_doFinalize:function(){var e=this._data,r=e.words,o=8*this._nDataBytes,s=8*e.sigBytes;r[s>>>5]|=128<<24-s%32;var i=t.floor(o/4294967296),n=o;r[15+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(s+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,l=a.words,u=0;u<4;u++){var c=l[u];l[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return a},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,r,o,s,i,n){var a=e+(t&r|~t&o)+s+n;return(a<<i|a>>>32-i)+t}function h(e,t,r,o,s,i,n){var a=e+(t&o|r&~o)+s+n;return(a<<i|a>>>32-i)+t}function g(e,t,r,o,s,i,n){var a=e+(t^r^o)+s+n;return(a<<i|a>>>32-i)+t}function d(e,t,r,o,s,i,n){var a=e+(r^(t|~o))+s+n;return(a<<i|a>>>32-i)+t}return r.MD5=i._createHelper(u),r.HmacMD5=i._createHmacHelper(u),e.MD5}(r(0))},function(e,t,r){var o,s,i,n;e.exports=(e=r(0),n=(r=e).lib,o=n.WordArray,s=n.Hasher,i=[],n=(n=r.algo).SHA1=s.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,o=r[0],s=r[1],n=r[2],a=r[3],l=r[4],u=0;u<80;u++){i[u]=u<16?0|e[t+u]:(c=i[u-3]^i[u-8]^i[u-14]^i[u-16])<<1|c>>>31;var c=(o<<5|o>>>27)+l+i[u];c+=u<20?1518500249+(s&n|~s&a):u<40?1859775393+(s^n^a):u<60?(s&n|s&a|n&a)-1894007588:(s^n^a)-899497514,l=a,a=n,n=s<<30|s>>>2,s=o,o=c}r[0]=r[0]+o|0,r[1]=r[1]+s|0,r[2]=r[2]+n|0,r[3]=r[3]+a|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(64+o>>>9<<4)]=Math.floor(r/4294967296),t[15+(64+o>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=s._createHelper(n),r.HmacSHA1=s._createHmacHelper(n),e.SHA1)},function(e,t,r){var o;e.exports=(e=r(0),o=e.enc.Utf8,void(e.algo.HMAC=(r=e.lib.Base).extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));for(var r=e.blockSize,s=4*r,i=((t=t.sigBytes>s?e.finalize(t):t).clamp(),e=this._oKey=t.clone(),t=this._iKey=t.clone(),e.words),n=t.words,a=0;a<r;a++)i[a]^=1549556828,n[a]^=909522486;e.sigBytes=t.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})))},function(e,t,r){var o,s,i,n,a,l,u,c,h,g,d,_;e.exports=(e=r(0),r(4),void(e.lib.Cipher||(r=e.lib,o=r.Base,s=r.WordArray,i=r.BufferedBlockAlgorithm,h=e.enc,n=h.Base64,a=e.algo.EvpKDF,l=r.Cipher=i.extend({cfg:o.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?_:g}return function(t){return{encrypt:function(r,o,s){return e(o).encrypt(t,r,o,s)},decrypt:function(r,o,s){return e(o).decrypt(t,r,o,s)}}}}()}),r.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=e.mode={},u=r.BlockCipherMode=o.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),h=h.CBC=function(){var e=u.extend();function t(e,t,r){var o,s=this._iv;s?(o=s,this._iv=void 0):o=this._prevBlock;for(var i=0;i<r;i++)e[t+i]^=o[i]}return e.Encryptor=e.extend({processBlock:function(e,r){var o=this._cipher,s=o.blockSize;t.call(this,e,r,s),o.encryptBlock(e,r),this._prevBlock=e.slice(r,r+s)}}),e.Decryptor=e.extend({processBlock:function(e,r){var o=this._cipher,s=o.blockSize,i=e.slice(r,r+s);o.decryptBlock(e,r),t.call(this,e,r,s),this._prevBlock=i}}),e}(),d=(e.pad={}).Pkcs7={pad:function(e,t){for(var r=(t*=4)-e.sigBytes%t,o=r<<24|r<<16|r<<8|r,i=[],n=0;n<r;n+=4)i.push(o);t=s.create(i,r),e.concat(t)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},r.BlockCipher=l.extend({cfg:l.cfg.extend({mode:h,padding:d}),reset:function(){l.reset.call(this);var e,t=(r=this.cfg).iv,r=r.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,t&&t.words):(this._mode=e.call(r,this,t&&t.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),c=r.CipherParams=o.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),h=(e.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return(e=(e=e.salt)?s.create([1398893684,1701076831]).concat(e).concat(t):t).toString(n)},parse:function(e){var t,r=(e=n.parse(e)).words;return 1398893684==r[0]&&1701076831==r[1]&&(t=s.create(r.slice(2,4)),r.splice(0,4),e.sigBytes-=16),c.create({ciphertext:e,salt:t})}},g=r.SerializableCipher=o.extend({cfg:o.extend({format:h}),encrypt:function(e,t,r,o){o=this.cfg.extend(o),t=(s=e.createEncryptor(r,o)).finalize(t);var s=s.cfg;return c.create({ciphertext:t,key:r,iv:s.iv,algorithm:e,mode:s.mode,padding:s.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,r,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(r,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),d=(e.kdf={}).OpenSSL={execute:function(e,t,r,o){return o=o||s.random(8),e=a.create({keySize:t+r}).compute(e,o),r=s.create(e.words.slice(t),4*r),e.sigBytes=4*t,c.create({key:e,iv:r,salt:o})}},_=r.PasswordBasedCipher=g.extend({cfg:g.cfg.extend({kdf:d}),encrypt:function(e,t,r,o){return r=(o=this.cfg.extend(o)).kdf.execute(r,e.keySize,e.ivSize),o.iv=r.iv,(e=g.encrypt.call(this,e,t,r.key,o)).mixIn(r),e},decrypt:function(e,t,r,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),r=o.kdf.execute(r,e.keySize,e.ivSize,t.salt),o.iv=r.iv,g.decrypt.call(this,e,t,r.key,o)}}))))},function(e,t,r){"use strict";r.r(t),r.d(t,"ZegoExpressWebRTMEngine",(function(){return ve})),r.d(t,"getReportSeq",(function(){return p})),r.d(t,"getSeq",(function(){return _})),r.d(t,"ZegoLogger",(function(){return a.ZegoLogger})),r.d(t,"ZegoDataReport",(function(){return a.ZegoDataReport})),r.d(t,"ZegoExpressWebRTM",(function(){return Ce})),r.d(t,"BusinessService",(function(){return C})),r.d(t,"NetConnection",(function(){return y}));var o,s,i,n,a=r(1),l={debug:0,info:1,warn:2,error:3,report:99,disable:100};(t=o=o||{})[t.logout=0]="logout",t[t.trylogin=1]="trylogin",t[t.login=2]="login",(t=s=s||{})[t.offline=0]="offline",t[t.online=1]="online",(t=i=i||{})[t.NT_NONE=0]="NT_NONE",t[t.NT_LINE=1]="NT_LINE",t[t.NT_WIFI=2]="NT_WIFI",t[t.NT_2G=3]="NT_2G",t[t.NT_3G=4]="NT_3G",t[t.NT_4G=5]="NT_4G",t[t.NT_UNKNOWN=32]="NT_UNKNOWN",(t=n=n||{})[t.ClientType_None=0]="ClientType_None",t[t.ClientType_H5=1]="ClientType_H5",t[t.ClientType_SmallProgram=2]="ClientType_SmallProgram",t[t.ClientType_Webrtc=3]="ClientType_Webrtc";var u,c,h="eventStart",g="eventEndWithMsgInfo",d="addEventMsg",_=function(){return u++},p=(c=u=1,function(){return c++}),E=(Object.defineProperty(m.prototype,"id",{get:function(){return this._id||null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),m.prototype.hasNext=function(){return this.next&&this.next.id},m.prototype.hasPrev=function(){return this.prev&&this.prev.id},m);function m(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this.next=null,this.prev=null,this._id=e,this._data=t}R.prototype.insertBefore=function(e,t){return(t=new E(this._idCounter,t)).next=e,t.prev=e.prev,e.prev&&(e.prev.next=t),e.prev=t,++this._idCounter,++this._numNodes,t},R.prototype.addLast=function(e){return this.insertBefore(this.end,e)},R.prototype.add=function(e){return this.addLast(e)},R.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},R.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},R.prototype.size=function(){return this._numNodes},R.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(0<=e)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},R.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},R.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},R.prototype.removeFirst=function(){var e=null;return 0<this._numNodes&&this.start.next?this.remove(this.start.next):e},R.prototype.removeLast=function(){var e=null;return 0<this._numNodes&&this.end.prev?this.remove(this.end.prev):e},R.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},R.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},R.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},R.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},R.prototype.push=function(e){return this.addLast(e)},R.prototype.unshift=function(e){this.insertBefore(0<this._numNodes?this.start.next:this.end,e)},R.prototype.pop=function(){return this.removeLast()},R.prototype.shift=function(){return this.removeFirst()};var T=R;function R(){this.start=new E,this.end=new E,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}var f,S,C,I,L="",y=(v.prototype.init=function(){},v.prototype.unInit=function(){},v.prototype.setAppInfo=function(e){},v.prototype.setUserInfo=function(e){},v.prototype.setNetAgentDefaultServers=function(e){},v.prototype.setDispatchConnectServers=function(e){},v.prototype.startHttpRequest=function(e,t,r,o,s){},v.prototype.getAppConfigByAgent=function(e,t,r){return Promise.resolve()},v.prototype.getPCRequest=function(e,t){return null},v.prototype.connectUa=function(){},v.prototype.destroyConnect=function(){},v.prototype.isConnect=function(){return!1},v.prototype.on=function(e,t){return!1},v.prototype.off=function(e,t){},v.prototype.setLogger=function(e){},v.prototype.setAccess=function(e){},v);function v(){this.isLoad=!1,this.callBackList=[],this.connection=null}(t=f=f||{})[t.EMPTY=0]="EMPTY",t[t.CLOSE=1]="CLOSE",(t=S=S||{})[t.Mode_UNSET=0]="Mode_UNSET",t[t.MODE_ONLINE=1]="MODE_ONLINE",t[t.MODE_TEST=2]="MODE_TEST",t[t.MODE_ALPHA=3]="MODE_ALPHA",(t=C=C||{})[t.SERVICE_UNSET=0]="SERVICE_UNSET",t[t.SERVICE_MEDIAGW=1]="SERVICE_MEDIAGW",t[t.SERVICE_LIVEROOM=2]="SERVICE_LIVEROOM",t[t.SERVICE_MIX=3]="SERVICE_MIX",t[t.SERVICE_ZEUS=4]="SERVICE_ZEUS",t[t.SERVICE_ZPUSH=5]="SERVICE_ZPUSH",t[t.SERVICE_L3=6]="SERVICE_L3",t[t.SERVICE_TALKLINE=7]="SERVICE_TALKLINE",t[t.SERVICE_EDUSUITE=8]="SERVICE_EDUSUITE",t[t.SERVICE_ZIM=9]="SERVICE_ZIM",t[t.SERVICE_ClOUD_SETTING=10]="SERVICE_ClOUD_SETTING",t[t.SERVICE_ZEUSHB=11]="SERVICE_ZEUSHB",t[t.SERVICE_USER_LOGIC=12]="SERVICE_USER_LOGIC",t[t.SERVICE_UNIFYDISPATCH=13]="SERVICE_UNIFYDISPATCH",t[t.SERVICE_QUALITY=14]="SERVICE_QUALITY",t[t.SERVICE_SECURITY=15]="SERVICE_SECURITY",t[t.SERVICE_KTVCPR=16]="SERVICE_KTVCPR",t[t.SERVICE_SWITCH4LIVEROOM=17]="SERVICE_SWITCH4LIVEROOM",t[t.SERVICE_WEBRTC_SIGNAL=18]="SERVICE_WEBRTC_SIGNAL",t[t.SERVICE_L3_WEBRTC_SIGNAL=19]="SERVICE_L3_WEBRTC_SIGNAL",t[t.SERVICE_VIDEOCPR=20]="SERVICE_VIDEOCPR",t[t.SERVICE_CDN=21]="SERVICE_CDN",t[t.SERVICE_CLOUDRECORD=22]="SERVICE_CLOUDRECORD",t[t.SERVICE_INNER_ECHO=23]="SERVICE_INNER_ECHO",t[t.SERVICE_OUTER_ECHO=24]="SERVICE_OUTER_ECHO",t[t.SERVICE_LOCALHOST_ECHO=25]="SERVICE_LOCALHOST_ECHO",t[t.SERVICE_ECHO=26]="SERVICE_ECHO",t[t.SERVICE_DOCSERVICE=27]="SERVICE_DOCSERVICE",t[t.SERVICE_AUTHSVR=28]="SERVICE_AUTHSVR",(t=I=I||{}).Logining="LOGINING",t.Logined="LOGINED",t.LoginFailed="LOGIN_FAILED",t.Reconnecting="RECONNECTING",t.Reconnected="RECONNECTED",t.ReconnectFailed="RECONNECT_FAILED",t.Kickout="KICKOUT",t.Logout="LOGOUT",t.LogoutFailed="LOGOUT_FAILED";var M={SERVER:{code:0,msg:"liverooom cmd error"},SUCCESS:{code:0,msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},NOT_LOGIN:{code:1000002,msg:"not login"},APPID_INVALID:{code:1001004,msg:"appid invalid"},NETWORK_BROKEN:{code:1000017,msg:"network is broken"},INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},SOCKET_CLOSE:{code:1100003,msg:"socket close"},NET_SOCKET_TIMEOUT:{code:1100004,msg:"net agent timeout"},NET_HB_TIMEOUT:{code:1100005,msg:"net hb timeout"},INIT_SDK_WRONG:{code:1101e3,msg:"init sdk wrong"},ROOM_COUNT_EXCEED:{code:1002001,msg:"login rooms exceeds the upper limit"},USER_ID_NULL:{code:1002005,msg:"user ID is empty"},USER_ID_INVALID_CHARACTER:{code:1002006,msg:"user ID contains illegal characters"},USER_ID_TOO_LONG:{code:1002007,msg:"user ID is too long"},USER_NAME_NULL:{code:1002008,msg:"username is empty"},USER_NAME_TOO_LONG:{code:1002010,msg:"username is too long"},ROOM_ID_NULL:{code:1002011,msg:"room ID is empty"},ROOM_ID_INVALID_CHARACTER:{code:1002012,msg:"room ID contains illegal characters"},ROOM_ID_TOO_LONG:{code:1002013,msg:"room ID is too long"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},LOGIN_TIMEOUT:{code:1002031,msg:"login timeout"},ROOM_MAX_USER_COUNT:{code:1002034,msg:"users logging into the room exceeds the maximum number"},MULTI_ROOM_UNABLE:{code:1002036,msg:"multi room unable"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,msg:"kickout may be the same user ID login other"},NETWORK_RECOVERY:{code:1002051,msg:"network recovery"},ROOM_RETRY_TIMEOUT:{code:1002053,msg:"network is broken and login fail."},MANUAL_KICKOUT:{code:1002055,msg:"server has sent a signal to kick out"},REPEATEDLY_LOGIN:{code:1002056,msg:"user repeatedly login"},REPEATEDLY_ENTER_ROOM:{code:1002057,msg:"user repeatedly enter room"},ALREADY_LOGIN:{code:1002058,msg:"user already logged in"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},HEARTBEAT_TIMEOUT:{code:1102001,msg:"heartbeat timeout."},PARSE_JSON_ERROR:{code:1102011,msg:"parse json error."},LOGIN_PROCESSING:{code:1102012,msg:"login is processing."},LIVEROMM_REQUEST_ERROR:{code:1102013,msg:"liveroom request error."},ZPUSH_REQUEST_FAIL:{code:1102014,msg:"zpush request fail."},LOGIN_STATE_WRONG:{code:1102015,msg:"user login state is wrong."},TOKEN_ERROR:{code:1102016,msg:"token error"},DIAPATCH_ERROR:{code:1102017,msg:"dispatch error"},TOKEN_EXPIRED:{code:1102018,msg:"token expired"},SUBCMD_ERROR:{code:1102019,msg:"subcmd error."},ZEGO_AUTH_ERROR:{code:1102020,msg:"zego auth error."},BIZ_CHANNEL_ERROR:{code:1102021,msg:"biz channel error."}},N=(O.base64encode=function(e){for(var t,r,o,s=e.length,i=0,n="";i<s;){if(t=255&e.charCodeAt(i++),i==s){n=(n+=O.base64EncodeChars.charAt(t>>2))+O.base64EncodeChars.charAt((3&t)<<4)+"==";break}if(r=e.charCodeAt(i++),i==s){n=(n=(n+=O.base64EncodeChars.charAt(t>>2))+O.base64EncodeChars.charAt((3&t)<<4|(240&r)>>4))+O.base64EncodeChars.charAt((15&r)<<2)+"=";break}o=e.charCodeAt(i++),n=(n=(n=(n+=O.base64EncodeChars.charAt(t>>2))+O.base64EncodeChars.charAt((3&t)<<4|(240&r)>>4))+O.base64EncodeChars.charAt((15&r)<<2|(192&o)>>6))+O.base64EncodeChars.charAt(63&o)}return n},O.base64decode=function(e){for(var t,r,o,s,i=e.length,n=0,a="";n<i;){for(;t=O.base64DecodeChars[255&e.charCodeAt(n++)],n<i&&-1==t;);if(-1==t)break;for(;r=O.base64DecodeChars[255&e.charCodeAt(n++)],n<i&&-1==r;);if(-1==r)break;a+=String.fromCharCode(t<<2|(48&r)>>4);do{if(61==(o=255&e.charCodeAt(n++)))return a}while(o=O.base64DecodeChars[o],n<i&&-1==o);if(-1==o)break;a+=String.fromCharCode((15&r)<<4|(60&o)>>2);do{if(61==(s=255&e.charCodeAt(n++)))return a}while(s=O.base64DecodeChars[s],n<i&&-1==s);if(-1==s)break;a+=String.fromCharCode((3&o)<<6|s)}return a},O.utf16to8=function(e){for(var t,r="",o=e.length,s=0;s<o;s++)1<=(t=e.charCodeAt(s))&&t<=127?r+=e.charAt(s):r=2047<t?(r=(r+=String.fromCharCode(224|t>>12&15))+String.fromCharCode(128|t>>6&63))+String.fromCharCode(128|t>>0&63):(r+=String.fromCharCode(192|t>>6&31))+String.fromCharCode(128|t>>0&63);return r},O.utf8to16=function(e){for(var t,r,o,s="",i=e.length,n=0;n<i;)switch((t=e.charCodeAt(n++))>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=e.charAt(n-1);break;case 12:case 13:r=e.charCodeAt(n++),s+=String.fromCharCode((31&t)<<6|63&r);break;case 14:r=e.charCodeAt(n++),o=e.charCodeAt(n++),s+=String.fromCharCode((15&t)<<12|(63&r)<<6|(63&o)<<0)}return s},O.base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",O.base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],O);function O(){}t=r(2);var A=r.n(t),P=(t=r(5),r.n(t)),b=function(){return(b=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},k=(U.checkConfigParam=function(e,t,r){return e&&"number"==typeof e&&this.checkInteger(e)?!(!t||"string"!=typeof t&&!Array.isArray(t)||""==t)||(r.error("ccp.0 server must be string or string array and not empty"),!1):(r.error("ccp.0 appid must be positive integer number and not empty"),!1)},U.checkPriConfigParam=function(e,t,r,o,s){return e&&"number"==typeof e&&this.checkInteger(e)?t&&"string"==typeof t?"object"!=typeof r||"string"!=typeof r.deviceID?(s.error("ccp.0 deviceID must be string and not empty"),!1):1===o||0===o||(s.error("ccp.0 anType must be 0 or 1"),!1):(s.error("ccp.0 dispatchServer must be string and not empty"),!1):(s.error("ccp.0 appid must be positive integer number and not empty"),!1)},U.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},U.isUrl=function(e){return!!(e.startsWith("rtmp://")||e.startsWith("https://")&&e.endsWith(".flv")||e.startsWith("https://")&&e.endsWith(".m3u8"))},U.registerCallback=function(e,t,r){t.success&&(r[e+"SuccessCallback"]=t.success),t.error&&(r[e+"ErrorCallback"]=t.error)},U.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},U.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},U.logReportCallback=function(e,t,r,o){U.registerCallback(e,{success:function(e,o){for(var s=[],i=2;i<arguments.length;i++)s[i-2]=arguments[i];U.dataReportEvent(t,r,e,o,s)}},o)},U.proxyRes=function(e,t,r,o){return{interResolve:function(o){e.uploadReport(t),r(o)},interReject:function(r,s){var i;void 0===s&&(s=""),(i=r.code<2e9&&1e9<r.code?U.decodeServerError(r.code,r.msg):{code:r.code,message:r.msg})&&e.addMsgInfo(t,{error:i.code,message:i.message+s}),e.uploadReport(t),o({errorCode:r.code||r.errorCode})}}},U.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",1010:"token expired",1011:"token format error",2002:"biz channel error",1e9:"liveroom cmd error, code:",1000002001:"need relogin",1000002002:"third token auth error",1000002003:"token nonce type should be int64",1000002004:"token appid type  should be uint32",1000002005:"token timeout type should be int64",1000002006:"token user_id type should be string",1000002007:"token room_id type should be string",1000002008:"token format error",1000002009:"token privilege type should be map",1000002010:"token expire_time type should be int64",1000002011:"token user_id type should be string",1000002012:"token not exist",1000002013:"token update error",1000002014:"token not need to check"};if(0===e)return M.SUCCESS;var r,o=b({},M.ROOM_INNER_ERROR);return o.code=e,o.msg=1e9<e?(r=t[e])?"liveroom cmd error, code: "+e+", message: "+r:t[1e9]+e:t[e]?t[e]+" code:"+e:"unknown error code:"+e,o},U.unregisterCallback=function(e,t){delete t[e+"SuccessCallback"],delete t[e+"ErrorCallback"]},U.decodeServerError=function(e,t){var r={code:-1,message:"server error"};return r.code=1e9<e?e-1e9+52e6:e+2002e6,t&&(r.message=t),r},U.getLiveRoomError=function(e,t){var r={1016:"MULTI_ROOM_UNABLE",1105:"ROOM_MAX_USER_COUNT",1012:"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM",2002:"TOKEN_ERROR",2003:"ROOM_ERROR_LOGIN_TIMEOUT",2010:"TOKEN_ERROR",5022:"ROOM_COUNT_EXCEED"};return t?2e5<e&&e<3e5?r[e-2e5]:e<2e5?{50116:"TOKEN_ERROR",50117:"TOKEN_EXPIRED",50118:"TOKEN_ERROR",50119:"TOKEN_ERROR",50120:"TOKEN_ERROR",50121:"TOKEN_ERROR",50122:"TOKEN_ERROR",50123:"TOKEN_EXPIRED",50124:"TOKEN_ERROR",50125:"TOKEN_ERROR",50126:"TOKEN_ERROR",50127:"TOKEN_ERROR",50128:"TOKEN_ERROR"}[e]||r[e]||"ROOM_INNER_ERROR":r[e]||"ROOM_INNER_ERROR":1e9<e?r[e-1e9]||"":{1:"PARSE_JSON_ERROR",1001:"LOGIN_PROCESSING",1002:"LIVEROMM_REQUEST_ERROR",1003:"ZPUSH_REQUEST_FAIL",1004:"ZPUSH_REQUEST_FAIL",1005:"ZPUSH_REQUEST_FAIL",1006:"LOGIN_STATE_WRONG",1007:"ZPUSH_REQUEST_FAIL",1008:"TOKEN_ERROR",1009:"DIAPATCH_ERROR",1010:"TOKEN_EXPIRED",1011:"TOKEN_ERROR",1012:"SUBCMD_ERROR",1101:"ZEGO_AUTH_ERROR",2001:"BIZ_CHANNEL_ERROR",2002:"BIZ_CHANNEL_ERROR"}[e]||"ROOM_INNER_ERROR"},U.getKickoutError=function(e,t){var r={code:e,message:"kickout reason = "+e};if(t)switch(e){case 1:r.code=63000001,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:r.code=63000002,r.message="zpush manual kickout",r.name="MANUAL_KICKOUT";break;case 4:r.code=63000005,r.message="zpush token expired",r.name="TOKEN_EXPIRED";break;default:r.code=e,r.message="kickout reason = "+e}else switch(e){case 1:r.code=63000001,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 2:r.code=63000002,r.message="zpush manual kickout",r.name="MANUAL_KICKOUT";break;case 3:r.code=63000003,r.message="kickout reason = "+e;break;case 4:r.code=63000004,r.message="zpush multiple login kickout",r.name="MULTIPLE_LOGIN_KICKOUT";break;case 5:r.code=63000005,r.message="zpush token expired",r.name="TOKEN_EXPIRED";break;default:r.code=e,r.message="kickout reason = "+e}return r},U.dataReportEvent=function(e,t,r,o,s){switch(r){case"eventStart":e.eventStart(t,o);break;case"eventEndWithMsgInfo":e.eventEndWithMsgInfo(t,o,s[0]);break;case"addEventMsg":e.addEventMsg(t,o,s[0],s[1]);break;case"addEvent":e.addEvent(t,o);break;case"eventEnd":e.eventEnd(t,o);break;case"addMsgInfo":e.addMsgInfo(t,s[0])}},U.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},U.mergeUserList=function(e,t,r,o){e.debug("msl.0 call");var s=[],i=[];r=r||[];for(var n=0;n<r.length;n++){for(var a=!1,l=0;l<t.length;l++)if(r[n].userID===t[l].userID){a=!0;break}a||s.push(r[n])}for(var u=0;u<t.length;u++){a=!1;for(var c=0;c<r.length;c++)if(t[u].userID===r[c].userID){a=!0;break}a||i.push(t[u])}for(t.splice(0),n=0;n<r.length;n++)t.push(t[n]);o(s,i),e.debug("msl.0 call success")},U.checkInteger=function(e,t){return 0==t?"number"==typeof e&&e%1==0&&0<=e:"number"==typeof e&&e%1==0&&0<e},U.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,"number"==typeof e&&e%1==0&&t<=e&&e<=r},U.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},U.uuid=function(e,t){var r,o,s="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||s.length,e)for(r=0;r<e;r++)i[r]=s[0|Math.random()*t];else for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(o=0|16*Math.random(),i[r]=s[19==r?3&o|8:o]);return i.join("")},U.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var o=0;o<r;o++){var s=parseInt(e[o]),i=parseInt(t[o]);if(i<s)return 1;if(s<i)return-1}return 0},U.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),o=null!=window.opr,s=e.indexOf("Chrome")&&window.chrome;return e=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version"),t?"IE":r?"Firefox":o?"Opera":s?"Chrome":e?"Safari":"Unkown"},U.isTestEnv=function(e){return-1!=e.indexOf("wss://wssliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")||-1!=e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")||-1!=e.indexOf("wss://wsliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-test-bak.zego.im/ws")||-1!=e.indexOf("wss://webliveroom-hk-test.zegocloud.com/ws")||-1!=e.indexOf("wss://webliveroom-hk-test-bak.zegocloud.com/ws")},U.getLogLevel=function(e){return l[e]},U.getUint64=function(e,t,r){var o=r.getUint32(e,t);return r=r.getUint32(e+4,t),e=t?o+Math.pow(2,32)*r:Math.pow(2,32)*o+r,Number.isSafeInteger(e)||console.warn(e,"exceeds MAX_SAFE_INTEGER. Precision may be lost"),e},U.decodeTokenExpire=function(e){try{var t,r=Uint8Array.from(N.base64decode(e),(function(e){return e.charCodeAt(0)})),o=new DataView(r.buffer);return 0<(t="function"==typeof o.getBigInt64?o.getBigUint64(0):U.getUint64(0,!1,o))?Number(t):Number(o.getBigUint64(0,!0))}catch(e){console.error("token error")}return-1},U.bin2hex=function(e){for(var t,r="",o=0,s=(e+="").length;o<s;o++)r+=(t=e.charCodeAt(o).toString(16)).length<2?"0"+t:t;return r},U.getCanvasFingerprint=function(e){var t=document.createElement("canvas"),r=((r=t.getContext("2d")).textBaseline="top",r.font="14px 'Arial'",r.fillStyle="#f60",r.fillRect(125,1,62,20),r.fillStyle="#069",r.fillText(e,2,15),r.fillStyle="rgba(102, 204, 0, 0.7)",r.fillText(e,4,17),t.toDataURL().replace("data:image/png;base64,",""));return e=atob(r),this.bin2hex(e.slice(-16,-12))},U.generateUUID=function(e){var t,r;return 0===(e=void 0===e?0:e)?r=localStorage.getItem("z_deviceID"):wx.getStorageSync("z_deviceID"),r||(t=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(36)})),0===e?(e=this.getCanvasFingerprint("hello, zego")+r.slice(8),localStorage.setItem("z_deviceID",e)):wx.setStorageSync("z_deviceID",r),r)},U.getNetType=function(){var e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return((null==e?void 0:e.effectiveType)||(null==e?void 0:e.type)||"unknwon").toUpperCase()},U.getNetTypeNum=function(){var e;return-1<(e=((null==(e=navigator.connection||navigator.mozConnection||navigator.webkitConnection)?void 0:e.effectiveType)||(null==e?void 0:e.type)||"unknwon").toUpperCase()).indexOf("4G")?i.NT_4G:-1<e.indexOf("2G")?i.NT_2G:-1<e.indexOf("3G")?i.NT_3G:-1<e.indexOf("WIFI")?i.NT_WIFI:-1<e.indexOf("LINE")?i.NT_LINE:-1<e.indexOf("NONE")?i.NT_NONE:i.NT_UNKNOWN},U.encryptStores=function(e,t){return A.a.encrypt(e,t).toString()},U.decryptStores=function(e,t){try{return A.a.decrypt(e,t).toString(P.a)}catch(e){return""}},U);function U(){}var D,H={product:"Web_SDK",URL:["https://cloud-setting-api.zego.im/cloud-setting/get","https://cloud-setting-api.zegocloud.com/cloud-setting/get"],ONLINE:!1},w="init",x="0c9e6e0f8c0a8f4e",B="z_appconfig",Z=["accesshub-wss.zego.im"],G=S.MODE_ONLINE;function z(e,t){this.logger=e,this.stateCenter=t,this.RETRY_MAX_TIME=300,this.RETRY_START_TIME_INTERVAL=4,this.RETRY_CONTINUE_COUNT=2,this.RETRY_MAX_TIME_INTERVAL=32,this.retryTimer=null,this.maxTimer=null,this.retryStartTime=0,this.retryActiveCount=1,this.isOverTime=!1}z.prototype.init=function(e,t,r,o){this.invalid(),this.stopMaxTime(),this.isOverTime=!1,"number"==typeof e&&e<3600&&(this.RETRY_MAX_TIME=e),"number"==typeof t&&(this.RETRY_START_TIME_INTERVAL=t),"number"==typeof r&&(this.RETRY_CONTINUE_COUNT=r),"number"==typeof o&&(this.RETRY_MAX_TIME_INTERVAL=o)},z.prototype.invalid=function(){this.retryTimer&&clearTimeout(this.retryTimer),this.retryTimer=null,this.retryStartTime=0,this.retryActiveCount=1},r=z,(t=D=D||{}).RTM_CONSTRUCTOR="zm.0",t.RTM_BIND_WINDOW_LISTENER="zm.wl",t.RTM_SET_LOG_CONFIG="zm.slf",t.RTM_SET_DEBUG_VERBOSE="zm.sdv",t.RTM_LOGIN_ROOM="zm.lg",t.RTM_LOGOUT_ROOM="zm.lo",t.RTM_GET_SETTING_UNIFY="zm.gsu",t.RTM_FETCH_APP_CONFIG="zm.fac",t.RTM_SET_ACCESS="zm.sa",t.RTM_CREATENETAGENT="zm.cna",t.RTM_GETSTOREAPPCONFIG="zm.gsac",t.LIVEROOMMODULES_BINDROOMHANDLER="zm.lrm.brh",t.RTM_SET_CLOUD_SETTING_URLS="zm.scsu",t.RTM_ON="zm.on",t.RTM_OFF="zm.off",t.RTM_RENEWTOKEN="zm.rntk",t.RTM_RESETTOKENTIMER="zm.rstt",t.RTM_ENABLE_MULTI_ROOM="zm.emr",t.RTM_SEND_PB="zm.spb",t.RTM_GET_HEADER="zm.gh",t.ROOM_LOGIN_ROOM="zm.rm.lg",t.ROOM_TRY_LOGIN="zm.rm.tl",t.ROOM_OPEN_HANDLER="zm.rm.op",t.ROOM_HANDLE_LOGINRSP="zm.rm.lgr",t.ROOM_CLOSEHANDLER="zm.rm.clh",t.ROOM_LOGOUT="zm.rm.lo",t.ROOM_RESET_ROOM="zm.rm.rr",t.ROOM_DISCONNECT="zm.rm.dcn",t.ROOM_KICK_OUT="zm.rm.kco",t.ROOM_STATUS_CALLBACK="zm.rm.scb",t.ROOM_RESETTOKEN_TIMER="zm.rm.rst",t.ROOM_HANDLE_Hb_LOGOUT="zm.hhl",t.HEARTBEAT_START="zm.hb.st",t.HEARTBEAT_HEARTBEAT_RSP="zm.hb.rsp",t.HEARTBEAT_RESET="zm.hb.rst",t.SERVICE_START_CHECK="zm.sc.0",t.SERVICE_STOP_CHECK="zm.sc.1",t.SERVICE_PUSH="zm.sv.ps",t.SERVICE_SEND="zm.sv.sd",t.RETRYROOMHANDLER_HANDLE_LOGIN_FINISH="zm.rrh.hlf",t.RETRYROOMHANDLER_HANDLE_ERROR="zm.rrh.he",t.USER_LOGIN_RSP="zm.us.lgr",t.USER_FETCH_USER="zm.us.ftu",t.USER_FETCH_USER_RSP="zm.us.urp",t.USER_USER_PUSH="zm.us.uph",t.USER_MERGE_SEQ="zm.us.mg",t.USER_MERGE_TIMEOUT="zm.us.mto",t.USER_MERGE="zm.us.mg",t.USER_HB_PATCH="zm.us.pt",t.STATE_ACTION="zm.st.at",t.ON_LISTENER="ON_LISTENER",t.LIVEROOMHANDLER_SENDMESSAGE="zm.lrh.sm",t.LIVEROOMHANDLER_HANDLEPUSH="zm.lrh.hp",t.LIVEROOMHANDLER_HANDLESWITCHPUSH="zm.lrh.hsp",t.LIVEROOMHANDLER_PUSHUSERUPDATE="zm.lrh.puu",t.LIVEROOMHANDLER_PUSHKICKOUT="zm.lrh.pk",t.LIVEROOMHANDLER_GETSTREAMLIST="zm.lrh.gs",t.LIVEROOMHANDLER_LOGIN="zm.lrh.lgi",t.LIVEROOMHANDLER_FETCH_USER_LIST="zm.lrh.ful",t.LIVEROOMHANDLER_LOGOUT="zm.lrh.lgo",t.LIVEROOMHANDLER_SENDSTREAMUPDATE="zm.lrh.sru",t.LIVEROOMHANDLER_RENEW_TOKEN="zm.lrh.rt",t.LIVEROOMHANDLER_SENDSIGNALCMD="zm.lrh.ssc",t.LIVEROOMHANDLER_SENDBIGROOMMESSAGE="zm.lrh.sbrm",t.LIVEROOMHANDLER_SENDCUSTOMCOMMAND="zm.lrh.scc",t.LIVEROOMHANDLER_FETCHRELIABLEMESSAGE="zm.lrh.frm",t.LIVEROOMHANDLER_SENDRELIABLEMESSAGE="zm.lrh.srm.0",t.LIVEROOMHANDLER_SENDROOMMSG="zm.lrh.srm.1",t.LIVEROOMHANDLER_HANDLEDISCONNECTED="zm.lrh.hd",t.LIVEROOMHANDLER_HANDLEBROKEN="zm.lrh.hb",t.LIVEROOMHANDLER_HANDLECONNECTED="zm.lrh.hc",t.LIVEROOMHANDLER_RESET="zm.lrh.r.0",W=function(e,t){return(W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}W(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(F,q=r),F.prototype.renewLocalToken=function(e,t){this.token=e,this.room.token=this.token;var r=(new Date).getTime(),o=void 0;t&&"number"==typeof t?o=1e3*t:["03","04"].includes(e.substring(0,2))&&(o=1e3*k.decodeTokenExpire(e.substring(2))-r),o&&this.roomHandler.resetTokenTimer(o-this.stateCenter.local_time_deviation),this.stateCenter.actionListener("_tokenRenewed",e,this.room.roomID)},F.prototype.initRoom=function(e,t,r,o,s,i,n){this.roomHandler=e,this.roomID=t,this.renewLocalToken(r),this.user=o,this.server=s,this.serverBak=i||s,this.config=n},F.prototype.active=function(e){var t,r=this;this.logger.info(D.ROOM_LOGIN_ROOM+" retry call"),this.roomHandler.setRunState(o.trylogin),this.room.isMulti&&(null==(t=this.stateCenter.roomModulesList.find((function(e){return!e.isMulti})))?void 0:t.runState)!==o.login?this.logger.info(D.ROOM_LOGIN_ROOM+" service is disconnected, multi room stop retry"):this.stateCenter.networkState==s.offline?this.logger.info(D.ROOM_LOGIN_ROOM+" network is broken, stop retry"):this.retryTimer?this.logger.info(D.ROOM_LOGIN_ROOM+" has actived, ignore"):this.isOverTime?this.logger.info(D.ROOM_LOGIN_ROOM+" retry over time, stop retry"):(1==this.retryActiveCount?this.retryActiveInterval=Math.floor(Math.random()*(1-this.RETRY_START_TIME_INTERVAL)+this.RETRY_START_TIME_INTERVAL):(t=Math.pow(2,Math.round(this.retryActiveCount/this.RETRY_CONTINUE_COUNT+1)),this.retryActiveInterval=t>this.RETRY_MAX_TIME_INTERVAL?this.RETRY_MAX_TIME_INTERVAL:t),this.retryTimer=setTimeout((function(){r.roomHandler.login(r.retryActiveCount%2==1?r.server:r.serverBak,r.roomID,r.token,r.user,r.config,(function(e){r.handleLoginFinish(e)}),(function(e,t){r.handleLoginFinish(!1,e,t)})),r.retryTimer&&clearTimeout(r.retryTimer),r.retryTimer=null,r.retryActiveCount++}),e?0:1e3*this.retryActiveInterval))},F.prototype.startMaxTime=function(){var e=this;this.maxTimer||(this.maxTimer=setTimeout((function(){e.logger.info(D.ROOM_LOGIN_ROOM+" over max time ".concat(e.RETRY_MAX_TIME,"s, stop retry")),e.isOverTime=!0,e.roomHandler.resetRoom(),e.stopMaxTime(),e.invalid(),e.onactive(!1,M.LOGIN_TIMEOUT),e.loginRoomCallback.fail&&(e.loginRoomCallback.fail(M.LOGIN_TIMEOUT),e.roomHandler.disconnectedHandle(M.LOGIN_TIMEOUT),e.resetCallBack())}),1e3*this.RETRY_MAX_TIME))},F.prototype.stopMaxTime=function(){this.maxTimer&&clearTimeout(this.maxTimer),this.maxTimer=null},F.prototype.onactive=function(e,t){},F.prototype.handleError=function(e,t){if(this.RETRY_MAX_TIME<3)return!1;if(t){t=void 0;var r=void 0,s=void 0,i=(this.stateCenter.useNetAgent?(t=["202002","205030","205035","50116","50117","50118","50119","50120","50121","50122","50123","50124","50125","50126","50127","50128"],r=["40001","40100"],s=["201002","30019"]):(t=["1000002002","1000005030","1000005035","1010","1011","1013","1014","1015","1016","1017","1018","1019","1020","1021","1023"],r=["1100040001","1100040100"]),e.code+"");if(this.stateCenter.useNetAgent){if(10015===e.code)return this.room.retryConnect(),!0;if(40001<=e.code&&e.code<=40100||50200<=e.code&&e.code<=50299||null!=s&&s.includes(i))return this.room.resetSessionInfo(),!0}return!t.includes(i)&&(!!r.includes(i)||this.room.lastRunState==o.login&&(this.logger.warn(D.RETRYROOMHANDLER_HANDLE_ERROR+" reset"),this.room.sessionID="0",this.invalid(),!0))}return!0},F.prototype.setLoginRoomCallback=function(e,t){this.loginRoomCallback.success=e,this.loginRoomCallback.fail=t},F.prototype.loginFail=function(e){this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(!1,e),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(e),this.roomHandler.disconnectedHandle(e),this.resetCallBack())},F.prototype.handleLoginFinish=function(e,t,r){this.logger.info(D.RETRYROOMHANDLER_HANDLE_LOGIN_FINISH+" "+e+" "+JSON.stringify(t)),t?this.handleError(t,r)?(this.maxTimer||this.startMaxTime(),this.active()):(this.roomHandler.resetRoom(),this.stopMaxTime(),this.invalid(),this.onactive(e,t),this.loginRoomCallback.fail&&(this.loginRoomCallback.fail(t),this.roomHandler.disconnectedHandle(t),this.resetCallBack())):(this.stopMaxTime(),this.invalid(),this.onactive(e,{code:0,msg:""}),this.loginRoomCallback.success&&(this.loginRoomCallback.success(e),this.resetCallBack()))},F.prototype.resetCallBack=function(){this.loginRoomCallback.success=void 0,this.loginRoomCallback.fail=void 0};var W,q,Y,V=F;function F(e,t,r){var o=q.call(this,e,t)||this;return o.logger=e,o.stateCenter=t,o.room=r,o.loginRoomCallback={},o}(t=Y=Y||{}).NOT_EMPTY="NOT_EMPTY",t.ILLEGAL_CHARACTERS="ILLEGAL_CHARACTERS",t.TYPE_STRING="TYPE_STRING",t.TYPE_INTEGER="TYPE_INTEGER",t.TYPE_OBJECT="TYPE_OBJECT",t.MAX_LENGTH_10="MAX_LENGTH_10",t.MAX_LENGTH_64="MAX_LENGTH_64",t.MAX_LENGTH_100="MAX_LENGTH_100",t.MAX_LENGTH_128="MAX_LENGTH_128",t.MAX_LENGTH_256="MAX_LENGTH_256",t.MAX_LENGTH_1024="MAX_LENGTH_1024";var K={error:{code:0,msg:"suc"}},X={NOT_EMPTY:function(e,t,r,o,s){return void 0===t||""===t||null===t?(o.error("".concat(r," ").concat(e," is empty")),s):K},ILLEGAL_CHARACTERS:function(e,t,r,o,s){return k.checkIllegalCharacters(t)?K:(o.error("".concat(r," ").concat(e," contains illegal characters")),s)},TYPE_STRING:function(e,t,r,o,s){return"string"!=typeof t?(o.error("".concat(r," ").concat(e," must be string")),s):K},TYPE_INTEGER:function(e,t,r,o,s){return k.checkInteger(t,!1)?K:(o.error("".concat(r," ").concat(e,"  must be integer number")),s)},TYPE_OBJECT:function(e,t,r,o,s){return t&&"object"==typeof t?K:(o.error("".concat(r," ").concat(e,"  must be object")),s)},MAX_LENGTH_10:function(e,t,r,o,s){return 10<t.length?(o.error("".concat(r," ").concat(e," is too long")),s):K},MAX_LENGTH_64:function(e,t,r,o,s){return 64<t.length?(o.error("".concat(r," ").concat(e," is too long")),s):K},MAX_LENGTH_100:function(e,t,r,o,s){return 100<t.length?(o.error("".concat(r," ").concat(e," is too long")),s):K},MAX_LENGTH_128:function(e,t,r,o,s){return 128<t.length?(o.error("".concat(r," ").concat(e," is too long")),s):K},MAX_LENGTH_256:function(e,t,r,o,s){return 256<t.length?(o.error("".concat(r," ").concat(e," is too long")),s):K},MAX_LENGTH_1024:function(e,t,r,o,s){return 1024<t.length?(o.error("".concat(r," ").concat(e," is too long")),s):K}};function j(e){return e}function Q(e){return e}var J={kZegoTaskInitSetting:{event:"/sdk/init",error:{kInvalidParamError:M.INPUT_PARAM},system_info:navigator?navigator.appVersion:""},kZegoTaskSetDebug:{event:"/sdk/set_debug",debug:j},kZegoTaskSetLog:{event:"/sdk/set_log_config",error:{kInvalidParamError:M.INPUT_PARAM},log_level:function(e){return e},remote_log_level:j,log_url:j},kZegoTaskLoginRoom:{event:"/sdk/login",user_update:j,max_member_count:j,message:j,token:j,use_na:j,error:{ROOM_ID_NULL:M.ROOM_ID_NULL,INPUT_PARAM:M.INPUT_PARAM,ROOM_ID_TOO_LONG:M.ROOM_ID_TOO_LONG,ROOM_ID_INVALID_CHARACTER:M.ROOM_ID_INVALID_CHARACTER,USER_ID_NULL:M.USER_ID_NULL,USER_ID_TOO_LONG:M.USER_ID_TOO_LONG,USER_ID_INVALID_CHARACTER:M.USER_ID_INVALID_CHARACTER,USER_NAME_NULL:M.USER_NAME_NULL,USER_NAME_TOO_LONG:M.USER_NAME_TOO_LONG,REPEATEDLY_LOGIN:M.REPEATEDLY_LOGIN,LOGIN_TIMEOUT:M.LOGIN_TIMEOUT,INNER_ERROR:M.ROOM_INNER_ERROR,NETWORK_BROKEN:M.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:j,try_cnt:j},liveroom_login:{event:"liveroom_login",server:j,respond_info:j}}},kZegoTaskReNewToken:{event:"/sdk/reNewToken",error:{INPUT_PARAM:M.INPUT_PARAM,NOT_LOGIN:M.NOT_LOGIN}},kZegoTaskLogoutRoom:{event:"/sdk/logout",error:{INPUT_PARAM:M.INPUT_PARAM,ROOM_NOT_EXIST:M.ROOM_NOT_EXIST}},kZegoTaskReLoginRoom:{event:"/sdk/relogin",error:{ROOM_ID_NULL:M.ROOM_ID_NULL,ROOM_DISCONNECT:M.NETWORK_BROKEN},subEvent:{create_socket:{event:"create_socket",server:j,try_cnt:j},liveroom_login:{event:"liveroom_login",server:j,respond_info:j}}},kZegoTaskKickout:{event:"/sdk/kickout",user_id:j,error:{}},kZegoTaskRoomKickout:{event:"/sdk/room_kickout",user_id:j,room_id:j,message:j},kZegoTaskLiveRoomHB:{event:"/liveroom/hb",room_sid:j,error:{NOT_LOGIN:M.NOT_LOGIN,HB_TIMEOUT:M.TIMEOUT}},kZegoTaskLiveRoomGetUserUpdateInfo:{event:"/liveroom/get_user_update_info",user_update_type:j},kZegoListener:{event:"/sdk/listener"},kZegoEnableMultiRoom:{event:"sdk/enable_multi_room",error:{kInvalidParamError:M.INPUT_PARAM,kAlreadyLoginError:M.ALREADY_LOGIN}},kZegoTaskCloudSettingCache:{event:"/cloud_setting/cache"},kZegoTaskCloudSettingRefresh:{event:"/cloud_setting/refresh"},kZegoTaskCloudSettingRequest:{event:"/cloud_setting/request"},kZegoConnConnect:{event:"/zegoconn/connect",request_count:Q,svr_env:j,server_list:j},kZegoConnDisConnect:{event:"/zegoconn/disconnect",server:j},kZegoConnDispatch:{event:"/zegoconn/auto_dispatch",trigger_reason:j,domain_list:function(e){return e}},kZegoRequest:{event:"/zegoconn/request",na_req_location:j},kZegoSDKConfigInit:{event:"/sdk_config/init",trigger_reason:j},kZegoSDKProxyConnect:{event:"/zegoconn/proxy_connect",proxy_link_sources:Q,recv_time:Q}},$=(Object.defineProperty(ee.prototype,"debug",{get:function(){return this._debug},set:function(e){this._debug=e,a.LoggerStateCenter.getInstance().debug=e},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"testEnvironment",{get:function(){return this._testEnvironment},set:function(e){this._testEnvironment=e,a.LoggerStateCenter.getInstance().testEnvironment=e},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"ENV",{get:function(){return this._env},set:function(e){this._env=e,a.LoggerStateCenter.getInstance().ENV=e},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"roomid",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].roomID:""},enumerable:!1,configurable:!0}),Object.defineProperty(ee.prototype,"serverTimeOffset",{get:function(){return this.roomModulesList[0]?this.roomModulesList[0].messageHandler.serverTimeOffset:0},enumerable:!1,configurable:!0}),ee.prototype.getRequestId=function(){return this.idName+"-"+_()},ee.prototype.actionListener=function(e){for(var t,r=this,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];this.listenerList[e]&&(t=p(),this.dataReport.newReport(t,J.kZegoListener.event),this.dataReport.addMsgInfo(t,{listener:e,params:o}),this.dataReport.uploadReport(t)),this.listenerList[e]&&this.listenerList[e].forEach((function(t){try{t.apply(void 0,o)}catch(t){r.logger.error(D.STATE_ACTION+" ",e," ",JSON.stringify(t))}}))},ee.prototype.onListener=function(e,t){return this.listenerList[e]?"function"!=typeof t?(this.logger.error(D.ON_LISTENER+" listener callBack must be funciton"),!1):(-1==this.listenerList[e].indexOf(t)&&this.listenerList[e].push(t),!0):(this.logger.error(D.ON_LISTENER+" event "+e+" no found"),!1)},Object.defineProperty(ee.prototype,"sdKVersion",{get:function(){return this._sdkVersion},set:function(e){this._sdkVersion=e},enumerable:!1,configurable:!0}),ee);function ee(e,t){this.logger=e,this.dataReport=t,this._debug=!1,this.appConfigFetched=!1,this.requestList={},this.mode=S.MODE_ONLINE,this.connectState="connected",this._testEnvironment=!1,this._env=0,this.type="PUBLIC",this.debugCustom=!1,this.configOK=!1,this.role=2,this.relateService=[],this.maxMemberCount=0,this.roomCreateFlag=1,this.local_time_deviation=0,this.callbackList={},this.listenerList={roomUserUpdate:[],roomOnlineUserCountUpdate:[],getAnchorInfo:[],_getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],roomExtraInfoUpdate:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomLoginResponse:[],_roomLogin:[],_appConfigRsp:[],_connectChanged:[],HBResponse:[],roomStateUpdate:[],_roomStateUpdate:[],_getTotalUserList:[],_userStateUpdate:[],_recvBigRoomMessage:[],_recvRoomMsg:[],_kickout:[],tokenWillExpire:[],_tokenExpired:[],roomStateChanged:[],hallStateUpdate:[],_hallStateUpdate:[],roomTokenWillExpire:[],_tokenRenewed:[],_protobufResponse:[],_cloudSettingNotify:[],_settingCanFetch:[]},this.reportList={},this.reportSeqList={login:0,relogin:0},this.networkState=s.offline,this.roomRetryTime=300,this.roomModulesList=[],this.isMultiRoom=!1,this.setMultiRoom=!1,this.protoFormat="json",this.settingFetched=!1,this.useNetAgent=!0,this.netHasSet=!1,this.configRoomAuth=!1,this.configCheckToken=!1,this._sdkVersion="unknown"}re.prototype.init=function(e){var t=this,r=e.body.hearbeat_interval<3e3?3e3:e.body.hearbeat_interval;this.tryHeartbeatCount=0,this.heartbeatTimer&&clearTimeout(this.heartbeatTimer),this.loginHeartbeatTimer=setTimeout((function(){t.start(r)}),r),this.initCount++},re.prototype.start=function(e){var t=this,r=(this.logger.info(D.HEARTBEAT_START+" call"),p());if(this.dataReport.newReport(r,J.kZegoTaskLiveRoomHB.event),this.dataReport.addMsgInfo(r,{room_sid:J.kZegoTaskLiveRoomHB.room_sid(this.room.sessionID)}),!this.room.isLogin())return this.logger.error(D.HEARTBEAT_START+" state error"),this.dataReport.addMsgInfo(r,{error:J.kZegoTaskLiveRoomHB.error.NOT_LOGIN.code,message:J.kZegoTaskLiveRoomHB.error.NOT_LOGIN.msg}),void this.dataReport.uploadReport(r);if(3<++this.tryHeartbeatCount)return this.logger.error(D.HEARTBEAT_START+" come to try limit"),this.dataReport.addMsgInfo(r,{error:J.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.code,message:J.kZegoTaskLiveRoomHB.error.HB_TIMEOUT.msg}),this.dataReport.uploadReport(r),void this.hbLogout(M.HEARTBEAT_TIMEOUT);function o(e,o){var s=e.body&&e.body.err_code;e.header&&e.body?0!==s&&(s=k.decodeServerError(e.body.err_code||e.body.code,e.body.err_message||e.body.message),t.dataReport.addMsgInfo(r,{error:s.code,message:s.message+e.body.err_code})):t.dataReport.addMsgInfo(r,{error:(0<e.code?e:M.ROOM_INNER_ERROR).code,message:e.msg||M.ROOM_INNER_ERROR}),t.dataReport.uploadReport(r),t.handleHeartbeatRsp(e,o)}(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).heartBeat(o,o,this.room),this.heartbeatInterval=e,e=this.heartbeatInterval,2<=this.initCount?(e=Math.round(Math.random()*(this.heartbeatInterval+1)),this.initCount=1):e=this.heartbeatInterval,this.heartbeatTimer=setTimeout((function(){t.start(t.heartbeatInterval)}),e),this.logger.info(D.HEARTBEAT_START+" call success")},re.prototype.handleHeartbeatRsp=function(e,t){return e.body&&e.body.err_code&&0!==e.body.err_code?(this.logger.error(D.HEARTBEAT_HEARTBEAT_RSP+" disconnect, server error=",e.body.err_code),1000000152==e.body.err_code?void this.hbLogout(M.HEARTBEAT_TIMEOUT):void this.hbLogout(k.getServerError(e.body.err_code))):e.header&&e.body?((this.tryHeartbeatCount=0)!==e.body.hearbeat_interval&&(this.heartbeatInterval=e.body.hearbeat_interval,this.heartbeatInterval<3e3&&(this.heartbeatInterval=3e3)),this.heartbeatRspNotiFy(e),void this.logger.info(D.HEARTBEAT_HEARTBEAT_RSP+" call success")):(this.logger.error(D.HEARTBEAT_HEARTBEAT_RSP+" disconnect, error=",JSON.stringify(e)+", seq = "+t),void this.hbLogout(e))},re.prototype.heartbeatRspNotiFy=function(e){},re.prototype.hbLogout=function(e){},re.prototype.resetHeartbeat=function(){clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null,clearTimeout(this.loginHeartbeatTimer),this.loginHeartbeatTimer=null,this.tryHeartbeatCount=0,this.initCount=0,this.logger.info(D.HEARTBEAT_RESET+" call success")};var te=re;function re(e,t,r,o,s,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.liveRoomHandler=s,this.room=i,this.tryHeartbeatCount=0,this.heartbeatTimer=null,this.loginHeartbeatTimer=null,this.initCount=0}se.prototype.resetTokenTimer=function(e){var t=this;this.logger.info(D.ROOM_RESETTOKEN_TIMER+"  call: "+(e=2147483647<(e=(e-=3e4)<0?0:e)?2147483647:e)),this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=setTimeout((function(){t.stateCenter.actionListener("tokenWillExpire",t.room.roomID),t.stateCenter.actionListener("roomTokenWillExpire",t.room.roomID)}),e)},se.prototype.stopTokenTimer=function(){this.tokenTimer&&clearTimeout(this.tokenTimer),this.tokenTimer=null},se.prototype.setRunState=function(e){this.room.runState!==e&&(this.room.lastRunState=this.room.runState,this.room.runState=e)},se.prototype.resetTryLogin=function(){this.tryLoginTimer&&clearTimeout(this.tryLoginTimer),this.tryLoginTimer=null},se.prototype.resetRoom=function(e){var t=this;this.logger.info(D.ROOM_RESET_ROOM+" call"),1<this.stateCenter.roomModulesList.length&&!e&&(this.room.isMulti=!0),this.resetTryLogin(),"0"===this.room.sessionID||this.room.runState===o.logout||this.room.isDisConnect()||(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).logout(this.room,e=function(e){t.handleLogoutRsp(e,!t.room.isMulti)},e),this.setRunState(o.logout),this.room.sessionID="0",this.room.roomSessionID="0",this.room.isMulti||(this.stateCenter.userid="",this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.stateCenter.useNetAgent?null!=(e=this.liveRoomHandler)&&e.reset():this.service.closeSocket()),this.resetRoomCallBack(),this.stateCenter.roomModulesList=this.stateCenter.roomModulesList.filter((function(e){return e!==t.room})),(e=this.stateCenter.roomModulesList[0])&&(e.isMulti=!1,e.runState!==o.login&&e.roomTryHandler&&(e.roomTryHandler.startMaxTime(),e.roomTryHandler.active())),this.logger.info(D.ROOM_RESET_ROOM+" call success")},se.prototype.resetRoomCallBack=function(){},se.prototype.loginSuccessCallBack=function(e,t){},se.prototype.handlePushKickout=function(e,t,r){var s,i=this;this.logger.info(D.ROOM_KICK_OUT+"  call "+JSON.stringify(e)),r||this.room.sessionID===e.header.session_id||this.room.sessionID===e.body.session_id?(r=p(),this.dataReport.newReport(r,J.kZegoTaskKickout.event),this.dataReport.addMsgInfo(r,{user_id:J.kZegoTaskKickout.user_id(this.stateCenter.idName)}),s=k.getKickoutError(e.body.reason||e.body.kickout_reason,this.stateCenter.useNetAgent),this.dataReport.addMsgInfo(r,{error:s.code,message:s.message}),this.dataReport.uploadReport(r),(r=this.room.roomTryHandler)?(r.onactive=function(e,t){i.disconnectedHandle(t),i.stateCenter.actionListener("_kickout",t)},e.body.need_relogin&&1==e.body.need_relogin?(this.room.sessionID="0",r.startMaxTime(),r.active()):(this.setRunState(o.logout),this.resetRoom(t),r={},e&&e.body.custom_reason?r.custom_kickout_message=e.body.custom_reason:s.name&&M[s.name]&&(r.custom_kickout_message=M[s.name].msg+"; kickout reason: "+(t=e.body.reason||e.body.kickout_reason)),this.disconnectedHandle(s.name&&M[s.name]?M[s.name]:M.ROOM_INNER_ERROR,{extendedData:JSON.stringify(r),isKickout:!0}),this.stateCenter.actionListener("_kickout",{code:M.MANUAL_KICKOUT.code,msg:M.MANUAL_KICKOUT.msg+e.body.reason||e.body.kickout_reason}))):this.logger.info(D.ROOM_KICK_OUT+" try handler no found")):this.logger.info(D.ROOM_KICK_OUT+" session id wrong, ignore")},se.prototype.handleHbLogout=function(e){var t=this,r=this.room.roomTryHandler;r&&(r.onactive=function(e,r){t.disconnectedHandle(r)},[M.HEARTBEAT_TIMEOUT,M.SOCKET_CLOSE].includes(e)||[105,152,2001].includes(null==e?void 0:e.code)||e.msg.endsWith("1000002001")||e.msg.endsWith("1000000152")||e.msg.endsWith("1000000105")?(r.startMaxTime(),r.active()):[M.TIMEOUT].includes(e)?this.logger.warn(D.ROOM_HANDLE_Hb_LOGOUT+" timeout"):(this.logger.warn(D.ROOM_HANDLE_Hb_LOGOUT+" unexpected error: ".concat(JSON.stringify(e))),r.stopMaxTime(),r.invalid(),this.resetRoom(),this.disconnectedHandle(e)))},se.prototype.onDisconnect=function(e){var t,r=this;this.logger.error(D.ROOM_DISCONNECT+" "+e.msg),"string"==typeof e.code&&"Error.Network"===e.code?this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:J.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.code,message:J.kZegoTaskReLoginRoom.error.ROOM_DISCONNECT.msg}):"number"==typeof e.code&&(t=e.code<2e9&&1e9<e.code||e.code<1e6?k.decodeServerError(e.code,e.msg):{code:e.code,message:e.msg})&&this.dataReport.addMsgInfo(this.stateCenter.reportSeqList.relogin,{error:t.code,message:t.message}),this.dataReport.uploadReport(this.stateCenter.reportSeqList.relogin),this.stateCenter.reportSeqList.relogin=0,k.unregisterCallback(J.kZegoTaskReLoginRoom.event,this.stateCenter.reportList),(e=this.room.roomTryHandler)?(e.onactive=function(e,t){t&&0!==t.code?r.roomStateHandle("DISCONNECTED",I.ReconnectFailed,t):r.roomStateHandle("CONNECTED",I.Reconnected,t)},e.startMaxTime(),e.active()):this.logger.error(D.ROOM_DISCONNECT+" try handler no found")},se.prototype.onConnecting=function(e){this.roomStateHandle("CONNECTING",I.Logining,e)},se.prototype.disconnectedHandle=function(e,t){e&&0!==e.code?(this.stopTokenTimer(),this.roomStateHandle("DISCONNECTED",null!=t&&t.isKickout?I.Kickout:I.ReconnectFailed,e,null==t?void 0:t.extendedData)):this.roomStateHandle("CONNECTED",I.Reconnected,e,null==t?void 0:t.extendedData)},se.prototype.roomStateHandle=function(e,t,r,o,s){var i;this.logger.info(D.ROOM_STATUS_CALLBACK+" "+e+" "+JSON.stringify(r)),(t=(t=t&&[I.LoginFailed,I.ReconnectFailed].includes(t)?null!=(i=this.room.roomTryHandler)&&i.loginRoomCallback.fail?I.LoginFailed:I.ReconnectFailed:t)&&[I.Logined,I.Reconnected].includes(t)?null!=(i=this.room.roomTryHandler)&&i.loginRoomCallback.success?I.Logined:I.Reconnected:t)&&[I.Logining,I.Reconnecting].includes(t)&&(t=null!=(i=this.room.roomTryHandler)&&i.loginRoomCallback.success?I.Logining:I.Reconnecting),this.room.lastRoomState=this.room.roomState,this.room.roomState=e,this.room.roomState!==this.room.lastRoomState&&(this.stateCenter.actionListener("_roomStateUpdate",this.room.roomID,e,r?r.code:0,o,s),s||(this.stateCenter.actionListener("roomStateUpdate",this.room.roomID,e,r?r.code:0,o),this.stateCenter.actionListener("roomStateChanged",this.room.roomID,t,r?r.code:0,o)))},se.prototype.login=function(e,t,r,s,i,n,a){if(this.logger.info(D.ROOM_LOGIN_ROOM+" call:"+t+" "+r),this.room.isMulti||this.logger.setSessionInfo(this.stateCenter.appid,t,"",s.userID,"",this.stateCenter.sdKVersion),i&&(i.userUpdate&&"boolean"==typeof i.userUpdate&&(this.stateCenter.userStateUpdate=i.userUpdate),i.maxMemberCount&&"number"==typeof i.maxMemberCount&&(this.room.maxMemberCount=i.maxMemberCount)),!this.stateCenter.configOK)return this.logger.error(D.ROOM_LOGIN_ROOM+" init sdk wrong"),void a(M.INIT);this.room.runState!==o.trylogin&&this.setRunState(o.trylogin),this.room.roomID=t,this.room.token=r,this.room.thirdToken=r,this.stateCenter.idName=s.userID,this.stateCenter.nickName=s.userName||s.userID,this.loginCallback.success=n,this.loginCallback.fail=a,0===this.stateCenter.reportSeqList.login&&(i=p(),this.stateCenter.reportSeqList.relogin=i,this.dataReport.newReport(i,J.kZegoTaskReLoginRoom.event),this.dataReport.addMsgInfo(i,{server:e}),k.logReportCallback(J.kZegoTaskReLoginRoom.event,this.dataReport,i,this.stateCenter.reportList)),this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(e),this.logger.info(D.ROOM_LOGIN_ROOM+" call success")},se.prototype.tryLogin=function(e){var t,r=this;if(this.room.runState!==o.trylogin)this.logger.error("zb.rh.tl state error");else{var s=(0!==this.stateCenter.reportSeqList.login?J.kZegoTaskLoginRoom:J.kZegoTaskReLoginRoom).event;if(this.stateCenter.useNetAgent)this.room.isMulti&&this.room.isDisConnect()?this.logger.warn(D.ROOM_TRY_LOGIN+" liveroom is not connected"):(i=function(e,t){r.handleLoginRsp(e,t)},null!=(t=this.liveRoomHandler)&&t.isUaConnect()?this.liveRoomHandler.login(this.room,i,i):(this.tryLoginTimer=setTimeout((function(){r.logger.info(D.ROOM_TRY_LOGIN+" over time no response, login timeout"),r.loginCallback.fail&&r.loginCallback.fail(J.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.warn(D.ROOM_TRY_LOGIN+" ua is not connected")));else{if(this.service.isDisConnect())try{this.service.closeSocket(),this.logger.debug(D.ROOM_TRY_LOGIN+" new websocket"),k.actionSuccessCallback(s,this.stateCenter.reportList)&&(1<this.tryLoginCount&&k.actionSuccessCallback(s,this.stateCenter.reportList)("eventEnd",J.kZegoTaskLoginRoom.subEvent.create_socket.event),k.actionSuccessCallback(s,this.stateCenter.reportList)(h,J.kZegoTaskLoginRoom.subEvent.create_socket.event),k.actionSuccessCallback(s,this.stateCenter.reportList)(d,J.kZegoTaskLoginRoom.subEvent.create_socket.event,J.kZegoTaskLoginRoom.subEvent.create_socket.server("server"),e)),this.service.createSocket(e),this.service.openHandler((function(){r.openHandler()})),this.service.closeHandler((function(e){r.logger.error(D.ROOM_TRY_LOGIN+" close "+JSON.stringify(e.code||e)),r.service.closeSocket(),r.closeHandler(e)})),this.service.errorHandler((function(e){r.logger.error(D.ROOM_TRY_LOGIN+" error "+JSON.stringify(e.code||e)),r.service.closeSocket(),r.closeHandler(e)}))}catch(e){this.logger.error(D.ROOM_TRY_LOGIN+"  websocket err:"+JSON.stringify(e))}else{this.logger.info(D.ROOM_TRY_LOGIN+" use current websocket and sent login"),k.actionSuccessCallback(s,this.stateCenter.reportList)&&k.actionSuccessCallback(s,this.stateCenter.reportList)(h,J.kZegoTaskLoginRoom.subEvent.liveroom_login.event);var i=function(e,t){r.handleLoginRsp(e,t)};this.service.login(this.room,i,i)}this.tryLoginTimer=setTimeout((function(){r.logger.info(D.ROOM_TRY_LOGIN+" over time no response, login timeout"),r.loginCallback.fail&&r.loginCallback.fail(J.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT)}),this.tryLoginInterval),this.logger.info(D.ROOM_TRY_LOGIN+" call success")}}},se.prototype.openHandler=function(){function e(e,r){t.handleLoginRsp(e,r)}var t=this,r=(this.logger.info(D.ROOM_OPEN_HANDLER+" websocket.onpen call"),(0!==this.stateCenter.reportSeqList.login?J.kZegoTaskLoginRoom:J.kZegoTaskReLoginRoom).event);k.actionSuccessCallback(r,this.stateCenter.reportList)&&k.actionSuccessCallback(r,this.stateCenter.reportList)(g,J.kZegoTaskLoginRoom.subEvent.create_socket.event,{try_cnt:this.tryLoginCount}),this.service.onPush(),k.actionSuccessCallback(r,this.stateCenter.reportList)&&k.actionSuccessCallback(r,this.stateCenter.reportList)(h,J.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.service.login(this.room,e,e)},se.prototype.handleLoginRsp=function(e,t){this.logger.info(D.ROOM_HANDLE_LOGINRSP+" seq: "+t+" "+JSON.stringify(e));var r=(0!==this.stateCenter.reportSeqList.login?J.kZegoTaskLoginRoom:J.kZegoTaskReLoginRoom).event;k.actionSuccessCallback(r,this.stateCenter.reportList)&&k.actionSuccessCallback(r,this.stateCenter.reportList)(g,J.kZegoTaskLoginRoom.subEvent.liveroom_login.event),this.room.runState!==o.trylogin?this.logger.error(D.ROOM_HANDLE_LOGINRSP+" state error"):e.header&&e.body?e.header.seq!==t&&0==this.room.isMulti?this.logger.error(D.ROOM_HANDLE_LOGINRSP+" in wrong seq, local=",t+"",",recv=",e.header.seq):0!==e.body.err_code?(this.logger.error(D.ROOM_HANDLE_LOGINRSP+" server error=",e.body.err_code),this.handleLoginFail(e)):(this.logger.info(D.ROOM_HANDLE_LOGINRSP+" call success."),this.handleLoginSuccess(e)):(this.logger.error(D.ROOM_HANDLE_LOGINRSP+" "+JSON.stringify(e)),this.handleLoginFail(e))},se.prototype.handleLoginFail=function(e){this.resetTryLogin();var t=J.kZegoTaskLoginRoom.error.INNER_ERROR;e.header&&e.body?t=k.getServerError(e.body.err_code):e.code&&e.msg&&(t=e),this.loginCallback.fail&&this.loginCallback.fail(t,!0)},se.prototype.handleLoginSuccess=function(e){var t,r={},s=this.room.lastRunState,i=(this.setRunState(o.login),this.stateCenter.userid=e.body.user_id,this.room.sessionID=e.body.session_id,this.room.roomSessionID=e.body.room_session_id,this.room.lvKey=e.body.lv_key,null==(i=null==e?void 0:e.body)?void 0:i.token_remain_time),n=(this.stateCenter.configRoomAuth=0<i,e.body.ret_timestamp&&["03","04"].includes(this.room.token.substring(0,2))&&(t=(n=(new Date).getTime())-e.body.ret_timestamp,this.stateCenter.local_time_deviation=t<5e3?0:t,t=0<i?1e3*i:1e3*k.decodeTokenExpire(this.room.token.substring(2))-n,this.resetTokenTimer(t-this.stateCenter.local_time_deviation)),this.room.isMulti||this.logger.setSessionInfo(this.stateCenter.appid,this.room.roomID,this.room.sessionID,this.stateCenter.idName,this.stateCenter.nickName,this.stateCenter.sdKVersion),this.stateCenter.useNetAgent||(e.body.config_info&&(i=this.stateCenter.settingConfig.getSetting("remote_log_level",!0)||e.body.config_info.log_level,this.logger.setRemoteLogLevel(i),r.log_level=i,""==e.body.config_info.log_url||this.logger.url||(this.logger.setLogServer(e.body.config_info.log_url),r.log_url=e.body.config_info.log_url)),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,r.test_environment="true",this.stateCenter.debugCustom||(this.stateCenter.debug=!0))),(0!==this.stateCenter.reportSeqList.login?J.kZegoTaskLoginRoom:J.kZegoTaskReLoginRoom).event);k.actionSuccessCallback(n,this.stateCenter.reportList)&&k.actionSuccessCallback(n,this.stateCenter.reportList)(d,J.kZegoTaskLoginRoom.subEvent.liveroom_login.event,J.kZegoTaskLoginRoom.subEvent.liveroom_login.respond_info("respond_info"),r),this.resetTryLogin(),this.loginSuccessCallBack(s,e),this.roomStateHandle("CONNECTED",I.Logined,{code:0,msg:""}),this.loginCallback.success&&this.loginCallback.success(!0)},se.prototype.closeHandler=function(e){this.logger.error(D.ROOM_CLOSEHANDLER+" room websocket close "+JSON.stringify(e.code||e)),this.room.runState!==o.logout?this.room.runState===o.trylogin?(this.resetTryLogin(),this.loginCallback.fail&&this.loginCallback.fail(1006==e.code?J.kZegoTaskLoginRoom.error.LOGIN_TIMEOUT:e)):this.room.runState===o.login&&(this.logger.info(D.ROOM_CLOSEHANDLER+" is called because of network broken"),this.resetTryLogin(),this.onDisconnect(J.kZegoTaskLoginRoom.error.NETWORK_BROKEN)):this.logger.info(D.ROOM_CLOSEHANDLER+" onclose logout flow call websocket.close")},se.prototype.logout=function(e,t){this.logger.info(D.ROOM_LOGOUT+" call"),this.room.runState===o.logout?this.logger.warn("zb.rh.lo at logout"):(this.resetRoom(e),this.roomStateHandle("DISCONNECTED",I.Logout,{code:0,msg:""},void 0,t),this.stopTokenTimer(),this.logger.info(D.ROOM_LOGOUT+" call success"))},se.prototype.handleLogoutRsp=function(e,t){this.logger.info(D.ROOM_LOGOUT+" result=",e.body&&e.body.err_code?e.body.err_code:"-1"),this.stateCenter.useNetAgent&&t&&null!=(e=this.liveRoomHandler)&&e.closeRequest()};var oe=se;function se(e,t,r,o,s,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.room=s,this.liveRoomHandler=i,this.tryLoginTimer=null,this.tryLoginCount=0,this.tryLoginInterval=1e4,this.tokenTimer=null,this.beforeExpire=30,this.loginCallback={}}var ie=function(e,t,r){if(r||2===arguments.length)for(var o,s=0,i=t.length;s<i;s++)!o&&s in t||((o=o||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))},ne=(ae.prototype.loginRsp=function(e,t){this.anchor_info=e.body.anchor_info||this.anchor_info,this.userListInterval=e.body.userlist_interval||this.userListInterval,this.userListMergeInterval=e.body.userlist_merge_timeout||this.userListMergeInterval,e.body.anchor_info&&(this.stateCenter.actionListener("getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name),this.stateCenter.actionListener("_getAnchorInfo",e.body.anchor_info.anchor_id_name,e.body.anchor_info.anchor_nick_name)),e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count),this.logger.info(D.USER_LOGIN_RSP+"  userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList(t)},ae.prototype.patchUserList=function(e){var t=this;e.body.server_user_seq!==this.userSeq&&this.stateCenter.userStateUpdate&&!this.userSeqMergeMap&&(this.logger.info(D.USER_HB_PATCH+" call update user "+this.userSeq+" server "+e.body.server_user_seq),this.userSeqMergeMap||(this.userSeqMergeMap={}),this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){t.handleMergeTimeout()}),this.userListMergeInterval)),this.minUserSeq=e.body.server_user_seq,null!=e.body.online_count&&0!=e.body.online_count&&this.stateCenter.actionListener("roomOnlineUserCountUpdate",this.room.roomID,e.body.online_count)},ae.prototype.resetUserHandler=function(){this.userQuerying=!1,this.lastUserQueryTime=0,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=void 0,this.userSeqMergeMap={},this.userSeqMergeTimer=void 0,this.userQueryTimer=void 0,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}},ae.prototype.fetchUserList=function(e){this.userQuerying?this.logger.warn(D.USER_FETCH_USER+" is already querying"):(this.userQuerying=!0,this.userTempList=[],this.fetchUserListWithPage(0,e||0),this.logger.info(D.USER_FETCH_USER+" the first time call"))},ae.prototype.fetchUserListWithPage=function(e,t){function r(e){o.handleFetchUserListRsp(e,t)}var o=this;(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).fetchUserList({user_index:e,sort_type:0},r,r,this.room)},ae.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(e.body&&0!=e.body.err_code)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(D.USER_FETCH_USER_RSP+" fetch error "+e.body.err_code);if(!e.header||!e.body)return this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,void this.logger.info(D.USER_FETCH_USER_RSP+" fetch error "+e);if(this.stateCenter.userStateUpdate){this.userTempList=ie(ie([],this.userTempList,!0),e.body.user_baseinfos,!0);var s=e.body.ret_user_index;if(s!=e.body.server_user_index)return this.logger.info(D.USER_FETCH_USER_RSP+" fetch another page"),void this.fetchUserListWithPage(s+1,t);this.userSeq=e.body.server_user_seq;for(var i=[],n=[],a=0;a<this.userTempList.length;a++)i.push({userID:this.userTempList[a].id_name,userName:this.userTempList[a].nick_name,role:this.userTempList[a].role}),n.push({idName:this.userTempList[a].id_name,nickName:this.userTempList[a].nick_name,role:this.userTempList[a].role});this.stateCenter.actionListener("_getTotalUserList",this.room.roomID,n),t==o.login?(this.userList&&k.mergeUserList(this.logger,this.userList,i,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.room.roomID,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.room.roomID,"DELETE",t)})),this.userList=i):0!==(this.userList=i).length&&this.onUserStateUpdate(this.room.roomID,"ADD",i),this.userQuerying=!1,this.lastUserQueryTime=Date.now()+this.userListInterval,this.userTempList=[],this.logger.info(D.USER_FETCH_USER_RSP+" call success user_list "+i+" count "+i.length)}},ae.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info(D.USER_USER_PUSH+" call"),this.stateCenter.userStateUpdate)if(this.userSeq===e.body.user_list_seq)this.logger.warn(D.USER_USER_PUSH+" user_list_seq is the same with local seq");else if(this.userSeq+e.body.user_actions.length!==e.body.user_list_seq)this.mergeUserByUserSeq(e.body.user_list_seq,e.body.user_actions);else{this.userSeq=e.body.user_list_seq;for(var t=[],r=0;r<e.body.user_actions.length;r++)t.push({action:e.body.user_actions[r].Action,idName:e.body.user_actions[r].IdName,nickName:e.body.user_actions[r].NickName,role:e.body.user_actions[r].Role,loginTime:e.body.user_actions[r].LoginTime});this.stateCenter.actionListener("_userStateUpdate",e.body.room_id,t);var o=[],s=[];t.forEach((function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&s.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList&&(this.userList=this.userList.concat(o).filter((function(e){return!s.some((function(t){return t.userID==e.userID}))}))),0!==o.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"ADD",o),0!==s.length&&this.onUserStateUpdate(e.body.room_id||e.body.room_pushheader.room_id,"DELETE",s),this.logger.info(D.USER_USER_PUSH+" call success")}else this.logger.info(D.USER_USER_PUSH+" userStateUpdate is false")},ae.prototype.onUserStateUpdate=function(e,t,r){var o=this,s=p();this.dataReport.newReport(s,J.kZegoTaskLiveRoomGetUserUpdateInfo.event),r=r.filter((function(e){return e.userID!==o.stateCenter.idName})),0!=r.length&&(r=r.map((function(e){return{userID:e.userID,userName:e.userName}})),this.stateCenter.actionListener("roomUserUpdate",e,t,r),this.dataReport.addMsgInfo(s,{user_update_type:J.kZegoTaskLiveRoomGetUserUpdateInfo.user_update_type("ADD"==t?"added":"deleted")}),this.dataReport.uploadReport(s))},ae.prototype.mergeUserByUserSeq=function(e,t){var r=this;this.userSeqMergeMap||(this.logger.warn(D.USER_MERGE_SEQ+" new merge userlist "+this.userSeq+" server "+e),this.userSeqMergeMap={},this.userSeqMergeTimer&&clearTimeout(this.userSeqMergeTimer),this.userSeqMergeTimer=setTimeout((function(){r.handleMergeTimeout()}),this.userListMergeInterval)),this.userSeqMergeMap[e]=t,this.logger.warn(D.USER_MERGE_SEQ+"  merge userlist "+this.userSeq+" server "+e+" userlist "+t.length)},ae.prototype.mergeUser=function(e){var t=this,r=(this.logger.info(D.USER_MERGE+" merge userlist "+this.userSeq+" userSeqList "+e.join(",")),this.userSeq=e[e.length-1],this.lastUserQueryTime=Date.now()+this.userListInterval,{}),o=((e.forEach((function(e){t.userSeqMergeMap&&t.userSeqMergeMap[e].forEach((function(e){r[e.IdName]=e}))})),this.userSeqMergeMap=null,e=Object.values(r).map((function(e){return{action:e.Action,idName:e.IdName,nickName:e.NickName,role:e.Role,loginTime:e.LoginTime?String(e.LoginTime):""}}))).sort((function(e,t){return e.loginTime.localeCompare(t.loginTime)})),[]),s=[];e.forEach((function(e){1==e.action?o.push({userID:e.idName,userName:e.nickName,role:e.role}):2==e.action&&s.push({userID:e.idName,userName:e.nickName,role:e.role})})),this.userList=this.userList&&this.userList.concat(o).filter((function(e){return!s.some((function(t){return t.userID==e.userID}))})),0!==o.length&&this.onUserStateUpdate(this.room.roomID,"ADD",o),0!==s.length&&this.onUserStateUpdate(this.room.roomID,"DELETE",s),this.stateCenter.actionListener("_userStateUpdate",this.room.roomID,e)},ae.prototype.handleMergeTimeout=function(){var e,t=this,r=Object.keys(this.userSeqMergeMap).map((function(e){return+e})).sort((function(e,t){return e-t}));r[r.length-1]-r[0]+1===r.length||r[r.length-1]>=this.minUserSeq?this.mergeUser(r):(this.userSeqMergeMap=null,e=this.lastUserQueryTime-Date.now(),this.logger.info(D.USER_MERGE_TIMEOUT+"  fetch merge userlist "+this.userSeq+" userSeqList "+r.join(",")+" wait "+e),0<e?(this.userQueryTimer&&clearTimeout(this.userQueryTimer),this.userQueryTimer=setTimeout((function(){t.fetchUserList()}),e)):this.fetchUserList())},ae.prototype.loginPrivateRsp=function(e){this.logger.info(D.USER_FETCH_USER," userStateUpdate "+this.stateCenter.userStateUpdate),this.stateCenter.userStateUpdate&&this.fetchUserList()},ae);function ae(e,t,r,o,s,i){this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.liveRoomHandler=s,this.room=i,this.userQuerying=!1,this.userTempList=[],this.userSeq=0,this.minUserSeq=0,this.userList=[],this.userSeqMergeMap=null,this.userListInterval=3e4,this.userListMergeInterval=5e3,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""}}ue.prototype.initMessageHandler=function(){},ue.prototype.initLiveHandler=function(){},ue.prototype.init=function(){this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler()},ue.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler.hbLogout=function(t){e.roomHandler.handleHbLogout(t)},this.heartBeatHandler.heartbeatRspNotiFy=function(t){e.messageHandler&&e.messageHandler.loginRsp(t),e.userHandler.patchUserList(t),e.HBResponse(t)}},ue.prototype.bindRoomHandler=function(){var e=this;this.roomHandler.loginSuccessCallBack=function(t,r){e.logger.info(D.LIVEROOMMODULES_BINDROOMHANDLER+" login suc "+t),e.heartBeatHandler.init(r),e.stateCenter.useNetAgent?e.liveRoomHandler.startCheck():(e.service.stopCheck(),e.service.startCheck()),e.userHandler.loginRsp(r,t),e.messageHandler&&e.messageHandler.loginRsp(r),e.isMulti||e.handleMultiRoom(),e.roomLoginResponse(r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.liveHandler&&e.liveHandler.resetLiveHandler(),e.messageHandler&&e.messageHandler.resetMessageInfo(),e.stateCenter.useNetAgent&&e.liveRoomHandler&&e.liveRoomHandler.stopCheck(),e.userHandler.resetUserHandler(),e.service.stopCheck(),e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.stopMaxTime())}},ue.prototype.bindUserHandler=function(){},ue.prototype.bindMessageHandler=function(){},ue.prototype.bindLiveHandler=function(){},ue.prototype.HBResponse=function(e){this.stateCenter.actionListener("HBResponse",e)},ue.prototype.roomLoginResponse=function(e){this.stateCenter.actionListener("roomLoginResponse",e)},ue.prototype.handleMultiRoom=function(){var e=this;this.stateCenter.roomModulesList.forEach((function(t){t.runState!==o.login&&t.roomTryHandler&&1==t.isMulti&&(t.roomTryHandler.onactive=function(r,o){var s;o&&0!==o.code?(0!==o.code&&(s=k.getLiveRoomError(o.code,e.stateCenter.useNetAgent))&&M[s]&&(o=M[s]),t.roomHandler.roomStateHandle("DISCONNECTED",I.ReconnectFailed,o,o.msg)):t.roomHandler.roomStateHandle("CONNECTED",I.Reconnected,o)},t.roomTryHandler.startMaxTime(),t.roomTryHandler.active())}))},ue.prototype.isLogin=function(){return this.runState===o.login},ue.prototype.isDisConnect=function(){return(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).isDisConnect()},ue.prototype.retryConnect=function(){this.logger.info("zm.lrm.rc call"),this.stateCenter.useNetAgent&&(this.resetSessionInfo(),this.liveRoomHandler.closeRequest())},ue.prototype.retryRoom=function(){this.logger.info("zm.lrm.rr.0 call"),this.roomTryHandler&&this.rtm.netAgent.isConnect()&&(this.sessionID="0",this.roomSessionID="0",this.roomTryHandler.active(!0))},ue.prototype.resetSessionInfo=function(){var e;this.logger.info("zm.lrm.rsi call"),this.sessionID="0",this.roomSessionID="0",null!=(e=this.liveRoomHandler)&&e.reset()};var le=ue;function ue(e,t,r,s,i,n,a){this.roomID=e,this.stateCenter=t,this.logger=r,this.dataReport=s,this.service=i,this.rtm=n,this.liveRoomHandler=a,this.runState=o.logout,this.lastRunState=o.logout,this.lastRoomState="DISCONNECTED",this.roomState="DISCONNECTED",this.roomSessionID="0",this.sessionID="0",this.isMulti=!1,this.token="",this.thirdToken="",this.maxMemberCount=0,this.lvKey="",this.roomName="",this.roomHandler=new oe(this.logger,this.stateCenter,this.dataReport,this.service,this,a),this.heartBeatHandler=new te(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this),this.userHandler=new ne(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this),this.initMessageHandler(),this.initLiveHandler(),this.init()}he.prototype.createSocket=function(e){this.socket=Object(a.createZegoWebSocket)(e,this.ENV%2)},he.prototype.closeSocket=function(){this.socket&&(this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null)},he.prototype.isDisConnect=function(){return!this.socket||1!==this.socket.readyState},he.prototype.sendMessage=function(e,t,r,o,s){return void 0===r&&(r=null),void 0===o&&(o=null),void 0===s&&(s={timeOut:6e3}),s={data:t={header:e,body:t},seq:e.seq,deleted:!1,sendTime:Date.parse(new Date+""),timeOut:s.timeOut,success:r,error:o},r=this.sendCommandList.push(s),this.sendCommandMap[s.seq]=r,this.socket&&this.socket.send(JSON.stringify(t)),e.seq},he.prototype.sendPB=function(e){return this.socket&&this.socket.send(e),!0},he.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)!function(){var r,o,s;e.remove(t),t&&t._data&&(r=t._data.error,o=t._data.seq,s=t._data.data.body.custom_msg,setTimeout((function(){r&&r(M.TIMEOUT,o,s)}),0)),t=e.getFirst()}()},he.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),o=Date.parse(new Date+""),s=0,i=this;null!=r&&"break"!==function(){return r._data&&r._data.sendTime+r._data.timeOut>o?"break":(r._data&&delete t[r._data.data.header.seq],e.remove(r),r._data&&null==r._data.error||r._data&&r._data.sendTime+i.sendDataDropTimeout<o||r&&r._data&&(n=r._data.error,a=r._data.seq,l=r._data.data.body.custom_msg,setTimeout((function(){n&&n(M.TIMEOUT,a,l)}),0)),++s>=i.sendDataCheckOnceCount?"break":void(r=e.getFirst()));var n,a,l}(););},he.prototype.startCheck=function(){var e=this;this.checkMessageListTimeout(this.sendCommandList,this.sendCommandMap),this.sendDataCheckTimer=setTimeout((function(){e.startCheck()}),this.sendDataCheckInterval)},he.prototype.stopCheck=function(){this.checkSendMessageList(this.sendCommandList),this.sendCommandMap={},clearTimeout(this.sendDataCheckTimer)},he.prototype.openHandler=function(e){var t=this;this.socket&&(this.socket.onopen=function(r){t.socket.binaryType="arraybuffer",t.responseHandler(),e(r)})},he.prototype.responseHandler=function(){var e=this;this.socket&&(this.socket.onmessage=function(t){t="string"==typeof t.data?JSON.parse(t.data):t.data,e.onMessage(t)})},he.prototype.closeHandler=function(e){this.socket&&(this.socket.onclose=function(t){e(t)})},he.prototype.errorHandler=function(e){this.socket&&(this.socket.onerror=e)},he.prototype.onMessage=function(e){};var ce=he;function he(e){this.socket=null,this.sendCommandList=new T,this.sendCommandMap={},this.sendDataCheckOnceCount=100,this.sendDataDropTimeout=1e4,this.sendDataCheckInterval=2e3,this.ENV=e}var ge=function(){return(ge=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},de=(_e.prototype.checkResponse=function(e){return 0!=this.stateCenter.roomModulesList.filter((function(e){return e.runState!==o.logout})).length&&(e.header.appid!==this.stateCenter.appid||e.header.user_id!==this.stateCenter.userid)},_e.prototype.handleSendCommandMsgRsp=function(e){var t,r=this,o=this.service.sendCommandMap[e.header.seq];null!=o&&(t=o._data,delete this.service.sendCommandMap[e.header.seq],this.service.sendCommandList.remove(o),0===e.body.err_code?setTimeout((function(){t&&null!=t.success&&t.success(e,r.cmdSeq)}),0):setTimeout((function(){t&&null!=t.error&&t.error(e,r.cmdSeq)}),0))},_e.prototype.onPush=function(){var e=this;this.service.onMessage=function(t){t instanceof ArrayBuffer?e.stateCenter.actionListener("_protobufResponse",t):t.header?(0!==t.body.err_code?t.body.err_message&&e.logger.error("".concat(D.SERVICE_PUSH," cmd=").concat(t.header.cmd,", err_code=").concat(t.body.err_code,", err_message=").concat(t.body.err_message," ")):e.logger.info("".concat(D.SERVICE_PUSH," cmd=").concat(t.header.cmd,", msg=").concat(JSON.stringify(t)," ")),-1<["login","logout"].indexOf(t.header.cmd)?e.handleSendCommandMsgRsp(t):e.checkResponse(t)?e.logger.error(D.SERVICE_PUSH+"  check session fail."):(e.logger.info("".concat(D.SERVICE_PUSH," cmd=").concat(t.header.cmd,",function=").concat(!!e.responseRouters[t.header.cmd])),e.handleSendCommandMsgRsp(t),e.responseRouters[t.header.cmd]&&e.responseRouters[t.header.cmd](t,e.cmdSeq))):e.logger.error("".concat(D.SERVICE_PUSH," msg type error "))}},_e.prototype.handlePushKickout=function(e){var t,r;void 0===(null==(r=null==e?void 0:e.body)?void 0:r.protocol)||1===(null==(r=null==e?void 0:e.body)?void 0:r.protocol)?function(e,t,r){if(r||2===arguments.length)for(var o,s=0,i=t.length;s<i;s++)!o&&s in t||((o=o||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}([],this.stateCenter.roomModulesList,!0).forEach((function(t){return t.roomHandler.handlePushKickout(e,!0)})):(t=null==(r=null==e?void 0:e.header)?void 0:r.room_id,(r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==t})))?r.roomHandler.handlePushKickout(e):this.logger.error(D.SERVICE_PUSH+" room no found ignore "+JSON.stringify(null==(r=e.header)?void 0:r.room_id)))},_e.prototype.handlePushCustomMsg=function(e){},_e.prototype.handlePushRoomMsg=function(e){},_e.prototype.handlePushUserStateUpdateMsg=function(e){var t=null==(r=null==e?void 0:e.header)?void 0:r.room_id,r=this.stateCenter.roomModulesList.find((function(e){return e.roomID==t}));r?r.userHandler.handlePushUserStateUpdateMsg(e):this.logger.error(D.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},_e.prototype.handlePushMergeMsg=function(e){},_e.prototype.handlePushTransMsg=function(e){},_e.prototype.handleBigImMsgRsp=function(e){},_e.prototype.handlePushSignalMsg=function(e){},_e.prototype.handlePushTokenExpire=function(e){this.stateCenter.actionListener("_tokenExpired",e)},_e.prototype.closeHandler=function(e){this.service.closeHandler(e)},_e.prototype.openHandler=function(e){this.service.openHandler(e)},_e.prototype.errorHandler=function(e){this.service.errorHandler(e)},_e.prototype.getHeader=function(e,t,r,o){return{Protocol:"req",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:t||"",room_id:r||"",room_session_id:o||"",biz_version:this.stateCenter.bizVersion||""}},_e.prototype.startCheck=function(){this.logger.info(D.SERVICE_START_CHECK+" start"),this.service.startCheck()},_e.prototype.stopCheck=function(){this.logger.info(D.SERVICE_STOP_CHECK+" stop"),this.service.stopCheck()},_e.prototype.isDisConnect=function(){return!this.service||this.service.isDisConnect()},_e.prototype.createSocket=function(e){var t=this;this.service.createSocket(e),this.responseRouters=ge(ge({},this.responseRouters),{push_kickout:function(e){t.handlePushKickout(e)},push_custommsg:function(e){t.handlePushCustomMsg(e)},push_im_chat:function(e){t.handlePushRoomMsg(e)},push_userlist_update:function(e){t.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){t.handlePushMergeMsg(e)},push_trans:function(e){t.handlePushTransMsg(e)},push_signal:function(e){t.handlePushSignalMsg(e)},push_token_expire:function(e){t.handlePushTokenExpire(e)}})},_e.prototype.closeSocket=function(){this.service.closeSocket()},_e.prototype.sendMessage=function(e,t,r,o,s,i){var n,a;return this.service.isDisConnect()?(this.logger.error(D.SERVICE_SEND+" socket is disconnect"),o(M.SOCKET_CLOSE),0):(n=null!=i&&i.roomID?i.roomID:null==(n=this.stateCenter.roomModulesList[0])?void 0:n.roomID,a=null!=i&&i.roomSessionID?i.roomSessionID:null==(a=this.stateCenter.roomModulesList[0])?void 0:a.roomSessionID,i=null!=i&&i.sessionID?i.sessionID:null==(i=this.stateCenter.roomModulesList[0])?void 0:i.sessionID,s=s||this.getHeader(e,i,n,a),this.logger.info(D.SERVICE_SEND+" sendMsg:"+JSON.stringify({header:s,body:t})),this.service.sendMessage(s,t,r,o))},_e.prototype.on=function(e,t){this.responseRouters[e]=t},_e.prototype.login=function(e,t,r){var o=this.getHeader(e.isMulti?"enter":"login",e.sessionID,e.roomID,e.roomSessionID);return e={id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:e.token,version:this.stateCenter.sdKVersion,room_name:e.roomID,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:0===this.stateCenter.ENV?n.ClientType_Webrtc:n.ClientType_SmallProgram,third_token:e.thirdToken,user_count_limit:e.maxMemberCount,relate_service:this.stateCenter.relateService.join()||"",login_logic:this.stateCenter.isMultiRoom?3:1,proto_format:this.stateCenter.protoFormat},this.sendMessage("",e,t,r,o)},_e.prototype.logout=function(e,t,r){var o=e.isMulti?"quit":"logout",s={reserve:0};return"logout"==o&&(s.login_logic=this.stateCenter.isMultiRoom?3:1),this.sendMessage(o,s,t,r,void 0,{sessionID:e.sessionID,roomID:e.roomID,roomSessionID:e.roomSessionID})},_e.prototype.heartBeat=function(e,t,r){return this.sendMessage("hb",{reserve:0},e,t,void 0,r)},_e.prototype.fetchUserList=function(e,t,r,o){return this.sendMessage("user_list",e,t,r,void 0,o)},_e.prototype.fetchUserListV2=function(e,t,r,o){return this.sendMessage("user_list_v2",e,t,r,void 0,o)},_e.prototype.fetchReliableMessage=function(e,t,r,o){return this.sendMessage("trans_fetch",e,t,r,void 0,o)},_e.prototype.sendReliableMessage=function(e,t,r,o){return this.sendMessage("trans",e,t,r,void 0,o)},_e.prototype.sendRoomMsg=function(e,t,r,o){return this.sendMessage("im_chat",e,t,r,void 0,o)},_e.prototype.sendCustomCommand=function(e,t,r,o){return this.sendMessage("custommsg",e,t,r,void 0,o)},_e.prototype.sendBigRoomMessage=function(e,t,r,o){return this.sendMessage("bigim_chat",e,t,r,void 0,o)},_e.prototype.sendRelayMessage=function(e,t,r,o){return this.sendMessage("relay",e,t,r,void 0,o)},_e.prototype.sendSignalCmd=function(e,t,r,o){return this.sendMessage("signal",e,t,r,void 0,o)},_e.prototype.sendPB=function(e){return this.service.isDisConnect()||this.stateCenter.networkState==s.offline?(this.logger.error(D.RTM_SEND_PB+" socket is disconnected"),!1):this.service.sendPB(e)},_e);function _e(e,t,r){this.stateCenter=e,this.logger=t,this.rtm=r,this.service=new ce(this.stateCenter.ENV),this.cmdSeq=0,this.responseRouters={}}Ee.getInstance=function(){return Ee.instance=Ee.instance?Ee.instance:new Ee},Ee.prototype.setSetting=function(e,t){var r,o,s=Array.isArray(t)&&0<t.length;for(r in e)if("number"==typeof e[r].ctrlmode&&[1,2].includes(e[r].ctrlmode))this.setting[r]=e[r],this.setting[r+"_ctrlmode"]=e[r].ctrlmode;else for(var i in e[r])i.endsWith("_ctrlmode")||s&&-1==t.indexOf(i)||(1===(o=e[r][i+"_ctrlmode"])||2===o?this.setting[i]=e[r][i]:this.defaultSetting[i]&&(this.setting[i]=this.defaultSetting[i]),"number"==typeof o&&(this.setting[i+"_ctrlmode"]=e[r][i+"_ctrlmode"]))},Ee.prototype.getSetting=function(e,t){return(t=void 0!==t&&t)&&2!=this.setting[e+"_ctrlmode"]?void 0:this.setting[e]};var pe=Ee;function Ee(){this.defaultSetting={remote_log_level:"info"},this.requestList={},this.setting=JSON.parse(JSON.stringify(this.defaultSetting))}Te.prototype.listenCallBack=function(){var e=this;this.roomServicer.handlePushCustomMsg=function(t){e.handlePushCustomMsg(t)},this.roomServicer.handlePushTokenExpire=function(e){},this.roomServicer.handlePushKickout=function(e,t){},this.roomServicer.handlePushStreamMsg=function(t){e.handlePushStreamMsg(t)},this.roomServicer.handlePushSignalMsg=function(t){e.handlePushSignalMsg(t)},this.roomServicer.handlePushMergeMsg=function(t){e.handlePushMergeMsg(t)},this.roomServicer.handlePushRoomMsg=function(t){e.handlePushRoomMsg(t)},this.roomServicer.handlePushTransMsg=function(t){e.handlePushTransMsg(t)},this.roomServicer.onSwitchMessage=function(t,r){e.onSwitchMessage(t,r)},this.roomServicer.handlePushUserStateUpdateMsg=function(e){}},Te.prototype.isDisConnect=function(){return!1},Te.prototype.isUaConnect=function(){return!1},Te.prototype.sendMessage=function(e,t,r,o,s,i){return-1},Te.prototype.handlePushTokenExpire=function(e){},Te.prototype.handlePushKickout=function(e,t){},Te.prototype.handlePushStreamMsg=function(e){},Te.prototype.handlePushSignalMsg=function(e){},Te.prototype.handlePushMergeMsg=function(e){},Te.prototype.handlePushCustomMsg=function(e){},Te.prototype.handlePushRoomMsg=function(e){},Te.prototype.handlePushTransMsg=function(e){},Te.prototype.onSwitchMessage=function(e,t){},Te.prototype.handlePushUserStateUpdateMsg=function(e){},Te.prototype.login=function(e,t,r){},Te.prototype.logout=function(e,t,r){return-1},Te.prototype.startCheck=function(){},Te.prototype.stopCheck=function(){},Te.prototype.getReqHead=function(e){},Te.prototype.heartBeat=function(e,t,r){},Te.prototype.fetchUserList=function(e,t,r,o){return 0},Te.prototype.sendRoomMsg=function(e,t,r,o){return 0},Te.prototype.sendReliableMessage=function(e,t,r,o){return 0},Te.prototype.fetchReliableMessage=function(e,t,r,o){return 0},Te.prototype.sendCustomCommand=function(e,t,r,o){return-1},Te.prototype.sendBigRoomMessage=function(e,t,r,o){return-1},Te.prototype.sendRelayMessage=function(e,t,r,o){return-1},Te.prototype.sendSignalCmd=function(e,t,r,o){return-1},Te.prototype.sendStreamUpdate=function(e,t,r,o){},Te.prototype.getStreamList=function(e,t,r,o){},Te.prototype.renewToken=function(e,t,r,o){},Te.prototype.reset=function(){},Te.prototype.closeRequest=function(){};var me=Te;function Te(e,t,r,o,s){this.logger=e,this.stateCenter=t,this.ua=r,this.dataReport=o,this.rtm=s}var Re=function(e,t,r,o){return new(r=r||Promise)((function(s,i){function n(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):((t=e.value)instanceof r?t:new r((function(e){e(t)}))).then(n,a)}l((o=o.apply(e,t||[])).next())}))},fe=function(e,t){var r,o,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},n={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){var l=[n,a];if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,o&&(s=2&l[0]?o.return:l[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,l[1])).done)return s;switch(o=0,(l=s?[2&l[0],s.value]:l)[0]){case 0:case 1:s=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,o=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!s||l[1]>s[0]&&l[1]<s[3])){i.label=l[1];break}if(6===l[0]&&i.label<s[1]){i.label=s[1],s=l;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(l);break}s[2]&&i.ops.pop(),i.trys.pop();continue}l=t.call(e,i)}catch(a){l=[6,a],o=0}finally{r=s=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}},Se=function(e,t,r){if(r||2===arguments.length)for(var o,s=0,i=t.length;s<i;s++)!o&&s in t||((o=o||Array.prototype.slice.call(t,0,s))[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))},Ce=(Object.defineProperty(Ie.prototype,"modules",{get:function(){return{service:this.service}},enumerable:!1,configurable:!0}),Ie.prototype.getSettingUnify=function(e){var t=this.stateCenter.settingConfig.getSetting("unify",e=void 0!==e&&e);return this.logger.info(D.RTM_GET_SETTING_UNIFY+" "+e+" "+JSON.stringify(t)),t?(e=t.enable,t=t.sdk_conn_ver,!!(e&&t<=3)):this.stateCenter.useNetAgent},Ie.prototype.initCallback=function(){this.proxyRes=k.proxyRes,this.actionSuccessCallback=k.actionSuccessCallback,this.actionErrorCallback=k.actionErrorCallback,this.getServerError=k.getServerError,this.generateRandumNumber=k.generateRandumNumber,this.unregisterCallback=k.unregisterCallback,this.logReportCallback=k.logReportCallback,this.registerCallback=k.registerCallback},Ie.prototype.getStoreAppConfig=function(){this.logger.info(D.RTM_GETSTOREAPPCONFIG+" call");var e=localStorage.getItem(B+"_"+this.getAppID()+"_"+(this.stateCenter.mode||G));if(e)try{var t=k.decryptStores(e,x);t?(this.stateCenter.appConfig=JSON.parse(t),this.stateCenter.actionListener("_appConfigRsp"),this.handleLogUpload()):localStorage.removeItem(B+"_"+this.getAppID()+"_"+(this.stateCenter.mode||G))}catch(e){this.logger.warn(D.RTM_GETSTOREAPPCONFIG+" "+JSON.stringify(e))}else this.logger.info(D.RTM_GETSTOREAPPCONFIG+" no store config")},Ie.prototype.createNetAgent=function(){var e=this,t=(this.logger.info(D.RTM_CREATENETAGENT+" call"),this.netAgent.on("disconnected",(function(t){e.logger.info("".concat(D.RTM_CREATENETAGENT," netAgent disconnect"))})),this.netAgent.on("connected",(function(){e.logger.info("".concat(D.RTM_CREATENETAGENT," netAgent connect")),e.stateCenter.useNetAgent?(e.fetchAppConfig(),e.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.netAgent.isConnect()&&t.roomTryHandler.active(!0)}))):e.logger.info("".concat(D.RTM_CREATENETAGENT," unify false"))})),this.netAgent.on("broken",(function(t){e.logger.info("".concat(D.RTM_CREATENETAGENT," netAgent broken")),t===f.CLOSE&&e.stateCenter.roomModulesList.forEach((function(e){e.resetSessionInfo()}))})),this.netAgent.on("dispatchEvent",(function(t,r,o){var s;e.logger.info("".concat(D.RTM_CREATENETAGENT," dispatch")),"start"===r?(s=p(),e.dataReport.newReport(s,J.kZegoConnDispatch.event),e.stateCenter.requestList[t]=s):"end"===r&&(s=e.stateCenter.requestList[t])&&(r="",r=null!=o&&o.reason?o.reason:e.dispatchServers?"UpdateDispatchResult":"NoDispatchResult",e.dataReport.addMsgInfo(s,{domain_list:J.kZegoConnDispatch.domain_list(o.domains),trigger_reason:J.kZegoConnDispatch.trigger_reason(r)}),e.dataReport.uploadReport(s))})),this.netAgent.on("connectedEvent",(function(t,r,o){var s;e.logger.info("".concat(D.RTM_CREATENETAGENT," connect")),"start"===r?(s=p(),e.dataReport.newReport(s,J.kZegoConnConnect.event),e.stateCenter.requestList[t]=s):"end"===r&&(s=e.stateCenter.requestList[t])&&(e.dataReport.addMsgInfo(s,{server_list:J.kZegoConnConnect.server_list(o.servers),request_count:o.count,connect_id:o.connectid}),e.dataReport.uploadReport(s))})),this.netAgent.on("requestEvent",(function(t,r,o){var s;e.logger.info("".concat(D.RTM_CREATENETAGENT," request")),"start"===r?(s=p(),e.dataReport.newReport(s,J.kZegoRequest.event),e.stateCenter.requestList[t]=s):"end"===r&&(s=e.stateCenter.requestList[t])&&(e.dataReport.addMsgInfo(s,{na_req_location:J.kZegoRequest.na_req_location(o.na_req_location),http_code:o.status_code}),e.dataReport.uploadReport(s))})),this.netAgent.on("disConnectedEvent",(function(t){var r=t.duration,o=t.server,s=(t=t.connectid,e.logger.info("".concat(D.RTM_CREATENETAGENT," disconnect")),p());e.dataReport.newReport(s,J.kZegoConnDisConnect.event),e.dataReport.addMsgInfo(s,{server:J.kZegoConnDisConnect.server(o),connect_duration:r,connect_id:t}),e.dataReport.uploadReport(s)})),(null!=(t=this.options)&&t.accessDomains&&0<(null==(t=this.options)?void 0:t.accessDomains.length)?null==(t=this.options)?void 0:t.accessDomains:Z).map((function(e){return"wss://".concat(e,"/accesshub")})));this.netAgent.setNetAgentDefaultServers(t),this.dispatchServers=this.getDispatchUrl(),this.netAgent.setDispatchConnectServers(this.dispatchServers)},Ie.prototype.getDispatchUrl=function(){var e=localStorage.getItem("z_net_access_servers_"+this.stateCenter.appid+"_"+(this.stateCenter.mode||G));if(!e)return[];if(e=k.decryptStores(e,x))try{return JSON.parse(e)}catch(e){return[]}return[]},Ie.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i),r=k.getBrowser(),o=t?"pagehide":"Firefox"===r?"beforeunload":"unload";window.addEventListener(o,(function(){e.logger.info(D.RTM_BIND_WINDOW_LISTENER+" "+o),e.logoutRoom()})),window.addEventListener("offline",(function(){e.netOffLineHandle()})),window.addEventListener("online",(function(){e.netOnLineHandle()}))},Ie.prototype.bindWxListener=function(){var e=this;wx.onNetworkStatusChange((function(t){t.isConnected?e.netOnLineHandle():e.netOffLineHandle()}))},Ie.prototype.retryRoom=function(){var e=this;this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.netAgent.isConnect()&&(t.resetSessionInfo(),t.roomTryHandler.active(!0))}))},Ie.prototype.netOnLineHandle=function(){var e=this;this.logger.info(D.RTM_BIND_WINDOW_LISTENER+" network is online"),this.stateCenter.networkState=s.online,this.stateCenter.useNetAgent||this.stateCenter.roomModulesList.forEach((function(t){t.roomTryHandler&&e.service.isDisConnect()?t.roomTryHandler.active():t.roomTryHandler&&(t.roomTryHandler.stopMaxTime(),t.roomHandler.roomStateHandle("CONNECTED",I.Reconnected,{code:0,msg:""}))}))},Ie.prototype.netOffLineHandle=function(){this.logger.info(D.RTM_BIND_WINDOW_LISTENER+" network is broken"),this.stateCenter.networkState=s.offline,this.stateCenter.useNetAgent||this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&(e.roomTryHandler.invalid(),e.roomTryHandler.onactive=function(t,r){e.roomHandler.disconnectedHandle(r)},e.roomTryHandler.startMaxTime(),e.roomHandler.roomStateHandle("CONNECTING",I.Reconnecting,M.NETWORK_BROKEN))}))},Ie.prototype.setLogConfig=function(e){this.logger.info(D.RTM_SET_LOG_CONFIG+" call");var t=p();if(this.dataReport.newReport(t),e.logLevel&&["debug","info","warn","error","report","disable"].includes(e.logLevel)&&(this.logger.setLogLevel(e.logLevel),this.dataReport.addMsgInfo(t,{log_level:J.kZegoTaskSetLog.log_level(e.logLevel)})),e.remoteLogLevel&&["debug","info","warn","error","report","disable"].includes(e.remoteLogLevel)&&this.dataReport.addMsgInfo(t,{remote_log_level:J.kZegoTaskSetLog.remote_log_level(e.remoteLogLevel)}),"string"==typeof e.logURL&&(e.logURL.startsWith("wss://")||e.logURL.startsWith("https://")))this.logger.setLogServer(e.logURL),this.dataReport.addMsgInfo(t,{log_url:J.kZegoTaskSetLog.log_url(e.logURL)}),this.dataReport.uploadReport(t,J.kZegoTaskSetLog.event);else if(e.logURL)return this.logger.error(D.RTM_SET_LOG_CONFIG+"log url must be a wss or https url"),this.dataReport.addMsgInfo(t,J.kZegoTaskSetLog.error.kInvalidParamError),this.dataReport.uploadReport(t,J.kZegoTaskSetLog.event),!1;return this.logger.info(D.RTM_SET_LOG_CONFIG+" call success"),!0},Ie.prototype.setDebugVerbose=function(e){var t=p();this.dataReport.newReport(t),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0,this.dataReport.addMsgInfo(t,{debug:J.kZegoTaskSetDebug.debug(e?"true":"false")})),this.dataReport.uploadReport(t,J.kZegoTaskSetDebug.event),this.logger.info(D.RTM_SET_DEBUG_VERBOSE+" call success")},Ie.prototype.setDebug=function(e){"string"==typeof e&&-1<e.indexOf("wss")?this.stateCenter.debug=k.isTestEnv(e):Array.isArray(e)&&0<e.length&&e.every((function(e){return"string"==typeof e&&-1<e.indexOf("wss")}))?this.stateCenter.debug=k.isTestEnv(e[0]):this.logger.info(D.RTM_CONSTRUCTOR+" server wrong"),this.stateCenter.testEnvironment=this.stateCenter.debug},Ie.prototype.renewToken=function(e,t){var r,o=this,s=p();if(this.dataReport.newReport(s),void 0!==t&&("string"!=typeof t||""==t))return this.logger.error(D.RTM_RENEWTOKEN+" roomID must be string and no empty"),!1;var i,n,a=this.getRoomModules(t)||this.stateCenter.roomModulesList[0];return a?"string"==typeof e&&a.roomTryHandler?(e===a.roomTryHandler.token?this.logger.info(D.RTM_RENEWTOKEN+" token has not changed"):this.stateCenter.configRoomAuth?(i=function(t){var r;null!=(r=a.roomTryHandler)&&r.renewLocalToken(e,null==(r=null==t?void 0:t.body)?void 0:r.token_remain_time),o.cloudSetting.setToken(e),o.stateCenter.configCheckToken=!0,o.logger.info(D.RTM_RENEWTOKEN+" "+JSON.stringify(t))},n=function(t){var r=null==(r=null==t?void 0:t.body)?void 0:r.err_code;!r||1000002014!==r&&2014!==r?o.logger.error(D.RTM_RENEWTOKEN+" "+JSON.stringify(t)):(o.stateCenter.configCheckToken=!1,null!=(r=a.roomTryHandler)&&r.renewLocalToken(e),o.cloudSetting.setToken(e),o.logger.warn(D.RTM_RENEWTOKEN+" "+JSON.stringify(t)))},this.stateCenter.useNetAgent?null!=(r=this.liveRoomHandler)&&r.renewToken({token:e},i,n,a):this.service.sendMessage("renew_token",{token:e},i,n,void 0,{sessionID:a.sessionID,roomID:t,roomSessionID:a.roomSessionID})):(null!=(r=a.roomTryHandler)&&r.renewLocalToken(e),this.cloudSetting.setToken(e)),this.dataReport.uploadReport(s,J.kZegoTaskReNewToken.event),!0):("string"!=typeof e||a.roomTryHandler?(this.logger.error(D.RTM_RENEWTOKEN+" token must be string and not empty"),this.dataReport.addMsgInfo(s,{error:J.kZegoTaskReNewToken.error.INPUT_PARAM.code,message:J.kZegoTaskReNewToken.error.INPUT_PARAM.msg+" param token error"})):(this.logger.error(D.RTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(s,{error:J.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:J.kZegoTaskReNewToken.error.NOT_LOGIN.msg})),this.dataReport.uploadReport(s,J.kZegoTaskReNewToken.event),!1):(this.logger.error(D.RTM_RENEWTOKEN+" calling must after loginRoom"),this.dataReport.addMsgInfo(s,{error:J.kZegoTaskReNewToken.error.NOT_LOGIN.code,message:J.kZegoTaskReNewToken.error.NOT_LOGIN.msg}),this.dataReport.uploadReport(s,J.kZegoTaskReNewToken.event),!1)},Ie.prototype.setCloudSettingURLs=function(e){var t=this;this.logger.info(D.RTM_SET_CLOUD_SETTING_URLS+" call "),Array.isArray(e)&&0<e.length&&e.every((function(e){return"string"==typeof e&&-1<e.indexOf("http")}))&&this.cloudSetting.init({product:H.product,appID:this.stateCenter.appid,urls:e,env:this.stateCenter.ENV,pollingNotify:function(e,r){t.logger.info(D.RTM_SET_CLOUD_SETTING_URLS," setting file changed "+e+" "+JSON.stringify(r)),t.stateCenter.actionListener("_cloudSettingNotify",e,r)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment,unify:this.stateCenter.useNetAgent,connection:this.netAgent})},Ie.prototype.loginRoom=function(e,t,r,i){var n=this;return this.logger.info(D.RTM_LOGIN_ROOM+" call by user "+(null==r?void 0:r.userID)+" "+e),new Promise((function(a,l){return Re(n,void 0,void 0,(function(){var n,u,c,h,g=this;return fe(this,(function(d){switch(d.label){case 0:return 1!==this.stateCenter.ENV?[3,2]:[4,new Promise((function(e){wx.getNetworkType({success:function(t){g.stateCenter.networkState="none"===t.networkType?s.offline:s.online,e()},fail:function(t){g.logger.error(D.RTM_CONSTRUCTOR+" network "+JSON.stringify(t)),g.stateCenter.networkState=s.online,e()}})}))];case 1:d.sent(),d.label=2;case 2:return n=this.loginReport(a,l,t,i),c=n.interResolve,n=n.interReject,(i=i||{}).maxMemberCount||(i.maxMemberCount=0),this.netAgent&&(this.stateCenter.idName=r.userID,this.netAgent.setUserInfo(r.userID),this.stateCenter.actionListener("_roomLogin",e,t),this.netAgent.isConnect()&&this.fetchAppConfig(t)),this.cloudSetting.setUserID(r.userID),this.cloudSetting.setToken(t),this.cloudSetting.activePolling(),this.stateCenter.onListener("roomLoginResponse",(function(e){g.stateCenter.settingFetched||(g.getCloudSetting(),g.stateCenter.actionListener("_settingCanFetch"),g.stateCenter.settingFetched=!0)})),u=this.getRoomModules(e),h=J.kZegoTaskLoginRoom.error,u?(this.logger.setSessionInfo(this.stateCenter.appid,e,"",r.userID,"",this.stateCenter.sdKVersion),n(h.REPEATEDLY_LOGIN),[2]):((u=new le(e,this.stateCenter,this.logger,this.dataReport,this.service,this,this.liveRoomHandler)).roomTryHandler||(u.roomTryHandler=new V(this.logger,this.stateCenter,u)),u.roomTryHandler.init(this.stateCenter.roomRetryTime),u.roomTryHandler.initRoom(u.roomHandler,e,t,r,this.stateCenter.server,this.stateCenter.serverBak,i),u.roomTryHandler.setLoginRoomCallback(c,n),u.roomHandler.roomStateHandle("CONNECTING",I.Logining,{code:0,msg:""}),(c=function(e,t){var r,o,s=[],i={};for(r in e)i[e[r].order]=e[r],e[r].key=r;for(o in i)s.push(i[o]);for(var n=0;n<s.length;n++)for(var a=s[n].rules,l=0;l<a.length;l++){var u={key:s[n].key,value:s[n].value,action:t.action,logger:t.logger},c=u.value,h=a[l].name?""+a[l].name:"";if((void 0===c&&h===Y.NOT_EMPTY||void 0!==c)&&X[h]&&(h=X[h](u.key,c,u.action,u.logger,a[l]))!=K)return h}return K}({roomID:{order:0,value:e,rules:[{name:Y.NOT_EMPTY,error:h.ROOM_ID_NULL},{name:Y.TYPE_STRING,error:h.INPUT_PARAM,extMsg:"roomID must be string"},{name:Y.MAX_LENGTH_128,error:h.ROOM_ID_TOO_LONG},{name:Y.ILLEGAL_CHARACTERS,error:h.ROOM_ID_INVALID_CHARACTER}]},token:{order:1,value:t,rules:[{name:Y.NOT_EMPTY,error:h.INPUT_PARAM},{name:Y.TYPE_STRING,error:h.INPUT_PARAM}]},user:{order:2,value:r,rules:[{name:Y.NOT_EMPTY,error:h.INPUT_PARAM,extMsg:" param user error."},{name:Y.TYPE_OBJECT,error:h.INPUT_PARAM,extMsg:" param user error."}]},"user.userID":{order:3,value:r.userID,rules:[{name:Y.NOT_EMPTY,error:h.USER_ID_NULL,extMsg:" param user error."},{name:Y.TYPE_STRING,error:h.INPUT_PARAM,extMsg:" param userID error."},{name:Y.MAX_LENGTH_64,error:h.USER_ID_TOO_LONG},{name:Y.ILLEGAL_CHARACTERS,error:h.USER_ID_INVALID_CHARACTER}]},"user.userName":{order:4,value:r.userName,rules:[{name:Y.TYPE_STRING,error:h.INPUT_PARAM,extMsg:" userName must be string."},{name:Y.MAX_LENGTH_256,error:h.USER_NAME_TOO_LONG}]},config:{order:5,value:i,rules:[]},"config.maxMemberCount":{order:6,value:i.maxMemberCount,rules:[{name:Y.TYPE_INTEGER,error:h.INPUT_PARAM,extMsg:" maxMemberCount must be integer number."}]}},{action:D.RTM_LOGIN_ROOM,logger:this.logger}))!==K?(u.roomHandler.roomStateHandle("DISCONNECTED",I.LoginFailed,c.error,c.extMsg),n(c.error,c.extMsg),[2]):(0<this.stateCenter.roomModulesList.length&&1==this.stateCenter.isMultiRoom?u.isMulti=!0:Se([],this.stateCenter.roomModulesList,!0).forEach((function(e){return e.roomHandler.logout()})),i&&(u.config=i),this.stateCenter.roomModulesList.push(u),h=this.stateCenter.settingConfig.getSetting("room_server",!0),Array.isArray(h)&&0<h.length&&(this.logger.info(D.RTM_LOGIN_ROOM," setting room_server "+h),this.stateCenter.server=h[0],this.stateCenter.serverBak=h[1]||h[0]),this.stateCenter.setMultiRoom=!0,u.roomTryHandler.startMaxTime(),this.stateCenter.useNetAgent&&!this.netAgent.isConnect()?(this.logger.info(D.RTM_LOGIN_ROOM," us is not connected"),u.roomHandler.setRunState(o.trylogin),this.netAgent.connectUa()):u.roomTryHandler.active(!0),[2]))}}))}))}))},Ie.prototype.handleLogUpload=function(){var e=this.stateCenter.appConfig.app_config.domain;e&&(this.stateCenter.logDomain="weblogger".concat(this.stateCenter.appid,"-api.").concat(e),e="",e=0===this.stateCenter.ENV?"wss://".concat(this.stateCenter.logDomain,"/log"):"https://".concat(this.stateCenter.logDomain,"/httplog"),this.logger.setLogServer(e))},Ie.prototype.fetchAppConfig=function(e){return Re(this,void 0,void 0,(function(){var t,r,o,s,i;return fe(this,(function(n){switch(n.label){case 0:if(this.stateCenter.appConfigFetched)return this.logger.warn(D.RTM_FETCH_APP_CONFIG+" config fetched"),[2];if(!this.getUserID())return this.logger.warn(D.RTM_FETCH_APP_CONFIG+" user not exist"),[2];if(t="",e)t=e;else{if(!(0<this.stateCenter.roomModulesList.length))return this.logger.warn(D.RTM_FETCH_APP_CONFIG+" token not exist"),[2];t=this.getToken()}r=p(),this.dataReport.newReport(r,J.kZegoSDKConfigInit.event),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.netAgent.getAppConfigByAgent("init",t,5e3)];case 2:return i=n.sent(),o=i.code,i=i.data,this.dataReport.addMsgInfo(r,{trigger_reason:"refresh"}),this.dataReport.uploadReport(r),this.stateCenter.appConfigFetched=!0,this.logger.info(D.RTM_LOGIN_ROOM+" initConfig code:"+o+" data: "+JSON.stringify(i)),this.stateCenter.appConfig={app_config:o=i.app_config,media_config:{publish_config:s=(i=i.media_config).publish_config,play_config:i=i.play_config}},o=JSON.stringify(this.stateCenter.appConfig),s=k.encryptStores(o,x),localStorage.setItem(B+"_"+this.getAppID()+"_"+(this.stateCenter.mode||G),s),this.handleLogUpload(),this.stateCenter.appConfig||this.stateCenter.actionListener("_appConfigRsp"),[3,4];case 3:return i=n.sent(),this.logger.error(D.RTM_LOGIN_ROOM+" fail "+JSON.stringify(i)),this.dataReport.addMsgInfo(r,{trigger_reason:"refresh"}),this.dataReport.uploadReport(r),[20012,20008].includes(null==i?void 0:i.code)&&this.stateCenter.roomModulesList.forEach((function(e){e.roomTryHandler&&e.roomTryHandler.loginFail(M.APPID_INVALID)})),[3,4];case 4:return[2]}}))}))},Ie.prototype.getCloudSetting=function(){var e=this;this.cloudSetting.fetchMultiSetting([w,"room"]).then((function(t){var r,o;e.logger.info(D.RTM_LOGIN_ROOM," settingConfig "+JSON.stringify(t)),t&&(e.stateCenter.settingConfig.setSetting(null==(t=null==t?void 0:t[w])?void 0:t.setting,["remote_log_level"]),(t=e.stateCenter.settingConfig.getSetting("remote_log_level",!0))&&(e.logger.info("".concat(D.RTM_LOGIN_ROOM,"  setting remote_log_level ").concat(t)),e.logger.setRemoteLogLevel(t)),(t=e.stateCenter.settingConfig.getSetting("unify",e.stateCenter.netHasSet))&&(e.logger.info("".concat(D.RTM_LOGIN_ROOM," unify ").concat(JSON.stringify(t))),r=t.enable,t=t.sdk_conn_ver,o=!!(r&&t<=3),!0===e.stateCenter.useNetAgent&&!1===o&&(e.cloudSetting.setOptions({unify:!1}),"connecting"!==e.stateCenter.connectState&&(e.stateCenter.connectState="connecting",e.stateCenter.actionListener("_connectChanged","connecting")),r=Se([],e.stateCenter.roomModulesList,!0),Se([],e.stateCenter.roomModulesList,!0).forEach((function(e){e.roomHandler.logout(!0,!0)})),e.stateCenter.useNetAgent=o,r.forEach((function(t){var r;e.stateCenter.roomModulesList.push(t),t.roomTryHandler||(t.roomTryHandler=new V(e.logger,e.stateCenter,t)),t.roomTryHandler.init(e.stateCenter.roomRetryTime),t.roomTryHandler.initRoom(t.roomHandler,t.roomID,t.token,{userID:e.stateCenter.idName,userName:e.stateCenter.nickName},e.stateCenter.server,e.stateCenter.serverBak,t.config),null!=(r=t.roomTryHandler)&&r.startMaxTime(),t.roomTryHandler.onactive=function(r,o){r?"connected"!==e.stateCenter.connectState&&(e.stateCenter.connectState="connected",e.stateCenter.actionListener("_connectChanged","connected",{roomID:t.roomID})):t.roomHandler.disconnectedHandle(o)},null!=(r=t.roomTryHandler)&&r.active()})))))})).catch((function(t){e.logger.warn(D.RTM_LOGIN_ROOM," settingConfig "+JSON.stringify(t))})),this.stateCenter.onListener("_cloudSettingNotify",(function(t,r){var o=p(),s=(e.dataReport.newReport(o,J.kZegoTaskCloudSettingRefresh.event),e.cloudSetting.getEnvVariables());e.dataReport.addMsgInfo(o,{params:s,files:[{name:t,content:r.setting,versions:r.versions}]}),e.dataReport.uploadReport(o),t===w&&(e.stateCenter.settingConfig.setSetting(null==r?void 0:r.setting,["remote_log_level"]),(s=e.stateCenter.settingConfig.getSetting("remote_log_level"))&&(e.logger.info(D.RTM_LOGIN_ROOM," setting remote_log_level "+s),e.logger.setRemoteLogLevel(s)))}))},Ie.prototype.cloudReportNotify=function(e,t,r){var o;"request_start"===t?(o=p(),this.dataReport.newReport(o,J.kZegoTaskCloudSettingRequest.event),this.stateCenter.settingConfig.requestList[e]=o):"request_end"===t&&(o=this.stateCenter.settingConfig.requestList[e])&&(this.dataReport.addMsgInfo(o,{request_detail:null==r?void 0:r.reportData,files:null==r?void 0:r.files,error:null==r?void 0:r.code,request_params:null==r?void 0:r.params}),this.dataReport.uploadReport(o))},Ie.prototype.loginReport=function(e,t,r,o){var s=this,i=p(),n=(this.stateCenter.reportSeqList.login=i,J.kZegoTaskLoginRoom),a=(this.dataReport.newReport(i,n.event),this.cloudSetting.getEnvVariable("deviceid"));return this.dataReport.addMsgInfo(i,{deviceid:a,use_na:this.stateCenter.useNetAgent?1:0}),"string"==typeof r&&this.dataReport.addMsgInfo(i,{token:n.token(r),isMulti:this.stateCenter.isMultiRoom}),o&&(o.userUpdate&&"boolean"==typeof o.userUpdate&&this.dataReport.addMsgInfo(i,{user_update:n.user_update(o.userUpdate+"")}),o.maxMemberCount&&"number"==typeof o.maxMemberCount&&this.dataReport.addMsgInfo(i,{max_member_count:n.max_member_count(o.maxMemberCount+"")})),k.logReportCallback(n.event,this.dataReport,i,this.stateCenter.reportList),{interResolve:function(t){s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,k.unregisterCallback(n.event,s.stateCenter.reportList),e(t)},interReject:function(e,r){var o,a;void 0===r&&(r=""),e.code<2e9&&1e9<e.code||e.code<1e6?(o=k.decodeServerError(e.code,e.msg),a=k.getLiveRoomError(e.code,s.stateCenter.useNetAgent)):o={code:e.code,message:e.msg},o&&s.dataReport.addMsgInfo(i,{error:o.code,message:o.message+r}),s.dataReport.uploadReport(i),s.stateCenter.reportSeqList.login=0,k.unregisterCallback(n.event,s.stateCenter.reportList),a&&M[a]&&(e.code=M[a].code),t(e.code&&e.msg&&""!==r?{code:e.code,msg:e.msg+r}:e)}}},Ie.prototype.logoutRoom=function(e){this.logger.info(D.RTM_LOGOUT_ROOM+" call by user "+e);var t=p();if(this.dataReport.newReport(t),this.dataReport.addMsgInfo(t,{roomid:e,isMulti:this.stateCenter.isMultiRoom}),void 0===e)Se([],this.stateCenter.roomModulesList,!0).forEach((function(e){return e.roomHandler.logout(!0)})),this.cloudSetting.uninit();else{if("string"!=typeof e||""==e)return this.logger.error(D.RTM_LOGOUT_ROOM+" roomID must be string and not empty"),this.dataReport.addMsgInfo(t,{error:J.kZegoTaskLogoutRoom.error.INPUT_PARAM.code,message:J.kZegoTaskLogoutRoom.error.INPUT_PARAM.msg+" param roomID error"}),void this.dataReport.uploadReport(t,J.kZegoTaskLogoutRoom.event);(e=this.getRoomModules(e))?(e.roomHandler.logout(),0===this.stateCenter.roomModulesList.length&&this.cloudSetting.uninit()):(this.logger.error(D.RTM_LOGOUT_ROOM+" room not exist"),this.dataReport.addMsgInfo(t,{error:J.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.code,message:J.kZegoTaskLogoutRoom.error.ROOM_NOT_EXIST.msg})),this.dataReport.uploadReport(t,J.kZegoTaskLogoutRoom.event)}},Ie.prototype.loginHall=function(e,t,r){var o=this;return new Promise((function(e,t){return Re(o,void 0,void 0,(function(){return fe(this,(function(e){return[2]}))}))}))},Ie.prototype.loginHallReport=function(e,t,r,o){},Ie.prototype.logoutHall=function(){},Ie.prototype.enterRoom=function(e,t){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype.leaveRoom=function(){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype.sendCustomCommand=function(e,t,r){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype._sendCustomCommand=function(e,t,r){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype.sendBroadcastMessage=function(e,t){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype._sendBroadcastMessage=function(e,t,r,o){return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(e,t){console.error(L),t()}))},Ie.prototype.setRoomExtraInfo=function(e,t,r){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype._setRoomExtraInfo=function(e,t,r){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype.sendBarrageMessage=function(e,t){return new Promise((function(e,t){console.error(L),t()}))},Ie.prototype._sendBarrageMessage=function(e,t,r,o){return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(e,t){console.error(L),t()}))},Ie.prototype.sendRelayMessage=function(e,t,r,o,s){console.error(L)},Ie.prototype.requestJoinLive=function(e,t,r,o,s){return console.error(L),!1},Ie.prototype.inviteJoinLive=function(e,t,r,o,s){return console.error(L),!1},Ie.prototype.endJoinLive=function(e,t,r,o){return console.error(L),!1},Ie.prototype.respondJoinLive=function(e,t,r,o,s){return console.error(L),!1},Ie.prototype.getVersion=function(){return this.version},Ie.prototype.setSdkBizVersion=function(e){"string"==typeof e&&""!==e&&(this.stateCenter.bizVersion=e)},Ie.prototype.on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(D.RTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(D.RTM_ON+" event "+e+" no found"),!1)},Ie.prototype.off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(D.RTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},Ie.prototype._on=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error(D.RTM_ON+" listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(D.RTM_ON+" event "+e+" no found"),!1)},Ie.prototype._off=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error(D.RTM_OFF+" listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},Ie.prototype.isTestEnvironment=function(){return this.stateCenter.testEnvironment},Ie.prototype.isLogin=function(e){return!!(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])&&e.isLogin()},Ie.prototype.getMultiRoom=function(){return this.stateCenter.isMultiRoom},Ie.prototype.getAppID=function(){return this.stateCenter.appid},Ie.prototype.getUserID=function(){return this.stateCenter.idName},Ie.prototype.getUseNetAgent=function(){return this.stateCenter.useNetAgent},Ie.prototype.getToken=function(e){return(this.getRoomModules(e)||this.stateCenter.roomModulesList[0]).token},Ie.prototype.setRoomCreateFlag=function(e){this.stateCenter.roomCreateFlag=e},Ie.prototype.setRole=function(e){this.stateCenter.role=e},Ie.prototype.getSessionId=function(e){return(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])?e.sessionID:"0"},Ie.prototype.getRoomSessionID=function(e){return(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])?e.roomSessionID:"0"},Ie.prototype.getAppConfig=function(){return this.stateCenter.appConfig},Ie.prototype.setAccess=function(e){this.stateCenter.netHasSet=!0,this.stateCenter.useNetAgent=e,this.stateCenter.useNetAgent=this.getSettingUnify(!0),this.netAgent.setAccess(this.stateCenter.useNetAgent),this.cloudSetting.setOptions({unify:this.stateCenter.useNetAgent})},Ie.prototype.enableMultiRoom=function(e){var t=p();return this.dataReport.newReport(t,J.kZegoEnableMultiRoom.event),this.dataReport.addMsgInfo(t,{isMulti:e}),"boolean"!=typeof e?(this.logger.error(D.RTM_ENABLE_MULTI_ROOM+" param must be boolean"),this.dataReport.uploadReport(t,void 0,J.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):0<this.stateCenter.roomModulesList.length||this.stateCenter.setMultiRoom?(this.logger.error(D.RTM_ENABLE_MULTI_ROOM+" multi room can only be set once before first login"),this.dataReport.uploadReport(t,void 0,J.kZegoEnableMultiRoom.error.kAlreadyLoginError),!1):(this.dataReport.uploadReport(t),this.stateCenter.isMultiRoom=e,this.stateCenter.setMultiRoom=!0)},Ie.prototype.getRoomModules=function(e){return this.stateCenter.roomModulesList.find((function(t){return t.roomID==e}))},Ie.use=function(e){switch(e.type){case"message":case"live":e.install(Ie,le,de,me)}},Ie.prototype.resetRoomTokenTimer=function(e,t){(e=this.getRoomModules(e)||this.stateCenter.roomModulesList[0])&&t&&0<t&&e.roomHandler.resetTokenTimer(1e3*t-this.stateCenter.local_time_deviation)},Ie.prototype.isDisConnect=function(){return(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).isDisConnect()},Ie.prototype.sendMessage=function(e,t,r,o){(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendMessage(e,t,r,o)},Ie.prototype.setProtoFormat=function(e){if(!["json","pb"].includes(e=void 0===e?"json":e))throw new Error("Failed to execute 'setProtoFormat': Arguments 'format' must be 'json' or 'pb'.");this.stateCenter.protoFormat=e},Ie.prototype.setSdkLoginRelateService=function(e){Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))&&(this.stateCenter.relateService=e)},Ie.prototype.sendMessageByService=function(e,t,r,o,s,i){return this.service.sendMessage(e,t,r,o,s,i)},Ie.prototype.getHeader=function(e){var t=this.stateCenter.roomModulesList[0];if(t&&t.isLogin())return this.service.getHeader(e,t.sessionID,t.roomID,t=t.roomSessionID);this.logger.error(D.RTM_GET_HEADER+" room no found or no login")},Ie.prototype.sendPB=function(e){return e instanceof Uint8Array?this.service.sendPB(e):(this.logger.error(D.RTM_SEND_PB+" type error"),!1)},Ie.prototype.onPushBizChannel=function(e){e&&this.service.on("push_biz_channel",e)},Ie.prototype.getRoomID=function(){return this.stateCenter.roomid},Ie.prototype.getServerTimeOffset=function(){return this.stateCenter.serverTimeOffset},Ie.prototype.isUseNetAgent=function(){return this.stateCenter.useNetAgent},Ie.prototype.getReqHead=function(e){return e="string"==typeof e&&""!==e&&this.getRoomModules(e)||this.stateCenter.roomModulesList[0],this.liveRoomHandler.getReqHead(e)},Ie.prototype.sendSwitchMessage=function(e,t){return"string"==typeof e&&t?this.liveRoomHandler.sendMessage(e,t,void 0,void 0,void 0,!1):-1},Ie.prototype.onSwitchMessage=function(e){e&&this.liveRoomHandler&&(this.liveRoomHandler.onSwitchMessage=e)},Ie);function Ie(e,t,r,o,i,n,a,l){var u=this;if(this.logger=r,this.dataReport=o,this.cloudSetting=i,this.version=n,this.options=l,this.stateCenter=new $(this.logger,this.dataReport),this.stateCenter.ENV=a,this.getReportSeq=p,this.getSeq=_,this.initCallback(),r=p(),this.dataReport.newReport(r),0!=a&&1!=a||this.setDebug(t),k.checkConfigParam(e,t,this.logger)){if(this.stateCenter.appid=e,this.stateCenter.configOK=!0,this.stateCenter.sdKVersion=this.version,this.netAgent=new y,this.logger.setSessionInfo(this.stateCenter.appid,"","","","",this.version),this.netAgent.init(),this.netAgent.setLogger(this.logger),this.netAgent.setAppInfo({appID:this.stateCenter.appid,env:this.stateCenter.ENV,mode:this.stateCenter.mode}),this.liveRoomHandler=new me(this.logger,this.stateCenter,this.netAgent,this.dataReport,this),this.service=new de(this.stateCenter,this.logger,this),this.stateCenter.deviceID=k.generateUUID(a),this.stateCenter.settingConfig=new pe,this.cloudSetting.setLog(this.logger),this.cloudSetting.init({product:H.product,appID:e,urls:H.URL,env:a,pollingNotify:function(e,t){u.logger.info(D.RTM_CONSTRUCTOR," setting file changed "+e+" "+JSON.stringify(t)),u.stateCenter.actionListener("_cloudSettingNotify",e,t)},reportNotify:this.cloudReportNotify.bind(this),online:!this.stateCenter.testEnvironment,unify:this.stateCenter.useNetAgent,connection:this.netAgent}),(o=this.stateCenter.settingConfig.getSetting("remote_log_level"))&&(this.logger.info("".concat(D.RTM_CONSTRUCTOR," setting remote_log_level default ").concat(o)),this.logger.setRemoteLogLevel(o)),i="",0===a?i="rtc":1===a&&(i="xcx"),this.cloudSetting.setEnvVariable("environment",i),this.stateCenter.useNetAgent=!1,"string"==typeof t?(this.stateCenter.server=t,this.stateCenter.serverBak=t):Array.isArray(t)&&0<t.length&&(this.stateCenter.server=t[0],this.stateCenter.serverBak=t[1]||t[0]),0==a||2==a)this.bindWindowListener(),this.logger.info("".concat(D.RTM_CONSTRUCTOR,"  ").concat(navigator.appVersion)),this.stateCenter.networkState=!navigator||navigator.onLine?s.online:s.offline,this.dataReport.addMsgInfo(r,{system_info:J.kZegoTaskInitSetting.system_info});else if(1==a||3==a){this.bindWxListener();try{var c=wx.getSystemInfoSync(),h={brand:c.brand,model:c.model,system:c.system,platform:c.platform,version:c.version,SDKVersion:c.SDKVersion};this.dataReport.addMsgInfo(r,{system_info:h}),this.logger.warn(D.RTM_CONSTRUCTOR+" "+JSON.stringify(h))}catch(e){this.logger.warn(D.RTM_CONSTRUCTOR+" get system info error")}}}else this.logger.error("".concat(D.RTM_CONSTRUCTOR," init sdk error")),this.dataReport.addMsgInfo(r,J.kZegoTaskInitSetting.error.kInvalidParamError);this.dataReport.uploadReport(r,J.kZegoTaskInitSetting.event)}ye.prototype.setLog=function(e){},ye.prototype.init=function(e){},ye.prototype.setEnvVariable=function(e,t){},ye.prototype.fetchSetting=function(e,t,r){return Promise.resolve()},ye.prototype.fetchMultiSetting=function(e,t,r){return Promise.resolve()},ye.prototype.setOptions=function(e){},ye.prototype.getSettingCache=function(e){return Promise.resolve()},ye.prototype.setToken=function(e){},ye.prototype.setUserID=function(e){},ye.prototype.activePolling=function(){},ye.prototype.uninit=function(){},ye.prototype.getEnvVariable=function(e){};var Le=ye;function ye(){this.isLoad=!1,this.callBackList=[]}Me.prototype.enableMultiRoom=function(e){return this.zegoWebRTM.enableMultiRoom(e)},Me.prototype.loginRoom=function(e,t,r,o){return this.zegoWebRTM.loginRoom(e,t,r,o)},Me.prototype.logoutRoom=function(e){return this.zegoWebRTM.logoutRoom(e)},Me.prototype.renewToken=function(e,t){return this.zegoWebRTM.renewToken(e,t)},Me.prototype.sendBarrageMessage=function(e,t){return this.zegoWebRTM.sendBarrageMessage(e,t)},Me.prototype.sendBroadcastMessage=function(e,t){return this.zegoWebRTM.sendBroadcastMessage(e,t)},Me.prototype.sendCustomCommand=function(e,t,r){return this.zegoWebRTM.sendCustomCommand(e,t,r)},Me.prototype.setRoomExtraInfo=function(e,t,r){return this.zegoWebRTM.setRoomExtraInfo(e,t,r)},Me.prototype.setLogConfig=function(e){return this.zegoWebRTM.setLogConfig(e)},Me.prototype.setDebugVerbose=function(e){return this.zegoWebRTM.setDebugVerbose(e)},Me.prototype.on=function(e,t){return this.zegoWebRTM.on(e,t)},Me.prototype.getVersion=function(){return this.zegoWebRTM.getVersion()},Me.prototype.off=function(e,t){return this.zegoWebRTM.off(e,t)},Me.prototype.loginHall=function(e,t,r){return this.zegoWebRTM.loginHall(e,t,r)},Me.prototype.logoutHall=function(){return this.zegoWebRTM.logoutHall()},Me.prototype.enterRoom=function(e,t){return this.zegoWebRTM.enterRoom(e,t)},Me.prototype.leaveRoom=function(){return this.zegoWebRTM.leaveRoom()},Me.use=function(e){Ce.use(e)},Me.version="1.16.2";var ve=Me;function Me(e,t,r,o){this.logger=new a.ZegoLogger(r=void 0===r?0:r),this.dataReport=new a.ZegoDataReport(this.logger),this.cloudSetting=new Le,this.zegoWebRTM=new Ce(e,t,this.logger,this.dataReport,this.cloudSetting,Me.version,r,o)}}],r={},e.m=t,e.c=r,e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:o})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var s in t)e.d(o,s,function(e){return t[e]}.bind(null,s));return o},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=13);function e(o){if(r[o])return r[o].exports;var s=r[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var t,r}()},126:function(e){"undefined"!=typeof self&&self,e.exports=function(){return t={14:function(e,t,r){"use strict";function o(e){return e}r.r(t),(l=s=s||{}).RTM_SEND_CUSTOM="zm.scc",l.RTM_SEND_BCM="zm.sbcm",l.RTM_SEND_RLM="zm.srlm",l.RTM_SEND_BRM="zm.sbrm",l.RTM_SEND_RAM="zm.sram",l.MESSAGE_SEND_RELIABLE="zm.msg.sdr",l.MESSAGE_FETCH_RELIABLE="zm.msg.frm",l.MESSAGE_RELIABLE_RSP="zm.msg.rlr",l.MESSAGE_RELIABLE_PUSH="zm.msg.rps",l.MESSAGE_SEND_ROOM_MSG="zm.msg.srm",l.MESSAGE_SEND_CUSTOM_MSG="zm.msg.scm",l.MESSAGE_SEND_BIG_MSG="zm.msg.sbm",l.MESSAGE_BIG_MSG_PUSH="zm.msg.bps",l.MESSAGE_SEND_RELAY_MSG="zm.msg.slm",l.SERVICE_PUSH="zm.sv.ps";var s,i={INPUT_PARAM:{code:1100001,msg:"input parm error."},TIMEOUT:{code:1100002,msg:"network timeout."},NOT_LOGIN:{code:1000002,msg:"not login"},IM_CONTENT_NULL:{code:1009001,msg:"message content is empty"},IM_CONTENT_TOO_LONG:{code:1009002,msg:"message content is too long"},IM_SEND_FAILED:{code:1009010,msg:"failed to send message"},ROOM_NOT_EXIST:{code:1002014,msg:"room not exist"},ROOM_INNER_ERROR:{code:1002099,msg:"room inner error"},TRANS_FREQUENTLY:{code:1102022,msg:"trans send frequently"},FREQ_LIMITED:{code:1109001,msg:"frequency limited."}},n={kZegoTaskLiveSendRoomBigIM:{event:"/liveroom/send_big_room_message",room_sid:o,error:{INPUT_PARAM:i.INPUT_PARAM,IM_CONTENT_NULL:i.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:i.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:i.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendCustomCommand:{event:"/liveroom/send_custom_command",room_sid:o,error:{INPUT_PARAM:i.INPUT_PARAM,IM_CONTENT_NULL:i.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:i.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:i.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendRoomMessage:{event:"/liveroom/send_room_message",room_sid:o,error:{INPUT_PARAM:i.INPUT_PARAM,IM_CONTENT_NULL:i.IM_CONTENT_NULL,IM_CONTENT_TOO_LONG:i.IM_CONTENT_TOO_LONG,ROOM_NOT_EXIST:i.ROOM_NOT_EXIST}},kZegoTaskLiveRoomSendReliableMessage:{event:"/liveroom/send_reliable_message",room_sid:o,error:{INPUT_PARAM:i.INPUT_PARAM,TRANS_FREQUENTLY:i.TRANS_FREQUENTLY,ROOM_NOT_EXIST:i.ROOM_NOT_EXIST}},kZegoTaskLiveGetRoomBigIM:{event:"/liveroom/get_big_room_message"},kZegoTaskLiveRoomGetRoomMessage:{event:"/liveroom/get_room_message",room_sid:o},kZegoTaskLiveRoomGetCustomCommand:{event:"/liveroom/get_custom_command"}},a=1024,l=r(3),u=r.n(l),c=(h.prototype.loginRsp=function(e){var t,r=this;if(null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp&&(t=parseFloat(e.body.ret_timestamp),this.serverTimeOffset=0==t?0:e.body.ret_timestamp-(new Date).getTime()),e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.datiTimeWindow=e.body.dati_time_window),e.body.trans_seqs)for(var o=0;o<e.body.trans_seqs.length;o++){var s=e.body.trans_seqs[o].trans_channel,i=e.body.trans_seqs[o].trans_seq_array;0<(i=(i=i.filter((function(e){var t=e.trans_type;return e=e.trans_seq,!r.transSeqMap[t]||r.transSeqMap[t].seq<e}))).map((function(e){return{trans_type:e.trans_type,trans_local_seq:e.trans_seq}}))).length&&this.fetchReliableMessage(s,i)}},h.prototype.sendReliableMessage=function(e,t,r,o){var a=this;return this.logger.info(s.MESSAGE_SEND_RELIABLE+" call"),this.room.isLogin()?this.isReliable?(this.logger.error(s.MESSAGE_SEND_RELIABLE+" send too often"),void o(n.kZegoTaskLiveRoomSendReliableMessage.error.TRANS_FREQUENTLY)):(this.transSeqMap[e]||(this.transSeqMap[e]={seq:0}),t={trans_type:e,trans_data:t,trans_local_seq:this.transSeqMap[e].seq,trans_channel:"clt"},this.isReliable=!0,void(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendReliableMessage(t,(function(t){a.transSeqMap[e].seq=t.body.trans_seq,a.logger.info(s.MESSAGE_SEND_RELIABLE+" trans "+e+" seq "+t.body.trans_seq),a.isReliable=!1,r({seq:t.header.seq,errorCode:0})}),(function(e){var t=i.ROOM_INNER_ERROR;e.body&&e.body.err_code?(t=a.rtm.getServerError(e.body.err_code),a.logger.error(s.MESSAGE_SEND_ROOM_MSG+"  "+t.msg)):t=e,a.isReliable=!1,o(t)}),this.room)):(this.logger.error(s.MESSAGE_SEND_RELIABLE+" state error"),void(o&&o(i.NOT_LOGIN)))},h.prototype.fetchReliableMessage=function(e,t){function r(e){o.handleFetchTransRsp(e)}var o=this;(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).fetchReliableMessage({trans_channel:e,fetch_array:t},r,r,this.room),this.logger.info(s.MESSAGE_FETCH_RELIABLE+" call success")},h.prototype.handleFetchTransRsp=function(e){if(e.body&&0!=e.body.err_code)this.logger.error(s.MESSAGE_RELIABLE_RSP+" trans send error "+e.body.err_code);else if(e.header&&e.body){var t=e.body.trans_fetch_results,r=[];if(Array.isArray(t)&&0<t.length){for(var o=0;o<t.length;o++){var i,n,a=t[o];1000001109===a.err_code?this.logger.warn(s.MESSAGE_RELIABLE_RSP+" fetch trans unknown type "+a.err_code):(i=a.trans_type,n=a.trans_seq,1000001110===a.err_code?(this.logger.warn(s.MESSAGE_RELIABLE_RSP+" fetch trans seq is wrong "+a.err_code),this.transSeqMap[i]={seq:n}):!this.transSeqMap[i]||this.transSeqMap[i].seq<n?(this.transSeqMap[i]={seq:n},r.push(a)):this.logger.warn(s.MESSAGE_RELIABLE_RSP+" fetch trans seq wrong"))}0<r.length&&this.onRecvReliableMessage(r)}}else this.logger.error(s.MESSAGE_RELIABLE_RSP+" trans send error "+e)},h.prototype.handlePushTransMsg=function(e){var t=e.body.trans_type,r=e.body.trans_seq;!this.transSeqMap[t]||this.transSeqMap[t].seq<r?(this.transSeqMap[t]={seq:r},this.onRecvReliableMessage([e.body])):this.logger.warn(s.MESSAGE_RELIABLE_PUSH+" trans seq wrong"),this.logger.info(s.MESSAGE_RELIABLE_PUSH+" trans "+t+" seq "+r)},h.prototype.sendRoomMsg=function(e,t,r,o,n,a){var l=this;if(!this.room.isLogin())return this.logger.error(s.MESSAGE_SEND_ROOM_MSG+" state error"),a(i.NOT_LOGIN),!1;var u=Date.parse(new Date+"");return 0<this.sendRoomMsgTime&&this.sendRoomMsgTime+this.sendRoomMsgInterval>u?(this.logger.info(s.MESSAGE_SEND_ROOM_MSG+" freq error"),a&&a(i.FREQ_LIMITED,0,e,o),!1):(this.sendRoomMsgTime=u,(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendRoomMsg({msg_category:e,msg_type:1,msg_priority:1,msg_content:o},(function(e){n({seq:e.header.seq,errorCode:0,messageID:e.body.msg_id})}),(function(e){var t,r,o=i.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(o=e),void a({seq:0,errorCode:o.code,messageID:0});r=(t=[l.rtm.getServerError(e.body.err_code),e.body.msg_id])[1],l.logger.error(s.MESSAGE_SEND_ROOM_MSG+"  "+(o=t[0]).msg),a({seq:e.header.seq,errorCode:(o=o==i.TIMEOUT?i.IM_SEND_FAILED:o).code,messageID:r})}),this.room),this.logger.info(s.MESSAGE_SEND_ROOM_MSG+"  call success"),!0)},h.prototype.handlePushRoomMsg=function(e){var t,r=this,o=this.stateCenter.useNetAgent?this.room.roomSessionID:e.header.session_id,s=this.rtm.getReportSeq(),i=(this.dataReport.newReport(s),this.dataReport.addMsgInfo(s,{room_sid:n.kZegoTaskLiveRoomGetRoomMessage.room_sid(o)}),[]);this.stateCenter.useNetAgent?(t=e.body.msg_data,e.body.msg_data.forEach((function(e){e={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time.toNumber(),messageID:e.msg_id.toNumber()},i.push(e)})),e.body.server_msg_id=e.body.server_msg_id.toNumber(),e.body.ret_msg_id=e.body.ret_msg_id.toNumber()):(t=e.body.chat_data,e.body.chat_data.forEach((function(e){i.push({fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}),r.dataReport.addMsgInfo(s,{from_msg_id:e.id_name})}))),this.dataReport.uploadReport(s,n.kZegoTaskLiveRoomGetRoomMessage.event),this.stateCenter.actionListener("IMRecvBroadcastMessage",this.room.roomID,i),this.stateCenter.actionListener("_recvRoomMsg",t,e.body.server_msg_id,e.body.ret_msg_id)},h.prototype.sendCustomCommand=function(e,t,r,o){var n=this;return this.room.isLogin()?(t={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.room.roomID},e={dest_id_name:e,custom_msg:JSON.stringify(t)},(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendCustomCommand(e,(function(e){r({seq:e.header.seq,errorCode:0})}),(function(e){var t=n.rtm.getServerError(e.body.err_code);n.logger.error(s.MESSAGE_SEND_CUSTOM_MSG+" "+t.msg),o({seq:e.header.seq,errorCode:(t==i.TIMEOUT?i.IM_SEND_FAILED:t).code})}),this.room),this.logger.info(s.MESSAGE_SEND_CUSTOM_MSG+" call success"),!0):(this.logger.error(s.MESSAGE_SEND_CUSTOM_MSG+" state error"),o(i.NOT_LOGIN),!1)},h.prototype.handlePushCustomMsg=function(e){var t=(e=[(e=JSON.parse(e.body.custommsg)).from_userid,e.from_username,e.room_id,e.custom_content])[0],r=e[1],o=e[2],s=(e=e[3],this.rtm.getReportSeq());this.dataReport.newReport(s),this.dataReport.uploadReport(s,n.kZegoTaskLiveRoomGetCustomCommand.event),this.stateCenter.actionListener("IMRecvCustomCommand",o,{userID:t,userName:r},e)},h.prototype.sendBigRoomMessage=function(e,t,r,o,n,a){var l=this;if(!this.room.isLogin())return this.logger.error(s.MESSAGE_SEND_BIG_MSG+" state error"),void(a&&a(i.NOT_LOGIN));var u=this.bigimTimeWindow,c=this.serverTimeOffset,h=(new Date).getTime()+c,g=this.rtm.getSeq().toString();this.bigImCallbackMap[g]={success:n,error:a},0==u?this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:g}],(function(e){l.handleBigImMsgRsp(e)}),(function(e){a&&a(e)})):(n=Math.floor(h/u),this.bigImLastTimeIndex<n&&0==this.bigIMmessageList.length?(this.bigImLastTimeIndex=n,this.sendBigRoomMessageInternal([{msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:g}],(function(e){l.handleBigImMsgRsp(e)}),(function(e){a&&a(e)}))):(this.bigIMmessageList.push({msg_category:e,msg_type:1,msg_content:o,bigmsg_client_id:g}),1==this.bigIMmessageList.length&&this.setBigImTimer(c,u)))},h.prototype.sendBigRoomMessageInternal=function(e,t,r){(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendBigRoomMessage({msgs:e},(function(e){t(e)}),(function(e){var t=i.ROOM_INNER_ERROR;e.header&&e.body||(e.code&&e.msg&&(t=e),r(t)),r(t)}),this.room),this.logger.info(s.MESSAGE_SEND_BIG_MSG+" sendBigRoomMessage called")},h.prototype.handleBigImMsgRsp=function(e){this.bigimTimeWindow=e.body.bigim_time_window;for(var t=0;t<e.body.msgs.length;t++){var r,o=e.body.msgs[t].bigmsg_client_id;this.bigImCallbackMap[o]&&(null!=(r=this.bigImCallbackMap[o].success)&&r({seq:e.header.seq,errorCode:0,messageID:e.body.msgs[t].bigmsg_id}),delete this.bigImCallbackMap[o])}},h.prototype.setBigImTimer=function(e,t){var r=this;e=t-((new Date).getTime()+e)%t,t=this.rtm.generateRandumNumber(t)+e,this.bigImTimer=setTimeout((function(){r.onBigImTimer()}),t)},h.prototype.onBigImTimer=function(){for(var e=this,t=(new Date).getTime()+this.serverTimeOffset,r=(this.bigImLastTimeIndex=Math.floor(t/this.bigimTimeWindow),[]),o=[],s=0;s<this.bigIMmessageList.length&&!(20<=s);s++){var i=this.bigIMmessageList[s];r.push({msg_category:i.msg_category,msg_type:i.msg_type,msg_content:i.msg_content,bigmsg_client_id:i.bigmsg_client_id}),o.push(i.bigmsg_client_id)}20<this.bigIMmessageList.length?this.bigIMmessageList.splice(0,20):this.bigIMmessageList=[],this.sendBigRoomMessageInternal(r,(function(t){e.handleBigImMsgRsp(t)}),(function(t,r){for(var s=0;s<o.length;s++){var i=o[s],n=e.bigImCallbackMap[i];n&&(null!=n.error&&n.error(t,r),delete e.bigImCallbackMap[i])}})),this.bigImTimer&&clearTimeout(this.bigImTimer),this.bigImTimer=null,0<this.bigIMmessageList.length&&this.setBigImTimer(this.serverTimeOffset,this.bigimTimeWindow)},h.prototype.handlePushMergeMsg=function(e){for(var t=0;t<e.body.messages.length;t++)14001!==e.body.messages[t].sub_cmd&&"/lr/push/bigim_chat"!==e.body.messages[t].sub_cmd||this.handlePushBigRooMsg(e.body.messages[t].msg_body)},h.prototype.handlePushBigRooMsg=function(e){var t;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){return void this.logger.warn(s.MESSAGE_BIG_MSG_PUSH+"parse json error")}else t=e;if(t){e=t.room_id;for(var r=[],o=0;o<t.msg_data.length;o++){var i=t.msg_data[o];i.id_name==this.stateCenter.idName?this.logger.info(s.MESSAGE_BIG_MSG_PUSH+" self message"):r.push({idName:i.id_name,nickName:i.nick_name,messageId:i.bigmsg_id,category:i.msg_category,type:i.msg_type,content:i.msg_content,time:i.send_time||u.a.isLong(i.msg_timestamp)&&i.msg_timestamp.toNumber()})}0==r.length?this.logger.info(s.MESSAGE_BIG_MSG_PUSH+" no other pushData except self"):this.onRecvBigRoomMessage(r,e),this.logger.info(s.MESSAGE_BIG_MSG_PUSH+"call success")}else this.logger.warn(s.MESSAGE_BIG_MSG_PUSH+" cann't find message body")},h.prototype.onRecvBigRoomMessage=function(e,t){var r=this.rtm.getReportSeq(),o=(this.dataReport.newReport(r),[]);e.forEach((function(e){o.push(e={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId})})),this.dataReport.uploadReport(r,n.kZegoTaskLiveGetRoomBigIM.event),this.stateCenter.actionListener("IMRecvBarrageMessage",t,o),this.stateCenter.actionListener("_recvBigRoomMessage",e,t)},h.prototype.resetMessageInfo=function(){this.transSeqMap={},this.realyMessageList=[],this.relayTimer&&(clearTimeout(this.relayTimer),this.relayTimer=null),this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer&&(clearTimeout(this.bigImTimer),this.bigImTimer=null),this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0},h.prototype.sendRelayMessage=function(e,t,r,o){var s=this.datiTimeWindow,i=this.serverTimeOffset;0<s?(this.realyMessageList.push({type:e,data:t,success:r,error:o}),1==this.realyMessageList.length&&this.setRelayTimer(i,s)):this.sendRelayMessageInternal(e,t,r,o)},h.prototype.sendRelayMessageInternal=function(e,t,r,o){var n=this;this.logger.info(s.MESSAGE_SEND_RELAY_MSG+" call"),(this.stateCenter.useNetAgent?this.liveRoomHandler:this.service).sendRelayMessage(e={relay_type:e,relay_data:t},(function(e){r&&r(e.header.seq,e.body.relay_result)}),(function(e){var t=i.ROOM_INNER_ERROR;if(!e.header||!e.body)return e.code&&e.msg&&(t=e),void(o&&o(t,0));o&&o(n.rtm.getServerError(e.body.err_code),e.header.seq)}),t=this.room)},h.prototype.setRelayTimer=function(e,t){var r=this;e=(new Date).getTime()+e,e=this.rtm.generateRandumNumber(2*t-e%t),this.logger.info(s.MESSAGE_SEND_RELAY_MSG+" setTimer "+e),this.relayTimer=setTimeout((function(){r.onRelayTimer()}),e)},h.prototype.onRelayTimer=function(){var e;0==this.realyMessageList.length?this.logger.info(s.MESSAGE_SEND_RELAY_MSG+"  no relay data"):(this.sendRelayMessageInternal((e=this.realyMessageList[0]).type,e.data,e.success,e.error),this.relayTimer&&clearTimeout(this.relayTimer),this.relayTimer=null,this.realyMessageList.splice(0,1),0<this.realyMessageList.length&&this.setRelayTimer(this.serverTimeOffset,this.datiTimeWindow))},h.prototype.getRoomChatInfo=function(e,t,r,o){this.logger.debug("zb.mh.grc call"),this.room.isLogin()?(this.service.sendMessage("zegochat_js.room_im_chat_fetch",e={room_header:{room_id:this.room.roomID,room_sid:this.room.roomSid||"0",room_user_session_id:this.room.roomSessionID||"0"},msg_id:e,msg_count:t},t=function(e,t){0!==e.body.code?o({errorCode:e.body.code,extendData:e.body.message||""}):(e=e.body.msg_data.map((function(e){return{fromUser:{userID:e.user_id,userName:e.user_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id}})),r({chatData:e}))},t),this.logger.info("zb.mh.grc call success")):this.logger.error("zb.mh.srm no enter room")},h);function h(e,t,r,o,s,i,n){var a=this;this.logger=e,this.stateCenter=t,this.dataReport=r,this.service=o,this.liveRoomHandler=s,this.rtm=i,this.room=n,this.sendRoomMsgTime=0,this.sendRoomMsgInterval=500,this.bigImCallbackMap={},this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImTimer=null,this.relayTimer=null,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.isReliable=!1,this.transSeqMap={},this.onRecvReliableMessage=function(e){var t=(e=e.filter((function(e){return e.trans_idname!==a.stateCenter.idName}))).map((function(e){return{key:e.trans_type,value:e.trans_data,updateUser:{userID:e.trans_idname,userName:e.trans_nickname},updateTime:u.a.isLong(e.trans_send_time)?e.trans_send_time.toNumber():e.trans_send_time}}));0<t.length&&a.stateCenter.actionListener("roomExtraInfoUpdate",a.room.roomID,t),e.forEach((function(e){a.stateCenter.actionListener("recvReliableMessage",e.trans_type,e.trans_seq,e.trans_data)}))},this.realyMessageList=[]}function g(e,t,r,o){var i=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(l,u){var c=i.getReportSeq();if(u=(i.dataReport.newReport(c,n.kZegoTaskLiveRoomSendRoomMessage.event),l=i.proxyRes(i.dataReport,c,l,u)).interResolve,l=l.interReject,"string"!=typeof e||""==e)return i.logger.error(s.RTM_SEND_BCM+" roomid must be string and not empty"),void l(n.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return i.logger.error(s.RTM_SEND_BCM+" message is empty"),void l(n.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_NULL);if("string"!=typeof t)return i.logger.error(s.RTM_SEND_BCM+" message must be string"),void l(n.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param message error");if(t.length>a)return i.logger.error(s.RTM_SEND_BCM+" message too long"),void l(n.kZegoTaskLiveRoomSendRoomMessage.error.IM_CONTENT_TOO_LONG);var h=i.getRoomModules(e);h?(i.dataReport.addMsgInfo(c,{room_sid:n.kZegoTaskLiveRoomSendRoomMessage.room_sid(h.sessionID)}),h.messageHandler.sendRoomMsg(r,o,e,t,u,l)):l(n.kZegoTaskLiveRoomSendRoomMessage.error.ROOM_NOT_EXIST)}))}function d(e,t,r){var o=this;return new Promise((function(l,u){var c=o.getReportSeq();if(u=(o.dataReport.newReport(c,n.kZegoTaskLiveRoomSendCustomCommand.event),l=o.proxyRes(o.dataReport,c,l,u)).interResolve,l=l.interReject,"string"!=typeof e||""==e)return o.logger.error(s.RTM_SEND_CUSTOM+" roomid must be string and not empty"),void l(i.INPUT_PARAM," param roomID error");if(!(r instanceof Array)||r.find((function(e){return"string"!=typeof e})))return o.logger.error(s.RTM_SEND_CUSTOM+" dstMembers must be string array"),void l(n.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param toUserList error");if("string"!=typeof t&&"object"!=typeof t)return o.logger.error(s.RTM_SEND_CUSTOM+" custom content must be a non empty string or object"),void l(n.kZegoTaskLiveRoomSendCustomCommand.error.INPUT_PARAM," param command error");if("string"==typeof t&&t.length>a)return o.logger.error(s.RTM_SEND_CUSTOM+" command too long"),void l(n.kZegoTaskLiveRoomSendCustomCommand.error.IM_CONTENT_TOO_LONG);var h=o.getRoomModules(e);h?(o.dataReport.addMsgInfo(c,{room_sid:n.kZegoTaskLiveRoomSendCustomCommand.room_sid(h.sessionID)}),h.messageHandler.sendCustomCommand(r,t,u,l)):l(n.kZegoTaskLiveRoomSendCustomCommand.error.ROOM_NOT_EXIST)}))}function _(e,t,r,o){var i=this;return void 0===r&&(r=1),void 0===o&&(o=1),new Promise((function(l,u){var c=i.getReportSeq();if(u=(i.dataReport.newReport(c,n.kZegoTaskLiveSendRoomBigIM.event),l=i.proxyRes(i.dataReport,c,l,u)).interResolve,l=l.interReject,"string"!=typeof e||""==e)return i.logger.error(s.RTM_SEND_BRM+"roomid must be string and not empty"),void l(n.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param roomID error");if(void 0===t||""==t)return i.logger.error(s.RTM_SEND_BRM+" message is empty"),void l(n.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_NULL);if("string"!=typeof t)return i.logger.error(s.RTM_SEND_BRM+" message must be string"),void l(n.kZegoTaskLiveSendRoomBigIM.error.INPUT_PARAM," param message error");if(t.length>a)return i.logger.error(s.RTM_SEND_BRM+" message too long"),void l(n.kZegoTaskLiveSendRoomBigIM.error.IM_CONTENT_TOO_LONG);var h=i.getRoomModules(e);h?(i.dataReport.addMsgInfo(c,{room_sid:n.kZegoTaskLiveSendRoomBigIM.room_sid(h.sessionID)}),h.messageHandler.sendBigRoomMessage(r,o,e,t,u,l)):l(n.kZegoTaskLiveSendRoomBigIM.error.ROOM_NOT_EXIST)}))}function p(e,t,r){var o=this;return new Promise((function(i,a){var l=o.getReportSeq();if(a=(o.dataReport.newReport(l,n.kZegoTaskLiveRoomSendReliableMessage.event),i=o.proxyRes(o.dataReport,l,i,a)).interResolve,i=i.interReject,"string"!=typeof e||""==e)return o.logger.error(s.RTM_SEND_BCM+" roomid must be string and not empty"),void i(n.kZegoTaskLiveRoomSendRoomMessage.error.INPUT_PARAM," param roomID error");if(!t||"string"!=typeof t)return o.logger.error(s.RTM_SEND_RLM+" type must be string"),void i({errorCode:n.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(128<t.length)return o.logger.error(s.RTM_SEND_RLM+" type is too long"),void i({errorCode:n.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if("string"!=typeof r)return o.logger.error(s.RTM_SEND_RLM+" data must be string"),void i({errorCode:n.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});if(4096<r.length)return o.logger.error(s.RTM_SEND_RLM+" type is too long"),void i({errorCode:n.kZegoTaskLiveRoomSendReliableMessage.error.INPUT_PARAM.code});var u=o.getRoomModules(e);u?(o.dataReport.addMsgInfo(l,{room_sid:n.kZegoTaskLiveRoomSendReliableMessage.room_sid(u.sessionID)}),u.messageHandler.sendReliableMessage(t,r,a,i)):i(n.kZegoTaskLiveRoomSendReliableMessage.error.ROOM_NOT_EXIST)}))}var E={_sendBroadcastMessage:g,sendBroadcastMessage:function(e,t){var r=this;return new Promise((function(o,s){g.call(r,e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){s(e)}))}))},_sendCustomCommand:d,sendCustomCommand:function(e,t,r){var o=this;return new Promise((function(s,i){d.call(o,e,t,r).then((function(e){s({errorCode:e.errorCode,extendedData:e.extendedData})})).catch((function(e){i(e)}))}))},_sendBarrageMessage:_,sendBarrageMessage:function(e,t){var r=this;return new Promise((function(o,s){_.call(r,e,t).then((function(e){o({errorCode:e.errorCode,messageID:e.messageID,extendedData:e.extendedData})})).catch((function(e){s(e)}))}))},_setRoomExtraInfo:p,setRoomExtraInfo:function(e,t,r){return p.call(this,e,t,r)},sendRelayMessage:function(e,t,r,o,s){(s=this.getRoomModules(s)||this.stateCenter.roomModulesList[0])?s.messageHandler.sendRelayMessage(e,t,r,o):o&&o(i.ROOM_NOT_EXIST,0)}},m={handlePushRoomMsg:function(e){var t=this.handlePushMsg(e);t[0].messageHandler.handlePushRoomMsg(e=t[1])},handlePushCustomMsg:function(e){var t=this.handlePushMsg(e);t[0].messageHandler.handlePushCustomMsg(e=t[1])},handlePushMergeMsg:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;(t=this.rtm.getRoomModules(t))?t.messageHandler.handlePushMergeMsg(e):this.logger.error(s.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},handlePushTransMsg:function(e){var t=this.handlePushMsg(e);t[0].messageHandler.handlePushTransMsg(e=t[1])},handleBigImMsgRsp:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;(t=this.rtm.getRoomModules(t))?t.messageHandler.handleBigImMsgRsp(e):this.logger.error(s.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))},handlePushMsg:function(e){var t=null==(t=null==e?void 0:e.header)?void 0:t.room_id;if(t=this.rtm.getRoomModules(t))return[t,e];this.logger.error(s.SERVICE_PUSH+" room no found ignore "+JSON.stringify(e))}},T={initMessageHandler:function(){this.messageHandler=new c(this.logger,this.stateCenter,this.dataReport,this.service,this.liveRoomHandler,this.rtm,this)}};t.default={type:"message",install:function(e,t,r,o){for(var s in E)Object.defineProperty(e.prototype,s,{value:E[s],writable:!1});for(var s in m)Object.defineProperty(r.prototype,s,{value:m[s],writable:!1}),Object.defineProperty(o.prototype,s,{value:m[s],writable:!1});for(var s in T)Object.defineProperty(t.prototype,s,{value:T[s],writable:!1})}}},3:function(e,t,r){var o=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function o(e){return!0===(e&&e.__isLong__)}function s(e){var t=Math.clz32(e&-e);return e?31-t:t}Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=o;var i={},n={};function a(e,t){var r,o,s;return t?(s=0<=(e>>>=0)&&e<256)&&(o=n[e])?o:(r=u(e,0,!0),s&&(n[e]=r),r):(s=-128<=(e|=0)&&e<128)&&(o=i[e])?o:(r=u(e,e<0?-1:0,!1),s&&(i[e]=r),r)}function l(e,t){if(isNaN(e))return t?T:m;if(t){if(e<0)return T;if(_<=e)return I}else{if(e<=-p)return L;if(p<=e+1)return C}return e<0?l(-e,t).neg():u(e%d|0,e/d|0,t)}function u(e,t,o){return new r(e,t,o)}r.fromInt=a,r.fromNumber=l,r.fromBits=u;var c=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if(t="number"==typeof t?(r=t,!1):!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?T:m;if((r=r||10)<2||36<r)throw RangeError("radix");var o;if(0<(o=e.indexOf("-")))throw Error("interior hyphen");if(0===o)return h(e.substring(1),t,r).neg();for(var s=l(c(r,8)),i=m,n=0;n<e.length;n+=8){var a=Math.min(8,e.length-n),u=parseInt(e.substring(n,n+a),r);i=a<8?(a=l(c(r,a)),i.mul(a).add(l(u))):(i=i.mul(s)).add(l(u))}return i.unsigned=t,i}function g(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=g;var d=4294967296,_=d*d,p=_/2,E=a(1<<24),m=a(0),T=(r.ZERO=m,a(0,!0)),R=(r.UZERO=T,a(1)),f=(r.ONE=R,a(1,!0)),S=(r.UONE=f,a(-1)),C=(r.NEG_ONE=S,u(-1,2147483647,!1)),I=(r.MAX_VALUE=C,u(-1,-1,!0)),L=(r.MAX_UNSIGNED_VALUE=I,u(0,-2147483648,!1)),y=(r.MIN_VALUE=L,r.prototype);return y.toInt=function(){return this.unsigned?this.low>>>0:this.low},y.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},y.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";var t,r;if(this.isNegative())return this.eq(L)?(r=l(e),r=(t=this.div(r)).mul(r).sub(this),t.toString(e)+r.toInt().toString(e)):"-"+this.neg().toString(e);for(var o=l(c(e,6),this.unsigned),s=this,i="";;){var n=s.div(o),a=(s.sub(n.mul(o)).toInt()>>>0).toString(e);if((s=n).isZero())return a+i;for(;a.length<6;)a="0"+a;i=""+a+i}},y.getHighBits=function(){return this.high},y.getHighBitsUnsigned=function(){return this.high>>>0},y.getLowBits=function(){return this.low},y.getLowBitsUnsigned=function(){return this.low>>>0},y.getNumBitsAbs=function(){if(this.isNegative())return this.eq(L)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},y.isZero=function(){return 0===this.high&&0===this.low},y.eqz=y.isZero,y.isNegative=function(){return!this.unsigned&&this.high<0},y.isPositive=function(){return this.unsigned||0<=this.high},y.isOdd=function(){return 1==(1&this.low)},y.isEven=function(){return 0==(1&this.low)},y.equals=function(e){return o(e)||(e=g(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},y.eq=y.equals,y.notEquals=function(e){return!this.eq(e)},y.neq=y.notEquals,y.ne=y.notEquals,y.lessThan=function(e){return this.comp(e)<0},y.lt=y.lessThan,y.lessThanOrEqual=function(e){return this.comp(e)<=0},y.lte=y.lessThanOrEqual,y.le=y.lessThanOrEqual,y.greaterThan=function(e){return 0<this.comp(e)},y.gt=y.greaterThan,y.greaterThanOrEqual=function(e){return 0<=this.comp(e)},y.gte=y.greaterThanOrEqual,y.ge=y.greaterThanOrEqual,y.compare=function(e){if(o(e)||(e=g(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},y.comp=y.compare,y.negate=function(){return!this.unsigned&&this.eq(L)?L:this.not().add(R)},y.neg=y.negate,y.add=function(e){o(e)||(e=g(e));var t=0,r=0,s=0,i=0;return r+=(s=s+((i+=(65535&this.low)+(65535&e.low))>>>16)+((this.low>>>16)+(e.low>>>16)))>>>16,u((s&=65535)<<16|(i&=65535),((t+=(r+=(65535&this.high)+(65535&e.high))>>>16)+((this.high>>>16)+(e.high>>>16))&65535)<<16|(r&=65535),this.unsigned)},y.subtract=function(e){return o(e)||(e=g(e)),this.add(e.neg())},y.sub=y.subtract,y.multiply=function(e){if(this.isZero())return this;if(o(e)||(e=g(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?T:m;if(this.eq(L))return e.isOdd()?L:m;if(e.eq(L))return this.isOdd()?L:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(E)&&e.lt(E))return l(this.toNumber()*e.toNumber(),this.unsigned);var r=65535&this.high,s=this.low>>>16,i=65535&this.low,n=e.high>>>16,a=65535&e.high,c=e.low>>>16,h=0,d=0,_=0,p=(p=0)+((d=d+((_+=i*(e=65535&e.low))>>>16)+s*e)>>>16)+((d=(65535&d)+i*c)>>>16);return u((d&=65535)<<16|(_&=65535),((h+=(p+=r*e)>>>16)+((p=(65535&p)+s*c)>>>16)+((p=(65535&p)+i*a)>>>16)+((this.high>>>16)*e+r*c+s*a+i*n)&65535)<<16|(p&=65535),this.unsigned)},y.mul=y.multiply,y.divide=function(e){if((e=o(e)?e:g(e)).isZero())throw Error("division by zero");var r,s,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?T:m;if(this.unsigned){if((e=e.unsigned?e:e.toUnsigned()).gt(this))return T;if(e.gt(this.shru(1)))return f;s=T}else{if(this.eq(L))return e.eq(R)||e.eq(S)?L:e.eq(L)?R:(i=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?R:S:(r=this.sub(e.mul(i)),i.add(r.div(e)));if(e.eq(L))return this.unsigned?T:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=m}for(r=this;r.gte(e);){i=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var n=Math.ceil(Math.log(i)/Math.LN2),a=n<=48?1:c(2,n-48),h=l(i),d=h.mul(e);d.isNegative()||d.gt(r);)d=(h=l(i-=a,this.unsigned)).mul(e);h.isZero()&&(h=R),s=s.add(h),r=r.sub(d)}return s},y.div=y.divide,y.modulo=function(e){return o(e)||(e=g(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},y.mod=y.modulo,y.rem=y.modulo,y.not=function(){return u(~this.low,~this.high,this.unsigned)},y.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},y.clz=y.countLeadingZeros,y.countTrailingZeros=function(){return this.low?s(this.low):s(this.high)+32},y.ctz=y.countTrailingZeros,y.and=function(e){return o(e)||(e=g(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},y.or=function(e){return o(e)||(e=g(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},y.xor=function(e){return o(e)||(e=g(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},y.shiftLeft=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},y.shl=y.shiftLeft,y.shiftRight=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},y.shr=y.shiftRight,y.shiftRightUnsigned=function(e){return o(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):u(32===e?this.high:this.high>>>e-32,0,this.unsigned)},y.shru=y.shiftRightUnsigned,y.shr_u=y.shiftRightUnsigned,y.rotateLeft=function(e){var t;return o(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?u(this.high,this.low,this.unsigned):e<32?u(this.low<<e|this.high>>>(t=32-e),this.high<<e|this.low>>>t,this.unsigned):u(this.high<<(e-=32)|this.low>>>(t=32-e),this.low<<e|this.high>>>t,this.unsigned)},y.rotl=y.rotateLeft,y.rotateRight=function(e){var t;return o(e)&&(e=e.toInt()),0==(e&=63)?this:32===e?u(this.high,this.low,this.unsigned):e<32?u(this.high<<(t=32-e)|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned):u(this.low<<(t=32-(e-=32))|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned)},y.rotr=y.rotateRight,y.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},y.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},y.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},y.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},y.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,o){return o?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},e.default=r,"default"in e?e.default:e}({});void 0!==(t=function(){return o}.apply(t,[]))&&(e.exports=t)}},r={},e.m=t,e.c=r,e.d=function(t,r,o){e.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:o})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,r){if(1&r&&(t=e(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var s in t)e.d(o,s,function(e){return t[e]}.bind(null,s));return o},e.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(r,"a",r),r},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=14);function e(o){if(r[o])return r[o].exports;var s=r[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var t,r}()}},t={},r=function r(o){var s=t[o];if(void 0!==s)return s.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,r),i.exports}(828),r;var e,t,r}));