{"version":3,"sources":["ZegoExpressMiniProgram.js"],"names":[],"mappings":";;;;;;;AAAA","file":"index.js","sourcesContent":["!function(e,t){if(\"object\"==typeof exports&&\"object\"==typeof module)module.exports=t(require(\"zego-express-engine-webrtm\"));else if(\"function\"==typeof define&&define.amd)define([\"zego-express-engine-webrtm\"],t);else{var r=\"object\"==typeof exports?t(require(\"zego-express-engine-webrtm\")):t(e[\"zego-express-engine-webrtm\"]);for(var o in r)(\"object\"==typeof exports?exports:e)[o]=r[o]}}(\"undefined\"!=typeof self?self:this,(function(e){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var s in e)r.d(o,s,function(t){return e[t]}.bind(null,s));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,\"a\",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p=\"\",r(r.s=6)}([function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ENUM_PUBLISH_STATE_UPDATE=t.LinkedList=t.ListNode=t.E_CLIENT_TYPE=t.ENUM_SOURCE_TYPE=t.ENUM_DISPATCH_TYPE=t.ENUM_BROADCASTER_STATUS=t.ENUM_PLAY_SOURCE_TYPE=t.ENUM_PUBLISH_STATE_NEGO=t.ENUM_PUSH_SIGNAL_SUB_CMD=t.ENUM_SIGNAL_SUB_CMD=t.QUALITYLEVEL=t.MIXSTREAM_ERROR_CODE=t.SERVER_ERROR_CODE=t.ENUM_STREAM_UPDATE_CMD=t.MINIUM_HEARTBEAT_INTERVAL=t.STREAM_DELETE_REASON=t.ENUM_NETWORK_STATE=t.ENUM_RUN_STATE=t.ENUM_STREAM_UPDATE_TYPE=t.ENUM_STREAM_SUB_CMD=t.ENUM_PUBLISH_STREAM_STATE=t.MAX_RETRY_CONNECT_INTERVAL=t.MAX_TRANS_DATA_LENGTH=t.MAX_TRANS_TYPE_LENGTH=t.MAX_MIX_TASK_ID_LENGTH=t.MAX_MESSAGE_LENGTH=t.MAX_ROOM_ID_LENGTH=t.MAX_USER_NAME_LENGTH=t.MAX_USER_ID_LENGTH=t.MAX_STREAM_ID_LENGTH=t.MAX_TRY_HEARTBEAT_COUNT=t.SEND_MSG_TIMEOUT=t.SEND_MSG_RESET=t.MAX_TRY_CONNECT_COUNT=t.ENUM_CONNECT_STATE=t.ENUM_PLAY_STATE_NEGO=t.ENUM_PLAYER_STATE=t.ENUM_PLAY_STATE=t.ENUM_PUBLISH_STATE=t.ENUM_SCREEM_RESOLUTION_TYPE=t.ENUM_RESOLUTION_TYPE=t.ENUM_SIGNAL_STATE=t.ERROR_CODES=t.sdkErrorList=t.ENUM_REMOTE_TYPE=t.LOG_LEVEL=t.ENUM_LOG_LEVEL=t.ROOMVERSION=t.PROTO_VERSION=void 0,t.getReportSeq=t.getSeq=t.REPORT_ACTION=t.ENUM_RETRY_STATE=t.ENUM_PLAY_STATE_UPDATE=void 0,t.PROTO_VERSION=\"2.2.1\",t.ROOMVERSION=\"V1\",function(e){e[e.debug=0]=\"debug\",e[e.info=1]=\"info\",e[e.warn=2]=\"warn\",e[e.error=3]=\"error\",e[e.report=99]=\"report\",e[e.disable=100]=\"disable\"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]=\"disable\",e[e.websocket=1]=\"websocket\",e[e.https=2]=\"https\"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:\"Client.\",SERVER:\"Server.\",SUCCESS:{code:\"Success\",msg:\"success.\"},PARAM:{code:\"Error.Param\",msg:\"input error.\"},HEARTBEAT_TIMEOUT:{code:\"Error.Timeout\",msg:\"heartbeat timeout.\"},LOGIN_TIMEOUT:{code:\"Error.Timeout\",msg:\"login timeout.\"},SEND_MSG_TIMEOUT:{code:\"Error.Timeout\",msg:\"send customsg timeout.\"},RESET_QUEUE:{code:\"Error.Timeout\",msg:\"msg waiting ack is clear when reset.\"},LOGIN_DISCONNECT:{code:\"Error.Network\",msg:\"network is broken and login fail.\"},KICK_OUT:{code:\"Error.Kickout\",msg:\"kickout reason=\"},UNKNOWN:{code:\"Error.Unknown\",msg:\"unknown error.\"},FREQ_LIMITED:{code:\"Error.requencyLimited\",msg:\"Frequency Limited.\"}},t.ERROR_CODES={ROOM_SESSION_ID_ERR:1000000152,FETCH_TRANS_UNKNOWN_CHANNEL:1000001108,FETCH_TRANS_UNKNOWN_TYPE:1000001109,FETCH_TRANS_WRONG_SEQ:1000001110},function(e){e[e.disconnected=0]=\"disconnected\",e[e.connecting=1]=\"connecting\",e[e.connected=2]=\"connected\"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:320,height:240,frameRate:15,bitRate:300},MEDIUM:{width:640,height:480,frameRate:15,bitRate:800},HIGH:{width:1280,height:720,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAYER_STATE={start:0,playing:1,stop:2},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.MAX_STREAM_ID_LENGTH=256,t.MAX_USER_ID_LENGTH=64,t.MAX_USER_NAME_LENGTH=256,t.MAX_ROOM_ID_LENGTH=128,t.MAX_MESSAGE_LENGTH=1024,t.MAX_MIX_TASK_ID_LENGTH=256,t.MAX_TRANS_TYPE_LENGTH=128,t.MAX_TRANS_DATA_LENGTH=4096,t.MAX_RETRY_CONNECT_INTERVAL=12,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]=\"logout\",e[e.trylogin=1]=\"trylogin\",e[e.login=2]=\"login\"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),function(e){e[e.offline=0]=\"offline\",e[e.online=1]=\"online\"}(t.ENUM_NETWORK_STATE||(t.ENUM_NETWORK_STATE={})),t.STREAM_DELETE_REASON={0:{code:1,description:\"user_stop_publishing_stream_normal\"},1:{code:2,description:\"user_heart_beat_timeout\"},2:{code:3,description:\"user_repeat_login\"},3:{code:4,description:\"user_kicked_out\"},4:{code:5,description:\"user_offline\"},100:{code:6,description:\"remove_by_server\"}},t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.MIXSTREAM_ERROR_CODE=1e4,function(e){e[e.low=1]=\"low\",e[e.stantard=2]=\"stantard\",e[e.hight=3]=\"hight\",e[e.custome=4]=\"custome\"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5,iceDisconnected:6},function(e){e[e.cdn=0]=\"cdn\",e[e.ultra=1]=\"ultra\"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]=\"stop\",e[e.start=1]=\"start\"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]=\"cdn\",e[e.ultra=1]=\"ultra\",e[e.customUrl=2]=\"customUrl\"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]=\"CDN\",e[e.BGP=1]=\"BGP\"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]=\"ClientType_None\",e[e.ClientType_H5=1]=\"ClientType_H5\",e[e.ClientType_SmallPragram=2]=\"ClientType_SmallPragram\",e[e.ClientType_Webrtc=3]=\"ClientType_Webrtc\"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var o=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,\"id\",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"data\",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!1,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=o;var s=function(){function e(){this.start=new o,this.end=new o,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new o(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw\"Index out of bounds.\";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,o=null;t.hasNext()&&!r;)e(t=t.next)&&(o=t,r=!0);return o},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=s,t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.REPORT_ACTION={eventStart:\"eventStart\",eventEndWithMsgInfo:\"eventEndWithMsgInfo\",addEventMsg:\"addEventMsg\",addEvent:\"addEvent\",eventEnd:\"eventEnd\",addMsgInfo:\"addMsgInfo\"};var a=r(4);Object.defineProperty(t,\"getSeq\",{enumerable:!0,get:function(){return a.getSeq}}),Object.defineProperty(t,\"getReportSeq\",{enumerable:!0,get:function(){return a.getReportSeq}})},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoWechatLogEvent=t.ZegoRTCLogEvent=void 0;var o=r(5),s=function(e){return e};t.ZegoRTCLogEvent={kZegoTaskCreateStream:{event:\"/sdk/create_stream\",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kParamError:o.errorCodeList.PUBLISHER_PARAM,kScreenCancelError:o.errorCodeList.PUBLISH_SCREEN_CANCELED,kScreenFailedError:o.errorCodeList.PUBLISHER_SCREEN_FAILED,kScreenNotSupportError:o.errorCodeList.PUBLISH_SCREEN_NOT_SUPPORT,kHttpsRequiredError:o.errorCodeList.PUBLISHER_HTTPS_REQUIRED},stream_type:s,screen:s,camera:s,custom:s},kZegoTaskPublishStart:{event:\"/sdk/api/publish_request\",error:{kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoPreviewError:o.errorCodeList.PUBLISH_NO_PREVIEW,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kPublishSessionClosedError:o.errorCodeList.PUBLISHER_SESSION_CLOSED,kPublishNegoTimeoutError:o.errorCodeList.PUBLISHER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PUBLISHER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PUBLISHER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PUBLISHER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PUBLISHER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PUBLISHER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PUBLISHER_WEBSOCKET_DISCONNECTED,kMediaDescError:o.errorCodeList.PUBLISHER_MEDIA_DESC_ERROR,kCandidateError:o.errorCodeList.PUBLISHER_CANDIDATE_ERROR,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING,kClientIPChangedError:o.errorCodeList.PUBLISHER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PUBLISHER_TTL_OVERTIME},publishOption:s,message:s,session_id:s,stream:s,video_en_codec_id:s,cap_w:s,cap_h:s,w:s,h:s,video_en_fps:s,video_en_bps:s,audio_c_channel_count:s,audio_en_bps:s,aec_level:s,ans_level:s,agc:s,traffic_control_min_video_bitrate:s},kZegoTaskVideoCaptureSize:{event:\"sdk/api/publish_video_c_size\",session_id:s,w:s,h:s},kZegoTaskRePublish:{event:\"/sdk/republish\",stream:s},kZegoTaskPublishStop:{event:\"/sdk/stop_publish\",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStart:{event:\"/sdk/api/play_request\",error:{kStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDToLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kPlaySessionClosedError:o.errorCodeList.PLAYER_SESSION_CLOSED,kPlaySessionResetError:o.errorCodeList.PLAYER_SESSION_RESET,kPlayNegoTimeoutError:o.errorCodeList.PLAYER_SERVER_NEGO_TIMEOUT,kCreateOfferError:o.errorCodeList.PLAYER_CREATE_OFFER_ERROR,kSetLocalDescError:o.errorCodeList.PLAYER_SET_LOCAL_DESC_ERROR,kSessionRequestError:o.errorCodeList.PLAYER_SESSION_REQUEST_FAIL,kSetRemoteDescError:o.errorCodeList.PLAYER_SET_REMOTE_DESC_ERROR,kMediaConnectionError:o.errorCodeList.PLAYER_MEDIA_CONNECTION_ERROR,kWebsocketDisconnectedError:o.errorCodeList.PLAYER_WEBSOCKET_DISCONNECTED,kCandidateError:o.errorCodeList.PLAYER_CANDIDATE_ERROR,kMediaDescError:o.errorCodeList.PLAYER_MEDIA_DESC_ERROR,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING,kClientIPChangedError:o.errorCodeList.PLAYER_CLIENT_IP_CHANGED,kTTLOverTimeError:o.errorCodeList.PLAYER_TTL_OVERTIME},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s},kZegoTaskRePlay:{event:\"/sdk/replay\",stream:s},kZegoTaskPlayStop:{event:\"/sdk/stop_play\",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoPlayContentChanged:{event:\"/sdk/play_content_changed\",session_id:s,video_activate:s,audio_activate:s},kZegoTaskMixStart:{event:\"/mix/start_mix\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR},mix_stream_id:s,stream_cnt:s,input_stream_list:s,output_target_list:s},kZegoTaskMixStop:{event:\"/mix/stop_mix\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR}},kZegoTaskMixConfig:{event:\"/mix/config_mix\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID},config:s},kZegoTaskEnumDevices:{event:\"/device/list\",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},dev_list:s},kZegoTaskAudioOutput:{event:\"/device/audio_capture\",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskVideoCapture:{event:\"/device/video_capture\",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,device:s},kZegoTaskDeviceInterrupt:{event:\"/device/interrupt\",error:{kBrowserNotSupportError:o.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT,kEnumDevicesError:o.errorCodeList.ENUMERATE_DEVICES_FAIL},session_id:s,interrupt:s},kZegoTaskSetDebug:\"/sdk/set_debug\",kZegoTaskSetLog:\"/sdk/set_log_config\",kZegoTaskUseVideoDevice:{event:\"/device/api/video_c\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:s},kZegoTaskUseAudioDevice:{event:\"/device/api/audio_c\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kDevicesNoFoundError:o.errorCodeList.DEVICE_NOT_FOUND,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG},device:s},kZegoTaskCheckSystemRequirements:{event:\"/sdk/check_system\",capability:s},kZegoTaskMutePublishVideo:\"/sdk/mute_publish_video\",kZegoTaskMutePublishAudio:\"/sdk/mute_publish_audio\",kZegoTaskMutePlayVideo:\"/sdk/mute_play_video\",kZegoTaskMutePlayAudio:\"/sdk/mute_play_audio\",kZegoTaskRemoteCameraUpdate:{event:\"/sdk/remote_camera_update\",stream:s,status:s},kZegoTaskRemoteMicUpdate:{event:\"/sdk/remote_mic_update\",stream:s,status:s},kZegoTaskGetSoundLevel:{event:\"/sdk/get_sound_level\",error:{kGetSoundLevelError:o.errorCodeList.GET_SOUND_LEVEL_FAIL}},kZegoTaskStopSoundLevel:\"/sdk/stop_sound_level\",kZegoTaskAddPublishCdnUrl:{event:\"/sdk/add_publish_cdn_url\",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskRemovePublishCdnUrl:{event:\"/sdk/remove_publish_cdn_url\",error:{kParamError:o.errorCodeList.INPUT_PARAM},stream:s,target_url:s},kZegoTaskClearPublishCdnUrl:{event:\"/sdk/clear_publish_cdn_url\",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskPublishTarget:{event:\"/sdk/publish_target\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND}},kZegoTaskDestroyStream:{event:\"/sdk/destroy_stream\",error:{kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoTaskScreenSharingEnded:\"/sdk/screen_share_end\",kZegoTaskAudioOutputChanged:{event:\"/device/api/audio_output\",session_id:s,stream:s,device:s,reason:s},kZegoEventPublishStat:\"/sdk/publish_stat_report\",kZegoEventPlayStat:\"/sdk/play_stat_report\",kZegoSetAudioConfig:{event:\"/sdk/set_audio_config\",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoSetVideoConfig:{event:\"/sdk/set_video_config\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kLocalStreamError:o.errorCodeList.LOCALSTREAM_WRONG}},kZegoReplaceTrack:{event:\"/sdk/replace_track\",error:{kParamError:o.errorCodeList.INPUT_PARAM}},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:\"/liveroom/get_stream_update_info\",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:\"/liveroom/get_stream_extra_info\",update_stream:s},kZegoTaskLiveRoomSendStreamExtraInfo:{event:\"/liveroom/send_stream_extra_info\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kExtraInfoNullError:o.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:o.errorCodeList.PUBLISHER_STREAM_NO_FOUND},stream:s,stream_extra_info:s,room_sid:s},kZegoTaskPlayDecodeFirstVideoFrame:{event:\"/sdk/play_decode_first_video_frame\",session_id:s,fft_consumed:s},kZegoVisibilityChange:{event:\"/app/background\"},kZegoSetCaptureVolume:{event:\"/sdk/set_capture_volume\",error:{kParamError:o.errorCodeList.INPUT_PARAM}}},t.ZegoWechatLogEvent={kZegoTaskCheckSystemRequirements:{event:\"/sdk/check_system\",error:{kCheckSystemGetSettingFailError:o.errorCodeList.WX_GETSETTING_FAIL},capability:s},kZegoTaskPublishStart:{event:\"/sdk/api/publish_request\",error:{kPublishStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPublishParamError:o.errorCodeList.PUBLISHER_PARAM,kPublishStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPublishStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPublishNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPublishDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPublishDispatchError:o.errorCodeList.DISPATCH_ERROR,kPublishNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPublishNoLoginError:o.errorCodeList.NOT_LOGIN,kPublishRetryTimeoutError:o.errorCodeList.PUBLISHER_RETRY_TIMEOUT,kIsPublishing:o.errorCodeList.PUBLISHER_IS_PUBLISHING},publishOption:s,stream:s,message:s},kZegoTaskPlayStart:{event:\"/sdk/api/play_request\",error:{kPlayStreamIDNullError:o.errorCodeList.STREAM_ID_NULL,kPlayParamError:o.errorCodeList.PLAYER_PARAM,kPlayStreamIDTooLongError:o.errorCodeList.STREAMID_TOO_LONG,kPlayStreamIDInvalidCharacterError:o.errorCodeList.STREAM_ID_INVALID_CHARACTER,kPlayNoLoginError:o.errorCodeList.NOT_LOGIN,kPlayRepeatedPullError:o.errorCodeList.REPEATED_PULL,kPlayNetworkTimeoutError:o.errorCodeList.TIMEOUT,kPlayDispatchTimeoutError:o.errorCodeList.DISPATCH_TIMEOUT,kPlayDispatchError:o.errorCodeList.DISPATCH_ERROR,kPlayNetworkBrokenError:o.errorCodeList.NETWORK_BROKEN,kPlayRetryTimeoutError:o.errorCodeList.PLAYER_RETRY_TIMEOUT,kIsPlaying:o.errorCodeList.PLAYER_IS_PLAYING},playOption:s,message:s,session_id:s,stream:s,audio_activate:s,video_activate:s},kZegoEventPublishStat:\"/sdk/publish_stat_report\",kZegoEventPlayStat:\"/sdk/play_stat_report\",kZegoTaskRePublish:\"/sdk/republish\",kZegoTaskRePlay:\"/sdk/replay\",kZegoTaskPublishStop:{event:\"/sdk/stop_publish\",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskPlayStop:{event:\"/sdk/stop_play\",error:{kParamError:o.errorCodeList.PUBLISHER_PARAM},stream:s},kZegoTaskLiveRoomGetStreamUpdateInfo:{event:\"/liveroom/get_stream_update_info\",stream_update_type:s,update_stream:s},kZegoTaskLiveRoomGetStreamExtraInfo:{event:\"/liveroom/get_stream_extra_info\",update_stream:s},kZegoTaskMixStart:{event:\"/mix/start_mix\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR},mix_stream_id:s,stream_cnt:s,input_stream_list:s,output_target_list:s},kZegoTaskMixStop:{event:\"/mix/stop_mix\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR}},kZegoTaskMixConfig:{event:\"/mix/config_mix\",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID},config:s}},console.log(JSON.stringify(t.ZegoRTCLogEvent))},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZEGO_WECHATMINI_ACTION=t.ZEGO_WEBRTC_ACTION=void 0,function(e){e.CONSTRUCTOR=\"zc.0\",e.CREATE_STREAM=\"zc.cs\",e.DESTROY_STREAM=\"zc.ds\",e.START_PUBLISHING_STREAM=\"zc.sps.0\",e.START_PLAYING_STREAM=\"zc.sps.1\",e.STOP_PUBLISHING_STREAM=\"zc.sps.0.0\",e.STOP_PLAYING_STREAM=\"zc.sps.1.0\",e.BIND_WINDOW_LISTENER=\"zc.wl\",e.MUTE_PUBLISH_STREAM_VIDEO=\"zc.mpsv.0\",e.MUTE_PUBLISH_STREAM_AUDIO=\"zc.mpsa.0\",e.MUTE_PLAY_STREAM_VIDEO=\"zc.mpsv.1\",e.MUTE_PLAY_STREAM_AUDIO=\"zc.mpsa.1\",e.SET_AUDIO_OUTPUT=\"zc.sao\",e.SET_CUSTOM_SIGNAL_URL=\"zc.scsu\",e.SET_TURN_OVER_TCP_ONLY=\"zc.stoto\",e.SET_VIDEO_CONFIG=\"zc.svc\",e.SET_AUDIO_CONFIG=\"zc.sac\",e.REPLACE_TRACK=\"zc.rp\",e.PRELOAD_EFFECT=\"zc.pe.0\",e.PLAY_EFFECT=\"zc.pe.1\",e.PAUSE_EFFECT=\"zc.pe.2\",e.RESUME_EFFECT=\"zc.re\",e.STOP_EFFECT=\"zc.se\",e.UNLOAD_EFFECT=\"zc.ue\",e.SET_EFFECT_VOLUME=\"zc.sev\",e.START_MIXING_AUDIO=\"zc.sma.0\",e.STOP_MIXING_AUDIO=\"zc.sma.1\",e.MIXING_BUFFER=\"zc.mb\",e.STOP_MIXING_BUFFER=\"zc.smb\",e.SET_MIXING_AUDIO_VOLUME=\"zc.smav\",e.ENABLE_STREAM=\"zc.es\",e.RDH_ACTIVE=\"zc.rdh.a\",e.RDH_MAX_TIME=\"zc.rdh.m\",e.RDH_WEBRTC_URL_RSP=\"zc.rdh.hfwur\",e.PUBLISH_STATE_HANDLE=\"zc.psh.0\",e.PLAY_STATE_HANDLE=\"zc.psh.1\",e.STATECENTER_ACTION_LISTENER=\"zc.sc.al\",e.SIGNAL_SET_SESSION_INFO=\"zc.s.ssi\",e.SIGNAL_RESET_CONNECT_TIMER=\"zc.s.rct\",e.SIGNAL_BIND_WEBSOCKET_HANDLE=\"zc.s.bwh\",e.SIGNAL_RESET_CHECK_MESSAGE=\"zc.s.rcm\",e.SIGNAL_UPDATE_TOKEN=\"zc.s.ut\",e.SIGNAL_SEND_MESSAGE_WITH_CALLBACK=\"zc.s.smwc\",e.SIGNAL_CONNECT_SERVER=\"zc.s.cs.0\",e.SIGNAL_START_CONNECT_TIMER=\"zc.s.sct\",e.SIGNAL_DISCONNECT_SERVER=\"zc.s.dc\",e.SIGNAL_CREATE_SESSION=\"zc.s.cs.1\",e.SIGNAL_REMOVE_SESSION=\"zc.s.rs\",e.SIGNAL_SEND_REMOVE_SESSION=\"zc.s.srs\",e.SIGNAL_SEND_MESSAGE=\"zc.s.sm\",e.SIGNAL_HANDLE_RESPOND_DATA=\"zc.s.hrd\",e.SIGNAL_ADD_SESSION=\"zc.s.as\",e.SIGNAL_HANDLE_PUSH_DATA=\"zc.s.hpd\",e.SIGNAL_HANDLE_PUSH_RESET_SESSION_DATA=\"zc.s.hprsd\",e.SIGNAL_SEND_MEDIA_DESC=\"zc.s.smd\",e.SIGNAL_SEND_CANDIDATE_INFO=\"zc.s.sci\",e.SIGNAL_SEND_MEDIA_DESC_ACK=\"zc.s.smda\",e.SIGNAL_SEND_CANDIDATE_INFO_ACK=\"zc.s.scia\",e.SIGNAL_SEND_CLOSE_SESSION_ACK=\"zc.s.scsa\",e.SIGNAL_SEND_RESET_SESSION_ACK=\"zc.s.srsa\",e.SIGNAL_REGISTER_PUSH_CALLBACK=\"zc.s.rpc\",e.SIGNAL_CHECK_MESSAGE_TIMEOUT=\"zc.s.cmt\",e.SIGNAL_SEND_HEARTBEAT=\"zc.s.sh\",e.SIGNAL_QUALITY_REPORT=\"zc.s.qr\",e.SIGNAL_SEND_STREAM_STATUS=\"zc.s.sss\",e.SIGNAL_ACTIVE_PLAY_VIDEO_STREAM=\"zc.s.apvs\",e.SIGNAL_ACTIVE_PLAY_AUDIO_STREAM=\"zc.s.apas\",e.SIGNAL_SEND_BROADCAST_STATUS=\"zc.s.sbs\",e.PUBLISHER_START_PUBLISH=\"zc.p.0.sp\",e.PUBLISHER_PUBLISH_SUCCESS=\"zc.p.ps\",e.PUBLISHER_ON_CREATE_PUBLISH_SESSION_SUCCESS=\"zc.p.0.ocpss\",e.PUBLISHER_HANDLE_CREATE_SESSION_WITH_SDP=\"zc.p.0.hcsws\",e.PUBLISHER_ON_CREATE_OFFER_SUCCESS=\"zc.p.0.ocos\",e.PUBLISHER_ON_SET_LOCAL_DESCRIPTION_SUCCESS=\"zc.p.0.oslds\",e.PUBLISHER_ON_GET_REMOTE_DESCRIPTION=\"zc.p.0.ogrd\",e.PUBLISHER_ON_RECV_MEDIA_DESC=\"zc.p.0.ormd\",e.PUBLISHER_ON_RECV_CANDIDATE_INFO=\"zc.p.0.orci.0\",e.PUBLISHER_ON_RECV_PUBLISH_EVENT=\"zc.p.0.orpe\",e.PUBLISHER_ON_RECV_CLIENT_INFO=\"zc.p.0.orci.1\",e.PUBLISHER_ON_ICE_CANDIDATE=\"zc.p.0.oic\",e.PUBLISHER_ON_CONNECTION_STATE_CHANGE=\"zc.p.0.ocsc\",e.PUBLISHER_ON_ICE_CONNECTION_STATE_CHANGE=\"zc.p.0.oicsc\",e.PUBLISHER_RESET_PUBLISH=\"zc.p.0.rp\",e.PUBLISHER_SET_PLAYER_QUALITY_TIMER=\"zc.p.0.spqt\",e.PUBLISHER_UPLOAD_PUBLISH_QUALITY=\"zc.p.0.upq\",e.PUBLISHER_ON_RECV_RESET_SESSION=\"zc.p.0.orrs\",e.PUBLISHER_ON_RECV_CLOSE_SESSION=\"zc.p.0.orcs\",e.PUBLISHER_SEND_CANDIDATE_INFO=\"zc.p.0.sci\",e.PUBLISHER_STATE_ERROR=\"zc.p.0.psr\",e.PUBLISHER_STOP_PUBLISH=\"zc.p.0.sp\",e.PUBLISHER_ON_DISCONNECT=\"zc.p.0.od\",e.PUBLISHER_START_SOUND_LEVEL=\"zc.p.0.ssl.0\",e.PUBLISHER_STOP_SOUND_LEVEL=\"zc.p.0.ssl.1\",e.PUBLISHER_PLAY_EFFECT=\"zc.p.0.pe.0\",e.PUBLISHER_PAUSE_EFFECT=\"zc.p.0.pe.1\",e.PUBLISHER_RESUME_EFFECT=\"zc.p.0.re\",e.PUBLISHER_STOP_EFFECT=\"zc.p.0.se\",e.PUBLISHER_START_MIXING_AUDIO=\"zc.p.0.sma.0\",e.PUBLISHER_STOP_MIXING_AUDIO=\"zc.p.0.sma.1\",e.PUBLISHER_MIXING_BUFFER=\"zc.p.0.mb\",e.PUBLISHER_SET_MIXING_AUDIO_VOLUME=\"zc.p.0.smav\",e.PUBLISHER_HANDLE_ENC_BITRATE=\"zc.p.0.heb\",e.PLAYER_START_PLAY=\"zc.p.sp.1\",e.PLAYER_ON_CREATE_PLAY_SESSION_SUCCESS=\"zc.p.ocpss.1\",e.PLAYER_HANDLE_CREATE_SESSION_WITH_SDP=\"zc.p.hcsws.1\",e.PLAYER_ON_CREATE_OFFER_SUCCESS=\"zc.p.ocos.1\",e.PLAYER_ON_SET_LOCAL_DESCRIPTION_SUCCESS=\"zc.p.oslds.1\",e.PLAYER_ON_RECV_MEDIA_DESC=\"zc.p.ormd.1\",e.PLAYER_ON_RECV_CANDIDATE_INFO=\"zc.p.orci.1\",e.PLAYER_ON_RECV_PLAY_EVENT=\"zc.p.orpe.1\",e.PLAYER_ON_RECV_CLIENT_INFO=\"zc.p.orci.1.1\",e.PLAYER_ON_ICE_CANDIDATE=\"zc.p.oic.1\",e.PLAYER_ON_CONNECTION_STATE_CHANGE=\"zc.p.ocsc.1\",e.PLAYER_ON_ICE_CONNECTION_STATE_CHANGE=\"zc.p.oicsc.1\",e.PLAYER_RESET_PLAY=\"zc.p.rp.1\",e.PLAYER_SET_PLAYER_QUALITY_TIMER=\"zc.p.spqt.1\",e.PLAYER_UPLOAD_PLAYER_QUALITY=\"zc.p.upq.1\",e.PLAYER_ON_RECV_RESET_SESSION=\"zc.p.orrs.1\",e.PLAYER_ON_RECV_CLOSE_SESSION=\"zc.p.orcs.1\",e.PLAYER_ON_RECV_STREAM_STATUS=\"zc.p.orss.1\",e.PLAYER_ON_GOT_REMOTE_STREAM=\"zc.p.ogrs.1\",e.PLAYER_SEND_CANDIDATE_INFO=\"zc.p.sci.1\",e.PLAYER_STATE_ERROR=\"zc.p.psr.1\",e.PLAYER_STOP_PLAY=\"zc.p.sp.1\",e.PLAYER_ON_DISCONNECT=\"zc.p.od.1\",e.PLAYER_START_SOUND_LEVEL=\"zc.p.ssl.1\",e.PLAYER_STOP_SOUND_LEVEL=\"zc.p.ssl.1.1\",e.PUBLISH_SET_CAPTURE_VOLUME=\"zc.p.scv\"}(t.ZEGO_WEBRTC_ACTION||(t.ZEGO_WEBRTC_ACTION={})),function(e){e.ADD_PUBLISH_CDN_URL=\"zw.apcu\",e.REMOVE_PUBLISH_CDN_URL=\"zw.rpcu\",e.STOP_MIXER_TASK=\"zw.smt\",e.ON_PUBLISH_STATE_UPDATE=\"zw.w.opsu\",e.ON_PUBLISH_STATE_UPDATE_HANDLE=\"zw.w.opsuh\",e.WECHATMINI_SETPREFERPLAYSOURCETYPE=\"zw.w.sppst.1\",e.WECHATMINI_BIND_LISTENER=\"zw.w.bl\",e.WECHATMINI_DELETE_LISTENER=\"zw.w.dl\",e.WECHATMINI_UPDATE_PLAYER_STATE=\"zw.w.ups\",e.WECHATMINI_UPDATE_PLAYER_NET_STATUS=\"zw.w.upns\",e.WECHATMINI_SET_CUSTOM_SIGNAL_URL=\"zw.w.scsu\",e.WECHATMINI_GET_NEXT_URL=\"zw.w.gnu\",e.WECHATMINI_BIND_STREAM_CENTER_HANDLER=\"zw.w.bsch\",e.WECHATMINI_BIND_RTM_LISTENER=\"zw.w.brl\",e.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE=\"zw.pu.sppst.0\",e.PUBLISHMODULE_START_PUBLISHING_STREAM=\"zw.pu.sps.0\",e.PUBLISHMODULE_STOP_PUBLISHING_STREAM=\"zw.pu.sps.0.0\",e.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL=\"zw.pu.fpsu.0\",e.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP=\"zw.pu.hfspur.0\",e.PUBLISHMODULE_DO_PUBLISH_STREAM=\"zw.pu.dps.0\",e.PUBLISHMODULE_UPDATE_STREAM_INFO=\"zw.pu.upi\",e.PUBLISHMODULE_HANDLE_STREAM_UPDATE_RSP=\"zw.pu.hsur\",e.PLAYMODULE_START_PLAYING_STREAM=\"zw.pl.sps.1\",e.PLAYMODULE_STOP_PLAYING_STREAM=\"zw.pl.sps.1.0\",e.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN=\"zw.pl.spsfc\",e.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP=\"zw.pl.spsfb\",e.PLAYMODULE_DO_PLAY_STREAM=\"zw.pl.dps\",e.PLAYMODULE_FETCH_PLAY_STREAM_URL=\"zw.pl.fpsu\",e.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP=\"zw.pl.hfsur\",e.STREAMCENTERWECHAT_RESET=\"zw.scw.r.0\",e.STREAMCENTERWECHAT_START_PUBLISHING_STREAM=\"zw.scw.sps.0\",e.STREAMCENTERWECHAT_START_PLAYING_STREAM=\"zw.scw.sps.1\",e.STREAMCENTERWECHAT_START_PLAYER=\"zw.scw.sp.0\",e.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE=\"zw.scw.opuu.0\",e.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE=\"zw.scw.ups.0\",e.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS=\"zw.scw.upns\",e.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE=\"zw.scw.ups.0.0\",e.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE=\"zw.scw.ups.1.0\",e.STREAMCENTERWECHAT_GET_NEXT_URL=\"zw.scw.gnu\",e.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM=\"zw.scw.sps.0.0\",e.STREAMCENTERWECHAT_STOP_PLAYING_STREAM=\"zw.scw.sps.1.0\",e.STREAMCENTERWECHAT_STOP_PLAYER=\"zw.scw.sp.1\",e.STREAMCENTERWECHAT_ON_PLAY_START=\"zw.scw.ops.0\",e.STREAMCENTERWECHAT_ON_PLAY_STOP=\"zw.scw.ops.1\",e.STREAMCENTERWECHAT_ON_PLAY_RETRY=\"zw.scw.opr\",e.PLAYWECHAT_TRY_START_PLAYER=\"zw.pw.tsp.0\",e.PLAYWECHAT_UPDATE_EVENT=\"zw.pw.ue\",e.PLAYWECHAT_GET_PLAY_URL=\"zw.pw.gpu\"}(t.ZEGO_WECHATMINI_ACTION||(t.ZEGO_WECHATMINI_ACTION={}))},function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(s,a){function i(e){try{E(o.next(e))}catch(e){a(e)}}function n(e){try{E(o.throw(e))}catch(e){a(e)}}function E(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,n)}E((o=o.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,o,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},\"function\"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function n(a){return function(n){return function(a){if(r)throw new TypeError(\"Generator is already executing.\");for(;i;)try{if(r=1,o&&(s=2&a[0]?o.return:a[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,a[1])).done)return s;switch(o=0,s&&(a=[2&a[0],s.value]),a[0]){case 0:case 1:s=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(s=i.trys,(s=s.length>0&&s[s.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){i.label=a[1];break}if(6===a[0]&&i.label<s[1]){i.label=s[1],s=a;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(a);break}s[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],o=0}finally{r=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,n])}}};Object.defineProperty(t,\"__esModule\",{value:!0}),t.ClientUtil=void 0;var a=r(1),i=function(){function e(){}return e.checkIllegalCharacters=function(e){return/^([0-9a-zA-Z#!$%&()`'+-;<=.>@^_~,\\\\*])+$/.test(e)&&/^[^:/]*$/g.test(e)},e.isUrl=function(e){return!!(e.startsWith(\"rtmp://\")||e.startsWith(\"https://\")&&e.endsWith(\".flv\")||e.startsWith(\"https://\")&&e.endsWith(\".m3u8\"))},e.registerCallback=function(e,t,r){var o,s;t.success&&(o=t.success,r[e+\"SuccessCallback\"]=o),t.error&&(s=t.error,r[e+\"ErrorCallback\"]=s)},e.actionErrorCallback=function(e,t){return t[e+\"ErrorCallback\"]},e.actionSuccessCallback=function(e,t){return t[e+\"SuccessCallback\"]},e.logReportCallback=function(t,r,o,s){e.registerCallback(t,{success:function(t,s){for(var a=[],i=2;i<arguments.length;i++)a[i-2]=arguments[i];e.dataReportEvent(r,o,t,s,a)}},s)},e.actionLogReportCallback=function(t,r,o,s,a){e.actionSuccessCallback(t,r)&&e.actionSuccessCallback(t,r)(o,s)},e.getServerError=function(e){var t={1:\"parse json error.\",1001:\"login is processing.\",1002:\"liveroom request error.\",1003:\"zpush connect fail.\",1004:\"zpush handshake fail.\",1005:\"zpush login fail.\",1006:\"user login state is wrong.\",1007:\"got no zpush addr\",1008:\"token error\",1009:\"dispatch error\",1010:\"token expired\",1011:\"token format error\",2002:\"biz channel error\",1e9:\"liveroom cmd error, code:\"};if(0===e)return{code:0,message:\"\"};var r={code:0,message:\"liveroom cmd error\"};return r.code=e,r.message=e>1e9?t[1e9]+e:t[e]?t[e]+\" code:\"+e:\"unknown error code:\"+e,r},e.unregisterCallback=function(e,t){delete t[e+\"SuccessCallback\"],delete t[e+\"ErrorCallback\"]},e.decodeServerError=function(e,t){var r={code:-1,message:\"server error\"};return e>1e9&&(r.code=e-1e9+52e6),t&&(r.message=t),r},e.getLiveRoomError=function(e){return e>1e9?{1105:\"ROOM_MAX_USER_COUNT\",1012:\"PUBLISHER_ERROR_REPETITIVE_PUBLISH_STREAM\",2002:\"ROOM_ERROR_AUTHENTICATION_FAILED\",2003:\"ROOM_ERROR_LOGIN_TIMEOUT\"}[e-1e9]||\"\":{1:\"PARSE_JSON_ERROR\",1001:\"LOGIN_PROCESSING\",1002:\"LIVEROMM_REQUEST_ERROR\",1003:\"ZPUSH_REQUEST_FAIL\",1004:\"ZPUSH_REQUEST_FAIL\",1005:\"ZPUSH_REQUEST_FAIL\",1006:\"LOGIN_STATE_WRONG\",1007:\"ZPUSH_REQUEST_FAIL\",1008:\"TOKEN_ERROR\",1009:\"DIAPATCH_ERROR\",1010:\"TOKEN_EXPIRED\",1011:\"TOKEN_ERROR\",1012:\"SUBCMD_ERROR\",1101:\"ZEGO_AUTH_ERROR\",2001:\"BIZ_CHANNEL_ERROR\",2002:\"BIZ_CHANNEL_ERROR\"}[e]||\"ROOM_INNER_ERROR\"},e.mixServerError=function(e){var t={82000001:\"kMixStreamFailError\",82000002:\"kMixStreamInputError\",82000003:\"kMixStreamAuthError\",82000150:\"kMixStreamNotExistError\",82000151:\"kMixStreamStartMixError\",82000152:\"kMixStreamStopMixError\",82000155:\"kMixStreamInputFormatError\",82000156:\"kMixStreamOutputFormatError\",82000157:\"kMixStreamNotOpenError\",82000158:\"kMixStreamInputExceedError\",82000159:\"kMixStreamDispatchError\",82000160:\"kMixStreamStopMixOwnerError\",82000170:\"kMixStreamWaterMarkParamError\",82000171:\"kMixStreamWaterMarkImageError\",82000190:\"kMixStreamQpsOverloadError\"},r={1:\"MIXER_START_REQUEST_ERROR\",3:\"MIXER_AUTHENTICATION_FAILED\",150:\"MIXER_INPUT_STREAM_NOT_EXISTS\",151:\"MIXER_START_REQUEST_ERROR\",152:\"MIXER_STOP_REQUEST_ERROR\",153:\"MIXER_INPUT_PARAMETERS_ERROR\",154:\"MIXER_EXCEED_MAX_OUTPUT_COUNT\",155:\"MIXER_INPUT_PARAMETERS_ERROR\",156:\"MIXER_VIDEO_CONFIG_INVALID\",157:\"MIXER_NO_SERVICES\",158:\"MIXER_EXCEED_MAX_INPUT_COUNT\",159:\"MIXER_START_REQUEST_ERROR\",160:\"MIXER_NOT_OWNER_STOPMIXER\",170:\"MIXER_WATERMARK_PARAMETERS_ERROR\",171:\"MIXER_WATERMARK_NULL\",190:\"MIXER_START_REQUEST_ERROR\"},o=[];if(e>1e9){var s=e-1e9+82e6;o[0]=t[s]?t[s]:\"\",o[1]=r[e-1e9]?r[e-1e9]:\"\"}return o},e.getKickoutError=function(e){var t={};switch(e){case 1:t.code=63000001,t.message=\"zpush multiple login kickout\",t.name=\"MULTIPLE_LOGIN_KICKOUT\";break;case 2:t.code=63000002,t.message=\"zpush manual kickout\",t.name=\"MANUAL_KICKOUT\";break;case 3:t.code=63000003,t.message=\"kickout reason = \"+e;break;case 4:t.code=63000001,t.message=\"zpush multiple login kickout\",t.name=\"MULTIPLE_LOGIN_KICKOUT\";break;default:t.code=e,t.message=\"kickout reason = \"+e}return t},e.dataReportEvent=function(e,t,r,o,s){switch(r){case\"eventStart\":e.eventStart(t,o);break;case\"eventEndWithMsgInfo\":e.eventEndWithMsgInfo(t,o,s[0]);break;case\"addEventMsg\":e.addEventMsg(t,o,s[0],s[1]);break;case\"addEvent\":e.addEvent(t,o);break;case\"eventEnd\":e.eventEnd(t,o);break;case\"addMsgInfo\":e.addMsgInfo(t,s[0])}},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,o){var s,a=[],i=[],n=[];r||(r=[]);for(var E=0;E<r.length;E++)if(r[E].anchor_id_name!=e){s=!1;for(var l=0;l<t.length;l++)if(r[E].stream_id===t[l].stream_id){r[E].extra_info!==t[l].extra_info&&n.push(r[E]),s=!0;break}s||a.push(r[E])}for(var _=0;_<t.length;_++){s=!1;for(var u=0;u<r.length;u++)if(t[_].stream_id===r[u].stream_id){s=!0;break}s||i.push(t[_])}t.splice(0);for(E=0;E<r.length;E++)t.push(r[E]);o(a,i,n)},e.checkInteger=function(e,t){return 0==t?\"number\"==typeof e&&e%1==0&&e>=0:\"number\"==typeof e&&e%1==0&&e>0},e.checkValidNumber=function(e,t,r){return t=t||1,r=r||1e4,\"number\"==typeof e&&e%1==0&&e>=t&&e<=r},e.uuid=function(e,t){var r,o=\"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\".split(\"\"),s=[];if(t=t||o.length,e)for(r=0;r<e;r++)s[r]=o[0|Math.random()*t];else{var a=void 0;for(s[8]=s[13]=s[18]=s[23]=\"-\",s[14]=\"4\",r=0;r<36;r++)s[r]||(a=0|16*Math.random(),s[r]=o[19==r?3&a|8:a])}return s.join(\"\")},e.supportDetection=function(e,t){return o(this,void 0,void 0,(function(){var r,o,a,i,n,E;return s(this,(function(s){switch(s.label){case 0:return r={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e,errInfo:{}},((o=document.createElement(\"video\")).captureStream||o.mozCaptureStream)&&(r.customCapture=!0),navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?\"https:\"===window.location.protocol||\"file:\"===window.location.protocol||-1!=window.location.hostname.indexOf(\"127.0.0.1\")||-1!=window.location.hostname.indexOf(\"localhost\")?[3,1]:(r.camera=!1,console.error(\"webrtc requires https or localhost\"),[3,7]):[3,7];case 1:return s.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 2:return(a=s.sent())&&(r.camera=!0)&&a.getTracks().forEach((function(e){return e.stop()})),[3,4];case 3:return i=s.sent(),r.errInfo.camera={name:i.name,message:i.message},console.error(\"camera devices detect error: \",i.name,i.message),[3,4];case 4:return s.trys.push([4,6,,7]),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 5:return(n=s.sent())&&(r.microphone=!0)&&n.getTracks().forEach((function(e){return e.stop()})),[3,7];case 6:return E=s.sent(),r.errInfo.microphone={name:E.name,message:E.message},console.error(\"microphone devices detect error: \",E.name,E.message),[3,7];case 7:return this.supportVideoCodeType((function(e,o){r.videoCodec.H264=e.H264,r.videoCodec.H265=e.H265,r.videoCodec.VP8=e.VP8,r.videoCodec.VP9=e.VP9,r.webRTC=e.webRTC,o&&(r.errInfo.webRTC={name:o.name,message:o.message},console.error(\"videoCodec detect error: \"+o)),t&&t(r)})),[2]}}))}))},e.getNetQuality=function(e,t){return e&&e<600?t>.4?2:t>.3?4:5:e<900?t>.4?2:t>.2?3:4:t>.2?2:3},e.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],o=[],s=[],a=0;a<t.length;a++){var i=t[a];\"audioinput\"===i.kind&&r.push({deviceName:i.label,deviceID:i.deviceId}),\"audiooutput\"===i.kind&&o.push({deviceName:i.label,deviceID:i.deviceId}),\"videoinput\"===i.kind&&s.push({deviceName:i.label,deviceID:i.deviceId})}e&&e({microphones:r,speakers:o,cameras:s})})).catch((function(e){console.error(\"enumerate devices wrong \"+e),t&&t(a.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kEnumDevicesError)})):t&&t(a.ZegoRTCLogEvent.kZegoTaskEnumDevices.error.kBrowserNotSupportError)},e.compareVersion=function(e,t){e=e.split(\".\"),t=t.split(\".\");for(var r=Math.max(e.length,t.length);e.length<r;)e.push(\"0\");for(;t.length<r;)t.push(\"0\");for(var o=0;o<r;o++){var s=parseInt(e[o]),a=parseInt(t[o]);if(s>a)return 1;if(s<a)return-1}return 0},e.isSupportLive=function(e,t){var r=\"当前微信版本过低，无法使用相关组件\",o=\"需要摄像头和录音功能的授权\",s=wx.getSystemInfoSync().SDKVersion,a={code:0,msg:\"\"};this.compareVersion(s,\"1.7.0\")<0&&(a={code:10001,msg:r},e&&e(a)),wx.getSetting({success:function(t){var r=t.authSetting;r[\"scope.camera\"]&&r[\"scope.record\"]||(a={code:10002,msg:o}),e&&e(a)},fail:function(e){console.error(\"get setting error\",e),t&&t(e)}})},e.supportVideoCodeType=function(e){var t={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1};try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){if(t.webRTC=!0,r&&r.sdp){var o=r.sdp.split(\"\\r\\n\");t.H264=o.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"H264/\")>-1})),t.VP8=o.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"VP8/\")>-1})),t.VP9=o.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"VP9/\")>-1})),t.H265=o.some((function(e){return e.startsWith(\"a=rtpmap:\")&&e.indexOf(\"H265/\")>-1})),e&&e(t)}}))}catch(r){e&&e(t,r)}},e.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\\s*\\w*\\s*\\([\\w\\s,]*\\)\\s*{([\\w\\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:\"text/javascript\"}));return new Worker(r)}return null},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf(\"MSIE\"),r=-1!=e.indexOf(\"Firefox\"),o=null!=window.opr,s=e.indexOf(\"Chrome\")&&window.chrome,a=-1!=e.indexOf(\"Safari\")&&-1!=e.indexOf(\"Version\");return t?\"IE\":r?\"Firefox\":o?\"Opera\":s?\"Chrome\":a?\"Safari\":\"Unkown\"},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?\"PUBLISHING\":\"NO_PUBLISH\":\"PUBLISH_REQUESTING\"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?\"PLAYING\":\"NO_PLAY\":\"PLAY_REQUESTING\"},e.getSteamUpdateType=function(e){return 0==e?\"DELETE\":\"ADD\"},e.checkScreenParams=function(t,r){if(\"object\"==typeof t&&void 0!==t.videoQuality&&!e.checkInteger(t.videoQuality))return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" videoQuality must be integer number\"),!1;if(\"object\"==typeof t&&4===t.videoQuality){if(void 0===t.bitRate)return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" bitrate is required when videoQuality is 4\"),!1;if(!e.checkInteger(t.bitRate))return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" bitrate must be integer number\"),!1;if(t.bitRate>10240)return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" bitrate cannot greater than 10 Mbps\"),!1;if(void 0===t.frameRate)return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" frameRate is required when videoQuality is 4\"),!1;if(!e.checkInteger(t.frameRate))return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" frameRate must be integer number\"),!1;if(void 0===t.width)return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" width is required when videoQuality is 4\"),!1;if(!e.checkInteger(t.width))return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" width must be integer number\"),!1;if(void 0===t.height)return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" height is required when videoQuality is 4\"),!1;if(!e.checkInteger(t.height))return r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" height must be integer number\"),!1}return!0},e.checkCameraParams=function(t,r){return t.width&&e.checkValidNumber(t.width)?t.height&&e.checkValidNumber(t.height)?t.frameRate&&e.checkValidNumber(t.frameRate)?!(!t.bitRate||!e.checkValidNumber(t.bitRate))||(r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" bitrate must be integer number\"),!1):(r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" frameRate must be integer number\"),!1):(r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" height must be integer number\"),!1):(r(a.ZegoRTCLogEvent.kZegoTaskCreateStream.error.kParamError,\" width must be integer number\"),!1)},e.isParamEmpty=function(e){return null!=e&&\"\"!==e},e.isTypeString=function(e){return\"string\"==typeof e},e.isTooLong=function(e,t){return!(e.length>=t)},e.isReDispatch=function(e){var t=e.message.match(/action:(\\d+)/),r=t?Number(t[1]):NaN;return[a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kTTLOverTimeError,a.ZegoRTCLogEvent.kZegoTaskPlayStart.error.kClientIPChangedError,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kTTLOverTimeError,a.ZegoRTCLogEvent.kZegoTaskPublishStart.error.kClientIPChangedError].includes(e)||[6].includes(r)},e.arrAvg=function(e,t,r){return e.push(t),e.length>r&&e.shift(),e.reduce((function(e,t){return e+t}))/e.length},e}();t.ClientUtil=i},function(t,r){t.exports=e},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.errorCodeList=t.innerErrList=void 0,t.innerErrList={SUCCESS:{code:0,message:\"\"},SEND_MSG_TIMEOUT:{code:\"Error.Timeout\",message:\"send customessage timeout.\"}},t.errorCodeList={NOT_LOGIN:{code:1000002,message:\"not login room\"},STREAMID_TOO_LONG:{code:1000014,message:\"stream ID is too long\"},STREAM_ID_NULL:{code:1000015,message:\"streamID is empty\"},STREAM_ID_INVALID_CHARACTER:{code:1000016,message:\"stream ID contains illegal characters\"},NETWORK_BROKEN:{code:1000017,message:\"network is broken\"},LOCALSTREAM_WRONG:{code:1000018,message:\"local stream wrong\"},GET_SOUND_LEVEL_FAIL:{code:1000019,message:\"get sound level error\"},INPUT_PARAM:{code:1100001,message:\"input parm error.\"},TIMEOUT:{code:1100002,message:\"network timeout.\"},SOCKET_CLOSE:{code:1100003,msg:\"socket close\"},UNKNOWN_SERVER_ERROR:{code:1100999,message:\"unknown server error\"},INIT_SDK_WRONG:{code:1101e3,message:\"init sdk wrong\"},WX_GETSETTING_FAIL:{code:1101001,message:\"wx getsetting fail\"},USER_ID_NULL:{code:1002005,message:\"user ID is empty\"},USER_ID_INVALID_CHARACTER:{code:1002006,message:\"user ID contains illegal characters\"},USER_ID_TOO_LONG:{code:1002007,message:\"user ID is too long\"},USER_NAME_NULL:{code:1002008,message:\"username is empty\"},USER_NAME_TOO_LONG:{code:1002010,message:\"username is too long\"},ROOM_ID_NULL:{code:1002011,message:\"room ID is empty\"},ROOM_ID_INVALID_CHARACTER:{code:1002012,message:\"room ID contains illegal characters\"},ROOM_ID_TOO_LONG:{code:1002013,message:\"room ID is too long\"},LOGIN_TIMEOUT:{code:1002031,message:\"login timeout\"},ROOM_MAX_USER_COUNT:{code:1002034,message:\"users logging into the room exceeds the maximum number\"},MULTIPLE_LOGIN_KICKOUT:{code:1002050,message:\"kickout may be the same user ID login other\"},ROOM_RETRY_TIMEOUT:{code:1002053,message:\"network is broken and login fail.\"},MANUAL_KICKOUT:{code:1002055,message:\"server has sent a signal to kick out\"},ROOM_INNER_ERROR:{code:1002099,message:\"room inner error\"},HEARTBEAT_TIMEOUT:{code:1102001,message:\"heartbeat timeout.\"},PARSE_JSON_ERROR:{code:1102011,message:\"parse json error.\"},LOGIN_PROCESSING:{code:1102012,message:\"login is processing.\"},LIVEROMM_REQUEST_ERROR:{code:1102013,message:\"liveroom request error.\"},ZPUSH_REQUEST_FAIL:{code:1102014,message:\"zpush request fail.\"},LOGIN_STATE_WRONG:{code:1102015,message:\"user login state is wrong.\"},TOKEN_ERROR:{code:1102016,message:\"token error\"},DISPATCH_ERROR:{code:1102017,message:\"dispatch error\"},TOKEN_EXPIRED:{code:1102018,message:\"token expired\"},SUBCMD_ERROR:{code:1102019,message:\"subcmd error.\"},ZEGO_AUTH_ERROR:{code:1102020,message:\"zego auth error.\"},BIZ_CHANNEL_ERROR:{code:1102021,message:\"biz channel error.\"},DISPATCH_TIMEOUT:{code:1102022,message:\"dispatch request timeout\"},CONNECT_FAILED:{code:1102023,message:\"connect signal fail\"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:\"extra info of publshing stream is null\"},PUBLISHER_EXTRA_INFO_TOO_LONG:{code:1003051,message:\"stream extra info is too long\"},PUBLISHER_PARAM:{code:1103001,message:\"input parm error\"},PUBLISHER_BROWSER_NOT_SUPPORT:{code:1103002,message:\"browser do not support\"},PUBLISHER_DISPATCH_FAIL:{code:1103003,message:\"dispatch request error\"},PUBLISHER_SCREEN_FAILED:{code:1103010,message:\"screen fail\"},ENUMERATE_DEVICES_FAIL:{code:1103011,message:\"enumerate devices fail\"},PUBLISHER_DISPATCH_REQUEST_FAIL:{code:1103020,message:\"dispatch request fail\"},PUBLISHER_SESSION_REQUEST_FAIL:{code:1103021,message:\"session request fail\"},PUBLISHER_CREATE_OFFER_ERROR:{code:1103022,message:\"create offer error\"},PUBLISHER_SET_LOCAL_DESC_ERROR:{code:1103023,message:\"setLocalDescription error\"},PUBLISHER_MEDIA_DESC_ERROR:{code:1103024,message:\"mediaDesc error\"},PUBLISHER_SET_REMOTE_DESC_ERROR:{code:1103025,message:\"other side offer error\"},PUBLISHER_CANDIDATE_ERROR:{code:1103026,message:\"candidate error\"},PUBLISHER_SESSION_CLOSED:{code:1103027,message:\"server session closed\"},PUBLISHER_MEDIA_CONNECTION_ERROR:{code:1103028,message:\"ice connection error\"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:\"constraint error\"},PUBLISHER_SERVER_NEGO_TIMEOUT:{code:1103030,message:\"negotiation timeout\"},PUBLISH_NOT_PUBLISH:{code:1103040,message:\"publisher not found\"},PUBLISH_DEVICE_OUT_ERR:{code:1103041,message:\"device change \"},PUBLISH_SCREEN_CANCELED:{code:1103042,message:\"screen canceled\"},PUBLISH_SCREEN_NOT_SUPPORT:{code:1103043,message:\"screen not support\"},PUBLISH_NO_PREVIEW:{code:1103044,message:\"stream is not from zego\"},VIDEO_DEVICE_FALSE:{code:1103045,message:\"video is false\"},AUDIO_DEVICE_FALSE:{code:1103046,message:\"audio is false\"},TRACK_NOT_FOUND:{code:1103047,message:\"track is not found\"},DEVICE_NOT_FOUND:{code:1103048,message:\"device is not found\"},REPEATED_PULL:{code:1103049,message:\"repeated pull same stream\"},PUBLISHER_WEBSOCKET_DISCONNECTED:{code:1103050,message:\"websocket disconnected\"},PUBLISHER_RETRY_TIMEOUT:{code:1103051,message:\"publisher retry timeout\"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:\"publisher cdn push error\"},PUBLISHER_HTTPS_REQUIRED:{code:1103053,message:\"https is required\"},PUBLISHER_NO_PREVIEW:{code:1103054,message:\"no preview\"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:\"publish stream no found\"},PUBLISHER_IS_PUBLISHING:{code:1103056,message:\"publish is publishing\"},PUBLISHER_DECODE_AUDIO_FAIL:{code:1103057,message:\"decode audio data fail\"},PUBLISHER_CLIENT_IP_CHANGED:{code:1103058,message:\"client ip changed\"},PUBLISHER_TTL_OVERTIME:{code:1103059,message:\"ttl over time\"},PLAYER_PARAM:{code:1104001,message:\"input parm error\"},PLAYER_DISPATCH_REQUEST_FAIL:{code:1104020,message:\"dispatch request fail\"},PLAYER_SESSION_REQUEST_FAIL:{code:1104021,message:\"session request fail\"},PLAYER_CREATE_OFFER_ERROR:{code:1104022,message:\"create offer error\"},PLAYER_SET_LOCAL_DESC_ERROR:{code:1104023,message:\"setLocalDescription error\"},PLAYER_MEDIA_DESC_ERROR:{code:1104024,message:\"mediaDesc error\"},PLAYER_SET_REMOTE_DESC_ERROR:{code:1104025,message:\"other side offer error\"},PLAYER_CANDIDATE_ERROR:{code:1104026,message:\"candidate error\"},PLAYER_SESSION_CLOSED:{code:1104027,message:\"server session closed\"},PLAYER_MEDIA_CONNECTION_ERROR:{code:1104028,message:\"ice connection error\"},PLAYER_WEBSOCKET_DISCONNECTED:{code:1104029,message:\"websocket disconnected\"},PLAYER_SERVER_NEGO_TIMEOUT:{code:1104030,message:\"negotiation timeout\"},PLAYER_RETRY_TIMEOUT:{code:1104031,message:\"player retry timeout\"},PLAYER_IS_PLAYING:{code:1104032,message:\"player is playing\"},PLAYER_CLIENT_IP_CHANGED:{code:1104033,message:\"client ip changed\"},PLAYER_TTL_OVERTIME:{code:1104034,message:\"ttl is over time\"},PLAYER_SESSION_RESET:{code:1104035,message:\"reset session push\"},MIXER_NO_SERVICES:{code:1005e3,message:\"no mix stream service\"},MIXER_TASK_ID_NULL:{code:1005001,message:\"mixer task is null\"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:\"task ID is too long\"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:\"task ID contains illegal characters\"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:\"task configuration does not specify output\"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:\"stream output target is incorrect\"},MIXER_START_REQUEST_ERROR:{code:1005010,message:\"start mixer task fail, possibly due to network reasons\"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:\"stop mixer task fail, possibly due to network reasons\"},MIXER_NOT_OWNER_STOPMIXER:{code:1005012,message:\" maxed task must be stopped by the start user of the task\"},MIXER_INPUTLIST_NULL:{code:1005020,message:\"Mixed stream task input list is null\"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:\"Mixed stream task output list is null\"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:\"invalid mixed stream task video configuration\"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:\"more than the maximum number of input streams\"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:\"Input stream does not exist\"},MIXER_INPUT_PARAMETERS_ERROR:{code:1005027,message:\"stream input parameters are wrong\"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:\"more than the maximum number of output streams\"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:\"mixed stream authentication failed\"},MIXER_WATERMARK_NULL:{code:1005061,mag:\"input watermark is null\"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:\"input watermark parameter is wrong\"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:\"illegal input watermark URL\"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:\"illegal input background image URL\"},MIXER_INNER_ERROR:{code:1005099,message:\"mixed stream internal error\"},DEVICE_ERROR_TYPE_UNPLUGGED:{code:1006006,message:\"the device is unplugged\"},IM_CONTENT_NULL:{code:1009001,message:\"message content is empty\"},IM_CONTENT_TOO_LONG:{code:1009002,message:\"message content is too long\"},IM_SEND_FAILED:{code:1009010,message:\"failed to send message\"},FREQ_LIMITED:{code:1109001,message:\"frequency limited.\"}}},function(e,t,r){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoExpressEngine=void 0;var a=r(4),i=r(7),n=function(e){function t(t,r){var o=this;return a.ZegoExpressWebRTMEngine.version=\"2.2.1\",(o=e.call(this,t,r,1)||this).zegoWechatMini=new i.ZegoWechatMini(o.logger,o.dataReport,o.zegoWebRTM),o}return s(t,e),t.prototype.checkSystemRequirements=function(){return this.zegoWechatMini.checkSystemRequirements()},t.prototype.getNextUrl=function(e){return this.zegoWechatMini.getNextUrl(e)},t.prototype.off=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.off(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.off(e,t)},t.prototype.on=function(e,t){return this.zegoWebRTM.stateCenter.listenerList[e]?this.zegoWebRTM.on(e,t):!!this.zegoWechatMini.stateCenter.listenerList[e]&&this.zegoWechatMini.on(e,t)},t.prototype.setMixerTaskConfig=function(e){return this.zegoWechatMini.setMixerTaskConfig(e)},t.prototype.startMixerTask=function(e){return this.zegoWechatMini.startMixerTask(e)},t.prototype.startPlayingStream=function(e,t){return this.zegoWechatMini.startPlayingStream(e,t)},t.prototype.stopMixerTask=function(e){return this.zegoWechatMini.stopMixerTask(e)},t.prototype.stopPlayingStream=function(e){return this.zegoWechatMini.stopPlayingStream(e)},t.prototype.updatePlayerNetStatus=function(e,t){return this.zegoWechatMini.updatePlayerNetStatus(e,t)},t.prototype.updatePlayerState=function(e,t){return this.zegoWechatMini.updatePlayerState(e,t)},t.prototype.startPublishingStream=function(e,t){return this.zegoWechatMini.startPublishingStream(e,t)},t.prototype.stopPublishingStream=function(e){return this.zegoWechatMini.stopPublishingStream(e)},t.prototype.addPublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.addPublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.addPublishCdnUrl(e,t)},t.prototype.removePublishCdnUrl=function(e,t){return 3===arguments.length?this.zegoWechatMini.removePublishCdnUrl(arguments[0],arguments[2]):this.zegoWechatMini.removePublishCdnUrl(e,t)},t.prototype.setStreamExtraInfo=function(e,t){return this.zegoWechatMini.setStreamExtraInfo(e,t)},t}(a.ZegoExpressWebRTMEngine);t.ZegoExpressEngine=n},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoWechatMini=void 0;var o=r(2),s=r(8),a=r(0),i=r(1),n=r(3),E=r(9),l=function(){function e(e,t,r){this.logger=e,this.dataReport=t,this.rtm=r,this.stateCenter=new s.StateCenter(this.logger),this.stateCenter.clientType=\"wxMini\",this.wechatMiniModules=new E.WechatMiniModules(this.logger,this.dataReport,this.stateCenter,this.rtm)}return e.prototype.checkSystemRequirements=function(){return this.wechatMiniModules.checkSystemRequirements()},e.prototype.getVersion=function(){return a.PROTO_VERSION},e.prototype.on=function(e,t){return this.wechatMiniModules.bindListener(e,t)},e.prototype.off=function(e,t){return this.wechatMiniModules.deleteListener(e,t)},e.prototype.startPublishingStream=function(e,t){return this.wechatMiniModules.publishModule.startPublishingStream(e,t)},e.prototype.stopPublishingStream=function(e){return this.wechatMiniModules.publishModule.stopPublishingStream(e)},e.prototype.getNextUrl=function(e){return this.wechatMiniModules.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+\" call: \"+JSON.stringify(e)),!e||0==e.length)return this.logger.error(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+\" param error\"),!1;var r=!0;e.forEach((function(e){return 0!=e.indexOf(\"rtmp://\")&&(r=!1)})),r?t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e:this.logger.error(o.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+\" url is not correct\")},e.prototype.addPublishCdnUrl=function(e,t){return this.logger.info(o.ZEGO_WECHATMINI_ACTION.ADD_PUBLISH_CDN_URL+\" call \"+e+\" \"+t),this.wechatMiniModules.streamHandler.publishTarget({type:\"addpush\",streamID:e,pushUrl:t})},e.prototype.removePublishCdnUrl=function(e,t){return this.logger.info(o.ZEGO_WECHATMINI_ACTION.REMOVE_PUBLISH_CDN_URL+\" call \"+e+\" \"+t),this.wechatMiniModules.streamHandler.publishTarget({type:\"delpush\",streamID:e,pushUrl:t})},e.prototype.startMixerTask=function(e){var t=this;return new Promise((function(r,o){e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var s=a.getReportSeq();t.dataReport.newReport(s,i.ZegoWechatLogEvent.kZegoTaskMixStart.event),n.ClientUtil.logReportCallback(\"kZegoTaskMixStart\"+e.taskID,t.dataReport,s,t.stateCenter.reportList);t.wechatMiniModules.streamHandler.updateMixStream(e,(function(o){t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback(\"kZegoTaskMixStart\"+e.taskID,t.stateCenter.reportList),r(o)}),(function(r){var a,i;r.errorCode<2e9&&r.errorCode>1e9?(n.ClientUtil.mixServerError(r.errorCode)[0],a=n.ClientUtil.mixServerError(r.errorCode)[1],i=n.ClientUtil.mixServerError(r.errorCode)[1]):r.errorCode<1e6&&(i=n.ClientUtil.decodeServerError(r.errorCode,r.extendedData),a=n.ClientUtil.getLiveRoomError(r.errorCode)),i?t.dataReport.addMsgInfo(s,i):t.dataReport.addMsgInfo(s,r),t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback(\"kZegoTaskMixStart\"+e.taskID,t.stateCenter.reportList),a&&(r.errorCode=errorCodeList[a].code),o(r)}))}))},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,o){var s=a.getReportSeq();t.dataReport.newReport(s,i.ZegoWechatLogEvent.kZegoTaskMixConfig.event),n.ClientUtil.logReportCallback(\"kZegoTaskMixConfig\",t.dataReport,s,t.stateCenter.reportList),t.wechatMiniModules.streamHandler.setMixerTaskConfig(e).then((function(e){t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList),r(e)})).catch((function(e){t.dataReport.addMsgInfo(s,e),t.dataReport.uploadReport(s),n.ClientUtil.unregisterCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList),o(e)}))}))},e.prototype.stopMixerTask=function(e){var t=this;return new Promise((function(r,s){var E=a.getReportSeq();if(t.dataReport.newReport(E,i.ZegoWechatLogEvent.kZegoTaskMixStop.event),!e||\"string\"!=typeof e||e.length>a.MAX_MIX_TASK_ID_LENGTH||!n.ClientUtil.checkIllegalCharacters(e))return t.logger.error(o.ZEGO_WECHATMINI_ACTION.STOP_MIXER_TASK+\" taskID must be string less 256\"),t.dataReport.addMsgInfo(E,{error:i.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.code,message:i.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.message+\" param taskID error\"}),t.dataReport.uploadReport(E),void s({errorCode:i.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:i.ZegoWechatLogEvent.kZegoTaskMixStop.error.kParamError.message+\" param taskID error\"});t.wechatMiniModules.streamHandler.stopMixStream(e,(function(e){t.dataReport.uploadReport(E),r(e)}),(function(e){var r,o;e.errorCode<2e9&&e.errorCode>1e9?(n.ClientUtil.mixServerError(e.errorCode-a.MIXSTREAM_ERROR_CODE)[0],o=n.ClientUtil.mixServerError(e.errorCode-a.MIXSTREAM_ERROR_CODE)[1],r=n.ClientUtil.mixServerError(e.errorCode-a.MIXSTREAM_ERROR_CODE)[1]):e.errorCode<1e6&&(r=n.ClientUtil.decodeServerError(e.errorCode,e.extendedData),o=n.ClientUtil.getLiveRoomError(e.errorCode)),r?t.dataReport.addMsgInfo(E,r):t.dataReport.addMsgInfo(E,e),t.dataReport.uploadReport(E),o&&(e.errorCode=errorCodeList[o].code),s(e)}))}))},e.prototype.setStreamExtraInfo=function(e,t){return this.wechatMiniModules.streamHandler.setStreamExtraInfo(e,t)},e.prototype.startPlayingStream=function(e,t){return this.wechatMiniModules.playModule.startPlayingStream(e,t)},e.prototype.stopPlayingStream=function(e){this.wechatMiniModules.playModule.stopPlayingStream(e)},e.prototype.updatePlayerState=function(e,t){this.wechatMiniModules.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.wechatMiniModules.updatePlayerNetStatus(e,t)},e}();t.ZegoWechatMini=l},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.StateCenter=void 0;var o=r(2),s=r(0),a=function(){function e(e){this.debug=!1,this.testEnvironment=!1,this.pullLimited=!0,this.configOK=!1,this.relateService=[],this.role=2,this.maxMemberCount=0,this.roomCreateFlag=1,this.callbackList={},this.streamQuerying=!1,this.streamSeq=0,this.streamList=[],this.publishStreamList={},this.isResetRoom=!1,this.streamUrlMap={},this.cmdCallback={},this.customUrl=[],this.customPlayUrl=[],this.turnOverTcpOnly=!1,this.customSetTcpOrUdp=!1,this.supportUdp=!1,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[],soundLevelUpdate:[],videoDeviceStateChanged:[],audioDeviceStateChanged:[],deviceError:[],_deviceError:[],_remoteCameraStatusUpdate:[],_remoteMicStatusUpdate:[],_streamUpdated:[]},this.reportList={},this.reportSeqList={startPublish:{},rePublish:{},startPlay:{},rePlay:{},stopPublish:{},stopPlay:{}},this.streamTrigger={},this.mixStreamAdvance={},this.audioStreamList={},this.deviceInfos=null,this.deviceChangeTimer=null,this.deviceStateOut=!1,this.networkState=s.ENUM_NETWORK_STATE.offline,this.streamRetryTime=300,this.anchor_info={anchor_id:\"\",anchor_id_name:\"\",anchor_nick_name:\"\"},this.streamInfoList={},this.clientIP=\"\",this.logger=e}return e.prototype.getRequestId=function(){return this.idName+\"-\"+s.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r){var o={request_id:e,room_id:this.roomid,from_userid:this.idName,from_username:this.nickName,to_userid:t};return null!=r&&(o.result=r),JSON.stringify(o)},e.prototype.actionListener=function(e){for(var t=this,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];this.listenerList[e]&&this.listenerList[e].forEach((function(s){try{setTimeout((function(){s.apply(void 0,r)}),0)}catch(r){t.logger.error(o.ZEGO_WEBRTC_ACTION.STATECENTER_ACTION_LISTENER+\" \"+e+\" \"+r)}}))},e}();t.StateCenter=a},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.WechatMiniModules=void 0;var o=r(10),s=r(13),a=r(14),i=r(15),n=r(0),E=r(1),l=r(3),_=r(2),u=function(){function e(e,t,r,E){this.logger=e,this.dataReport=t,this.stateCenter=r,this.rtm=E,this.currentPlaySourceType=n.ENUM_DISPATCH_TYPE.cdn,this.mixStreamList={},this.ultraPlaySourceType=\"rtmp_v2\",this.streamCenter=new o.ZegoStreamCenterWechat(this.logger,this.stateCenter,this.dataReport),this.streamHandler=new s.StreamHandler(this.logger,this.stateCenter,this.rtm,this.dataReport,this.streamCenter),this.publishModule=new a.PublishModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.streamHandler,this.rtm),this.playModule=new i.PlayModule(this.logger,this.dataReport,this.stateCenter,this.streamCenter,this.rtm),this.init()}return e.prototype.init=function(){this.bindRTMListener(),this.bindStreamHandler(),this.bindStreamCenterHandler()},e.prototype.bindRTMListener=function(){var e=this;this.rtm._on(\"roomLoginResponse\",(function(t){e.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+\" roomLoginResponse call \"),e.stateCenter.appid=e.rtm.getAppID(),e.stateCenter.idName=e.rtm.getUserID(),e.stateCenter.token=e.rtm.getToken(),e.stateCenter.testEnvironment=e.rtm.isTestEnvironment(),e.stateCenter.sessionid=e.rtm.getSessionId(),e.streamHandler.handleStreamStart(t),e.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+\" roomLoginResponse end\")})),this.rtm._on(\"HBResponse\",(function(t){e.streamHandler.fetchStreamList(t)})),this.rtm._on(\"_roomStateUpdate\",(function(t,r,o,s){\"DISCONNECTED\"==r?(e.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+\" _roomStateUpdate \"+t+\" disconnected \"+o?o+\" \":\"\"+s?s:\"\"),e.stateCenter.isResetRoom=!0,e.stateCenter.streamList=[],e.streamCenter.reset()):e.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_RTM_LISTENER+\" _roomStateUpdate \"+t+\" state\")}))},e.prototype.bindStreamHandler=function(){var e=this;this.streamHandler.onStreamUpdated=function(t,r,o){var s=o.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),a=n.getReportSeq();if(e.dataReport.newReport(a,E.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.event),e.dataReport.addMsgInfo(a,{stream_update_type:E.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.stream_update_type(1===r?\"added\":\"deleted\"),update_stream:E.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamUpdateInfo.update_stream(o)}),e.dataReport.uploadReport(a),e.stateCenter.actionListener(\"roomStreamUpdate\",t,l.ClientUtil.getSteamUpdateType(r),s),1===r){var i=[];s.forEach((function(e){e.extraInfo&&i.push({streamID:e.streamID,user:e.user,extraInfo:e.extraInfo})})),i.length>0&&e.stateCenter.actionListener(\"streamExtraInfoUpdate\",t,i)}},this.streamHandler.onPublishStateUpdate=function(t,r,o){e.logger.info(_.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE+\" \"+r);var s=e.stateCenter.reportSeqList.startPublish[r];e.streamCenter.publishingList[r]&&(0==t||1==t)&&s&&(e.dataReport.eventEndWithMsgInfo(s,\"PublishState\",{type:t}),1==t&&e.dataReport.addMsgInfo(s,o),e.dataReport.uploadReport(s),delete e.stateCenter.reportSeqList.startPublish[r]),e.stateCenter.actionListener(\"publisherStateUpdate\",{state:l.ClientUtil.getPublisherStateType(t),streamID:r,errorCode:o.code,extendedData:o.message})},this.streamHandler.onStreamExtraInfoUpdated=function(t,r){var o=r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}})),s=n.getReportSeq();e.dataReport.newReport(s,E.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.event),e.dataReport.addMsgInfo(s,{update_stream:E.ZegoWechatLogEvent.kZegoTaskLiveRoomGetStreamExtraInfo.update_stream(o)}),e.dataReport.uploadReport(s),e.stateCenter.actionListener(\"streamExtraInfoUpdate\",t,o)}},e.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,o){var s=e.stateCenter.reportSeqList.startPlay[r];e.streamCenter.playingList[r]&&(0==t||1==t)&&s&&(e.dataReport.eventEndWithMsgInfo(s,\"PlayState\",{type:t}),1==t&&o&&e.dataReport.addMsgInfo(s,o),e.dataReport.uploadReport(s),delete e.stateCenter.reportSeqList.startPlay[r]),e.stateCenter.actionListener(\"playerStateUpdate\",{state:l.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:o&&o.code,extendedData:o&&o.message})},this.streamCenter.onPublishStateUpdate=function(t,r,o){e.onPublishStateUpdateHandle(t,r,o)},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener(\"publishQualityUpdate\",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener(\"playQualityUpdate\",t,r)}},e.prototype.onPublishStateUpdateHandle=function(e,t,r){this.logger.info(_.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE_HANDLE+\" call\"),0==e?this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].state!=n.ENUM_PUBLISH_STREAM_STATE.tryPublish||this.stateCenter.streamList.find((function(e){return e.stream_id==t}))?(this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.publishing,this.streamHandler.onPublishStateUpdate(e,t,r),this.dataReport.uploadReport(this.stateCenter.reportSeqList.startPublish[t]),delete this.stateCenter.reportSeqList.startPublish[t],l.ClientUtil.unregisterCallback(\"kZegoTaskPublishStart\"+t,this.stateCenter.reportList)):(this.stateCenter.publishStreamList[t].state=n.ENUM_PUBLISH_STREAM_STATE.update_info,this.streamHandler.updateStreamInfo(t,n.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info))):(this.streamHandler.onPublishStateUpdate(e,t,r),1==e&&(this.logger.info(_.ZEGO_WECHATMINI_ACTION.ON_PUBLISH_STATE_UPDATE_HANDLE+\" stop publish called by sdk\"),this.publishModule.stopPublishingStream(t)))},e.prototype.bindListener=function(e,t){return this.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+\" call\"),this.stateCenter.listenerList[e]?\"function\"!=typeof t?(this.logger.error(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+\" listener callBack must be function\"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_BIND_LISTENER+\" event \"+e+\" no found\"),!1)},e.prototype.deleteListener=function(e,t){if(this.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_DELETE_LISTENER+\" call\"),!this.stateCenter.listenerList[e])return this.logger.error(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_DELETE_LISTENER+\" listener no found\"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},e.prototype.checkSystemRequirements=function(){var e=this;return new Promise((function(t,r){var o=n.getReportSeq();e.dataReport.newReport(o,E.ZegoWechatLogEvent.kZegoTaskCheckSystemRequirements.event);l.ClientUtil.isSupportLive((function(r){e.dataReport.addMsgInfo(o,{check_system:r}),e.dataReport.uploadReport(o),t(r)}),(function(t){e.dataReport.addMsgInfo(o,E.ZegoWechatLogEvent.kZegoTaskCheckSystemRequirements.error.kCheckSystemGetSettingFailError),e.dataReport.uploadReport(o),r(t)}))}))},e.prototype.updatePlayerState=function(e,t){this.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_STATE+\" call \"+e),this.streamCenter.updatePlayerState(e,t)},e.prototype.updatePlayerNetStatus=function(e,t){this.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_UPDATE_PLAYER_NET_STATUS+\" call \"+e),this.streamCenter.updatePlayerNetStatus(e,t)},e.prototype.getNextUrl=function(e){return\"string\"!=typeof e||\"\"==e?(this.logger.error(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_GET_NEXT_URL+\" stream ID must be string and not empty\"),\"\"):this.streamCenter.getNextUrl(e)},e.prototype.setCustomSignalUrl=function(e,t){if(void 0===t&&(t=!0),this.logger.info(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+\" call: \"+JSON.stringify(e)),!e||0==e.length)return this.logger.error(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+\" param error\"),!1;var r=!0;e.forEach((function(e){return 0!=e.indexOf(\"rtmp://\")&&(r=!1)})),r?t?this.stateCenter.customUrl=e:this.stateCenter.customPlayUrl=e:this.logger.error(_.ZEGO_WECHATMINI_ACTION.WECHATMINI_SET_CUSTOM_SIGNAL_URL+\" url is not correct\")},e}();t.WechatMiniModules=u},function(e,t,r){var o,s=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoStreamCenterWechat=void 0;var a=r(2),i=r(11),n=r(0),E=r(1),l=r(3),_=r(12),u=0,d=1,T=2,p=0,c=1,g=function(e){function t(t,r,o){var s=e.call(this)||this;return s.playerList={},s.playerCount=0,s.playingList=[],s.publishingList=[],s.eventSeq=0,s.streamEventMap={},s.streamReportMap={},s.playerWaitingList=[],s.playerStatistics={},s.publishSuccessCallBackList={},s.publishErrorCallBackList={},s.playSuccessCallBackList={},s.playErrorCallBackList={},s.logger=t,s.dataReport=o,s.stateCenter=r,s}return s(t,e),t.prototype.updatePlayingState=function(e,t,r){if(this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE+\" \"+e),null==e)return!1;if(r){var o=this.playerList[e],s=this.stateCenter.reportSeqList.startPlay[e];if(this.dataReport.eventStart(s,\"updatePlayingState\"),o)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYING_STATE+\" player already exist\"),this.dataReport.eventEndWithMsgInfo(s,\"updatePlayingState\",{message:\"player already exist\"}),this.dataReport.uploadReport(s,void 0),delete this.stateCenter.reportSeqList.startPlay[e],!1;this.playerList[e]=new _.ZegoPlayWechat(this.logger,e,this,this.dataReport,this.stateCenter)}return this.updateStreamState(e,r,t,this.playingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPlay[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,\"GotPlayInfo\")):this.reportPlayEvent(e),!0},t.prototype.updatePublishingState=function(e,t,r){if(void 0===t&&(t=\"\"),void 0===r&&(r=!1),this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE+\" \"+e),null==e)return!1;if(r){var o=this.playerList[e],s=this.stateCenter.reportSeqList.startPublish[e];if(this.dataReport.eventStart(s,\"updatePublishingState\"),o)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PUBLISHING_STATE+\" player already exist\"),this.dataReport.eventEndWithMsgInfo(s,\"updatePublishingState\",{message:\"player already exist\"}),this.dataReport.uploadReport(s,void 0),delete this.stateCenter.reportSeqList.startPublish[e],!1;this.playerList[e]=new _.ZegoPlayWechat(this.logger,e,this,this.dataReport,this.stateCenter)}return this.updateStreamState(e,r,t,this.publishingList),r?(this.streamEventMap[e]=this.stateCenter.reportSeqList.startPublish[e],this.eventSeq+=1,this.streamReportMap[e]=this.eventSeq,this.dataReport.newReport(this.eventSeq),this.dataReport.eventStart(this.eventSeq,\"GotPublishInfo\")):this.reportPublishEvent(e),!0},t.prototype.updateStreamState=function(e,t,r,o){if(e)if(r&&\"string\"==typeof r||(r=\"\"),1==t)o.push({streamID:e,params:r});else for(var s=0;s<o.length;s++)if(o[s].streamID==e){o.splice(s--,1);break}},t.prototype.isPlaying=function(){return 0!=this.playingList.length},t.prototype.isPublishing=function(){return 0!=this.publishingList.length},t.prototype.startPlayingStream=function(e,t,r){if(this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYING_STREAM+\" call \"+e),this.streamEventMap[e]){var o=\"\";0==r?o=\"cdn\":1==r&&(o=\"ultra_src\"),l.ClientUtil.actionLogReportCallback(\"kZegoTaskPlayStart\"+e,this.stateCenter.reportList,n.REPORT_ACTION.addEventMsg,\"get_play_url\",[\"type\",o]),l.ClientUtil.actionLogReportCallback(\"kZegoTaskPlayStart\"+e,this.stateCenter.reportList,n.REPORT_ACTION.addEventMsg,\"get_play_url\",[\"urls\",t])}var s=this.streamReportMap[e];return s&&this.dataReport.eventEndWithMsg(s,\"GotPlayInfo\",{type:0==r?\"cdn\":\"ultra_src\",urls:t}),this.startPlayer(e,t,r,p)},t.prototype.startPlayer=function(e,t,r,o){var s=this.playerList[e];if(!s)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+\" player don't exist\"),!1;var i=[];o==p?i=this.playingList:o==c&&(i=this.publishingList);for(var n=!1,E=\"\",l=0;l<i.length;l++)if(i[l].streamID==e){n=!0,E=i[l].params;break}if(!n)return this.logger.warn(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+\" should not start\"),!1;if(s.urls=t,s.params=E,s.reconnectLimit=this.getReconnectLimit(r),s.dispatchType=r,s.playerType=o,s.playerSeq=this.streamEventMap[e],s.playerReportSeq=this.streamReportMap[e],!s)return this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+\" new player failed\"),!1;++this.playerCount;var _=s.tryStartPlayer(0);return this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PLAYER+\" call result: \"+_),_},t.prototype.getNextUrl=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_GET_NEXT_URL+\" call \"+e);var t,r=this.playerList[e];if(!r)return this.logger.error(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_GET_NEXT_URL+\" player don't exist\"),\"\";this.publishingList.find((function(t){return t.streamID===e}))?(t=!0,this.onPublishStateUpdate(n.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:\"\"})):(t=!1,this.onPlayStateUpdate(T,e,{code:0,message:\"\"}));var o=r.getPlayerUrl();if(t){if(!this.stateCenter.reportSeqList.startPublish[e]){var s=n.getReportSeq();this.stateCenter.reportSeqList.startPublish[e]=s,this.dataReport.newReport(s,E.ZegoWechatLogEvent.kZegoTaskRePublish),r.pushBegin=!1,l.ClientUtil.logReportCallback(\"kZegoTaskPublishStart\"+e,this.dataReport,s,this.stateCenter.reportList)}}else if(!this.stateCenter.reportSeqList.startPlay[e]){s=n.getReportSeq();this.stateCenter.reportSeqList.startPlay[e]=s,this.dataReport.newReport(s,E.ZegoWechatLogEvent.kZegoTaskRePlay),r.playBegin=!1,l.ClientUtil.logReportCallback(\"kZegoTaskPlayStart\"+e,this.dataReport,s,this.stateCenter.reportList)}return o},t.prototype.stopPlayingStream=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYING_STREAM+\" call \"+e),null!=e&&(this.stopPlayer(e),this.updatePlayingState(e))},t.prototype.stopPlayer=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+\" call \"+e);var t=this.playerList[e];t?(t.stopPlayer(),delete this.playerList[e],--this.playerCount):this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+\" play not exist \"+e),this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PLAYER+\" call success\")},t.prototype.startPublishingStream=function(e,t,r){if(this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_START_PUBLISHING_STREAM+\" call \"+e),this.streamEventMap[e]){var o=\"\";0==r?o=\"cdn\":1==r&&(o=\"ultra_src\"),l.ClientUtil.actionLogReportCallback(\"kZegoTaskPublishStart\"+e,this.stateCenter.reportList,n.REPORT_ACTION.addEventMsg,\"type\",o),l.ClientUtil.actionLogReportCallback(\"kZegoTaskPublishStart\"+e,this.stateCenter.reportList,n.REPORT_ACTION.addEventMsg,\"urls\",t)}var s=this.streamReportMap[e];return s&&this.dataReport.eventEndWithMsg(s,\"GotPublishInfo\",{type:0==r?\"cdn\":\"ultra_src\",urls:t}),this.startPlayer(e,t,r,c)},t.prototype.stopPublishingStream=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_STOP_PUBLISHING_STREAM+\" call \"+e),null!=e&&(this.stopPlayer(e),this.updatePublishingState(e,\"\",!1))},t.prototype.updatePlayerState=function(e,t){var r=this.playerList[e];r?r.updateEvent(t):this.logger.error(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE+\" no player \"+e),this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_STATE+\" updatePlayerEvent success\")},t.prototype.updatePlayerNetStatus=function(e,t){var r=this.playerList[e];r?r.updatePlayerNetStatus(t):this.logger.error(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS+\" no player \"+e),this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_UPDATE_PLAYER_NET_STATUS+\" updatePlayerNetStatus success\")},t.prototype.reset=function(){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_RESET+\" call\");for(var e=0;e<this.playingList.length;e++)this.stopPlayingStream(this.playingList[e].streamID);for(var t=0;t<this.publishingList.length;t++)this.stopPublishingStream(this.publishingList[t].streamID);this.playerCount=0,this.playerList={},this.playerWaitingList=[],this.playerStatistics={},this.streamEventMap={},this.streamReportMap={},this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_RESET+\" call success\")},t.prototype.reportPublishEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:\"WXPublishStream\"}),this.dataReport.uploadReport(r,\"WXPublishStream\"),delete this.streamReportMap[e]}},t.prototype.reportPlayEvent=function(e,t){if(this.streamReportMap[e]){var r=this.streamReportMap[e];this.dataReport.addMsgExt(r,{stream:e,error:t}),this.dataReport.addMsgInfo(r,{itemtype:\"WXPlayStream\"}),this.dataReport.uploadReport(r,\"WXPlayStream\"),delete this.streamReportMap[e]}},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onPublisherStreamUrlUpdate=function(e,t){},t.prototype.onPublisherStreamUrlFail=function(e,t){},t.prototype.onPlayerStreamUrlUpdate=function(e,t){},t.prototype.getReconnectLimit=function(e){return 1},t.prototype.onPlayerStart=function(e,t){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_START+\" call \"+e),t==p?this.onPlayStateUpdate(u,e,{code:0,message:\"\"}):t==c&&this.onPublishStateUpdate(u,e,{code:0,message:\"\"})},t.prototype.onPlayerStop=function(e,t,r){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+\" call \"+e),t==p?(this.reportPlayEvent(e,r),this.logger.warn(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+\" play error\"),this.onPlayStateUpdate(d,e,r)):t==c&&(this.reportPublishEvent(e,r),this.logger.warn(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_STOP+\" publish error\"),this.onPublishStateUpdate(d,e,r))},t.prototype.onPlayerRetry=function(e,t){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_PLAY_RETRY+\" call \"+e),t==p?this.onPlayStateUpdate(T,e,{code:0,message:\"\"}):t==c&&this.onPublishStateUpdate(T,e,{code:0,message:\"\"})},t.prototype.onPlayerQuality=function(e,t,r){var o={video:{videoBitrate:t.videoBitrate,videoFPS:t.videoFPS,videoWidth:t.videoWidth,videoHeight:t.videoHeight},audio:{audioBitrate:t.audioBitrate}};r==p?this.onPlayQualityUpdate(e,o):r==c&&this.onPublishQualityUpdate(e,o)},t.prototype.onStreamUrlUpdate=function(e,t,r){this.logger.info(a.ZEGO_WECHATMINI_ACTION.STREAMCENTERWECHAT_ON_STREAM_URL_UPDATE+\" call \"+e),0==r?this.playSuccessCallBackList[e](e,t):this.publishSuccessCallBackList[e](e,t)},t.prototype.getTotalStreamId=function(e){return e},t.prototype.getRealStreamId=function(e){return e},t}(i.ZegoStreamCenter);t.ZegoStreamCenterWechat=g},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoStreamCenter=void 0;var o=function(){this.publisherList={},this.playerList={}};t.ZegoStreamCenter=o},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.ZegoPlayWechat=void 0;var o=r(2),s=r(3),a=r(0),i=r(1),n=function(){function e(e,t,r,o,s){this.urls=[],this.tryUrls=[],this.playUrlIndex=0,this.playUrlTryCount=0,this.currentUrl=null,this.retryIndex=0,this.reconnectCount=0,this.state=a.ENUM_PLAYER_STATE.stop,this.reconnectLimit=0,this.sourceType=0,this.playerType=0,this.playerSeq=0,this.playerReportSeq=0,this.publishQualitySeq=0,this.publishQualityCount=0,this.publishQulaityMaxCount=30,this.playQualitySeq=0,this.playQualityCount=0,this.playQulaityMaxCount=30,this.everSuccess=!1,this.pushBegin=!1,this.playBegin=!1,this.playerLogUploadTime=(new Date).getTime(),this.seq=-1,this.streamId=t,this.logger=e,this.streamCenter=r,this.dataReport=o,this.stateCenter=s}return e.prototype.resetPlayer=function(){this.state=a.ENUM_PLAYER_STATE.stop},e.prototype.newPlayer=function(){this.resetPlayer();var e=this.getCurrentPlayerUrl(),t=e;0!=this.params.length&&(t=e+\"?\"+this.params);var r=(new Date).getTime();return t=t.indexOf(\"?\")>-1?t+\"&zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid:t+\"?zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid,e!==this.currentUrl?(this.currentUrl=e,this.streamCenter.onStreamUrlUpdate(this.streamId,t,this.playerType)):this.streamCenter.onPlayerRetry(this.streamId,this.playerType),0==this.everSuccess?0==this.playerType?(this.dataReport.eventStart(this.playerReportSeq,\"PlayBegin\"),this.dataReport.addEventInfo(this.playerReportSeq,\"PlayBegin\",\"url\",t),this.tryUrls.push(t)):(this.dataReport.eventStart(this.playerReportSeq,\"PublishBegin\"),this.dataReport.addEventInfo(this.playerReportSeq,\"PublishBegin\",\"url\",t),this.tryUrls.push(t)):0==this.playerType?this.dataReport.addEventInfo(this.playerSeq,\"PlayRetry\",\"url\",t):this.dataReport.addEventInfo(this.playerSeq,\"PublishRetry\",\"url\",t),this.state=a.ENUM_PLAYER_STATE.start,!0},e.prototype.stopPlayer=function(){0==this.playerType?this.dataReport.eventEndWithMsg(this.playerReportSeq,\"PlayStat\",{quality:this.playerInfo}):(this.dataReport.addEventInfo(this.playerReportSeq,\"PublishStat\",\"quality\",this.playerInfo),this.dataReport.eventEndWithMsg(this.playerReportSeq,\"PublishStat\",{quality:this.playerInfo}))},e.prototype.tryStartPlayer=function(e){for(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+\" call\");this.playUrlTryCount<this.urls.length;)if(++this.reconnectCount>this.reconnectLimit)this.playUrlTryCount++,this.playUrlIndex=(this.playUrlIndex+1)%this.urls.length,this.reconnectCount=0;else if(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+\" index: \"+this.playUrlIndex+\", url: \"+this.getCurrentPlayerUrl()),this.newPlayer())break;if(this.playUrlTryCount>=this.urls.length){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_TRY_START_PLAYER+\" stream: \"+this.streamId),this.resetPlayer();var t=\"\";0==this.playerType?t=\"PlayEnd\":1==this.playerType&&(t=\"PublishEnd\",this.reportQualityStatics());var r={error:e,reason:\"no url to retry\"};this.dataReport.addEvent(this.playerSeq,t,r),this.streamCenter.onPlayerStop(this.streamId,this.playerType,e)}},e.prototype.getPlayerUrl=function(){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_GET_PLAY_URL+\" call \"+this.streamId);var e=this.urls[++this.retryIndex%this.urls.length],t=e;0!=this.params.length&&(t=e+\"?\"+this.params);var r=(new Date).getTime();return t=t.indexOf(\"?\")>-1?t+\"&zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid:t+\"?zgseq=\"+r+\"&zgdid=\"+this.stateCenter.sessionid,this.tryUrls.push(t),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_GET_PLAY_URL+\" call streamId: \"+this.streamId+\" url: \"+t),t},e.prototype.shouldRetryPlay=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3005==t},e.prototype.isPlayFailed=function(e){var t=e.detail.code;return-2301==t||2101==t||2102==t},e.prototype.shouldRetryPublish=function(e){var t=e.detail.code;return 3001==t||3002==t||3003==t||3004==t||3005==t},e.prototype.isPublishFailed=function(e){var t=e.detail.code;return-1301==t||-1302==t||-1303==t||-1304==t||-1305==t||-1306==t||-1307==t||-1308==t||-1309==t||-1310==t||-1311==t},e.prototype.updateEvent=function(e){if(0==this.playerType){if(this.playBegin||(this.playBegin=!0,s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"play_begin\")),2004==e.detail.code)this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,\"PlayRetry\"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,\"PlayStat\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"play_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"play_begin\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"play_state\"))),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+\" play suc: \"+this.streamId),this.state=a.ENUM_PLAYER_STATE.playing,this.streamCenter.onPlayerStart(this.streamId,this.playerType);else if(2009==e.detail.code);else if(this.shouldRetryPlay(e));else if(this.isPlayFailed(e)){this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+\" play error: \"+this.streamId),this.resetPlayer();e.detail.code;s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"play_begin\",\"error_code\",e.detail.code),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"play_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"play_begin\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPlayStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addMsgInfo,void 0,{})),this.playBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:\"play fail\"})}this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,\"PlayBegin\")}else 1==this.playerType&&(this.pushBegin||(this.pushBegin=!0,s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"push_begin\")),1002==e.detail.code?(this.everSuccess?this.dataReport.eventEnd(this.playerReportSeq,\"PublishRetry\"):(this.everSuccess=!0,this.dataReport.eventStart(this.playerReportSeq,\"PublishStat\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"push_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"push_begin\"),this.stateCenter.publishStreamList[this.streamId]&&this.stateCenter.publishStreamList[this.streamId].state==a.ENUM_PUBLISH_STREAM_STATE.tryPublish&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventStart,\"publish_state\"))),this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+\" play suc: \"+this.streamId),this.state=a.ENUM_PLAYER_STATE.playing,this.streamCenter.onPlayerStart(this.streamId,this.playerType)):this.shouldRetryPublish(e)||this.isPublishFailed(e)&&(this.logger.info(o.ZEGO_WECHATMINI_ACTION.PLAYWECHAT_UPDATE_EVENT+\" publish error: \"+this.streamId),this.resetPlayer(),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)&&(s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"push_begin\",\"error_code\",e.detail.code),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addEventMsg,\"push_begin\",\"try_urls\",this.tryUrls),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.eventEnd,\"push_begin\"),s.ClientUtil.actionSuccessCallback(\"kZegoTaskPublishStart\"+this.streamId,this.stateCenter.reportList)(a.REPORT_ACTION.addMsgInfo,void 0,{})),this.pushBegin=!1,this.streamCenter.onPlayerStop(this.streamId,this.playerType,{code:e.detail.code,msg:\"publish fail\"})),this.everSuccess||this.dataReport.eventEnd(this.playerReportSeq,\"PublishBegin\"))},e.prototype.updatePlayerNetStatus=function(e){var t={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoHeight:e.detail.info.videoHeight,videoWidth:e.detail.info.videoWidth,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter};if(this.playerInfo=t,1==this.playerType){var r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight};if(0==this.publishQualitySeq&&(this.publishQualitySeq=a.getReportSeq(),this.dataReport.newReport(this.publishQualitySeq),this.dataReport.addMsgInfo(this.publishQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.publishQualitySeq,\"PublishQuality\",r),this.publishQualityCount+=1,this.publishQualityCount>=this.publishQulaityMaxCount)(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}else if(0==this.playerType){r={videoBitrate:e.detail.info.videoBitrate,audioBitrate:e.detail.info.audioBitrate,videoFPS:e.detail.info.videoFPS,videoGOP:e.detail.info.videoGOP,netSpeed:e.detail.info.netSpeed,netJitter:e.detail.info.netJitter,videoWidth:e.detail.info.videoWidth,videoHeight:e.detail.info.videoHeight};if(0==this.playQualitySeq&&(this.playQualitySeq=a.getReportSeq(),this.dataReport.newReport(this.playQualitySeq),this.dataReport.addMsgInfo(this.playQualitySeq,{stream_id:this.streamId})),this.dataReport.addEvent(this.playQualitySeq,\"PlayQuality\",r),this.playQualityCount+=1,this.playQualityCount>=this.playQulaityMaxCount)(new Date).getTime()-this.playerLogUploadTime>45e3&&(this.reportPlayQualityStatics(),this.playerLogUploadTime=(new Date).getTime())}this.streamCenter.onPlayerQuality(this.streamId,t,this.playerType)},e.prototype.getCurrentPlayerUrl=function(){return this.urls[this.playUrlIndex%this.urls.length]},e.prototype.reportQualityStatics=function(){this.dataReport.addMsgInfo(this.publishQualitySeq,{itemtype:\"WXPublishStateUpdate\"}),this.dataReport.uploadReport(this.publishQualitySeq,i.ZegoWechatLogEvent.kZegoEventPublishStat),this.publishQualityCount=0,this.publishQualitySeq=0},e.prototype.reportPlayQualityStatics=function(){this.dataReport.addMsgInfo(this.playQualitySeq,{itemtype:\"WXPlayStateUpdate\"}),this.dataReport.uploadReport(this.playQualitySeq,i.ZegoWechatLogEvent.kZegoEventPlayStat),this.playQualityCount=0,this.playQualitySeq=0},e}();t.ZegoPlayWechat=n},function(e,t,r){Object.defineProperty(t,\"__esModule\",{value:!0}),t.StreamHandler=void 0;var o=r(0),s=r(3),a=r(0),i=r(1),n=r(5),E=function(){function e(e,t,r,o,s){this.logger=e,this.rtm=r,this.stateCenter=t,this.dataReport=o,this.streamCenter=s}return e.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:\"string\"==typeof t.urls_flv?t.urls_flv:\"\",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:\"string\"==typeof t.urls_m3u8?t.urls_m3u8:\"\",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:\"string\"==typeof t.urls_https_flv?t.urls_https_flv:\"\",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:\"string\"==typeof t.urls_https_m3u8?t.urls_https_m3u8:\"\",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:\"string\"==typeof t.urls_rtmp?t.urls_rtmp:\"\"},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e){var t=this;this.logger.info(\"zb.sh.hss call stream update\"),this.stateCenter.streamQuerying=!1,this.rtm.modules.service.on(\"stream\",(function(e){t.handleStreamUpdateRsp(e)})),this.rtm.modules.service.on(\"push_stream_update\",(function(e){t.handlePushStreamUpdateMsg(e)})),this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info||[]),this.handleReconnectStream(e.body.stream_info),this.logger.info(\"zb.sh.hss call end\")},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,a){var i=this;void 0===r&&(r=\"\"),this.logger.debug(\"zb.sh.usi call\");var E={stream_id:e,extra_info:r},l=JSON.stringify(E),_={sub_cmd:t,stream_msg:l};this.stateCenter.streamInfoList[e]={},this.stateCenter.streamInfoList[e].seq=this.rtm.modules.service.sendMessage(\"stream\",_,(function(e,t){i.handleStreamUpdateRsp(e)}),(function(E,l){if(i.stateCenter.isResetRoom||i.rtm.modules.service.isDisConnect()||!E.code||E.code!=n.errorCodeList.TIMEOUT.code||i.stateCenter.streamInfoList[e].seq!=l){if(E.body&&E.body.err_code){var _=s.ClientUtil.getServerError(E.body.err_code);a&&a(_,l)}}else 2001==t&&i.stateCenter.publishStreamList[e]&&i.stateCenter.publishStreamList[e].state==o.ENUM_PUBLISH_STREAM_STATE.update_info||2002==t?setTimeout((function(){i.updateStreamInfo(e,t,r,a)}),0):a&&a(n.errorCodeList.TIMEOUT)})),this.logger.info(\"zb.sh.usi call success cmd \"+t)},e.prototype.handleStreamUpdateRsp=function(e){if(this.rtm.modules.service.isDisConnect())this.logger.error(\"zb.sh.hsur not login\");else if(0==e.body.err_code){this.logger.info(\"zb.sh.hsur stream seq \"+this.stateCenter.streamSeq+\" server seq \"+e.body.stream_seq),this.stateCenter.streamSeq=e.body.stream_seq;for(var t=function(t){var s=e.body.stream_info[t].stream_id;if(!r.stateCenter.publishStreamList[s])return r.logger.info(\"hsur.0 stream is not exist\"),{value:void 0};r.stateCenter.publishStreamList[s].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(r.stateCenter.publishStreamList[s].state=o.ENUM_PUBLISH_STREAM_STATE.publishing,r.stateCenter.streamList.find((function(e){return e.stream_id==s}))||r.stateCenter.streamList.push(e.body.stream_info[t]),r.onPublishStateUpdate(0,s,{code:0,message:\"\"})),delete r.stateCenter.streamInfoList[s]},r=this,s=0;s<e.body.stream_info.length;s++){var a=t(s);if(\"object\"==typeof a)return a.value}}else this.logger.error(\"zb.sh.hsur stream update error \"+e.body.err_code)},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info(\"zb.sh.hfslr call\"),this.stateCenter.streamQuerying=!1,0===e.body.err_code?this.stateCenter.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.info(\"zb.sh.hfslr call success\")):this.logger.info(\"zb.sh.hfslr same seq\"):this.logger.info(\"zb.sh.hfslr server error=\",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.info(\"zb.sh.hfus call\"),this.stateCenter.streamSeq=e,this.logger.debug(\"zb.sh.hfus server seq \"+this.stateCenter.streamSeq),s.ClientUtil.mergeStreamList(this.stateCenter.idName,this.stateCenter.streamList,t,(function(e,t,s){0!==e.length&&(r.logger.debug(\"zb.sh.hfus callback addstream\"),r.onStreamUpdated(r.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug(\"zb.sh.hfus callback delstream\"),r.onStreamUpdated(r.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==s.length&&(r.logger.debug(\"zb.sh.hfus callback updatestream\"),r.onStreamExtraInfoUpdated(r.stateCenter.roomid,r.makeCallbackStreamList(s)))})),this.logger.info(\"zb.sh.hfus call success\")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info(\"zb.sh.hpsum call\"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.stateCenter.streamSeq!==e.body.stream_seq)return this.logger.info(\"zb.sh.hpsum call updatestream\"),void this.fetchStreamList(e);switch(this.stateCenter.streamSeq=e.body.stream_seq,e.body.stream_cmd){case o.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case o.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info(\"zb.sh.hpsum call success\")}else this.logger.info(\"zb.sh.hpsum, emtpy list\")},e.prototype.handleAddedStreamList=function(e){this.logger.debug(\"zb.sh.hasl call\");for(var t,r=[],s=0;s<e.length;s++)if(e[s].anchor_id_name!=this.stateCenter.idName){t=!1;for(var a=0;a<this.stateCenter.streamList.length;a++)if(e[s].stream_id===this.stateCenter.streamList[a].stream_id){t=!0;break}t||r.push(e[s])}else this.logger.debug(\"hdsl.0 have self stream added\");if(0!==r.length){this.logger.debug(\"zb.sh.hasl callback addstream\");for(var i=0;i<r.length;i++)this.stateCenter.streamList.push(r[i]);this.onStreamUpdated(this.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info(\"zb.sh.hasl call success\")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug(\"zb.sh.hdsl call\");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var s=this.stateCenter.streamList.length-1;s>=0;s--)if(e[r].stream_id===this.stateCenter.streamList[s].stream_id){this.stateCenter.streamList.splice(s--,1),t.push(e[r]);break}}else this.logger.debug(\"zb.sh.hdsl have self stream deleted\");0!==t.length&&(this.logger.debug(\"zb.sh.hdsl callback delstream\"),this.onStreamUpdated(this.stateCenter.roomid,o.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info(\"zb.sh.hdsl call\")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug(\"zb.sh.husl call\");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var o=0;o<this.stateCenter.streamList.length;o++)if(e[r].stream_id===this.stateCenter.streamList[o].stream_id){e[r].extra_info!==this.stateCenter.streamList[o].extra_info&&(this.stateCenter.streamList[o]=e[r],t.push(e[r]));break}}else this.logger.debug(\"hsul.0 have self stream updated\");0!==t.length&&(this.logger.debug(\"zb.sh.husl callback updatestream\"),this.onStreamExtraInfoUpdated(this.stateCenter.roomid,this.makeCallbackStreamList(t))),this.logger.info(\"zb.sh.husl call success\")},e.prototype.fetchStreamList=function(e){if(this.logger.info(\"zb.sh.fsl call\"),e.body.stream_seq!==this.stateCenter.streamSeq)if(this.rtm.modules.service.isDisConnect())this.logger.info(\"zb.sh.fsl state error\");else if(this.stateCenter.streamQuerying)this.logger.info(\"zb.sh.fsl already doing\");else{this.stateCenter.streamQuerying=!0,this.logger.debug(\"zb.sh.fsl send fetch request\");this.rtm.modules.service.sendMessage(\"stream_info\",{reserve:0},this.handleFetchStreamListRsp.bind(this),(function(e,t){})),this.logger.info(\"zb.sh.fsl call success\")}},e.prototype.handleReconnectStream=function(e){this.logger.info(\"zb.sh.hrs call\");var t=this.streamCenter.publisherList,r=this.streamCenter.playerList,s=function(r){if(t[r].publisher.state!=o.ENUM_PUBLISH_STATE.publishing||e.find((function(e){return e.stream_id==r}))){if(t[r].publisher.state==o.ENUM_PUBLISH_STATE.stop&&e.find((function(e){return e.stream_id==r}))){a.updateStreamInfo(r,o.ENUM_STREAM_SUB_CMD.liveEnd);for(var s=0;s<a.stateCenter.streamList.length;s++)if(a.stateCenter.streamList[s].stream_id==r){a.stateCenter.streamList.splice(s--,1);break}}}else a.updateStreamInfo(r,o.ENUM_STREAM_SUB_CMD.liveBegin,a.stateCenter.publishStreamList[r].extra_info)},a=this;for(var i in t)s(i);for(var i in t){if(t[i].isReDispatch)this.logger.info(\"zb.sh.hrs \"+i+\"retry dispatch\"),(n=t[i].retryDispatchHandler).stopMaxTime(),n.invalid(),n.initStream(i,t[i].publishOption,!0),n.active(0),t[i].isReDispatch=!1}for(var i in r){var n;if(r[i].isReDispatch)this.logger.info(\"zb.sh.hrs \"+i+\"retry dispatch\"),(n=r[i].retryDispatchHandler).stopMaxTime(),n.invalid(),n.initStream(i,r[i].playOption,!1),n.active(0),r[i].isReDispatch=!1}this.logger.info(\"zb.sh.hrs end\")},e.prototype.makeCallbackStreamList=function(e){var t=[];if(e&&e.length>0)for(var r=0;r<e.length;r++){var o={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:\"\",urlFlv:\"\",urlRtmp:\"\",urlHls:\"\",urlHttpsFlv:\"\",urlHttpsHls:\"\",streamGID:e[r].stream_gid,closeType:e[r].close_type};this.setCDNInfo(o,e[r]),t.push(o)}return t},e.prototype.updateMixStream=function(e,t,r){var E,l=this;if(this.logger.info(\"zb.sh.ums call\"),!e.noTaskID&&!e.taskID)return this.logger.error(\"zb.sh.ums no taskId found\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&\"string\"!=typeof e.taskID)return this.logger.error(\"zb.rh.lg taskId must be string\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>o.MAX_MIX_TASK_ID_LENGTH)return this.logger.error(\"zb.sh.ums taskId is too long\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!s.ClientUtil.checkIllegalCharacters(e.taskID))return this.logger.error(\"zb.sh.ums task ID contains illegal characters\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error(\"zb.sh.ums input list wrong\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach((function(e){\"AUDIO\"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var _=e.inputList.every((function(e){return\"AUDIO\"===e.contentType})),u=0;u<e.inputList.length;u++){var d=e.inputList[u];if(\"object\"!=typeof d.layout)return this.logger.error(\"zb.sh.ums input layout must be object\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!(s.ClientUtil.checkInteger(d.layout.top,!1)&&s.ClientUtil.checkInteger(d.layout.bottom,!1)&&s.ClientUtil.checkInteger(d.layout.left,!1)&&s.ClientUtil.checkInteger(d.layout.right,!1)))return this.logger.error(\"zb.sh.ums top、left、bottom、right must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error(\"zb.sh.ums no output list found\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some((function(e){return\"string\"==typeof e&&!s.ClientUtil.isUrl(e)&&!s.ClientUtil.checkIllegalCharacters(e)||\"object\"==typeof e&&e.target&&!s.ClientUtil.isUrl(e.target)&&!s.ClientUtil.checkIllegalCharacters(e.target)})))return this.logger.error(\"zb.sh.ums stream output target is incorrect\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!(_||e.outputConfig&&\"object\"==typeof e.outputConfig))return this.logger.error(\"zb.sh.ums no output config found\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(_&&(void 0===e.outputConfig&&(e.outputConfig={outputBitrate:0,outputFPS:0,outputWidth:0,outputHeight:0}),e.outputConfig.outputBitrate=.001,e.outputConfig.outputFPS=1,e.outputConfig.outputWidth=1,e.outputConfig.outputHeight=1),!(_||e.outputConfig.outputBitrate&&s.ClientUtil.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error(\"zb.sh.ums bitrate param is required and must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!s.ClientUtil.checkInteger(e.outputConfig.outputFPS))return this.logger.error(\"zb.sh.ums fps param is required and must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!s.ClientUtil.checkInteger(e.outputConfig.outputWidth))return this.logger.error(\"zb.sh.ums width param is required and must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!s.ClientUtil.checkInteger(e.outputConfig.outputHeight))return this.logger.error(\"zb.sh.ums height param is required and must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error(\"zb.sh.ums AudioCodecID param must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error(\"zb.sh.ums AudioBitrate param must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!s.ClientUtil.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error(\"zb.sh.ums AudioChannels param must be integer number\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var T=0;e.outputConfig.singleStreamPassThrough&&\"boolean\"==typeof e.outputConfig.singleStreamPassThrough&&(T=e.outputConfig.singleStreamPassThrough?1:0);var p={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:o.PROTO_VERSION,bypass:T},c=this.stateCenter.mixStreamAdvance;c&&(c.videoCodec&&(p.extra_params=[{key:\"video_encode\",value:c.videoCodec}]),c.backgroundColor&&(p.output_bg_color=c.backgroundColor),c.backgroundImage&&(p.output_bg_image=c.backgroundImage),c.waterMark&&(p.watermark=c.waterMark),c.extraParams&&(!p.extra_params&&(p.extra_params=[]),(E=p.extra_params).push.apply(E,c.extraParams)));var g=[];for(u=0;u<e.inputList.length;u++){var h=e.inputList[u],S=h.streamID;this.stateCenter.testEnvironment&&(S=\"zegotest-\"+this.stateCenter.appid+\"-\"+h.streamID),g.push({stream_id:S,content_control:\"AUDIO\"===h.contentType?1:0,rect:{layer:u,top:h.layout.top,left:h.layout.left,bottom:h.layout.bottom,right:h.layout.right}})}p.MixInput=g,s.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)(a.REPORT_ACTION.addMsgInfo,void 0,{mix_stream_id:i.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_id(e.taskID),stream_cnt:i.ZegoRTCLogEvent.kZegoTaskMixStart.stream_cnt(g.length),input_stream_list:i.ZegoRTCLogEvent.kZegoTaskMixStart.input_stream_list(g)});var R=[];e.outputList.forEach((function(t){var o={},s=\"\";if(\"string\"==typeof t)s=t;else{if(\"object\"!=typeof t||!t.target)return l.logger.error(\"zb.sh.ums output target required\"),r({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;s=t.target}s.startsWith(\"rtmp://\")||s.startsWith(\"https://\")&&s.endsWith(\".flv\")||s.startsWith(\"https://\")&&s.endsWith(\".m3u8\")?o.mixurl=s:l.stateCenter.testEnvironment?o.stream_id=\"zegotest-\"+l.stateCenter.appid+\"-\"+s:o.stream_id=s,o.bitrate=1e3*e.outputConfig.outputBitrate,o.fps=e.outputConfig.outputFPS,o.width=e.outputConfig.outputWidth,o.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(o.audio_enc_id=e.outputConfig.outputAudioCodecID),\"vp8\"===c.videoCodec?o.audio_enc_id=3:\"h264\"===c.videoCodec&&(o.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(o.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(o.audio_channel_cnt=e.outputConfig.outputAudioChannels),l.stateCenter.testEnvironment?o.testenv=1:o.testenv=0,R.push(o)})),p.MixOutput=R,s.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskMixStart\"+e.taskID,this.stateCenter.reportList)(a.REPORT_ACTION.addMsgInfo,void 0,{output_target_list:i.ZegoRTCLogEvent.kZegoTaskMixStart.output_target_list(R)});var C={channel:\"zeus\",cmd:\"start_mix\",req_body:JSON.stringify(p)};return this.logger.debug(\"zb.sh.ums send command\"),this.sendBizChannelRequest(C,(function(e,a,i){l.logger.debug(\"zb.sh.ums receive message\");var n=\"zegotest-\"+l.stateCenter.appid+\"-\";if(0!=i.length){for(var E=JSON.parse(i),_=[],u=0;u<E.play.length;u++){var d={rtmpURL:\"\",hlsURL:\"\",flvURL:\"\"},T=E.play[u].stream_alias||\"\";l.stateCenter.testEnvironment&&T&&T.startsWith(n)&&(T=T.slice(n.length)),d.streamID=T,E.play[u].rtmp_url&&E.play[u].rtmp_url.length>0&&(d.rtmpURL=E.play[u].rtmp_url),E.play[u].hls_url&&E.play[u].hls_url.length>0&&(d.hlsURL=E.play[u].hls_url),E.play[u].hdl_url&&E.play[u].hdl_url.length>0&&(d.flvURL=E.play[u].hdl_url),_.push(d)}if(t){var p={mixerOutputList:_};t({errorCode:0,extendedData:JSON.stringify(p)})}}else r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).code,extendedData:\"\"})}),(function(e,t,o){if(\"number\"==typeof e){l.logger.debug(\"zb.sh.ums error: \"+e);var a=[];if(1000000150==e&&0!=o.length)for(var E=JSON.parse(o),_=\"zegotest-\"+l.stateCenter.appid+\"-\",u=0;u<E.non_exist_streams.length;u++){var d=E.non_exist_streams[u];l.stateCenter.testEnvironment&&d.startsWith(_)?a.push(d.slice(_.length)):a.push(d)}r&&r({errorCode:s.ClientUtil.getServerError(e).code,extendedData:\"\"})}else{l.logger.debug(\"zb.sh.ums error code \"+e.code);var T=void 0;T=e==n.errorCodeList.TIMEOUT?i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:i.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,r&&r({errorCode:T.code,extendedData:\"\"})}})),!0},e.prototype.sendBizChannelRequest=function(e,t,r,o){var s=this;void 0===o&&(o=!1),e=Object.assign(e,{is_retry_req:o?1:0}),this.rtm.modules.service.sendMessage(\"biz_channel\",e,(function(e,r){t(e.header.seq,e.body.cmd,e.body.rsp_body)}),(function(o,a){var i=o.body.err_code,n=o.message.body.rsp_body;\"number\"!=typeof i||2002!==i?r(i,a,n):s.sendBizChannelRequest(e,t,r,!0)}))},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,o){var n,E={},l={};if(e&&e.videoCodec){var _=e.videoCodec.toLowerCase();if(-1==[\"vp8\",\"h264\"].indexOf(_))return t.logger.error(\"zb.sh.ums param videoCode error\"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;E.videoCodec=_,l.video_codec=_}if(e.backgroundColor){if(!s.ClientUtil.checkInteger(e.backgroundColor))return t.logger.error(\"zb.sh.ums param backgroundColor must be integer number\"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;E.backgroundColor=e.backgroundColor,l.background_color=e.backgroundColor}if(e.backgroundImage){if(\"string\"!=typeof e.backgroundImage)return t.logger.error(\"zb.sh.ums param outputBgImage error\"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith(\"preset-id://\")||!e.backgroundImage.endsWith(\".jpg\")&&!e.backgroundImage.endsWith(\".png\"))return t.logger.error(\"zb.sh.ums illegal input background image URL\"),o({errorCode:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;E.backgroundImage=e.backgroundImage,l.background_image=e.backgroundImage}e.waterMark&&(E.waterMark=e.waterMark,l.water_mark=e.waterMark),e.extraParams&&(E.extraParams||(E.extraParams=[]),(n=E.extraParams).push.apply(n,e.extraParams)),t.stateCenter.mixStreamAdvance=E,s.ClientUtil.actionSuccessCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList)&&s.ClientUtil.actionSuccessCallback(\"kZegoTaskMixConfig\",t.stateCenter.reportList)(a.REPORT_ACTION.addMsgInfo,void 0,{config:i.ZegoRTCLogEvent.kZegoTaskMixConfig.config(l)}),r({errorCode:0,extendedData:\"\"})}))},e.prototype.stopMixStream=function(e,t,r,a,E){var l=this;this.logger.info(\"zb.sh.sms call\");var _={id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:o.PROTO_VERSION};\"string\"==typeof e&&(_.task_id=e),null!=a?this.stateCenter.testEnvironment?_.stream_id=\"zegotest-\"+this.stateCenter.appid+\"-\"+a:_.stream_id=a:null!=E&&(_.mixurl=E);var u={channel:\"zeus\",cmd:\"stop_mix\",req_body:JSON.stringify(_)};return this.sendBizChannelRequest(u,(function(){t&&t({errorCode:0})}),(function(e){if(\"number\"==typeof e)r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+e).code,extendedData:\"\"});else{l.logger.error(\"zb.sh.sms stop mix fail \"+JSON.stringify(e));var t=void 0;t=e==n.errorCodeList.TIMEOUT?i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:i.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,r&&r({errorCode:t.code,extendedData:\"\"})}})),!0},e.prototype.updateStreamExtraInfo=function(e,t){return this.logger.info(\"zb.sh.usei call\"),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].extra_info=t,this.stateCenter.publishStreamList[e].state>=o.ENUM_PUBLISH_STREAM_STATE.update_info&&this.updateStreamInfo(e,o.ENUM_STREAM_SUB_CMD.liveUpdate,t)),!0},e.prototype.setStreamExtraInfo=function(e,t){var r=this;return new Promise((function(o,s){r._handleStreamInfo(e,t,s),o({errorCode:0,extendedData:\"\"})}))},e.prototype._setStreamExtraInfo=function(e,t){return this._handleStreamInfo(e,t)},e.prototype._handleStreamInfo=function(e,t,r){var s=o.getReportSeq();if(this.dataReport.newReport(s,i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.event),this.dataReport.addMsgInfo(s,{stream:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream(e),stream_extra_info:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.stream_extra_info(t),room_sid:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.room_sid(this.stateCenter.sessionid)}),\"string\"!=typeof e||\"\"==e)return this.logger.error(\"zb.ssei streamID must be string and not empty\"),this.dataReport.addMsgInfo(s,{error:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,message:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message+\" streamID must be string and not empty\"}),this.dataReport.uploadReport(s),r&&r({errorCode:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message}),!1;if(void 0===t||\"\"===t)return this.logger.error(\"zb.ssei extraInfo is empty\"),this.dataReport.addMsgInfo(s,{error:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,message:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message+\" extraInfo is empty\"}),this.dataReport.uploadReport(s),r&&r({errorCode:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kExtraInfoNullError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kExtraInfoNullError.message}),!1;if(\"string\"!=typeof t||\"\"==t)return this.logger.error(\"zb.ssei extraInfo must be string\"),this.dataReport.addMsgInfo(s,{error:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,message:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message+\" extraInfo must be string\"}),this.dataReport.uploadReport(s),r&&r({errorCode:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kParamError.message}),!1;if(this.rtm.modules.service.isDisConnect())return this.logger.error(\"zb.ssei not login\"),this.dataReport.uploadReport(s,void 0,i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError),r&&r({errorCode:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kNoLoginError.message}),!1;if(!this.stateCenter.publishStreamList[e])return this.logger.error(\"zb.ssei publish stream no found\"),this.dataReport.addMsgInfo(s,i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError),this.dataReport.uploadReport(s),r&&r({errorCode:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError.code,extendedData:i.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo.error.kPublishStreamNoFoundError.message}),!1;var a=this.updateStreamExtraInfo(e,t);return this.dataReport.uploadReport(s),a},e.prototype.publishTarget=function(e){var t=this,r=o.getReportSeq();switch(e.type){case\"addpush\":this.dataReport.newReport(r,i.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event);break;case\"delpush\":case\"clearpush\":this.dataReport.newReport(r,i.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event)}return this.dataReport.addMsgInfo(r,{stream:i.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.stream(e.streamID),target_url:i.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.target_url(e.pushUrl)}),new Promise((function(o,a){var n=function(e,o){t.logger.error(\"zb.pt\"+(o||e.message)),t.dataReport.addMsgInfo(r,{error:e.code,message:e.message+(o||\"\")}),t.dataReport.uploadReport(r),a({errorCode:e.code,extendedData:e.message+(o?\" \"+o:\"\")})};e.streamID&&\"string\"==typeof e.streamID||n(i.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,\"stream id type error\"),e.pushUrl&&\"string\"==typeof e.pushUrl||n(i.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,\"push url error\"),t.stateCenter.publishStreamList[e.streamID]||n(i.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);t._publishTarget(e,(function(e){t.dataReport.uploadReport(r),o(e)}),(function(e){var o=s.ClientUtil.getServerError(e.errorCode),i=s.ClientUtil.decodeServerError(o.code,o.message);t.dataReport.addMsgInfo(r,i),t.dataReport.uploadReport(r),a(e)}))}))},e.prototype._publishTarget=function(e,t,r){var a=this;if(-1==[\"addpush\",\"delpush\",\"clearpush\"].indexOf(e.type))return this.logger.error(\"zb.sh.pt cdn push type error\"),void(r&&r({errorCode:n.errorCodeList.PUBLISHER_CDN_PUSH_ERROR.code,extendedData:n.errorCodeList.PUBLISHER_BROWSER_NOT_SUPPORT.message+\" type error\"}));this.logger.info(\"zb.sh.ptcall\");var i=Math.ceil((new Date).getTime()/1e3),E=e.streamID;this.stateCenter.testEnvironment&&(E=\"zegotest-\"+this.stateCenter.appid+\"-\"+e.streamID);var l={appid:this.stateCenter.appid,biz_type:0,timestamp:i,seq:this.stateCenter.cdnSeq++,version:1*o.PROTO_VERSION,stream_id:E,pushurl:e.pushUrl},_={channel:\"media\",cmd:e.type,req_body:JSON.stringify(l)};this.logger.debug(\"zb.sh.pt send command\"),this.sendBizChannelRequest(_,(function(i,E,l){if(a.logger.info(\"zb.sh.pt receive message\"),0!=l.length){var _=JSON.parse(l),u=_.code,d=_.message;u&&0!=u?(a.logger.error(\"zb.sh.pt \"+e.type+\" error code: \"+u+\" \"+d),r&&r({errorCode:n.errorCodeList.UNKNOWN_SERVER_ERROR.code,extendedData:n.errorCodeList.UNKNOWN_SERVER_ERROR.message+\" cmd: \"+e.type+\" \"+u+\" \"+d+\"  \"})):(a.logger.info(\"zb.sh.pt \"+e.type+\" success\"),t&&t({errorCode:0,extendedData:\"\"}))}else r&&r({errorCode:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).code,extendedData:s.ClientUtil.getServerError(o.MIXSTREAM_ERROR_CODE+1).message})}),(function(t,o,s){a.logger.info(\"zb.sh.pt error: \"+t);var i=\"\";2001==t?i=\"invalid channel\":2002==t&&(i=\"bizchannel error\"),a.logger.error(\"zb.sh.pt \"+i),r&&r({errorCode:n.errorCodeList.UNKNOWN_SERVER_ERROR.code,extendedData:n.errorCodeList.UNKNOWN_SERVER_ERROR.message+\" cmd: \"+e.type+\" \"+t+\" \"+i+\"  \"})}))},e}();t.StreamHandler=E},function(e,t,r){var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,\"__esModule\",{value:!0}),t.PublishModule=void 0;var s=r(0),a=r(2),i=r(1),n=r(3),E=function(){function e(e,t,r,o,a,i){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.streamHandler=a,this.rtm=i,this.preferPublishSourceType=s.ENUM_DISPATCH_TYPE.ultra,this.ultraPlaySourceType=\"rtmp_v2\"}return e.prototype.startPublishingStream=function(e,t){var r=this;return new Promise((function(E,l){r.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+\" call\");var _=s.getReportSeq();r.stateCenter.reportSeqList.startPublish[e]=_,r.dataReport.newReport(_,i.ZegoWechatLogEvent.kZegoTaskPublishStart.event);var u=function(t,s){r.logger.error(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+\" \"+(s||t.message)),r.dataReport.uploadReport(_,void 0,t,s),delete r.stateCenter.reportSeqList.startPublish[e],l(o(o({},t),{errorCode:t.code,extendedData:t.message+(s?\" \"+s:\"\")}))};if(n.ClientUtil.isParamEmpty(e))if(n.ClientUtil.isTypeString(e)){if(!n.ClientUtil.isTooLong(e,s.MAX_STREAM_ID_LENGTH))return u(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDTooLongError),!1;if(!n.ClientUtil.checkIllegalCharacters(e))return u(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDInvalidCharacterError),!1;if(r.stateCenter.customUrl&&0!=r.stateCenter.customUrl.length)return r.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null},r.streamCenter.updatePublishingState(e,t&&t.streamParams?t.streamParams:void 0,!0)?(r.streamCenter.publishSuccessCallBackList[e]=function(e,t){E({streamID:e,url:t})},r.streamCenter.startPublishingStream(e,r.stateCenter.customUrl,1)):void u(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kIsPublishing,\"cannot start publish\");if(r.rtm.modules.service.isDisConnect())u(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishNoLoginError);else{if(!r.streamCenter.updatePublishingState(e,t&&t.streamParams?t.streamParams:void 0,!0))return u(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kIsPublishing,\"cannot start publish\"),!1;n.ClientUtil.logReportCallback(\"kZegoTaskPublishStart\"+e,r.dataReport,_,r.stateCenter.reportList),r.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,e,{code:0,message:\"\"}),r.dataReport.addMsgInfo(_,{stream:i.ZegoWechatLogEvent.kZegoTaskPublishStart.stream(e),publishOption:i.ZegoWechatLogEvent.kZegoTaskPublishStart.publishOption(t)}),!t||\"CDN\"!=t.sourceType&&\"BGP\"!=t.sourceType||r.setPreferPublishSourceType(s.ENUM_SOURCE_TYPE[t.sourceType]),r.stateCenter.publishStreamList[e]={state:s.ENUM_PUBLISH_STREAM_STATE.waiting_url,extra_info:t&&t.extraInfo?t.extraInfo:null},r.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_START_PUBLISHING_STREAM+\" fetch stream url\"),n.ClientUtil.actionLogReportCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventStart,\"get_publish_url\"),r.streamCenter.publishSuccessCallBackList[e]=function(e,t){n.ClientUtil.actionLogReportCallback(\"kZegoTaskPublishStart\"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,\"get_publish_url\"),E({streamID:e,url:t})},r.streamCenter.publishErrorCallBackList[e]=function(e){u(e)},r.fetchPublishStreamUrl(e)}}else u(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError);else u(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDNullError)}))},e.prototype.setPreferPublishSourceType=function(e,t){return this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+\" call\"),e!==s.ENUM_DISPATCH_TYPE.cdn&&e!==s.ENUM_DISPATCH_TYPE.ultra&&e!==s.ENUM_DISPATCH_TYPE.customUrl?(this.logger.error(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+\" sourceType only can be number 0 1 2\"),!1):e!==s.ENUM_DISPATCH_TYPE.customUrl||\"string\"==typeof t&&\"\"!=t?(this.preferPublishSourceType=e,this.customCdnUrl=t,this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+\" call success\"),!0):(this.logger.error(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_SET_PREFER_PUBLISH_SOURCE_TYPE+\" customUrl must be string and not empty\"),!1)},e.prototype.fetchPublishStreamUrl=function(e){var t=this;this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+\" call\"),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+\" send fetch publish request\");var r=\"\";this.preferPublishSourceType==s.ENUM_DISPATCH_TYPE.cdn?r=\"cdn\":this.preferPublishSourceType==s.ENUM_DISPATCH_TYPE.ultra&&(r=\"bgp\");var o={stream_id:e,url_type:this.ultraPlaySourceType,publish_type:r,header_kvs:[{key:\"grpc-metadata-push\",value:this.customCdnUrl||\"\"}]},n=this.rtm.modules.service.sendMessage(\"stream_publish\",o,(function(e){t.handleFetchStreamPublishUrlRsp(e)}),(function(r,o){t.streamCenter.publishErrorCallBackList[e](i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),t.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),t.streamCenter.stopPublishingStream(e)}));-1!==n&&(this.stateCenter.streamUrlMap[n]=e),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_FETCH_PUBLISH_STREAM_URL+\" call success\")},e.prototype.handleFetchStreamPublishUrlRsp=function(e){this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+\" call\");var t=this.stateCenter.streamUrlMap[e.header.seq];if(t&&delete this.stateCenter.streamUrlMap[e.header.seq],0!==e.body.err_code)return this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+\" server error= \"+e.body.err_code),void(this.stateCenter.publishStreamList[t]&&(this.logger.error(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+\" liveRoom cmd error\"),this.streamCenter.publishErrorCallBackList[t](i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),this.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,t,{code:i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError.code,message:\"server error= \"+e.body.err_code}),this.streamCenter.stopPublishingStream(t)));if(e.body.stream_url_info){var r=e.body.stream_url_info.stream_id,o=e.body.stream_url_info.urls_ws;if(!this.stateCenter.publishStreamList[r])return void this.logger.error(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_HANDLE_FETCH_STREAM_PUBLISH_URL_RSP+\" cannot find stream\");this.stateCenter.publishStreamList[r].url_rtmp=o,this.stateCenter.publishStreamList[r].state=s.ENUM_PUBLISH_STREAM_STATE.tryPublish,this.doPublishStream(r,o)}},e.prototype.doPublishStream=function(e,t){return this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_DO_PUBLISH_STREAM+\" call \"+e+\"streamUrl: \"+t),!t||t.length<=0?(this.streamCenter.publishErrorCallBackList[e](i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),this.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishDispatchError),!1):(this.streamCenter.startPublishingStream(e,t,this.preferPublishSourceType),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_DO_PUBLISH_STREAM+\" call success\"),!0)},e.prototype.stopPublishingStream=function(e){var t=this;this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+\" call \"+e);var r=s.getReportSeq();this.dataReport.newReport(r,i.ZegoWechatLogEvent.kZegoTaskPublishStop.event),this.dataReport.addMsgInfo(r,{stream_id:e});var o=function(o,s){t.logger.error(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+\" \"+(s||o.message)),t.dataReport.uploadReport(r,void 0,o,s),delete t.stateCenter.reportSeqList.startPublish[e]};if(!n.ClientUtil.isParamEmpty(e))return o(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishStreamIDNullError),!1;if(!n.ClientUtil.isTypeString(e))return o(i.ZegoWechatLogEvent.kZegoTaskPublishStart.error.kPublishParamError),!1;this.streamCenter.stopPublishingStream(e);var E=this.streamCenter.playerList[e];return E&&E.state!==s.ENUM_PLAYER_STATE.stop&&this.streamHandler.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,e,{code:0,message:\"\"}),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].state>=s.ENUM_PUBLISH_STREAM_STATE.update_info&&this.streamHandler.updateStreamInfo(e,s.ENUM_STREAM_SUB_CMD.liveEnd),delete this.stateCenter.publishStreamList[e]),this.stateCenter.streamUrlMap[e]&&delete this.stateCenter.streamUrlMap[e],this.dataReport.uploadReport(r),this.logger.info(a.ZEGO_WECHATMINI_ACTION.PUBLISHMODULE_STOP_PUBLISHING_STREAM+\" call success\"),!0},e}();t.PublishModule=E},function(e,t,r){var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,\"__esModule\",{value:!0}),t.PlayModule=void 0;var s=r(0),a=r(1),i=r(3),n=r(2),E=function(){function e(e,t,r,o,a){this.logger=e,this.dataReport=t,this.stateCenter=r,this.streamCenter=o,this.rtm=a,this.mixStreamList={},this.preferPlaySourceType=s.ENUM_PLAY_SOURCE_TYPE.ultra,this.currentPlaySourceType=s.ENUM_DISPATCH_TYPE.cdn,this.ultraPlaySourceType=\"rtmp_v2\"}return e.prototype.startPlayingStream=function(e,t){var r=this;return new Promise((function(E,l){r.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM+\" call \"+e);var _=s.getReportSeq();r.stateCenter.reportSeqList.startPlay[e]=_,r.dataReport.newReport(_,a.ZegoWechatLogEvent.kZegoTaskPlayStart.event);var u=function(t,s){r.logger.error(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM+\" \"+(s||t.message)),r.dataReport.uploadReport(_,void 0,t,s),delete r.stateCenter.reportSeqList.startPlay[e],l(o(o({},t),{errorCode:t.code,extendedData:t.message+(s?\" \"+s:\"\")}))};if(i.ClientUtil.isParamEmpty(e))if(i.ClientUtil.isTypeString(e))if(i.ClientUtil.isTooLong(e,s.MAX_STREAM_ID_LENGTH))if(i.ClientUtil.checkIllegalCharacters(e)){if(r.stateCenter.customPlayUrl&&0!=r.stateCenter.customPlayUrl.length)return r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0)?(r.streamCenter.playErrorCallBackList[e]=function(e){u(e)},r.streamCenter.startPlayingStream(e,r.stateCenter.customPlayUrl,1)):void u(a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError,\"cannot start play\");if(r.rtm.modules.service.isDisConnect())u(a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayNoLoginError);else if(r.streamCenter.updatePlayingState(e,t?t.streamParams:void 0,!0)){if(r.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.retry,e,{code:0,message:\"\"}),i.ClientUtil.logReportCallback(\"kZegoTaskPlayStart\"+e,r.dataReport,_,r.stateCenter.reportList),r.dataReport.addMsgInfo(_,{stream:a.ZegoWechatLogEvent.kZegoTaskPlayStart.stream(e),playOption:a.ZegoWechatLogEvent.kZegoTaskPlayStart.playOption(t)}),!t||\"CDN\"!=t.sourceType&&\"BGP\"!=t.sourceType||r.setPreferPlaySourceType(s.ENUM_SOURCE_TYPE[t.sourceType]),r.streamCenter.playSuccessCallBackList[e]=function(e,t){i.ClientUtil.actionLogReportCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,\"get_play_url\"),E({streamID:e,url:t})},r.streamCenter.playErrorCallBackList[e]=function(t){i.ClientUtil.actionLogReportCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventEnd,\"get_play_url\"),u(t)},t&&t.isMix)return r.mixStreamList[e]={ultra_url_rtmp:null},void r.fetchPlayStreamUrl(e,\"rtmp_cdn\");i.ClientUtil.actionLogReportCallback(\"kZegoTaskPlayStart\"+e,r.stateCenter.reportList,s.REPORT_ACTION.eventStart,\"get_play_url\"),r.preferPlaySourceType==s.ENUM_PLAY_SOURCE_TYPE.cdn?r.startPlayingStreamFromCDN(e):r.startPlayingStreamFromBGP(e)}else u(a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError,\"cannot start play\")}else u(a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDInvalidCharacterError);else u(a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDTooLongError);else u(a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayParamError);else u(a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayStreamIDNullError)}))},e.prototype.stopPlayingStream=function(e){this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+\" call \"+e);var t=s.getReportSeq();if(this.dataReport.newReport(t,a.ZegoWechatLogEvent.kZegoTaskPlayStop.event),this.dataReport.addMsgInfo(t,{stream_id:e}),\"string\"!=typeof e||\"\"==e)return this.logger.error(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+\" stream ID must be string and not empty\"),this.dataReport.addMsgInfo(t,a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayParamError),void this.dataReport.uploadReport(t);var r=this.streamCenter.playerList[e];for(var o in r&&r.state!==s.ENUM_PLAYER_STATE.stop&&this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e,{code:0,message:\"\"}),this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[o]===e){delete this.stateCenter.streamUrlMap[o];break}this.mixStreamList[e]&&delete this.mixStreamList[e],this.dataReport.uploadReport(t),this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_STOP_PLAYING_STREAM+\" call success\")},e.prototype.startPlayingStreamFromCDN=function(e){this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+\" call \"+e);for(var t=null,r=0;r<this.stateCenter.streamList.length;r++)if(this.stateCenter.streamList[r].stream_id===e){t=this.stateCenter.streamList[r].urls_rtmp||[];break}return!t||t.length<=0?(this.logger.error(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+\" cannot find stream url,Please check if CDN is configured \"),this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,e,a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError),!1):(this.currentPlaySourceType=s.ENUM_DISPATCH_TYPE.cdn,this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_CDN+\" play stream\"),this.doPlayStream(e,t,this.currentPlaySourceType))},e.prototype.startPlayingStreamFromBGP=function(e){return this.currentPlaySourceType=s.ENUM_DISPATCH_TYPE.ultra,this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_START_PLAYING_STREAM_FROM_BGP+\" fetch stream url\"),this.fetchPlayStreamUrl(e,this.ultraPlaySourceType),!0},e.prototype.doPlayStream=function(e,t,r){return this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_DO_PLAY_STREAM+\" call\"),this.streamCenter.startPlayingStream(e,t,r),!0},e.prototype.fetchPlayStreamUrl=function(e,t){var r=this;if(this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+\" call \"+e),this.rtm.modules.service.isDisConnect())this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+\" state error\");else{this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+\" send fetch request\");var o={stream_ids:[e],url_type:t},i=this.rtm.modules.service.sendMessage(\"stream_url\",o,(function(e){r.handleFetchStreamUrlRsp(e)}),(function(e){r.stateCenter.streamUrlMap[i]?r.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,r.stateCenter.streamUrlMap[i],a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError):r.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+\" already stop play\")}));-1!==i&&(this.stateCenter.streamUrlMap[i]=e,this.streamCenter.playerList[e]&&(this.streamCenter.playerList[e].seq=i)),this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_FETCH_PLAY_STREAM_URL+\" call success\")}},e.prototype.handleFetchStreamUrlRsp=function(e){this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+\" call \");var t=this.stateCenter.streamUrlMap[e.header.seq];if(t&&delete this.stateCenter.streamUrlMap[e.header.seq],0!==e.body.err_code)return this.logger.error(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+\" server error= \"+e.body.err_code),void this.streamCenter.onPlayStateUpdate(s.ENUM_PLAY_STATE_UPDATE.error,t,a.ZegoWechatLogEvent.kZegoTaskPlayStart.error.kPlayDispatchError);if(e.body.stream_url_infos&&e.body.stream_url_infos.length>0){var r=e.body.stream_url_infos[0].stream_id,o=e.body.stream_url_infos[0].urls_ws,i=this.currentPlaySourceType,E=!1;if(e.header.seq!==this.streamCenter.playerList[r].seq)return void this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+\" seq is not match, ignore \"+r);for(var l=0;l<this.stateCenter.streamList.length;l++)if(this.stateCenter.streamList[l].stream_id==r){this.stateCenter.streamList[l].urltra_url_rtmp=o,E=!0;break}!E&&this.mixStreamList[r]&&(this.mixStreamList[r].urltra_url_rtmp=o,i=s.ENUM_DISPATCH_TYPE.cdn,E=!0),E||(this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+\"cannot find streamInfo in existing stream list\"),this.stateCenter.streamList.push({stream_id:r,urltra_url_rtmp:o})),this.doPlayStream(r,o,i)}this.logger.info(n.ZEGO_WECHATMINI_ACTION.PLAYMODULE_HANDLE_FETCH_STREAM_URL_RSP+\" call success\")},e.prototype.setPreferPlaySourceType=function(e){return this.logger.info(n.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+\" call\"),e!==s.ENUM_PLAY_SOURCE_TYPE.cdn&&e!==s.ENUM_PLAY_SOURCE_TYPE.ultra?(this.logger.error(n.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+\" sourceType can be number 0 or 1, which can be represented auto or ultra\"),!1):(this.preferPlaySourceType=e,this.logger.info(n.ZEGO_WECHATMINI_ACTION.WECHATMINI_SETPREFERPLAYSOURCETYPE+\" call success\"),!0)},e}();t.PlayModule=E}])}));"]}